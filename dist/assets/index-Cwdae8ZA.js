function L6(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in n)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(n,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();function zT(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Gv={exports:{}},Jh={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xS;function U6(){if(xS)return Jh;xS=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(r,i,s){var o=null;if(s!==void 0&&(o=""+s),i.key!==void 0&&(o=""+i.key),"key"in i){s={};for(var l in i)l!=="key"&&(s[l]=i[l])}else s=i;return i=s.ref,{$$typeof:n,type:r,key:o,ref:i!==void 0?i:null,props:s}}return Jh.Fragment=e,Jh.jsx=t,Jh.jsxs=t,Jh}var AS;function F6(){return AS||(AS=1,Gv.exports=U6()),Gv.exports}var X=F6(),Zv={exports:{}},Ye={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var SS;function B6(){if(SS)return Ye;SS=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),o=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),g=Symbol.iterator;function y(L){return L===null||typeof L!="object"?null:(L=g&&L[g]||L["@@iterator"],typeof L=="function"?L:null)}var b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},w=Object.assign,E={};function x(L,Z,ie){this.props=L,this.context=Z,this.refs=E,this.updater=ie||b}x.prototype.isReactComponent={},x.prototype.setState=function(L,Z){if(typeof L!="object"&&typeof L!="function"&&L!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,L,Z,"setState")},x.prototype.forceUpdate=function(L){this.updater.enqueueForceUpdate(this,L,"forceUpdate")};function C(){}C.prototype=x.prototype;function M(L,Z,ie){this.props=L,this.context=Z,this.refs=E,this.updater=ie||b}var O=M.prototype=new C;O.constructor=M,w(O,x.prototype),O.isPureReactComponent=!0;var V=Array.isArray,H={H:null,A:null,T:null,S:null,V:null},G=Object.prototype.hasOwnProperty;function D(L,Z,ie,ae,me,Ee){return ie=Ee.ref,{$$typeof:n,type:L,key:Z,ref:ie!==void 0?ie:null,props:Ee}}function I(L,Z){return D(L.type,Z,void 0,void 0,void 0,L.props)}function N(L){return typeof L=="object"&&L!==null&&L.$$typeof===n}function j(L){var Z={"=":"=0",":":"=2"};return"$"+L.replace(/[=:]/g,function(ie){return Z[ie]})}var W=/\/+/g;function Y(L,Z){return typeof L=="object"&&L!==null&&L.key!=null?j(""+L.key):Z.toString(36)}function z(){}function de(L){switch(L.status){case"fulfilled":return L.value;case"rejected":throw L.reason;default:switch(typeof L.status=="string"?L.then(z,z):(L.status="pending",L.then(function(Z){L.status==="pending"&&(L.status="fulfilled",L.value=Z)},function(Z){L.status==="pending"&&(L.status="rejected",L.reason=Z)})),L.status){case"fulfilled":return L.value;case"rejected":throw L.reason}}throw L}function xe(L,Z,ie,ae,me){var Ee=typeof L;(Ee==="undefined"||Ee==="boolean")&&(L=null);var Se=!1;if(L===null)Se=!0;else switch(Ee){case"bigint":case"string":case"number":Se=!0;break;case"object":switch(L.$$typeof){case n:case e:Se=!0;break;case d:return Se=L._init,xe(Se(L._payload),Z,ie,ae,me)}}if(Se)return me=me(L),Se=ae===""?"."+Y(L,0):ae,V(me)?(ie="",Se!=null&&(ie=Se.replace(W,"$&/")+"/"),xe(me,Z,ie,"",function(at){return at})):me!=null&&(N(me)&&(me=I(me,ie+(me.key==null||L&&L.key===me.key?"":(""+me.key).replace(W,"$&/")+"/")+Se)),Z.push(me)),1;Se=0;var Ce=ae===""?".":ae+":";if(V(L))for(var Me=0;Me<L.length;Me++)ae=L[Me],Ee=Ce+Y(ae,Me),Se+=xe(ae,Z,ie,Ee,me);else if(Me=y(L),typeof Me=="function")for(L=Me.call(L),Me=0;!(ae=L.next()).done;)ae=ae.value,Ee=Ce+Y(ae,Me++),Se+=xe(ae,Z,ie,Ee,me);else if(Ee==="object"){if(typeof L.then=="function")return xe(de(L),Z,ie,ae,me);throw Z=String(L),Error("Objects are not valid as a React child (found: "+(Z==="[object Object]"?"object with keys {"+Object.keys(L).join(", ")+"}":Z)+"). If you meant to render a collection of children, use an array instead.")}return Se}function P(L,Z,ie){if(L==null)return L;var ae=[],me=0;return xe(L,ae,"","",function(Ee){return Z.call(ie,Ee,me++)}),ae}function q(L){if(L._status===-1){var Z=L._result;Z=Z(),Z.then(function(ie){(L._status===0||L._status===-1)&&(L._status=1,L._result=ie)},function(ie){(L._status===0||L._status===-1)&&(L._status=2,L._result=ie)}),L._status===-1&&(L._status=0,L._result=Z)}if(L._status===1)return L._result.default;throw L._result}var U=typeof reportError=="function"?reportError:function(L){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Z=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof L=="object"&&L!==null&&typeof L.message=="string"?String(L.message):String(L),error:L});if(!window.dispatchEvent(Z))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",L);return}console.error(L)};function oe(){}return Ye.Children={map:P,forEach:function(L,Z,ie){P(L,function(){Z.apply(this,arguments)},ie)},count:function(L){var Z=0;return P(L,function(){Z++}),Z},toArray:function(L){return P(L,function(Z){return Z})||[]},only:function(L){if(!N(L))throw Error("React.Children.only expected to receive a single React element child.");return L}},Ye.Component=x,Ye.Fragment=t,Ye.Profiler=i,Ye.PureComponent=M,Ye.StrictMode=r,Ye.Suspense=u,Ye.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=H,Ye.__COMPILER_RUNTIME={__proto__:null,c:function(L){return H.H.useMemoCache(L)}},Ye.cache=function(L){return function(){return L.apply(null,arguments)}},Ye.cloneElement=function(L,Z,ie){if(L==null)throw Error("The argument must be a React element, but you passed "+L+".");var ae=w({},L.props),me=L.key,Ee=void 0;if(Z!=null)for(Se in Z.ref!==void 0&&(Ee=void 0),Z.key!==void 0&&(me=""+Z.key),Z)!G.call(Z,Se)||Se==="key"||Se==="__self"||Se==="__source"||Se==="ref"&&Z.ref===void 0||(ae[Se]=Z[Se]);var Se=arguments.length-2;if(Se===1)ae.children=ie;else if(1<Se){for(var Ce=Array(Se),Me=0;Me<Se;Me++)Ce[Me]=arguments[Me+2];ae.children=Ce}return D(L.type,me,void 0,void 0,Ee,ae)},Ye.createContext=function(L){return L={$$typeof:o,_currentValue:L,_currentValue2:L,_threadCount:0,Provider:null,Consumer:null},L.Provider=L,L.Consumer={$$typeof:s,_context:L},L},Ye.createElement=function(L,Z,ie){var ae,me={},Ee=null;if(Z!=null)for(ae in Z.key!==void 0&&(Ee=""+Z.key),Z)G.call(Z,ae)&&ae!=="key"&&ae!=="__self"&&ae!=="__source"&&(me[ae]=Z[ae]);var Se=arguments.length-2;if(Se===1)me.children=ie;else if(1<Se){for(var Ce=Array(Se),Me=0;Me<Se;Me++)Ce[Me]=arguments[Me+2];me.children=Ce}if(L&&L.defaultProps)for(ae in Se=L.defaultProps,Se)me[ae]===void 0&&(me[ae]=Se[ae]);return D(L,Ee,void 0,void 0,null,me)},Ye.createRef=function(){return{current:null}},Ye.forwardRef=function(L){return{$$typeof:l,render:L}},Ye.isValidElement=N,Ye.lazy=function(L){return{$$typeof:d,_payload:{_status:-1,_result:L},_init:q}},Ye.memo=function(L,Z){return{$$typeof:h,type:L,compare:Z===void 0?null:Z}},Ye.startTransition=function(L){var Z=H.T,ie={};H.T=ie;try{var ae=L(),me=H.S;me!==null&&me(ie,ae),typeof ae=="object"&&ae!==null&&typeof ae.then=="function"&&ae.then(oe,U)}catch(Ee){U(Ee)}finally{H.T=Z}},Ye.unstable_useCacheRefresh=function(){return H.H.useCacheRefresh()},Ye.use=function(L){return H.H.use(L)},Ye.useActionState=function(L,Z,ie){return H.H.useActionState(L,Z,ie)},Ye.useCallback=function(L,Z){return H.H.useCallback(L,Z)},Ye.useContext=function(L){return H.H.useContext(L)},Ye.useDebugValue=function(){},Ye.useDeferredValue=function(L,Z){return H.H.useDeferredValue(L,Z)},Ye.useEffect=function(L,Z,ie){var ae=H.H;if(typeof ie=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return ae.useEffect(L,Z)},Ye.useId=function(){return H.H.useId()},Ye.useImperativeHandle=function(L,Z,ie){return H.H.useImperativeHandle(L,Z,ie)},Ye.useInsertionEffect=function(L,Z){return H.H.useInsertionEffect(L,Z)},Ye.useLayoutEffect=function(L,Z){return H.H.useLayoutEffect(L,Z)},Ye.useMemo=function(L,Z){return H.H.useMemo(L,Z)},Ye.useOptimistic=function(L,Z){return H.H.useOptimistic(L,Z)},Ye.useReducer=function(L,Z,ie){return H.H.useReducer(L,Z,ie)},Ye.useRef=function(L){return H.H.useRef(L)},Ye.useState=function(L){return H.H.useState(L)},Ye.useSyncExternalStore=function(L,Z,ie){return H.H.useSyncExternalStore(L,Z,ie)},Ye.useTransition=function(){return H.H.useTransition()},Ye.version="19.1.1",Ye}var RS;function jT(){return RS||(RS=1,Zv.exports=B6()),Zv.exports}var R=jT();const vt=zT(R),jI=L6({__proto__:null,default:vt},[R]);var Qv={exports:{}},ef={},Jv={exports:{}},eb={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var CS;function V6(){return CS||(CS=1,(function(n){function e(P,q){var U=P.length;P.push(q);e:for(;0<U;){var oe=U-1>>>1,L=P[oe];if(0<i(L,q))P[oe]=q,P[U]=L,U=oe;else break e}}function t(P){return P.length===0?null:P[0]}function r(P){if(P.length===0)return null;var q=P[0],U=P.pop();if(U!==q){P[0]=U;e:for(var oe=0,L=P.length,Z=L>>>1;oe<Z;){var ie=2*(oe+1)-1,ae=P[ie],me=ie+1,Ee=P[me];if(0>i(ae,U))me<L&&0>i(Ee,ae)?(P[oe]=Ee,P[me]=U,oe=me):(P[oe]=ae,P[ie]=U,oe=ie);else if(me<L&&0>i(Ee,U))P[oe]=Ee,P[me]=U,oe=me;else break e}}return q}function i(P,q){var U=P.sortIndex-q.sortIndex;return U!==0?U:P.id-q.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var o=Date,l=o.now();n.unstable_now=function(){return o.now()-l}}var u=[],h=[],d=1,g=null,y=3,b=!1,w=!1,E=!1,x=!1,C=typeof setTimeout=="function"?setTimeout:null,M=typeof clearTimeout=="function"?clearTimeout:null,O=typeof setImmediate<"u"?setImmediate:null;function V(P){for(var q=t(h);q!==null;){if(q.callback===null)r(h);else if(q.startTime<=P)r(h),q.sortIndex=q.expirationTime,e(u,q);else break;q=t(h)}}function H(P){if(E=!1,V(P),!w)if(t(u)!==null)w=!0,G||(G=!0,Y());else{var q=t(h);q!==null&&xe(H,q.startTime-P)}}var G=!1,D=-1,I=5,N=-1;function j(){return x?!0:!(n.unstable_now()-N<I)}function W(){if(x=!1,G){var P=n.unstable_now();N=P;var q=!0;try{e:{w=!1,E&&(E=!1,M(D),D=-1),b=!0;var U=y;try{t:{for(V(P),g=t(u);g!==null&&!(g.expirationTime>P&&j());){var oe=g.callback;if(typeof oe=="function"){g.callback=null,y=g.priorityLevel;var L=oe(g.expirationTime<=P);if(P=n.unstable_now(),typeof L=="function"){g.callback=L,V(P),q=!0;break t}g===t(u)&&r(u),V(P)}else r(u);g=t(u)}if(g!==null)q=!0;else{var Z=t(h);Z!==null&&xe(H,Z.startTime-P),q=!1}}break e}finally{g=null,y=U,b=!1}q=void 0}}finally{q?Y():G=!1}}}var Y;if(typeof O=="function")Y=function(){O(W)};else if(typeof MessageChannel<"u"){var z=new MessageChannel,de=z.port2;z.port1.onmessage=W,Y=function(){de.postMessage(null)}}else Y=function(){C(W,0)};function xe(P,q){D=C(function(){P(n.unstable_now())},q)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(P){P.callback=null},n.unstable_forceFrameRate=function(P){0>P||125<P?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<P?Math.floor(1e3/P):5},n.unstable_getCurrentPriorityLevel=function(){return y},n.unstable_next=function(P){switch(y){case 1:case 2:case 3:var q=3;break;default:q=y}var U=y;y=q;try{return P()}finally{y=U}},n.unstable_requestPaint=function(){x=!0},n.unstable_runWithPriority=function(P,q){switch(P){case 1:case 2:case 3:case 4:case 5:break;default:P=3}var U=y;y=P;try{return q()}finally{y=U}},n.unstable_scheduleCallback=function(P,q,U){var oe=n.unstable_now();switch(typeof U=="object"&&U!==null?(U=U.delay,U=typeof U=="number"&&0<U?oe+U:oe):U=oe,P){case 1:var L=-1;break;case 2:L=250;break;case 5:L=1073741823;break;case 4:L=1e4;break;default:L=5e3}return L=U+L,P={id:d++,callback:q,priorityLevel:P,startTime:U,expirationTime:L,sortIndex:-1},U>oe?(P.sortIndex=U,e(h,P),t(u)===null&&P===t(h)&&(E?(M(D),D=-1):E=!0,xe(H,U-oe))):(P.sortIndex=L,e(u,P),w||b||(w=!0,G||(G=!0,Y()))),P},n.unstable_shouldYield=j,n.unstable_wrapCallback=function(P){var q=y;return function(){var U=y;y=q;try{return P.apply(this,arguments)}finally{y=U}}}})(eb)),eb}var IS;function z6(){return IS||(IS=1,Jv.exports=V6()),Jv.exports}var tb={exports:{}},Vn={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var PS;function j6(){if(PS)return Vn;PS=1;var n=jT();function e(u){var h="https://react.dev/errors/"+u;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)h+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+u+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var r={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},i=Symbol.for("react.portal");function s(u,h,d){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:g==null?null:""+g,children:u,containerInfo:h,implementation:d}}var o=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(u,h){if(u==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return Vn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Vn.createPortal=function(u,h){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(e(299));return s(u,h,null,d)},Vn.flushSync=function(u){var h=o.T,d=r.p;try{if(o.T=null,r.p=2,u)return u()}finally{o.T=h,r.p=d,r.d.f()}},Vn.preconnect=function(u,h){typeof u=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,r.d.C(u,h))},Vn.prefetchDNS=function(u){typeof u=="string"&&r.d.D(u)},Vn.preinit=function(u,h){if(typeof u=="string"&&h&&typeof h.as=="string"){var d=h.as,g=l(d,h.crossOrigin),y=typeof h.integrity=="string"?h.integrity:void 0,b=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;d==="style"?r.d.S(u,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:g,integrity:y,fetchPriority:b}):d==="script"&&r.d.X(u,{crossOrigin:g,integrity:y,fetchPriority:b,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},Vn.preinitModule=function(u,h){if(typeof u=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var d=l(h.as,h.crossOrigin);r.d.M(u,{crossOrigin:d,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&r.d.M(u)},Vn.preload=function(u,h){if(typeof u=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var d=h.as,g=l(d,h.crossOrigin);r.d.L(u,d,{crossOrigin:g,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},Vn.preloadModule=function(u,h){if(typeof u=="string")if(h){var d=l(h.as,h.crossOrigin);r.d.m(u,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:d,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else r.d.m(u)},Vn.requestFormReset=function(u){r.d.r(u)},Vn.unstable_batchedUpdates=function(u,h){return u(h)},Vn.useFormState=function(u,h,d){return o.H.useFormState(u,h,d)},Vn.useFormStatus=function(){return o.H.useHostTransitionStatus()},Vn.version="19.1.1",Vn}var MS;function HI(){if(MS)return tb.exports;MS=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),tb.exports=j6(),tb.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var OS;function H6(){if(OS)return ef;OS=1;var n=z6(),e=jT(),t=HI();function r(a){var c="https://react.dev/errors/"+a;if(1<arguments.length){c+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)c+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+a+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function s(a){var c=a,f=a;if(a.alternate)for(;c.return;)c=c.return;else{a=c;do c=a,(c.flags&4098)!==0&&(f=c.return),a=c.return;while(a)}return c.tag===3?f:null}function o(a){if(a.tag===13){var c=a.memoizedState;if(c===null&&(a=a.alternate,a!==null&&(c=a.memoizedState)),c!==null)return c.dehydrated}return null}function l(a){if(s(a)!==a)throw Error(r(188))}function u(a){var c=a.alternate;if(!c){if(c=s(a),c===null)throw Error(r(188));return c!==a?null:a}for(var f=a,p=c;;){var _=f.return;if(_===null)break;var v=_.alternate;if(v===null){if(p=_.return,p!==null){f=p;continue}break}if(_.child===v.child){for(v=_.child;v;){if(v===f)return l(_),a;if(v===p)return l(_),c;v=v.sibling}throw Error(r(188))}if(f.return!==p.return)f=_,p=v;else{for(var S=!1,k=_.child;k;){if(k===f){S=!0,f=_,p=v;break}if(k===p){S=!0,p=_,f=v;break}k=k.sibling}if(!S){for(k=v.child;k;){if(k===f){S=!0,f=v,p=_;break}if(k===p){S=!0,p=v,f=_;break}k=k.sibling}if(!S)throw Error(r(189))}}if(f.alternate!==p)throw Error(r(190))}if(f.tag!==3)throw Error(r(188));return f.stateNode.current===f?a:c}function h(a){var c=a.tag;if(c===5||c===26||c===27||c===6)return a;for(a=a.child;a!==null;){if(c=h(a),c!==null)return c;a=a.sibling}return null}var d=Object.assign,g=Symbol.for("react.element"),y=Symbol.for("react.transitional.element"),b=Symbol.for("react.portal"),w=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),x=Symbol.for("react.profiler"),C=Symbol.for("react.provider"),M=Symbol.for("react.consumer"),O=Symbol.for("react.context"),V=Symbol.for("react.forward_ref"),H=Symbol.for("react.suspense"),G=Symbol.for("react.suspense_list"),D=Symbol.for("react.memo"),I=Symbol.for("react.lazy"),N=Symbol.for("react.activity"),j=Symbol.for("react.memo_cache_sentinel"),W=Symbol.iterator;function Y(a){return a===null||typeof a!="object"?null:(a=W&&a[W]||a["@@iterator"],typeof a=="function"?a:null)}var z=Symbol.for("react.client.reference");function de(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===z?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case w:return"Fragment";case x:return"Profiler";case E:return"StrictMode";case H:return"Suspense";case G:return"SuspenseList";case N:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case b:return"Portal";case O:return(a.displayName||"Context")+".Provider";case M:return(a._context.displayName||"Context")+".Consumer";case V:var c=a.render;return a=a.displayName,a||(a=c.displayName||c.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case D:return c=a.displayName||null,c!==null?c:de(a.type)||"Memo";case I:c=a._payload,a=a._init;try{return de(a(c))}catch{}}return null}var xe=Array.isArray,P=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,q=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,U={pending:!1,data:null,method:null,action:null},oe=[],L=-1;function Z(a){return{current:a}}function ie(a){0>L||(a.current=oe[L],oe[L]=null,L--)}function ae(a,c){L++,oe[L]=a.current,a.current=c}var me=Z(null),Ee=Z(null),Se=Z(null),Ce=Z(null);function Me(a,c){switch(ae(Se,c),ae(Ee,a),ae(me,null),c.nodeType){case 9:case 11:a=(a=c.documentElement)&&(a=a.namespaceURI)?QA(a):0;break;default:if(a=c.tagName,c=c.namespaceURI)c=QA(c),a=JA(c,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}ie(me),ae(me,a)}function at(){ie(me),ie(Ee),ie(Se)}function Ke(a){a.memoizedState!==null&&ae(Ce,a);var c=me.current,f=JA(c,a.type);c!==f&&(ae(Ee,a),ae(me,f))}function mn(a){Ee.current===a&&(ie(me),ie(Ee)),Ce.current===a&&(ie(Ce),Yh._currentValue=U)}var on=Object.prototype.hasOwnProperty,Gn=n.unstable_scheduleCallback,ts=n.unstable_cancelCallback,lt=n.unstable_shouldYield,tt=n.unstable_requestPaint,ir=n.unstable_now,Od=n.unstable_getCurrentPriorityLevel,an=n.unstable_ImmediatePriority,_n=n.unstable_UserBlockingPriority,ns=n.unstable_NormalPriority,Q_=n.unstable_LowPriority,Ku=n.unstable_IdlePriority,J_=n.log,ba=n.unstable_setDisableYieldValue,Ks=null,Un=null;function Cr(a){if(typeof J_=="function"&&ba(a),Un&&typeof Un.setStrictMode=="function")try{Un.setStrictMode(Ks,a)}catch{}}var Zn=Math.clz32?Math.clz32:Nd,ey=Math.log,kd=Math.LN2;function Nd(a){return a>>>=0,a===0?32:31-(ey(a)/kd|0)|0}var yi=256,Gs=4194304;function Kr(a){var c=a&42;if(c!==0)return c;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function Ir(a,c,f){var p=a.pendingLanes;if(p===0)return 0;var _=0,v=a.suspendedLanes,S=a.pingedLanes;a=a.warmLanes;var k=p&134217727;return k!==0?(p=k&~v,p!==0?_=Kr(p):(S&=k,S!==0?_=Kr(S):f||(f=k&~a,f!==0&&(_=Kr(f))))):(k=p&~v,k!==0?_=Kr(k):S!==0?_=Kr(S):f||(f=p&~a,f!==0&&(_=Kr(f)))),_===0?0:c!==0&&c!==_&&(c&v)===0&&(v=_&-_,f=c&-c,v>=f||v===32&&(f&4194048)!==0)?c:_}function Zs(a,c){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&c)===0}function Ul(a,c){switch(a){case 1:case 2:case 4:case 8:case 64:return c+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Gu(){var a=yi;return yi<<=1,(yi&4194048)===0&&(yi=256),a}function Qs(){var a=Gs;return Gs<<=1,(Gs&62914560)===0&&(Gs=4194304),a}function Fl(a){for(var c=[],f=0;31>f;f++)c.push(a);return c}function Wt(a,c){a.pendingLanes|=c,c!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function Dd(a,c,f,p,_,v){var S=a.pendingLanes;a.pendingLanes=f,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=f,a.entangledLanes&=f,a.errorRecoveryDisabledLanes&=f,a.shellSuspendCounter=0;var k=a.entanglements,K=a.expirationTimes,ue=a.hiddenUpdates;for(f=S&~f;0<f;){var ge=31-Zn(f),ve=1<<ge;k[ge]=0,K[ge]=-1;var he=ue[ge];if(he!==null)for(ue[ge]=null,ge=0;ge<he.length;ge++){var fe=he[ge];fe!==null&&(fe.lane&=-536870913)}f&=~ve}p!==0&&Js(a,p,0),v!==0&&_===0&&a.tag!==0&&(a.suspendedLanes|=v&~(S&~c))}function Js(a,c,f){a.pendingLanes|=c,a.suspendedLanes&=~c;var p=31-Zn(c);a.entangledLanes|=c,a.entanglements[p]=a.entanglements[p]|1073741824|f&4194090}function eo(a,c){var f=a.entangledLanes|=c;for(a=a.entanglements;f;){var p=31-Zn(f),_=1<<p;_&c|a[p]&c&&(a[p]|=c),f&=~_}}function Zu(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function Qu(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function rs(){var a=q.p;return a!==0?a:(a=window.event,a===void 0?32:yS(a.type))}function ty(a,c){var f=q.p;try{return q.p=a,c()}finally{q.p=f}}var vi=Math.random().toString(36).slice(2),qt="__reactFiber$"+vi,Sn="__reactProps$"+vi,is="__reactContainer$"+vi,Ta="__reactEvents$"+vi,wa="__reactListeners$"+vi,ny="__reactHandles$"+vi,Gr="__reactResources$"+vi,to="__reactMarker$"+vi;function Bl(a){delete a[qt],delete a[Sn],delete a[Ta],delete a[wa],delete a[ny]}function bi(a){var c=a[qt];if(c)return c;for(var f=a.parentNode;f;){if(c=f[is]||f[qt]){if(f=c.alternate,c.child!==null||f!==null&&f.child!==null)for(a=rS(a);a!==null;){if(f=a[qt])return f;a=rS(a)}return c}a=f,f=a.parentNode}return null}function Ti(a){if(a=a[qt]||a[is]){var c=a.tag;if(c===5||c===6||c===13||c===26||c===27||c===3)return a}return null}function no(a){var c=a.tag;if(c===5||c===26||c===27||c===6)return a.stateNode;throw Error(r(33))}function ro(a){var c=a[Gr];return c||(c=a[Gr]={hoistableStyles:new Map,hoistableScripts:new Map}),c}function Xt(a){a[to]=!0}var Ld=new Set,Ea={};function wi(a,c){Ei(a,c),Ei(a+"Capture",c)}function Ei(a,c){for(Ea[a]=c,a=0;a<c.length;a++)Ld.add(c[a])}var xa=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),xi={},Vl={};function ry(a){return on.call(Vl,a)?!0:on.call(xi,a)?!1:xa.test(a)?Vl[a]=!0:(xi[a]=!0,!1)}function Aa(a,c,f){if(ry(c))if(f===null)a.removeAttribute(c);else{switch(typeof f){case"undefined":case"function":case"symbol":a.removeAttribute(c);return;case"boolean":var p=c.toLowerCase().slice(0,5);if(p!=="data-"&&p!=="aria-"){a.removeAttribute(c);return}}a.setAttribute(c,""+f)}}function Sa(a,c,f){if(f===null)a.removeAttribute(c);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(c);return}a.setAttribute(c,""+f)}}function Pr(a,c,f,p){if(p===null)a.removeAttribute(f);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(f);return}a.setAttributeNS(c,f,""+p)}}var Ra,zl;function ss(a){if(Ra===void 0)try{throw Error()}catch(f){var c=f.stack.trim().match(/\n( *(at )?)/);Ra=c&&c[1]||"",zl=-1<f.stack.indexOf(`
    at`)?" (<anonymous>)":-1<f.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ra+a+zl}var jl=!1;function Hl(a,c){if(!a||jl)return"";jl=!0;var f=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var p={DetermineComponentFrameRoot:function(){try{if(c){var ve=function(){throw Error()};if(Object.defineProperty(ve.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ve,[])}catch(fe){var he=fe}Reflect.construct(a,[],ve)}else{try{ve.call()}catch(fe){he=fe}a.call(ve.prototype)}}else{try{throw Error()}catch(fe){he=fe}(ve=a())&&typeof ve.catch=="function"&&ve.catch(function(){})}}catch(fe){if(fe&&he&&typeof fe.stack=="string")return[fe.stack,he.stack]}return[null,null]}};p.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var _=Object.getOwnPropertyDescriptor(p.DetermineComponentFrameRoot,"name");_&&_.configurable&&Object.defineProperty(p.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var v=p.DetermineComponentFrameRoot(),S=v[0],k=v[1];if(S&&k){var K=S.split(`
`),ue=k.split(`
`);for(_=p=0;p<K.length&&!K[p].includes("DetermineComponentFrameRoot");)p++;for(;_<ue.length&&!ue[_].includes("DetermineComponentFrameRoot");)_++;if(p===K.length||_===ue.length)for(p=K.length-1,_=ue.length-1;1<=p&&0<=_&&K[p]!==ue[_];)_--;for(;1<=p&&0<=_;p--,_--)if(K[p]!==ue[_]){if(p!==1||_!==1)do if(p--,_--,0>_||K[p]!==ue[_]){var ge=`
`+K[p].replace(" at new "," at ");return a.displayName&&ge.includes("<anonymous>")&&(ge=ge.replace("<anonymous>",a.displayName)),ge}while(1<=p&&0<=_);break}}}finally{jl=!1,Error.prepareStackTrace=f}return(f=a?a.displayName||a.name:"")?ss(f):""}function iy(a){switch(a.tag){case 26:case 27:case 5:return ss(a.type);case 16:return ss("Lazy");case 13:return ss("Suspense");case 19:return ss("SuspenseList");case 0:case 15:return Hl(a.type,!1);case 11:return Hl(a.type.render,!1);case 1:return Hl(a.type,!0);case 31:return ss("Activity");default:return""}}function Zr(a){try{var c="";do c+=iy(a),a=a.return;while(a);return c}catch(f){return`
Error generating stack: `+f.message+`
`+f.stack}}function Dt(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function io(a){var c=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(c==="checkbox"||c==="radio")}function Ca(a){var c=io(a)?"checked":"value",f=Object.getOwnPropertyDescriptor(a.constructor.prototype,c),p=""+a[c];if(!a.hasOwnProperty(c)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var _=f.get,v=f.set;return Object.defineProperty(a,c,{configurable:!0,get:function(){return _.call(this)},set:function(S){p=""+S,v.call(this,S)}}),Object.defineProperty(a,c,{enumerable:f.enumerable}),{getValue:function(){return p},setValue:function(S){p=""+S},stopTracking:function(){a._valueTracker=null,delete a[c]}}}}function so(a){a._valueTracker||(a._valueTracker=Ca(a))}function bt(a){if(!a)return!1;var c=a._valueTracker;if(!c)return!0;var f=c.getValue(),p="";return a&&(p=io(a)?a.checked?"true":"false":a.value),a=p,a!==f?(c.setValue(a),!0):!1}function os(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var Ia=/[\n"\\]/g;function yn(a){return a.replace(Ia,function(c){return"\\"+c.charCodeAt(0).toString(16)+" "})}function Ju(a,c,f,p,_,v,S,k){a.name="",S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"?a.type=S:a.removeAttribute("type"),c!=null?S==="number"?(c===0&&a.value===""||a.value!=c)&&(a.value=""+Dt(c)):a.value!==""+Dt(c)&&(a.value=""+Dt(c)):S!=="submit"&&S!=="reset"||a.removeAttribute("value"),c!=null?th(a,S,Dt(c)):f!=null?th(a,S,Dt(f)):p!=null&&a.removeAttribute("value"),_==null&&v!=null&&(a.defaultChecked=!!v),_!=null&&(a.checked=_&&typeof _!="function"&&typeof _!="symbol"),k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"?a.name=""+Dt(k):a.removeAttribute("name")}function eh(a,c,f,p,_,v,S,k){if(v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"&&(a.type=v),c!=null||f!=null){if(!(v!=="submit"&&v!=="reset"||c!=null))return;f=f!=null?""+Dt(f):"",c=c!=null?""+Dt(c):f,k||c===a.value||(a.value=c),a.defaultValue=c}p=p??_,p=typeof p!="function"&&typeof p!="symbol"&&!!p,a.checked=k?a.checked:!!p,a.defaultChecked=!!p,S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"&&(a.name=S)}function th(a,c,f){c==="number"&&os(a.ownerDocument)===a||a.defaultValue===""+f||(a.defaultValue=""+f)}function oo(a,c,f,p){if(a=a.options,c){c={};for(var _=0;_<f.length;_++)c["$"+f[_]]=!0;for(f=0;f<a.length;f++)_=c.hasOwnProperty("$"+a[f].value),a[f].selected!==_&&(a[f].selected=_),_&&p&&(a[f].defaultSelected=!0)}else{for(f=""+Dt(f),c=null,_=0;_<a.length;_++){if(a[_].value===f){a[_].selected=!0,p&&(a[_].defaultSelected=!0);return}c!==null||a[_].disabled||(c=a[_])}c!==null&&(c.selected=!0)}}function Ud(a,c,f){if(c!=null&&(c=""+Dt(c),c!==a.value&&(a.value=c),f==null)){a.defaultValue!==c&&(a.defaultValue=c);return}a.defaultValue=f!=null?""+Dt(f):""}function Fd(a,c,f,p){if(c==null){if(p!=null){if(f!=null)throw Error(r(92));if(xe(p)){if(1<p.length)throw Error(r(93));p=p[0]}f=p}f==null&&(f=""),c=f}f=Dt(c),a.defaultValue=f,p=a.textContent,p===f&&p!==""&&p!==null&&(a.value=p)}function Mr(a,c){if(c){var f=a.firstChild;if(f&&f===a.lastChild&&f.nodeType===3){f.nodeValue=c;return}}a.textContent=c}var as=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function nh(a,c,f){var p=c.indexOf("--")===0;f==null||typeof f=="boolean"||f===""?p?a.setProperty(c,""):c==="float"?a.cssFloat="":a[c]="":p?a.setProperty(c,f):typeof f!="number"||f===0||as.has(c)?c==="float"?a.cssFloat=f:a[c]=(""+f).trim():a[c]=f+"px"}function rh(a,c,f){if(c!=null&&typeof c!="object")throw Error(r(62));if(a=a.style,f!=null){for(var p in f)!f.hasOwnProperty(p)||c!=null&&c.hasOwnProperty(p)||(p.indexOf("--")===0?a.setProperty(p,""):p==="float"?a.cssFloat="":a[p]="");for(var _ in c)p=c[_],c.hasOwnProperty(_)&&f[_]!==p&&nh(a,_,p)}else for(var v in c)c.hasOwnProperty(v)&&nh(a,v,c[v])}function $l(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Bd=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Vd=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Qr(a){return Vd.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}var ih=null;function sh(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var ao=null,Qn=null;function zd(a){var c=Ti(a);if(c&&(a=c.stateNode)){var f=a[Sn]||null;e:switch(a=c.stateNode,c.type){case"input":if(Ju(a,f.value,f.defaultValue,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name),c=f.name,f.type==="radio"&&c!=null){for(f=a;f.parentNode;)f=f.parentNode;for(f=f.querySelectorAll('input[name="'+yn(""+c)+'"][type="radio"]'),c=0;c<f.length;c++){var p=f[c];if(p!==a&&p.form===a.form){var _=p[Sn]||null;if(!_)throw Error(r(90));Ju(p,_.value,_.defaultValue,_.defaultValue,_.checked,_.defaultChecked,_.type,_.name)}}for(c=0;c<f.length;c++)p=f[c],p.form===a.form&&bt(p)}break e;case"textarea":Ud(a,f.value,f.defaultValue);break e;case"select":c=f.value,c!=null&&oo(a,!!f.multiple,c,!1)}}}var Pa=!1;function Ma(a,c,f){if(Pa)return a(c,f);Pa=!0;try{var p=a(c);return p}finally{if(Pa=!1,(ao!==null||Qn!==null)&&(Pp(),ao&&(c=ao,a=Qn,Qn=ao=null,zd(c),a)))for(c=0;c<a.length;c++)zd(a[c])}}function lo(a,c){var f=a.stateNode;if(f===null)return null;var p=f[Sn]||null;if(p===null)return null;f=p[c];e:switch(c){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(a=a.type,p=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!p;break e;default:a=!1}if(a)return null;if(f&&typeof f!="function")throw Error(r(231,c,typeof f));return f}var Jn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ls=!1;if(Jn)try{var co={};Object.defineProperty(co,"passive",{get:function(){ls=!0}}),window.addEventListener("test",co,co),window.removeEventListener("test",co,co)}catch{ls=!1}var Or=null,It=null,Wl=null;function jd(){if(Wl)return Wl;var a,c=It,f=c.length,p,_="value"in Or?Or.value:Or.textContent,v=_.length;for(a=0;a<f&&c[a]===_[a];a++);var S=f-a;for(p=1;p<=S&&c[f-p]===_[v-p];p++);return Wl=_.slice(a,1<p?1-p:void 0)}function Oa(a){var c=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&c===13&&(a=13)):a=c,a===10&&(a=13),32<=a||a===13?a:0}function ka(){return!0}function oh(){return!1}function ln(a){function c(f,p,_,v,S){this._reactName=f,this._targetInst=_,this.type=p,this.nativeEvent=v,this.target=S,this.currentTarget=null;for(var k in a)a.hasOwnProperty(k)&&(f=a[k],this[k]=f?f(v):v[k]);return this.isDefaultPrevented=(v.defaultPrevented!=null?v.defaultPrevented:v.returnValue===!1)?ka:oh,this.isPropagationStopped=oh,this}return d(c.prototype,{preventDefault:function(){this.defaultPrevented=!0;var f=this.nativeEvent;f&&(f.preventDefault?f.preventDefault():typeof f.returnValue!="unknown"&&(f.returnValue=!1),this.isDefaultPrevented=ka)},stopPropagation:function(){var f=this.nativeEvent;f&&(f.stopPropagation?f.stopPropagation():typeof f.cancelBubble!="unknown"&&(f.cancelBubble=!0),this.isPropagationStopped=ka)},persist:function(){},isPersistent:ka}),c}var Fn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Na=ln(Fn),Da=d({},Fn,{view:0,detail:0}),La=ln(Da),ql,Ua,Ai,Fa=d({},Da,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Kl,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==Ai&&(Ai&&a.type==="mousemove"?(ql=a.screenX-Ai.screenX,Ua=a.screenY-Ai.screenY):Ua=ql=0,Ai=a),ql)},movementY:function(a){return"movementY"in a?a.movementY:Ua}}),Ba=ln(Fa),sy=d({},Fa,{dataTransfer:0}),Hd=ln(sy),Va=d({},Da,{relatedTarget:0}),Xl=ln(Va),$d=d({},Fn,{animationName:0,elapsedTime:0,pseudoElement:0}),ah=ln($d),lh=d({},Fn,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),Wd=ln(lh),Yl=d({},Fn,{data:0}),ch=ln(Yl),qd={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},cs={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Xd={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Yd(a){var c=this.nativeEvent;return c.getModifierState?c.getModifierState(a):(a=Xd[a])?!!c[a]:!1}function Kl(){return Yd}var Kd=d({},Da,{key:function(a){if(a.key){var c=qd[a.key]||a.key;if(c!=="Unidentified")return c}return a.type==="keypress"?(a=Oa(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?cs[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Kl,charCode:function(a){return a.type==="keypress"?Oa(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?Oa(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),Gl=ln(Kd),er=d({},Fa,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),uh=ln(er),Gd=d({},Da,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Kl}),uo=ln(Gd),m=d({},Fn,{propertyName:0,elapsedTime:0,pseudoElement:0}),T=ln(m),A=d({},Fa,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),F=ln(A),ce=d({},Fn,{newState:0,oldState:0}),pe=ln(ce),Ae=[9,13,27,32],We=Jn&&"CompositionEvent"in window,Mt=null;Jn&&"documentMode"in document&&(Mt=document.documentMode);var mt=Jn&&"TextEvent"in window&&!Mt,Yt=Jn&&(!We||Mt&&8<Mt&&11>=Mt),dr=" ",Si=!1;function Jr(a,c){switch(a){case"keyup":return Ae.indexOf(c.keyCode)!==-1;case"keydown":return c.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ei(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var ti=!1;function hh(a,c){switch(a){case"compositionend":return ei(c);case"keypress":return c.which!==32?null:(Si=!0,dr);case"textInput":return a=c.data,a===dr&&Si?null:a;default:return null}}function cL(a,c){if(ti)return a==="compositionend"||!We&&Jr(a,c)?(a=jd(),Wl=It=Or=null,ti=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(c.ctrlKey||c.altKey||c.metaKey)||c.ctrlKey&&c.altKey){if(c.char&&1<c.char.length)return c.char;if(c.which)return String.fromCharCode(c.which)}return null;case"compositionend":return Yt&&c.locale!=="ko"?null:c.data;default:return null}}var uL={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function fx(a){var c=a&&a.nodeName&&a.nodeName.toLowerCase();return c==="input"?!!uL[a.type]:c==="textarea"}function dx(a,c,f,p){ao?Qn?Qn.push(p):Qn=[p]:ao=p,c=Lp(c,"onChange"),0<c.length&&(f=new Na("onChange","change",null,f,p),a.push({event:f,listeners:c}))}var fh=null,dh=null;function hL(a){XA(a,0)}function Zd(a){var c=no(a);if(bt(c))return a}function px(a,c){if(a==="change")return c}var gx=!1;if(Jn){var oy;if(Jn){var ay="oninput"in document;if(!ay){var mx=document.createElement("div");mx.setAttribute("oninput","return;"),ay=typeof mx.oninput=="function"}oy=ay}else oy=!1;gx=oy&&(!document.documentMode||9<document.documentMode)}function _x(){fh&&(fh.detachEvent("onpropertychange",yx),dh=fh=null)}function yx(a){if(a.propertyName==="value"&&Zd(dh)){var c=[];dx(c,dh,a,sh(a)),Ma(hL,c)}}function fL(a,c,f){a==="focusin"?(_x(),fh=c,dh=f,fh.attachEvent("onpropertychange",yx)):a==="focusout"&&_x()}function dL(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return Zd(dh)}function pL(a,c){if(a==="click")return Zd(c)}function gL(a,c){if(a==="input"||a==="change")return Zd(c)}function mL(a,c){return a===c&&(a!==0||1/a===1/c)||a!==a&&c!==c}var pr=typeof Object.is=="function"?Object.is:mL;function ph(a,c){if(pr(a,c))return!0;if(typeof a!="object"||a===null||typeof c!="object"||c===null)return!1;var f=Object.keys(a),p=Object.keys(c);if(f.length!==p.length)return!1;for(p=0;p<f.length;p++){var _=f[p];if(!on.call(c,_)||!pr(a[_],c[_]))return!1}return!0}function vx(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function bx(a,c){var f=vx(a);a=0;for(var p;f;){if(f.nodeType===3){if(p=a+f.textContent.length,a<=c&&p>=c)return{node:f,offset:c-a};a=p}e:{for(;f;){if(f.nextSibling){f=f.nextSibling;break e}f=f.parentNode}f=void 0}f=vx(f)}}function Tx(a,c){return a&&c?a===c?!0:a&&a.nodeType===3?!1:c&&c.nodeType===3?Tx(a,c.parentNode):"contains"in a?a.contains(c):a.compareDocumentPosition?!!(a.compareDocumentPosition(c)&16):!1:!1}function wx(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var c=os(a.document);c instanceof a.HTMLIFrameElement;){try{var f=typeof c.contentWindow.location.href=="string"}catch{f=!1}if(f)a=c.contentWindow;else break;c=os(a.document)}return c}function ly(a){var c=a&&a.nodeName&&a.nodeName.toLowerCase();return c&&(c==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||c==="textarea"||a.contentEditable==="true")}var _L=Jn&&"documentMode"in document&&11>=document.documentMode,Zl=null,cy=null,gh=null,uy=!1;function Ex(a,c,f){var p=f.window===f?f.document:f.nodeType===9?f:f.ownerDocument;uy||Zl==null||Zl!==os(p)||(p=Zl,"selectionStart"in p&&ly(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),gh&&ph(gh,p)||(gh=p,p=Lp(cy,"onSelect"),0<p.length&&(c=new Na("onSelect","select",null,c,f),a.push({event:c,listeners:p}),c.target=Zl)))}function za(a,c){var f={};return f[a.toLowerCase()]=c.toLowerCase(),f["Webkit"+a]="webkit"+c,f["Moz"+a]="moz"+c,f}var Ql={animationend:za("Animation","AnimationEnd"),animationiteration:za("Animation","AnimationIteration"),animationstart:za("Animation","AnimationStart"),transitionrun:za("Transition","TransitionRun"),transitionstart:za("Transition","TransitionStart"),transitioncancel:za("Transition","TransitionCancel"),transitionend:za("Transition","TransitionEnd")},hy={},xx={};Jn&&(xx=document.createElement("div").style,"AnimationEvent"in window||(delete Ql.animationend.animation,delete Ql.animationiteration.animation,delete Ql.animationstart.animation),"TransitionEvent"in window||delete Ql.transitionend.transition);function ja(a){if(hy[a])return hy[a];if(!Ql[a])return a;var c=Ql[a],f;for(f in c)if(c.hasOwnProperty(f)&&f in xx)return hy[a]=c[f];return a}var Ax=ja("animationend"),Sx=ja("animationiteration"),Rx=ja("animationstart"),yL=ja("transitionrun"),vL=ja("transitionstart"),bL=ja("transitioncancel"),Cx=ja("transitionend"),Ix=new Map,fy="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");fy.push("scrollEnd");function ni(a,c){Ix.set(a,c),wi(c,[a])}var Px=new WeakMap;function kr(a,c){if(typeof a=="object"&&a!==null){var f=Px.get(a);return f!==void 0?f:(c={value:a,source:c,stack:Zr(c)},Px.set(a,c),c)}return{value:a,source:c,stack:Zr(c)}}var Nr=[],Jl=0,dy=0;function Qd(){for(var a=Jl,c=dy=Jl=0;c<a;){var f=Nr[c];Nr[c++]=null;var p=Nr[c];Nr[c++]=null;var _=Nr[c];Nr[c++]=null;var v=Nr[c];if(Nr[c++]=null,p!==null&&_!==null){var S=p.pending;S===null?_.next=_:(_.next=S.next,S.next=_),p.pending=_}v!==0&&Mx(f,_,v)}}function Jd(a,c,f,p){Nr[Jl++]=a,Nr[Jl++]=c,Nr[Jl++]=f,Nr[Jl++]=p,dy|=p,a.lanes|=p,a=a.alternate,a!==null&&(a.lanes|=p)}function py(a,c,f,p){return Jd(a,c,f,p),ep(a)}function ec(a,c){return Jd(a,null,null,c),ep(a)}function Mx(a,c,f){a.lanes|=f;var p=a.alternate;p!==null&&(p.lanes|=f);for(var _=!1,v=a.return;v!==null;)v.childLanes|=f,p=v.alternate,p!==null&&(p.childLanes|=f),v.tag===22&&(a=v.stateNode,a===null||a._visibility&1||(_=!0)),a=v,v=v.return;return a.tag===3?(v=a.stateNode,_&&c!==null&&(_=31-Zn(f),a=v.hiddenUpdates,p=a[_],p===null?a[_]=[c]:p.push(c),c.lane=f|536870912),v):null}function ep(a){if(50<Vh)throw Vh=0,bv=null,Error(r(185));for(var c=a.return;c!==null;)a=c,c=a.return;return a.tag===3?a.stateNode:null}var tc={};function TL(a,c,f,p){this.tag=a,this.key=f,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=c,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function gr(a,c,f,p){return new TL(a,c,f,p)}function gy(a){return a=a.prototype,!(!a||!a.isReactComponent)}function us(a,c){var f=a.alternate;return f===null?(f=gr(a.tag,c,a.key,a.mode),f.elementType=a.elementType,f.type=a.type,f.stateNode=a.stateNode,f.alternate=a,a.alternate=f):(f.pendingProps=c,f.type=a.type,f.flags=0,f.subtreeFlags=0,f.deletions=null),f.flags=a.flags&65011712,f.childLanes=a.childLanes,f.lanes=a.lanes,f.child=a.child,f.memoizedProps=a.memoizedProps,f.memoizedState=a.memoizedState,f.updateQueue=a.updateQueue,c=a.dependencies,f.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext},f.sibling=a.sibling,f.index=a.index,f.ref=a.ref,f.refCleanup=a.refCleanup,f}function Ox(a,c){a.flags&=65011714;var f=a.alternate;return f===null?(a.childLanes=0,a.lanes=c,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=f.childLanes,a.lanes=f.lanes,a.child=f.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=f.memoizedProps,a.memoizedState=f.memoizedState,a.updateQueue=f.updateQueue,a.type=f.type,c=f.dependencies,a.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext}),a}function tp(a,c,f,p,_,v){var S=0;if(p=a,typeof a=="function")gy(a)&&(S=1);else if(typeof a=="string")S=E6(a,f,me.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case N:return a=gr(31,f,c,_),a.elementType=N,a.lanes=v,a;case w:return Ha(f.children,_,v,c);case E:S=8,_|=24;break;case x:return a=gr(12,f,c,_|2),a.elementType=x,a.lanes=v,a;case H:return a=gr(13,f,c,_),a.elementType=H,a.lanes=v,a;case G:return a=gr(19,f,c,_),a.elementType=G,a.lanes=v,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case C:case O:S=10;break e;case M:S=9;break e;case V:S=11;break e;case D:S=14;break e;case I:S=16,p=null;break e}S=29,f=Error(r(130,a===null?"null":typeof a,"")),p=null}return c=gr(S,f,c,_),c.elementType=a,c.type=p,c.lanes=v,c}function Ha(a,c,f,p){return a=gr(7,a,p,c),a.lanes=f,a}function my(a,c,f){return a=gr(6,a,null,c),a.lanes=f,a}function _y(a,c,f){return c=gr(4,a.children!==null?a.children:[],a.key,c),c.lanes=f,c.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},c}var nc=[],rc=0,np=null,rp=0,Dr=[],Lr=0,$a=null,hs=1,fs="";function Wa(a,c){nc[rc++]=rp,nc[rc++]=np,np=a,rp=c}function kx(a,c,f){Dr[Lr++]=hs,Dr[Lr++]=fs,Dr[Lr++]=$a,$a=a;var p=hs;a=fs;var _=32-Zn(p)-1;p&=~(1<<_),f+=1;var v=32-Zn(c)+_;if(30<v){var S=_-_%5;v=(p&(1<<S)-1).toString(32),p>>=S,_-=S,hs=1<<32-Zn(c)+_|f<<_|p,fs=v+a}else hs=1<<v|f<<_|p,fs=a}function yy(a){a.return!==null&&(Wa(a,1),kx(a,1,0))}function vy(a){for(;a===np;)np=nc[--rc],nc[rc]=null,rp=nc[--rc],nc[rc]=null;for(;a===$a;)$a=Dr[--Lr],Dr[Lr]=null,fs=Dr[--Lr],Dr[Lr]=null,hs=Dr[--Lr],Dr[Lr]=null}var tr=null,zt=null,ft=!1,qa=null,Ri=!1,by=Error(r(519));function Xa(a){var c=Error(r(418,""));throw yh(kr(c,a)),by}function Nx(a){var c=a.stateNode,f=a.type,p=a.memoizedProps;switch(c[qt]=a,c[Sn]=p,f){case"dialog":et("cancel",c),et("close",c);break;case"iframe":case"object":case"embed":et("load",c);break;case"video":case"audio":for(f=0;f<jh.length;f++)et(jh[f],c);break;case"source":et("error",c);break;case"img":case"image":case"link":et("error",c),et("load",c);break;case"details":et("toggle",c);break;case"input":et("invalid",c),eh(c,p.value,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name,!0),so(c);break;case"select":et("invalid",c);break;case"textarea":et("invalid",c),Fd(c,p.value,p.defaultValue,p.children),so(c)}f=p.children,typeof f!="string"&&typeof f!="number"&&typeof f!="bigint"||c.textContent===""+f||p.suppressHydrationWarning===!0||ZA(c.textContent,f)?(p.popover!=null&&(et("beforetoggle",c),et("toggle",c)),p.onScroll!=null&&et("scroll",c),p.onScrollEnd!=null&&et("scrollend",c),p.onClick!=null&&(c.onclick=Up),c=!0):c=!1,c||Xa(a)}function Dx(a){for(tr=a.return;tr;)switch(tr.tag){case 5:case 13:Ri=!1;return;case 27:case 3:Ri=!0;return;default:tr=tr.return}}function mh(a){if(a!==tr)return!1;if(!ft)return Dx(a),ft=!0,!1;var c=a.tag,f;if((f=c!==3&&c!==27)&&((f=c===5)&&(f=a.type,f=!(f!=="form"&&f!=="button")||Lv(a.type,a.memoizedProps)),f=!f),f&&zt&&Xa(a),Dx(a),c===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(r(317));e:{for(a=a.nextSibling,c=0;a;){if(a.nodeType===8)if(f=a.data,f==="/$"){if(c===0){zt=ii(a.nextSibling);break e}c--}else f!=="$"&&f!=="$!"&&f!=="$?"||c++;a=a.nextSibling}zt=null}}else c===27?(c=zt,Ro(a.type)?(a=Vv,Vv=null,zt=a):zt=c):zt=tr?ii(a.stateNode.nextSibling):null;return!0}function _h(){zt=tr=null,ft=!1}function Lx(){var a=qa;return a!==null&&(ar===null?ar=a:ar.push.apply(ar,a),qa=null),a}function yh(a){qa===null?qa=[a]:qa.push(a)}var Ty=Z(null),Ya=null,ds=null;function ho(a,c,f){ae(Ty,c._currentValue),c._currentValue=f}function ps(a){a._currentValue=Ty.current,ie(Ty)}function wy(a,c,f){for(;a!==null;){var p=a.alternate;if((a.childLanes&c)!==c?(a.childLanes|=c,p!==null&&(p.childLanes|=c)):p!==null&&(p.childLanes&c)!==c&&(p.childLanes|=c),a===f)break;a=a.return}}function Ey(a,c,f,p){var _=a.child;for(_!==null&&(_.return=a);_!==null;){var v=_.dependencies;if(v!==null){var S=_.child;v=v.firstContext;e:for(;v!==null;){var k=v;v=_;for(var K=0;K<c.length;K++)if(k.context===c[K]){v.lanes|=f,k=v.alternate,k!==null&&(k.lanes|=f),wy(v.return,f,a),p||(S=null);break e}v=k.next}}else if(_.tag===18){if(S=_.return,S===null)throw Error(r(341));S.lanes|=f,v=S.alternate,v!==null&&(v.lanes|=f),wy(S,f,a),S=null}else S=_.child;if(S!==null)S.return=_;else for(S=_;S!==null;){if(S===a){S=null;break}if(_=S.sibling,_!==null){_.return=S.return,S=_;break}S=S.return}_=S}}function vh(a,c,f,p){a=null;for(var _=c,v=!1;_!==null;){if(!v){if((_.flags&524288)!==0)v=!0;else if((_.flags&262144)!==0)break}if(_.tag===10){var S=_.alternate;if(S===null)throw Error(r(387));if(S=S.memoizedProps,S!==null){var k=_.type;pr(_.pendingProps.value,S.value)||(a!==null?a.push(k):a=[k])}}else if(_===Ce.current){if(S=_.alternate,S===null)throw Error(r(387));S.memoizedState.memoizedState!==_.memoizedState.memoizedState&&(a!==null?a.push(Yh):a=[Yh])}_=_.return}a!==null&&Ey(c,a,f,p),c.flags|=262144}function ip(a){for(a=a.firstContext;a!==null;){if(!pr(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function Ka(a){Ya=a,ds=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function Bn(a){return Ux(Ya,a)}function sp(a,c){return Ya===null&&Ka(a),Ux(a,c)}function Ux(a,c){var f=c._currentValue;if(c={context:c,memoizedValue:f,next:null},ds===null){if(a===null)throw Error(r(308));ds=c,a.dependencies={lanes:0,firstContext:c},a.flags|=524288}else ds=ds.next=c;return f}var wL=typeof AbortController<"u"?AbortController:function(){var a=[],c=this.signal={aborted:!1,addEventListener:function(f,p){a.push(p)}};this.abort=function(){c.aborted=!0,a.forEach(function(f){return f()})}},EL=n.unstable_scheduleCallback,xL=n.unstable_NormalPriority,cn={$$typeof:O,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function xy(){return{controller:new wL,data:new Map,refCount:0}}function bh(a){a.refCount--,a.refCount===0&&EL(xL,function(){a.controller.abort()})}var Th=null,Ay=0,ic=0,sc=null;function AL(a,c){if(Th===null){var f=Th=[];Ay=0,ic=Rv(),sc={status:"pending",value:void 0,then:function(p){f.push(p)}}}return Ay++,c.then(Fx,Fx),c}function Fx(){if(--Ay===0&&Th!==null){sc!==null&&(sc.status="fulfilled");var a=Th;Th=null,ic=0,sc=null;for(var c=0;c<a.length;c++)(0,a[c])()}}function SL(a,c){var f=[],p={status:"pending",value:null,reason:null,then:function(_){f.push(_)}};return a.then(function(){p.status="fulfilled",p.value=c;for(var _=0;_<f.length;_++)(0,f[_])(c)},function(_){for(p.status="rejected",p.reason=_,_=0;_<f.length;_++)(0,f[_])(void 0)}),p}var Bx=P.S;P.S=function(a,c){typeof c=="object"&&c!==null&&typeof c.then=="function"&&AL(a,c),Bx!==null&&Bx(a,c)};var Ga=Z(null);function Sy(){var a=Ga.current;return a!==null?a:Pt.pooledCache}function op(a,c){c===null?ae(Ga,Ga.current):ae(Ga,c.pool)}function Vx(){var a=Sy();return a===null?null:{parent:cn._currentValue,pool:a}}var wh=Error(r(460)),zx=Error(r(474)),ap=Error(r(542)),Ry={then:function(){}};function jx(a){return a=a.status,a==="fulfilled"||a==="rejected"}function lp(){}function Hx(a,c,f){switch(f=a[f],f===void 0?a.push(c):f!==c&&(c.then(lp,lp),c=f),c.status){case"fulfilled":return c.value;case"rejected":throw a=c.reason,Wx(a),a;default:if(typeof c.status=="string")c.then(lp,lp);else{if(a=Pt,a!==null&&100<a.shellSuspendCounter)throw Error(r(482));a=c,a.status="pending",a.then(function(p){if(c.status==="pending"){var _=c;_.status="fulfilled",_.value=p}},function(p){if(c.status==="pending"){var _=c;_.status="rejected",_.reason=p}})}switch(c.status){case"fulfilled":return c.value;case"rejected":throw a=c.reason,Wx(a),a}throw Eh=c,wh}}var Eh=null;function $x(){if(Eh===null)throw Error(r(459));var a=Eh;return Eh=null,a}function Wx(a){if(a===wh||a===ap)throw Error(r(483))}var fo=!1;function Cy(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Iy(a,c){a=a.updateQueue,c.updateQueue===a&&(c.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function po(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function go(a,c,f){var p=a.updateQueue;if(p===null)return null;if(p=p.shared,(_t&2)!==0){var _=p.pending;return _===null?c.next=c:(c.next=_.next,_.next=c),p.pending=c,c=ep(a),Mx(a,null,f),c}return Jd(a,p,c,f),ep(a)}function xh(a,c,f){if(c=c.updateQueue,c!==null&&(c=c.shared,(f&4194048)!==0)){var p=c.lanes;p&=a.pendingLanes,f|=p,c.lanes=f,eo(a,f)}}function Py(a,c){var f=a.updateQueue,p=a.alternate;if(p!==null&&(p=p.updateQueue,f===p)){var _=null,v=null;if(f=f.firstBaseUpdate,f!==null){do{var S={lane:f.lane,tag:f.tag,payload:f.payload,callback:null,next:null};v===null?_=v=S:v=v.next=S,f=f.next}while(f!==null);v===null?_=v=c:v=v.next=c}else _=v=c;f={baseState:p.baseState,firstBaseUpdate:_,lastBaseUpdate:v,shared:p.shared,callbacks:p.callbacks},a.updateQueue=f;return}a=f.lastBaseUpdate,a===null?f.firstBaseUpdate=c:a.next=c,f.lastBaseUpdate=c}var My=!1;function Ah(){if(My){var a=sc;if(a!==null)throw a}}function Sh(a,c,f,p){My=!1;var _=a.updateQueue;fo=!1;var v=_.firstBaseUpdate,S=_.lastBaseUpdate,k=_.shared.pending;if(k!==null){_.shared.pending=null;var K=k,ue=K.next;K.next=null,S===null?v=ue:S.next=ue,S=K;var ge=a.alternate;ge!==null&&(ge=ge.updateQueue,k=ge.lastBaseUpdate,k!==S&&(k===null?ge.firstBaseUpdate=ue:k.next=ue,ge.lastBaseUpdate=K))}if(v!==null){var ve=_.baseState;S=0,ge=ue=K=null,k=v;do{var he=k.lane&-536870913,fe=he!==k.lane;if(fe?(ct&he)===he:(p&he)===he){he!==0&&he===ic&&(My=!0),ge!==null&&(ge=ge.next={lane:0,tag:k.tag,payload:k.payload,callback:null,next:null});e:{var He=a,Fe=k;he=c;var Et=f;switch(Fe.tag){case 1:if(He=Fe.payload,typeof He=="function"){ve=He.call(Et,ve,he);break e}ve=He;break e;case 3:He.flags=He.flags&-65537|128;case 0:if(He=Fe.payload,he=typeof He=="function"?He.call(Et,ve,he):He,he==null)break e;ve=d({},ve,he);break e;case 2:fo=!0}}he=k.callback,he!==null&&(a.flags|=64,fe&&(a.flags|=8192),fe=_.callbacks,fe===null?_.callbacks=[he]:fe.push(he))}else fe={lane:he,tag:k.tag,payload:k.payload,callback:k.callback,next:null},ge===null?(ue=ge=fe,K=ve):ge=ge.next=fe,S|=he;if(k=k.next,k===null){if(k=_.shared.pending,k===null)break;fe=k,k=fe.next,fe.next=null,_.lastBaseUpdate=fe,_.shared.pending=null}}while(!0);ge===null&&(K=ve),_.baseState=K,_.firstBaseUpdate=ue,_.lastBaseUpdate=ge,v===null&&(_.shared.lanes=0),Eo|=S,a.lanes=S,a.memoizedState=ve}}function qx(a,c){if(typeof a!="function")throw Error(r(191,a));a.call(c)}function Xx(a,c){var f=a.callbacks;if(f!==null)for(a.callbacks=null,a=0;a<f.length;a++)qx(f[a],c)}var oc=Z(null),cp=Z(0);function Yx(a,c){a=Ts,ae(cp,a),ae(oc,c),Ts=a|c.baseLanes}function Oy(){ae(cp,Ts),ae(oc,oc.current)}function ky(){Ts=cp.current,ie(oc),ie(cp)}var mo=0,Ge=null,Tt=null,Qt=null,up=!1,ac=!1,Za=!1,hp=0,Rh=0,lc=null,RL=0;function Kt(){throw Error(r(321))}function Ny(a,c){if(c===null)return!1;for(var f=0;f<c.length&&f<a.length;f++)if(!pr(a[f],c[f]))return!1;return!0}function Dy(a,c,f,p,_,v){return mo=v,Ge=c,c.memoizedState=null,c.updateQueue=null,c.lanes=0,P.H=a===null||a.memoizedState===null?M1:O1,Za=!1,v=f(p,_),Za=!1,ac&&(v=Gx(c,f,p,_)),Kx(a),v}function Kx(a){P.H=_p;var c=Tt!==null&&Tt.next!==null;if(mo=0,Qt=Tt=Ge=null,up=!1,Rh=0,lc=null,c)throw Error(r(300));a===null||vn||(a=a.dependencies,a!==null&&ip(a)&&(vn=!0))}function Gx(a,c,f,p){Ge=a;var _=0;do{if(ac&&(lc=null),Rh=0,ac=!1,25<=_)throw Error(r(301));if(_+=1,Qt=Tt=null,a.updateQueue!=null){var v=a.updateQueue;v.lastEffect=null,v.events=null,v.stores=null,v.memoCache!=null&&(v.memoCache.index=0)}P.H=NL,v=c(f,p)}while(ac);return v}function CL(){var a=P.H,c=a.useState()[0];return c=typeof c.then=="function"?Ch(c):c,a=a.useState()[0],(Tt!==null?Tt.memoizedState:null)!==a&&(Ge.flags|=1024),c}function Ly(){var a=hp!==0;return hp=0,a}function Uy(a,c,f){c.updateQueue=a.updateQueue,c.flags&=-2053,a.lanes&=~f}function Fy(a){if(up){for(a=a.memoizedState;a!==null;){var c=a.queue;c!==null&&(c.pending=null),a=a.next}up=!1}mo=0,Qt=Tt=Ge=null,ac=!1,Rh=hp=0,lc=null}function sr(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Qt===null?Ge.memoizedState=Qt=a:Qt=Qt.next=a,Qt}function Jt(){if(Tt===null){var a=Ge.alternate;a=a!==null?a.memoizedState:null}else a=Tt.next;var c=Qt===null?Ge.memoizedState:Qt.next;if(c!==null)Qt=c,Tt=a;else{if(a===null)throw Ge.alternate===null?Error(r(467)):Error(r(310));Tt=a,a={memoizedState:Tt.memoizedState,baseState:Tt.baseState,baseQueue:Tt.baseQueue,queue:Tt.queue,next:null},Qt===null?Ge.memoizedState=Qt=a:Qt=Qt.next=a}return Qt}function By(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ch(a){var c=Rh;return Rh+=1,lc===null&&(lc=[]),a=Hx(lc,a,c),c=Ge,(Qt===null?c.memoizedState:Qt.next)===null&&(c=c.alternate,P.H=c===null||c.memoizedState===null?M1:O1),a}function fp(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return Ch(a);if(a.$$typeof===O)return Bn(a)}throw Error(r(438,String(a)))}function Vy(a){var c=null,f=Ge.updateQueue;if(f!==null&&(c=f.memoCache),c==null){var p=Ge.alternate;p!==null&&(p=p.updateQueue,p!==null&&(p=p.memoCache,p!=null&&(c={data:p.data.map(function(_){return _.slice()}),index:0})))}if(c==null&&(c={data:[],index:0}),f===null&&(f=By(),Ge.updateQueue=f),f.memoCache=c,f=c.data[c.index],f===void 0)for(f=c.data[c.index]=Array(a),p=0;p<a;p++)f[p]=j;return c.index++,f}function gs(a,c){return typeof c=="function"?c(a):c}function dp(a){var c=Jt();return zy(c,Tt,a)}function zy(a,c,f){var p=a.queue;if(p===null)throw Error(r(311));p.lastRenderedReducer=f;var _=a.baseQueue,v=p.pending;if(v!==null){if(_!==null){var S=_.next;_.next=v.next,v.next=S}c.baseQueue=_=v,p.pending=null}if(v=a.baseState,_===null)a.memoizedState=v;else{c=_.next;var k=S=null,K=null,ue=c,ge=!1;do{var ve=ue.lane&-536870913;if(ve!==ue.lane?(ct&ve)===ve:(mo&ve)===ve){var he=ue.revertLane;if(he===0)K!==null&&(K=K.next={lane:0,revertLane:0,action:ue.action,hasEagerState:ue.hasEagerState,eagerState:ue.eagerState,next:null}),ve===ic&&(ge=!0);else if((mo&he)===he){ue=ue.next,he===ic&&(ge=!0);continue}else ve={lane:0,revertLane:ue.revertLane,action:ue.action,hasEagerState:ue.hasEagerState,eagerState:ue.eagerState,next:null},K===null?(k=K=ve,S=v):K=K.next=ve,Ge.lanes|=he,Eo|=he;ve=ue.action,Za&&f(v,ve),v=ue.hasEagerState?ue.eagerState:f(v,ve)}else he={lane:ve,revertLane:ue.revertLane,action:ue.action,hasEagerState:ue.hasEagerState,eagerState:ue.eagerState,next:null},K===null?(k=K=he,S=v):K=K.next=he,Ge.lanes|=ve,Eo|=ve;ue=ue.next}while(ue!==null&&ue!==c);if(K===null?S=v:K.next=k,!pr(v,a.memoizedState)&&(vn=!0,ge&&(f=sc,f!==null)))throw f;a.memoizedState=v,a.baseState=S,a.baseQueue=K,p.lastRenderedState=v}return _===null&&(p.lanes=0),[a.memoizedState,p.dispatch]}function jy(a){var c=Jt(),f=c.queue;if(f===null)throw Error(r(311));f.lastRenderedReducer=a;var p=f.dispatch,_=f.pending,v=c.memoizedState;if(_!==null){f.pending=null;var S=_=_.next;do v=a(v,S.action),S=S.next;while(S!==_);pr(v,c.memoizedState)||(vn=!0),c.memoizedState=v,c.baseQueue===null&&(c.baseState=v),f.lastRenderedState=v}return[v,p]}function Zx(a,c,f){var p=Ge,_=Jt(),v=ft;if(v){if(f===void 0)throw Error(r(407));f=f()}else f=c();var S=!pr((Tt||_).memoizedState,f);S&&(_.memoizedState=f,vn=!0),_=_.queue;var k=e1.bind(null,p,_,a);if(Ih(2048,8,k,[a]),_.getSnapshot!==c||S||Qt!==null&&Qt.memoizedState.tag&1){if(p.flags|=2048,cc(9,pp(),Jx.bind(null,p,_,f,c),null),Pt===null)throw Error(r(349));v||(mo&124)!==0||Qx(p,c,f)}return f}function Qx(a,c,f){a.flags|=16384,a={getSnapshot:c,value:f},c=Ge.updateQueue,c===null?(c=By(),Ge.updateQueue=c,c.stores=[a]):(f=c.stores,f===null?c.stores=[a]:f.push(a))}function Jx(a,c,f,p){c.value=f,c.getSnapshot=p,t1(c)&&n1(a)}function e1(a,c,f){return f(function(){t1(c)&&n1(a)})}function t1(a){var c=a.getSnapshot;a=a.value;try{var f=c();return!pr(a,f)}catch{return!0}}function n1(a){var c=ec(a,2);c!==null&&br(c,a,2)}function Hy(a){var c=sr();if(typeof a=="function"){var f=a;if(a=f(),Za){Cr(!0);try{f()}finally{Cr(!1)}}}return c.memoizedState=c.baseState=a,c.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:gs,lastRenderedState:a},c}function r1(a,c,f,p){return a.baseState=f,zy(a,Tt,typeof p=="function"?p:gs)}function IL(a,c,f,p,_){if(mp(a))throw Error(r(485));if(a=c.action,a!==null){var v={payload:_,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(S){v.listeners.push(S)}};P.T!==null?f(!0):v.isTransition=!1,p(v),f=c.pending,f===null?(v.next=c.pending=v,i1(c,v)):(v.next=f.next,c.pending=f.next=v)}}function i1(a,c){var f=c.action,p=c.payload,_=a.state;if(c.isTransition){var v=P.T,S={};P.T=S;try{var k=f(_,p),K=P.S;K!==null&&K(S,k),s1(a,c,k)}catch(ue){$y(a,c,ue)}finally{P.T=v}}else try{v=f(_,p),s1(a,c,v)}catch(ue){$y(a,c,ue)}}function s1(a,c,f){f!==null&&typeof f=="object"&&typeof f.then=="function"?f.then(function(p){o1(a,c,p)},function(p){return $y(a,c,p)}):o1(a,c,f)}function o1(a,c,f){c.status="fulfilled",c.value=f,a1(c),a.state=f,c=a.pending,c!==null&&(f=c.next,f===c?a.pending=null:(f=f.next,c.next=f,i1(a,f)))}function $y(a,c,f){var p=a.pending;if(a.pending=null,p!==null){p=p.next;do c.status="rejected",c.reason=f,a1(c),c=c.next;while(c!==p)}a.action=null}function a1(a){a=a.listeners;for(var c=0;c<a.length;c++)(0,a[c])()}function l1(a,c){return c}function c1(a,c){if(ft){var f=Pt.formState;if(f!==null){e:{var p=Ge;if(ft){if(zt){t:{for(var _=zt,v=Ri;_.nodeType!==8;){if(!v){_=null;break t}if(_=ii(_.nextSibling),_===null){_=null;break t}}v=_.data,_=v==="F!"||v==="F"?_:null}if(_){zt=ii(_.nextSibling),p=_.data==="F!";break e}}Xa(p)}p=!1}p&&(c=f[0])}}return f=sr(),f.memoizedState=f.baseState=c,p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:l1,lastRenderedState:c},f.queue=p,f=C1.bind(null,Ge,p),p.dispatch=f,p=Hy(!1),v=Ky.bind(null,Ge,!1,p.queue),p=sr(),_={state:c,dispatch:null,action:a,pending:null},p.queue=_,f=IL.bind(null,Ge,_,v,f),_.dispatch=f,p.memoizedState=a,[c,f,!1]}function u1(a){var c=Jt();return h1(c,Tt,a)}function h1(a,c,f){if(c=zy(a,c,l1)[0],a=dp(gs)[0],typeof c=="object"&&c!==null&&typeof c.then=="function")try{var p=Ch(c)}catch(S){throw S===wh?ap:S}else p=c;c=Jt();var _=c.queue,v=_.dispatch;return f!==c.memoizedState&&(Ge.flags|=2048,cc(9,pp(),PL.bind(null,_,f),null)),[p,v,a]}function PL(a,c){a.action=c}function f1(a){var c=Jt(),f=Tt;if(f!==null)return h1(c,f,a);Jt(),c=c.memoizedState,f=Jt();var p=f.queue.dispatch;return f.memoizedState=a,[c,p,!1]}function cc(a,c,f,p){return a={tag:a,create:f,deps:p,inst:c,next:null},c=Ge.updateQueue,c===null&&(c=By(),Ge.updateQueue=c),f=c.lastEffect,f===null?c.lastEffect=a.next=a:(p=f.next,f.next=a,a.next=p,c.lastEffect=a),a}function pp(){return{destroy:void 0,resource:void 0}}function d1(){return Jt().memoizedState}function gp(a,c,f,p){var _=sr();p=p===void 0?null:p,Ge.flags|=a,_.memoizedState=cc(1|c,pp(),f,p)}function Ih(a,c,f,p){var _=Jt();p=p===void 0?null:p;var v=_.memoizedState.inst;Tt!==null&&p!==null&&Ny(p,Tt.memoizedState.deps)?_.memoizedState=cc(c,v,f,p):(Ge.flags|=a,_.memoizedState=cc(1|c,v,f,p))}function p1(a,c){gp(8390656,8,a,c)}function g1(a,c){Ih(2048,8,a,c)}function m1(a,c){return Ih(4,2,a,c)}function _1(a,c){return Ih(4,4,a,c)}function y1(a,c){if(typeof c=="function"){a=a();var f=c(a);return function(){typeof f=="function"?f():c(null)}}if(c!=null)return a=a(),c.current=a,function(){c.current=null}}function v1(a,c,f){f=f!=null?f.concat([a]):null,Ih(4,4,y1.bind(null,c,a),f)}function Wy(){}function b1(a,c){var f=Jt();c=c===void 0?null:c;var p=f.memoizedState;return c!==null&&Ny(c,p[1])?p[0]:(f.memoizedState=[a,c],a)}function T1(a,c){var f=Jt();c=c===void 0?null:c;var p=f.memoizedState;if(c!==null&&Ny(c,p[1]))return p[0];if(p=a(),Za){Cr(!0);try{a()}finally{Cr(!1)}}return f.memoizedState=[p,c],p}function qy(a,c,f){return f===void 0||(mo&1073741824)!==0?a.memoizedState=c:(a.memoizedState=f,a=xA(),Ge.lanes|=a,Eo|=a,f)}function w1(a,c,f,p){return pr(f,c)?f:oc.current!==null?(a=qy(a,f,p),pr(a,c)||(vn=!0),a):(mo&42)===0?(vn=!0,a.memoizedState=f):(a=xA(),Ge.lanes|=a,Eo|=a,c)}function E1(a,c,f,p,_){var v=q.p;q.p=v!==0&&8>v?v:8;var S=P.T,k={};P.T=k,Ky(a,!1,c,f);try{var K=_(),ue=P.S;if(ue!==null&&ue(k,K),K!==null&&typeof K=="object"&&typeof K.then=="function"){var ge=SL(K,p);Ph(a,c,ge,vr(a))}else Ph(a,c,p,vr(a))}catch(ve){Ph(a,c,{then:function(){},status:"rejected",reason:ve},vr())}finally{q.p=v,P.T=S}}function ML(){}function Xy(a,c,f,p){if(a.tag!==5)throw Error(r(476));var _=x1(a).queue;E1(a,_,c,U,f===null?ML:function(){return A1(a),f(p)})}function x1(a){var c=a.memoizedState;if(c!==null)return c;c={memoizedState:U,baseState:U,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:gs,lastRenderedState:U},next:null};var f={};return c.next={memoizedState:f,baseState:f,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:gs,lastRenderedState:f},next:null},a.memoizedState=c,a=a.alternate,a!==null&&(a.memoizedState=c),c}function A1(a){var c=x1(a).next.queue;Ph(a,c,{},vr())}function Yy(){return Bn(Yh)}function S1(){return Jt().memoizedState}function R1(){return Jt().memoizedState}function OL(a){for(var c=a.return;c!==null;){switch(c.tag){case 24:case 3:var f=vr();a=po(f);var p=go(c,a,f);p!==null&&(br(p,c,f),xh(p,c,f)),c={cache:xy()},a.payload=c;return}c=c.return}}function kL(a,c,f){var p=vr();f={lane:p,revertLane:0,action:f,hasEagerState:!1,eagerState:null,next:null},mp(a)?I1(c,f):(f=py(a,c,f,p),f!==null&&(br(f,a,p),P1(f,c,p)))}function C1(a,c,f){var p=vr();Ph(a,c,f,p)}function Ph(a,c,f,p){var _={lane:p,revertLane:0,action:f,hasEagerState:!1,eagerState:null,next:null};if(mp(a))I1(c,_);else{var v=a.alternate;if(a.lanes===0&&(v===null||v.lanes===0)&&(v=c.lastRenderedReducer,v!==null))try{var S=c.lastRenderedState,k=v(S,f);if(_.hasEagerState=!0,_.eagerState=k,pr(k,S))return Jd(a,c,_,0),Pt===null&&Qd(),!1}catch{}finally{}if(f=py(a,c,_,p),f!==null)return br(f,a,p),P1(f,c,p),!0}return!1}function Ky(a,c,f,p){if(p={lane:2,revertLane:Rv(),action:p,hasEagerState:!1,eagerState:null,next:null},mp(a)){if(c)throw Error(r(479))}else c=py(a,f,p,2),c!==null&&br(c,a,2)}function mp(a){var c=a.alternate;return a===Ge||c!==null&&c===Ge}function I1(a,c){ac=up=!0;var f=a.pending;f===null?c.next=c:(c.next=f.next,f.next=c),a.pending=c}function P1(a,c,f){if((f&4194048)!==0){var p=c.lanes;p&=a.pendingLanes,f|=p,c.lanes=f,eo(a,f)}}var _p={readContext:Bn,use:fp,useCallback:Kt,useContext:Kt,useEffect:Kt,useImperativeHandle:Kt,useLayoutEffect:Kt,useInsertionEffect:Kt,useMemo:Kt,useReducer:Kt,useRef:Kt,useState:Kt,useDebugValue:Kt,useDeferredValue:Kt,useTransition:Kt,useSyncExternalStore:Kt,useId:Kt,useHostTransitionStatus:Kt,useFormState:Kt,useActionState:Kt,useOptimistic:Kt,useMemoCache:Kt,useCacheRefresh:Kt},M1={readContext:Bn,use:fp,useCallback:function(a,c){return sr().memoizedState=[a,c===void 0?null:c],a},useContext:Bn,useEffect:p1,useImperativeHandle:function(a,c,f){f=f!=null?f.concat([a]):null,gp(4194308,4,y1.bind(null,c,a),f)},useLayoutEffect:function(a,c){return gp(4194308,4,a,c)},useInsertionEffect:function(a,c){gp(4,2,a,c)},useMemo:function(a,c){var f=sr();c=c===void 0?null:c;var p=a();if(Za){Cr(!0);try{a()}finally{Cr(!1)}}return f.memoizedState=[p,c],p},useReducer:function(a,c,f){var p=sr();if(f!==void 0){var _=f(c);if(Za){Cr(!0);try{f(c)}finally{Cr(!1)}}}else _=c;return p.memoizedState=p.baseState=_,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:_},p.queue=a,a=a.dispatch=kL.bind(null,Ge,a),[p.memoizedState,a]},useRef:function(a){var c=sr();return a={current:a},c.memoizedState=a},useState:function(a){a=Hy(a);var c=a.queue,f=C1.bind(null,Ge,c);return c.dispatch=f,[a.memoizedState,f]},useDebugValue:Wy,useDeferredValue:function(a,c){var f=sr();return qy(f,a,c)},useTransition:function(){var a=Hy(!1);return a=E1.bind(null,Ge,a.queue,!0,!1),sr().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,c,f){var p=Ge,_=sr();if(ft){if(f===void 0)throw Error(r(407));f=f()}else{if(f=c(),Pt===null)throw Error(r(349));(ct&124)!==0||Qx(p,c,f)}_.memoizedState=f;var v={value:f,getSnapshot:c};return _.queue=v,p1(e1.bind(null,p,v,a),[a]),p.flags|=2048,cc(9,pp(),Jx.bind(null,p,v,f,c),null),f},useId:function(){var a=sr(),c=Pt.identifierPrefix;if(ft){var f=fs,p=hs;f=(p&~(1<<32-Zn(p)-1)).toString(32)+f,c=""+c+"R"+f,f=hp++,0<f&&(c+="H"+f.toString(32)),c+=""}else f=RL++,c=""+c+"r"+f.toString(32)+"";return a.memoizedState=c},useHostTransitionStatus:Yy,useFormState:c1,useActionState:c1,useOptimistic:function(a){var c=sr();c.memoizedState=c.baseState=a;var f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return c.queue=f,c=Ky.bind(null,Ge,!0,f),f.dispatch=c,[a,c]},useMemoCache:Vy,useCacheRefresh:function(){return sr().memoizedState=OL.bind(null,Ge)}},O1={readContext:Bn,use:fp,useCallback:b1,useContext:Bn,useEffect:g1,useImperativeHandle:v1,useInsertionEffect:m1,useLayoutEffect:_1,useMemo:T1,useReducer:dp,useRef:d1,useState:function(){return dp(gs)},useDebugValue:Wy,useDeferredValue:function(a,c){var f=Jt();return w1(f,Tt.memoizedState,a,c)},useTransition:function(){var a=dp(gs)[0],c=Jt().memoizedState;return[typeof a=="boolean"?a:Ch(a),c]},useSyncExternalStore:Zx,useId:S1,useHostTransitionStatus:Yy,useFormState:u1,useActionState:u1,useOptimistic:function(a,c){var f=Jt();return r1(f,Tt,a,c)},useMemoCache:Vy,useCacheRefresh:R1},NL={readContext:Bn,use:fp,useCallback:b1,useContext:Bn,useEffect:g1,useImperativeHandle:v1,useInsertionEffect:m1,useLayoutEffect:_1,useMemo:T1,useReducer:jy,useRef:d1,useState:function(){return jy(gs)},useDebugValue:Wy,useDeferredValue:function(a,c){var f=Jt();return Tt===null?qy(f,a,c):w1(f,Tt.memoizedState,a,c)},useTransition:function(){var a=jy(gs)[0],c=Jt().memoizedState;return[typeof a=="boolean"?a:Ch(a),c]},useSyncExternalStore:Zx,useId:S1,useHostTransitionStatus:Yy,useFormState:f1,useActionState:f1,useOptimistic:function(a,c){var f=Jt();return Tt!==null?r1(f,Tt,a,c):(f.baseState=a,[a,f.queue.dispatch])},useMemoCache:Vy,useCacheRefresh:R1},uc=null,Mh=0;function yp(a){var c=Mh;return Mh+=1,uc===null&&(uc=[]),Hx(uc,a,c)}function Oh(a,c){c=c.props.ref,a.ref=c!==void 0?c:null}function vp(a,c){throw c.$$typeof===g?Error(r(525)):(a=Object.prototype.toString.call(c),Error(r(31,a==="[object Object]"?"object with keys {"+Object.keys(c).join(", ")+"}":a)))}function k1(a){var c=a._init;return c(a._payload)}function N1(a){function c(ne,Q){if(a){var le=ne.deletions;le===null?(ne.deletions=[Q],ne.flags|=16):le.push(Q)}}function f(ne,Q){if(!a)return null;for(;Q!==null;)c(ne,Q),Q=Q.sibling;return null}function p(ne){for(var Q=new Map;ne!==null;)ne.key!==null?Q.set(ne.key,ne):Q.set(ne.index,ne),ne=ne.sibling;return Q}function _(ne,Q){return ne=us(ne,Q),ne.index=0,ne.sibling=null,ne}function v(ne,Q,le){return ne.index=le,a?(le=ne.alternate,le!==null?(le=le.index,le<Q?(ne.flags|=67108866,Q):le):(ne.flags|=67108866,Q)):(ne.flags|=1048576,Q)}function S(ne){return a&&ne.alternate===null&&(ne.flags|=67108866),ne}function k(ne,Q,le,_e){return Q===null||Q.tag!==6?(Q=my(le,ne.mode,_e),Q.return=ne,Q):(Q=_(Q,le),Q.return=ne,Q)}function K(ne,Q,le,_e){var Oe=le.type;return Oe===w?ge(ne,Q,le.props.children,_e,le.key):Q!==null&&(Q.elementType===Oe||typeof Oe=="object"&&Oe!==null&&Oe.$$typeof===I&&k1(Oe)===Q.type)?(Q=_(Q,le.props),Oh(Q,le),Q.return=ne,Q):(Q=tp(le.type,le.key,le.props,null,ne.mode,_e),Oh(Q,le),Q.return=ne,Q)}function ue(ne,Q,le,_e){return Q===null||Q.tag!==4||Q.stateNode.containerInfo!==le.containerInfo||Q.stateNode.implementation!==le.implementation?(Q=_y(le,ne.mode,_e),Q.return=ne,Q):(Q=_(Q,le.children||[]),Q.return=ne,Q)}function ge(ne,Q,le,_e,Oe){return Q===null||Q.tag!==7?(Q=Ha(le,ne.mode,_e,Oe),Q.return=ne,Q):(Q=_(Q,le),Q.return=ne,Q)}function ve(ne,Q,le){if(typeof Q=="string"&&Q!==""||typeof Q=="number"||typeof Q=="bigint")return Q=my(""+Q,ne.mode,le),Q.return=ne,Q;if(typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case y:return le=tp(Q.type,Q.key,Q.props,null,ne.mode,le),Oh(le,Q),le.return=ne,le;case b:return Q=_y(Q,ne.mode,le),Q.return=ne,Q;case I:var _e=Q._init;return Q=_e(Q._payload),ve(ne,Q,le)}if(xe(Q)||Y(Q))return Q=Ha(Q,ne.mode,le,null),Q.return=ne,Q;if(typeof Q.then=="function")return ve(ne,yp(Q),le);if(Q.$$typeof===O)return ve(ne,sp(ne,Q),le);vp(ne,Q)}return null}function he(ne,Q,le,_e){var Oe=Q!==null?Q.key:null;if(typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint")return Oe!==null?null:k(ne,Q,""+le,_e);if(typeof le=="object"&&le!==null){switch(le.$$typeof){case y:return le.key===Oe?K(ne,Q,le,_e):null;case b:return le.key===Oe?ue(ne,Q,le,_e):null;case I:return Oe=le._init,le=Oe(le._payload),he(ne,Q,le,_e)}if(xe(le)||Y(le))return Oe!==null?null:ge(ne,Q,le,_e,null);if(typeof le.then=="function")return he(ne,Q,yp(le),_e);if(le.$$typeof===O)return he(ne,Q,sp(ne,le),_e);vp(ne,le)}return null}function fe(ne,Q,le,_e,Oe){if(typeof _e=="string"&&_e!==""||typeof _e=="number"||typeof _e=="bigint")return ne=ne.get(le)||null,k(Q,ne,""+_e,Oe);if(typeof _e=="object"&&_e!==null){switch(_e.$$typeof){case y:return ne=ne.get(_e.key===null?le:_e.key)||null,K(Q,ne,_e,Oe);case b:return ne=ne.get(_e.key===null?le:_e.key)||null,ue(Q,ne,_e,Oe);case I:var Qe=_e._init;return _e=Qe(_e._payload),fe(ne,Q,le,_e,Oe)}if(xe(_e)||Y(_e))return ne=ne.get(le)||null,ge(Q,ne,_e,Oe,null);if(typeof _e.then=="function")return fe(ne,Q,le,yp(_e),Oe);if(_e.$$typeof===O)return fe(ne,Q,le,sp(Q,_e),Oe);vp(Q,_e)}return null}function He(ne,Q,le,_e){for(var Oe=null,Qe=null,De=Q,Be=Q=0,Tn=null;De!==null&&Be<le.length;Be++){De.index>Be?(Tn=De,De=null):Tn=De.sibling;var ht=he(ne,De,le[Be],_e);if(ht===null){De===null&&(De=Tn);break}a&&De&&ht.alternate===null&&c(ne,De),Q=v(ht,Q,Be),Qe===null?Oe=ht:Qe.sibling=ht,Qe=ht,De=Tn}if(Be===le.length)return f(ne,De),ft&&Wa(ne,Be),Oe;if(De===null){for(;Be<le.length;Be++)De=ve(ne,le[Be],_e),De!==null&&(Q=v(De,Q,Be),Qe===null?Oe=De:Qe.sibling=De,Qe=De);return ft&&Wa(ne,Be),Oe}for(De=p(De);Be<le.length;Be++)Tn=fe(De,ne,Be,le[Be],_e),Tn!==null&&(a&&Tn.alternate!==null&&De.delete(Tn.key===null?Be:Tn.key),Q=v(Tn,Q,Be),Qe===null?Oe=Tn:Qe.sibling=Tn,Qe=Tn);return a&&De.forEach(function(Oo){return c(ne,Oo)}),ft&&Wa(ne,Be),Oe}function Fe(ne,Q,le,_e){if(le==null)throw Error(r(151));for(var Oe=null,Qe=null,De=Q,Be=Q=0,Tn=null,ht=le.next();De!==null&&!ht.done;Be++,ht=le.next()){De.index>Be?(Tn=De,De=null):Tn=De.sibling;var Oo=he(ne,De,ht.value,_e);if(Oo===null){De===null&&(De=Tn);break}a&&De&&Oo.alternate===null&&c(ne,De),Q=v(Oo,Q,Be),Qe===null?Oe=Oo:Qe.sibling=Oo,Qe=Oo,De=Tn}if(ht.done)return f(ne,De),ft&&Wa(ne,Be),Oe;if(De===null){for(;!ht.done;Be++,ht=le.next())ht=ve(ne,ht.value,_e),ht!==null&&(Q=v(ht,Q,Be),Qe===null?Oe=ht:Qe.sibling=ht,Qe=ht);return ft&&Wa(ne,Be),Oe}for(De=p(De);!ht.done;Be++,ht=le.next())ht=fe(De,ne,Be,ht.value,_e),ht!==null&&(a&&ht.alternate!==null&&De.delete(ht.key===null?Be:ht.key),Q=v(ht,Q,Be),Qe===null?Oe=ht:Qe.sibling=ht,Qe=ht);return a&&De.forEach(function(D6){return c(ne,D6)}),ft&&Wa(ne,Be),Oe}function Et(ne,Q,le,_e){if(typeof le=="object"&&le!==null&&le.type===w&&le.key===null&&(le=le.props.children),typeof le=="object"&&le!==null){switch(le.$$typeof){case y:e:{for(var Oe=le.key;Q!==null;){if(Q.key===Oe){if(Oe=le.type,Oe===w){if(Q.tag===7){f(ne,Q.sibling),_e=_(Q,le.props.children),_e.return=ne,ne=_e;break e}}else if(Q.elementType===Oe||typeof Oe=="object"&&Oe!==null&&Oe.$$typeof===I&&k1(Oe)===Q.type){f(ne,Q.sibling),_e=_(Q,le.props),Oh(_e,le),_e.return=ne,ne=_e;break e}f(ne,Q);break}else c(ne,Q);Q=Q.sibling}le.type===w?(_e=Ha(le.props.children,ne.mode,_e,le.key),_e.return=ne,ne=_e):(_e=tp(le.type,le.key,le.props,null,ne.mode,_e),Oh(_e,le),_e.return=ne,ne=_e)}return S(ne);case b:e:{for(Oe=le.key;Q!==null;){if(Q.key===Oe)if(Q.tag===4&&Q.stateNode.containerInfo===le.containerInfo&&Q.stateNode.implementation===le.implementation){f(ne,Q.sibling),_e=_(Q,le.children||[]),_e.return=ne,ne=_e;break e}else{f(ne,Q);break}else c(ne,Q);Q=Q.sibling}_e=_y(le,ne.mode,_e),_e.return=ne,ne=_e}return S(ne);case I:return Oe=le._init,le=Oe(le._payload),Et(ne,Q,le,_e)}if(xe(le))return He(ne,Q,le,_e);if(Y(le)){if(Oe=Y(le),typeof Oe!="function")throw Error(r(150));return le=Oe.call(le),Fe(ne,Q,le,_e)}if(typeof le.then=="function")return Et(ne,Q,yp(le),_e);if(le.$$typeof===O)return Et(ne,Q,sp(ne,le),_e);vp(ne,le)}return typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint"?(le=""+le,Q!==null&&Q.tag===6?(f(ne,Q.sibling),_e=_(Q,le),_e.return=ne,ne=_e):(f(ne,Q),_e=my(le,ne.mode,_e),_e.return=ne,ne=_e),S(ne)):f(ne,Q)}return function(ne,Q,le,_e){try{Mh=0;var Oe=Et(ne,Q,le,_e);return uc=null,Oe}catch(De){if(De===wh||De===ap)throw De;var Qe=gr(29,De,null,ne.mode);return Qe.lanes=_e,Qe.return=ne,Qe}finally{}}}var hc=N1(!0),D1=N1(!1),Ur=Z(null),Ci=null;function _o(a){var c=a.alternate;ae(un,un.current&1),ae(Ur,a),Ci===null&&(c===null||oc.current!==null||c.memoizedState!==null)&&(Ci=a)}function L1(a){if(a.tag===22){if(ae(un,un.current),ae(Ur,a),Ci===null){var c=a.alternate;c!==null&&c.memoizedState!==null&&(Ci=a)}}else yo()}function yo(){ae(un,un.current),ae(Ur,Ur.current)}function ms(a){ie(Ur),Ci===a&&(Ci=null),ie(un)}var un=Z(0);function bp(a){for(var c=a;c!==null;){if(c.tag===13){var f=c.memoizedState;if(f!==null&&(f=f.dehydrated,f===null||f.data==="$?"||Bv(f)))return c}else if(c.tag===19&&c.memoizedProps.revealOrder!==void 0){if((c.flags&128)!==0)return c}else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===a)break;for(;c.sibling===null;){if(c.return===null||c.return===a)return null;c=c.return}c.sibling.return=c.return,c=c.sibling}return null}function Gy(a,c,f,p){c=a.memoizedState,f=f(p,c),f=f==null?c:d({},c,f),a.memoizedState=f,a.lanes===0&&(a.updateQueue.baseState=f)}var Zy={enqueueSetState:function(a,c,f){a=a._reactInternals;var p=vr(),_=po(p);_.payload=c,f!=null&&(_.callback=f),c=go(a,_,p),c!==null&&(br(c,a,p),xh(c,a,p))},enqueueReplaceState:function(a,c,f){a=a._reactInternals;var p=vr(),_=po(p);_.tag=1,_.payload=c,f!=null&&(_.callback=f),c=go(a,_,p),c!==null&&(br(c,a,p),xh(c,a,p))},enqueueForceUpdate:function(a,c){a=a._reactInternals;var f=vr(),p=po(f);p.tag=2,c!=null&&(p.callback=c),c=go(a,p,f),c!==null&&(br(c,a,f),xh(c,a,f))}};function U1(a,c,f,p,_,v,S){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(p,v,S):c.prototype&&c.prototype.isPureReactComponent?!ph(f,p)||!ph(_,v):!0}function F1(a,c,f,p){a=c.state,typeof c.componentWillReceiveProps=="function"&&c.componentWillReceiveProps(f,p),typeof c.UNSAFE_componentWillReceiveProps=="function"&&c.UNSAFE_componentWillReceiveProps(f,p),c.state!==a&&Zy.enqueueReplaceState(c,c.state,null)}function Qa(a,c){var f=c;if("ref"in c){f={};for(var p in c)p!=="ref"&&(f[p]=c[p])}if(a=a.defaultProps){f===c&&(f=d({},f));for(var _ in a)f[_]===void 0&&(f[_]=a[_])}return f}var Tp=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var c=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(c))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)};function B1(a){Tp(a)}function V1(a){console.error(a)}function z1(a){Tp(a)}function wp(a,c){try{var f=a.onUncaughtError;f(c.value,{componentStack:c.stack})}catch(p){setTimeout(function(){throw p})}}function j1(a,c,f){try{var p=a.onCaughtError;p(f.value,{componentStack:f.stack,errorBoundary:c.tag===1?c.stateNode:null})}catch(_){setTimeout(function(){throw _})}}function Qy(a,c,f){return f=po(f),f.tag=3,f.payload={element:null},f.callback=function(){wp(a,c)},f}function H1(a){return a=po(a),a.tag=3,a}function $1(a,c,f,p){var _=f.type.getDerivedStateFromError;if(typeof _=="function"){var v=p.value;a.payload=function(){return _(v)},a.callback=function(){j1(c,f,p)}}var S=f.stateNode;S!==null&&typeof S.componentDidCatch=="function"&&(a.callback=function(){j1(c,f,p),typeof _!="function"&&(xo===null?xo=new Set([this]):xo.add(this));var k=p.stack;this.componentDidCatch(p.value,{componentStack:k!==null?k:""})})}function DL(a,c,f,p,_){if(f.flags|=32768,p!==null&&typeof p=="object"&&typeof p.then=="function"){if(c=f.alternate,c!==null&&vh(c,f,_,!0),f=Ur.current,f!==null){switch(f.tag){case 13:return Ci===null?wv():f.alternate===null&&jt===0&&(jt=3),f.flags&=-257,f.flags|=65536,f.lanes=_,p===Ry?f.flags|=16384:(c=f.updateQueue,c===null?f.updateQueue=new Set([p]):c.add(p),xv(a,p,_)),!1;case 22:return f.flags|=65536,p===Ry?f.flags|=16384:(c=f.updateQueue,c===null?(c={transitions:null,markerInstances:null,retryQueue:new Set([p])},f.updateQueue=c):(f=c.retryQueue,f===null?c.retryQueue=new Set([p]):f.add(p)),xv(a,p,_)),!1}throw Error(r(435,f.tag))}return xv(a,p,_),wv(),!1}if(ft)return c=Ur.current,c!==null?((c.flags&65536)===0&&(c.flags|=256),c.flags|=65536,c.lanes=_,p!==by&&(a=Error(r(422),{cause:p}),yh(kr(a,f)))):(p!==by&&(c=Error(r(423),{cause:p}),yh(kr(c,f))),a=a.current.alternate,a.flags|=65536,_&=-_,a.lanes|=_,p=kr(p,f),_=Qy(a.stateNode,p,_),Py(a,_),jt!==4&&(jt=2)),!1;var v=Error(r(520),{cause:p});if(v=kr(v,f),Bh===null?Bh=[v]:Bh.push(v),jt!==4&&(jt=2),c===null)return!0;p=kr(p,f),f=c;do{switch(f.tag){case 3:return f.flags|=65536,a=_&-_,f.lanes|=a,a=Qy(f.stateNode,p,a),Py(f,a),!1;case 1:if(c=f.type,v=f.stateNode,(f.flags&128)===0&&(typeof c.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(xo===null||!xo.has(v))))return f.flags|=65536,_&=-_,f.lanes|=_,_=H1(_),$1(_,a,f,p),Py(f,_),!1}f=f.return}while(f!==null);return!1}var W1=Error(r(461)),vn=!1;function Rn(a,c,f,p){c.child=a===null?D1(c,null,f,p):hc(c,a.child,f,p)}function q1(a,c,f,p,_){f=f.render;var v=c.ref;if("ref"in p){var S={};for(var k in p)k!=="ref"&&(S[k]=p[k])}else S=p;return Ka(c),p=Dy(a,c,f,S,v,_),k=Ly(),a!==null&&!vn?(Uy(a,c,_),_s(a,c,_)):(ft&&k&&yy(c),c.flags|=1,Rn(a,c,p,_),c.child)}function X1(a,c,f,p,_){if(a===null){var v=f.type;return typeof v=="function"&&!gy(v)&&v.defaultProps===void 0&&f.compare===null?(c.tag=15,c.type=v,Y1(a,c,v,p,_)):(a=tp(f.type,null,p,c,c.mode,_),a.ref=c.ref,a.return=c,c.child=a)}if(v=a.child,!ov(a,_)){var S=v.memoizedProps;if(f=f.compare,f=f!==null?f:ph,f(S,p)&&a.ref===c.ref)return _s(a,c,_)}return c.flags|=1,a=us(v,p),a.ref=c.ref,a.return=c,c.child=a}function Y1(a,c,f,p,_){if(a!==null){var v=a.memoizedProps;if(ph(v,p)&&a.ref===c.ref)if(vn=!1,c.pendingProps=p=v,ov(a,_))(a.flags&131072)!==0&&(vn=!0);else return c.lanes=a.lanes,_s(a,c,_)}return Jy(a,c,f,p,_)}function K1(a,c,f){var p=c.pendingProps,_=p.children,v=a!==null?a.memoizedState:null;if(p.mode==="hidden"){if((c.flags&128)!==0){if(p=v!==null?v.baseLanes|f:f,a!==null){for(_=c.child=a.child,v=0;_!==null;)v=v|_.lanes|_.childLanes,_=_.sibling;c.childLanes=v&~p}else c.childLanes=0,c.child=null;return G1(a,c,p,f)}if((f&536870912)!==0)c.memoizedState={baseLanes:0,cachePool:null},a!==null&&op(c,v!==null?v.cachePool:null),v!==null?Yx(c,v):Oy(),L1(c);else return c.lanes=c.childLanes=536870912,G1(a,c,v!==null?v.baseLanes|f:f,f)}else v!==null?(op(c,v.cachePool),Yx(c,v),yo(),c.memoizedState=null):(a!==null&&op(c,null),Oy(),yo());return Rn(a,c,_,f),c.child}function G1(a,c,f,p){var _=Sy();return _=_===null?null:{parent:cn._currentValue,pool:_},c.memoizedState={baseLanes:f,cachePool:_},a!==null&&op(c,null),Oy(),L1(c),a!==null&&vh(a,c,p,!0),null}function Ep(a,c){var f=c.ref;if(f===null)a!==null&&a.ref!==null&&(c.flags|=4194816);else{if(typeof f!="function"&&typeof f!="object")throw Error(r(284));(a===null||a.ref!==f)&&(c.flags|=4194816)}}function Jy(a,c,f,p,_){return Ka(c),f=Dy(a,c,f,p,void 0,_),p=Ly(),a!==null&&!vn?(Uy(a,c,_),_s(a,c,_)):(ft&&p&&yy(c),c.flags|=1,Rn(a,c,f,_),c.child)}function Z1(a,c,f,p,_,v){return Ka(c),c.updateQueue=null,f=Gx(c,p,f,_),Kx(a),p=Ly(),a!==null&&!vn?(Uy(a,c,v),_s(a,c,v)):(ft&&p&&yy(c),c.flags|=1,Rn(a,c,f,v),c.child)}function Q1(a,c,f,p,_){if(Ka(c),c.stateNode===null){var v=tc,S=f.contextType;typeof S=="object"&&S!==null&&(v=Bn(S)),v=new f(p,v),c.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,v.updater=Zy,c.stateNode=v,v._reactInternals=c,v=c.stateNode,v.props=p,v.state=c.memoizedState,v.refs={},Cy(c),S=f.contextType,v.context=typeof S=="object"&&S!==null?Bn(S):tc,v.state=c.memoizedState,S=f.getDerivedStateFromProps,typeof S=="function"&&(Gy(c,f,S,p),v.state=c.memoizedState),typeof f.getDerivedStateFromProps=="function"||typeof v.getSnapshotBeforeUpdate=="function"||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(S=v.state,typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount(),S!==v.state&&Zy.enqueueReplaceState(v,v.state,null),Sh(c,p,v,_),Ah(),v.state=c.memoizedState),typeof v.componentDidMount=="function"&&(c.flags|=4194308),p=!0}else if(a===null){v=c.stateNode;var k=c.memoizedProps,K=Qa(f,k);v.props=K;var ue=v.context,ge=f.contextType;S=tc,typeof ge=="object"&&ge!==null&&(S=Bn(ge));var ve=f.getDerivedStateFromProps;ge=typeof ve=="function"||typeof v.getSnapshotBeforeUpdate=="function",k=c.pendingProps!==k,ge||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(k||ue!==S)&&F1(c,v,p,S),fo=!1;var he=c.memoizedState;v.state=he,Sh(c,p,v,_),Ah(),ue=c.memoizedState,k||he!==ue||fo?(typeof ve=="function"&&(Gy(c,f,ve,p),ue=c.memoizedState),(K=fo||U1(c,f,K,p,he,ue,S))?(ge||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount()),typeof v.componentDidMount=="function"&&(c.flags|=4194308)):(typeof v.componentDidMount=="function"&&(c.flags|=4194308),c.memoizedProps=p,c.memoizedState=ue),v.props=p,v.state=ue,v.context=S,p=K):(typeof v.componentDidMount=="function"&&(c.flags|=4194308),p=!1)}else{v=c.stateNode,Iy(a,c),S=c.memoizedProps,ge=Qa(f,S),v.props=ge,ve=c.pendingProps,he=v.context,ue=f.contextType,K=tc,typeof ue=="object"&&ue!==null&&(K=Bn(ue)),k=f.getDerivedStateFromProps,(ue=typeof k=="function"||typeof v.getSnapshotBeforeUpdate=="function")||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(S!==ve||he!==K)&&F1(c,v,p,K),fo=!1,he=c.memoizedState,v.state=he,Sh(c,p,v,_),Ah();var fe=c.memoizedState;S!==ve||he!==fe||fo||a!==null&&a.dependencies!==null&&ip(a.dependencies)?(typeof k=="function"&&(Gy(c,f,k,p),fe=c.memoizedState),(ge=fo||U1(c,f,ge,p,he,fe,K)||a!==null&&a.dependencies!==null&&ip(a.dependencies))?(ue||typeof v.UNSAFE_componentWillUpdate!="function"&&typeof v.componentWillUpdate!="function"||(typeof v.componentWillUpdate=="function"&&v.componentWillUpdate(p,fe,K),typeof v.UNSAFE_componentWillUpdate=="function"&&v.UNSAFE_componentWillUpdate(p,fe,K)),typeof v.componentDidUpdate=="function"&&(c.flags|=4),typeof v.getSnapshotBeforeUpdate=="function"&&(c.flags|=1024)):(typeof v.componentDidUpdate!="function"||S===a.memoizedProps&&he===a.memoizedState||(c.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||S===a.memoizedProps&&he===a.memoizedState||(c.flags|=1024),c.memoizedProps=p,c.memoizedState=fe),v.props=p,v.state=fe,v.context=K,p=ge):(typeof v.componentDidUpdate!="function"||S===a.memoizedProps&&he===a.memoizedState||(c.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||S===a.memoizedProps&&he===a.memoizedState||(c.flags|=1024),p=!1)}return v=p,Ep(a,c),p=(c.flags&128)!==0,v||p?(v=c.stateNode,f=p&&typeof f.getDerivedStateFromError!="function"?null:v.render(),c.flags|=1,a!==null&&p?(c.child=hc(c,a.child,null,_),c.child=hc(c,null,f,_)):Rn(a,c,f,_),c.memoizedState=v.state,a=c.child):a=_s(a,c,_),a}function J1(a,c,f,p){return _h(),c.flags|=256,Rn(a,c,f,p),c.child}var ev={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function tv(a){return{baseLanes:a,cachePool:Vx()}}function nv(a,c,f){return a=a!==null?a.childLanes&~f:0,c&&(a|=Fr),a}function eA(a,c,f){var p=c.pendingProps,_=!1,v=(c.flags&128)!==0,S;if((S=v)||(S=a!==null&&a.memoizedState===null?!1:(un.current&2)!==0),S&&(_=!0,c.flags&=-129),S=(c.flags&32)!==0,c.flags&=-33,a===null){if(ft){if(_?_o(c):yo(),ft){var k=zt,K;if(K=k){e:{for(K=k,k=Ri;K.nodeType!==8;){if(!k){k=null;break e}if(K=ii(K.nextSibling),K===null){k=null;break e}}k=K}k!==null?(c.memoizedState={dehydrated:k,treeContext:$a!==null?{id:hs,overflow:fs}:null,retryLane:536870912,hydrationErrors:null},K=gr(18,null,null,0),K.stateNode=k,K.return=c,c.child=K,tr=c,zt=null,K=!0):K=!1}K||Xa(c)}if(k=c.memoizedState,k!==null&&(k=k.dehydrated,k!==null))return Bv(k)?c.lanes=32:c.lanes=536870912,null;ms(c)}return k=p.children,p=p.fallback,_?(yo(),_=c.mode,k=xp({mode:"hidden",children:k},_),p=Ha(p,_,f,null),k.return=c,p.return=c,k.sibling=p,c.child=k,_=c.child,_.memoizedState=tv(f),_.childLanes=nv(a,S,f),c.memoizedState=ev,p):(_o(c),rv(c,k))}if(K=a.memoizedState,K!==null&&(k=K.dehydrated,k!==null)){if(v)c.flags&256?(_o(c),c.flags&=-257,c=iv(a,c,f)):c.memoizedState!==null?(yo(),c.child=a.child,c.flags|=128,c=null):(yo(),_=p.fallback,k=c.mode,p=xp({mode:"visible",children:p.children},k),_=Ha(_,k,f,null),_.flags|=2,p.return=c,_.return=c,p.sibling=_,c.child=p,hc(c,a.child,null,f),p=c.child,p.memoizedState=tv(f),p.childLanes=nv(a,S,f),c.memoizedState=ev,c=_);else if(_o(c),Bv(k)){if(S=k.nextSibling&&k.nextSibling.dataset,S)var ue=S.dgst;S=ue,p=Error(r(419)),p.stack="",p.digest=S,yh({value:p,source:null,stack:null}),c=iv(a,c,f)}else if(vn||vh(a,c,f,!1),S=(f&a.childLanes)!==0,vn||S){if(S=Pt,S!==null&&(p=f&-f,p=(p&42)!==0?1:Zu(p),p=(p&(S.suspendedLanes|f))!==0?0:p,p!==0&&p!==K.retryLane))throw K.retryLane=p,ec(a,p),br(S,a,p),W1;k.data==="$?"||wv(),c=iv(a,c,f)}else k.data==="$?"?(c.flags|=192,c.child=a.child,c=null):(a=K.treeContext,zt=ii(k.nextSibling),tr=c,ft=!0,qa=null,Ri=!1,a!==null&&(Dr[Lr++]=hs,Dr[Lr++]=fs,Dr[Lr++]=$a,hs=a.id,fs=a.overflow,$a=c),c=rv(c,p.children),c.flags|=4096);return c}return _?(yo(),_=p.fallback,k=c.mode,K=a.child,ue=K.sibling,p=us(K,{mode:"hidden",children:p.children}),p.subtreeFlags=K.subtreeFlags&65011712,ue!==null?_=us(ue,_):(_=Ha(_,k,f,null),_.flags|=2),_.return=c,p.return=c,p.sibling=_,c.child=p,p=_,_=c.child,k=a.child.memoizedState,k===null?k=tv(f):(K=k.cachePool,K!==null?(ue=cn._currentValue,K=K.parent!==ue?{parent:ue,pool:ue}:K):K=Vx(),k={baseLanes:k.baseLanes|f,cachePool:K}),_.memoizedState=k,_.childLanes=nv(a,S,f),c.memoizedState=ev,p):(_o(c),f=a.child,a=f.sibling,f=us(f,{mode:"visible",children:p.children}),f.return=c,f.sibling=null,a!==null&&(S=c.deletions,S===null?(c.deletions=[a],c.flags|=16):S.push(a)),c.child=f,c.memoizedState=null,f)}function rv(a,c){return c=xp({mode:"visible",children:c},a.mode),c.return=a,a.child=c}function xp(a,c){return a=gr(22,a,null,c),a.lanes=0,a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},a}function iv(a,c,f){return hc(c,a.child,null,f),a=rv(c,c.pendingProps.children),a.flags|=2,c.memoizedState=null,a}function tA(a,c,f){a.lanes|=c;var p=a.alternate;p!==null&&(p.lanes|=c),wy(a.return,c,f)}function sv(a,c,f,p,_){var v=a.memoizedState;v===null?a.memoizedState={isBackwards:c,rendering:null,renderingStartTime:0,last:p,tail:f,tailMode:_}:(v.isBackwards=c,v.rendering=null,v.renderingStartTime=0,v.last=p,v.tail=f,v.tailMode=_)}function nA(a,c,f){var p=c.pendingProps,_=p.revealOrder,v=p.tail;if(Rn(a,c,p.children,f),p=un.current,(p&2)!==0)p=p&1|2,c.flags|=128;else{if(a!==null&&(a.flags&128)!==0)e:for(a=c.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&tA(a,f,c);else if(a.tag===19)tA(a,f,c);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===c)break e;for(;a.sibling===null;){if(a.return===null||a.return===c)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}p&=1}switch(ae(un,p),_){case"forwards":for(f=c.child,_=null;f!==null;)a=f.alternate,a!==null&&bp(a)===null&&(_=f),f=f.sibling;f=_,f===null?(_=c.child,c.child=null):(_=f.sibling,f.sibling=null),sv(c,!1,_,f,v);break;case"backwards":for(f=null,_=c.child,c.child=null;_!==null;){if(a=_.alternate,a!==null&&bp(a)===null){c.child=_;break}a=_.sibling,_.sibling=f,f=_,_=a}sv(c,!0,f,null,v);break;case"together":sv(c,!1,null,null,void 0);break;default:c.memoizedState=null}return c.child}function _s(a,c,f){if(a!==null&&(c.dependencies=a.dependencies),Eo|=c.lanes,(f&c.childLanes)===0)if(a!==null){if(vh(a,c,f,!1),(f&c.childLanes)===0)return null}else return null;if(a!==null&&c.child!==a.child)throw Error(r(153));if(c.child!==null){for(a=c.child,f=us(a,a.pendingProps),c.child=f,f.return=c;a.sibling!==null;)a=a.sibling,f=f.sibling=us(a,a.pendingProps),f.return=c;f.sibling=null}return c.child}function ov(a,c){return(a.lanes&c)!==0?!0:(a=a.dependencies,!!(a!==null&&ip(a)))}function LL(a,c,f){switch(c.tag){case 3:Me(c,c.stateNode.containerInfo),ho(c,cn,a.memoizedState.cache),_h();break;case 27:case 5:Ke(c);break;case 4:Me(c,c.stateNode.containerInfo);break;case 10:ho(c,c.type,c.memoizedProps.value);break;case 13:var p=c.memoizedState;if(p!==null)return p.dehydrated!==null?(_o(c),c.flags|=128,null):(f&c.child.childLanes)!==0?eA(a,c,f):(_o(c),a=_s(a,c,f),a!==null?a.sibling:null);_o(c);break;case 19:var _=(a.flags&128)!==0;if(p=(f&c.childLanes)!==0,p||(vh(a,c,f,!1),p=(f&c.childLanes)!==0),_){if(p)return nA(a,c,f);c.flags|=128}if(_=c.memoizedState,_!==null&&(_.rendering=null,_.tail=null,_.lastEffect=null),ae(un,un.current),p)break;return null;case 22:case 23:return c.lanes=0,K1(a,c,f);case 24:ho(c,cn,a.memoizedState.cache)}return _s(a,c,f)}function rA(a,c,f){if(a!==null)if(a.memoizedProps!==c.pendingProps)vn=!0;else{if(!ov(a,f)&&(c.flags&128)===0)return vn=!1,LL(a,c,f);vn=(a.flags&131072)!==0}else vn=!1,ft&&(c.flags&1048576)!==0&&kx(c,rp,c.index);switch(c.lanes=0,c.tag){case 16:e:{a=c.pendingProps;var p=c.elementType,_=p._init;if(p=_(p._payload),c.type=p,typeof p=="function")gy(p)?(a=Qa(p,a),c.tag=1,c=Q1(null,c,p,a,f)):(c.tag=0,c=Jy(null,c,p,a,f));else{if(p!=null){if(_=p.$$typeof,_===V){c.tag=11,c=q1(null,c,p,a,f);break e}else if(_===D){c.tag=14,c=X1(null,c,p,a,f);break e}}throw c=de(p)||p,Error(r(306,c,""))}}return c;case 0:return Jy(a,c,c.type,c.pendingProps,f);case 1:return p=c.type,_=Qa(p,c.pendingProps),Q1(a,c,p,_,f);case 3:e:{if(Me(c,c.stateNode.containerInfo),a===null)throw Error(r(387));p=c.pendingProps;var v=c.memoizedState;_=v.element,Iy(a,c),Sh(c,p,null,f);var S=c.memoizedState;if(p=S.cache,ho(c,cn,p),p!==v.cache&&Ey(c,[cn],f,!0),Ah(),p=S.element,v.isDehydrated)if(v={element:p,isDehydrated:!1,cache:S.cache},c.updateQueue.baseState=v,c.memoizedState=v,c.flags&256){c=J1(a,c,p,f);break e}else if(p!==_){_=kr(Error(r(424)),c),yh(_),c=J1(a,c,p,f);break e}else{switch(a=c.stateNode.containerInfo,a.nodeType){case 9:a=a.body;break;default:a=a.nodeName==="HTML"?a.ownerDocument.body:a}for(zt=ii(a.firstChild),tr=c,ft=!0,qa=null,Ri=!0,f=D1(c,null,p,f),c.child=f;f;)f.flags=f.flags&-3|4096,f=f.sibling}else{if(_h(),p===_){c=_s(a,c,f);break e}Rn(a,c,p,f)}c=c.child}return c;case 26:return Ep(a,c),a===null?(f=aS(c.type,null,c.pendingProps,null))?c.memoizedState=f:ft||(f=c.type,a=c.pendingProps,p=Fp(Se.current).createElement(f),p[qt]=c,p[Sn]=a,In(p,f,a),Xt(p),c.stateNode=p):c.memoizedState=aS(c.type,a.memoizedProps,c.pendingProps,a.memoizedState),null;case 27:return Ke(c),a===null&&ft&&(p=c.stateNode=iS(c.type,c.pendingProps,Se.current),tr=c,Ri=!0,_=zt,Ro(c.type)?(Vv=_,zt=ii(p.firstChild)):zt=_),Rn(a,c,c.pendingProps.children,f),Ep(a,c),a===null&&(c.flags|=4194304),c.child;case 5:return a===null&&ft&&((_=p=zt)&&(p=u6(p,c.type,c.pendingProps,Ri),p!==null?(c.stateNode=p,tr=c,zt=ii(p.firstChild),Ri=!1,_=!0):_=!1),_||Xa(c)),Ke(c),_=c.type,v=c.pendingProps,S=a!==null?a.memoizedProps:null,p=v.children,Lv(_,v)?p=null:S!==null&&Lv(_,S)&&(c.flags|=32),c.memoizedState!==null&&(_=Dy(a,c,CL,null,null,f),Yh._currentValue=_),Ep(a,c),Rn(a,c,p,f),c.child;case 6:return a===null&&ft&&((a=f=zt)&&(f=h6(f,c.pendingProps,Ri),f!==null?(c.stateNode=f,tr=c,zt=null,a=!0):a=!1),a||Xa(c)),null;case 13:return eA(a,c,f);case 4:return Me(c,c.stateNode.containerInfo),p=c.pendingProps,a===null?c.child=hc(c,null,p,f):Rn(a,c,p,f),c.child;case 11:return q1(a,c,c.type,c.pendingProps,f);case 7:return Rn(a,c,c.pendingProps,f),c.child;case 8:return Rn(a,c,c.pendingProps.children,f),c.child;case 12:return Rn(a,c,c.pendingProps.children,f),c.child;case 10:return p=c.pendingProps,ho(c,c.type,p.value),Rn(a,c,p.children,f),c.child;case 9:return _=c.type._context,p=c.pendingProps.children,Ka(c),_=Bn(_),p=p(_),c.flags|=1,Rn(a,c,p,f),c.child;case 14:return X1(a,c,c.type,c.pendingProps,f);case 15:return Y1(a,c,c.type,c.pendingProps,f);case 19:return nA(a,c,f);case 31:return p=c.pendingProps,f=c.mode,p={mode:p.mode,children:p.children},a===null?(f=xp(p,f),f.ref=c.ref,c.child=f,f.return=c,c=f):(f=us(a.child,p),f.ref=c.ref,c.child=f,f.return=c,c=f),c;case 22:return K1(a,c,f);case 24:return Ka(c),p=Bn(cn),a===null?(_=Sy(),_===null&&(_=Pt,v=xy(),_.pooledCache=v,v.refCount++,v!==null&&(_.pooledCacheLanes|=f),_=v),c.memoizedState={parent:p,cache:_},Cy(c),ho(c,cn,_)):((a.lanes&f)!==0&&(Iy(a,c),Sh(c,null,null,f),Ah()),_=a.memoizedState,v=c.memoizedState,_.parent!==p?(_={parent:p,cache:p},c.memoizedState=_,c.lanes===0&&(c.memoizedState=c.updateQueue.baseState=_),ho(c,cn,p)):(p=v.cache,ho(c,cn,p),p!==_.cache&&Ey(c,[cn],f,!0))),Rn(a,c,c.pendingProps.children,f),c.child;case 29:throw c.pendingProps}throw Error(r(156,c.tag))}function ys(a){a.flags|=4}function iA(a,c){if(c.type!=="stylesheet"||(c.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!fS(c)){if(c=Ur.current,c!==null&&((ct&4194048)===ct?Ci!==null:(ct&62914560)!==ct&&(ct&536870912)===0||c!==Ci))throw Eh=Ry,zx;a.flags|=8192}}function Ap(a,c){c!==null&&(a.flags|=4),a.flags&16384&&(c=a.tag!==22?Qs():536870912,a.lanes|=c,gc|=c)}function kh(a,c){if(!ft)switch(a.tailMode){case"hidden":c=a.tail;for(var f=null;c!==null;)c.alternate!==null&&(f=c),c=c.sibling;f===null?a.tail=null:f.sibling=null;break;case"collapsed":f=a.tail;for(var p=null;f!==null;)f.alternate!==null&&(p=f),f=f.sibling;p===null?c||a.tail===null?a.tail=null:a.tail.sibling=null:p.sibling=null}}function Lt(a){var c=a.alternate!==null&&a.alternate.child===a.child,f=0,p=0;if(c)for(var _=a.child;_!==null;)f|=_.lanes|_.childLanes,p|=_.subtreeFlags&65011712,p|=_.flags&65011712,_.return=a,_=_.sibling;else for(_=a.child;_!==null;)f|=_.lanes|_.childLanes,p|=_.subtreeFlags,p|=_.flags,_.return=a,_=_.sibling;return a.subtreeFlags|=p,a.childLanes=f,c}function UL(a,c,f){var p=c.pendingProps;switch(vy(c),c.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Lt(c),null;case 1:return Lt(c),null;case 3:return f=c.stateNode,p=null,a!==null&&(p=a.memoizedState.cache),c.memoizedState.cache!==p&&(c.flags|=2048),ps(cn),at(),f.pendingContext&&(f.context=f.pendingContext,f.pendingContext=null),(a===null||a.child===null)&&(mh(c)?ys(c):a===null||a.memoizedState.isDehydrated&&(c.flags&256)===0||(c.flags|=1024,Lx())),Lt(c),null;case 26:return f=c.memoizedState,a===null?(ys(c),f!==null?(Lt(c),iA(c,f)):(Lt(c),c.flags&=-16777217)):f?f!==a.memoizedState?(ys(c),Lt(c),iA(c,f)):(Lt(c),c.flags&=-16777217):(a.memoizedProps!==p&&ys(c),Lt(c),c.flags&=-16777217),null;case 27:mn(c),f=Se.current;var _=c.type;if(a!==null&&c.stateNode!=null)a.memoizedProps!==p&&ys(c);else{if(!p){if(c.stateNode===null)throw Error(r(166));return Lt(c),null}a=me.current,mh(c)?Nx(c):(a=iS(_,p,f),c.stateNode=a,ys(c))}return Lt(c),null;case 5:if(mn(c),f=c.type,a!==null&&c.stateNode!=null)a.memoizedProps!==p&&ys(c);else{if(!p){if(c.stateNode===null)throw Error(r(166));return Lt(c),null}if(a=me.current,mh(c))Nx(c);else{switch(_=Fp(Se.current),a){case 1:a=_.createElementNS("http://www.w3.org/2000/svg",f);break;case 2:a=_.createElementNS("http://www.w3.org/1998/Math/MathML",f);break;default:switch(f){case"svg":a=_.createElementNS("http://www.w3.org/2000/svg",f);break;case"math":a=_.createElementNS("http://www.w3.org/1998/Math/MathML",f);break;case"script":a=_.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild);break;case"select":a=typeof p.is=="string"?_.createElement("select",{is:p.is}):_.createElement("select"),p.multiple?a.multiple=!0:p.size&&(a.size=p.size);break;default:a=typeof p.is=="string"?_.createElement(f,{is:p.is}):_.createElement(f)}}a[qt]=c,a[Sn]=p;e:for(_=c.child;_!==null;){if(_.tag===5||_.tag===6)a.appendChild(_.stateNode);else if(_.tag!==4&&_.tag!==27&&_.child!==null){_.child.return=_,_=_.child;continue}if(_===c)break e;for(;_.sibling===null;){if(_.return===null||_.return===c)break e;_=_.return}_.sibling.return=_.return,_=_.sibling}c.stateNode=a;e:switch(In(a,f,p),f){case"button":case"input":case"select":case"textarea":a=!!p.autoFocus;break e;case"img":a=!0;break e;default:a=!1}a&&ys(c)}}return Lt(c),c.flags&=-16777217,null;case 6:if(a&&c.stateNode!=null)a.memoizedProps!==p&&ys(c);else{if(typeof p!="string"&&c.stateNode===null)throw Error(r(166));if(a=Se.current,mh(c)){if(a=c.stateNode,f=c.memoizedProps,p=null,_=tr,_!==null)switch(_.tag){case 27:case 5:p=_.memoizedProps}a[qt]=c,a=!!(a.nodeValue===f||p!==null&&p.suppressHydrationWarning===!0||ZA(a.nodeValue,f)),a||Xa(c)}else a=Fp(a).createTextNode(p),a[qt]=c,c.stateNode=a}return Lt(c),null;case 13:if(p=c.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(_=mh(c),p!==null&&p.dehydrated!==null){if(a===null){if(!_)throw Error(r(318));if(_=c.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(r(317));_[qt]=c}else _h(),(c.flags&128)===0&&(c.memoizedState=null),c.flags|=4;Lt(c),_=!1}else _=Lx(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=_),_=!0;if(!_)return c.flags&256?(ms(c),c):(ms(c),null)}if(ms(c),(c.flags&128)!==0)return c.lanes=f,c;if(f=p!==null,a=a!==null&&a.memoizedState!==null,f){p=c.child,_=null,p.alternate!==null&&p.alternate.memoizedState!==null&&p.alternate.memoizedState.cachePool!==null&&(_=p.alternate.memoizedState.cachePool.pool);var v=null;p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(v=p.memoizedState.cachePool.pool),v!==_&&(p.flags|=2048)}return f!==a&&f&&(c.child.flags|=8192),Ap(c,c.updateQueue),Lt(c),null;case 4:return at(),a===null&&Mv(c.stateNode.containerInfo),Lt(c),null;case 10:return ps(c.type),Lt(c),null;case 19:if(ie(un),_=c.memoizedState,_===null)return Lt(c),null;if(p=(c.flags&128)!==0,v=_.rendering,v===null)if(p)kh(_,!1);else{if(jt!==0||a!==null&&(a.flags&128)!==0)for(a=c.child;a!==null;){if(v=bp(a),v!==null){for(c.flags|=128,kh(_,!1),a=v.updateQueue,c.updateQueue=a,Ap(c,a),c.subtreeFlags=0,a=f,f=c.child;f!==null;)Ox(f,a),f=f.sibling;return ae(un,un.current&1|2),c.child}a=a.sibling}_.tail!==null&&ir()>Cp&&(c.flags|=128,p=!0,kh(_,!1),c.lanes=4194304)}else{if(!p)if(a=bp(v),a!==null){if(c.flags|=128,p=!0,a=a.updateQueue,c.updateQueue=a,Ap(c,a),kh(_,!0),_.tail===null&&_.tailMode==="hidden"&&!v.alternate&&!ft)return Lt(c),null}else 2*ir()-_.renderingStartTime>Cp&&f!==536870912&&(c.flags|=128,p=!0,kh(_,!1),c.lanes=4194304);_.isBackwards?(v.sibling=c.child,c.child=v):(a=_.last,a!==null?a.sibling=v:c.child=v,_.last=v)}return _.tail!==null?(c=_.tail,_.rendering=c,_.tail=c.sibling,_.renderingStartTime=ir(),c.sibling=null,a=un.current,ae(un,p?a&1|2:a&1),c):(Lt(c),null);case 22:case 23:return ms(c),ky(),p=c.memoizedState!==null,a!==null?a.memoizedState!==null!==p&&(c.flags|=8192):p&&(c.flags|=8192),p?(f&536870912)!==0&&(c.flags&128)===0&&(Lt(c),c.subtreeFlags&6&&(c.flags|=8192)):Lt(c),f=c.updateQueue,f!==null&&Ap(c,f.retryQueue),f=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(f=a.memoizedState.cachePool.pool),p=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(p=c.memoizedState.cachePool.pool),p!==f&&(c.flags|=2048),a!==null&&ie(Ga),null;case 24:return f=null,a!==null&&(f=a.memoizedState.cache),c.memoizedState.cache!==f&&(c.flags|=2048),ps(cn),Lt(c),null;case 25:return null;case 30:return null}throw Error(r(156,c.tag))}function FL(a,c){switch(vy(c),c.tag){case 1:return a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 3:return ps(cn),at(),a=c.flags,(a&65536)!==0&&(a&128)===0?(c.flags=a&-65537|128,c):null;case 26:case 27:case 5:return mn(c),null;case 13:if(ms(c),a=c.memoizedState,a!==null&&a.dehydrated!==null){if(c.alternate===null)throw Error(r(340));_h()}return a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 19:return ie(un),null;case 4:return at(),null;case 10:return ps(c.type),null;case 22:case 23:return ms(c),ky(),a!==null&&ie(Ga),a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 24:return ps(cn),null;case 25:return null;default:return null}}function sA(a,c){switch(vy(c),c.tag){case 3:ps(cn),at();break;case 26:case 27:case 5:mn(c);break;case 4:at();break;case 13:ms(c);break;case 19:ie(un);break;case 10:ps(c.type);break;case 22:case 23:ms(c),ky(),a!==null&&ie(Ga);break;case 24:ps(cn)}}function Nh(a,c){try{var f=c.updateQueue,p=f!==null?f.lastEffect:null;if(p!==null){var _=p.next;f=_;do{if((f.tag&a)===a){p=void 0;var v=f.create,S=f.inst;p=v(),S.destroy=p}f=f.next}while(f!==_)}}catch(k){Rt(c,c.return,k)}}function vo(a,c,f){try{var p=c.updateQueue,_=p!==null?p.lastEffect:null;if(_!==null){var v=_.next;p=v;do{if((p.tag&a)===a){var S=p.inst,k=S.destroy;if(k!==void 0){S.destroy=void 0,_=c;var K=f,ue=k;try{ue()}catch(ge){Rt(_,K,ge)}}}p=p.next}while(p!==v)}}catch(ge){Rt(c,c.return,ge)}}function oA(a){var c=a.updateQueue;if(c!==null){var f=a.stateNode;try{Xx(c,f)}catch(p){Rt(a,a.return,p)}}}function aA(a,c,f){f.props=Qa(a.type,a.memoizedProps),f.state=a.memoizedState;try{f.componentWillUnmount()}catch(p){Rt(a,c,p)}}function Dh(a,c){try{var f=a.ref;if(f!==null){switch(a.tag){case 26:case 27:case 5:var p=a.stateNode;break;case 30:p=a.stateNode;break;default:p=a.stateNode}typeof f=="function"?a.refCleanup=f(p):f.current=p}}catch(_){Rt(a,c,_)}}function Ii(a,c){var f=a.ref,p=a.refCleanup;if(f!==null)if(typeof p=="function")try{p()}catch(_){Rt(a,c,_)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof f=="function")try{f(null)}catch(_){Rt(a,c,_)}else f.current=null}function lA(a){var c=a.type,f=a.memoizedProps,p=a.stateNode;try{e:switch(c){case"button":case"input":case"select":case"textarea":f.autoFocus&&p.focus();break e;case"img":f.src?p.src=f.src:f.srcSet&&(p.srcset=f.srcSet)}}catch(_){Rt(a,a.return,_)}}function av(a,c,f){try{var p=a.stateNode;s6(p,a.type,f,c),p[Sn]=c}catch(_){Rt(a,a.return,_)}}function cA(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&Ro(a.type)||a.tag===4}function lv(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||cA(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&Ro(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function cv(a,c,f){var p=a.tag;if(p===5||p===6)a=a.stateNode,c?(f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f).insertBefore(a,c):(c=f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f,c.appendChild(a),f=f._reactRootContainer,f!=null||c.onclick!==null||(c.onclick=Up));else if(p!==4&&(p===27&&Ro(a.type)&&(f=a.stateNode,c=null),a=a.child,a!==null))for(cv(a,c,f),a=a.sibling;a!==null;)cv(a,c,f),a=a.sibling}function Sp(a,c,f){var p=a.tag;if(p===5||p===6)a=a.stateNode,c?f.insertBefore(a,c):f.appendChild(a);else if(p!==4&&(p===27&&Ro(a.type)&&(f=a.stateNode),a=a.child,a!==null))for(Sp(a,c,f),a=a.sibling;a!==null;)Sp(a,c,f),a=a.sibling}function uA(a){var c=a.stateNode,f=a.memoizedProps;try{for(var p=a.type,_=c.attributes;_.length;)c.removeAttributeNode(_[0]);In(c,p,f),c[qt]=a,c[Sn]=f}catch(v){Rt(a,a.return,v)}}var vs=!1,Gt=!1,uv=!1,hA=typeof WeakSet=="function"?WeakSet:Set,bn=null;function BL(a,c){if(a=a.containerInfo,Nv=$p,a=wx(a),ly(a)){if("selectionStart"in a)var f={start:a.selectionStart,end:a.selectionEnd};else e:{f=(f=a.ownerDocument)&&f.defaultView||window;var p=f.getSelection&&f.getSelection();if(p&&p.rangeCount!==0){f=p.anchorNode;var _=p.anchorOffset,v=p.focusNode;p=p.focusOffset;try{f.nodeType,v.nodeType}catch{f=null;break e}var S=0,k=-1,K=-1,ue=0,ge=0,ve=a,he=null;t:for(;;){for(var fe;ve!==f||_!==0&&ve.nodeType!==3||(k=S+_),ve!==v||p!==0&&ve.nodeType!==3||(K=S+p),ve.nodeType===3&&(S+=ve.nodeValue.length),(fe=ve.firstChild)!==null;)he=ve,ve=fe;for(;;){if(ve===a)break t;if(he===f&&++ue===_&&(k=S),he===v&&++ge===p&&(K=S),(fe=ve.nextSibling)!==null)break;ve=he,he=ve.parentNode}ve=fe}f=k===-1||K===-1?null:{start:k,end:K}}else f=null}f=f||{start:0,end:0}}else f=null;for(Dv={focusedElem:a,selectionRange:f},$p=!1,bn=c;bn!==null;)if(c=bn,a=c.child,(c.subtreeFlags&1024)!==0&&a!==null)a.return=c,bn=a;else for(;bn!==null;){switch(c=bn,v=c.alternate,a=c.flags,c.tag){case 0:break;case 11:case 15:break;case 1:if((a&1024)!==0&&v!==null){a=void 0,f=c,_=v.memoizedProps,v=v.memoizedState,p=f.stateNode;try{var He=Qa(f.type,_,f.elementType===f.type);a=p.getSnapshotBeforeUpdate(He,v),p.__reactInternalSnapshotBeforeUpdate=a}catch(Fe){Rt(f,f.return,Fe)}}break;case 3:if((a&1024)!==0){if(a=c.stateNode.containerInfo,f=a.nodeType,f===9)Fv(a);else if(f===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":Fv(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(r(163))}if(a=c.sibling,a!==null){a.return=c.return,bn=a;break}bn=c.return}}function fA(a,c,f){var p=f.flags;switch(f.tag){case 0:case 11:case 15:bo(a,f),p&4&&Nh(5,f);break;case 1:if(bo(a,f),p&4)if(a=f.stateNode,c===null)try{a.componentDidMount()}catch(S){Rt(f,f.return,S)}else{var _=Qa(f.type,c.memoizedProps);c=c.memoizedState;try{a.componentDidUpdate(_,c,a.__reactInternalSnapshotBeforeUpdate)}catch(S){Rt(f,f.return,S)}}p&64&&oA(f),p&512&&Dh(f,f.return);break;case 3:if(bo(a,f),p&64&&(a=f.updateQueue,a!==null)){if(c=null,f.child!==null)switch(f.child.tag){case 27:case 5:c=f.child.stateNode;break;case 1:c=f.child.stateNode}try{Xx(a,c)}catch(S){Rt(f,f.return,S)}}break;case 27:c===null&&p&4&&uA(f);case 26:case 5:bo(a,f),c===null&&p&4&&lA(f),p&512&&Dh(f,f.return);break;case 12:bo(a,f);break;case 13:bo(a,f),p&4&&gA(a,f),p&64&&(a=f.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(f=YL.bind(null,f),f6(a,f))));break;case 22:if(p=f.memoizedState!==null||vs,!p){c=c!==null&&c.memoizedState!==null||Gt,_=vs;var v=Gt;vs=p,(Gt=c)&&!v?To(a,f,(f.subtreeFlags&8772)!==0):bo(a,f),vs=_,Gt=v}break;case 30:break;default:bo(a,f)}}function dA(a){var c=a.alternate;c!==null&&(a.alternate=null,dA(c)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(c=a.stateNode,c!==null&&Bl(c)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var kt=null,or=!1;function bs(a,c,f){for(f=f.child;f!==null;)pA(a,c,f),f=f.sibling}function pA(a,c,f){if(Un&&typeof Un.onCommitFiberUnmount=="function")try{Un.onCommitFiberUnmount(Ks,f)}catch{}switch(f.tag){case 26:Gt||Ii(f,c),bs(a,c,f),f.memoizedState?f.memoizedState.count--:f.stateNode&&(f=f.stateNode,f.parentNode.removeChild(f));break;case 27:Gt||Ii(f,c);var p=kt,_=or;Ro(f.type)&&(kt=f.stateNode,or=!1),bs(a,c,f),$h(f.stateNode),kt=p,or=_;break;case 5:Gt||Ii(f,c);case 6:if(p=kt,_=or,kt=null,bs(a,c,f),kt=p,or=_,kt!==null)if(or)try{(kt.nodeType===9?kt.body:kt.nodeName==="HTML"?kt.ownerDocument.body:kt).removeChild(f.stateNode)}catch(v){Rt(f,c,v)}else try{kt.removeChild(f.stateNode)}catch(v){Rt(f,c,v)}break;case 18:kt!==null&&(or?(a=kt,nS(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,f.stateNode),Qh(a)):nS(kt,f.stateNode));break;case 4:p=kt,_=or,kt=f.stateNode.containerInfo,or=!0,bs(a,c,f),kt=p,or=_;break;case 0:case 11:case 14:case 15:Gt||vo(2,f,c),Gt||vo(4,f,c),bs(a,c,f);break;case 1:Gt||(Ii(f,c),p=f.stateNode,typeof p.componentWillUnmount=="function"&&aA(f,c,p)),bs(a,c,f);break;case 21:bs(a,c,f);break;case 22:Gt=(p=Gt)||f.memoizedState!==null,bs(a,c,f),Gt=p;break;default:bs(a,c,f)}}function gA(a,c){if(c.memoizedState===null&&(a=c.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{Qh(a)}catch(f){Rt(c,c.return,f)}}function VL(a){switch(a.tag){case 13:case 19:var c=a.stateNode;return c===null&&(c=a.stateNode=new hA),c;case 22:return a=a.stateNode,c=a._retryCache,c===null&&(c=a._retryCache=new hA),c;default:throw Error(r(435,a.tag))}}function hv(a,c){var f=VL(a);c.forEach(function(p){var _=KL.bind(null,a,p);f.has(p)||(f.add(p),p.then(_,_))})}function mr(a,c){var f=c.deletions;if(f!==null)for(var p=0;p<f.length;p++){var _=f[p],v=a,S=c,k=S;e:for(;k!==null;){switch(k.tag){case 27:if(Ro(k.type)){kt=k.stateNode,or=!1;break e}break;case 5:kt=k.stateNode,or=!1;break e;case 3:case 4:kt=k.stateNode.containerInfo,or=!0;break e}k=k.return}if(kt===null)throw Error(r(160));pA(v,S,_),kt=null,or=!1,v=_.alternate,v!==null&&(v.return=null),_.return=null}if(c.subtreeFlags&13878)for(c=c.child;c!==null;)mA(c,a),c=c.sibling}var ri=null;function mA(a,c){var f=a.alternate,p=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:mr(c,a),_r(a),p&4&&(vo(3,a,a.return),Nh(3,a),vo(5,a,a.return));break;case 1:mr(c,a),_r(a),p&512&&(Gt||f===null||Ii(f,f.return)),p&64&&vs&&(a=a.updateQueue,a!==null&&(p=a.callbacks,p!==null&&(f=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=f===null?p:f.concat(p))));break;case 26:var _=ri;if(mr(c,a),_r(a),p&512&&(Gt||f===null||Ii(f,f.return)),p&4){var v=f!==null?f.memoizedState:null;if(p=a.memoizedState,f===null)if(p===null)if(a.stateNode===null){e:{p=a.type,f=a.memoizedProps,_=_.ownerDocument||_;t:switch(p){case"title":v=_.getElementsByTagName("title")[0],(!v||v[to]||v[qt]||v.namespaceURI==="http://www.w3.org/2000/svg"||v.hasAttribute("itemprop"))&&(v=_.createElement(p),_.head.insertBefore(v,_.querySelector("head > title"))),In(v,p,f),v[qt]=a,Xt(v),p=v;break e;case"link":var S=uS("link","href",_).get(p+(f.href||""));if(S){for(var k=0;k<S.length;k++)if(v=S[k],v.getAttribute("href")===(f.href==null||f.href===""?null:f.href)&&v.getAttribute("rel")===(f.rel==null?null:f.rel)&&v.getAttribute("title")===(f.title==null?null:f.title)&&v.getAttribute("crossorigin")===(f.crossOrigin==null?null:f.crossOrigin)){S.splice(k,1);break t}}v=_.createElement(p),In(v,p,f),_.head.appendChild(v);break;case"meta":if(S=uS("meta","content",_).get(p+(f.content||""))){for(k=0;k<S.length;k++)if(v=S[k],v.getAttribute("content")===(f.content==null?null:""+f.content)&&v.getAttribute("name")===(f.name==null?null:f.name)&&v.getAttribute("property")===(f.property==null?null:f.property)&&v.getAttribute("http-equiv")===(f.httpEquiv==null?null:f.httpEquiv)&&v.getAttribute("charset")===(f.charSet==null?null:f.charSet)){S.splice(k,1);break t}}v=_.createElement(p),In(v,p,f),_.head.appendChild(v);break;default:throw Error(r(468,p))}v[qt]=a,Xt(v),p=v}a.stateNode=p}else hS(_,a.type,a.stateNode);else a.stateNode=cS(_,p,a.memoizedProps);else v!==p?(v===null?f.stateNode!==null&&(f=f.stateNode,f.parentNode.removeChild(f)):v.count--,p===null?hS(_,a.type,a.stateNode):cS(_,p,a.memoizedProps)):p===null&&a.stateNode!==null&&av(a,a.memoizedProps,f.memoizedProps)}break;case 27:mr(c,a),_r(a),p&512&&(Gt||f===null||Ii(f,f.return)),f!==null&&p&4&&av(a,a.memoizedProps,f.memoizedProps);break;case 5:if(mr(c,a),_r(a),p&512&&(Gt||f===null||Ii(f,f.return)),a.flags&32){_=a.stateNode;try{Mr(_,"")}catch(fe){Rt(a,a.return,fe)}}p&4&&a.stateNode!=null&&(_=a.memoizedProps,av(a,_,f!==null?f.memoizedProps:_)),p&1024&&(uv=!0);break;case 6:if(mr(c,a),_r(a),p&4){if(a.stateNode===null)throw Error(r(162));p=a.memoizedProps,f=a.stateNode;try{f.nodeValue=p}catch(fe){Rt(a,a.return,fe)}}break;case 3:if(zp=null,_=ri,ri=Bp(c.containerInfo),mr(c,a),ri=_,_r(a),p&4&&f!==null&&f.memoizedState.isDehydrated)try{Qh(c.containerInfo)}catch(fe){Rt(a,a.return,fe)}uv&&(uv=!1,_A(a));break;case 4:p=ri,ri=Bp(a.stateNode.containerInfo),mr(c,a),_r(a),ri=p;break;case 12:mr(c,a),_r(a);break;case 13:mr(c,a),_r(a),a.child.flags&8192&&a.memoizedState!==null!=(f!==null&&f.memoizedState!==null)&&(_v=ir()),p&4&&(p=a.updateQueue,p!==null&&(a.updateQueue=null,hv(a,p)));break;case 22:_=a.memoizedState!==null;var K=f!==null&&f.memoizedState!==null,ue=vs,ge=Gt;if(vs=ue||_,Gt=ge||K,mr(c,a),Gt=ge,vs=ue,_r(a),p&8192)e:for(c=a.stateNode,c._visibility=_?c._visibility&-2:c._visibility|1,_&&(f===null||K||vs||Gt||Ja(a)),f=null,c=a;;){if(c.tag===5||c.tag===26){if(f===null){K=f=c;try{if(v=K.stateNode,_)S=v.style,typeof S.setProperty=="function"?S.setProperty("display","none","important"):S.display="none";else{k=K.stateNode;var ve=K.memoizedProps.style,he=ve!=null&&ve.hasOwnProperty("display")?ve.display:null;k.style.display=he==null||typeof he=="boolean"?"":(""+he).trim()}}catch(fe){Rt(K,K.return,fe)}}}else if(c.tag===6){if(f===null){K=c;try{K.stateNode.nodeValue=_?"":K.memoizedProps}catch(fe){Rt(K,K.return,fe)}}}else if((c.tag!==22&&c.tag!==23||c.memoizedState===null||c===a)&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===a)break e;for(;c.sibling===null;){if(c.return===null||c.return===a)break e;f===c&&(f=null),c=c.return}f===c&&(f=null),c.sibling.return=c.return,c=c.sibling}p&4&&(p=a.updateQueue,p!==null&&(f=p.retryQueue,f!==null&&(p.retryQueue=null,hv(a,f))));break;case 19:mr(c,a),_r(a),p&4&&(p=a.updateQueue,p!==null&&(a.updateQueue=null,hv(a,p)));break;case 30:break;case 21:break;default:mr(c,a),_r(a)}}function _r(a){var c=a.flags;if(c&2){try{for(var f,p=a.return;p!==null;){if(cA(p)){f=p;break}p=p.return}if(f==null)throw Error(r(160));switch(f.tag){case 27:var _=f.stateNode,v=lv(a);Sp(a,v,_);break;case 5:var S=f.stateNode;f.flags&32&&(Mr(S,""),f.flags&=-33);var k=lv(a);Sp(a,k,S);break;case 3:case 4:var K=f.stateNode.containerInfo,ue=lv(a);cv(a,ue,K);break;default:throw Error(r(161))}}catch(ge){Rt(a,a.return,ge)}a.flags&=-3}c&4096&&(a.flags&=-4097)}function _A(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var c=a;_A(c),c.tag===5&&c.flags&1024&&c.stateNode.reset(),a=a.sibling}}function bo(a,c){if(c.subtreeFlags&8772)for(c=c.child;c!==null;)fA(a,c.alternate,c),c=c.sibling}function Ja(a){for(a=a.child;a!==null;){var c=a;switch(c.tag){case 0:case 11:case 14:case 15:vo(4,c,c.return),Ja(c);break;case 1:Ii(c,c.return);var f=c.stateNode;typeof f.componentWillUnmount=="function"&&aA(c,c.return,f),Ja(c);break;case 27:$h(c.stateNode);case 26:case 5:Ii(c,c.return),Ja(c);break;case 22:c.memoizedState===null&&Ja(c);break;case 30:Ja(c);break;default:Ja(c)}a=a.sibling}}function To(a,c,f){for(f=f&&(c.subtreeFlags&8772)!==0,c=c.child;c!==null;){var p=c.alternate,_=a,v=c,S=v.flags;switch(v.tag){case 0:case 11:case 15:To(_,v,f),Nh(4,v);break;case 1:if(To(_,v,f),p=v,_=p.stateNode,typeof _.componentDidMount=="function")try{_.componentDidMount()}catch(ue){Rt(p,p.return,ue)}if(p=v,_=p.updateQueue,_!==null){var k=p.stateNode;try{var K=_.shared.hiddenCallbacks;if(K!==null)for(_.shared.hiddenCallbacks=null,_=0;_<K.length;_++)qx(K[_],k)}catch(ue){Rt(p,p.return,ue)}}f&&S&64&&oA(v),Dh(v,v.return);break;case 27:uA(v);case 26:case 5:To(_,v,f),f&&p===null&&S&4&&lA(v),Dh(v,v.return);break;case 12:To(_,v,f);break;case 13:To(_,v,f),f&&S&4&&gA(_,v);break;case 22:v.memoizedState===null&&To(_,v,f),Dh(v,v.return);break;case 30:break;default:To(_,v,f)}c=c.sibling}}function fv(a,c){var f=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(f=a.memoizedState.cachePool.pool),a=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(a=c.memoizedState.cachePool.pool),a!==f&&(a!=null&&a.refCount++,f!=null&&bh(f))}function dv(a,c){a=null,c.alternate!==null&&(a=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==a&&(c.refCount++,a!=null&&bh(a))}function Pi(a,c,f,p){if(c.subtreeFlags&10256)for(c=c.child;c!==null;)yA(a,c,f,p),c=c.sibling}function yA(a,c,f,p){var _=c.flags;switch(c.tag){case 0:case 11:case 15:Pi(a,c,f,p),_&2048&&Nh(9,c);break;case 1:Pi(a,c,f,p);break;case 3:Pi(a,c,f,p),_&2048&&(a=null,c.alternate!==null&&(a=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==a&&(c.refCount++,a!=null&&bh(a)));break;case 12:if(_&2048){Pi(a,c,f,p),a=c.stateNode;try{var v=c.memoizedProps,S=v.id,k=v.onPostCommit;typeof k=="function"&&k(S,c.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(K){Rt(c,c.return,K)}}else Pi(a,c,f,p);break;case 13:Pi(a,c,f,p);break;case 23:break;case 22:v=c.stateNode,S=c.alternate,c.memoizedState!==null?v._visibility&2?Pi(a,c,f,p):Lh(a,c):v._visibility&2?Pi(a,c,f,p):(v._visibility|=2,fc(a,c,f,p,(c.subtreeFlags&10256)!==0)),_&2048&&fv(S,c);break;case 24:Pi(a,c,f,p),_&2048&&dv(c.alternate,c);break;default:Pi(a,c,f,p)}}function fc(a,c,f,p,_){for(_=_&&(c.subtreeFlags&10256)!==0,c=c.child;c!==null;){var v=a,S=c,k=f,K=p,ue=S.flags;switch(S.tag){case 0:case 11:case 15:fc(v,S,k,K,_),Nh(8,S);break;case 23:break;case 22:var ge=S.stateNode;S.memoizedState!==null?ge._visibility&2?fc(v,S,k,K,_):Lh(v,S):(ge._visibility|=2,fc(v,S,k,K,_)),_&&ue&2048&&fv(S.alternate,S);break;case 24:fc(v,S,k,K,_),_&&ue&2048&&dv(S.alternate,S);break;default:fc(v,S,k,K,_)}c=c.sibling}}function Lh(a,c){if(c.subtreeFlags&10256)for(c=c.child;c!==null;){var f=a,p=c,_=p.flags;switch(p.tag){case 22:Lh(f,p),_&2048&&fv(p.alternate,p);break;case 24:Lh(f,p),_&2048&&dv(p.alternate,p);break;default:Lh(f,p)}c=c.sibling}}var Uh=8192;function dc(a){if(a.subtreeFlags&Uh)for(a=a.child;a!==null;)vA(a),a=a.sibling}function vA(a){switch(a.tag){case 26:dc(a),a.flags&Uh&&a.memoizedState!==null&&A6(ri,a.memoizedState,a.memoizedProps);break;case 5:dc(a);break;case 3:case 4:var c=ri;ri=Bp(a.stateNode.containerInfo),dc(a),ri=c;break;case 22:a.memoizedState===null&&(c=a.alternate,c!==null&&c.memoizedState!==null?(c=Uh,Uh=16777216,dc(a),Uh=c):dc(a));break;default:dc(a)}}function bA(a){var c=a.alternate;if(c!==null&&(a=c.child,a!==null)){c.child=null;do c=a.sibling,a.sibling=null,a=c;while(a!==null)}}function Fh(a){var c=a.deletions;if((a.flags&16)!==0){if(c!==null)for(var f=0;f<c.length;f++){var p=c[f];bn=p,wA(p,a)}bA(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)TA(a),a=a.sibling}function TA(a){switch(a.tag){case 0:case 11:case 15:Fh(a),a.flags&2048&&vo(9,a,a.return);break;case 3:Fh(a);break;case 12:Fh(a);break;case 22:var c=a.stateNode;a.memoizedState!==null&&c._visibility&2&&(a.return===null||a.return.tag!==13)?(c._visibility&=-3,Rp(a)):Fh(a);break;default:Fh(a)}}function Rp(a){var c=a.deletions;if((a.flags&16)!==0){if(c!==null)for(var f=0;f<c.length;f++){var p=c[f];bn=p,wA(p,a)}bA(a)}for(a=a.child;a!==null;){switch(c=a,c.tag){case 0:case 11:case 15:vo(8,c,c.return),Rp(c);break;case 22:f=c.stateNode,f._visibility&2&&(f._visibility&=-3,Rp(c));break;default:Rp(c)}a=a.sibling}}function wA(a,c){for(;bn!==null;){var f=bn;switch(f.tag){case 0:case 11:case 15:vo(8,f,c);break;case 23:case 22:if(f.memoizedState!==null&&f.memoizedState.cachePool!==null){var p=f.memoizedState.cachePool.pool;p!=null&&p.refCount++}break;case 24:bh(f.memoizedState.cache)}if(p=f.child,p!==null)p.return=f,bn=p;else e:for(f=a;bn!==null;){p=bn;var _=p.sibling,v=p.return;if(dA(p),p===f){bn=null;break e}if(_!==null){_.return=v,bn=_;break e}bn=v}}}var zL={getCacheForType:function(a){var c=Bn(cn),f=c.data.get(a);return f===void 0&&(f=a(),c.data.set(a,f)),f}},jL=typeof WeakMap=="function"?WeakMap:Map,_t=0,Pt=null,Je=null,ct=0,yt=0,yr=null,wo=!1,pc=!1,pv=!1,Ts=0,jt=0,Eo=0,el=0,gv=0,Fr=0,gc=0,Bh=null,ar=null,mv=!1,_v=0,Cp=1/0,Ip=null,xo=null,Cn=0,Ao=null,mc=null,_c=0,yv=0,vv=null,EA=null,Vh=0,bv=null;function vr(){if((_t&2)!==0&&ct!==0)return ct&-ct;if(P.T!==null){var a=ic;return a!==0?a:Rv()}return rs()}function xA(){Fr===0&&(Fr=(ct&536870912)===0||ft?Gu():536870912);var a=Ur.current;return a!==null&&(a.flags|=32),Fr}function br(a,c,f){(a===Pt&&(yt===2||yt===9)||a.cancelPendingCommit!==null)&&(yc(a,0),So(a,ct,Fr,!1)),Wt(a,f),((_t&2)===0||a!==Pt)&&(a===Pt&&((_t&2)===0&&(el|=f),jt===4&&So(a,ct,Fr,!1)),Mi(a))}function AA(a,c,f){if((_t&6)!==0)throw Error(r(327));var p=!f&&(c&124)===0&&(c&a.expiredLanes)===0||Zs(a,c),_=p?WL(a,c):Ev(a,c,!0),v=p;do{if(_===0){pc&&!p&&So(a,c,0,!1);break}else{if(f=a.current.alternate,v&&!HL(f)){_=Ev(a,c,!1),v=!1;continue}if(_===2){if(v=c,a.errorRecoveryDisabledLanes&v)var S=0;else S=a.pendingLanes&-536870913,S=S!==0?S:S&536870912?536870912:0;if(S!==0){c=S;e:{var k=a;_=Bh;var K=k.current.memoizedState.isDehydrated;if(K&&(yc(k,S).flags|=256),S=Ev(k,S,!1),S!==2){if(pv&&!K){k.errorRecoveryDisabledLanes|=v,el|=v,_=4;break e}v=ar,ar=_,v!==null&&(ar===null?ar=v:ar.push.apply(ar,v))}_=S}if(v=!1,_!==2)continue}}if(_===1){yc(a,0),So(a,c,0,!0);break}e:{switch(p=a,v=_,v){case 0:case 1:throw Error(r(345));case 4:if((c&4194048)!==c)break;case 6:So(p,c,Fr,!wo);break e;case 2:ar=null;break;case 3:case 5:break;default:throw Error(r(329))}if((c&62914560)===c&&(_=_v+300-ir(),10<_)){if(So(p,c,Fr,!wo),Ir(p,0,!0)!==0)break e;p.timeoutHandle=eS(SA.bind(null,p,f,ar,Ip,mv,c,Fr,el,gc,wo,v,2,-0,0),_);break e}SA(p,f,ar,Ip,mv,c,Fr,el,gc,wo,v,0,-0,0)}}break}while(!0);Mi(a)}function SA(a,c,f,p,_,v,S,k,K,ue,ge,ve,he,fe){if(a.timeoutHandle=-1,ve=c.subtreeFlags,(ve&8192||(ve&16785408)===16785408)&&(Xh={stylesheets:null,count:0,unsuspend:x6},vA(c),ve=S6(),ve!==null)){a.cancelPendingCommit=ve(kA.bind(null,a,c,v,f,p,_,S,k,K,ge,1,he,fe)),So(a,v,S,!ue);return}kA(a,c,v,f,p,_,S,k,K)}function HL(a){for(var c=a;;){var f=c.tag;if((f===0||f===11||f===15)&&c.flags&16384&&(f=c.updateQueue,f!==null&&(f=f.stores,f!==null)))for(var p=0;p<f.length;p++){var _=f[p],v=_.getSnapshot;_=_.value;try{if(!pr(v(),_))return!1}catch{return!1}}if(f=c.child,c.subtreeFlags&16384&&f!==null)f.return=c,c=f;else{if(c===a)break;for(;c.sibling===null;){if(c.return===null||c.return===a)return!0;c=c.return}c.sibling.return=c.return,c=c.sibling}}return!0}function So(a,c,f,p){c&=~gv,c&=~el,a.suspendedLanes|=c,a.pingedLanes&=~c,p&&(a.warmLanes|=c),p=a.expirationTimes;for(var _=c;0<_;){var v=31-Zn(_),S=1<<v;p[v]=-1,_&=~S}f!==0&&Js(a,f,c)}function Pp(){return(_t&6)===0?(zh(0),!1):!0}function Tv(){if(Je!==null){if(yt===0)var a=Je.return;else a=Je,ds=Ya=null,Fy(a),uc=null,Mh=0,a=Je;for(;a!==null;)sA(a.alternate,a),a=a.return;Je=null}}function yc(a,c){var f=a.timeoutHandle;f!==-1&&(a.timeoutHandle=-1,a6(f)),f=a.cancelPendingCommit,f!==null&&(a.cancelPendingCommit=null,f()),Tv(),Pt=a,Je=f=us(a.current,null),ct=c,yt=0,yr=null,wo=!1,pc=Zs(a,c),pv=!1,gc=Fr=gv=el=Eo=jt=0,ar=Bh=null,mv=!1,(c&8)!==0&&(c|=c&32);var p=a.entangledLanes;if(p!==0)for(a=a.entanglements,p&=c;0<p;){var _=31-Zn(p),v=1<<_;c|=a[_],p&=~v}return Ts=c,Qd(),f}function RA(a,c){Ge=null,P.H=_p,c===wh||c===ap?(c=$x(),yt=3):c===zx?(c=$x(),yt=4):yt=c===W1?8:c!==null&&typeof c=="object"&&typeof c.then=="function"?6:1,yr=c,Je===null&&(jt=1,wp(a,kr(c,a.current)))}function CA(){var a=P.H;return P.H=_p,a===null?_p:a}function IA(){var a=P.A;return P.A=zL,a}function wv(){jt=4,wo||(ct&4194048)!==ct&&Ur.current!==null||(pc=!0),(Eo&134217727)===0&&(el&134217727)===0||Pt===null||So(Pt,ct,Fr,!1)}function Ev(a,c,f){var p=_t;_t|=2;var _=CA(),v=IA();(Pt!==a||ct!==c)&&(Ip=null,yc(a,c)),c=!1;var S=jt;e:do try{if(yt!==0&&Je!==null){var k=Je,K=yr;switch(yt){case 8:Tv(),S=6;break e;case 3:case 2:case 9:case 6:Ur.current===null&&(c=!0);var ue=yt;if(yt=0,yr=null,vc(a,k,K,ue),f&&pc){S=0;break e}break;default:ue=yt,yt=0,yr=null,vc(a,k,K,ue)}}$L(),S=jt;break}catch(ge){RA(a,ge)}while(!0);return c&&a.shellSuspendCounter++,ds=Ya=null,_t=p,P.H=_,P.A=v,Je===null&&(Pt=null,ct=0,Qd()),S}function $L(){for(;Je!==null;)PA(Je)}function WL(a,c){var f=_t;_t|=2;var p=CA(),_=IA();Pt!==a||ct!==c?(Ip=null,Cp=ir()+500,yc(a,c)):pc=Zs(a,c);e:do try{if(yt!==0&&Je!==null){c=Je;var v=yr;t:switch(yt){case 1:yt=0,yr=null,vc(a,c,v,1);break;case 2:case 9:if(jx(v)){yt=0,yr=null,MA(c);break}c=function(){yt!==2&&yt!==9||Pt!==a||(yt=7),Mi(a)},v.then(c,c);break e;case 3:yt=7;break e;case 4:yt=5;break e;case 7:jx(v)?(yt=0,yr=null,MA(c)):(yt=0,yr=null,vc(a,c,v,7));break;case 5:var S=null;switch(Je.tag){case 26:S=Je.memoizedState;case 5:case 27:var k=Je;if(!S||fS(S)){yt=0,yr=null;var K=k.sibling;if(K!==null)Je=K;else{var ue=k.return;ue!==null?(Je=ue,Mp(ue)):Je=null}break t}}yt=0,yr=null,vc(a,c,v,5);break;case 6:yt=0,yr=null,vc(a,c,v,6);break;case 8:Tv(),jt=6;break e;default:throw Error(r(462))}}qL();break}catch(ge){RA(a,ge)}while(!0);return ds=Ya=null,P.H=p,P.A=_,_t=f,Je!==null?0:(Pt=null,ct=0,Qd(),jt)}function qL(){for(;Je!==null&&!lt();)PA(Je)}function PA(a){var c=rA(a.alternate,a,Ts);a.memoizedProps=a.pendingProps,c===null?Mp(a):Je=c}function MA(a){var c=a,f=c.alternate;switch(c.tag){case 15:case 0:c=Z1(f,c,c.pendingProps,c.type,void 0,ct);break;case 11:c=Z1(f,c,c.pendingProps,c.type.render,c.ref,ct);break;case 5:Fy(c);default:sA(f,c),c=Je=Ox(c,Ts),c=rA(f,c,Ts)}a.memoizedProps=a.pendingProps,c===null?Mp(a):Je=c}function vc(a,c,f,p){ds=Ya=null,Fy(c),uc=null,Mh=0;var _=c.return;try{if(DL(a,_,c,f,ct)){jt=1,wp(a,kr(f,a.current)),Je=null;return}}catch(v){if(_!==null)throw Je=_,v;jt=1,wp(a,kr(f,a.current)),Je=null;return}c.flags&32768?(ft||p===1?a=!0:pc||(ct&536870912)!==0?a=!1:(wo=a=!0,(p===2||p===9||p===3||p===6)&&(p=Ur.current,p!==null&&p.tag===13&&(p.flags|=16384))),OA(c,a)):Mp(c)}function Mp(a){var c=a;do{if((c.flags&32768)!==0){OA(c,wo);return}a=c.return;var f=UL(c.alternate,c,Ts);if(f!==null){Je=f;return}if(c=c.sibling,c!==null){Je=c;return}Je=c=a}while(c!==null);jt===0&&(jt=5)}function OA(a,c){do{var f=FL(a.alternate,a);if(f!==null){f.flags&=32767,Je=f;return}if(f=a.return,f!==null&&(f.flags|=32768,f.subtreeFlags=0,f.deletions=null),!c&&(a=a.sibling,a!==null)){Je=a;return}Je=a=f}while(a!==null);jt=6,Je=null}function kA(a,c,f,p,_,v,S,k,K){a.cancelPendingCommit=null;do Op();while(Cn!==0);if((_t&6)!==0)throw Error(r(327));if(c!==null){if(c===a.current)throw Error(r(177));if(v=c.lanes|c.childLanes,v|=dy,Dd(a,f,v,S,k,K),a===Pt&&(Je=Pt=null,ct=0),mc=c,Ao=a,_c=f,yv=v,vv=_,EA=p,(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,GL(ns,function(){return FA(),null})):(a.callbackNode=null,a.callbackPriority=0),p=(c.flags&13878)!==0,(c.subtreeFlags&13878)!==0||p){p=P.T,P.T=null,_=q.p,q.p=2,S=_t,_t|=4;try{BL(a,c,f)}finally{_t=S,q.p=_,P.T=p}}Cn=1,NA(),DA(),LA()}}function NA(){if(Cn===1){Cn=0;var a=Ao,c=mc,f=(c.flags&13878)!==0;if((c.subtreeFlags&13878)!==0||f){f=P.T,P.T=null;var p=q.p;q.p=2;var _=_t;_t|=4;try{mA(c,a);var v=Dv,S=wx(a.containerInfo),k=v.focusedElem,K=v.selectionRange;if(S!==k&&k&&k.ownerDocument&&Tx(k.ownerDocument.documentElement,k)){if(K!==null&&ly(k)){var ue=K.start,ge=K.end;if(ge===void 0&&(ge=ue),"selectionStart"in k)k.selectionStart=ue,k.selectionEnd=Math.min(ge,k.value.length);else{var ve=k.ownerDocument||document,he=ve&&ve.defaultView||window;if(he.getSelection){var fe=he.getSelection(),He=k.textContent.length,Fe=Math.min(K.start,He),Et=K.end===void 0?Fe:Math.min(K.end,He);!fe.extend&&Fe>Et&&(S=Et,Et=Fe,Fe=S);var ne=bx(k,Fe),Q=bx(k,Et);if(ne&&Q&&(fe.rangeCount!==1||fe.anchorNode!==ne.node||fe.anchorOffset!==ne.offset||fe.focusNode!==Q.node||fe.focusOffset!==Q.offset)){var le=ve.createRange();le.setStart(ne.node,ne.offset),fe.removeAllRanges(),Fe>Et?(fe.addRange(le),fe.extend(Q.node,Q.offset)):(le.setEnd(Q.node,Q.offset),fe.addRange(le))}}}}for(ve=[],fe=k;fe=fe.parentNode;)fe.nodeType===1&&ve.push({element:fe,left:fe.scrollLeft,top:fe.scrollTop});for(typeof k.focus=="function"&&k.focus(),k=0;k<ve.length;k++){var _e=ve[k];_e.element.scrollLeft=_e.left,_e.element.scrollTop=_e.top}}$p=!!Nv,Dv=Nv=null}finally{_t=_,q.p=p,P.T=f}}a.current=c,Cn=2}}function DA(){if(Cn===2){Cn=0;var a=Ao,c=mc,f=(c.flags&8772)!==0;if((c.subtreeFlags&8772)!==0||f){f=P.T,P.T=null;var p=q.p;q.p=2;var _=_t;_t|=4;try{fA(a,c.alternate,c)}finally{_t=_,q.p=p,P.T=f}}Cn=3}}function LA(){if(Cn===4||Cn===3){Cn=0,tt();var a=Ao,c=mc,f=_c,p=EA;(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?Cn=5:(Cn=0,mc=Ao=null,UA(a,a.pendingLanes));var _=a.pendingLanes;if(_===0&&(xo=null),Qu(f),c=c.stateNode,Un&&typeof Un.onCommitFiberRoot=="function")try{Un.onCommitFiberRoot(Ks,c,void 0,(c.current.flags&128)===128)}catch{}if(p!==null){c=P.T,_=q.p,q.p=2,P.T=null;try{for(var v=a.onRecoverableError,S=0;S<p.length;S++){var k=p[S];v(k.value,{componentStack:k.stack})}}finally{P.T=c,q.p=_}}(_c&3)!==0&&Op(),Mi(a),_=a.pendingLanes,(f&4194090)!==0&&(_&42)!==0?a===bv?Vh++:(Vh=0,bv=a):Vh=0,zh(0)}}function UA(a,c){(a.pooledCacheLanes&=c)===0&&(c=a.pooledCache,c!=null&&(a.pooledCache=null,bh(c)))}function Op(a){return NA(),DA(),LA(),FA()}function FA(){if(Cn!==5)return!1;var a=Ao,c=yv;yv=0;var f=Qu(_c),p=P.T,_=q.p;try{q.p=32>f?32:f,P.T=null,f=vv,vv=null;var v=Ao,S=_c;if(Cn=0,mc=Ao=null,_c=0,(_t&6)!==0)throw Error(r(331));var k=_t;if(_t|=4,TA(v.current),yA(v,v.current,S,f),_t=k,zh(0,!1),Un&&typeof Un.onPostCommitFiberRoot=="function")try{Un.onPostCommitFiberRoot(Ks,v)}catch{}return!0}finally{q.p=_,P.T=p,UA(a,c)}}function BA(a,c,f){c=kr(f,c),c=Qy(a.stateNode,c,2),a=go(a,c,2),a!==null&&(Wt(a,2),Mi(a))}function Rt(a,c,f){if(a.tag===3)BA(a,a,f);else for(;c!==null;){if(c.tag===3){BA(c,a,f);break}else if(c.tag===1){var p=c.stateNode;if(typeof c.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(xo===null||!xo.has(p))){a=kr(f,a),f=H1(2),p=go(c,f,2),p!==null&&($1(f,p,c,a),Wt(p,2),Mi(p));break}}c=c.return}}function xv(a,c,f){var p=a.pingCache;if(p===null){p=a.pingCache=new jL;var _=new Set;p.set(c,_)}else _=p.get(c),_===void 0&&(_=new Set,p.set(c,_));_.has(f)||(pv=!0,_.add(f),a=XL.bind(null,a,c,f),c.then(a,a))}function XL(a,c,f){var p=a.pingCache;p!==null&&p.delete(c),a.pingedLanes|=a.suspendedLanes&f,a.warmLanes&=~f,Pt===a&&(ct&f)===f&&(jt===4||jt===3&&(ct&62914560)===ct&&300>ir()-_v?(_t&2)===0&&yc(a,0):gv|=f,gc===ct&&(gc=0)),Mi(a)}function VA(a,c){c===0&&(c=Qs()),a=ec(a,c),a!==null&&(Wt(a,c),Mi(a))}function YL(a){var c=a.memoizedState,f=0;c!==null&&(f=c.retryLane),VA(a,f)}function KL(a,c){var f=0;switch(a.tag){case 13:var p=a.stateNode,_=a.memoizedState;_!==null&&(f=_.retryLane);break;case 19:p=a.stateNode;break;case 22:p=a.stateNode._retryCache;break;default:throw Error(r(314))}p!==null&&p.delete(c),VA(a,f)}function GL(a,c){return Gn(a,c)}var kp=null,bc=null,Av=!1,Np=!1,Sv=!1,tl=0;function Mi(a){a!==bc&&a.next===null&&(bc===null?kp=bc=a:bc=bc.next=a),Np=!0,Av||(Av=!0,QL())}function zh(a,c){if(!Sv&&Np){Sv=!0;do for(var f=!1,p=kp;p!==null;){if(a!==0){var _=p.pendingLanes;if(_===0)var v=0;else{var S=p.suspendedLanes,k=p.pingedLanes;v=(1<<31-Zn(42|a)+1)-1,v&=_&~(S&~k),v=v&201326741?v&201326741|1:v?v|2:0}v!==0&&(f=!0,$A(p,v))}else v=ct,v=Ir(p,p===Pt?v:0,p.cancelPendingCommit!==null||p.timeoutHandle!==-1),(v&3)===0||Zs(p,v)||(f=!0,$A(p,v));p=p.next}while(f);Sv=!1}}function ZL(){zA()}function zA(){Np=Av=!1;var a=0;tl!==0&&(o6()&&(a=tl),tl=0);for(var c=ir(),f=null,p=kp;p!==null;){var _=p.next,v=jA(p,c);v===0?(p.next=null,f===null?kp=_:f.next=_,_===null&&(bc=f)):(f=p,(a!==0||(v&3)!==0)&&(Np=!0)),p=_}zh(a)}function jA(a,c){for(var f=a.suspendedLanes,p=a.pingedLanes,_=a.expirationTimes,v=a.pendingLanes&-62914561;0<v;){var S=31-Zn(v),k=1<<S,K=_[S];K===-1?((k&f)===0||(k&p)!==0)&&(_[S]=Ul(k,c)):K<=c&&(a.expiredLanes|=k),v&=~k}if(c=Pt,f=ct,f=Ir(a,a===c?f:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),p=a.callbackNode,f===0||a===c&&(yt===2||yt===9)||a.cancelPendingCommit!==null)return p!==null&&p!==null&&ts(p),a.callbackNode=null,a.callbackPriority=0;if((f&3)===0||Zs(a,f)){if(c=f&-f,c===a.callbackPriority)return c;switch(p!==null&&ts(p),Qu(f)){case 2:case 8:f=_n;break;case 32:f=ns;break;case 268435456:f=Ku;break;default:f=ns}return p=HA.bind(null,a),f=Gn(f,p),a.callbackPriority=c,a.callbackNode=f,c}return p!==null&&p!==null&&ts(p),a.callbackPriority=2,a.callbackNode=null,2}function HA(a,c){if(Cn!==0&&Cn!==5)return a.callbackNode=null,a.callbackPriority=0,null;var f=a.callbackNode;if(Op()&&a.callbackNode!==f)return null;var p=ct;return p=Ir(a,a===Pt?p:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),p===0?null:(AA(a,p,c),jA(a,ir()),a.callbackNode!=null&&a.callbackNode===f?HA.bind(null,a):null)}function $A(a,c){if(Op())return null;AA(a,c,!0)}function QL(){l6(function(){(_t&6)!==0?Gn(an,ZL):zA()})}function Rv(){return tl===0&&(tl=Gu()),tl}function WA(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:Qr(""+a)}function qA(a,c){var f=c.ownerDocument.createElement("input");return f.name=c.name,f.value=c.value,a.id&&f.setAttribute("form",a.id),c.parentNode.insertBefore(f,c),a=new FormData(a),f.parentNode.removeChild(f),a}function JL(a,c,f,p,_){if(c==="submit"&&f&&f.stateNode===_){var v=WA((_[Sn]||null).action),S=p.submitter;S&&(c=(c=S[Sn]||null)?WA(c.formAction):S.getAttribute("formAction"),c!==null&&(v=c,S=null));var k=new Na("action","action",null,p,_);a.push({event:k,listeners:[{instance:null,listener:function(){if(p.defaultPrevented){if(tl!==0){var K=S?qA(_,S):new FormData(_);Xy(f,{pending:!0,data:K,method:_.method,action:v},null,K)}}else typeof v=="function"&&(k.preventDefault(),K=S?qA(_,S):new FormData(_),Xy(f,{pending:!0,data:K,method:_.method,action:v},v,K))},currentTarget:_}]})}}for(var Cv=0;Cv<fy.length;Cv++){var Iv=fy[Cv],e6=Iv.toLowerCase(),t6=Iv[0].toUpperCase()+Iv.slice(1);ni(e6,"on"+t6)}ni(Ax,"onAnimationEnd"),ni(Sx,"onAnimationIteration"),ni(Rx,"onAnimationStart"),ni("dblclick","onDoubleClick"),ni("focusin","onFocus"),ni("focusout","onBlur"),ni(yL,"onTransitionRun"),ni(vL,"onTransitionStart"),ni(bL,"onTransitionCancel"),ni(Cx,"onTransitionEnd"),Ei("onMouseEnter",["mouseout","mouseover"]),Ei("onMouseLeave",["mouseout","mouseover"]),Ei("onPointerEnter",["pointerout","pointerover"]),Ei("onPointerLeave",["pointerout","pointerover"]),wi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),wi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),wi("onBeforeInput",["compositionend","keypress","textInput","paste"]),wi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),wi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),wi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var jh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),n6=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(jh));function XA(a,c){c=(c&4)!==0;for(var f=0;f<a.length;f++){var p=a[f],_=p.event;p=p.listeners;e:{var v=void 0;if(c)for(var S=p.length-1;0<=S;S--){var k=p[S],K=k.instance,ue=k.currentTarget;if(k=k.listener,K!==v&&_.isPropagationStopped())break e;v=k,_.currentTarget=ue;try{v(_)}catch(ge){Tp(ge)}_.currentTarget=null,v=K}else for(S=0;S<p.length;S++){if(k=p[S],K=k.instance,ue=k.currentTarget,k=k.listener,K!==v&&_.isPropagationStopped())break e;v=k,_.currentTarget=ue;try{v(_)}catch(ge){Tp(ge)}_.currentTarget=null,v=K}}}}function et(a,c){var f=c[Ta];f===void 0&&(f=c[Ta]=new Set);var p=a+"__bubble";f.has(p)||(YA(c,a,2,!1),f.add(p))}function Pv(a,c,f){var p=0;c&&(p|=4),YA(f,a,p,c)}var Dp="_reactListening"+Math.random().toString(36).slice(2);function Mv(a){if(!a[Dp]){a[Dp]=!0,Ld.forEach(function(f){f!=="selectionchange"&&(n6.has(f)||Pv(f,!1,a),Pv(f,!0,a))});var c=a.nodeType===9?a:a.ownerDocument;c===null||c[Dp]||(c[Dp]=!0,Pv("selectionchange",!1,c))}}function YA(a,c,f,p){switch(yS(c)){case 2:var _=I6;break;case 8:_=P6;break;default:_=Wv}f=_.bind(null,c,f,a),_=void 0,!ls||c!=="touchstart"&&c!=="touchmove"&&c!=="wheel"||(_=!0),p?_!==void 0?a.addEventListener(c,f,{capture:!0,passive:_}):a.addEventListener(c,f,!0):_!==void 0?a.addEventListener(c,f,{passive:_}):a.addEventListener(c,f,!1)}function Ov(a,c,f,p,_){var v=p;if((c&1)===0&&(c&2)===0&&p!==null)e:for(;;){if(p===null)return;var S=p.tag;if(S===3||S===4){var k=p.stateNode.containerInfo;if(k===_)break;if(S===4)for(S=p.return;S!==null;){var K=S.tag;if((K===3||K===4)&&S.stateNode.containerInfo===_)return;S=S.return}for(;k!==null;){if(S=bi(k),S===null)return;if(K=S.tag,K===5||K===6||K===26||K===27){p=v=S;continue e}k=k.parentNode}}p=p.return}Ma(function(){var ue=v,ge=sh(f),ve=[];e:{var he=Ix.get(a);if(he!==void 0){var fe=Na,He=a;switch(a){case"keypress":if(Oa(f)===0)break e;case"keydown":case"keyup":fe=Gl;break;case"focusin":He="focus",fe=Xl;break;case"focusout":He="blur",fe=Xl;break;case"beforeblur":case"afterblur":fe=Xl;break;case"click":if(f.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":fe=Ba;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":fe=Hd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":fe=uo;break;case Ax:case Sx:case Rx:fe=ah;break;case Cx:fe=T;break;case"scroll":case"scrollend":fe=La;break;case"wheel":fe=F;break;case"copy":case"cut":case"paste":fe=Wd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":fe=uh;break;case"toggle":case"beforetoggle":fe=pe}var Fe=(c&4)!==0,Et=!Fe&&(a==="scroll"||a==="scrollend"),ne=Fe?he!==null?he+"Capture":null:he;Fe=[];for(var Q=ue,le;Q!==null;){var _e=Q;if(le=_e.stateNode,_e=_e.tag,_e!==5&&_e!==26&&_e!==27||le===null||ne===null||(_e=lo(Q,ne),_e!=null&&Fe.push(Hh(Q,_e,le))),Et)break;Q=Q.return}0<Fe.length&&(he=new fe(he,He,null,f,ge),ve.push({event:he,listeners:Fe}))}}if((c&7)===0){e:{if(he=a==="mouseover"||a==="pointerover",fe=a==="mouseout"||a==="pointerout",he&&f!==ih&&(He=f.relatedTarget||f.fromElement)&&(bi(He)||He[is]))break e;if((fe||he)&&(he=ge.window===ge?ge:(he=ge.ownerDocument)?he.defaultView||he.parentWindow:window,fe?(He=f.relatedTarget||f.toElement,fe=ue,He=He?bi(He):null,He!==null&&(Et=s(He),Fe=He.tag,He!==Et||Fe!==5&&Fe!==27&&Fe!==6)&&(He=null)):(fe=null,He=ue),fe!==He)){if(Fe=Ba,_e="onMouseLeave",ne="onMouseEnter",Q="mouse",(a==="pointerout"||a==="pointerover")&&(Fe=uh,_e="onPointerLeave",ne="onPointerEnter",Q="pointer"),Et=fe==null?he:no(fe),le=He==null?he:no(He),he=new Fe(_e,Q+"leave",fe,f,ge),he.target=Et,he.relatedTarget=le,_e=null,bi(ge)===ue&&(Fe=new Fe(ne,Q+"enter",He,f,ge),Fe.target=le,Fe.relatedTarget=Et,_e=Fe),Et=_e,fe&&He)t:{for(Fe=fe,ne=He,Q=0,le=Fe;le;le=Tc(le))Q++;for(le=0,_e=ne;_e;_e=Tc(_e))le++;for(;0<Q-le;)Fe=Tc(Fe),Q--;for(;0<le-Q;)ne=Tc(ne),le--;for(;Q--;){if(Fe===ne||ne!==null&&Fe===ne.alternate)break t;Fe=Tc(Fe),ne=Tc(ne)}Fe=null}else Fe=null;fe!==null&&KA(ve,he,fe,Fe,!1),He!==null&&Et!==null&&KA(ve,Et,He,Fe,!0)}}e:{if(he=ue?no(ue):window,fe=he.nodeName&&he.nodeName.toLowerCase(),fe==="select"||fe==="input"&&he.type==="file")var Oe=px;else if(fx(he))if(gx)Oe=gL;else{Oe=dL;var Qe=fL}else fe=he.nodeName,!fe||fe.toLowerCase()!=="input"||he.type!=="checkbox"&&he.type!=="radio"?ue&&$l(ue.elementType)&&(Oe=px):Oe=pL;if(Oe&&(Oe=Oe(a,ue))){dx(ve,Oe,f,ge);break e}Qe&&Qe(a,he,ue),a==="focusout"&&ue&&he.type==="number"&&ue.memoizedProps.value!=null&&th(he,"number",he.value)}switch(Qe=ue?no(ue):window,a){case"focusin":(fx(Qe)||Qe.contentEditable==="true")&&(Zl=Qe,cy=ue,gh=null);break;case"focusout":gh=cy=Zl=null;break;case"mousedown":uy=!0;break;case"contextmenu":case"mouseup":case"dragend":uy=!1,Ex(ve,f,ge);break;case"selectionchange":if(_L)break;case"keydown":case"keyup":Ex(ve,f,ge)}var De;if(We)e:{switch(a){case"compositionstart":var Be="onCompositionStart";break e;case"compositionend":Be="onCompositionEnd";break e;case"compositionupdate":Be="onCompositionUpdate";break e}Be=void 0}else ti?Jr(a,f)&&(Be="onCompositionEnd"):a==="keydown"&&f.keyCode===229&&(Be="onCompositionStart");Be&&(Yt&&f.locale!=="ko"&&(ti||Be!=="onCompositionStart"?Be==="onCompositionEnd"&&ti&&(De=jd()):(Or=ge,It="value"in Or?Or.value:Or.textContent,ti=!0)),Qe=Lp(ue,Be),0<Qe.length&&(Be=new ch(Be,a,null,f,ge),ve.push({event:Be,listeners:Qe}),De?Be.data=De:(De=ei(f),De!==null&&(Be.data=De)))),(De=mt?hh(a,f):cL(a,f))&&(Be=Lp(ue,"onBeforeInput"),0<Be.length&&(Qe=new ch("onBeforeInput","beforeinput",null,f,ge),ve.push({event:Qe,listeners:Be}),Qe.data=De)),JL(ve,a,ue,f,ge)}XA(ve,c)})}function Hh(a,c,f){return{instance:a,listener:c,currentTarget:f}}function Lp(a,c){for(var f=c+"Capture",p=[];a!==null;){var _=a,v=_.stateNode;if(_=_.tag,_!==5&&_!==26&&_!==27||v===null||(_=lo(a,f),_!=null&&p.unshift(Hh(a,_,v)),_=lo(a,c),_!=null&&p.push(Hh(a,_,v))),a.tag===3)return p;a=a.return}return[]}function Tc(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function KA(a,c,f,p,_){for(var v=c._reactName,S=[];f!==null&&f!==p;){var k=f,K=k.alternate,ue=k.stateNode;if(k=k.tag,K!==null&&K===p)break;k!==5&&k!==26&&k!==27||ue===null||(K=ue,_?(ue=lo(f,v),ue!=null&&S.unshift(Hh(f,ue,K))):_||(ue=lo(f,v),ue!=null&&S.push(Hh(f,ue,K)))),f=f.return}S.length!==0&&a.push({event:c,listeners:S})}var r6=/\r\n?/g,i6=/\u0000|\uFFFD/g;function GA(a){return(typeof a=="string"?a:""+a).replace(r6,`
`).replace(i6,"")}function ZA(a,c){return c=GA(c),GA(a)===c}function Up(){}function wt(a,c,f,p,_,v){switch(f){case"children":typeof p=="string"?c==="body"||c==="textarea"&&p===""||Mr(a,p):(typeof p=="number"||typeof p=="bigint")&&c!=="body"&&Mr(a,""+p);break;case"className":Sa(a,"class",p);break;case"tabIndex":Sa(a,"tabindex",p);break;case"dir":case"role":case"viewBox":case"width":case"height":Sa(a,f,p);break;case"style":rh(a,p,v);break;case"data":if(c!=="object"){Sa(a,"data",p);break}case"src":case"href":if(p===""&&(c!=="a"||f!=="href")){a.removeAttribute(f);break}if(p==null||typeof p=="function"||typeof p=="symbol"||typeof p=="boolean"){a.removeAttribute(f);break}p=Qr(""+p),a.setAttribute(f,p);break;case"action":case"formAction":if(typeof p=="function"){a.setAttribute(f,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof v=="function"&&(f==="formAction"?(c!=="input"&&wt(a,c,"name",_.name,_,null),wt(a,c,"formEncType",_.formEncType,_,null),wt(a,c,"formMethod",_.formMethod,_,null),wt(a,c,"formTarget",_.formTarget,_,null)):(wt(a,c,"encType",_.encType,_,null),wt(a,c,"method",_.method,_,null),wt(a,c,"target",_.target,_,null)));if(p==null||typeof p=="symbol"||typeof p=="boolean"){a.removeAttribute(f);break}p=Qr(""+p),a.setAttribute(f,p);break;case"onClick":p!=null&&(a.onclick=Up);break;case"onScroll":p!=null&&et("scroll",a);break;case"onScrollEnd":p!=null&&et("scrollend",a);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(r(61));if(f=p.__html,f!=null){if(_.children!=null)throw Error(r(60));a.innerHTML=f}}break;case"multiple":a.multiple=p&&typeof p!="function"&&typeof p!="symbol";break;case"muted":a.muted=p&&typeof p!="function"&&typeof p!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(p==null||typeof p=="function"||typeof p=="boolean"||typeof p=="symbol"){a.removeAttribute("xlink:href");break}f=Qr(""+p),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",f);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":p!=null&&typeof p!="function"&&typeof p!="symbol"?a.setAttribute(f,""+p):a.removeAttribute(f);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":p&&typeof p!="function"&&typeof p!="symbol"?a.setAttribute(f,""):a.removeAttribute(f);break;case"capture":case"download":p===!0?a.setAttribute(f,""):p!==!1&&p!=null&&typeof p!="function"&&typeof p!="symbol"?a.setAttribute(f,p):a.removeAttribute(f);break;case"cols":case"rows":case"size":case"span":p!=null&&typeof p!="function"&&typeof p!="symbol"&&!isNaN(p)&&1<=p?a.setAttribute(f,p):a.removeAttribute(f);break;case"rowSpan":case"start":p==null||typeof p=="function"||typeof p=="symbol"||isNaN(p)?a.removeAttribute(f):a.setAttribute(f,p);break;case"popover":et("beforetoggle",a),et("toggle",a),Aa(a,"popover",p);break;case"xlinkActuate":Pr(a,"http://www.w3.org/1999/xlink","xlink:actuate",p);break;case"xlinkArcrole":Pr(a,"http://www.w3.org/1999/xlink","xlink:arcrole",p);break;case"xlinkRole":Pr(a,"http://www.w3.org/1999/xlink","xlink:role",p);break;case"xlinkShow":Pr(a,"http://www.w3.org/1999/xlink","xlink:show",p);break;case"xlinkTitle":Pr(a,"http://www.w3.org/1999/xlink","xlink:title",p);break;case"xlinkType":Pr(a,"http://www.w3.org/1999/xlink","xlink:type",p);break;case"xmlBase":Pr(a,"http://www.w3.org/XML/1998/namespace","xml:base",p);break;case"xmlLang":Pr(a,"http://www.w3.org/XML/1998/namespace","xml:lang",p);break;case"xmlSpace":Pr(a,"http://www.w3.org/XML/1998/namespace","xml:space",p);break;case"is":Aa(a,"is",p);break;case"innerText":case"textContent":break;default:(!(2<f.length)||f[0]!=="o"&&f[0]!=="O"||f[1]!=="n"&&f[1]!=="N")&&(f=Bd.get(f)||f,Aa(a,f,p))}}function kv(a,c,f,p,_,v){switch(f){case"style":rh(a,p,v);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(r(61));if(f=p.__html,f!=null){if(_.children!=null)throw Error(r(60));a.innerHTML=f}}break;case"children":typeof p=="string"?Mr(a,p):(typeof p=="number"||typeof p=="bigint")&&Mr(a,""+p);break;case"onScroll":p!=null&&et("scroll",a);break;case"onScrollEnd":p!=null&&et("scrollend",a);break;case"onClick":p!=null&&(a.onclick=Up);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Ea.hasOwnProperty(f))e:{if(f[0]==="o"&&f[1]==="n"&&(_=f.endsWith("Capture"),c=f.slice(2,_?f.length-7:void 0),v=a[Sn]||null,v=v!=null?v[f]:null,typeof v=="function"&&a.removeEventListener(c,v,_),typeof p=="function")){typeof v!="function"&&v!==null&&(f in a?a[f]=null:a.hasAttribute(f)&&a.removeAttribute(f)),a.addEventListener(c,p,_);break e}f in a?a[f]=p:p===!0?a.setAttribute(f,""):Aa(a,f,p)}}}function In(a,c,f){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":et("error",a),et("load",a);var p=!1,_=!1,v;for(v in f)if(f.hasOwnProperty(v)){var S=f[v];if(S!=null)switch(v){case"src":p=!0;break;case"srcSet":_=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,c));default:wt(a,c,v,S,f,null)}}_&&wt(a,c,"srcSet",f.srcSet,f,null),p&&wt(a,c,"src",f.src,f,null);return;case"input":et("invalid",a);var k=v=S=_=null,K=null,ue=null;for(p in f)if(f.hasOwnProperty(p)){var ge=f[p];if(ge!=null)switch(p){case"name":_=ge;break;case"type":S=ge;break;case"checked":K=ge;break;case"defaultChecked":ue=ge;break;case"value":v=ge;break;case"defaultValue":k=ge;break;case"children":case"dangerouslySetInnerHTML":if(ge!=null)throw Error(r(137,c));break;default:wt(a,c,p,ge,f,null)}}eh(a,v,k,K,ue,S,_,!1),so(a);return;case"select":et("invalid",a),p=S=v=null;for(_ in f)if(f.hasOwnProperty(_)&&(k=f[_],k!=null))switch(_){case"value":v=k;break;case"defaultValue":S=k;break;case"multiple":p=k;default:wt(a,c,_,k,f,null)}c=v,f=S,a.multiple=!!p,c!=null?oo(a,!!p,c,!1):f!=null&&oo(a,!!p,f,!0);return;case"textarea":et("invalid",a),v=_=p=null;for(S in f)if(f.hasOwnProperty(S)&&(k=f[S],k!=null))switch(S){case"value":p=k;break;case"defaultValue":_=k;break;case"children":v=k;break;case"dangerouslySetInnerHTML":if(k!=null)throw Error(r(91));break;default:wt(a,c,S,k,f,null)}Fd(a,p,_,v),so(a);return;case"option":for(K in f)if(f.hasOwnProperty(K)&&(p=f[K],p!=null))switch(K){case"selected":a.selected=p&&typeof p!="function"&&typeof p!="symbol";break;default:wt(a,c,K,p,f,null)}return;case"dialog":et("beforetoggle",a),et("toggle",a),et("cancel",a),et("close",a);break;case"iframe":case"object":et("load",a);break;case"video":case"audio":for(p=0;p<jh.length;p++)et(jh[p],a);break;case"image":et("error",a),et("load",a);break;case"details":et("toggle",a);break;case"embed":case"source":case"link":et("error",a),et("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ue in f)if(f.hasOwnProperty(ue)&&(p=f[ue],p!=null))switch(ue){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,c));default:wt(a,c,ue,p,f,null)}return;default:if($l(c)){for(ge in f)f.hasOwnProperty(ge)&&(p=f[ge],p!==void 0&&kv(a,c,ge,p,f,void 0));return}}for(k in f)f.hasOwnProperty(k)&&(p=f[k],p!=null&&wt(a,c,k,p,f,null))}function s6(a,c,f,p){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var _=null,v=null,S=null,k=null,K=null,ue=null,ge=null;for(fe in f){var ve=f[fe];if(f.hasOwnProperty(fe)&&ve!=null)switch(fe){case"checked":break;case"value":break;case"defaultValue":K=ve;default:p.hasOwnProperty(fe)||wt(a,c,fe,null,p,ve)}}for(var he in p){var fe=p[he];if(ve=f[he],p.hasOwnProperty(he)&&(fe!=null||ve!=null))switch(he){case"type":v=fe;break;case"name":_=fe;break;case"checked":ue=fe;break;case"defaultChecked":ge=fe;break;case"value":S=fe;break;case"defaultValue":k=fe;break;case"children":case"dangerouslySetInnerHTML":if(fe!=null)throw Error(r(137,c));break;default:fe!==ve&&wt(a,c,he,fe,p,ve)}}Ju(a,S,k,K,ue,ge,v,_);return;case"select":fe=S=k=he=null;for(v in f)if(K=f[v],f.hasOwnProperty(v)&&K!=null)switch(v){case"value":break;case"multiple":fe=K;default:p.hasOwnProperty(v)||wt(a,c,v,null,p,K)}for(_ in p)if(v=p[_],K=f[_],p.hasOwnProperty(_)&&(v!=null||K!=null))switch(_){case"value":he=v;break;case"defaultValue":k=v;break;case"multiple":S=v;default:v!==K&&wt(a,c,_,v,p,K)}c=k,f=S,p=fe,he!=null?oo(a,!!f,he,!1):!!p!=!!f&&(c!=null?oo(a,!!f,c,!0):oo(a,!!f,f?[]:"",!1));return;case"textarea":fe=he=null;for(k in f)if(_=f[k],f.hasOwnProperty(k)&&_!=null&&!p.hasOwnProperty(k))switch(k){case"value":break;case"children":break;default:wt(a,c,k,null,p,_)}for(S in p)if(_=p[S],v=f[S],p.hasOwnProperty(S)&&(_!=null||v!=null))switch(S){case"value":he=_;break;case"defaultValue":fe=_;break;case"children":break;case"dangerouslySetInnerHTML":if(_!=null)throw Error(r(91));break;default:_!==v&&wt(a,c,S,_,p,v)}Ud(a,he,fe);return;case"option":for(var He in f)if(he=f[He],f.hasOwnProperty(He)&&he!=null&&!p.hasOwnProperty(He))switch(He){case"selected":a.selected=!1;break;default:wt(a,c,He,null,p,he)}for(K in p)if(he=p[K],fe=f[K],p.hasOwnProperty(K)&&he!==fe&&(he!=null||fe!=null))switch(K){case"selected":a.selected=he&&typeof he!="function"&&typeof he!="symbol";break;default:wt(a,c,K,he,p,fe)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Fe in f)he=f[Fe],f.hasOwnProperty(Fe)&&he!=null&&!p.hasOwnProperty(Fe)&&wt(a,c,Fe,null,p,he);for(ue in p)if(he=p[ue],fe=f[ue],p.hasOwnProperty(ue)&&he!==fe&&(he!=null||fe!=null))switch(ue){case"children":case"dangerouslySetInnerHTML":if(he!=null)throw Error(r(137,c));break;default:wt(a,c,ue,he,p,fe)}return;default:if($l(c)){for(var Et in f)he=f[Et],f.hasOwnProperty(Et)&&he!==void 0&&!p.hasOwnProperty(Et)&&kv(a,c,Et,void 0,p,he);for(ge in p)he=p[ge],fe=f[ge],!p.hasOwnProperty(ge)||he===fe||he===void 0&&fe===void 0||kv(a,c,ge,he,p,fe);return}}for(var ne in f)he=f[ne],f.hasOwnProperty(ne)&&he!=null&&!p.hasOwnProperty(ne)&&wt(a,c,ne,null,p,he);for(ve in p)he=p[ve],fe=f[ve],!p.hasOwnProperty(ve)||he===fe||he==null&&fe==null||wt(a,c,ve,he,p,fe)}var Nv=null,Dv=null;function Fp(a){return a.nodeType===9?a:a.ownerDocument}function QA(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function JA(a,c){if(a===0)switch(c){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&c==="foreignObject"?0:a}function Lv(a,c){return a==="textarea"||a==="noscript"||typeof c.children=="string"||typeof c.children=="number"||typeof c.children=="bigint"||typeof c.dangerouslySetInnerHTML=="object"&&c.dangerouslySetInnerHTML!==null&&c.dangerouslySetInnerHTML.__html!=null}var Uv=null;function o6(){var a=window.event;return a&&a.type==="popstate"?a===Uv?!1:(Uv=a,!0):(Uv=null,!1)}var eS=typeof setTimeout=="function"?setTimeout:void 0,a6=typeof clearTimeout=="function"?clearTimeout:void 0,tS=typeof Promise=="function"?Promise:void 0,l6=typeof queueMicrotask=="function"?queueMicrotask:typeof tS<"u"?function(a){return tS.resolve(null).then(a).catch(c6)}:eS;function c6(a){setTimeout(function(){throw a})}function Ro(a){return a==="head"}function nS(a,c){var f=c,p=0,_=0;do{var v=f.nextSibling;if(a.removeChild(f),v&&v.nodeType===8)if(f=v.data,f==="/$"){if(0<p&&8>p){f=p;var S=a.ownerDocument;if(f&1&&$h(S.documentElement),f&2&&$h(S.body),f&4)for(f=S.head,$h(f),S=f.firstChild;S;){var k=S.nextSibling,K=S.nodeName;S[to]||K==="SCRIPT"||K==="STYLE"||K==="LINK"&&S.rel.toLowerCase()==="stylesheet"||f.removeChild(S),S=k}}if(_===0){a.removeChild(v),Qh(c);return}_--}else f==="$"||f==="$?"||f==="$!"?_++:p=f.charCodeAt(0)-48;else p=0;f=v}while(f);Qh(c)}function Fv(a){var c=a.firstChild;for(c&&c.nodeType===10&&(c=c.nextSibling);c;){var f=c;switch(c=c.nextSibling,f.nodeName){case"HTML":case"HEAD":case"BODY":Fv(f),Bl(f);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(f.rel.toLowerCase()==="stylesheet")continue}a.removeChild(f)}}function u6(a,c,f,p){for(;a.nodeType===1;){var _=f;if(a.nodeName.toLowerCase()!==c.toLowerCase()){if(!p&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(p){if(!a[to])switch(c){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(v=a.getAttribute("rel"),v==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(v!==_.rel||a.getAttribute("href")!==(_.href==null||_.href===""?null:_.href)||a.getAttribute("crossorigin")!==(_.crossOrigin==null?null:_.crossOrigin)||a.getAttribute("title")!==(_.title==null?null:_.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(v=a.getAttribute("src"),(v!==(_.src==null?null:_.src)||a.getAttribute("type")!==(_.type==null?null:_.type)||a.getAttribute("crossorigin")!==(_.crossOrigin==null?null:_.crossOrigin))&&v&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(c==="input"&&a.type==="hidden"){var v=_.name==null?null:""+_.name;if(_.type==="hidden"&&a.getAttribute("name")===v)return a}else return a;if(a=ii(a.nextSibling),a===null)break}return null}function h6(a,c,f){if(c==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!f||(a=ii(a.nextSibling),a===null))return null;return a}function Bv(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState==="complete"}function f6(a,c){var f=a.ownerDocument;if(a.data!=="$?"||f.readyState==="complete")c();else{var p=function(){c(),f.removeEventListener("DOMContentLoaded",p)};f.addEventListener("DOMContentLoaded",p),a._reactRetry=p}}function ii(a){for(;a!=null;a=a.nextSibling){var c=a.nodeType;if(c===1||c===3)break;if(c===8){if(c=a.data,c==="$"||c==="$!"||c==="$?"||c==="F!"||c==="F")break;if(c==="/$")return null}}return a}var Vv=null;function rS(a){a=a.previousSibling;for(var c=0;a;){if(a.nodeType===8){var f=a.data;if(f==="$"||f==="$!"||f==="$?"){if(c===0)return a;c--}else f==="/$"&&c++}a=a.previousSibling}return null}function iS(a,c,f){switch(c=Fp(f),a){case"html":if(a=c.documentElement,!a)throw Error(r(452));return a;case"head":if(a=c.head,!a)throw Error(r(453));return a;case"body":if(a=c.body,!a)throw Error(r(454));return a;default:throw Error(r(451))}}function $h(a){for(var c=a.attributes;c.length;)a.removeAttributeNode(c[0]);Bl(a)}var Br=new Map,sS=new Set;function Bp(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var ws=q.d;q.d={f:d6,r:p6,D:g6,C:m6,L:_6,m:y6,X:b6,S:v6,M:T6};function d6(){var a=ws.f(),c=Pp();return a||c}function p6(a){var c=Ti(a);c!==null&&c.tag===5&&c.type==="form"?A1(c):ws.r(a)}var wc=typeof document>"u"?null:document;function oS(a,c,f){var p=wc;if(p&&typeof c=="string"&&c){var _=yn(c);_='link[rel="'+a+'"][href="'+_+'"]',typeof f=="string"&&(_+='[crossorigin="'+f+'"]'),sS.has(_)||(sS.add(_),a={rel:a,crossOrigin:f,href:c},p.querySelector(_)===null&&(c=p.createElement("link"),In(c,"link",a),Xt(c),p.head.appendChild(c)))}}function g6(a){ws.D(a),oS("dns-prefetch",a,null)}function m6(a,c){ws.C(a,c),oS("preconnect",a,c)}function _6(a,c,f){ws.L(a,c,f);var p=wc;if(p&&a&&c){var _='link[rel="preload"][as="'+yn(c)+'"]';c==="image"&&f&&f.imageSrcSet?(_+='[imagesrcset="'+yn(f.imageSrcSet)+'"]',typeof f.imageSizes=="string"&&(_+='[imagesizes="'+yn(f.imageSizes)+'"]')):_+='[href="'+yn(a)+'"]';var v=_;switch(c){case"style":v=Ec(a);break;case"script":v=xc(a)}Br.has(v)||(a=d({rel:"preload",href:c==="image"&&f&&f.imageSrcSet?void 0:a,as:c},f),Br.set(v,a),p.querySelector(_)!==null||c==="style"&&p.querySelector(Wh(v))||c==="script"&&p.querySelector(qh(v))||(c=p.createElement("link"),In(c,"link",a),Xt(c),p.head.appendChild(c)))}}function y6(a,c){ws.m(a,c);var f=wc;if(f&&a){var p=c&&typeof c.as=="string"?c.as:"script",_='link[rel="modulepreload"][as="'+yn(p)+'"][href="'+yn(a)+'"]',v=_;switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":v=xc(a)}if(!Br.has(v)&&(a=d({rel:"modulepreload",href:a},c),Br.set(v,a),f.querySelector(_)===null)){switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(f.querySelector(qh(v)))return}p=f.createElement("link"),In(p,"link",a),Xt(p),f.head.appendChild(p)}}}function v6(a,c,f){ws.S(a,c,f);var p=wc;if(p&&a){var _=ro(p).hoistableStyles,v=Ec(a);c=c||"default";var S=_.get(v);if(!S){var k={loading:0,preload:null};if(S=p.querySelector(Wh(v)))k.loading=5;else{a=d({rel:"stylesheet",href:a,"data-precedence":c},f),(f=Br.get(v))&&zv(a,f);var K=S=p.createElement("link");Xt(K),In(K,"link",a),K._p=new Promise(function(ue,ge){K.onload=ue,K.onerror=ge}),K.addEventListener("load",function(){k.loading|=1}),K.addEventListener("error",function(){k.loading|=2}),k.loading|=4,Vp(S,c,p)}S={type:"stylesheet",instance:S,count:1,state:k},_.set(v,S)}}}function b6(a,c){ws.X(a,c);var f=wc;if(f&&a){var p=ro(f).hoistableScripts,_=xc(a),v=p.get(_);v||(v=f.querySelector(qh(_)),v||(a=d({src:a,async:!0},c),(c=Br.get(_))&&jv(a,c),v=f.createElement("script"),Xt(v),In(v,"link",a),f.head.appendChild(v)),v={type:"script",instance:v,count:1,state:null},p.set(_,v))}}function T6(a,c){ws.M(a,c);var f=wc;if(f&&a){var p=ro(f).hoistableScripts,_=xc(a),v=p.get(_);v||(v=f.querySelector(qh(_)),v||(a=d({src:a,async:!0,type:"module"},c),(c=Br.get(_))&&jv(a,c),v=f.createElement("script"),Xt(v),In(v,"link",a),f.head.appendChild(v)),v={type:"script",instance:v,count:1,state:null},p.set(_,v))}}function aS(a,c,f,p){var _=(_=Se.current)?Bp(_):null;if(!_)throw Error(r(446));switch(a){case"meta":case"title":return null;case"style":return typeof f.precedence=="string"&&typeof f.href=="string"?(c=Ec(f.href),f=ro(_).hoistableStyles,p=f.get(c),p||(p={type:"style",instance:null,count:0,state:null},f.set(c,p)),p):{type:"void",instance:null,count:0,state:null};case"link":if(f.rel==="stylesheet"&&typeof f.href=="string"&&typeof f.precedence=="string"){a=Ec(f.href);var v=ro(_).hoistableStyles,S=v.get(a);if(S||(_=_.ownerDocument||_,S={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},v.set(a,S),(v=_.querySelector(Wh(a)))&&!v._p&&(S.instance=v,S.state.loading=5),Br.has(a)||(f={rel:"preload",as:"style",href:f.href,crossOrigin:f.crossOrigin,integrity:f.integrity,media:f.media,hrefLang:f.hrefLang,referrerPolicy:f.referrerPolicy},Br.set(a,f),v||w6(_,a,f,S.state))),c&&p===null)throw Error(r(528,""));return S}if(c&&p!==null)throw Error(r(529,""));return null;case"script":return c=f.async,f=f.src,typeof f=="string"&&c&&typeof c!="function"&&typeof c!="symbol"?(c=xc(f),f=ro(_).hoistableScripts,p=f.get(c),p||(p={type:"script",instance:null,count:0,state:null},f.set(c,p)),p):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,a))}}function Ec(a){return'href="'+yn(a)+'"'}function Wh(a){return'link[rel="stylesheet"]['+a+"]"}function lS(a){return d({},a,{"data-precedence":a.precedence,precedence:null})}function w6(a,c,f,p){a.querySelector('link[rel="preload"][as="style"]['+c+"]")?p.loading=1:(c=a.createElement("link"),p.preload=c,c.addEventListener("load",function(){return p.loading|=1}),c.addEventListener("error",function(){return p.loading|=2}),In(c,"link",f),Xt(c),a.head.appendChild(c))}function xc(a){return'[src="'+yn(a)+'"]'}function qh(a){return"script[async]"+a}function cS(a,c,f){if(c.count++,c.instance===null)switch(c.type){case"style":var p=a.querySelector('style[data-href~="'+yn(f.href)+'"]');if(p)return c.instance=p,Xt(p),p;var _=d({},f,{"data-href":f.href,"data-precedence":f.precedence,href:null,precedence:null});return p=(a.ownerDocument||a).createElement("style"),Xt(p),In(p,"style",_),Vp(p,f.precedence,a),c.instance=p;case"stylesheet":_=Ec(f.href);var v=a.querySelector(Wh(_));if(v)return c.state.loading|=4,c.instance=v,Xt(v),v;p=lS(f),(_=Br.get(_))&&zv(p,_),v=(a.ownerDocument||a).createElement("link"),Xt(v);var S=v;return S._p=new Promise(function(k,K){S.onload=k,S.onerror=K}),In(v,"link",p),c.state.loading|=4,Vp(v,f.precedence,a),c.instance=v;case"script":return v=xc(f.src),(_=a.querySelector(qh(v)))?(c.instance=_,Xt(_),_):(p=f,(_=Br.get(v))&&(p=d({},f),jv(p,_)),a=a.ownerDocument||a,_=a.createElement("script"),Xt(_),In(_,"link",p),a.head.appendChild(_),c.instance=_);case"void":return null;default:throw Error(r(443,c.type))}else c.type==="stylesheet"&&(c.state.loading&4)===0&&(p=c.instance,c.state.loading|=4,Vp(p,f.precedence,a));return c.instance}function Vp(a,c,f){for(var p=f.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),_=p.length?p[p.length-1]:null,v=_,S=0;S<p.length;S++){var k=p[S];if(k.dataset.precedence===c)v=k;else if(v!==_)break}v?v.parentNode.insertBefore(a,v.nextSibling):(c=f.nodeType===9?f.head:f,c.insertBefore(a,c.firstChild))}function zv(a,c){a.crossOrigin==null&&(a.crossOrigin=c.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=c.referrerPolicy),a.title==null&&(a.title=c.title)}function jv(a,c){a.crossOrigin==null&&(a.crossOrigin=c.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=c.referrerPolicy),a.integrity==null&&(a.integrity=c.integrity)}var zp=null;function uS(a,c,f){if(zp===null){var p=new Map,_=zp=new Map;_.set(f,p)}else _=zp,p=_.get(f),p||(p=new Map,_.set(f,p));if(p.has(a))return p;for(p.set(a,null),f=f.getElementsByTagName(a),_=0;_<f.length;_++){var v=f[_];if(!(v[to]||v[qt]||a==="link"&&v.getAttribute("rel")==="stylesheet")&&v.namespaceURI!=="http://www.w3.org/2000/svg"){var S=v.getAttribute(c)||"";S=a+S;var k=p.get(S);k?k.push(v):p.set(S,[v])}}return p}function hS(a,c,f){a=a.ownerDocument||a,a.head.insertBefore(f,c==="title"?a.querySelector("head > title"):null)}function E6(a,c,f){if(f===1||c.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof c.precedence!="string"||typeof c.href!="string"||c.href==="")break;return!0;case"link":if(typeof c.rel!="string"||typeof c.href!="string"||c.href===""||c.onLoad||c.onError)break;switch(c.rel){case"stylesheet":return a=c.disabled,typeof c.precedence=="string"&&a==null;default:return!0}case"script":if(c.async&&typeof c.async!="function"&&typeof c.async!="symbol"&&!c.onLoad&&!c.onError&&c.src&&typeof c.src=="string")return!0}return!1}function fS(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}var Xh=null;function x6(){}function A6(a,c,f){if(Xh===null)throw Error(r(475));var p=Xh;if(c.type==="stylesheet"&&(typeof f.media!="string"||matchMedia(f.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var _=Ec(f.href),v=a.querySelector(Wh(_));if(v){a=v._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(p.count++,p=jp.bind(p),a.then(p,p)),c.state.loading|=4,c.instance=v,Xt(v);return}v=a.ownerDocument||a,f=lS(f),(_=Br.get(_))&&zv(f,_),v=v.createElement("link"),Xt(v);var S=v;S._p=new Promise(function(k,K){S.onload=k,S.onerror=K}),In(v,"link",f),c.instance=v}p.stylesheets===null&&(p.stylesheets=new Map),p.stylesheets.set(c,a),(a=c.state.preload)&&(c.state.loading&3)===0&&(p.count++,c=jp.bind(p),a.addEventListener("load",c),a.addEventListener("error",c))}}function S6(){if(Xh===null)throw Error(r(475));var a=Xh;return a.stylesheets&&a.count===0&&Hv(a,a.stylesheets),0<a.count?function(c){var f=setTimeout(function(){if(a.stylesheets&&Hv(a,a.stylesheets),a.unsuspend){var p=a.unsuspend;a.unsuspend=null,p()}},6e4);return a.unsuspend=c,function(){a.unsuspend=null,clearTimeout(f)}}:null}function jp(){if(this.count--,this.count===0){if(this.stylesheets)Hv(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var Hp=null;function Hv(a,c){a.stylesheets=null,a.unsuspend!==null&&(a.count++,Hp=new Map,c.forEach(R6,a),Hp=null,jp.call(a))}function R6(a,c){if(!(c.state.loading&4)){var f=Hp.get(a);if(f)var p=f.get(null);else{f=new Map,Hp.set(a,f);for(var _=a.querySelectorAll("link[data-precedence],style[data-precedence]"),v=0;v<_.length;v++){var S=_[v];(S.nodeName==="LINK"||S.getAttribute("media")!=="not all")&&(f.set(S.dataset.precedence,S),p=S)}p&&f.set(null,p)}_=c.instance,S=_.getAttribute("data-precedence"),v=f.get(S)||p,v===p&&f.set(null,_),f.set(S,_),this.count++,p=jp.bind(this),_.addEventListener("load",p),_.addEventListener("error",p),v?v.parentNode.insertBefore(_,v.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(_,a.firstChild)),c.state.loading|=4}}var Yh={$$typeof:O,Provider:null,Consumer:null,_currentValue:U,_currentValue2:U,_threadCount:0};function C6(a,c,f,p,_,v,S,k){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Fl(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Fl(0),this.hiddenUpdates=Fl(null),this.identifierPrefix=p,this.onUncaughtError=_,this.onCaughtError=v,this.onRecoverableError=S,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=k,this.incompleteTransitions=new Map}function dS(a,c,f,p,_,v,S,k,K,ue,ge,ve){return a=new C6(a,c,f,S,k,K,ue,ve),c=1,v===!0&&(c|=24),v=gr(3,null,null,c),a.current=v,v.stateNode=a,c=xy(),c.refCount++,a.pooledCache=c,c.refCount++,v.memoizedState={element:p,isDehydrated:f,cache:c},Cy(v),a}function pS(a){return a?(a=tc,a):tc}function gS(a,c,f,p,_,v){_=pS(_),p.context===null?p.context=_:p.pendingContext=_,p=po(c),p.payload={element:f},v=v===void 0?null:v,v!==null&&(p.callback=v),f=go(a,p,c),f!==null&&(br(f,a,c),xh(f,a,c))}function mS(a,c){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var f=a.retryLane;a.retryLane=f!==0&&f<c?f:c}}function $v(a,c){mS(a,c),(a=a.alternate)&&mS(a,c)}function _S(a){if(a.tag===13){var c=ec(a,67108864);c!==null&&br(c,a,67108864),$v(a,67108864)}}var $p=!0;function I6(a,c,f,p){var _=P.T;P.T=null;var v=q.p;try{q.p=2,Wv(a,c,f,p)}finally{q.p=v,P.T=_}}function P6(a,c,f,p){var _=P.T;P.T=null;var v=q.p;try{q.p=8,Wv(a,c,f,p)}finally{q.p=v,P.T=_}}function Wv(a,c,f,p){if($p){var _=qv(p);if(_===null)Ov(a,c,p,Wp,f),vS(a,p);else if(O6(_,a,c,f,p))p.stopPropagation();else if(vS(a,p),c&4&&-1<M6.indexOf(a)){for(;_!==null;){var v=Ti(_);if(v!==null)switch(v.tag){case 3:if(v=v.stateNode,v.current.memoizedState.isDehydrated){var S=Kr(v.pendingLanes);if(S!==0){var k=v;for(k.pendingLanes|=2,k.entangledLanes|=2;S;){var K=1<<31-Zn(S);k.entanglements[1]|=K,S&=~K}Mi(v),(_t&6)===0&&(Cp=ir()+500,zh(0))}}break;case 13:k=ec(v,2),k!==null&&br(k,v,2),Pp(),$v(v,2)}if(v=qv(p),v===null&&Ov(a,c,p,Wp,f),v===_)break;_=v}_!==null&&p.stopPropagation()}else Ov(a,c,p,null,f)}}function qv(a){return a=sh(a),Xv(a)}var Wp=null;function Xv(a){if(Wp=null,a=bi(a),a!==null){var c=s(a);if(c===null)a=null;else{var f=c.tag;if(f===13){if(a=o(c),a!==null)return a;a=null}else if(f===3){if(c.stateNode.current.memoizedState.isDehydrated)return c.tag===3?c.stateNode.containerInfo:null;a=null}else c!==a&&(a=null)}}return Wp=a,null}function yS(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Od()){case an:return 2;case _n:return 8;case ns:case Q_:return 32;case Ku:return 268435456;default:return 32}default:return 32}}var Yv=!1,Co=null,Io=null,Po=null,Kh=new Map,Gh=new Map,Mo=[],M6="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function vS(a,c){switch(a){case"focusin":case"focusout":Co=null;break;case"dragenter":case"dragleave":Io=null;break;case"mouseover":case"mouseout":Po=null;break;case"pointerover":case"pointerout":Kh.delete(c.pointerId);break;case"gotpointercapture":case"lostpointercapture":Gh.delete(c.pointerId)}}function Zh(a,c,f,p,_,v){return a===null||a.nativeEvent!==v?(a={blockedOn:c,domEventName:f,eventSystemFlags:p,nativeEvent:v,targetContainers:[_]},c!==null&&(c=Ti(c),c!==null&&_S(c)),a):(a.eventSystemFlags|=p,c=a.targetContainers,_!==null&&c.indexOf(_)===-1&&c.push(_),a)}function O6(a,c,f,p,_){switch(c){case"focusin":return Co=Zh(Co,a,c,f,p,_),!0;case"dragenter":return Io=Zh(Io,a,c,f,p,_),!0;case"mouseover":return Po=Zh(Po,a,c,f,p,_),!0;case"pointerover":var v=_.pointerId;return Kh.set(v,Zh(Kh.get(v)||null,a,c,f,p,_)),!0;case"gotpointercapture":return v=_.pointerId,Gh.set(v,Zh(Gh.get(v)||null,a,c,f,p,_)),!0}return!1}function bS(a){var c=bi(a.target);if(c!==null){var f=s(c);if(f!==null){if(c=f.tag,c===13){if(c=o(f),c!==null){a.blockedOn=c,ty(a.priority,function(){if(f.tag===13){var p=vr();p=Zu(p);var _=ec(f,p);_!==null&&br(_,f,p),$v(f,p)}});return}}else if(c===3&&f.stateNode.current.memoizedState.isDehydrated){a.blockedOn=f.tag===3?f.stateNode.containerInfo:null;return}}}a.blockedOn=null}function qp(a){if(a.blockedOn!==null)return!1;for(var c=a.targetContainers;0<c.length;){var f=qv(a.nativeEvent);if(f===null){f=a.nativeEvent;var p=new f.constructor(f.type,f);ih=p,f.target.dispatchEvent(p),ih=null}else return c=Ti(f),c!==null&&_S(c),a.blockedOn=f,!1;c.shift()}return!0}function TS(a,c,f){qp(a)&&f.delete(c)}function k6(){Yv=!1,Co!==null&&qp(Co)&&(Co=null),Io!==null&&qp(Io)&&(Io=null),Po!==null&&qp(Po)&&(Po=null),Kh.forEach(TS),Gh.forEach(TS)}function Xp(a,c){a.blockedOn===c&&(a.blockedOn=null,Yv||(Yv=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,k6)))}var Yp=null;function wS(a){Yp!==a&&(Yp=a,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){Yp===a&&(Yp=null);for(var c=0;c<a.length;c+=3){var f=a[c],p=a[c+1],_=a[c+2];if(typeof p!="function"){if(Xv(p||f)===null)continue;break}var v=Ti(f);v!==null&&(a.splice(c,3),c-=3,Xy(v,{pending:!0,data:_,method:f.method,action:p},p,_))}}))}function Qh(a){function c(K){return Xp(K,a)}Co!==null&&Xp(Co,a),Io!==null&&Xp(Io,a),Po!==null&&Xp(Po,a),Kh.forEach(c),Gh.forEach(c);for(var f=0;f<Mo.length;f++){var p=Mo[f];p.blockedOn===a&&(p.blockedOn=null)}for(;0<Mo.length&&(f=Mo[0],f.blockedOn===null);)bS(f),f.blockedOn===null&&Mo.shift();if(f=(a.ownerDocument||a).$$reactFormReplay,f!=null)for(p=0;p<f.length;p+=3){var _=f[p],v=f[p+1],S=_[Sn]||null;if(typeof v=="function")S||wS(f);else if(S){var k=null;if(v&&v.hasAttribute("formAction")){if(_=v,S=v[Sn]||null)k=S.formAction;else if(Xv(_)!==null)continue}else k=S.action;typeof k=="function"?f[p+1]=k:(f.splice(p,3),p-=3),wS(f)}}}function Kv(a){this._internalRoot=a}Kp.prototype.render=Kv.prototype.render=function(a){var c=this._internalRoot;if(c===null)throw Error(r(409));var f=c.current,p=vr();gS(f,p,a,c,null,null)},Kp.prototype.unmount=Kv.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var c=a.containerInfo;gS(a.current,2,null,a,null,null),Pp(),c[is]=null}};function Kp(a){this._internalRoot=a}Kp.prototype.unstable_scheduleHydration=function(a){if(a){var c=rs();a={blockedOn:null,target:a,priority:c};for(var f=0;f<Mo.length&&c!==0&&c<Mo[f].priority;f++);Mo.splice(f,0,a),f===0&&bS(a)}};var ES=e.version;if(ES!=="19.1.1")throw Error(r(527,ES,"19.1.1"));q.findDOMNode=function(a){var c=a._reactInternals;if(c===void 0)throw typeof a.render=="function"?Error(r(188)):(a=Object.keys(a).join(","),Error(r(268,a)));return a=u(c),a=a!==null?h(a):null,a=a===null?null:a.stateNode,a};var N6={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:P,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Gp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Gp.isDisabled&&Gp.supportsFiber)try{Ks=Gp.inject(N6),Un=Gp}catch{}}return ef.createRoot=function(a,c){if(!i(a))throw Error(r(299));var f=!1,p="",_=B1,v=V1,S=z1,k=null;return c!=null&&(c.unstable_strictMode===!0&&(f=!0),c.identifierPrefix!==void 0&&(p=c.identifierPrefix),c.onUncaughtError!==void 0&&(_=c.onUncaughtError),c.onCaughtError!==void 0&&(v=c.onCaughtError),c.onRecoverableError!==void 0&&(S=c.onRecoverableError),c.unstable_transitionCallbacks!==void 0&&(k=c.unstable_transitionCallbacks)),c=dS(a,1,!1,null,null,f,p,_,v,S,k,null),a[is]=c.current,Mv(a),new Kv(c)},ef.hydrateRoot=function(a,c,f){if(!i(a))throw Error(r(299));var p=!1,_="",v=B1,S=V1,k=z1,K=null,ue=null;return f!=null&&(f.unstable_strictMode===!0&&(p=!0),f.identifierPrefix!==void 0&&(_=f.identifierPrefix),f.onUncaughtError!==void 0&&(v=f.onUncaughtError),f.onCaughtError!==void 0&&(S=f.onCaughtError),f.onRecoverableError!==void 0&&(k=f.onRecoverableError),f.unstable_transitionCallbacks!==void 0&&(K=f.unstable_transitionCallbacks),f.formState!==void 0&&(ue=f.formState)),c=dS(a,1,!0,c,f??null,p,_,v,S,k,K,ue),c.context=pS(null),f=c.current,p=vr(),p=Zu(p),_=po(p),_.callback=null,go(f,_,p),f=p,c.current.lanes=f,Wt(c,f),Mi(c),a[is]=c.current,Mv(a),new Kp(c)},ef.version="19.1.1",ef}var kS;function $6(){if(kS)return Qv.exports;kS=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Qv.exports=H6(),Qv.exports}var W6=$6();/**
 * react-router v7.8.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var NS="popstate";function q6(n={}){function e(r,i){let{pathname:s,search:o,hash:l}=r.location;return _0("",{pathname:s,search:o,hash:l},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function t(r,i){return typeof i=="string"?i:Bf(i)}return Y6(e,t,null,n)}function Bt(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function Yi(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function X6(){return Math.random().toString(36).substring(2,10)}function DS(n,e){return{usr:n.state,key:n.key,idx:e}}function _0(n,e,t=null,r){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof e=="string"?Iu(e):e,state:t,key:e&&e.key||r||X6()}}function Bf({pathname:n="/",search:e="",hash:t=""}){return e&&e!=="?"&&(n+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(n+=t.charAt(0)==="#"?t:"#"+t),n}function Iu(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substring(t),n=n.substring(0,t));let r=n.indexOf("?");r>=0&&(e.search=n.substring(r),n=n.substring(0,r)),n&&(e.pathname=n)}return e}function Y6(n,e,t,r={}){let{window:i=document.defaultView,v5Compat:s=!1}=r,o=i.history,l="POP",u=null,h=d();h==null&&(h=0,o.replaceState({...o.state,idx:h},""));function d(){return(o.state||{idx:null}).idx}function g(){l="POP";let x=d(),C=x==null?null:x-h;h=x,u&&u({action:l,location:E.location,delta:C})}function y(x,C){l="PUSH";let M=_0(E.location,x,C);h=d()+1;let O=DS(M,h),V=E.createHref(M);try{o.pushState(O,"",V)}catch(H){if(H instanceof DOMException&&H.name==="DataCloneError")throw H;i.location.assign(V)}s&&u&&u({action:l,location:E.location,delta:1})}function b(x,C){l="REPLACE";let M=_0(E.location,x,C);h=d();let O=DS(M,h),V=E.createHref(M);o.replaceState(O,"",V),s&&u&&u({action:l,location:E.location,delta:0})}function w(x){return K6(x)}let E={get action(){return l},get location(){return n(i,o)},listen(x){if(u)throw new Error("A history only accepts one active listener");return i.addEventListener(NS,g),u=x,()=>{i.removeEventListener(NS,g),u=null}},createHref(x){return e(i,x)},createURL:w,encodeLocation(x){let C=w(x);return{pathname:C.pathname,search:C.search,hash:C.hash}},push:y,replace:b,go(x){return o.go(x)}};return E}function K6(n,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),Bt(t,"No window.location.(origin|href) available to create URL");let r=typeof n=="string"?n:Bf(n);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=t+r),new URL(r,t)}function $I(n,e,t="/"){return G6(n,e,t,!1)}function G6(n,e,t,r){let i=typeof e=="string"?Iu(e):e,s=Ds(i.pathname||"/",t);if(s==null)return null;let o=WI(n);Z6(o);let l=null;for(let u=0;l==null&&u<o.length;++u){let h=lU(s);l=oU(o[u],h,r)}return l}function WI(n,e=[],t=[],r="",i=!1){let s=(o,l,u=i,h)=>{let d={relativePath:h===void 0?o.path||"":h,caseSensitive:o.caseSensitive===!0,childrenIndex:l,route:o};if(d.relativePath.startsWith("/")){if(!d.relativePath.startsWith(r)&&u)return;Bt(d.relativePath.startsWith(r),`Absolute route path "${d.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),d.relativePath=d.relativePath.slice(r.length)}let g=Ms([r,d.relativePath]),y=t.concat(d);o.children&&o.children.length>0&&(Bt(o.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${g}".`),WI(o.children,e,y,g,u)),!(o.path==null&&!o.index)&&e.push({path:g,score:iU(g,o.index),routesMeta:y})};return n.forEach((o,l)=>{if(o.path===""||!o.path?.includes("?"))s(o,l);else for(let u of qI(o.path))s(o,l,!0,u)}),e}function qI(n){let e=n.split("/");if(e.length===0)return[];let[t,...r]=e,i=t.endsWith("?"),s=t.replace(/\?$/,"");if(r.length===0)return i?[s,""]:[s];let o=qI(r.join("/")),l=[];return l.push(...o.map(u=>u===""?s:[s,u].join("/"))),i&&l.push(...o),l.map(u=>n.startsWith("/")&&u===""?"/":u)}function Z6(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:sU(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}var Q6=/^:[\w-]+$/,J6=3,eU=2,tU=1,nU=10,rU=-2,LS=n=>n==="*";function iU(n,e){let t=n.split("/"),r=t.length;return t.some(LS)&&(r+=rU),e&&(r+=eU),t.filter(i=>!LS(i)).reduce((i,s)=>i+(Q6.test(s)?J6:s===""?tU:nU),r)}function sU(n,e){return n.length===e.length&&n.slice(0,-1).every((r,i)=>r===e[i])?n[n.length-1]-e[e.length-1]:0}function oU(n,e,t=!1){let{routesMeta:r}=n,i={},s="/",o=[];for(let l=0;l<r.length;++l){let u=r[l],h=l===r.length-1,d=s==="/"?e:e.slice(s.length)||"/",g=pm({path:u.relativePath,caseSensitive:u.caseSensitive,end:h},d),y=u.route;if(!g&&h&&t&&!r[r.length-1].route.index&&(g=pm({path:u.relativePath,caseSensitive:u.caseSensitive,end:!1},d)),!g)return null;Object.assign(i,g.params),o.push({params:i,pathname:Ms([s,g.pathname]),pathnameBase:fU(Ms([s,g.pathnameBase])),route:y}),g.pathnameBase!=="/"&&(s=Ms([s,g.pathnameBase]))}return o}function pm(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,r]=aU(n.path,n.caseSensitive,n.end),i=e.match(t);if(!i)return null;let s=i[0],o=s.replace(/(.)\/+$/,"$1"),l=i.slice(1);return{params:r.reduce((h,{paramName:d,isOptional:g},y)=>{if(d==="*"){let w=l[y]||"";o=s.slice(0,s.length-w.length).replace(/(.)\/+$/,"$1")}const b=l[y];return g&&!b?h[d]=void 0:h[d]=(b||"").replace(/%2F/g,"/"),h},{}),pathname:s,pathnameBase:o,pattern:n}}function aU(n,e=!1,t=!0){Yi(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let r=[],i="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,l,u)=>(r.push({paramName:l,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return n.endsWith("*")?(r.push({paramName:"*"}),i+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?i+="\\/*$":n!==""&&n!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function lU(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Yi(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),n}}function Ds(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=n.charAt(t);return r&&r!=="/"?null:n.slice(t)||"/"}function cU(n,e="/"){let{pathname:t,search:r="",hash:i=""}=typeof n=="string"?Iu(n):n;return{pathname:t?t.startsWith("/")?t:uU(t,e):e,search:dU(r),hash:pU(i)}}function uU(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(i=>{i===".."?t.length>1&&t.pop():i!=="."&&t.push(i)}),t.length>1?t.join("/"):"/"}function nb(n,e,t,r){return`Cannot include a '${n}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function hU(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function XI(n){let e=hU(n);return e.map((t,r)=>r===e.length-1?t.pathname:t.pathnameBase)}function YI(n,e,t,r=!1){let i;typeof n=="string"?i=Iu(n):(i={...n},Bt(!i.pathname||!i.pathname.includes("?"),nb("?","pathname","search",i)),Bt(!i.pathname||!i.pathname.includes("#"),nb("#","pathname","hash",i)),Bt(!i.search||!i.search.includes("#"),nb("#","search","hash",i)));let s=n===""||i.pathname==="",o=s?"/":i.pathname,l;if(o==null)l=t;else{let g=e.length-1;if(!r&&o.startsWith("..")){let y=o.split("/");for(;y[0]==="..";)y.shift(),g-=1;i.pathname=y.join("/")}l=g>=0?e[g]:"/"}let u=cU(i,l),h=o&&o!=="/"&&o.endsWith("/"),d=(s||o===".")&&t.endsWith("/");return!u.pathname.endsWith("/")&&(h||d)&&(u.pathname+="/"),u}var Ms=n=>n.join("/").replace(/\/\/+/g,"/"),fU=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),dU=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,pU=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function gU(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}var KI=["POST","PUT","PATCH","DELETE"];new Set(KI);var mU=["GET",...KI];new Set(mU);var Pu=R.createContext(null);Pu.displayName="DataRouter";var u_=R.createContext(null);u_.displayName="DataRouterState";R.createContext(!1);var GI=R.createContext({isTransitioning:!1});GI.displayName="ViewTransition";var _U=R.createContext(new Map);_U.displayName="Fetchers";var yU=R.createContext(null);yU.displayName="Await";var Qi=R.createContext(null);Qi.displayName="Navigation";var ld=R.createContext(null);ld.displayName="Location";var Xs=R.createContext({outlet:null,matches:[],isDataRoute:!1});Xs.displayName="Route";var HT=R.createContext(null);HT.displayName="RouteError";function vU(n,{relative:e}={}){Bt(cd(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:r}=R.useContext(Qi),{hash:i,pathname:s,search:o}=ud(n,{relative:e}),l=s;return t!=="/"&&(l=s==="/"?t:Ms([t,s])),r.createHref({pathname:l,search:o,hash:i})}function cd(){return R.useContext(ld)!=null}function Rl(){return Bt(cd(),"useLocation() may be used only in the context of a <Router> component."),R.useContext(ld).location}var ZI="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function QI(n){R.useContext(Qi).static||R.useLayoutEffect(n)}function bU(){let{isDataRoute:n}=R.useContext(Xs);return n?kU():TU()}function TU(){Bt(cd(),"useNavigate() may be used only in the context of a <Router> component.");let n=R.useContext(Pu),{basename:e,navigator:t}=R.useContext(Qi),{matches:r}=R.useContext(Xs),{pathname:i}=Rl(),s=JSON.stringify(XI(r)),o=R.useRef(!1);return QI(()=>{o.current=!0}),R.useCallback((u,h={})=>{if(Yi(o.current,ZI),!o.current)return;if(typeof u=="number"){t.go(u);return}let d=YI(u,JSON.parse(s),i,h.relative==="path");n==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:Ms([e,d.pathname])),(h.replace?t.replace:t.push)(d,h.state,h)},[e,t,s,i,n])}R.createContext(null);function ud(n,{relative:e}={}){let{matches:t}=R.useContext(Xs),{pathname:r}=Rl(),i=JSON.stringify(XI(t));return R.useMemo(()=>YI(n,JSON.parse(i),r,e==="path"),[n,i,r,e])}function wU(n,e){return JI(n,e)}function JI(n,e,t,r,i){Bt(cd(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:s}=R.useContext(Qi),{matches:o}=R.useContext(Xs),l=o[o.length-1],u=l?l.params:{},h=l?l.pathname:"/",d=l?l.pathnameBase:"/",g=l&&l.route;{let M=g&&g.path||"";eP(h,!g||M.endsWith("*")||M.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${h}" (under <Route path="${M}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${M}"> to <Route path="${M==="/"?"*":`${M}/*`}">.`)}let y=Rl(),b;if(e){let M=typeof e=="string"?Iu(e):e;Bt(d==="/"||M.pathname?.startsWith(d),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${d}" but pathname "${M.pathname}" was given in the \`location\` prop.`),b=M}else b=y;let w=b.pathname||"/",E=w;if(d!=="/"){let M=d.replace(/^\//,"").split("/");E="/"+w.replace(/^\//,"").split("/").slice(M.length).join("/")}let x=$I(n,{pathname:E});Yi(g||x!=null,`No routes matched location "${b.pathname}${b.search}${b.hash}" `),Yi(x==null||x[x.length-1].route.element!==void 0||x[x.length-1].route.Component!==void 0||x[x.length-1].route.lazy!==void 0,`Matched leaf route at location "${b.pathname}${b.search}${b.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let C=RU(x&&x.map(M=>Object.assign({},M,{params:Object.assign({},u,M.params),pathname:Ms([d,s.encodeLocation?s.encodeLocation(M.pathname).pathname:M.pathname]),pathnameBase:M.pathnameBase==="/"?d:Ms([d,s.encodeLocation?s.encodeLocation(M.pathnameBase).pathname:M.pathnameBase])})),o,t,r,i);return e&&C?R.createElement(ld.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...b},navigationType:"POP"}},C):C}function EU(){let n=OU(),e=gU(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,r="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:r},s={padding:"2px 4px",backgroundColor:r},o=null;return console.error("Error handled by React Router default ErrorBoundary:",n),o=R.createElement(R.Fragment,null,R.createElement("p",null," Hey developer "),R.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",R.createElement("code",{style:s},"ErrorBoundary")," or"," ",R.createElement("code",{style:s},"errorElement")," prop on your route.")),R.createElement(R.Fragment,null,R.createElement("h2",null,"Unexpected Application Error!"),R.createElement("h3",{style:{fontStyle:"italic"}},e),t?R.createElement("pre",{style:i},t):null,o)}var xU=R.createElement(EU,null),AU=class extends R.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,e){return e.location!==n.location||e.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:e.error,location:e.location,revalidation:n.revalidation||e.revalidation}}componentDidCatch(n,e){this.props.unstable_onError?this.props.unstable_onError(n,e):console.error("React Router caught the following error during render",n)}render(){return this.state.error!==void 0?R.createElement(Xs.Provider,{value:this.props.routeContext},R.createElement(HT.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function SU({routeContext:n,match:e,children:t}){let r=R.useContext(Pu);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),R.createElement(Xs.Provider,{value:n},t)}function RU(n,e=[],t=null,r=null,i=null){if(n==null){if(!t)return null;if(t.errors)n=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let s=n,o=t?.errors;if(o!=null){let h=s.findIndex(d=>d.route.id&&o?.[d.route.id]!==void 0);Bt(h>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(o).join(",")}`),s=s.slice(0,Math.min(s.length,h+1))}let l=!1,u=-1;if(t)for(let h=0;h<s.length;h++){let d=s[h];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(u=h),d.route.id){let{loaderData:g,errors:y}=t,b=d.route.loader&&!g.hasOwnProperty(d.route.id)&&(!y||y[d.route.id]===void 0);if(d.route.lazy||b){l=!0,u>=0?s=s.slice(0,u+1):s=[s[0]];break}}}return s.reduceRight((h,d,g)=>{let y,b=!1,w=null,E=null;t&&(y=o&&d.route.id?o[d.route.id]:void 0,w=d.route.errorElement||xU,l&&(u<0&&g===0?(eP("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),b=!0,E=null):u===g&&(b=!0,E=d.route.hydrateFallbackElement||null)));let x=e.concat(s.slice(0,g+1)),C=()=>{let M;return y?M=w:b?M=E:d.route.Component?M=R.createElement(d.route.Component,null):d.route.element?M=d.route.element:M=h,R.createElement(SU,{match:d,routeContext:{outlet:h,matches:x,isDataRoute:t!=null},children:M})};return t&&(d.route.ErrorBoundary||d.route.errorElement||g===0)?R.createElement(AU,{location:t.location,revalidation:t.revalidation,component:w,error:y,children:C(),routeContext:{outlet:null,matches:x,isDataRoute:!0},unstable_onError:r}):C()},null)}function $T(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function CU(n){let e=R.useContext(Pu);return Bt(e,$T(n)),e}function IU(n){let e=R.useContext(u_);return Bt(e,$T(n)),e}function PU(n){let e=R.useContext(Xs);return Bt(e,$T(n)),e}function WT(n){let e=PU(n),t=e.matches[e.matches.length-1];return Bt(t.route.id,`${n} can only be used on routes that contain a unique "id"`),t.route.id}function MU(){return WT("useRouteId")}function OU(){let n=R.useContext(HT),e=IU("useRouteError"),t=WT("useRouteError");return n!==void 0?n:e.errors?.[t]}function kU(){let{router:n}=CU("useNavigate"),e=WT("useNavigate"),t=R.useRef(!1);return QI(()=>{t.current=!0}),R.useCallback(async(i,s={})=>{Yi(t.current,ZI),t.current&&(typeof i=="number"?n.navigate(i):await n.navigate(i,{fromRouteId:e,...s}))},[n,e])}var US={};function eP(n,e,t){!e&&!US[n]&&(US[n]=!0,Yi(!1,t))}R.memo(NU);function NU({routes:n,future:e,state:t,unstable_onError:r}){return JI(n,void 0,t,r,e)}function Dc(n){Bt(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function DU({basename:n="/",children:e=null,location:t,navigationType:r="POP",navigator:i,static:s=!1}){Bt(!cd(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let o=n.replace(/^\/*/,"/"),l=R.useMemo(()=>({basename:o,navigator:i,static:s,future:{}}),[o,i,s]);typeof t=="string"&&(t=Iu(t));let{pathname:u="/",search:h="",hash:d="",state:g=null,key:y="default"}=t,b=R.useMemo(()=>{let w=Ds(u,o);return w==null?null:{location:{pathname:w,search:h,hash:d,state:g,key:y},navigationType:r}},[o,u,h,d,g,y,r]);return Yi(b!=null,`<Router basename="${o}"> is not able to match the URL "${u}${h}${d}" because it does not start with the basename, so the <Router> won't render anything.`),b==null?null:R.createElement(Qi.Provider,{value:l},R.createElement(ld.Provider,{children:e,value:b}))}function LU({children:n,location:e}){return wU(y0(n),e)}function y0(n,e=[]){let t=[];return R.Children.forEach(n,(r,i)=>{if(!R.isValidElement(r))return;let s=[...e,i];if(r.type===R.Fragment){t.push.apply(t,y0(r.props.children,s));return}Bt(r.type===Dc,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Bt(!r.props.index||!r.props.children,"An index route cannot have child routes.");let o={id:r.props.id||s.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=y0(r.props.children,s)),t.push(o)}),t}var Fg="get",Bg="application/x-www-form-urlencoded";function h_(n){return n!=null&&typeof n.tagName=="string"}function UU(n){return h_(n)&&n.tagName.toLowerCase()==="button"}function FU(n){return h_(n)&&n.tagName.toLowerCase()==="form"}function BU(n){return h_(n)&&n.tagName.toLowerCase()==="input"}function VU(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function zU(n,e){return n.button===0&&(!e||e==="_self")&&!VU(n)}var Zp=null;function jU(){if(Zp===null)try{new FormData(document.createElement("form"),0),Zp=!1}catch{Zp=!0}return Zp}var HU=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function rb(n){return n!=null&&!HU.has(n)?(Yi(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Bg}"`),null):n}function $U(n,e){let t,r,i,s,o;if(FU(n)){let l=n.getAttribute("action");r=l?Ds(l,e):null,t=n.getAttribute("method")||Fg,i=rb(n.getAttribute("enctype"))||Bg,s=new FormData(n)}else if(UU(n)||BU(n)&&(n.type==="submit"||n.type==="image")){let l=n.form;if(l==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let u=n.getAttribute("formaction")||l.getAttribute("action");if(r=u?Ds(u,e):null,t=n.getAttribute("formmethod")||l.getAttribute("method")||Fg,i=rb(n.getAttribute("formenctype"))||rb(l.getAttribute("enctype"))||Bg,s=new FormData(l,n),!jU()){let{name:h,type:d,value:g}=n;if(d==="image"){let y=h?`${h}.`:"";s.append(`${y}x`,"0"),s.append(`${y}y`,"0")}else h&&s.append(h,g)}}else{if(h_(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=Fg,r=null,i=Bg,o=n}return s&&i==="text/plain"&&(o=s,s=void 0),{action:r,method:t.toLowerCase(),encType:i,formData:s,body:o}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function qT(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function WU(n,e,t){let r=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return r.pathname==="/"?r.pathname=`_root.${t}`:e&&Ds(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${t}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${t}`,r}async function qU(n,e){if(n.id in e)return e[n.id];try{let t=await import(n.module);return e[n.id]=t,t}catch(t){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function XU(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function YU(n,e,t){let r=await Promise.all(n.map(async i=>{let s=e.routes[i.route.id];if(s){let o=await qU(s,t);return o.links?o.links():[]}return[]}));return QU(r.flat(1).filter(XU).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function FS(n,e,t,r,i,s){let o=(u,h)=>t[h]?u.route.id!==t[h].route.id:!0,l=(u,h)=>t[h].pathname!==u.pathname||t[h].route.path?.endsWith("*")&&t[h].params["*"]!==u.params["*"];return s==="assets"?e.filter((u,h)=>o(u,h)||l(u,h)):s==="data"?e.filter((u,h)=>{let d=r.routes[u.route.id];if(!d||!d.hasLoader)return!1;if(o(u,h)||l(u,h))return!0;if(u.route.shouldRevalidate){let g=u.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(n,window.origin),nextParams:u.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function KU(n,e,{includeHydrateFallback:t}={}){return GU(n.map(r=>{let i=e.routes[r.route.id];if(!i)return[];let s=[i.module];return i.clientActionModule&&(s=s.concat(i.clientActionModule)),i.clientLoaderModule&&(s=s.concat(i.clientLoaderModule)),t&&i.hydrateFallbackModule&&(s=s.concat(i.hydrateFallbackModule)),i.imports&&(s=s.concat(i.imports)),s}).flat(1))}function GU(n){return[...new Set(n)]}function ZU(n){let e={},t=Object.keys(n).sort();for(let r of t)e[r]=n[r];return e}function QU(n,e){let t=new Set;return new Set(e),n.reduce((r,i)=>{let s=JSON.stringify(ZU(i));return t.has(s)||(t.add(s),r.push({key:s,link:i})),r},[])}function tP(){let n=R.useContext(Pu);return qT(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function JU(){let n=R.useContext(u_);return qT(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var XT=R.createContext(void 0);XT.displayName="FrameworkContext";function nP(){let n=R.useContext(XT);return qT(n,"You must render this element inside a <HydratedRouter> element"),n}function eF(n,e){let t=R.useContext(XT),[r,i]=R.useState(!1),[s,o]=R.useState(!1),{onFocus:l,onBlur:u,onMouseEnter:h,onMouseLeave:d,onTouchStart:g}=e,y=R.useRef(null);R.useEffect(()=>{if(n==="render"&&o(!0),n==="viewport"){let E=C=>{C.forEach(M=>{o(M.isIntersecting)})},x=new IntersectionObserver(E,{threshold:.5});return y.current&&x.observe(y.current),()=>{x.disconnect()}}},[n]),R.useEffect(()=>{if(r){let E=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(E)}}},[r]);let b=()=>{i(!0)},w=()=>{i(!1),o(!1)};return t?n!=="intent"?[s,y,{}]:[s,y,{onFocus:tf(l,b),onBlur:tf(u,w),onMouseEnter:tf(h,b),onMouseLeave:tf(d,w),onTouchStart:tf(g,b)}]:[!1,y,{}]}function tf(n,e){return t=>{n&&n(t),t.defaultPrevented||e(t)}}function tF({page:n,...e}){let{router:t}=tP(),r=R.useMemo(()=>$I(t.routes,n,t.basename),[t.routes,n,t.basename]);return r?R.createElement(rF,{page:n,matches:r,...e}):null}function nF(n){let{manifest:e,routeModules:t}=nP(),[r,i]=R.useState([]);return R.useEffect(()=>{let s=!1;return YU(n,e,t).then(o=>{s||i(o)}),()=>{s=!0}},[n,e,t]),r}function rF({page:n,matches:e,...t}){let r=Rl(),{manifest:i,routeModules:s}=nP(),{basename:o}=tP(),{loaderData:l,matches:u}=JU(),h=R.useMemo(()=>FS(n,e,u,i,r,"data"),[n,e,u,i,r]),d=R.useMemo(()=>FS(n,e,u,i,r,"assets"),[n,e,u,i,r]),g=R.useMemo(()=>{if(n===r.pathname+r.search+r.hash)return[];let w=new Set,E=!1;if(e.forEach(C=>{let M=i.routes[C.route.id];!M||!M.hasLoader||(!h.some(O=>O.route.id===C.route.id)&&C.route.id in l&&s[C.route.id]?.shouldRevalidate||M.hasClientLoader?E=!0:w.add(C.route.id))}),w.size===0)return[];let x=WU(n,o,"data");return E&&w.size>0&&x.searchParams.set("_routes",e.filter(C=>w.has(C.route.id)).map(C=>C.route.id).join(",")),[x.pathname+x.search]},[o,l,r,i,h,e,n,s]),y=R.useMemo(()=>KU(d,i),[d,i]),b=nF(d);return R.createElement(R.Fragment,null,g.map(w=>R.createElement("link",{key:w,rel:"prefetch",as:"fetch",href:w,...t})),y.map(w=>R.createElement("link",{key:w,rel:"modulepreload",href:w,...t})),b.map(({key:w,link:E})=>R.createElement("link",{key:w,nonce:t.nonce,...E})))}function iF(...n){return e=>{n.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var rP=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{rP&&(window.__reactRouterVersion="7.8.2")}catch{}function sF({basename:n,children:e,window:t}){let r=R.useRef();r.current==null&&(r.current=q6({window:t,v5Compat:!0}));let i=r.current,[s,o]=R.useState({action:i.action,location:i.location}),l=R.useCallback(u=>{R.startTransition(()=>o(u))},[o]);return R.useLayoutEffect(()=>i.listen(l),[i,l]),R.createElement(DU,{basename:n,children:e,location:s.location,navigationType:s.action,navigator:i})}var iP=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Er=R.forwardRef(function({onClick:e,discover:t="render",prefetch:r="none",relative:i,reloadDocument:s,replace:o,state:l,target:u,to:h,preventScrollReset:d,viewTransition:g,...y},b){let{basename:w}=R.useContext(Qi),E=typeof h=="string"&&iP.test(h),x,C=!1;if(typeof h=="string"&&E&&(x=h,rP))try{let N=new URL(window.location.href),j=h.startsWith("//")?new URL(N.protocol+h):new URL(h),W=Ds(j.pathname,w);j.origin===N.origin&&W!=null?h=W+j.search+j.hash:C=!0}catch{Yi(!1,`<Link to="${h}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let M=vU(h,{relative:i}),[O,V,H]=eF(r,y),G=cF(h,{replace:o,state:l,target:u,preventScrollReset:d,relative:i,viewTransition:g});function D(N){e&&e(N),N.defaultPrevented||G(N)}let I=R.createElement("a",{...y,...H,href:x||M,onClick:C||s?e:D,ref:iF(b,V),target:u,"data-discover":!E&&t==="render"?"true":void 0});return O&&!E?R.createElement(R.Fragment,null,I,R.createElement(tF,{page:M})):I});Er.displayName="Link";var oF=R.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:r="",end:i=!1,style:s,to:o,viewTransition:l,children:u,...h},d){let g=ud(o,{relative:h.relative}),y=Rl(),b=R.useContext(u_),{navigator:w,basename:E}=R.useContext(Qi),x=b!=null&&pF(g)&&l===!0,C=w.encodeLocation?w.encodeLocation(g).pathname:g.pathname,M=y.pathname,O=b&&b.navigation&&b.navigation.location?b.navigation.location.pathname:null;t||(M=M.toLowerCase(),O=O?O.toLowerCase():null,C=C.toLowerCase()),O&&E&&(O=Ds(O,E)||O);const V=C!=="/"&&C.endsWith("/")?C.length-1:C.length;let H=M===C||!i&&M.startsWith(C)&&M.charAt(V)==="/",G=O!=null&&(O===C||!i&&O.startsWith(C)&&O.charAt(C.length)==="/"),D={isActive:H,isPending:G,isTransitioning:x},I=H?e:void 0,N;typeof r=="function"?N=r(D):N=[r,H?"active":null,G?"pending":null,x?"transitioning":null].filter(Boolean).join(" ");let j=typeof s=="function"?s(D):s;return R.createElement(Er,{...h,"aria-current":I,className:N,ref:d,style:j,to:o,viewTransition:l},typeof u=="function"?u(D):u)});oF.displayName="NavLink";var aF=R.forwardRef(({discover:n="render",fetcherKey:e,navigate:t,reloadDocument:r,replace:i,state:s,method:o=Fg,action:l,onSubmit:u,relative:h,preventScrollReset:d,viewTransition:g,...y},b)=>{let w=fF(),E=dF(l,{relative:h}),x=o.toLowerCase()==="get"?"get":"post",C=typeof l=="string"&&iP.test(l),M=O=>{if(u&&u(O),O.defaultPrevented)return;O.preventDefault();let V=O.nativeEvent.submitter,H=V?.getAttribute("formmethod")||o;w(V||O.currentTarget,{fetcherKey:e,method:H,navigate:t,replace:i,state:s,relative:h,preventScrollReset:d,viewTransition:g})};return R.createElement("form",{ref:b,method:x,action:E,onSubmit:r?u:M,...y,"data-discover":!C&&n==="render"?"true":void 0})});aF.displayName="Form";function lF(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function sP(n){let e=R.useContext(Pu);return Bt(e,lF(n)),e}function cF(n,{target:e,replace:t,state:r,preventScrollReset:i,relative:s,viewTransition:o}={}){let l=bU(),u=Rl(),h=ud(n,{relative:s});return R.useCallback(d=>{if(zU(d,e)){d.preventDefault();let g=t!==void 0?t:Bf(u)===Bf(h);l(n,{replace:g,state:r,preventScrollReset:i,relative:s,viewTransition:o})}},[u,l,h,t,r,e,n,i,s,o])}var uF=0,hF=()=>`__${String(++uF)}__`;function fF(){let{router:n}=sP("useSubmit"),{basename:e}=R.useContext(Qi),t=MU();return R.useCallback(async(r,i={})=>{let{action:s,method:o,encType:l,formData:u,body:h}=$U(r,e);if(i.navigate===!1){let d=i.fetcherKey||hF();await n.fetch(d,t,i.action||s,{preventScrollReset:i.preventScrollReset,formData:u,body:h,formMethod:i.method||o,formEncType:i.encType||l,flushSync:i.flushSync})}else await n.navigate(i.action||s,{preventScrollReset:i.preventScrollReset,formData:u,body:h,formMethod:i.method||o,formEncType:i.encType||l,replace:i.replace,state:i.state,fromRouteId:t,flushSync:i.flushSync,viewTransition:i.viewTransition})},[n,e,t])}function dF(n,{relative:e}={}){let{basename:t}=R.useContext(Qi),r=R.useContext(Xs);Bt(r,"useFormAction must be used inside a RouteContext");let[i]=r.matches.slice(-1),s={...ud(n||".",{relative:e})},o=Rl();if(n==null){s.search=o.search;let l=new URLSearchParams(s.search),u=l.getAll("index");if(u.some(d=>d==="")){l.delete("index"),u.filter(g=>g).forEach(g=>l.append("index",g));let d=l.toString();s.search=d?`?${d}`:""}}return(!n||n===".")&&i.route.index&&(s.search=s.search?s.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(s.pathname=s.pathname==="/"?t:Ms([t,s.pathname])),Bf(s)}function pF(n,{relative:e}={}){let t=R.useContext(GI);Bt(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=sP("useViewTransitionState"),i=ud(n,{relative:e});if(!t.isTransitioning)return!1;let s=Ds(t.currentLocation.pathname,r)||t.currentLocation.pathname,o=Ds(t.nextLocation.pathname,r)||t.nextLocation.pathname;return pm(i.pathname,o)!=null||pm(i.pathname,s)!=null}var YT=HI();const gF=zT(YT),mF=()=>{};var BS={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oP=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},_F=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=n[t++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){const s=n[t++],o=n[t++],l=n[t++],u=((i&7)<<18|(s&63)<<12|(o&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(u>>10)),e[r++]=String.fromCharCode(56320+(u&1023))}else{const s=n[t++],o=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|o&63)}}return e.join("")},aP={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){const s=n[i],o=i+1<n.length,l=o?n[i+1]:0,u=i+2<n.length,h=u?n[i+2]:0,d=s>>2,g=(s&3)<<4|l>>4;let y=(l&15)<<2|h>>6,b=h&63;u||(b=64,o||(y=64)),r.push(t[d],t[g],t[y],t[b])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(oP(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):_F(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){const s=t[n.charAt(i++)],l=i<n.length?t[n.charAt(i)]:0;++i;const h=i<n.length?t[n.charAt(i)]:64;++i;const g=i<n.length?t[n.charAt(i)]:64;if(++i,s==null||l==null||h==null||g==null)throw new yF;const y=s<<2|l>>4;if(r.push(y),h!==64){const b=l<<4&240|h>>2;if(r.push(b),g!==64){const w=h<<6&192|g;r.push(w)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class yF extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const vF=function(n){const e=oP(n);return aP.encodeByteArray(e,!0)},gm=function(n){return vF(n).replace(/\./g,"")},lP=function(n){try{return aP.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bF(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TF=()=>bF().__FIREBASE_DEFAULTS__,wF=()=>{if(typeof process>"u"||typeof BS>"u")return;const n=BS.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},EF=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&lP(n[1]);return e&&JSON.parse(e)},f_=()=>{try{return mF()||TF()||wF()||EF()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},cP=n=>f_()?.emulatorHosts?.[n],xF=n=>{const e=cP(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},uP=()=>f_()?.config,hP=n=>f_()?.[`_${n}`];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AF{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mu(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function fP(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SF(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}},...n};return[gm(JSON.stringify(t)),gm(JSON.stringify(o)),""].join(".")}const wf={};function RF(){const n={prod:[],emulator:[]};for(const e of Object.keys(wf))wf[e]?n.emulator.push(e):n.prod.push(e);return n}function CF(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let VS=!1;function dP(n,e){if(typeof window>"u"||typeof document>"u"||!Mu(window.location.host)||wf[n]===e||wf[n]||VS)return;wf[n]=e;function t(y){return`__firebase__banner__${y}`}const r="__firebase__banner",s=RF().prod.length>0;function o(){const y=document.getElementById(r);y&&y.remove()}function l(y){y.style.display="flex",y.style.background="#7faaf0",y.style.position="fixed",y.style.bottom="5px",y.style.left="5px",y.style.padding=".5em",y.style.borderRadius="5px",y.style.alignItems="center"}function u(y,b){y.setAttribute("width","24"),y.setAttribute("id",b),y.setAttribute("height","24"),y.setAttribute("viewBox","0 0 24 24"),y.setAttribute("fill","none"),y.style.marginLeft="-6px"}function h(){const y=document.createElement("span");return y.style.cursor="pointer",y.style.marginLeft="16px",y.style.fontSize="24px",y.innerHTML=" &times;",y.onclick=()=>{VS=!0,o()},y}function d(y,b){y.setAttribute("id",b),y.innerText="Learn more",y.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",y.setAttribute("target","__blank"),y.style.paddingLeft="5px",y.style.textDecoration="underline"}function g(){const y=CF(r),b=t("text"),w=document.getElementById(b)||document.createElement("span"),E=t("learnmore"),x=document.getElementById(E)||document.createElement("a"),C=t("preprendIcon"),M=document.getElementById(C)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(y.created){const O=y.element;l(O),d(x,E);const V=h();u(M,C),O.append(M,w,x,V),document.body.appendChild(O)}s?(w.innerText="Preview backend disconnected.",M.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(M.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,w.innerText="Preview backend running in this workspace."),w.setAttribute("id",b)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",g):g()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function IF(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Kn())}function PF(){const n=f_()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function MF(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function OF(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function kF(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function NF(){const n=Kn();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function DF(){return!PF()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function LF(){try{return typeof indexedDB=="object"}catch{return!1}}function UF(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{e(i.error?.message||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FF="FirebaseError";class Ys extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=FF,Object.setPrototypeOf(this,Ys.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,hd.prototype.create)}}class hd{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],o=s?BF(s,r):"Error",l=`${this.serviceName}: ${o} (${i}).`;return new Ys(i,l,r)}}function BF(n,e){return n.replace(VF,(t,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const VF=/\{\$([^}]+)}/g;function zF(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function ml(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const i of t){if(!r.includes(i))return!1;const s=n[i],o=e[i];if(zS(s)&&zS(o)){if(!ml(s,o))return!1}else if(s!==o)return!1}for(const i of r)if(!t.includes(i))return!1;return!0}function zS(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fd(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function uf(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[i,s]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(s)}}),e}function hf(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function jF(n,e){const t=new HF(n,e);return t.subscribe.bind(t)}class HF{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");$F(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=ib),i.error===void 0&&(i.error=ib),i.complete===void 0&&(i.complete=ib);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function $F(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function ib(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ur(n){return n&&n._delegate?n._delegate:n}let _l=class{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sl="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WF{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new AF;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(XF(e))try{this.getOrInitializeService({instanceIdentifier:sl})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=sl){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=sl){return this.instances.has(e)}getOptions(e=sl){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[s,o]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(s);r===l&&o.resolve(i)}return i}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),i=this.onInitCallbacks.get(r)??new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:qF(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=sl){return this.component?this.component.multipleInstances?e:sl:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function qF(n){return n===sl?void 0:n}function XF(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YF{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new WF(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var nt;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(nt||(nt={}));const KF={debug:nt.DEBUG,verbose:nt.VERBOSE,info:nt.INFO,warn:nt.WARN,error:nt.ERROR,silent:nt.SILENT},GF=nt.INFO,ZF={[nt.DEBUG]:"log",[nt.VERBOSE]:"log",[nt.INFO]:"info",[nt.WARN]:"warn",[nt.ERROR]:"error"},QF=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),i=ZF[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class KT{constructor(e){this.name=e,this._logLevel=GF,this._logHandler=QF,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in nt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?KF[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,nt.DEBUG,...e),this._logHandler(this,nt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,nt.VERBOSE,...e),this._logHandler(this,nt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,nt.INFO,...e),this._logHandler(this,nt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,nt.WARN,...e),this._logHandler(this,nt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,nt.ERROR,...e),this._logHandler(this,nt.ERROR,...e)}}const JF=(n,e)=>e.some(t=>n instanceof t);let jS,HS;function eB(){return jS||(jS=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function tB(){return HS||(HS=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const pP=new WeakMap,v0=new WeakMap,gP=new WeakMap,sb=new WeakMap,GT=new WeakMap;function nB(n){const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",o)},s=()=>{t(Qo(n.result)),i()},o=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&pP.set(t,n)}).catch(()=>{}),GT.set(e,n),e}function rB(n){if(v0.has(n))return;const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",o),n.removeEventListener("abort",o)},s=()=>{t(),i()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",o),n.addEventListener("abort",o)});v0.set(n,e)}let b0={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return v0.get(n);if(e==="objectStoreNames")return n.objectStoreNames||gP.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Qo(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function iB(n){b0=n(b0)}function sB(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(ob(this),e,...t);return gP.set(r,e.sort?e.sort():[e]),Qo(r)}:tB().includes(n)?function(...e){return n.apply(ob(this),e),Qo(pP.get(this))}:function(...e){return Qo(n.apply(ob(this),e))}}function oB(n){return typeof n=="function"?sB(n):(n instanceof IDBTransaction&&rB(n),JF(n,eB())?new Proxy(n,b0):n)}function Qo(n){if(n instanceof IDBRequest)return nB(n);if(sb.has(n))return sb.get(n);const e=oB(n);return e!==n&&(sb.set(n,e),GT.set(e,n)),e}const ob=n=>GT.get(n);function aB(n,e,{blocked:t,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(n,e),l=Qo(o);return r&&o.addEventListener("upgradeneeded",u=>{r(Qo(o.result),u.oldVersion,u.newVersion,Qo(o.transaction),u)}),t&&o.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),l.then(u=>{s&&u.addEventListener("close",()=>s()),i&&u.addEventListener("versionchange",h=>i(h.oldVersion,h.newVersion,h))}).catch(()=>{}),l}const lB=["get","getKey","getAll","getAllKeys","count"],cB=["put","add","delete","clear"],ab=new Map;function $S(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(ab.get(e))return ab.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,i=cB.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||lB.includes(t)))return;const s=async function(o,...l){const u=this.transaction(o,i?"readwrite":"readonly");let h=u.store;return r&&(h=h.index(l.shift())),(await Promise.all([h[t](...l),i&&u.done]))[0]};return ab.set(e,s),s}iB(n=>({...n,get:(e,t,r)=>$S(e,t)||n.get(e,t,r),has:(e,t)=>!!$S(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uB{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(hB(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function hB(n){return n.getComponent()?.type==="VERSION"}const T0="@firebase/app",WS="0.14.3";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ls=new KT("@firebase/app"),fB="@firebase/app-compat",dB="@firebase/analytics-compat",pB="@firebase/analytics",gB="@firebase/app-check-compat",mB="@firebase/app-check",_B="@firebase/auth",yB="@firebase/auth-compat",vB="@firebase/database",bB="@firebase/data-connect",TB="@firebase/database-compat",wB="@firebase/functions",EB="@firebase/functions-compat",xB="@firebase/installations",AB="@firebase/installations-compat",SB="@firebase/messaging",RB="@firebase/messaging-compat",CB="@firebase/performance",IB="@firebase/performance-compat",PB="@firebase/remote-config",MB="@firebase/remote-config-compat",OB="@firebase/storage",kB="@firebase/storage-compat",NB="@firebase/firestore",DB="@firebase/ai",LB="@firebase/firestore-compat",UB="firebase",FB="12.3.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w0="[DEFAULT]",BB={[T0]:"fire-core",[fB]:"fire-core-compat",[pB]:"fire-analytics",[dB]:"fire-analytics-compat",[mB]:"fire-app-check",[gB]:"fire-app-check-compat",[_B]:"fire-auth",[yB]:"fire-auth-compat",[vB]:"fire-rtdb",[bB]:"fire-data-connect",[TB]:"fire-rtdb-compat",[wB]:"fire-fn",[EB]:"fire-fn-compat",[xB]:"fire-iid",[AB]:"fire-iid-compat",[SB]:"fire-fcm",[RB]:"fire-fcm-compat",[CB]:"fire-perf",[IB]:"fire-perf-compat",[PB]:"fire-rc",[MB]:"fire-rc-compat",[OB]:"fire-gcs",[kB]:"fire-gcs-compat",[NB]:"fire-fst",[LB]:"fire-fst-compat",[DB]:"fire-vertex","fire-js":"fire-js",[UB]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mm=new Map,VB=new Map,E0=new Map;function qS(n,e){try{n.container.addComponent(e)}catch(t){Ls.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function lu(n){const e=n.name;if(E0.has(e))return Ls.debug(`There were multiple attempts to register component ${e}.`),!1;E0.set(e,n);for(const t of mm.values())qS(t,n);for(const t of VB.values())qS(t,n);return!0}function ZT(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Vr(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zB={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Jo=new hd("app","Firebase",zB);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jB{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new _l("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Jo.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ou=FB;function mP(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:w0,automaticDataCollectionEnabled:!0,...e},i=r.name;if(typeof i!="string"||!i)throw Jo.create("bad-app-name",{appName:String(i)});if(t||(t=uP()),!t)throw Jo.create("no-options");const s=mm.get(i);if(s){if(ml(t,s.options)&&ml(r,s.config))return s;throw Jo.create("duplicate-app",{appName:i})}const o=new YF(i);for(const u of E0.values())o.addComponent(u);const l=new jB(t,r,o);return mm.set(i,l),l}function _P(n=w0){const e=mm.get(n);if(!e&&n===w0&&uP())return mP();if(!e)throw Jo.create("no-app",{appName:n});return e}function ea(n,e,t){let r=BB[n]??n;t&&(r+=`-${t}`);const i=r.match(/\s|\//),s=e.match(/\s|\//);if(i||s){const o=[`Unable to register library "${r}" with version "${e}":`];i&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&s&&o.push("and"),s&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ls.warn(o.join(" "));return}lu(new _l(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HB="firebase-heartbeat-database",$B=1,Vf="firebase-heartbeat-store";let lb=null;function yP(){return lb||(lb=aB(HB,$B,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Vf)}catch(t){console.warn(t)}}}}).catch(n=>{throw Jo.create("idb-open",{originalErrorMessage:n.message})})),lb}async function WB(n){try{const t=(await yP()).transaction(Vf),r=await t.objectStore(Vf).get(vP(n));return await t.done,r}catch(e){if(e instanceof Ys)Ls.warn(e.message);else{const t=Jo.create("idb-get",{originalErrorMessage:e?.message});Ls.warn(t.message)}}}async function XS(n,e){try{const r=(await yP()).transaction(Vf,"readwrite");await r.objectStore(Vf).put(e,vP(n)),await r.done}catch(t){if(t instanceof Ys)Ls.warn(t.message);else{const r=Jo.create("idb-set",{originalErrorMessage:t?.message});Ls.warn(r.message)}}}function vP(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qB=1024,XB=30;class YB{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new GB(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=YS();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(i=>i.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats.length>XB){const i=ZB(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(i,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Ls.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=YS(),{heartbeatsToSend:t,unsentEntries:r}=KB(this._heartbeatsCache.heartbeats),i=gm(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return Ls.warn(e),""}}}function YS(){return new Date().toISOString().substring(0,10)}function KB(n,e=qB){const t=[];let r=n.slice();for(const i of n){const s=t.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),KS(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),KS(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class GB{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return LF()?UF().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await WB(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return XS(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return XS(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function KS(n){return gm(JSON.stringify({version:2,heartbeats:n})).length}function ZB(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QB(n){lu(new _l("platform-logger",e=>new uB(e),"PRIVATE")),lu(new _l("heartbeat",e=>new YB(e),"PRIVATE")),ea(T0,WS,n),ea(T0,WS,"esm2020"),ea("fire-js","")}QB("");function bP(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const JB=bP,TP=new hd("auth","Firebase",bP());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _m=new KT("@firebase/auth");function eV(n,...e){_m.logLevel<=nt.WARN&&_m.warn(`Auth (${Ou}): ${n}`,...e)}function Vg(n,...e){_m.logLevel<=nt.ERROR&&_m.error(`Auth (${Ou}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fi(n,...e){throw QT(n,...e)}function zi(n,...e){return QT(n,...e)}function wP(n,e,t){const r={...JB(),[e]:t};return new hd("auth","Firebase",r).create(e,{appName:n.name})}function Os(n){return wP(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function QT(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return TP.create(n,...e)}function ze(n,e,...t){if(!n)throw QT(e,...t)}function Cs(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Vg(e),new Error(e)}function Us(n,e){n||Cs(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x0(){return typeof self<"u"&&self.location?.href||""}function tV(){return GS()==="http:"||GS()==="https:"}function GS(){return typeof self<"u"&&self.location?.protocol||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nV(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(tV()||OF()||"connection"in navigator)?navigator.onLine:!0}function rV(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dd{constructor(e,t){this.shortDelay=e,this.longDelay=t,Us(t>e,"Short delay should be less than long delay!"),this.isMobile=IF()||kF()}get(){return nV()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JT(n,e){Us(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EP{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Cs("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Cs("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Cs("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iV={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sV=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],oV=new dd(3e4,6e4);function _a(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function ya(n,e,t,r,i={}){return xP(n,i,async()=>{let s={},o={};r&&(e==="GET"?o=r:s={body:JSON.stringify(r)});const l=fd({key:n.config.apiKey,...o}).slice(1),u=await n._getAdditionalHeaders();u["Content-Type"]="application/json",n.languageCode&&(u["X-Firebase-Locale"]=n.languageCode);const h={method:e,headers:u,...s};return MF()||(h.referrerPolicy="no-referrer"),n.emulatorConfig&&Mu(n.emulatorConfig.host)&&(h.credentials="include"),EP.fetch()(await AP(n,n.config.apiHost,t,l),h)})}async function xP(n,e,t){n._canInitEmulator=!1;const r={...iV,...e};try{const i=new lV(n),s=await Promise.race([t(),i.promise]);i.clearNetworkTimeout();const o=await s.json();if("needConfirmation"in o)throw Qp(n,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{const l=s.ok?o.errorMessage:o.error.message,[u,h]=l.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw Qp(n,"credential-already-in-use",o);if(u==="EMAIL_EXISTS")throw Qp(n,"email-already-in-use",o);if(u==="USER_DISABLED")throw Qp(n,"user-disabled",o);const d=r[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw wP(n,d,h);fi(n,d)}}catch(i){if(i instanceof Ys)throw i;fi(n,"network-request-failed",{message:String(i)})}}async function pd(n,e,t,r,i={}){const s=await ya(n,e,t,r,i);return"mfaPendingCredential"in s&&fi(n,"multi-factor-auth-required",{_serverResponse:s}),s}async function AP(n,e,t,r){const i=`${e}${t}?${r}`,s=n,o=s.config.emulator?JT(n.config,i):`${n.config.apiScheme}://${i}`;return sV.includes(t)&&(await s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(o).toString():o}function aV(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class lV{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(zi(this.auth,"network-request-failed")),oV.get())})}}function Qp(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const i=zi(n,e,r);return i.customData._tokenResponse=t,i}function ZS(n){return n!==void 0&&n.enterprise!==void 0}class cV{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return aV(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function uV(n,e){return ya(n,"GET","/v2/recaptchaConfig",_a(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hV(n,e){return ya(n,"POST","/v1/accounts:delete",e)}async function ym(n,e){return ya(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ef(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function fV(n,e=!1){const t=ur(n),r=await t.getIdToken(e),i=ew(r);ze(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");const s=typeof i.firebase=="object"?i.firebase:void 0,o=s?.sign_in_provider;return{claims:i,token:r,authTime:Ef(cb(i.auth_time)),issuedAtTime:Ef(cb(i.iat)),expirationTime:Ef(cb(i.exp)),signInProvider:o||null,signInSecondFactor:s?.sign_in_second_factor||null}}function cb(n){return Number(n)*1e3}function ew(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Vg("JWT malformed, contained fewer than 3 sections"),null;try{const i=lP(t);return i?JSON.parse(i):(Vg("Failed to decode base64 JWT payload"),null)}catch(i){return Vg("Caught error parsing JWT payload as JSON",i?.toString()),null}}function QS(n){const e=ew(n);return ze(e,"internal-error"),ze(typeof e.exp<"u","internal-error"),ze(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zf(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Ys&&dV(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function dV({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pV{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A0{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ef(this.lastLoginAt),this.creationTime=Ef(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vm(n){const e=n.auth,t=await n.getIdToken(),r=await zf(n,ym(e,{idToken:t}));ze(r?.users.length,e,"internal-error");const i=r.users[0];n._notifyReloadListener(i);const s=i.providerUserInfo?.length?SP(i.providerUserInfo):[],o=mV(n.providerData,s),l=n.isAnonymous,u=!(n.email&&i.passwordHash)&&!o?.length,h=l?u:!1,d={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new A0(i.createdAt,i.lastLoginAt),isAnonymous:h};Object.assign(n,d)}async function gV(n){const e=ur(n);await vm(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function mV(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function SP(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _V(n,e){const t=await xP(n,{},async()=>{const r=fd({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=n.config,o=await AP(n,i,"/v1/token",`key=${s}`),l=await n._getAdditionalHeaders();l["Content-Type"]="application/x-www-form-urlencoded";const u={method:"POST",headers:l,body:r};return n.emulatorConfig&&Mu(n.emulatorConfig.host)&&(u.credentials="include"),EP.fetch()(o,u)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function yV(n,e){return ya(n,"POST","/v2/accounts:revokeToken",_a(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jc{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ze(e.idToken,"internal-error"),ze(typeof e.idToken<"u","internal-error"),ze(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):QS(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){ze(e.length!==0,"internal-error");const t=QS(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(ze(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:i,expiresIn:s}=await _V(e,t);this.updateTokensAndExpiration(r,i,Number(s))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:i,expirationTime:s}=t,o=new Jc;return r&&(ze(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),i&&(ze(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),s&&(ze(typeof s=="number","internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Jc,this.toJSON())}_performRefresh(){return Cs("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ko(n,e){ze(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class ai{constructor({uid:e,auth:t,stsTokenManager:r,...i}){this.providerId="firebase",this.proactiveRefresh=new pV(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new A0(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await zf(this,this.stsTokenManager.getToken(this.auth,e));return ze(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return fV(this,e)}reload(){return gV(this)}_assign(e){this!==e&&(ze(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new ai({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){ze(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await vm(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Vr(this.auth.app))return Promise.reject(Os(this.auth));const e=await this.getIdToken();return await zf(this,hV(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,i=t.email??void 0,s=t.phoneNumber??void 0,o=t.photoURL??void 0,l=t.tenantId??void 0,u=t._redirectEventId??void 0,h=t.createdAt??void 0,d=t.lastLoginAt??void 0,{uid:g,emailVerified:y,isAnonymous:b,providerData:w,stsTokenManager:E}=t;ze(g&&E,e,"internal-error");const x=Jc.fromJSON(this.name,E);ze(typeof g=="string",e,"internal-error"),ko(r,e.name),ko(i,e.name),ze(typeof y=="boolean",e,"internal-error"),ze(typeof b=="boolean",e,"internal-error"),ko(s,e.name),ko(o,e.name),ko(l,e.name),ko(u,e.name),ko(h,e.name),ko(d,e.name);const C=new ai({uid:g,auth:e,email:i,emailVerified:y,displayName:r,isAnonymous:b,photoURL:o,phoneNumber:s,tenantId:l,stsTokenManager:x,createdAt:h,lastLoginAt:d});return w&&Array.isArray(w)&&(C.providerData=w.map(M=>({...M}))),u&&(C._redirectEventId=u),C}static async _fromIdTokenResponse(e,t,r=!1){const i=new Jc;i.updateFromServerResponse(t);const s=new ai({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await vm(s),s}static async _fromGetAccountInfoResponse(e,t,r){const i=t.users[0];ze(i.localId!==void 0,"internal-error");const s=i.providerUserInfo!==void 0?SP(i.providerUserInfo):[],o=!(i.email&&i.passwordHash)&&!s?.length,l=new Jc;l.updateFromIdToken(r);const u=new ai({uid:i.localId,auth:e,stsTokenManager:l,isAnonymous:o}),h={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new A0(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!s?.length};return Object.assign(u,h),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JS=new Map;function Is(n){Us(n instanceof Function,"Expected a class definition");let e=JS.get(n);return e?(Us(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,JS.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RP{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}RP.type="NONE";const e2=RP;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zg(n,e,t){return`firebase:${n}:${e}:${t}`}class eu{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:i,name:s}=this.auth;this.fullUserKey=zg(this.userKey,i.apiKey,s),this.fullPersistenceKey=zg("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await ym(this.auth,{idToken:e}).catch(()=>{});return t?ai._fromGetAccountInfoResponse(this.auth,t,e):null}return ai._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new eu(Is(e2),e,r);const i=(await Promise.all(t.map(async h=>{if(await h._isAvailable())return h}))).filter(h=>h);let s=i[0]||Is(e2);const o=zg(r,e.config.apiKey,e.name);let l=null;for(const h of t)try{const d=await h._get(o);if(d){let g;if(typeof d=="string"){const y=await ym(e,{idToken:d}).catch(()=>{});if(!y)break;g=await ai._fromGetAccountInfoResponse(e,y,d)}else g=ai._fromJSON(e,d);h!==s&&(l=g),s=h;break}}catch{}const u=i.filter(h=>h._shouldAllowMigration);return!s._shouldAllowMigration||!u.length?new eu(s,e,r):(s=u[0],l&&await s._set(o,l.toJSON()),await Promise.all(t.map(async h=>{if(h!==s)try{await h._remove(o)}catch{}})),new eu(s,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t2(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(MP(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(CP(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(kP(e))return"Blackberry";if(NP(e))return"Webos";if(IP(e))return"Safari";if((e.includes("chrome/")||PP(e))&&!e.includes("edge/"))return"Chrome";if(OP(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function CP(n=Kn()){return/firefox\//i.test(n)}function IP(n=Kn()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function PP(n=Kn()){return/crios\//i.test(n)}function MP(n=Kn()){return/iemobile/i.test(n)}function OP(n=Kn()){return/android/i.test(n)}function kP(n=Kn()){return/blackberry/i.test(n)}function NP(n=Kn()){return/webos/i.test(n)}function tw(n=Kn()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function vV(n=Kn()){return tw(n)&&!!window.navigator?.standalone}function bV(){return NF()&&document.documentMode===10}function DP(n=Kn()){return tw(n)||OP(n)||NP(n)||kP(n)||/windows phone/i.test(n)||MP(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LP(n,e=[]){let t;switch(n){case"Browser":t=t2(Kn());break;case"Worker":t=`${t2(Kn())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Ou}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TV{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=s=>new Promise((o,l)=>{try{const u=e(s);o(u)}catch(u){l(u)}});r.onAbort=t,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wV(n,e={}){return ya(n,"GET","/v2/passwordPolicy",_a(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EV=6;class xV{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??EV,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AV{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new n2(this),this.idTokenSubscription=new n2(this),this.beforeStateQueue=new TV(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=TP,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Is(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await eu.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await ym(this,{idToken:e}),r=await ai._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Vr(this.app)){const s=this.app.settings.authIdToken;return s?new Promise(o=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(s).then(o,o))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const s=this.redirectUser?._redirectEventId,o=r?._redirectEventId,l=await this.tryRedirectSignIn(e);(!s||s===o)&&l?.user&&(r=l.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(s){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(s))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return ze(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await vm(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=rV()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Vr(this.app))return Promise.reject(Os(this));const t=e?ur(e):null;return t&&ze(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&ze(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Vr(this.app)?Promise.reject(Os(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Vr(this.app)?Promise.reject(Os(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Is(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await wV(this),t=new xV(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new hd("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await yV(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Is(e)||this._popupRedirectResolver;ze(t,this,"argument-error"),this.redirectPersistenceManager=await eu.create(this,[Is(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};const s=typeof t=="function"?t:t.next.bind(t);let o=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(ze(l,this,"internal-error"),l.then(()=>{o||s(this.currentUser)}),typeof t=="function"){const u=e.addObserver(t,r,i);return()=>{o=!0,u()}}else{const u=e.addObserver(t);return()=>{o=!0,u()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ze(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=LP(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(Vr(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&eV(`Error while retrieving App Check token: ${e.error}`),e?.token}}function Cl(n){return ur(n)}class n2{constructor(e){this.auth=e,this.observer=null,this.addObserver=jF(t=>this.observer=t)}get next(){return ze(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let d_={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function SV(n){d_=n}function UP(n){return d_.loadJS(n)}function RV(){return d_.recaptchaEnterpriseScript}function CV(){return d_.gapiScript}function IV(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class PV{constructor(){this.enterprise=new MV}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class MV{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const OV="recaptcha-enterprise",FP="NO_RECAPTCHA";class kV{constructor(e){this.type=OV,this.auth=Cl(e)}async verify(e="verify",t=!1){async function r(s){if(!t){if(s.tenantId==null&&s._agentRecaptchaConfig!=null)return s._agentRecaptchaConfig.siteKey;if(s.tenantId!=null&&s._tenantRecaptchaConfigs[s.tenantId]!==void 0)return s._tenantRecaptchaConfigs[s.tenantId].siteKey}return new Promise(async(o,l)=>{uV(s,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(u=>{if(u.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const h=new cV(u);return s.tenantId==null?s._agentRecaptchaConfig=h:s._tenantRecaptchaConfigs[s.tenantId]=h,o(h.siteKey)}}).catch(u=>{l(u)})})}function i(s,o,l){const u=window.grecaptcha;ZS(u)?u.enterprise.ready(()=>{u.enterprise.execute(s,{action:e}).then(h=>{o(h)}).catch(()=>{o(FP)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new PV().execute("siteKey",{action:"verify"}):new Promise((s,o)=>{r(this.auth).then(l=>{if(!t&&ZS(window.grecaptcha))i(l,s,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let u=RV();u.length!==0&&(u+=l),UP(u).then(()=>{i(l,s,o)}).catch(h=>{o(h)})}}).catch(l=>{o(l)})})}}async function r2(n,e,t,r=!1,i=!1){const s=new kV(n);let o;if(i)o=FP;else try{o=await s.verify(t)}catch{o=await s.verify(t,!0)}const l={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in l){const u=l.phoneEnrollmentInfo.phoneNumber,h=l.phoneEnrollmentInfo.recaptchaToken;Object.assign(l,{phoneEnrollmentInfo:{phoneNumber:u,recaptchaToken:h,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in l){const u=l.phoneSignInInfo.recaptchaToken;Object.assign(l,{phoneSignInInfo:{recaptchaToken:u,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return l}return r?Object.assign(l,{captchaResp:o}):Object.assign(l,{captchaResponse:o}),Object.assign(l,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(l,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),l}async function S0(n,e,t,r,i){if(n._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const s=await r2(n,e,t,t==="getOobCode");return r(n,s)}else return r(n,e).catch(async s=>{if(s.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await r2(n,e,t,t==="getOobCode");return r(n,o)}else return Promise.reject(s)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NV(n,e){const t=ZT(n,"auth");if(t.isInitialized()){const i=t.getImmediate(),s=t.getOptions();if(ml(s,e??{}))return i;fi(i,"already-initialized")}return t.initialize({options:e})}function DV(n,e){const t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(Is);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function LV(n,e,t){const r=Cl(n);ze(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!1,s=BP(e),{host:o,port:l}=UV(e),u=l===null?"":`:${l}`,h={url:`${s}//${o}${u}/`},d=Object.freeze({host:o,port:l,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){ze(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),ze(ml(h,r.config.emulator)&&ml(d,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=h,r.emulatorConfig=d,r.settings.appVerificationDisabledForTesting=!0,Mu(o)?(fP(`${s}//${o}${u}`),dP("Auth",!0)):FV()}function BP(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function UV(n){const e=BP(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const s=i[1];return{host:s,port:i2(r.substr(s.length+1))}}else{const[s,o]=r.split(":");return{host:s,port:i2(o)}}}function i2(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function FV(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nw{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Cs("not implemented")}_getIdTokenResponse(e){return Cs("not implemented")}_linkToIdToken(e,t){return Cs("not implemented")}_getReauthenticationResolver(e){return Cs("not implemented")}}async function BV(n,e){return ya(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function VV(n,e){return pd(n,"POST","/v1/accounts:signInWithPassword",_a(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zV(n,e){return pd(n,"POST","/v1/accounts:signInWithEmailLink",_a(n,e))}async function jV(n,e){return pd(n,"POST","/v1/accounts:signInWithEmailLink",_a(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jf extends nw{constructor(e,t,r,i=null){super("password",r),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new jf(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new jf(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return S0(e,t,"signInWithPassword",VV);case"emailLink":return zV(e,{email:this._email,oobCode:this._password});default:fi(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return S0(e,r,"signUpPassword",BV);case"emailLink":return jV(e,{idToken:t,email:this._email,oobCode:this._password});default:fi(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tu(n,e){return pd(n,"POST","/v1/accounts:signInWithIdp",_a(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HV="http://localhost";class yl extends nw{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new yl(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):fi("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i,...s}=t;if(!r||!i)return null;const o=new yl(r,i);return o.idToken=s.idToken||void 0,o.accessToken=s.accessToken||void 0,o.secret=s.secret,o.nonce=s.nonce,o.pendingToken=s.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return tu(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,tu(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,tu(e,t)}buildRequest(){const e={requestUri:HV,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=fd(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $V(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function WV(n){const e=uf(hf(n)).link,t=e?uf(hf(e)).deep_link_id:null,r=uf(hf(n)).deep_link_id;return(r?uf(hf(r)).link:null)||r||t||e||n}class rw{constructor(e){const t=uf(hf(e)),r=t.apiKey??null,i=t.oobCode??null,s=$V(t.mode??null);ze(r&&i&&s,"argument-error"),this.apiKey=r,this.operation=s,this.code=i,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=WV(e);try{return new rw(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ku{constructor(){this.providerId=ku.PROVIDER_ID}static credential(e,t){return jf._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=rw.parseLink(t);return ze(r,"argument-error"),jf._fromEmailAndCode(e,r.code,r.tenantId)}}ku.PROVIDER_ID="password";ku.EMAIL_PASSWORD_SIGN_IN_METHOD="password";ku.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VP{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gd extends VP{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jo extends gd{constructor(){super("facebook.com")}static credential(e){return yl._fromParams({providerId:jo.PROVIDER_ID,signInMethod:jo.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return jo.credentialFromTaggedObject(e)}static credentialFromError(e){return jo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return jo.credential(e.oauthAccessToken)}catch{return null}}}jo.FACEBOOK_SIGN_IN_METHOD="facebook.com";jo.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ho extends gd{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return yl._fromParams({providerId:Ho.PROVIDER_ID,signInMethod:Ho.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Ho.credentialFromTaggedObject(e)}static credentialFromError(e){return Ho.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Ho.credential(t,r)}catch{return null}}}Ho.GOOGLE_SIGN_IN_METHOD="google.com";Ho.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $o extends gd{constructor(){super("github.com")}static credential(e){return yl._fromParams({providerId:$o.PROVIDER_ID,signInMethod:$o.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return $o.credentialFromTaggedObject(e)}static credentialFromError(e){return $o.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return $o.credential(e.oauthAccessToken)}catch{return null}}}$o.GITHUB_SIGN_IN_METHOD="github.com";$o.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wo extends gd{constructor(){super("twitter.com")}static credential(e,t){return yl._fromParams({providerId:Wo.PROVIDER_ID,signInMethod:Wo.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Wo.credentialFromTaggedObject(e)}static credentialFromError(e){return Wo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Wo.credential(t,r)}catch{return null}}}Wo.TWITTER_SIGN_IN_METHOD="twitter.com";Wo.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qV(n,e){return pd(n,"POST","/v1/accounts:signUp",_a(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vl{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,i=!1){const s=await ai._fromIdTokenResponse(e,r,i),o=s2(r);return new vl({user:s,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const i=s2(r);return new vl({user:e,providerId:i,_tokenResponse:r,operationType:t})}}function s2(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bm extends Ys{constructor(e,t,r,i){super(t.code,t.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,bm.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,i){return new bm(e,t,r,i)}}function zP(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?bm._fromErrorAndOperation(n,s,e,r):s})}async function XV(n,e,t=!1){const r=await zf(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return vl._forOperation(n,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YV(n,e,t=!1){const{auth:r}=n;if(Vr(r.app))return Promise.reject(Os(r));const i="reauthenticate";try{const s=await zf(n,zP(r,i,e,n),t);ze(s.idToken,r,"internal-error");const o=ew(s.idToken);ze(o,r,"internal-error");const{sub:l}=o;return ze(n.uid===l,r,"user-mismatch"),vl._forOperation(n,i,s)}catch(s){throw s?.code==="auth/user-not-found"&&fi(r,"user-mismatch"),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jP(n,e,t=!1){if(Vr(n.app))return Promise.reject(Os(n));const r="signIn",i=await zP(n,r,e),s=await vl._fromIdTokenResponse(n,r,i);return t||await n._updateCurrentUser(s.user),s}async function KV(n,e){return jP(Cl(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function HP(n){const e=Cl(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function GV(n,e,t){if(Vr(n.app))return Promise.reject(Os(n));const r=Cl(n),o=await S0(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",qV).catch(u=>{throw u.code==="auth/password-does-not-meet-requirements"&&HP(n),u}),l=await vl._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(l.user),l}function ZV(n,e,t){return Vr(n.app)?Promise.reject(Os(n)):KV(ur(n),ku.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&HP(n),r})}function QV(n,e,t,r){return ur(n).onIdTokenChanged(e,t,r)}function JV(n,e,t){return ur(n).beforeAuthStateChanged(e,t)}function iw(n,e,t,r){return ur(n).onAuthStateChanged(e,t,r)}function e5(n){return ur(n).signOut()}async function t5(n){return ur(n).delete()}const Tm="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $P{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Tm,"1"),this.storage.removeItem(Tm),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n5=1e3,r5=10;class WP extends $P{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=DP(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),i=this.localCache[t];r!==i&&e(t,i,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,l,u)=>{this.notifyListeners(o,u)});return}const r=e.key;t?this.detachListener():this.stopPolling();const i=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},s=this.storage.getItem(r);bV()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,r5):i()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},n5)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}WP.type="LOCAL";const i5=WP;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qP extends $P{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}qP.type="SESSION";const XP=qP;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s5(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p_{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(i=>i.isListeningto(e));if(t)return t;const r=new p_(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:i,data:s}=t.data,o=this.handlersMap[i];if(!o?.size)return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const l=Array.from(o).map(async h=>h(t.origin,s)),u=await s5(l);t.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:u})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}p_.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sw(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o5{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,o;return new Promise((l,u)=>{const h=sw("",20);i.port1.start();const d=setTimeout(()=>{u(new Error("unsupported_event"))},r);o={messageChannel:i,onMessage(g){const y=g;if(y.data.eventId===h)switch(y.data.status){case"ack":clearTimeout(d),s=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),l(y.data.response);break;default:clearTimeout(d),clearTimeout(s),u(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:h,data:t},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ji(){return window}function a5(n){ji().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YP(){return typeof ji().WorkerGlobalScope<"u"&&typeof ji().importScripts=="function"}async function l5(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function c5(){return navigator?.serviceWorker?.controller||null}function u5(){return YP()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KP="firebaseLocalStorageDb",h5=1,wm="firebaseLocalStorage",GP="fbase_key";class md{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function g_(n,e){return n.transaction([wm],e?"readwrite":"readonly").objectStore(wm)}function f5(){const n=indexedDB.deleteDatabase(KP);return new md(n).toPromise()}function R0(){const n=indexedDB.open(KP,h5);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(wm,{keyPath:GP})}catch(i){t(i)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(wm)?e(r):(r.close(),await f5(),e(await R0()))})})}async function o2(n,e,t){const r=g_(n,!0).put({[GP]:e,value:t});return new md(r).toPromise()}async function d5(n,e){const t=g_(n,!1).get(e),r=await new md(t).toPromise();return r===void 0?null:r.value}function a2(n,e){const t=g_(n,!0).delete(e);return new md(t).toPromise()}const p5=800,g5=3;class ZP{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await R0(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>g5)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return YP()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=p_._getInstance(u5()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await l5(),!this.activeServiceWorker)return;this.sender=new o5(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||c5()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await R0();return await o2(e,Tm,"1"),await a2(e,Tm),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>o2(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>d5(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>a2(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const s=g_(i,!1).getAll();return new md(s).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:i,value:s}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(s)&&(this.notifyListeners(i,s),t.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),t.push(i));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),p5)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}ZP.type="LOCAL";const m5=ZP;new dd(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _5(n,e){return e?Is(e):(ze(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ow extends nw{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return tu(e,this._buildIdpRequest())}_linkToIdToken(e,t){return tu(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return tu(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function y5(n){return jP(n.auth,new ow(n),n.bypassAuthState)}function v5(n){const{auth:e,user:t}=n;return ze(t,e,"internal-error"),YV(t,new ow(n),n.bypassAuthState)}async function b5(n){const{auth:e,user:t}=n;return ze(t,e,"internal-error"),XV(t,new ow(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QP{constructor(e,t,r,i,s=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:i,tenantId:s,error:o,type:l}=e;if(o){this.reject(o);return}const u={auth:this.auth,requestUri:t,sessionId:r,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(u))}catch(h){this.reject(h)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return y5;case"linkViaPopup":case"linkViaRedirect":return b5;case"reauthViaPopup":case"reauthViaRedirect":return v5;default:fi(this.auth,"internal-error")}}resolve(e){Us(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Us(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T5=new dd(2e3,1e4);class zc extends QP{constructor(e,t,r,i,s){super(e,t,i,s),this.provider=r,this.authWindow=null,this.pollId=null,zc.currentPopupAction&&zc.currentPopupAction.cancel(),zc.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ze(e,this.auth,"internal-error"),e}async onExecution(){Us(this.filter.length===1,"Popup operations only handle one event");const e=sw();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(zi(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(zi(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,zc.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(zi(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,T5.get())};e()}}zc.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w5="pendingRedirect",jg=new Map;class E5 extends QP{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=jg.get(this.auth._key());if(!e){try{const r=await x5(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}jg.set(this.auth._key(),e)}return this.bypassAuthState||jg.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function x5(n,e){const t=R5(e),r=S5(n);if(!await r._isAvailable())return!1;const i=await r._get(t)==="true";return await r._remove(t),i}function A5(n,e){jg.set(n._key(),e)}function S5(n){return Is(n._redirectPersistence)}function R5(n){return zg(w5,n.config.apiKey,n.name)}async function C5(n,e,t=!1){if(Vr(n.app))return Promise.reject(Os(n));const r=Cl(n),i=_5(r,e),o=await new E5(r,i,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I5=600*1e3;class P5{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!M5(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!JP(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";t.onError(zi(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=I5&&this.cachedEventUids.clear(),this.cachedEventUids.has(l2(e))}saveEventToCache(e){this.cachedEventUids.add(l2(e)),this.lastProcessedEventTime=Date.now()}}function l2(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function JP({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function M5(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return JP(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function O5(n,e={}){return ya(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k5=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,N5=/^https?/;async function D5(n){if(n.config.emulator)return;const{authorizedDomains:e}=await O5(n);for(const t of e)try{if(L5(t))return}catch{}fi(n,"unauthorized-domain")}function L5(n){const e=x0(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!N5.test(t))return!1;if(k5.test(n))return r===n;const i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U5=new dd(3e4,6e4);function c2(){const n=ji().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function F5(n){return new Promise((e,t)=>{function r(){c2(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{c2(),t(zi(n,"network-request-failed"))},timeout:U5.get()})}if(ji().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(ji().gapi?.load)r();else{const i=IV("iframefcb");return ji()[i]=()=>{gapi.load?r():t(zi(n,"network-request-failed"))},UP(`${CV()}?onload=${i}`).catch(s=>t(s))}}).catch(e=>{throw Hg=null,e})}let Hg=null;function B5(n){return Hg=Hg||F5(n),Hg}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V5=new dd(5e3,15e3),z5="__/auth/iframe",j5="emulator/auth/iframe",H5={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},$5=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function W5(n){const e=n.config;ze(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?JT(e,j5):`https://${n.config.authDomain}/${z5}`,r={apiKey:e.apiKey,appName:n.name,v:Ou},i=$5.get(n.config.apiHost);i&&(r.eid=i);const s=n._getFrameworks();return s.length&&(r.fw=s.join(",")),`${t}?${fd(r).slice(1)}`}async function q5(n){const e=await B5(n),t=ji().gapi;return ze(t,n,"internal-error"),e.open({where:document.body,url:W5(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:H5,dontclear:!0},r=>new Promise(async(i,s)=>{await r.restyle({setHideOnLeave:!1});const o=zi(n,"network-request-failed"),l=ji().setTimeout(()=>{s(o)},V5.get());function u(){ji().clearTimeout(l),i(r)}r.ping(u).then(u,()=>{s(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X5={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Y5=500,K5=600,G5="_blank",Z5="http://localhost";class u2{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Q5(n,e,t,r=Y5,i=K5){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const u={...X5,width:r.toString(),height:i.toString(),top:s,left:o},h=Kn().toLowerCase();t&&(l=PP(h)?G5:t),CP(h)&&(e=e||Z5,u.scrollbars="yes");const d=Object.entries(u).reduce((y,[b,w])=>`${y}${b}=${w},`,"");if(vV(h)&&l!=="_self")return J5(e||"",l),new u2(null);const g=window.open(e||"",l,d);ze(g,n,"popup-blocked");try{g.focus()}catch{}return new u2(g)}function J5(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e8="__/auth/handler",t8="emulator/auth/handler",n8=encodeURIComponent("fac");async function h2(n,e,t,r,i,s){ze(n.config.authDomain,n,"auth-domain-config-required"),ze(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Ou,eventId:i};if(e instanceof VP){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",zF(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[d,g]of Object.entries({}))o[d]=g}if(e instanceof gd){const d=e.getScopes().filter(g=>g!=="");d.length>0&&(o.scopes=d.join(","))}n.tenantId&&(o.tid=n.tenantId);const l=o;for(const d of Object.keys(l))l[d]===void 0&&delete l[d];const u=await n._getAppCheckToken(),h=u?`#${n8}=${encodeURIComponent(u)}`:"";return`${r8(n)}?${fd(l).slice(1)}${h}`}function r8({config:n}){return n.emulator?JT(n,t8):`https://${n.authDomain}/${e8}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ub="webStorageSupport";class i8{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=XP,this._completeRedirectFn=C5,this._overrideRedirectResult=A5}async _openPopup(e,t,r,i){Us(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const s=await h2(e,t,r,x0(),i);return Q5(e,s,sw())}async _openRedirect(e,t,r,i){await this._originValidation(e);const s=await h2(e,t,r,x0(),i);return a5(s),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:i,promise:s}=this.eventManagers[t];return i?Promise.resolve(i):(Us(s,"If manager is not set, promise should be"),s)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await q5(e),r=new P5(e);return t.register("authEvent",i=>(ze(i?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(ub,{type:ub},i=>{const s=i?.[0]?.[ub];s!==void 0&&t(!!s),fi(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=D5(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return DP()||IP()||tw()}}const s8=i8;var f2="@firebase/auth",d2="1.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o8{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){ze(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a8(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function l8(n){lu(new _l("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:l}=r.options;ze(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const u={apiKey:o,authDomain:l,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:LP(n)},h=new AV(r,i,s,u);return DV(h,t),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),lu(new _l("auth-internal",e=>{const t=Cl(e.getProvider("auth").getImmediate());return(r=>new o8(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),ea(f2,d2,a8(n)),ea(f2,d2,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c8=300,u8=hP("authIdTokenMaxAge")||c8;let p2=null;const h8=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>u8)return;const i=t?.token;p2!==i&&(p2=i,await fetch(n,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function f8(n=_P()){const e=ZT(n,"auth");if(e.isInitialized())return e.getImmediate();const t=NV(n,{popupRedirectResolver:s8,persistence:[m5,i5,XP]}),r=hP("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const s=new URL(r,location.origin);if(location.origin===s.origin){const o=h8(s.toString());JV(t,o,()=>o(t.currentUser)),QV(t,l=>o(l))}}const i=cP("auth");return i&&LV(t,`http://${i}`),t}function d8(){return document.getElementsByTagName("head")?.[0]??document}SV({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{const s=zi("internal-error");s.customData=i,t(s)},r.type="text/javascript",r.charset="UTF-8",d8().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});l8("Browser");var p8="firebase",g8="12.3.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ea(p8,g8,"app");var g2=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var ta,eM;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(D,I){function N(){}N.prototype=I.prototype,D.F=I.prototype,D.prototype=new N,D.prototype.constructor=D,D.D=function(j,W,Y){for(var z=Array(arguments.length-2),de=2;de<arguments.length;de++)z[de-2]=arguments[de];return I.prototype[W].apply(j,z)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(D,I,N){N||(N=0);const j=Array(16);if(typeof I=="string")for(var W=0;W<16;++W)j[W]=I.charCodeAt(N++)|I.charCodeAt(N++)<<8|I.charCodeAt(N++)<<16|I.charCodeAt(N++)<<24;else for(W=0;W<16;++W)j[W]=I[N++]|I[N++]<<8|I[N++]<<16|I[N++]<<24;I=D.g[0],N=D.g[1],W=D.g[2];let Y=D.g[3],z;z=I+(Y^N&(W^Y))+j[0]+3614090360&4294967295,I=N+(z<<7&4294967295|z>>>25),z=Y+(W^I&(N^W))+j[1]+3905402710&4294967295,Y=I+(z<<12&4294967295|z>>>20),z=W+(N^Y&(I^N))+j[2]+606105819&4294967295,W=Y+(z<<17&4294967295|z>>>15),z=N+(I^W&(Y^I))+j[3]+3250441966&4294967295,N=W+(z<<22&4294967295|z>>>10),z=I+(Y^N&(W^Y))+j[4]+4118548399&4294967295,I=N+(z<<7&4294967295|z>>>25),z=Y+(W^I&(N^W))+j[5]+1200080426&4294967295,Y=I+(z<<12&4294967295|z>>>20),z=W+(N^Y&(I^N))+j[6]+2821735955&4294967295,W=Y+(z<<17&4294967295|z>>>15),z=N+(I^W&(Y^I))+j[7]+4249261313&4294967295,N=W+(z<<22&4294967295|z>>>10),z=I+(Y^N&(W^Y))+j[8]+1770035416&4294967295,I=N+(z<<7&4294967295|z>>>25),z=Y+(W^I&(N^W))+j[9]+2336552879&4294967295,Y=I+(z<<12&4294967295|z>>>20),z=W+(N^Y&(I^N))+j[10]+4294925233&4294967295,W=Y+(z<<17&4294967295|z>>>15),z=N+(I^W&(Y^I))+j[11]+2304563134&4294967295,N=W+(z<<22&4294967295|z>>>10),z=I+(Y^N&(W^Y))+j[12]+1804603682&4294967295,I=N+(z<<7&4294967295|z>>>25),z=Y+(W^I&(N^W))+j[13]+4254626195&4294967295,Y=I+(z<<12&4294967295|z>>>20),z=W+(N^Y&(I^N))+j[14]+2792965006&4294967295,W=Y+(z<<17&4294967295|z>>>15),z=N+(I^W&(Y^I))+j[15]+1236535329&4294967295,N=W+(z<<22&4294967295|z>>>10),z=I+(W^Y&(N^W))+j[1]+4129170786&4294967295,I=N+(z<<5&4294967295|z>>>27),z=Y+(N^W&(I^N))+j[6]+3225465664&4294967295,Y=I+(z<<9&4294967295|z>>>23),z=W+(I^N&(Y^I))+j[11]+643717713&4294967295,W=Y+(z<<14&4294967295|z>>>18),z=N+(Y^I&(W^Y))+j[0]+3921069994&4294967295,N=W+(z<<20&4294967295|z>>>12),z=I+(W^Y&(N^W))+j[5]+3593408605&4294967295,I=N+(z<<5&4294967295|z>>>27),z=Y+(N^W&(I^N))+j[10]+38016083&4294967295,Y=I+(z<<9&4294967295|z>>>23),z=W+(I^N&(Y^I))+j[15]+3634488961&4294967295,W=Y+(z<<14&4294967295|z>>>18),z=N+(Y^I&(W^Y))+j[4]+3889429448&4294967295,N=W+(z<<20&4294967295|z>>>12),z=I+(W^Y&(N^W))+j[9]+568446438&4294967295,I=N+(z<<5&4294967295|z>>>27),z=Y+(N^W&(I^N))+j[14]+3275163606&4294967295,Y=I+(z<<9&4294967295|z>>>23),z=W+(I^N&(Y^I))+j[3]+4107603335&4294967295,W=Y+(z<<14&4294967295|z>>>18),z=N+(Y^I&(W^Y))+j[8]+1163531501&4294967295,N=W+(z<<20&4294967295|z>>>12),z=I+(W^Y&(N^W))+j[13]+2850285829&4294967295,I=N+(z<<5&4294967295|z>>>27),z=Y+(N^W&(I^N))+j[2]+4243563512&4294967295,Y=I+(z<<9&4294967295|z>>>23),z=W+(I^N&(Y^I))+j[7]+1735328473&4294967295,W=Y+(z<<14&4294967295|z>>>18),z=N+(Y^I&(W^Y))+j[12]+2368359562&4294967295,N=W+(z<<20&4294967295|z>>>12),z=I+(N^W^Y)+j[5]+4294588738&4294967295,I=N+(z<<4&4294967295|z>>>28),z=Y+(I^N^W)+j[8]+2272392833&4294967295,Y=I+(z<<11&4294967295|z>>>21),z=W+(Y^I^N)+j[11]+1839030562&4294967295,W=Y+(z<<16&4294967295|z>>>16),z=N+(W^Y^I)+j[14]+4259657740&4294967295,N=W+(z<<23&4294967295|z>>>9),z=I+(N^W^Y)+j[1]+2763975236&4294967295,I=N+(z<<4&4294967295|z>>>28),z=Y+(I^N^W)+j[4]+1272893353&4294967295,Y=I+(z<<11&4294967295|z>>>21),z=W+(Y^I^N)+j[7]+4139469664&4294967295,W=Y+(z<<16&4294967295|z>>>16),z=N+(W^Y^I)+j[10]+3200236656&4294967295,N=W+(z<<23&4294967295|z>>>9),z=I+(N^W^Y)+j[13]+681279174&4294967295,I=N+(z<<4&4294967295|z>>>28),z=Y+(I^N^W)+j[0]+3936430074&4294967295,Y=I+(z<<11&4294967295|z>>>21),z=W+(Y^I^N)+j[3]+3572445317&4294967295,W=Y+(z<<16&4294967295|z>>>16),z=N+(W^Y^I)+j[6]+76029189&4294967295,N=W+(z<<23&4294967295|z>>>9),z=I+(N^W^Y)+j[9]+3654602809&4294967295,I=N+(z<<4&4294967295|z>>>28),z=Y+(I^N^W)+j[12]+3873151461&4294967295,Y=I+(z<<11&4294967295|z>>>21),z=W+(Y^I^N)+j[15]+530742520&4294967295,W=Y+(z<<16&4294967295|z>>>16),z=N+(W^Y^I)+j[2]+3299628645&4294967295,N=W+(z<<23&4294967295|z>>>9),z=I+(W^(N|~Y))+j[0]+4096336452&4294967295,I=N+(z<<6&4294967295|z>>>26),z=Y+(N^(I|~W))+j[7]+1126891415&4294967295,Y=I+(z<<10&4294967295|z>>>22),z=W+(I^(Y|~N))+j[14]+2878612391&4294967295,W=Y+(z<<15&4294967295|z>>>17),z=N+(Y^(W|~I))+j[5]+4237533241&4294967295,N=W+(z<<21&4294967295|z>>>11),z=I+(W^(N|~Y))+j[12]+1700485571&4294967295,I=N+(z<<6&4294967295|z>>>26),z=Y+(N^(I|~W))+j[3]+2399980690&4294967295,Y=I+(z<<10&4294967295|z>>>22),z=W+(I^(Y|~N))+j[10]+4293915773&4294967295,W=Y+(z<<15&4294967295|z>>>17),z=N+(Y^(W|~I))+j[1]+2240044497&4294967295,N=W+(z<<21&4294967295|z>>>11),z=I+(W^(N|~Y))+j[8]+1873313359&4294967295,I=N+(z<<6&4294967295|z>>>26),z=Y+(N^(I|~W))+j[15]+4264355552&4294967295,Y=I+(z<<10&4294967295|z>>>22),z=W+(I^(Y|~N))+j[6]+2734768916&4294967295,W=Y+(z<<15&4294967295|z>>>17),z=N+(Y^(W|~I))+j[13]+1309151649&4294967295,N=W+(z<<21&4294967295|z>>>11),z=I+(W^(N|~Y))+j[4]+4149444226&4294967295,I=N+(z<<6&4294967295|z>>>26),z=Y+(N^(I|~W))+j[11]+3174756917&4294967295,Y=I+(z<<10&4294967295|z>>>22),z=W+(I^(Y|~N))+j[2]+718787259&4294967295,W=Y+(z<<15&4294967295|z>>>17),z=N+(Y^(W|~I))+j[9]+3951481745&4294967295,D.g[0]=D.g[0]+I&4294967295,D.g[1]=D.g[1]+(W+(z<<21&4294967295|z>>>11))&4294967295,D.g[2]=D.g[2]+W&4294967295,D.g[3]=D.g[3]+Y&4294967295}r.prototype.v=function(D,I){I===void 0&&(I=D.length);const N=I-this.blockSize,j=this.C;let W=this.h,Y=0;for(;Y<I;){if(W==0)for(;Y<=N;)i(this,D,Y),Y+=this.blockSize;if(typeof D=="string"){for(;Y<I;)if(j[W++]=D.charCodeAt(Y++),W==this.blockSize){i(this,j),W=0;break}}else for(;Y<I;)if(j[W++]=D[Y++],W==this.blockSize){i(this,j),W=0;break}}this.h=W,this.o+=I},r.prototype.A=function(){var D=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);D[0]=128;for(var I=1;I<D.length-8;++I)D[I]=0;I=this.o*8;for(var N=D.length-8;N<D.length;++N)D[N]=I&255,I/=256;for(this.v(D),D=Array(16),I=0,N=0;N<4;++N)for(let j=0;j<32;j+=8)D[I++]=this.g[N]>>>j&255;return D};function s(D,I){var N=l;return Object.prototype.hasOwnProperty.call(N,D)?N[D]:N[D]=I(D)}function o(D,I){this.h=I;const N=[];let j=!0;for(let W=D.length-1;W>=0;W--){const Y=D[W]|0;j&&Y==I||(N[W]=Y,j=!1)}this.g=N}var l={};function u(D){return-128<=D&&D<128?s(D,function(I){return new o([I|0],I<0?-1:0)}):new o([D|0],D<0?-1:0)}function h(D){if(isNaN(D)||!isFinite(D))return g;if(D<0)return x(h(-D));const I=[];let N=1;for(let j=0;D>=N;j++)I[j]=D/N|0,N*=4294967296;return new o(I,0)}function d(D,I){if(D.length==0)throw Error("number format error: empty string");if(I=I||10,I<2||36<I)throw Error("radix out of range: "+I);if(D.charAt(0)=="-")return x(d(D.substring(1),I));if(D.indexOf("-")>=0)throw Error('number format error: interior "-" character');const N=h(Math.pow(I,8));let j=g;for(let Y=0;Y<D.length;Y+=8){var W=Math.min(8,D.length-Y);const z=parseInt(D.substring(Y,Y+W),I);W<8?(W=h(Math.pow(I,W)),j=j.j(W).add(h(z))):(j=j.j(N),j=j.add(h(z)))}return j}var g=u(0),y=u(1),b=u(16777216);n=o.prototype,n.m=function(){if(E(this))return-x(this).m();let D=0,I=1;for(let N=0;N<this.g.length;N++){const j=this.i(N);D+=(j>=0?j:4294967296+j)*I,I*=4294967296}return D},n.toString=function(D){if(D=D||10,D<2||36<D)throw Error("radix out of range: "+D);if(w(this))return"0";if(E(this))return"-"+x(this).toString(D);const I=h(Math.pow(D,6));var N=this;let j="";for(;;){const W=V(N,I).g;N=C(N,W.j(I));let Y=((N.g.length>0?N.g[0]:N.h)>>>0).toString(D);if(N=W,w(N))return Y+j;for(;Y.length<6;)Y="0"+Y;j=Y+j}},n.i=function(D){return D<0?0:D<this.g.length?this.g[D]:this.h};function w(D){if(D.h!=0)return!1;for(let I=0;I<D.g.length;I++)if(D.g[I]!=0)return!1;return!0}function E(D){return D.h==-1}n.l=function(D){return D=C(this,D),E(D)?-1:w(D)?0:1};function x(D){const I=D.g.length,N=[];for(let j=0;j<I;j++)N[j]=~D.g[j];return new o(N,~D.h).add(y)}n.abs=function(){return E(this)?x(this):this},n.add=function(D){const I=Math.max(this.g.length,D.g.length),N=[];let j=0;for(let W=0;W<=I;W++){let Y=j+(this.i(W)&65535)+(D.i(W)&65535),z=(Y>>>16)+(this.i(W)>>>16)+(D.i(W)>>>16);j=z>>>16,Y&=65535,z&=65535,N[W]=z<<16|Y}return new o(N,N[N.length-1]&-2147483648?-1:0)};function C(D,I){return D.add(x(I))}n.j=function(D){if(w(this)||w(D))return g;if(E(this))return E(D)?x(this).j(x(D)):x(x(this).j(D));if(E(D))return x(this.j(x(D)));if(this.l(b)<0&&D.l(b)<0)return h(this.m()*D.m());const I=this.g.length+D.g.length,N=[];for(var j=0;j<2*I;j++)N[j]=0;for(j=0;j<this.g.length;j++)for(let W=0;W<D.g.length;W++){const Y=this.i(j)>>>16,z=this.i(j)&65535,de=D.i(W)>>>16,xe=D.i(W)&65535;N[2*j+2*W]+=z*xe,M(N,2*j+2*W),N[2*j+2*W+1]+=Y*xe,M(N,2*j+2*W+1),N[2*j+2*W+1]+=z*de,M(N,2*j+2*W+1),N[2*j+2*W+2]+=Y*de,M(N,2*j+2*W+2)}for(D=0;D<I;D++)N[D]=N[2*D+1]<<16|N[2*D];for(D=I;D<2*I;D++)N[D]=0;return new o(N,0)};function M(D,I){for(;(D[I]&65535)!=D[I];)D[I+1]+=D[I]>>>16,D[I]&=65535,I++}function O(D,I){this.g=D,this.h=I}function V(D,I){if(w(I))throw Error("division by zero");if(w(D))return new O(g,g);if(E(D))return I=V(x(D),I),new O(x(I.g),x(I.h));if(E(I))return I=V(D,x(I)),new O(x(I.g),I.h);if(D.g.length>30){if(E(D)||E(I))throw Error("slowDivide_ only works with positive integers.");for(var N=y,j=I;j.l(D)<=0;)N=H(N),j=H(j);var W=G(N,1),Y=G(j,1);for(j=G(j,2),N=G(N,2);!w(j);){var z=Y.add(j);z.l(D)<=0&&(W=W.add(N),Y=z),j=G(j,1),N=G(N,1)}return I=C(D,W.j(I)),new O(W,I)}for(W=g;D.l(I)>=0;){for(N=Math.max(1,Math.floor(D.m()/I.m())),j=Math.ceil(Math.log(N)/Math.LN2),j=j<=48?1:Math.pow(2,j-48),Y=h(N),z=Y.j(I);E(z)||z.l(D)>0;)N-=j,Y=h(N),z=Y.j(I);w(Y)&&(Y=y),W=W.add(Y),D=C(D,z)}return new O(W,D)}n.B=function(D){return V(this,D).h},n.and=function(D){const I=Math.max(this.g.length,D.g.length),N=[];for(let j=0;j<I;j++)N[j]=this.i(j)&D.i(j);return new o(N,this.h&D.h)},n.or=function(D){const I=Math.max(this.g.length,D.g.length),N=[];for(let j=0;j<I;j++)N[j]=this.i(j)|D.i(j);return new o(N,this.h|D.h)},n.xor=function(D){const I=Math.max(this.g.length,D.g.length),N=[];for(let j=0;j<I;j++)N[j]=this.i(j)^D.i(j);return new o(N,this.h^D.h)};function H(D){const I=D.g.length+1,N=[];for(let j=0;j<I;j++)N[j]=D.i(j)<<1|D.i(j-1)>>>31;return new o(N,D.h)}function G(D,I){const N=I>>5;I%=32;const j=D.g.length-N,W=[];for(let Y=0;Y<j;Y++)W[Y]=I>0?D.i(Y+N)>>>I|D.i(Y+N+1)<<32-I:D.i(Y+N);return new o(W,D.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,eM=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.B,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=h,o.fromString=d,ta=o}).apply(typeof g2<"u"?g2:typeof self<"u"?self:typeof window<"u"?window:{});var Jp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var tM,ff,nM,$g,C0,rM,iM,sM;(function(){var n,e=Object.defineProperty;function t(m){m=[typeof globalThis=="object"&&globalThis,m,typeof window=="object"&&window,typeof self=="object"&&self,typeof Jp=="object"&&Jp];for(var T=0;T<m.length;++T){var A=m[T];if(A&&A.Math==Math)return A}throw Error("Cannot find global object")}var r=t(this);function i(m,T){if(T)e:{var A=r;m=m.split(".");for(var F=0;F<m.length-1;F++){var ce=m[F];if(!(ce in A))break e;A=A[ce]}m=m[m.length-1],F=A[m],T=T(F),T!=F&&T!=null&&e(A,m,{configurable:!0,writable:!0,value:T})}}i("Symbol.dispose",function(m){return m||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(m){return m||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(m){return m||function(T){var A=[],F;for(F in T)Object.prototype.hasOwnProperty.call(T,F)&&A.push([F,T[F]]);return A}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var s=s||{},o=this||self;function l(m){var T=typeof m;return T=="object"&&m!=null||T=="function"}function u(m,T,A){return m.call.apply(m.bind,arguments)}function h(m,T,A){return h=u,h.apply(null,arguments)}function d(m,T){var A=Array.prototype.slice.call(arguments,1);return function(){var F=A.slice();return F.push.apply(F,arguments),m.apply(this,F)}}function g(m,T){function A(){}A.prototype=T.prototype,m.Z=T.prototype,m.prototype=new A,m.prototype.constructor=m,m.Ob=function(F,ce,pe){for(var Ae=Array(arguments.length-2),We=2;We<arguments.length;We++)Ae[We-2]=arguments[We];return T.prototype[ce].apply(F,Ae)}}var y=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?m=>m&&AsyncContext.Snapshot.wrap(m):m=>m;function b(m){const T=m.length;if(T>0){const A=Array(T);for(let F=0;F<T;F++)A[F]=m[F];return A}return[]}function w(m,T){for(let F=1;F<arguments.length;F++){const ce=arguments[F];var A=typeof ce;if(A=A!="object"?A:ce?Array.isArray(ce)?"array":A:"null",A=="array"||A=="object"&&typeof ce.length=="number"){A=m.length||0;const pe=ce.length||0;m.length=A+pe;for(let Ae=0;Ae<pe;Ae++)m[A+Ae]=ce[Ae]}else m.push(ce)}}class E{constructor(T,A){this.i=T,this.j=A,this.h=0,this.g=null}get(){let T;return this.h>0?(this.h--,T=this.g,this.g=T.next,T.next=null):T=this.i(),T}}function x(m){o.setTimeout(()=>{throw m},0)}function C(){var m=D;let T=null;return m.g&&(T=m.g,m.g=m.g.next,m.g||(m.h=null),T.next=null),T}class M{constructor(){this.h=this.g=null}add(T,A){const F=O.get();F.set(T,A),this.h?this.h.next=F:this.g=F,this.h=F}}var O=new E(()=>new V,m=>m.reset());class V{constructor(){this.next=this.g=this.h=null}set(T,A){this.h=T,this.g=A,this.next=null}reset(){this.next=this.g=this.h=null}}let H,G=!1,D=new M,I=()=>{const m=Promise.resolve(void 0);H=()=>{m.then(N)}};function N(){for(var m;m=C();){try{m.h.call(m.g)}catch(A){x(A)}var T=O;T.j(m),T.h<100&&(T.h++,m.next=T.g,T.g=m)}G=!1}function j(){this.u=this.u,this.C=this.C}j.prototype.u=!1,j.prototype.dispose=function(){this.u||(this.u=!0,this.N())},j.prototype[Symbol.dispose]=function(){this.dispose()},j.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function W(m,T){this.type=m,this.g=this.target=T,this.defaultPrevented=!1}W.prototype.h=function(){this.defaultPrevented=!0};var Y=(function(){if(!o.addEventListener||!Object.defineProperty)return!1;var m=!1,T=Object.defineProperty({},"passive",{get:function(){m=!0}});try{const A=()=>{};o.addEventListener("test",A,T),o.removeEventListener("test",A,T)}catch{}return m})();function z(m){return/^[\s\xa0]*$/.test(m)}function de(m,T){W.call(this,m?m.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,m&&this.init(m,T)}g(de,W),de.prototype.init=function(m,T){const A=this.type=m.type,F=m.changedTouches&&m.changedTouches.length?m.changedTouches[0]:null;this.target=m.target||m.srcElement,this.g=T,T=m.relatedTarget,T||(A=="mouseover"?T=m.fromElement:A=="mouseout"&&(T=m.toElement)),this.relatedTarget=T,F?(this.clientX=F.clientX!==void 0?F.clientX:F.pageX,this.clientY=F.clientY!==void 0?F.clientY:F.pageY,this.screenX=F.screenX||0,this.screenY=F.screenY||0):(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0),this.button=m.button,this.key=m.key||"",this.ctrlKey=m.ctrlKey,this.altKey=m.altKey,this.shiftKey=m.shiftKey,this.metaKey=m.metaKey,this.pointerId=m.pointerId||0,this.pointerType=m.pointerType,this.state=m.state,this.i=m,m.defaultPrevented&&de.Z.h.call(this)},de.prototype.h=function(){de.Z.h.call(this);const m=this.i;m.preventDefault?m.preventDefault():m.returnValue=!1};var xe="closure_listenable_"+(Math.random()*1e6|0),P=0;function q(m,T,A,F,ce){this.listener=m,this.proxy=null,this.src=T,this.type=A,this.capture=!!F,this.ha=ce,this.key=++P,this.da=this.fa=!1}function U(m){m.da=!0,m.listener=null,m.proxy=null,m.src=null,m.ha=null}function oe(m,T,A){for(const F in m)T.call(A,m[F],F,m)}function L(m,T){for(const A in m)T.call(void 0,m[A],A,m)}function Z(m){const T={};for(const A in m)T[A]=m[A];return T}const ie="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ae(m,T){let A,F;for(let ce=1;ce<arguments.length;ce++){F=arguments[ce];for(A in F)m[A]=F[A];for(let pe=0;pe<ie.length;pe++)A=ie[pe],Object.prototype.hasOwnProperty.call(F,A)&&(m[A]=F[A])}}function me(m){this.src=m,this.g={},this.h=0}me.prototype.add=function(m,T,A,F,ce){const pe=m.toString();m=this.g[pe],m||(m=this.g[pe]=[],this.h++);const Ae=Se(m,T,F,ce);return Ae>-1?(T=m[Ae],A||(T.fa=!1)):(T=new q(T,this.src,pe,!!F,ce),T.fa=A,m.push(T)),T};function Ee(m,T){const A=T.type;if(A in m.g){var F=m.g[A],ce=Array.prototype.indexOf.call(F,T,void 0),pe;(pe=ce>=0)&&Array.prototype.splice.call(F,ce,1),pe&&(U(T),m.g[A].length==0&&(delete m.g[A],m.h--))}}function Se(m,T,A,F){for(let ce=0;ce<m.length;++ce){const pe=m[ce];if(!pe.da&&pe.listener==T&&pe.capture==!!A&&pe.ha==F)return ce}return-1}var Ce="closure_lm_"+(Math.random()*1e6|0),Me={};function at(m,T,A,F,ce){if(Array.isArray(T)){for(let pe=0;pe<T.length;pe++)at(m,T[pe],A,F,ce);return null}return A=Od(A),m&&m[xe]?m.J(T,A,l(F)?!!F.capture:!1,ce):Ke(m,T,A,!1,F,ce)}function Ke(m,T,A,F,ce,pe){if(!T)throw Error("Invalid event type");const Ae=l(ce)?!!ce.capture:!!ce;let We=tt(m);if(We||(m[Ce]=We=new me(m)),A=We.add(T,A,F,Ae,pe),A.proxy)return A;if(F=mn(),A.proxy=F,F.src=m,F.listener=A,m.addEventListener)Y||(ce=Ae),ce===void 0&&(ce=!1),m.addEventListener(T.toString(),F,ce);else if(m.attachEvent)m.attachEvent(ts(T.toString()),F);else if(m.addListener&&m.removeListener)m.addListener(F);else throw Error("addEventListener and attachEvent are unavailable.");return A}function mn(){function m(A){return T.call(m.src,m.listener,A)}const T=lt;return m}function on(m,T,A,F,ce){if(Array.isArray(T))for(var pe=0;pe<T.length;pe++)on(m,T[pe],A,F,ce);else F=l(F)?!!F.capture:!!F,A=Od(A),m&&m[xe]?(m=m.i,pe=String(T).toString(),pe in m.g&&(T=m.g[pe],A=Se(T,A,F,ce),A>-1&&(U(T[A]),Array.prototype.splice.call(T,A,1),T.length==0&&(delete m.g[pe],m.h--)))):m&&(m=tt(m))&&(T=m.g[T.toString()],m=-1,T&&(m=Se(T,A,F,ce)),(A=m>-1?T[m]:null)&&Gn(A))}function Gn(m){if(typeof m!="number"&&m&&!m.da){var T=m.src;if(T&&T[xe])Ee(T.i,m);else{var A=m.type,F=m.proxy;T.removeEventListener?T.removeEventListener(A,F,m.capture):T.detachEvent?T.detachEvent(ts(A),F):T.addListener&&T.removeListener&&T.removeListener(F),(A=tt(T))?(Ee(A,m),A.h==0&&(A.src=null,T[Ce]=null)):U(m)}}}function ts(m){return m in Me?Me[m]:Me[m]="on"+m}function lt(m,T){if(m.da)m=!0;else{T=new de(T,this);const A=m.listener,F=m.ha||m.src;m.fa&&Gn(m),m=A.call(F,T)}return m}function tt(m){return m=m[Ce],m instanceof me?m:null}var ir="__closure_events_fn_"+(Math.random()*1e9>>>0);function Od(m){return typeof m=="function"?m:(m[ir]||(m[ir]=function(T){return m.handleEvent(T)}),m[ir])}function an(){j.call(this),this.i=new me(this),this.M=this,this.G=null}g(an,j),an.prototype[xe]=!0,an.prototype.removeEventListener=function(m,T,A,F){on(this,m,T,A,F)};function _n(m,T){var A,F=m.G;if(F)for(A=[];F;F=F.G)A.push(F);if(m=m.M,F=T.type||T,typeof T=="string")T=new W(T,m);else if(T instanceof W)T.target=T.target||m;else{var ce=T;T=new W(F,m),ae(T,ce)}ce=!0;let pe,Ae;if(A)for(Ae=A.length-1;Ae>=0;Ae--)pe=T.g=A[Ae],ce=ns(pe,F,!0,T)&&ce;if(pe=T.g=m,ce=ns(pe,F,!0,T)&&ce,ce=ns(pe,F,!1,T)&&ce,A)for(Ae=0;Ae<A.length;Ae++)pe=T.g=A[Ae],ce=ns(pe,F,!1,T)&&ce}an.prototype.N=function(){if(an.Z.N.call(this),this.i){var m=this.i;for(const T in m.g){const A=m.g[T];for(let F=0;F<A.length;F++)U(A[F]);delete m.g[T],m.h--}}this.G=null},an.prototype.J=function(m,T,A,F){return this.i.add(String(m),T,!1,A,F)},an.prototype.K=function(m,T,A,F){return this.i.add(String(m),T,!0,A,F)};function ns(m,T,A,F){if(T=m.i.g[String(T)],!T)return!0;T=T.concat();let ce=!0;for(let pe=0;pe<T.length;++pe){const Ae=T[pe];if(Ae&&!Ae.da&&Ae.capture==A){const We=Ae.listener,Mt=Ae.ha||Ae.src;Ae.fa&&Ee(m.i,Ae),ce=We.call(Mt,F)!==!1&&ce}}return ce&&!F.defaultPrevented}function Q_(m,T){if(typeof m!="function")if(m&&typeof m.handleEvent=="function")m=h(m.handleEvent,m);else throw Error("Invalid listener argument");return Number(T)>2147483647?-1:o.setTimeout(m,T||0)}function Ku(m){m.g=Q_(()=>{m.g=null,m.i&&(m.i=!1,Ku(m))},m.l);const T=m.h;m.h=null,m.m.apply(null,T)}class J_ extends j{constructor(T,A){super(),this.m=T,this.l=A,this.h=null,this.i=!1,this.g=null}j(T){this.h=arguments,this.g?this.i=!0:Ku(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ba(m){j.call(this),this.h=m,this.g={}}g(ba,j);var Ks=[];function Un(m){oe(m.g,function(T,A){this.g.hasOwnProperty(A)&&Gn(T)},m),m.g={}}ba.prototype.N=function(){ba.Z.N.call(this),Un(this)},ba.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Cr=o.JSON.stringify,Zn=o.JSON.parse,ey=class{stringify(m){return o.JSON.stringify(m,void 0)}parse(m){return o.JSON.parse(m,void 0)}};function kd(){}function Nd(){}var yi={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Gs(){W.call(this,"d")}g(Gs,W);function Kr(){W.call(this,"c")}g(Kr,W);var Ir={},Zs=null;function Ul(){return Zs=Zs||new an}Ir.Ia="serverreachability";function Gu(m){W.call(this,Ir.Ia,m)}g(Gu,W);function Qs(m){const T=Ul();_n(T,new Gu(T))}Ir.STAT_EVENT="statevent";function Fl(m,T){W.call(this,Ir.STAT_EVENT,m),this.stat=T}g(Fl,W);function Wt(m){const T=Ul();_n(T,new Fl(T,m))}Ir.Ja="timingevent";function Dd(m,T){W.call(this,Ir.Ja,m),this.size=T}g(Dd,W);function Js(m,T){if(typeof m!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){m()},T)}function eo(){this.g=!0}eo.prototype.ua=function(){this.g=!1};function Zu(m,T,A,F,ce,pe){m.info(function(){if(m.g)if(pe){var Ae="",We=pe.split("&");for(let mt=0;mt<We.length;mt++){var Mt=We[mt].split("=");if(Mt.length>1){const Yt=Mt[0];Mt=Mt[1];const dr=Yt.split("_");Ae=dr.length>=2&&dr[1]=="type"?Ae+(Yt+"="+Mt+"&"):Ae+(Yt+"=redacted&")}}}else Ae=null;else Ae=pe;return"XMLHTTP REQ ("+F+") [attempt "+ce+"]: "+T+`
`+A+`
`+Ae})}function Qu(m,T,A,F,ce,pe,Ae){m.info(function(){return"XMLHTTP RESP ("+F+") [ attempt "+ce+"]: "+T+`
`+A+`
`+pe+" "+Ae})}function rs(m,T,A,F){m.info(function(){return"XMLHTTP TEXT ("+T+"): "+vi(m,A)+(F?" "+F:"")})}function ty(m,T){m.info(function(){return"TIMEOUT: "+T})}eo.prototype.info=function(){};function vi(m,T){if(!m.g)return T;if(!T)return null;try{const pe=JSON.parse(T);if(pe){for(m=0;m<pe.length;m++)if(Array.isArray(pe[m])){var A=pe[m];if(!(A.length<2)){var F=A[1];if(Array.isArray(F)&&!(F.length<1)){var ce=F[0];if(ce!="noop"&&ce!="stop"&&ce!="close")for(let Ae=1;Ae<F.length;Ae++)F[Ae]=""}}}}return Cr(pe)}catch{return T}}var qt={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Sn={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},is;function Ta(){}g(Ta,kd),Ta.prototype.g=function(){return new XMLHttpRequest},is=new Ta;function wa(m){return encodeURIComponent(String(m))}function ny(m){var T=1;m=m.split(":");const A=[];for(;T>0&&m.length;)A.push(m.shift()),T--;return m.length&&A.push(m.join(":")),A}function Gr(m,T,A,F){this.j=m,this.i=T,this.l=A,this.S=F||1,this.V=new ba(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new to}function to(){this.i=null,this.g="",this.h=!1}var Bl={},bi={};function Ti(m,T,A){m.M=1,m.A=os(Dt(T)),m.u=A,m.R=!0,no(m,null)}function no(m,T){m.F=Date.now(),Ea(m),m.B=Dt(m.A);var A=m.B,F=m.S;Array.isArray(F)||(F=[String(F)]),Bd(A.i,"t",F),m.C=0,A=m.j.L,m.h=new to,m.g=Kl(m.j,A?T:null,!m.u),m.P>0&&(m.O=new J_(h(m.Y,m,m.g),m.P)),T=m.V,A=m.g,F=m.ba;var ce="readystatechange";Array.isArray(ce)||(ce&&(Ks[0]=ce.toString()),ce=Ks);for(let pe=0;pe<ce.length;pe++){const Ae=at(A,ce[pe],F||T.handleEvent,!1,T.h||T);if(!Ae)break;T.g[Ae.key]=Ae}T=m.J?Z(m.J):{},m.u?(m.v||(m.v="POST"),T["Content-Type"]="application/x-www-form-urlencoded",m.g.ea(m.B,m.v,m.u,T)):(m.v="GET",m.g.ea(m.B,m.v,null,T)),Qs(),Zu(m.i,m.v,m.B,m.l,m.S,m.u)}Gr.prototype.ba=function(m){m=m.target;const T=this.O;T&&Fn(m)==3?T.j():this.Y(m)},Gr.prototype.Y=function(m){try{if(m==this.g)e:{const We=Fn(this.g),Mt=this.g.ya(),mt=this.g.ca();if(!(We<3)&&(We!=3||this.g&&(this.h.h||this.g.la()||Na(this.g)))){this.K||We!=4||Mt==7||(Mt==8||mt<=0?Qs(3):Qs(2)),Ei(this);var T=this.g.ca();this.X=T;var A=ro(this);if(this.o=T==200,Qu(this.i,this.v,this.B,this.l,this.S,We,T),this.o){if(this.U&&!this.L){t:{if(this.g){var F,ce=this.g;if((F=ce.g?ce.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!z(F)){var pe=F;break t}}pe=null}if(m=pe)rs(this.i,this.l,m,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Vl(this,m);else{this.o=!1,this.m=3,Wt(12),xi(this),xa(this);break e}}if(this.R){m=!0;let Yt;for(;!this.K&&this.C<A.length;)if(Yt=Ld(this,A),Yt==bi){We==4&&(this.m=4,Wt(14),m=!1),rs(this.i,this.l,null,"[Incomplete Response]");break}else if(Yt==Bl){this.m=4,Wt(15),rs(this.i,this.l,A,"[Invalid Chunk]"),m=!1;break}else rs(this.i,this.l,Yt,null),Vl(this,Yt);if(Xt(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),We!=4||A.length!=0||this.h.h||(this.m=1,Wt(16),m=!1),this.o=this.o&&m,!m)rs(this.i,this.l,A,"[Invalid Chunked Response]"),xi(this),xa(this);else if(A.length>0&&!this.W){this.W=!0;var Ae=this.j;Ae.g==this&&Ae.aa&&!Ae.P&&(Ae.j.info("Great, no buffering proxy detected. Bytes received: "+A.length),lh(Ae),Ae.P=!0,Wt(11))}}else rs(this.i,this.l,A,null),Vl(this,A);We==4&&xi(this),this.o&&!this.K&&(We==4?ch(this.j,this):(this.o=!1,Ea(this)))}else Da(this.g),T==400&&A.indexOf("Unknown SID")>0?(this.m=3,Wt(12)):(this.m=0,Wt(13)),xi(this),xa(this)}}}catch{}finally{}};function ro(m){if(!Xt(m))return m.g.la();const T=Na(m.g);if(T==="")return"";let A="";const F=T.length,ce=Fn(m.g)==4;if(!m.h.i){if(typeof TextDecoder>"u")return xi(m),xa(m),"";m.h.i=new o.TextDecoder}for(let pe=0;pe<F;pe++)m.h.h=!0,A+=m.h.i.decode(T[pe],{stream:!(ce&&pe==F-1)});return T.length=0,m.h.g+=A,m.C=0,m.h.g}function Xt(m){return m.g?m.v=="GET"&&m.M!=2&&m.j.Aa:!1}function Ld(m,T){var A=m.C,F=T.indexOf(`
`,A);return F==-1?bi:(A=Number(T.substring(A,F)),isNaN(A)?Bl:(F+=1,F+A>T.length?bi:(T=T.slice(F,F+A),m.C=F+A,T)))}Gr.prototype.cancel=function(){this.K=!0,xi(this)};function Ea(m){m.T=Date.now()+m.H,wi(m,m.H)}function wi(m,T){if(m.D!=null)throw Error("WatchDog timer not null");m.D=Js(h(m.aa,m),T)}function Ei(m){m.D&&(o.clearTimeout(m.D),m.D=null)}Gr.prototype.aa=function(){this.D=null;const m=Date.now();m-this.T>=0?(ty(this.i,this.B),this.M!=2&&(Qs(),Wt(17)),xi(this),this.m=2,xa(this)):wi(this,this.T-m)};function xa(m){m.j.I==0||m.K||ch(m.j,m)}function xi(m){Ei(m);var T=m.O;T&&typeof T.dispose=="function"&&T.dispose(),m.O=null,Un(m.V),m.g&&(T=m.g,m.g=null,T.abort(),T.dispose())}function Vl(m,T){try{var A=m.j;if(A.I!=0&&(A.g==m||Ra(A.h,m))){if(!m.L&&Ra(A.h,m)&&A.I==3){try{var F=A.Ba.g.parse(T)}catch{F=null}if(Array.isArray(F)&&F.length==3){var ce=F;if(ce[0]==0){e:if(!A.v){if(A.g)if(A.g.F+3e3<m.F)Yl(A),Ai(A);else break e;ah(A),Wt(18)}}else A.xa=ce[1],0<A.xa-A.K&&ce[2]<37500&&A.F&&A.A==0&&!A.C&&(A.C=Js(h(A.Va,A),6e3));Pr(A.h)<=1&&A.ta&&(A.ta=void 0)}else cs(A,11)}else if((m.L||A.g==m)&&Yl(A),!z(T))for(ce=A.Ba.g.parse(T),T=0;T<ce.length;T++){let mt=ce[T];const Yt=mt[0];if(!(Yt<=A.K))if(A.K=Yt,mt=mt[1],A.I==2)if(mt[0]=="c"){A.M=mt[1],A.ba=mt[2];const dr=mt[3];dr!=null&&(A.ka=dr,A.j.info("VER="+A.ka));const Si=mt[4];Si!=null&&(A.za=Si,A.j.info("SVER="+A.za));const Jr=mt[5];Jr!=null&&typeof Jr=="number"&&Jr>0&&(F=1.5*Jr,A.O=F,A.j.info("backChannelRequestTimeoutMs_="+F)),F=A;const ei=m.g;if(ei){const ti=ei.g?ei.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ti){var pe=F.h;pe.g||ti.indexOf("spdy")==-1&&ti.indexOf("quic")==-1&&ti.indexOf("h2")==-1||(pe.j=pe.l,pe.g=new Set,pe.h&&(zl(pe,pe.h),pe.h=null))}if(F.G){const hh=ei.g?ei.g.getResponseHeader("X-HTTP-Session-Id"):null;hh&&(F.wa=hh,bt(F.J,F.G,hh))}}A.I=3,A.l&&A.l.ra(),A.aa&&(A.T=Date.now()-m.F,A.j.info("Handshake RTT: "+A.T+"ms")),F=A;var Ae=m;if(F.na=Yd(F,F.L?F.ba:null,F.W),Ae.L){ss(F.h,Ae);var We=Ae,Mt=F.O;Mt&&(We.H=Mt),We.D&&(Ei(We),Ea(We)),F.g=Ae}else $d(F);A.i.length>0&&Ba(A)}else mt[0]!="stop"&&mt[0]!="close"||cs(A,7);else A.I==3&&(mt[0]=="stop"||mt[0]=="close"?mt[0]=="stop"?cs(A,7):Ua(A):mt[0]!="noop"&&A.l&&A.l.qa(mt),A.A=0)}}Qs(4)}catch{}}var ry=class{constructor(m,T){this.g=m,this.map=T}};function Aa(m){this.l=m||10,o.PerformanceNavigationTiming?(m=o.performance.getEntriesByType("navigation"),m=m.length>0&&(m[0].nextHopProtocol=="hq"||m[0].nextHopProtocol=="h2")):m=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=m?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Sa(m){return m.h?!0:m.g?m.g.size>=m.j:!1}function Pr(m){return m.h?1:m.g?m.g.size:0}function Ra(m,T){return m.h?m.h==T:m.g?m.g.has(T):!1}function zl(m,T){m.g?m.g.add(T):m.h=T}function ss(m,T){m.h&&m.h==T?m.h=null:m.g&&m.g.has(T)&&m.g.delete(T)}Aa.prototype.cancel=function(){if(this.i=jl(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const m of this.g.values())m.cancel();this.g.clear()}};function jl(m){if(m.h!=null)return m.i.concat(m.h.G);if(m.g!=null&&m.g.size!==0){let T=m.i;for(const A of m.g.values())T=T.concat(A.G);return T}return b(m.i)}var Hl=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function iy(m,T){if(m){m=m.split("&");for(let A=0;A<m.length;A++){const F=m[A].indexOf("=");let ce,pe=null;F>=0?(ce=m[A].substring(0,F),pe=m[A].substring(F+1)):ce=m[A],T(ce,pe?decodeURIComponent(pe.replace(/\+/g," ")):"")}}}function Zr(m){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let T;m instanceof Zr?(this.l=m.l,io(this,m.j),this.o=m.o,this.g=m.g,Ca(this,m.u),this.h=m.h,so(this,Vd(m.i)),this.m=m.m):m&&(T=String(m).match(Hl))?(this.l=!1,io(this,T[1]||"",!0),this.o=Ia(T[2]||""),this.g=Ia(T[3]||"",!0),Ca(this,T[4]),this.h=Ia(T[5]||"",!0),so(this,T[6]||"",!0),this.m=Ia(T[7]||"")):(this.l=!1,this.i=new Mr(null,this.l))}Zr.prototype.toString=function(){const m=[];var T=this.j;T&&m.push(yn(T,eh,!0),":");var A=this.g;return(A||T=="file")&&(m.push("//"),(T=this.o)&&m.push(yn(T,eh,!0),"@"),m.push(wa(A).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),A=this.u,A!=null&&m.push(":",String(A))),(A=this.h)&&(this.g&&A.charAt(0)!="/"&&m.push("/"),m.push(yn(A,A.charAt(0)=="/"?oo:th,!0))),(A=this.i.toString())&&m.push("?",A),(A=this.m)&&m.push("#",yn(A,Fd)),m.join("")},Zr.prototype.resolve=function(m){const T=Dt(this);let A=!!m.j;A?io(T,m.j):A=!!m.o,A?T.o=m.o:A=!!m.g,A?T.g=m.g:A=m.u!=null;var F=m.h;if(A)Ca(T,m.u);else if(A=!!m.h){if(F.charAt(0)!="/")if(this.g&&!this.h)F="/"+F;else{var ce=T.h.lastIndexOf("/");ce!=-1&&(F=T.h.slice(0,ce+1)+F)}if(ce=F,ce==".."||ce==".")F="";else if(ce.indexOf("./")!=-1||ce.indexOf("/.")!=-1){F=ce.lastIndexOf("/",0)==0,ce=ce.split("/");const pe=[];for(let Ae=0;Ae<ce.length;){const We=ce[Ae++];We=="."?F&&Ae==ce.length&&pe.push(""):We==".."?((pe.length>1||pe.length==1&&pe[0]!="")&&pe.pop(),F&&Ae==ce.length&&pe.push("")):(pe.push(We),F=!0)}F=pe.join("/")}else F=ce}return A?T.h=F:A=m.i.toString()!=="",A?so(T,Vd(m.i)):A=!!m.m,A&&(T.m=m.m),T};function Dt(m){return new Zr(m)}function io(m,T,A){m.j=A?Ia(T,!0):T,m.j&&(m.j=m.j.replace(/:$/,""))}function Ca(m,T){if(T){if(T=Number(T),isNaN(T)||T<0)throw Error("Bad port number "+T);m.u=T}else m.u=null}function so(m,T,A){T instanceof Mr?(m.i=T,ih(m.i,m.l)):(A||(T=yn(T,Ud)),m.i=new Mr(T,m.l))}function bt(m,T,A){m.i.set(T,A)}function os(m){return bt(m,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),m}function Ia(m,T){return m?T?decodeURI(m.replace(/%25/g,"%2525")):decodeURIComponent(m):""}function yn(m,T,A){return typeof m=="string"?(m=encodeURI(m).replace(T,Ju),A&&(m=m.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),m):null}function Ju(m){return m=m.charCodeAt(0),"%"+(m>>4&15).toString(16)+(m&15).toString(16)}var eh=/[#\/\?@]/g,th=/[#\?:]/g,oo=/[#\?]/g,Ud=/[#\?@]/g,Fd=/#/g;function Mr(m,T){this.h=this.g=null,this.i=m||null,this.j=!!T}function as(m){m.g||(m.g=new Map,m.h=0,m.i&&iy(m.i,function(T,A){m.add(decodeURIComponent(T.replace(/\+/g," ")),A)}))}n=Mr.prototype,n.add=function(m,T){as(this),this.i=null,m=Qr(this,m);let A=this.g.get(m);return A||this.g.set(m,A=[]),A.push(T),this.h+=1,this};function nh(m,T){as(m),T=Qr(m,T),m.g.has(T)&&(m.i=null,m.h-=m.g.get(T).length,m.g.delete(T))}function rh(m,T){return as(m),T=Qr(m,T),m.g.has(T)}n.forEach=function(m,T){as(this),this.g.forEach(function(A,F){A.forEach(function(ce){m.call(T,ce,F,this)},this)},this)};function $l(m,T){as(m);let A=[];if(typeof T=="string")rh(m,T)&&(A=A.concat(m.g.get(Qr(m,T))));else for(m=Array.from(m.g.values()),T=0;T<m.length;T++)A=A.concat(m[T]);return A}n.set=function(m,T){return as(this),this.i=null,m=Qr(this,m),rh(this,m)&&(this.h-=this.g.get(m).length),this.g.set(m,[T]),this.h+=1,this},n.get=function(m,T){return m?(m=$l(this,m),m.length>0?String(m[0]):T):T};function Bd(m,T,A){nh(m,T),A.length>0&&(m.i=null,m.g.set(Qr(m,T),b(A)),m.h+=A.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const m=[],T=Array.from(this.g.keys());for(let F=0;F<T.length;F++){var A=T[F];const ce=wa(A);A=$l(this,A);for(let pe=0;pe<A.length;pe++){let Ae=ce;A[pe]!==""&&(Ae+="="+wa(A[pe])),m.push(Ae)}}return this.i=m.join("&")};function Vd(m){const T=new Mr;return T.i=m.i,m.g&&(T.g=new Map(m.g),T.h=m.h),T}function Qr(m,T){return T=String(T),m.j&&(T=T.toLowerCase()),T}function ih(m,T){T&&!m.j&&(as(m),m.i=null,m.g.forEach(function(A,F){const ce=F.toLowerCase();F!=ce&&(nh(this,F),Bd(this,ce,A))},m)),m.j=T}function sh(m,T){const A=new eo;if(o.Image){const F=new Image;F.onload=d(Qn,A,"TestLoadImage: loaded",!0,T,F),F.onerror=d(Qn,A,"TestLoadImage: error",!1,T,F),F.onabort=d(Qn,A,"TestLoadImage: abort",!1,T,F),F.ontimeout=d(Qn,A,"TestLoadImage: timeout",!1,T,F),o.setTimeout(function(){F.ontimeout&&F.ontimeout()},1e4),F.src=m}else T(!1)}function ao(m,T){const A=new eo,F=new AbortController,ce=setTimeout(()=>{F.abort(),Qn(A,"TestPingServer: timeout",!1,T)},1e4);fetch(m,{signal:F.signal}).then(pe=>{clearTimeout(ce),pe.ok?Qn(A,"TestPingServer: ok",!0,T):Qn(A,"TestPingServer: server error",!1,T)}).catch(()=>{clearTimeout(ce),Qn(A,"TestPingServer: error",!1,T)})}function Qn(m,T,A,F,ce){try{ce&&(ce.onload=null,ce.onerror=null,ce.onabort=null,ce.ontimeout=null),F(A)}catch{}}function zd(){this.g=new ey}function Pa(m){this.i=m.Sb||null,this.h=m.ab||!1}g(Pa,kd),Pa.prototype.g=function(){return new Ma(this.i,this.h)};function Ma(m,T){an.call(this),this.H=m,this.o=T,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}g(Ma,an),n=Ma.prototype,n.open=function(m,T){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=m,this.D=T,this.readyState=1,ls(this)},n.send=function(m){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const T={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};m&&(T.body=m),(this.H||o).fetch(new Request(this.D,T)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Jn(this)),this.readyState=0},n.Pa=function(m){if(this.g&&(this.l=m,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=m.headers,this.readyState=2,ls(this)),this.g&&(this.readyState=3,ls(this),this.g)))if(this.responseType==="arraybuffer")m.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in m){if(this.j=m.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;lo(this)}else m.text().then(this.Oa.bind(this),this.ga.bind(this))};function lo(m){m.j.read().then(m.Ma.bind(m)).catch(m.ga.bind(m))}n.Ma=function(m){if(this.g){if(this.o&&m.value)this.response.push(m.value);else if(!this.o){var T=m.value?m.value:new Uint8Array(0);(T=this.B.decode(T,{stream:!m.done}))&&(this.response=this.responseText+=T)}m.done?Jn(this):ls(this),this.readyState==3&&lo(this)}},n.Oa=function(m){this.g&&(this.response=this.responseText=m,Jn(this))},n.Na=function(m){this.g&&(this.response=m,Jn(this))},n.ga=function(){this.g&&Jn(this)};function Jn(m){m.readyState=4,m.l=null,m.j=null,m.B=null,ls(m)}n.setRequestHeader=function(m,T){this.A.append(m,T)},n.getResponseHeader=function(m){return this.h&&this.h.get(m.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const m=[],T=this.h.entries();for(var A=T.next();!A.done;)A=A.value,m.push(A[0]+": "+A[1]),A=T.next();return m.join(`\r
`)};function ls(m){m.onreadystatechange&&m.onreadystatechange.call(m)}Object.defineProperty(Ma.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(m){this.m=m?"include":"same-origin"}});function co(m){let T="";return oe(m,function(A,F){T+=F,T+=":",T+=A,T+=`\r
`}),T}function Or(m,T,A){e:{for(F in A){var F=!1;break e}F=!0}F||(A=co(A),typeof m=="string"?A!=null&&wa(A):bt(m,T,A))}function It(m){an.call(this),this.headers=new Map,this.L=m||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}g(It,an);var Wl=/^https?$/i,jd=["POST","PUT"];n=It.prototype,n.Fa=function(m){this.H=m},n.ea=function(m,T,A,F){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+m);T=T?T.toUpperCase():"GET",this.D=m,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():is.g(),this.g.onreadystatechange=y(h(this.Ca,this));try{this.B=!0,this.g.open(T,String(m),!0),this.B=!1}catch(pe){Oa(this,pe);return}if(m=A||"",A=new Map(this.headers),F)if(Object.getPrototypeOf(F)===Object.prototype)for(var ce in F)A.set(ce,F[ce]);else if(typeof F.keys=="function"&&typeof F.get=="function")for(const pe of F.keys())A.set(pe,F.get(pe));else throw Error("Unknown input type for opt_headers: "+String(F));F=Array.from(A.keys()).find(pe=>pe.toLowerCase()=="content-type"),ce=o.FormData&&m instanceof o.FormData,!(Array.prototype.indexOf.call(jd,T,void 0)>=0)||F||ce||A.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[pe,Ae]of A)this.g.setRequestHeader(pe,Ae);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(m),this.v=!1}catch(pe){Oa(this,pe)}};function Oa(m,T){m.h=!1,m.g&&(m.j=!0,m.g.abort(),m.j=!1),m.l=T,m.o=5,ka(m),ln(m)}function ka(m){m.A||(m.A=!0,_n(m,"complete"),_n(m,"error"))}n.abort=function(m){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=m||7,_n(this,"complete"),_n(this,"abort"),ln(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ln(this,!0)),It.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?oh(this):this.Xa())},n.Xa=function(){oh(this)};function oh(m){if(m.h&&typeof s<"u"){if(m.v&&Fn(m)==4)setTimeout(m.Ca.bind(m),0);else if(_n(m,"readystatechange"),Fn(m)==4){m.h=!1;try{const pe=m.ca();e:switch(pe){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var T=!0;break e;default:T=!1}var A;if(!(A=T)){var F;if(F=pe===0){let Ae=String(m.D).match(Hl)[1]||null;!Ae&&o.self&&o.self.location&&(Ae=o.self.location.protocol.slice(0,-1)),F=!Wl.test(Ae?Ae.toLowerCase():"")}A=F}if(A)_n(m,"complete"),_n(m,"success");else{m.o=6;try{var ce=Fn(m)>2?m.g.statusText:""}catch{ce=""}m.l=ce+" ["+m.ca()+"]",ka(m)}}finally{ln(m)}}}}function ln(m,T){if(m.g){m.m&&(clearTimeout(m.m),m.m=null);const A=m.g;m.g=null,T||_n(m,"ready");try{A.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function Fn(m){return m.g?m.g.readyState:0}n.ca=function(){try{return Fn(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(m){if(this.g){var T=this.g.responseText;return m&&T.indexOf(m)==0&&(T=T.substring(m.length)),Zn(T)}};function Na(m){try{if(!m.g)return null;if("response"in m.g)return m.g.response;switch(m.F){case"":case"text":return m.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in m.g)return m.g.mozResponseArrayBuffer}return null}catch{return null}}function Da(m){const T={};m=(m.g&&Fn(m)>=2&&m.g.getAllResponseHeaders()||"").split(`\r
`);for(let F=0;F<m.length;F++){if(z(m[F]))continue;var A=ny(m[F]);const ce=A[0];if(A=A[1],typeof A!="string")continue;A=A.trim();const pe=T[ce]||[];T[ce]=pe,pe.push(A)}L(T,function(F){return F.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function La(m,T,A){return A&&A.internalChannelParams&&A.internalChannelParams[m]||T}function ql(m){this.za=0,this.i=[],this.j=new eo,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=La("failFast",!1,m),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=La("baseRetryDelayMs",5e3,m),this.Za=La("retryDelaySeedMs",1e4,m),this.Ta=La("forwardChannelMaxRetries",2,m),this.va=La("forwardChannelRequestTimeoutMs",2e4,m),this.ma=m&&m.xmlHttpFactory||void 0,this.Ua=m&&m.Rb||void 0,this.Aa=m&&m.useFetchStreams||!1,this.O=void 0,this.L=m&&m.supportsCrossDomainXhr||!1,this.M="",this.h=new Aa(m&&m.concurrentRequestLimit),this.Ba=new zd,this.S=m&&m.fastHandshake||!1,this.R=m&&m.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=m&&m.Pb||!1,m&&m.ua&&this.j.ua(),m&&m.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&m&&m.detectBufferingProxy||!1,this.ia=void 0,m&&m.longPollingTimeout&&m.longPollingTimeout>0&&(this.ia=m.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=ql.prototype,n.ka=8,n.I=1,n.connect=function(m,T,A,F){Wt(0),this.W=m,this.H=T||{},A&&F!==void 0&&(this.H.OSID=A,this.H.OAID=F),this.F=this.X,this.J=Yd(this,null,this.W),Ba(this)};function Ua(m){if(Fa(m),m.I==3){var T=m.V++,A=Dt(m.J);if(bt(A,"SID",m.M),bt(A,"RID",T),bt(A,"TYPE","terminate"),Va(m,A),T=new Gr(m,m.j,T),T.M=2,T.A=os(Dt(A)),A=!1,o.navigator&&o.navigator.sendBeacon)try{A=o.navigator.sendBeacon(T.A.toString(),"")}catch{}!A&&o.Image&&(new Image().src=T.A,A=!0),A||(T.g=Kl(T.j,null),T.g.ea(T.A)),T.F=Date.now(),Ea(T)}Xd(m)}function Ai(m){m.g&&(lh(m),m.g.cancel(),m.g=null)}function Fa(m){Ai(m),m.v&&(o.clearTimeout(m.v),m.v=null),Yl(m),m.h.cancel(),m.m&&(typeof m.m=="number"&&o.clearTimeout(m.m),m.m=null)}function Ba(m){if(!Sa(m.h)&&!m.m){m.m=!0;var T=m.Ea;H||I(),G||(H(),G=!0),D.add(T,m),m.D=0}}function sy(m,T){return Pr(m.h)>=m.h.j-(m.m?1:0)?!1:m.m?(m.i=T.G.concat(m.i),!0):m.I==1||m.I==2||m.D>=(m.Sa?0:m.Ta)?!1:(m.m=Js(h(m.Ea,m,T),qd(m,m.D)),m.D++,!0)}n.Ea=function(m){if(this.m)if(this.m=null,this.I==1){if(!m){this.V=Math.floor(Math.random()*1e5),m=this.V++;const ce=new Gr(this,this.j,m);let pe=this.o;if(this.U&&(pe?(pe=Z(pe),ae(pe,this.U)):pe=this.U),this.u!==null||this.R||(ce.J=pe,pe=null),this.S)e:{for(var T=0,A=0;A<this.i.length;A++){t:{var F=this.i[A];if("__data__"in F.map&&(F=F.map.__data__,typeof F=="string")){F=F.length;break t}F=void 0}if(F===void 0)break;if(T+=F,T>4096){T=A;break e}if(T===4096||A===this.i.length-1){T=A+1;break e}}T=1e3}else T=1e3;T=Xl(this,ce,T),A=Dt(this.J),bt(A,"RID",m),bt(A,"CVER",22),this.G&&bt(A,"X-HTTP-Session-Id",this.G),Va(this,A),pe&&(this.R?T="headers="+wa(co(pe))+"&"+T:this.u&&Or(A,this.u,pe)),zl(this.h,ce),this.Ra&&bt(A,"TYPE","init"),this.S?(bt(A,"$req",T),bt(A,"SID","null"),ce.U=!0,Ti(ce,A,null)):Ti(ce,A,T),this.I=2}}else this.I==3&&(m?Hd(this,m):this.i.length==0||Sa(this.h)||Hd(this))};function Hd(m,T){var A;T?A=T.l:A=m.V++;const F=Dt(m.J);bt(F,"SID",m.M),bt(F,"RID",A),bt(F,"AID",m.K),Va(m,F),m.u&&m.o&&Or(F,m.u,m.o),A=new Gr(m,m.j,A,m.D+1),m.u===null&&(A.J=m.o),T&&(m.i=T.G.concat(m.i)),T=Xl(m,A,1e3),A.H=Math.round(m.va*.5)+Math.round(m.va*.5*Math.random()),zl(m.h,A),Ti(A,F,T)}function Va(m,T){m.H&&oe(m.H,function(A,F){bt(T,F,A)}),m.l&&oe({},function(A,F){bt(T,F,A)})}function Xl(m,T,A){A=Math.min(m.i.length,A);const F=m.l?h(m.l.Ka,m.l,m):null;e:{var ce=m.i;let We=-1;for(;;){const Mt=["count="+A];We==-1?A>0?(We=ce[0].g,Mt.push("ofs="+We)):We=0:Mt.push("ofs="+We);let mt=!0;for(let Yt=0;Yt<A;Yt++){var pe=ce[Yt].g;const dr=ce[Yt].map;if(pe-=We,pe<0)We=Math.max(0,ce[Yt].g-100),mt=!1;else try{pe="req"+pe+"_"||"";try{var Ae=dr instanceof Map?dr:Object.entries(dr);for(const[Si,Jr]of Ae){let ei=Jr;l(Jr)&&(ei=Cr(Jr)),Mt.push(pe+Si+"="+encodeURIComponent(ei))}}catch(Si){throw Mt.push(pe+"type="+encodeURIComponent("_badmap")),Si}}catch{F&&F(dr)}}if(mt){Ae=Mt.join("&");break e}}Ae=void 0}return m=m.i.splice(0,A),T.G=m,Ae}function $d(m){if(!m.g&&!m.v){m.Y=1;var T=m.Da;H||I(),G||(H(),G=!0),D.add(T,m),m.A=0}}function ah(m){return m.g||m.v||m.A>=3?!1:(m.Y++,m.v=Js(h(m.Da,m),qd(m,m.A)),m.A++,!0)}n.Da=function(){if(this.v=null,Wd(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var m=4*this.T;this.j.info("BP detection timer enabled: "+m),this.B=Js(h(this.Wa,this),m)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Wt(10),Ai(this),Wd(this))};function lh(m){m.B!=null&&(o.clearTimeout(m.B),m.B=null)}function Wd(m){m.g=new Gr(m,m.j,"rpc",m.Y),m.u===null&&(m.g.J=m.o),m.g.P=0;var T=Dt(m.na);bt(T,"RID","rpc"),bt(T,"SID",m.M),bt(T,"AID",m.K),bt(T,"CI",m.F?"0":"1"),!m.F&&m.ia&&bt(T,"TO",m.ia),bt(T,"TYPE","xmlhttp"),Va(m,T),m.u&&m.o&&Or(T,m.u,m.o),m.O&&(m.g.H=m.O);var A=m.g;m=m.ba,A.M=1,A.A=os(Dt(T)),A.u=null,A.R=!0,no(A,m)}n.Va=function(){this.C!=null&&(this.C=null,Ai(this),ah(this),Wt(19))};function Yl(m){m.C!=null&&(o.clearTimeout(m.C),m.C=null)}function ch(m,T){var A=null;if(m.g==T){Yl(m),lh(m),m.g=null;var F=2}else if(Ra(m.h,T))A=T.G,ss(m.h,T),F=1;else return;if(m.I!=0){if(T.o)if(F==1){A=T.u?T.u.length:0,T=Date.now()-T.F;var ce=m.D;F=Ul(),_n(F,new Dd(F,A)),Ba(m)}else $d(m);else if(ce=T.m,ce==3||ce==0&&T.X>0||!(F==1&&sy(m,T)||F==2&&ah(m)))switch(A&&A.length>0&&(T=m.h,T.i=T.i.concat(A)),ce){case 1:cs(m,5);break;case 4:cs(m,10);break;case 3:cs(m,6);break;default:cs(m,2)}}}function qd(m,T){let A=m.Qa+Math.floor(Math.random()*m.Za);return m.isActive()||(A*=2),A*T}function cs(m,T){if(m.j.info("Error code "+T),T==2){var A=h(m.bb,m),F=m.Ua;const ce=!F;F=new Zr(F||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||io(F,"https"),os(F),ce?sh(F.toString(),A):ao(F.toString(),A)}else Wt(2);m.I=0,m.l&&m.l.pa(T),Xd(m),Fa(m)}n.bb=function(m){m?(this.j.info("Successfully pinged google.com"),Wt(2)):(this.j.info("Failed to ping google.com"),Wt(1))};function Xd(m){if(m.I=0,m.ja=[],m.l){const T=jl(m.h);(T.length!=0||m.i.length!=0)&&(w(m.ja,T),w(m.ja,m.i),m.h.i.length=0,b(m.i),m.i.length=0),m.l.oa()}}function Yd(m,T,A){var F=A instanceof Zr?Dt(A):new Zr(A);if(F.g!="")T&&(F.g=T+"."+F.g),Ca(F,F.u);else{var ce=o.location;F=ce.protocol,T=T?T+"."+ce.hostname:ce.hostname,ce=+ce.port;const pe=new Zr(null);F&&io(pe,F),T&&(pe.g=T),ce&&Ca(pe,ce),A&&(pe.h=A),F=pe}return A=m.G,T=m.wa,A&&T&&bt(F,A,T),bt(F,"VER",m.ka),Va(m,F),F}function Kl(m,T,A){if(T&&!m.L)throw Error("Can't create secondary domain capable XhrIo object.");return T=m.Aa&&!m.ma?new It(new Pa({ab:A})):new It(m.ma),T.Fa(m.L),T}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Kd(){}n=Kd.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function Gl(){}Gl.prototype.g=function(m,T){return new er(m,T)};function er(m,T){an.call(this),this.g=new ql(T),this.l=m,this.h=T&&T.messageUrlParams||null,m=T&&T.messageHeaders||null,T&&T.clientProtocolHeaderRequired&&(m?m["X-Client-Protocol"]="webchannel":m={"X-Client-Protocol":"webchannel"}),this.g.o=m,m=T&&T.initMessageHeaders||null,T&&T.messageContentType&&(m?m["X-WebChannel-Content-Type"]=T.messageContentType:m={"X-WebChannel-Content-Type":T.messageContentType}),T&&T.sa&&(m?m["X-WebChannel-Client-Profile"]=T.sa:m={"X-WebChannel-Client-Profile":T.sa}),this.g.U=m,(m=T&&T.Qb)&&!z(m)&&(this.g.u=m),this.A=T&&T.supportsCrossDomainXhr||!1,this.v=T&&T.sendRawJson||!1,(T=T&&T.httpSessionIdParam)&&!z(T)&&(this.g.G=T,m=this.h,m!==null&&T in m&&(m=this.h,T in m&&delete m[T])),this.j=new uo(this)}g(er,an),er.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},er.prototype.close=function(){Ua(this.g)},er.prototype.o=function(m){var T=this.g;if(typeof m=="string"){var A={};A.__data__=m,m=A}else this.v&&(A={},A.__data__=Cr(m),m=A);T.i.push(new ry(T.Ya++,m)),T.I==3&&Ba(T)},er.prototype.N=function(){this.g.l=null,delete this.j,Ua(this.g),delete this.g,er.Z.N.call(this)};function uh(m){Gs.call(this),m.__headers__&&(this.headers=m.__headers__,this.statusCode=m.__status__,delete m.__headers__,delete m.__status__);var T=m.__sm__;if(T){e:{for(const A in T){m=A;break e}m=void 0}(this.i=m)&&(m=this.i,T=T!==null&&m in T?T[m]:void 0),this.data=T}else this.data=m}g(uh,Gs);function Gd(){Kr.call(this),this.status=1}g(Gd,Kr);function uo(m){this.g=m}g(uo,Kd),uo.prototype.ra=function(){_n(this.g,"a")},uo.prototype.qa=function(m){_n(this.g,new uh(m))},uo.prototype.pa=function(m){_n(this.g,new Gd)},uo.prototype.oa=function(){_n(this.g,"b")},Gl.prototype.createWebChannel=Gl.prototype.g,er.prototype.send=er.prototype.o,er.prototype.open=er.prototype.m,er.prototype.close=er.prototype.close,sM=function(){return new Gl},iM=function(){return Ul()},rM=Ir,C0={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},qt.NO_ERROR=0,qt.TIMEOUT=8,qt.HTTP_ERROR=6,$g=qt,Sn.COMPLETE="complete",nM=Sn,Nd.EventType=yi,yi.OPEN="a",yi.CLOSE="b",yi.ERROR="c",yi.MESSAGE="d",an.prototype.listen=an.prototype.J,ff=Nd,It.prototype.listenOnce=It.prototype.K,It.prototype.getLastError=It.prototype.Ha,It.prototype.getLastErrorCode=It.prototype.ya,It.prototype.getStatus=It.prototype.ca,It.prototype.getResponseJson=It.prototype.La,It.prototype.getResponseText=It.prototype.la,It.prototype.send=It.prototype.ea,It.prototype.setWithCredentials=It.prototype.Fa,tM=It}).apply(typeof Jp<"u"?Jp:typeof self<"u"?self:typeof window<"u"?window:{});const m2="@firebase/firestore",_2="4.9.2";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Wn.UNAUTHENTICATED=new Wn(null),Wn.GOOGLE_CREDENTIALS=new Wn("google-credentials-uid"),Wn.FIRST_PARTY=new Wn("first-party-uid"),Wn.MOCK_USER=new Wn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Nu="12.3.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bl=new KT("@firebase/firestore");function Lc(){return bl.logLevel}function Ie(n,...e){if(bl.logLevel<=nt.DEBUG){const t=e.map(aw);bl.debug(`Firestore (${Nu}): ${n}`,...t)}}function Fs(n,...e){if(bl.logLevel<=nt.ERROR){const t=e.map(aw);bl.error(`Firestore (${Nu}): ${n}`,...t)}}function cu(n,...e){if(bl.logLevel<=nt.WARN){const t=e.map(aw);bl.warn(`Firestore (${Nu}): ${n}`,...t)}}function aw(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return(function(t){return JSON.stringify(t)})(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function je(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,oM(n,r,t)}function oM(n,e,t){let r=`FIRESTORE (${Nu}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw Fs(r),new Error(r)}function gt(n,e,t,r){let i="Unexpected state";typeof t=="string"?i=t:r=t,n||oM(e,i,r)}function qe(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Te={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Le extends Ys{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class na{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aM{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class m8{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Wn.UNAUTHENTICATED)))}shutdown(){}}class _8{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class y8{constructor(e){this.t=e,this.currentUser=Wn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){gt(this.o===void 0,42304);let r=this.i;const i=u=>this.i!==r?(r=this.i,t(u)):Promise.resolve();let s=new na;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new na,e.enqueueRetryable((()=>i(this.currentUser)))};const o=()=>{const u=s;e.enqueueRetryable((async()=>{await u.promise,await i(this.currentUser)}))},l=u=>{Ie("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit((u=>l(u))),setTimeout((()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?l(u):(Ie("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new na)}}),0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((r=>this.i!==e?(Ie("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(gt(typeof r.accessToken=="string",31837,{l:r}),new aM(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return gt(e===null||typeof e=="string",2055,{h:e}),new Wn(e)}}class v8{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=Wn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class b8{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new v8(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(Wn.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class y2{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class T8{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Vr(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){gt(this.o===void 0,3512);const r=s=>{s.error!=null&&Ie("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const o=s.token!==this.m;return this.m=s.token,Ie("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable((()=>r(s)))};const i=s=>{Ie("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((s=>i(s))),setTimeout((()=>{if(!this.appCheck){const s=this.V.getImmediate({optional:!0});s?i(s):Ie("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new y2(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(gt(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new y2(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w8(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lw{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const i=w8(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%62))}return r}}function rt(n,e){return n<e?-1:n>e?1:0}function I0(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const i=n.charAt(r),s=e.charAt(r);if(i!==s)return hb(i)===hb(s)?rt(i,s):hb(i)?1:-1}return rt(n.length,e.length)}const E8=55296,x8=57343;function hb(n){const e=n.charCodeAt(0);return e>=E8&&e<=x8}function uu(n,e,t){return n.length===e.length&&n.every(((r,i)=>t(r,e[i])))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v2="__name__";class Di{constructor(e,t,r){t===void 0?t=0:t>e.length&&je(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&je(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Di.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Di?e.forEach((r=>{t.push(r)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const s=Di.compareSegments(e.get(i),t.get(i));if(s!==0)return s}return rt(e.length,t.length)}static compareSegments(e,t){const r=Di.isNumericId(e),i=Di.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?Di.extractNumericId(e).compare(Di.extractNumericId(t)):I0(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return ta.fromString(e.substring(4,e.length-2))}}class Ut extends Di{construct(e,t,r){return new Ut(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new Le(Te.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter((i=>i.length>0)))}return new Ut(t)}static emptyPath(){return new Ut([])}}const A8=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class kn extends Di{construct(e,t,r){return new kn(e,t,r)}static isValidIdentifier(e){return A8.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),kn.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===v2}static keyField(){return new kn([v2])}static fromServerFormat(e){const t=[];let r="",i=0;const s=()=>{if(r.length===0)throw new Le(Te.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;i<e.length;){const l=e[i];if(l==="\\"){if(i+1===e.length)throw new Le(Te.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new Le(Te.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,i+=2}else l==="`"?(o=!o,i++):l!=="."||o?(r+=l,i++):(s(),i++)}if(s(),o)throw new Le(Te.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new kn(t)}static emptyPath(){return new kn([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ue{constructor(e){this.path=e}static fromPath(e){return new Ue(Ut.fromString(e))}static fromName(e){return new Ue(Ut.fromString(e).popFirst(5))}static empty(){return new Ue(Ut.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ut.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Ut.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Ue(new Ut(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S8(n,e,t){if(!t)throw new Le(Te.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function R8(n,e,t,r){if(e===!0&&r===!0)throw new Le(Te.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function b2(n){if(!Ue.isDocumentKey(n))throw new Le(Te.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function lM(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function cw(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":je(12329,{type:typeof n})}function Hf(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new Le(Te.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=cw(n);throw new Le(Te.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sn(n,e){const t={typeString:n};return e&&(t.value=e),t}function _d(n,e){if(!lM(n))throw new Le(Te.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const i=e[r].typeString,s="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const o=n[r];if(i&&typeof o!==i){t=`JSON field '${r}' must be a ${i}.`;break}if(s!==void 0&&o!==s.value){t=`Expected '${r}' field to equal '${s.value}'`;break}}if(t)throw new Le(Te.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T2=-62135596800,w2=1e6;class Ot{static now(){return Ot.fromMillis(Date.now())}static fromDate(e){return Ot.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*w2);return new Ot(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Le(Te.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Le(Te.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<T2)throw new Le(Te.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Le(Te.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/w2}_compareTo(e){return this.seconds===e.seconds?rt(this.nanoseconds,e.nanoseconds):rt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Ot._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(_d(e,Ot._jsonSchema))return new Ot(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-T2;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Ot._jsonSchemaVersion="firestore/timestamp/1.0",Ot._jsonSchema={type:sn("string",Ot._jsonSchemaVersion),seconds:sn("number"),nanoseconds:sn("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $e{static fromTimestamp(e){return new $e(e)}static min(){return new $e(new Ot(0,0))}static max(){return new $e(new Ot(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $f=-1;function C8(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=$e.fromTimestamp(r===1e9?new Ot(t+1,0):new Ot(t,r));return new aa(i,Ue.empty(),e)}function I8(n){return new aa(n.readTime,n.key,$f)}class aa{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new aa($e.min(),Ue.empty(),$f)}static max(){return new aa($e.max(),Ue.empty(),$f)}}function P8(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=Ue.comparator(n.documentKey,e.documentKey),t!==0?t:rt(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M8="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class O8{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Du(n){if(n.code!==Te.FAILED_PRECONDITION||n.message!==M8)throw n;Ie("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class be{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&je(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new be(((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof be?t:be.resolve(t)}catch(t){return be.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):be.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):be.reject(t)}static resolve(e){return new be(((t,r)=>{t(e)}))}static reject(e){return new be(((t,r)=>{r(e)}))}static waitFor(e){return new be(((t,r)=>{let i=0,s=0,o=!1;e.forEach((l=>{++i,l.next((()=>{++s,o&&s===i&&t()}),(u=>r(u)))})),o=!0,s===i&&t()}))}static or(e){let t=be.resolve(!1);for(const r of e)t=t.next((i=>i?be.resolve(i):r()));return t}static forEach(e,t){const r=[];return e.forEach(((i,s)=>{r.push(t.call(this,i,s))})),this.waitFor(r)}static mapArray(e,t){return new be(((r,i)=>{const s=e.length,o=new Array(s);let l=0;for(let u=0;u<s;u++){const h=u;t(e[h]).next((d=>{o[h]=d,++l,l===s&&r(o)}),(d=>i(d)))}}))}static doWhile(e,t){return new be(((r,i)=>{const s=()=>{e()===!0?t().next((()=>{s()}),i):r()};s()}))}}function k8(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Lu(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m_{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}m_.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uw=-1;function __(n){return n==null}function Em(n){return n===0&&1/n==-1/0}function N8(n){return typeof n=="number"&&Number.isInteger(n)&&!Em(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cM="";function D8(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=E2(e)),e=L8(n.get(t),e);return E2(e)}function L8(n,e){let t=e;const r=n.length;for(let i=0;i<r;i++){const s=n.charAt(i);switch(s){case"\0":t+="";break;case cM:t+="";break;default:t+=s}}return t}function E2(n){return n+cM+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x2(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Il(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function uM(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vt{constructor(e,t){this.comparator=e,this.root=t||Mn.EMPTY}insert(e,t){return new Vt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Mn.BLACK,null,null))}remove(e){return new Vt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Mn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,r)=>(e(t,r),!1)))}toString(){const e=[];return this.inorderTraversal(((t,r)=>(e.push(`${t}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new eg(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new eg(this.root,e,this.comparator,!1)}getReverseIterator(){return new eg(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new eg(this.root,e,this.comparator,!0)}}class eg{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Mn{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??Mn.RED,this.left=i??Mn.EMPTY,this.right=s??Mn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new Mn(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Mn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return Mn.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Mn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Mn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw je(43730,{key:this.key,value:this.value});if(this.right.isRed())throw je(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw je(27949);return e+(this.isRed()?0:1)}}Mn.EMPTY=null,Mn.RED=!0,Mn.BLACK=!1;Mn.EMPTY=new class{constructor(){this.size=0}get key(){throw je(57766)}get value(){throw je(16141)}get color(){throw je(16727)}get left(){throw je(29726)}get right(){throw je(36894)}copy(e,t,r,i,s){return this}insert(e,t,r){return new Mn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gn{constructor(e){this.comparator=e,this.data=new Vt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,r)=>(e(t),!1)))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new A2(this.data.getIterator())}getIteratorFrom(e){return new A2(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((r=>{t=t.add(r)})),t}isEqual(e){if(!(e instanceof gn)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new gn(this.comparator);return t.data=e,t}}class A2{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class li{constructor(e){this.fields=e,e.sort(kn.comparator)}static empty(){return new li([])}unionWith(e){let t=new gn(kn.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new li(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return uu(this.fields,e.fields,((t,r)=>t.isEqual(r)))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hM extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dn{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new hM("Invalid base64 string: "+s):s}})(e);return new Dn(t)}static fromUint8Array(e){const t=(function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s})(e);return new Dn(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return rt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Dn.EMPTY_BYTE_STRING=new Dn("");const U8=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function la(n){if(gt(!!n,39018),typeof n=="string"){let e=0;const t=U8.exec(n);if(gt(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Zt(n.seconds),nanos:Zt(n.nanos)}}function Zt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function ca(n){return typeof n=="string"?Dn.fromBase64String(n):Dn.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fM="server_timestamp",dM="__type__",pM="__previous_value__",gM="__local_write_time__";function hw(n){return(n?.mapValue?.fields||{})[dM]?.stringValue===fM}function y_(n){const e=n.mapValue.fields[pM];return hw(e)?y_(e):e}function Wf(n){const e=la(n.mapValue.fields[gM].timestampValue);return new Ot(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F8{constructor(e,t,r,i,s,o,l,u,h,d){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=l,this.longPollingOptions=u,this.useFetchStreams=h,this.isUsingEmulator=d}}const xm="(default)";class qf{constructor(e,t){this.projectId=e,this.database=t||xm}static empty(){return new qf("","")}get isDefaultDatabase(){return this.database===xm}isEqual(e){return e instanceof qf&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mM="__type__",B8="__max__",tg={mapValue:{}},_M="__vector__",Am="value";function ua(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?hw(n)?4:z8(n)?9007199254740991:V8(n)?10:11:je(28295,{value:n})}function Ki(n,e){if(n===e)return!0;const t=ua(n);if(t!==ua(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Wf(n).isEqual(Wf(e));case 3:return(function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const o=la(i.timestampValue),l=la(s.timestampValue);return o.seconds===l.seconds&&o.nanos===l.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(i,s){return ca(i.bytesValue).isEqual(ca(s.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(i,s){return Zt(i.geoPointValue.latitude)===Zt(s.geoPointValue.latitude)&&Zt(i.geoPointValue.longitude)===Zt(s.geoPointValue.longitude)})(n,e);case 2:return(function(i,s){if("integerValue"in i&&"integerValue"in s)return Zt(i.integerValue)===Zt(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const o=Zt(i.doubleValue),l=Zt(s.doubleValue);return o===l?Em(o)===Em(l):isNaN(o)&&isNaN(l)}return!1})(n,e);case 9:return uu(n.arrayValue.values||[],e.arrayValue.values||[],Ki);case 10:case 11:return(function(i,s){const o=i.mapValue.fields||{},l=s.mapValue.fields||{};if(x2(o)!==x2(l))return!1;for(const u in o)if(o.hasOwnProperty(u)&&(l[u]===void 0||!Ki(o[u],l[u])))return!1;return!0})(n,e);default:return je(52216,{left:n})}}function Xf(n,e){return(n.values||[]).find((t=>Ki(t,e)))!==void 0}function hu(n,e){if(n===e)return 0;const t=ua(n),r=ua(e);if(t!==r)return rt(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return rt(n.booleanValue,e.booleanValue);case 2:return(function(s,o){const l=Zt(s.integerValue||s.doubleValue),u=Zt(o.integerValue||o.doubleValue);return l<u?-1:l>u?1:l===u?0:isNaN(l)?isNaN(u)?0:-1:1})(n,e);case 3:return S2(n.timestampValue,e.timestampValue);case 4:return S2(Wf(n),Wf(e));case 5:return I0(n.stringValue,e.stringValue);case 6:return(function(s,o){const l=ca(s),u=ca(o);return l.compareTo(u)})(n.bytesValue,e.bytesValue);case 7:return(function(s,o){const l=s.split("/"),u=o.split("/");for(let h=0;h<l.length&&h<u.length;h++){const d=rt(l[h],u[h]);if(d!==0)return d}return rt(l.length,u.length)})(n.referenceValue,e.referenceValue);case 8:return(function(s,o){const l=rt(Zt(s.latitude),Zt(o.latitude));return l!==0?l:rt(Zt(s.longitude),Zt(o.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return R2(n.arrayValue,e.arrayValue);case 10:return(function(s,o){const l=s.fields||{},u=o.fields||{},h=l[Am]?.arrayValue,d=u[Am]?.arrayValue,g=rt(h?.values?.length||0,d?.values?.length||0);return g!==0?g:R2(h,d)})(n.mapValue,e.mapValue);case 11:return(function(s,o){if(s===tg.mapValue&&o===tg.mapValue)return 0;if(s===tg.mapValue)return 1;if(o===tg.mapValue)return-1;const l=s.fields||{},u=Object.keys(l),h=o.fields||{},d=Object.keys(h);u.sort(),d.sort();for(let g=0;g<u.length&&g<d.length;++g){const y=I0(u[g],d[g]);if(y!==0)return y;const b=hu(l[u[g]],h[d[g]]);if(b!==0)return b}return rt(u.length,d.length)})(n.mapValue,e.mapValue);default:throw je(23264,{he:t})}}function S2(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return rt(n,e);const t=la(n),r=la(e),i=rt(t.seconds,r.seconds);return i!==0?i:rt(t.nanos,r.nanos)}function R2(n,e){const t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){const s=hu(t[i],r[i]);if(s)return s}return rt(t.length,r.length)}function fu(n){return P0(n)}function P0(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const r=la(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return ca(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return Ue.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",i=!0;for(const s of t.values||[])i?i=!1:r+=",",r+=P0(s);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){const r=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const o of r)s?s=!1:i+=",",i+=`${o}:${P0(t.fields[o])}`;return i+"}"})(n.mapValue):je(61005,{value:n})}function Wg(n){switch(ua(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=y_(n);return e?16+Wg(e):16;case 5:return 2*n.stringValue.length;case 6:return ca(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((i,s)=>i+Wg(s)),0)})(n.arrayValue);case 10:case 11:return(function(r){let i=0;return Il(r.fields,((s,o)=>{i+=s.length+Wg(o)})),i})(n.mapValue);default:throw je(13486,{value:n})}}function M0(n){return!!n&&"integerValue"in n}function fw(n){return!!n&&"arrayValue"in n}function C2(n){return!!n&&"nullValue"in n}function I2(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function qg(n){return!!n&&"mapValue"in n}function V8(n){return(n?.mapValue?.fields||{})[mM]?.stringValue===_M}function xf(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return Il(n.mapValue.fields,((t,r)=>e.mapValue.fields[t]=xf(r))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=xf(n.arrayValue.values[t]);return e}return{...n}}function z8(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===B8}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zr{constructor(e){this.value=e}static empty(){return new zr({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!qg(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=xf(t)}setAll(e){let t=kn.emptyPath(),r={},i=[];e.forEach(((o,l)=>{if(!t.isImmediateParentOf(l)){const u=this.getFieldsMap(t);this.applyChanges(u,r,i),r={},i=[],t=l.popLast()}o?r[l.lastSegment()]=xf(o):i.push(l.lastSegment())}));const s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){const t=this.field(e.popLast());qg(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ki(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];qg(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Il(t,((i,s)=>e[i]=s));for(const i of r)delete e[i]}clone(){return new zr(xf(this.value))}}function yM(n){const e=[];return Il(n.fields,((t,r)=>{const i=new kn([t]);if(qg(r)){const s=yM(r.mapValue).fields;if(s.length===0)e.push(i);else for(const o of s)e.push(i.child(o))}else e.push(i)})),new li(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yn{constructor(e,t,r,i,s,o,l){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=l}static newInvalidDocument(e){return new Yn(e,0,$e.min(),$e.min(),$e.min(),zr.empty(),0)}static newFoundDocument(e,t,r,i){return new Yn(e,1,t,$e.min(),r,i,0)}static newNoDocument(e,t){return new Yn(e,2,t,$e.min(),$e.min(),zr.empty(),0)}static newUnknownDocument(e,t){return new Yn(e,3,t,$e.min(),$e.min(),zr.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual($e.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=zr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=zr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=$e.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Yn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Yn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sm{constructor(e,t){this.position=e,this.inclusive=t}}function P2(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const s=e[i],o=n.position[i];if(s.field.isKeyField()?r=Ue.comparator(Ue.fromName(o.referenceValue),t.key):r=hu(o,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function M2(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Ki(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rm{constructor(e,t="asc"){this.field=e,this.dir=t}}function j8(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vM{}class pn extends vM{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new $8(e,t,r):t==="array-contains"?new X8(e,r):t==="in"?new Y8(e,r):t==="not-in"?new K8(e,r):t==="array-contains-any"?new G8(e,r):new pn(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new W8(e,r):new q8(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(hu(t,this.value)):t!==null&&ua(this.value)===ua(t)&&this.matchesComparison(hu(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return je(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Gi extends vM{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Gi(e,t)}matches(e){return bM(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function bM(n){return n.op==="and"}function TM(n){return H8(n)&&bM(n)}function H8(n){for(const e of n.filters)if(e instanceof Gi)return!1;return!0}function O0(n){if(n instanceof pn)return n.field.canonicalString()+n.op.toString()+fu(n.value);if(TM(n))return n.filters.map((e=>O0(e))).join(",");{const e=n.filters.map((t=>O0(t))).join(",");return`${n.op}(${e})`}}function wM(n,e){return n instanceof pn?(function(r,i){return i instanceof pn&&r.op===i.op&&r.field.isEqual(i.field)&&Ki(r.value,i.value)})(n,e):n instanceof Gi?(function(r,i){return i instanceof Gi&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce(((s,o,l)=>s&&wM(o,i.filters[l])),!0):!1})(n,e):void je(19439)}function EM(n){return n instanceof pn?(function(t){return`${t.field.canonicalString()} ${t.op} ${fu(t.value)}`})(n):n instanceof Gi?(function(t){return t.op.toString()+" {"+t.getFilters().map(EM).join(" ,")+"}"})(n):"Filter"}class $8 extends pn{constructor(e,t,r){super(e,t,r),this.key=Ue.fromName(r.referenceValue)}matches(e){const t=Ue.comparator(e.key,this.key);return this.matchesComparison(t)}}class W8 extends pn{constructor(e,t){super(e,"in",t),this.keys=xM("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class q8 extends pn{constructor(e,t){super(e,"not-in",t),this.keys=xM("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function xM(n,e){return(e.arrayValue?.values||[]).map((t=>Ue.fromName(t.referenceValue)))}class X8 extends pn{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return fw(t)&&Xf(t.arrayValue,this.value)}}class Y8 extends pn{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Xf(this.value.arrayValue,t)}}class K8 extends pn{constructor(e,t){super(e,"not-in",t)}matches(e){if(Xf(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Xf(this.value.arrayValue,t)}}class G8 extends pn{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!fw(t)||!t.arrayValue.values)&&t.arrayValue.values.some((r=>Xf(this.value.arrayValue,r)))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z8{constructor(e,t=null,r=[],i=[],s=null,o=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=l,this.Te=null}}function O2(n,e=null,t=[],r=[],i=null,s=null,o=null){return new Z8(n,e,t,r,i,s,o)}function dw(n){const e=qe(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((r=>O0(r))).join(","),t+="|ob:",t+=e.orderBy.map((r=>(function(s){return s.field.canonicalString()+s.dir})(r))).join(","),__(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((r=>fu(r))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((r=>fu(r))).join(",")),e.Te=t}return e.Te}function pw(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!j8(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!wM(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!M2(n.startAt,e.startAt)&&M2(n.endAt,e.endAt)}function k0(n){return Ue.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v_{constructor(e,t=null,r=[],i=[],s=null,o="F",l=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=l,this.endAt=u,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function Q8(n,e,t,r,i,s,o,l){return new v_(n,e,t,r,i,s,o,l)}function gw(n){return new v_(n)}function k2(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function J8(n){return n.collectionGroup!==null}function Af(n){const e=qe(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const s of e.explicitOrderBy)e.Ie.push(s),t.add(s.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let l=new gn(kn.comparator);return o.filters.forEach((u=>{u.getFlattenedFilters().forEach((h=>{h.isInequality()&&(l=l.add(h.field))}))})),l})(e).forEach((s=>{t.has(s.canonicalString())||s.isKeyField()||e.Ie.push(new Rm(s,r))})),t.has(kn.keyField().canonicalString())||e.Ie.push(new Rm(kn.keyField(),r))}return e.Ie}function Hi(n){const e=qe(n);return e.Ee||(e.Ee=ez(e,Af(n))),e.Ee}function ez(n,e){if(n.limitType==="F")return O2(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((i=>{const s=i.dir==="desc"?"asc":"desc";return new Rm(i.field,s)}));const t=n.endAt?new Sm(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Sm(n.startAt.position,n.startAt.inclusive):null;return O2(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function N0(n,e,t){return new v_(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function b_(n,e){return pw(Hi(n),Hi(e))&&n.limitType===e.limitType}function AM(n){return`${dw(Hi(n))}|lt:${n.limitType}`}function Uc(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map((i=>EM(i))).join(", ")}]`),__(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map((i=>(function(o){return`${o.field.canonicalString()} (${o.dir})`})(i))).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map((i=>fu(i))).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map((i=>fu(i))).join(",")),`Target(${r})`})(Hi(n))}; limitType=${n.limitType})`}function T_(n,e){return e.isFoundDocument()&&(function(r,i){const s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):Ue.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)})(n,e)&&(function(r,i){for(const s of Af(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0})(n,e)&&(function(r,i){for(const s of r.filters)if(!s.matches(i))return!1;return!0})(n,e)&&(function(r,i){return!(r.startAt&&!(function(o,l,u){const h=P2(o,l,u);return o.inclusive?h<=0:h<0})(r.startAt,Af(r),i)||r.endAt&&!(function(o,l,u){const h=P2(o,l,u);return o.inclusive?h>=0:h>0})(r.endAt,Af(r),i))})(n,e)}function tz(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function SM(n){return(e,t)=>{let r=!1;for(const i of Af(n)){const s=nz(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function nz(n,e,t){const r=n.field.isKeyField()?Ue.comparator(e.key,t.key):(function(s,o,l){const u=o.data.field(s),h=l.data.field(s);return u!==null&&h!==null?hu(u,h):je(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return je(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pl{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Il(this.inner,((t,r)=>{for(const[i,s]of r)e(i,s)}))}isEmpty(){return uM(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rz=new Vt(Ue.comparator);function Bs(){return rz}const RM=new Vt(Ue.comparator);function df(...n){let e=RM;for(const t of n)e=e.insert(t.key,t);return e}function CM(n){let e=RM;return n.forEach(((t,r)=>e=e.insert(t,r.overlayedDocument))),e}function al(){return Sf()}function IM(){return Sf()}function Sf(){return new Pl((n=>n.toString()),((n,e)=>n.isEqual(e)))}const iz=new Vt(Ue.comparator),sz=new gn(Ue.comparator);function it(...n){let e=sz;for(const t of n)e=e.add(t);return e}const oz=new gn(rt);function az(){return oz}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mw(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Em(e)?"-0":e}}function PM(n){return{integerValue:""+n}}function lz(n,e){return N8(e)?PM(e):mw(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w_{constructor(){this._=void 0}}function cz(n,e,t){return n instanceof Yf?(function(i,s){const o={fields:{[dM]:{stringValue:fM},[gM]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&hw(s)&&(s=y_(s)),s&&(o.fields[pM]=s),{mapValue:o}})(t,e):n instanceof Kf?OM(n,e):n instanceof Gf?kM(n,e):(function(i,s){const o=MM(i,s),l=N2(o)+N2(i.Ae);return M0(o)&&M0(i.Ae)?PM(l):mw(i.serializer,l)})(n,e)}function uz(n,e,t){return n instanceof Kf?OM(n,e):n instanceof Gf?kM(n,e):t}function MM(n,e){return n instanceof Cm?(function(r){return M0(r)||(function(s){return!!s&&"doubleValue"in s})(r)})(e)?e:{integerValue:0}:null}class Yf extends w_{}class Kf extends w_{constructor(e){super(),this.elements=e}}function OM(n,e){const t=NM(e);for(const r of n.elements)t.some((i=>Ki(i,r)))||t.push(r);return{arrayValue:{values:t}}}class Gf extends w_{constructor(e){super(),this.elements=e}}function kM(n,e){let t=NM(e);for(const r of n.elements)t=t.filter((i=>!Ki(i,r)));return{arrayValue:{values:t}}}class Cm extends w_{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function N2(n){return Zt(n.integerValue||n.doubleValue)}function NM(n){return fw(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hz{constructor(e,t){this.field=e,this.transform=t}}function fz(n,e){return n.field.isEqual(e.field)&&(function(r,i){return r instanceof Kf&&i instanceof Kf||r instanceof Gf&&i instanceof Gf?uu(r.elements,i.elements,Ki):r instanceof Cm&&i instanceof Cm?Ki(r.Ae,i.Ae):r instanceof Yf&&i instanceof Yf})(n.transform,e.transform)}class dz{constructor(e,t){this.version=e,this.transformResults=t}}class ks{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new ks}static exists(e){return new ks(void 0,e)}static updateTime(e){return new ks(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Xg(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class E_{}function DM(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new UM(n.key,ks.none()):new yd(n.key,n.data,ks.none());{const t=n.data,r=zr.empty();let i=new gn(kn.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new Ml(n.key,r,new li(i.toArray()),ks.none())}}function pz(n,e,t){n instanceof yd?(function(i,s,o){const l=i.value.clone(),u=L2(i.fieldTransforms,s,o.transformResults);l.setAll(u),s.convertToFoundDocument(o.version,l).setHasCommittedMutations()})(n,e,t):n instanceof Ml?(function(i,s,o){if(!Xg(i.precondition,s))return void s.convertToUnknownDocument(o.version);const l=L2(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(LM(i)),u.setAll(l),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()})(n,e,t):(function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()})(0,e,t)}function Rf(n,e,t,r){return n instanceof yd?(function(s,o,l,u){if(!Xg(s.precondition,o))return l;const h=s.value.clone(),d=U2(s.fieldTransforms,u,o);return h.setAll(d),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),null})(n,e,t,r):n instanceof Ml?(function(s,o,l,u){if(!Xg(s.precondition,o))return l;const h=U2(s.fieldTransforms,u,o),d=o.data;return d.setAll(LM(s)),d.setAll(h),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),l===null?null:l.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map((g=>g.field)))})(n,e,t,r):(function(s,o,l){return Xg(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):l})(n,e,t)}function gz(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),s=MM(r.transform,i||null);s!=null&&(t===null&&(t=zr.empty()),t.set(r.field,s))}return t||null}function D2(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&uu(r,i,((s,o)=>fz(s,o)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class yd extends E_{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Ml extends E_{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function LM(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}})),e}function L2(n,e,t){const r=new Map;gt(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let i=0;i<t.length;i++){const s=n[i],o=s.transform,l=e.data.field(s.field);r.set(s.field,uz(o,l,t[i]))}return r}function U2(n,e,t){const r=new Map;for(const i of n){const s=i.transform,o=t.data.field(i.field);r.set(i.field,cz(s,o,e))}return r}class UM extends E_{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class mz extends E_{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _z{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&pz(s,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Rf(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Rf(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=IM();return this.mutations.forEach((i=>{const s=e.get(i.key),o=s.overlayedDocument;let l=this.applyToLocalView(o,s.mutatedFields);l=t.has(i.key)?null:l;const u=DM(o,l);u!==null&&r.set(i.key,u),o.isValidDocument()||o.convertToNoDocument($e.min())})),r}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),it())}isEqual(e){return this.batchId===e.batchId&&uu(this.mutations,e.mutations,((t,r)=>D2(t,r)))&&uu(this.baseMutations,e.baseMutations,((t,r)=>D2(t,r)))}}class _w{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){gt(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let i=(function(){return iz})();const s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new _w(e,t,r,i)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yz{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vz{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var tn,ut;function bz(n){switch(n){case Te.OK:return je(64938);case Te.CANCELLED:case Te.UNKNOWN:case Te.DEADLINE_EXCEEDED:case Te.RESOURCE_EXHAUSTED:case Te.INTERNAL:case Te.UNAVAILABLE:case Te.UNAUTHENTICATED:return!1;case Te.INVALID_ARGUMENT:case Te.NOT_FOUND:case Te.ALREADY_EXISTS:case Te.PERMISSION_DENIED:case Te.FAILED_PRECONDITION:case Te.ABORTED:case Te.OUT_OF_RANGE:case Te.UNIMPLEMENTED:case Te.DATA_LOSS:return!0;default:return je(15467,{code:n})}}function FM(n){if(n===void 0)return Fs("GRPC error has no .code"),Te.UNKNOWN;switch(n){case tn.OK:return Te.OK;case tn.CANCELLED:return Te.CANCELLED;case tn.UNKNOWN:return Te.UNKNOWN;case tn.DEADLINE_EXCEEDED:return Te.DEADLINE_EXCEEDED;case tn.RESOURCE_EXHAUSTED:return Te.RESOURCE_EXHAUSTED;case tn.INTERNAL:return Te.INTERNAL;case tn.UNAVAILABLE:return Te.UNAVAILABLE;case tn.UNAUTHENTICATED:return Te.UNAUTHENTICATED;case tn.INVALID_ARGUMENT:return Te.INVALID_ARGUMENT;case tn.NOT_FOUND:return Te.NOT_FOUND;case tn.ALREADY_EXISTS:return Te.ALREADY_EXISTS;case tn.PERMISSION_DENIED:return Te.PERMISSION_DENIED;case tn.FAILED_PRECONDITION:return Te.FAILED_PRECONDITION;case tn.ABORTED:return Te.ABORTED;case tn.OUT_OF_RANGE:return Te.OUT_OF_RANGE;case tn.UNIMPLEMENTED:return Te.UNIMPLEMENTED;case tn.DATA_LOSS:return Te.DATA_LOSS;default:return je(39323,{code:n})}}(ut=tn||(tn={}))[ut.OK=0]="OK",ut[ut.CANCELLED=1]="CANCELLED",ut[ut.UNKNOWN=2]="UNKNOWN",ut[ut.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ut[ut.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ut[ut.NOT_FOUND=5]="NOT_FOUND",ut[ut.ALREADY_EXISTS=6]="ALREADY_EXISTS",ut[ut.PERMISSION_DENIED=7]="PERMISSION_DENIED",ut[ut.UNAUTHENTICATED=16]="UNAUTHENTICATED",ut[ut.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ut[ut.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ut[ut.ABORTED=10]="ABORTED",ut[ut.OUT_OF_RANGE=11]="OUT_OF_RANGE",ut[ut.UNIMPLEMENTED=12]="UNIMPLEMENTED",ut[ut.INTERNAL=13]="INTERNAL",ut[ut.UNAVAILABLE=14]="UNAVAILABLE",ut[ut.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tz(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wz=new ta([4294967295,4294967295],0);function F2(n){const e=Tz().encode(n),t=new eM;return t.update(e),new Uint8Array(t.digest())}function B2(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new ta([t,r],0),new ta([i,s],0)]}class yw{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new pf(`Invalid padding: ${t}`);if(r<0)throw new pf(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new pf(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new pf(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=ta.fromNumber(this.ge)}ye(e,t,r){let i=e.add(t.multiply(ta.fromNumber(r)));return i.compare(wz)===1&&(i=new ta([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=F2(e),[r,i]=B2(t);for(let s=0;s<this.hashCount;s++){const o=this.ye(r,i,s);if(!this.we(o))return!1}return!0}static create(e,t,r){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new yw(s,i,t);return r.forEach((l=>o.insert(l))),o}insert(e){if(this.ge===0)return;const t=F2(e),[r,i]=B2(t);for(let s=0;s<this.hashCount;s++){const o=this.ye(r,i,s);this.Se(o)}}Se(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class pf extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x_{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,vd.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new x_($e.min(),i,new Vt(rt),Bs(),it())}}class vd{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new vd(r,t,it(),it(),it())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yg{constructor(e,t,r,i){this.be=e,this.removedTargetIds=t,this.key=r,this.De=i}}class BM{constructor(e,t){this.targetId=e,this.Ce=t}}class VM{constructor(e,t,r=Dn.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class V2{constructor(){this.ve=0,this.Fe=z2(),this.Me=Dn.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=it(),t=it(),r=it();return this.Fe.forEach(((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:je(38017,{changeType:s})}})),new vd(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=z2()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,gt(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class Ez{constructor(e){this.Ge=e,this.ze=new Map,this.je=Bs(),this.Je=ng(),this.He=ng(),this.Ye=new Vt(rt)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:je(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((r,i)=>{this.rt(i)&&t(i)}))}st(e){const t=e.targetId,r=e.Ce.count,i=this.ot(t);if(i){const s=i.target;if(k0(s))if(r===0){const o=new Ue(s.path);this.et(t,o,Yn.newNoDocument(o,$e.min()))}else gt(r===1,20013,{expectedCount:r});else{const o=this._t(t);if(o!==r){const l=this.ut(e),u=l?this.ct(l,e,o):1;if(u!==0){this.it(t);const h=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,h)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t;let o,l;try{o=ca(r).toUint8Array()}catch(u){if(u instanceof hM)return cu("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{l=new yw(o,i,s)}catch(u){return cu(u instanceof pf?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return l.ge===0?null:l}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let i=0;return r.forEach((s=>{const o=this.Ge.ht(),l=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(l)||(this.et(t,s,null),i++)})),i}Tt(e){const t=new Map;this.ze.forEach(((s,o)=>{const l=this.ot(o);if(l){if(s.current&&k0(l.target)){const u=new Ue(l.target.path);this.It(u).has(o)||this.Et(o,u)||this.et(o,u,Yn.newNoDocument(u,e))}s.Be&&(t.set(o,s.ke()),s.qe())}}));let r=it();this.He.forEach(((s,o)=>{let l=!0;o.forEachWhile((u=>{const h=this.ot(u);return!h||h.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)})),l&&(r=r.add(s))})),this.je.forEach(((s,o)=>o.setReadTime(e)));const i=new x_(e,t,this.Ye,this.je,r);return this.je=Bs(),this.Je=ng(),this.He=ng(),this.Ye=new Vt(rt),i}Xe(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const i=this.nt(e);this.Et(e,t)?i.Qe(t,1):i.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new V2,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new gn(rt),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new gn(rt),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||Ie("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new V2),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function ng(){return new Vt(Ue.comparator)}function z2(){return new Vt(Ue.comparator)}const xz={asc:"ASCENDING",desc:"DESCENDING"},Az={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Sz={and:"AND",or:"OR"};class Rz{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function D0(n,e){return n.useProto3Json||__(e)?e:{value:e}}function Im(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function zM(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Cz(n,e){return Im(n,e.toTimestamp())}function $i(n){return gt(!!n,49232),$e.fromTimestamp((function(t){const r=la(t);return new Ot(r.seconds,r.nanos)})(n))}function vw(n,e){return L0(n,e).canonicalString()}function L0(n,e){const t=(function(i){return new Ut(["projects",i.projectId,"databases",i.database])})(n).child("documents");return e===void 0?t:t.child(e)}function jM(n){const e=Ut.fromString(n);return gt(XM(e),10190,{key:e.toString()}),e}function U0(n,e){return vw(n.databaseId,e.path)}function fb(n,e){const t=jM(e);if(t.get(1)!==n.databaseId.projectId)throw new Le(Te.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new Le(Te.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Ue($M(t))}function HM(n,e){return vw(n.databaseId,e)}function Iz(n){const e=jM(n);return e.length===4?Ut.emptyPath():$M(e)}function F0(n){return new Ut(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function $M(n){return gt(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function j2(n,e,t){return{name:U0(n,e),fields:t.value.mapValue.fields}}function Pz(n,e){let t;if("targetChange"in e){e.targetChange;const r=(function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:je(39313,{state:h})})(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=(function(h,d){return h.useProto3Json?(gt(d===void 0||typeof d=="string",58123),Dn.fromBase64String(d||"")):(gt(d===void 0||d instanceof Buffer||d instanceof Uint8Array,16193),Dn.fromUint8Array(d||new Uint8Array))})(n,e.targetChange.resumeToken),o=e.targetChange.cause,l=o&&(function(h){const d=h.code===void 0?Te.UNKNOWN:FM(h.code);return new Le(d,h.message||"")})(o);t=new VM(r,i,s,l||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=fb(n,r.document.name),s=$i(r.document.updateTime),o=r.document.createTime?$i(r.document.createTime):$e.min(),l=new zr({mapValue:{fields:r.document.fields}}),u=Yn.newFoundDocument(i,s,o,l),h=r.targetIds||[],d=r.removedTargetIds||[];t=new Yg(h,d,u.key,u)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=fb(n,r.document),s=r.readTime?$i(r.readTime):$e.min(),o=Yn.newNoDocument(i,s),l=r.removedTargetIds||[];t=new Yg([],l,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=fb(n,r.document),s=r.removedTargetIds||[];t=new Yg([],s,i,null)}else{if(!("filter"in e))return je(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:s}=r,o=new vz(i,s),l=r.targetId;t=new BM(l,o)}}return t}function Mz(n,e){let t;if(e instanceof yd)t={update:j2(n,e.key,e.value)};else if(e instanceof UM)t={delete:U0(n,e.key)};else if(e instanceof Ml)t={update:j2(n,e.key,e.data),updateMask:Vz(e.fieldMask)};else{if(!(e instanceof mz))return je(16599,{Vt:e.type});t={verify:U0(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((r=>(function(s,o){const l=o.transform;if(l instanceof Yf)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof Kf)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof Gf)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof Cm)return{fieldPath:o.field.canonicalString(),increment:l.Ae};throw je(20930,{transform:o.transform})})(0,r)))),e.precondition.isNone||(t.currentDocument=(function(i,s){return s.updateTime!==void 0?{updateTime:Cz(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:je(27497)})(n,e.precondition)),t}function Oz(n,e){return n&&n.length>0?(gt(e!==void 0,14353),n.map((t=>(function(i,s){let o=i.updateTime?$i(i.updateTime):$i(s);return o.isEqual($e.min())&&(o=$i(s)),new dz(o,i.transformResults||[])})(t,e)))):[]}function kz(n,e){return{documents:[HM(n,e.path)]}}function Nz(n,e){const t={structuredQuery:{}},r=e.path;let i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=HM(n,i);const s=(function(h){if(h.length!==0)return qM(Gi.create(h,"and"))})(e.filters);s&&(t.structuredQuery.where=s);const o=(function(h){if(h.length!==0)return h.map((d=>(function(y){return{field:Fc(y.field),direction:Uz(y.dir)}})(d)))})(e.orderBy);o&&(t.structuredQuery.orderBy=o);const l=D0(n,e.limit);return l!==null&&(t.structuredQuery.limit=l),e.startAt&&(t.structuredQuery.startAt=(function(h){return{before:h.inclusive,values:h.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(h){return{before:!h.inclusive,values:h.position}})(e.endAt)),{ft:t,parent:i}}function Dz(n){let e=Iz(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){gt(r===1,65062);const d=t.from[0];d.allDescendants?i=d.collectionId:e=e.child(d.collectionId)}let s=[];t.where&&(s=(function(g){const y=WM(g);return y instanceof Gi&&TM(y)?y.getFilters():[y]})(t.where));let o=[];t.orderBy&&(o=(function(g){return g.map((y=>(function(w){return new Rm(Bc(w.field),(function(x){switch(x){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(w.direction))})(y)))})(t.orderBy));let l=null;t.limit&&(l=(function(g){let y;return y=typeof g=="object"?g.value:g,__(y)?null:y})(t.limit));let u=null;t.startAt&&(u=(function(g){const y=!!g.before,b=g.values||[];return new Sm(b,y)})(t.startAt));let h=null;return t.endAt&&(h=(function(g){const y=!g.before,b=g.values||[];return new Sm(b,y)})(t.endAt)),Q8(e,i,o,s,l,"F",u,h)}function Lz(n,e){const t=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return je(28987,{purpose:i})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function WM(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Bc(t.unaryFilter.field);return pn.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=Bc(t.unaryFilter.field);return pn.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Bc(t.unaryFilter.field);return pn.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Bc(t.unaryFilter.field);return pn.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return je(61313);default:return je(60726)}})(n):n.fieldFilter!==void 0?(function(t){return pn.create(Bc(t.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return je(58110);default:return je(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return Gi.create(t.compositeFilter.filters.map((r=>WM(r))),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return je(1026)}})(t.compositeFilter.op))})(n):je(30097,{filter:n})}function Uz(n){return xz[n]}function Fz(n){return Az[n]}function Bz(n){return Sz[n]}function Fc(n){return{fieldPath:n.canonicalString()}}function Bc(n){return kn.fromServerFormat(n.fieldPath)}function qM(n){return n instanceof pn?(function(t){if(t.op==="=="){if(I2(t.value))return{unaryFilter:{field:Fc(t.field),op:"IS_NAN"}};if(C2(t.value))return{unaryFilter:{field:Fc(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(I2(t.value))return{unaryFilter:{field:Fc(t.field),op:"IS_NOT_NAN"}};if(C2(t.value))return{unaryFilter:{field:Fc(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Fc(t.field),op:Fz(t.op),value:t.value}}})(n):n instanceof Gi?(function(t){const r=t.getFilters().map((i=>qM(i)));return r.length===1?r[0]:{compositeFilter:{op:Bz(t.op),filters:r}}})(n):je(54877,{filter:n})}function Vz(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function XM(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xo{constructor(e,t,r,i,s=$e.min(),o=$e.min(),l=Dn.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=l,this.expectedCount=u}withSequenceNumber(e){return new Xo(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Xo(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Xo(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Xo(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zz{constructor(e){this.yt=e}}function jz(n){const e=Dz({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?N0(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hz{constructor(){this.Cn=new $z}addToCollectionParentIndex(e,t){return this.Cn.add(t),be.resolve()}getCollectionParents(e,t){return be.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return be.resolve()}deleteFieldIndex(e,t){return be.resolve()}deleteAllFieldIndexes(e){return be.resolve()}createTargetIndexes(e,t){return be.resolve()}getDocumentsMatchingTarget(e,t){return be.resolve(null)}getIndexType(e,t){return be.resolve(0)}getFieldIndexes(e,t){return be.resolve([])}getNextCollectionGroupToUpdate(e){return be.resolve(null)}getMinOffset(e,t){return be.resolve(aa.min())}getMinOffsetFromCollectionGroup(e,t){return be.resolve(aa.min())}updateCollectionGroup(e,t,r){return be.resolve()}updateIndexEntries(e,t){return be.resolve()}}class $z{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new gn(Ut.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new gn(Ut.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H2={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},YM=41943040;class lr{static withCacheSize(e){return new lr(e,lr.DEFAULT_COLLECTION_PERCENTILE,lr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */lr.DEFAULT_COLLECTION_PERCENTILE=10,lr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,lr.DEFAULT=new lr(YM,lr.DEFAULT_COLLECTION_PERCENTILE,lr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),lr.DISABLED=new lr(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class du{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new du(0)}static cr(){return new du(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $2="LruGarbageCollector",Wz=1048576;function W2([n,e],[t,r]){const i=rt(n,t);return i===0?rt(e,r):i}class qz{constructor(e){this.Ir=e,this.buffer=new gn(W2),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();W2(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Xz{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){Ie($2,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Lu(t)?Ie($2,"Ignoring IndexedDB error during garbage collection: ",t):await Du(t)}await this.Vr(3e5)}))}}class Yz{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((r=>Math.floor(t/100*r)))}nthSequenceNumber(e,t){if(t===0)return be.resolve(m_.ce);const r=new qz(t);return this.mr.forEachTarget(e,(i=>r.Ar(i.sequenceNumber))).next((()=>this.mr.pr(e,(i=>r.Ar(i))))).next((()=>r.maxValue))}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(Ie("LruGarbageCollector","Garbage collection skipped; disabled"),be.resolve(H2)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(Ie("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),H2):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,i,s,o,l,u,h;const d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((g=>(g>this.params.maximumSequenceNumbersToCollect?(Ie("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),i=this.params.maximumSequenceNumbersToCollect):i=g,o=Date.now(),this.nthSequenceNumber(e,i)))).next((g=>(r=g,l=Date.now(),this.removeTargets(e,r,t)))).next((g=>(s=g,u=Date.now(),this.removeOrphanedDocuments(e,r)))).next((g=>(h=Date.now(),Lc()<=nt.DEBUG&&Ie("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${i} in `+(l-o)+`ms
	Removed ${s} targets in `+(u-l)+`ms
	Removed ${g} documents in `+(h-u)+`ms
Total Duration: ${h-d}ms`),be.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:g}))))}}function Kz(n,e){return new Yz(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gz{constructor(){this.changes=new Pl((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Yn.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?be.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zz{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qz{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next((i=>(r=i,this.remoteDocumentCache.getEntry(e,t)))).next((i=>(r!==null&&Rf(r.mutation,i,li.empty(),Ot.now()),i)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.getLocalViewOfDocuments(e,r,it()).next((()=>r))))}getLocalViewOfDocuments(e,t,r=it()){const i=al();return this.populateOverlays(e,i,t).next((()=>this.computeViews(e,t,i,r).next((s=>{let o=df();return s.forEach(((l,u)=>{o=o.insert(l,u.overlayedDocument)})),o}))))}getOverlayedDocuments(e,t){const r=al();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,it())))}populateOverlays(e,t,r){const i=[];return r.forEach((s=>{t.has(s)||i.push(s)})),this.documentOverlayCache.getOverlays(e,i).next((s=>{s.forEach(((o,l)=>{t.set(o,l)}))}))}computeViews(e,t,r,i){let s=Bs();const o=Sf(),l=(function(){return Sf()})();return t.forEach(((u,h)=>{const d=r.get(h.key);i.has(h.key)&&(d===void 0||d.mutation instanceof Ml)?s=s.insert(h.key,h):d!==void 0?(o.set(h.key,d.mutation.getFieldMask()),Rf(d.mutation,h,d.mutation.getFieldMask(),Ot.now())):o.set(h.key,li.empty())})),this.recalculateAndSaveOverlays(e,s).next((u=>(u.forEach(((h,d)=>o.set(h,d))),t.forEach(((h,d)=>l.set(h,new Zz(d,o.get(h)??null)))),l)))}recalculateAndSaveOverlays(e,t){const r=Sf();let i=new Vt(((o,l)=>o-l)),s=it();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((o=>{for(const l of o)l.keys().forEach((u=>{const h=t.get(u);if(h===null)return;let d=r.get(u)||li.empty();d=l.applyToLocalView(h,d),r.set(u,d);const g=(i.get(l.batchId)||it()).add(u);i=i.insert(l.batchId,g)}))})).next((()=>{const o=[],l=i.getReverseIterator();for(;l.hasNext();){const u=l.getNext(),h=u.key,d=u.value,g=IM();d.forEach((y=>{if(!s.has(y)){const b=DM(t.get(y),r.get(y));b!==null&&g.set(y,b),s=s.add(y)}})),o.push(this.documentOverlayCache.saveOverlays(e,h,g))}return be.waitFor(o)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,t,r,i){return(function(o){return Ue.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):J8(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next((s=>{const o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):be.resolve(al());let l=$f,u=s;return o.next((h=>be.forEach(h,((d,g)=>(l<g.largestBatchId&&(l=g.largestBatchId),s.get(d)?be.resolve():this.remoteDocumentCache.getEntry(e,d).next((y=>{u=u.insert(d,y)}))))).next((()=>this.populateOverlays(e,h,s))).next((()=>this.computeViews(e,u,h,it()))).next((d=>({batchId:l,changes:CM(d)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Ue(t)).next((r=>{let i=df();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i}))}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){const s=t.collectionGroup;let o=df();return this.indexManager.getCollectionParents(e,s).next((l=>be.forEach(l,(u=>{const h=(function(g,y){return new v_(y,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)})(t,u.child(s));return this.getDocumentsMatchingCollectionQuery(e,h,r,i).next((d=>{d.forEach(((g,y)=>{o=o.insert(g,y)}))}))})).next((()=>o))))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next((o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i)))).next((o=>{s.forEach(((u,h)=>{const d=h.getKey();o.get(d)===null&&(o=o.insert(d,Yn.newInvalidDocument(d)))}));let l=df();return o.forEach(((u,h)=>{const d=s.get(u);d!==void 0&&Rf(d.mutation,h,li.empty(),Ot.now()),T_(t,h)&&(l=l.insert(u,h))})),l}))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jz{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return be.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(i){return{id:i.id,version:i.version,createTime:$i(i.createTime)}})(t)),be.resolve()}getNamedQuery(e,t){return be.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(i){return{name:i.name,query:jz(i.bundledQuery),readTime:$i(i.readTime)}})(t)),be.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e9{constructor(){this.overlays=new Vt(Ue.comparator),this.qr=new Map}getOverlay(e,t){return be.resolve(this.overlays.get(t))}getOverlays(e,t){const r=al();return be.forEach(t,(i=>this.getOverlay(e,i).next((s=>{s!==null&&r.set(i,s)})))).next((()=>r))}saveOverlays(e,t,r){return r.forEach(((i,s)=>{this.St(e,t,s)})),be.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.qr.get(r);return i!==void 0&&(i.forEach((s=>this.overlays=this.overlays.remove(s))),this.qr.delete(r)),be.resolve()}getOverlaysForCollection(e,t,r){const i=al(),s=t.length+1,o=new Ue(t.child("")),l=this.overlays.getIteratorFrom(o);for(;l.hasNext();){const u=l.getNext().value,h=u.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===s&&u.largestBatchId>r&&i.set(u.getKey(),u)}return be.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new Vt(((h,d)=>h-d));const o=this.overlays.getIterator();for(;o.hasNext();){const h=o.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>r){let d=s.get(h.largestBatchId);d===null&&(d=al(),s=s.insert(h.largestBatchId,d)),d.set(h.getKey(),h)}}const l=al(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach(((h,d)=>l.set(h,d))),!(l.size()>=i)););return be.resolve(l)}St(e,t,r){const i=this.overlays.get(r.key);if(i!==null){const o=this.qr.get(i.largestBatchId).delete(r.key);this.qr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new yz(t,r));let s=this.qr.get(t);s===void 0&&(s=it(),this.qr.set(t,s)),this.qr.set(t,s.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t9{constructor(){this.sessionToken=Dn.EMPTY_BYTE_STRING}getSessionToken(e){return be.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,be.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bw{constructor(){this.Qr=new gn(En.$r),this.Ur=new gn(En.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const r=new En(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach((r=>this.addReference(r,t)))}removeReference(e,t){this.Gr(new En(e,t))}zr(e,t){e.forEach((r=>this.removeReference(r,t)))}jr(e){const t=new Ue(new Ut([])),r=new En(t,e),i=new En(t,e+1),s=[];return this.Ur.forEachInRange([r,i],(o=>{this.Gr(o),s.push(o.key)})),s}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new Ue(new Ut([])),r=new En(t,e),i=new En(t,e+1);let s=it();return this.Ur.forEachInRange([r,i],(o=>{s=s.add(o.key)})),s}containsKey(e){const t=new En(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class En{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return Ue.comparator(e.key,t.key)||rt(e.Yr,t.Yr)}static Kr(e,t){return rt(e.Yr,t.Yr)||Ue.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n9{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new gn(En.$r)}checkEmpty(e){return be.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){const s=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new _z(s,t,r,i);this.mutationQueue.push(o);for(const l of i)this.Zr=this.Zr.add(new En(l.key,s)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return be.resolve(o)}lookupMutationBatch(e,t){return be.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=this.ei(r),s=i<0?0:i;return be.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return be.resolve(this.mutationQueue.length===0?uw:this.tr-1)}getAllMutationBatches(e){return be.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new En(t,0),i=new En(t,Number.POSITIVE_INFINITY),s=[];return this.Zr.forEachInRange([r,i],(o=>{const l=this.Xr(o.Yr);s.push(l)})),be.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new gn(rt);return t.forEach((i=>{const s=new En(i,0),o=new En(i,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([s,o],(l=>{r=r.add(l.Yr)}))})),be.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let s=r;Ue.isDocumentKey(s)||(s=s.child(""));const o=new En(new Ue(s),0);let l=new gn(rt);return this.Zr.forEachWhile((u=>{const h=u.key.path;return!!r.isPrefixOf(h)&&(h.length===i&&(l=l.add(u.Yr)),!0)}),o),be.resolve(this.ti(l))}ti(e){const t=[];return e.forEach((r=>{const i=this.Xr(r);i!==null&&t.push(i)})),t}removeMutationBatch(e,t){gt(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return be.forEach(t.mutations,(i=>{const s=new En(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,t){const r=new En(t,0),i=this.Zr.firstAfterOrEqual(r);return be.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,be.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r9{constructor(e){this.ri=e,this.docs=(function(){return new Vt(Ue.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return be.resolve(r?r.document.mutableCopy():Yn.newInvalidDocument(t))}getEntries(e,t){let r=Bs();return t.forEach((i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Yn.newInvalidDocument(i))})),be.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Bs();const o=t.path,l=new Ue(o.child("__id-9223372036854775808__")),u=this.docs.getIteratorFrom(l);for(;u.hasNext();){const{key:h,value:{document:d}}=u.getNext();if(!o.isPrefixOf(h.path))break;h.path.length>o.length+1||P8(I8(d),r)<=0||(i.has(d.key)||T_(t,d))&&(s=s.insert(d.key,d.mutableCopy()))}return be.resolve(s)}getAllFromCollectionGroup(e,t,r,i){je(9500)}ii(e,t){return be.forEach(this.docs,(r=>t(r)))}newChangeBuffer(e){return new i9(this)}getSize(e){return be.resolve(this.size)}}class i9 extends Gz{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((r,i)=>{i.isValidDocument()?t.push(this.Nr.addEntry(e,i)):this.Nr.removeEntry(r)})),be.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s9{constructor(e){this.persistence=e,this.si=new Pl((t=>dw(t)),pw),this.lastRemoteSnapshotVersion=$e.min(),this.highestTargetId=0,this.oi=0,this._i=new bw,this.targetCount=0,this.ai=du.ur()}forEachTarget(e,t){return this.si.forEach(((r,i)=>t(i))),be.resolve()}getLastRemoteSnapshotVersion(e){return be.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return be.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),be.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),be.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new du(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,be.resolve()}updateTargetData(e,t){return this.Pr(t),be.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,be.resolve()}removeTargets(e,t,r){let i=0;const s=[];return this.si.forEach(((o,l)=>{l.sequenceNumber<=t&&r.get(l.targetId)===null&&(this.si.delete(o),s.push(this.removeMatchingKeysForTargetId(e,l.targetId)),i++)})),be.waitFor(s).next((()=>i))}getTargetCount(e){return be.resolve(this.targetCount)}getTargetData(e,t){const r=this.si.get(t)||null;return be.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),be.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach((o=>{s.push(i.markPotentiallyOrphaned(e,o))})),be.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),be.resolve()}getMatchingKeysForTargetId(e,t){const r=this._i.Hr(t);return be.resolve(r)}containsKey(e,t){return be.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KM{constructor(e,t){this.ui={},this.overlays={},this.ci=new m_(0),this.li=!1,this.li=!0,this.hi=new t9,this.referenceDelegate=e(this),this.Pi=new s9(this),this.indexManager=new Hz,this.remoteDocumentCache=(function(i){return new r9(i)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new zz(t),this.Ii=new Jz(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new e9,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new n9(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){Ie("MemoryPersistence","Starting transaction:",e);const i=new o9(this.ci.next());return this.referenceDelegate.Ei(),r(i).next((s=>this.referenceDelegate.di(i).next((()=>s)))).toPromise().then((s=>(i.raiseOnCommittedEvent(),s)))}Ai(e,t){return be.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,t))))}}class o9 extends O8{constructor(e){super(),this.currentSequenceNumber=e}}class Tw{constructor(e){this.persistence=e,this.Ri=new bw,this.Vi=null}static mi(e){return new Tw(e)}get fi(){if(this.Vi)return this.Vi;throw je(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),be.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),be.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),be.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((i=>this.fi.add(i.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((i=>{i.forEach((s=>this.fi.add(s.toString())))})).next((()=>r.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return be.forEach(this.fi,(r=>{const i=Ue.fromPath(r);return this.gi(e,i).next((s=>{s||t.removeEntry(i,$e.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return be.or([()=>be.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Pm{constructor(e,t){this.persistence=e,this.pi=new Pl((r=>D8(r.path)),((r,i)=>r.isEqual(i))),this.garbageCollector=Kz(this,t)}static mi(e,t){return new Pm(e,t)}Ei(){}di(e){return be.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>t.next((i=>r+i))))}wr(e){let t=0;return this.pr(e,(r=>{t++})).next((()=>t))}pr(e,t){return be.forEach(this.pi,((r,i)=>this.br(e,r,i).next((s=>s?be.resolve():t(i)))))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.ii(e,(o=>this.br(e,o,t).next((l=>{l||(r++,s.removeEntry(o,$e.min()))})))).next((()=>s.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),be.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),be.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),be.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),be.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Wg(e.data.value)),t}br(e,t,r){return be.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const i=this.pi.get(t);return be.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ww{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=i}static As(e,t){let r=it(),i=it();for(const s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new ww(e,t.fromCache,r,i)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a9{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l9{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return DF()?8:k8(Kn())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,i){const s={result:null};return this.ys(e,t).next((o=>{s.result=o})).next((()=>{if(!s.result)return this.ws(e,t,i,r).next((o=>{s.result=o}))})).next((()=>{if(s.result)return;const o=new a9;return this.Ss(e,t,o).next((l=>{if(s.result=l,this.Vs)return this.bs(e,t,o,l.size)}))})).next((()=>s.result))}bs(e,t,r,i){return r.documentReadCount<this.fs?(Lc()<=nt.DEBUG&&Ie("QueryEngine","SDK will not create cache indexes for query:",Uc(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),be.resolve()):(Lc()<=nt.DEBUG&&Ie("QueryEngine","Query:",Uc(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.gs*i?(Lc()<=nt.DEBUG&&Ie("QueryEngine","The SDK decides to create cache indexes for query:",Uc(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Hi(t))):be.resolve())}ys(e,t){if(k2(t))return be.resolve(null);let r=Hi(t);return this.indexManager.getIndexType(e,r).next((i=>i===0?null:(t.limit!==null&&i===1&&(t=N0(t,null,"F"),r=Hi(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next((s=>{const o=it(...s);return this.ps.getDocuments(e,o).next((l=>this.indexManager.getMinOffset(e,r).next((u=>{const h=this.Ds(t,l);return this.Cs(t,h,o,u.readTime)?this.ys(e,N0(t,null,"F")):this.vs(e,h,t,u)}))))})))))}ws(e,t,r,i){return k2(t)||i.isEqual($e.min())?be.resolve(null):this.ps.getDocuments(e,r).next((s=>{const o=this.Ds(t,s);return this.Cs(t,o,r,i)?be.resolve(null):(Lc()<=nt.DEBUG&&Ie("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Uc(t)),this.vs(e,o,t,C8(i,$f)).next((l=>l)))}))}Ds(e,t){let r=new gn(SM(e));return t.forEach(((i,s)=>{T_(e,s)&&(r=r.add(s))})),r}Cs(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ss(e,t,r){return Lc()<=nt.DEBUG&&Ie("QueryEngine","Using full collection scan to execute query:",Uc(t)),this.ps.getDocumentsMatchingQuery(e,t,aa.min(),r)}vs(e,t,r,i){return this.ps.getDocumentsMatchingQuery(e,r,i).next((s=>(t.forEach((o=>{s=s.insert(o.key,o)})),s)))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ew="LocalStore",c9=3e8;class u9{constructor(e,t,r,i){this.persistence=e,this.Fs=t,this.serializer=i,this.Ms=new Vt(rt),this.xs=new Pl((s=>dw(s)),pw),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Qz(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function h9(n,e,t,r){return new u9(n,e,t,r)}async function GM(n,e){const t=qe(n);return await t.persistence.runTransaction("Handle user change","readonly",(r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next((s=>(i=s,t.Bs(e),t.mutationQueue.getAllMutationBatches(r)))).next((s=>{const o=[],l=[];let u=it();for(const h of i){o.push(h.batchId);for(const d of h.mutations)u=u.add(d.key)}for(const h of s){l.push(h.batchId);for(const d of h.mutations)u=u.add(d.key)}return t.localDocuments.getDocuments(r,u).next((h=>({Ls:h,removedBatchIds:o,addedBatchIds:l})))}))}))}function f9(n,e){const t=qe(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const i=e.batch.keys(),s=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(l,u,h,d){const g=h.batch,y=g.keys();let b=be.resolve();return y.forEach((w=>{b=b.next((()=>d.getEntry(u,w))).next((E=>{const x=h.docVersions.get(w);gt(x!==null,48541),E.version.compareTo(x)<0&&(g.applyToRemoteDocument(E,h),E.isValidDocument()&&(E.setReadTime(h.commitVersion),d.addEntry(E)))}))})),b.next((()=>l.mutationQueue.removeMutationBatch(u,g)))})(t,r,e,s).next((()=>s.apply(r))).next((()=>t.mutationQueue.performConsistencyCheck(r))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(l){let u=it();for(let h=0;h<l.mutationResults.length;++h)l.mutationResults[h].transformResults.length>0&&(u=u.add(l.batch.mutations[h].key));return u})(e)))).next((()=>t.localDocuments.getDocuments(r,i)))}))}function ZM(n){const e=qe(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function d9(n,e){const t=qe(n),r=e.snapshotVersion;let i=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(s=>{const o=t.Ns.newChangeBuffer({trackRemovals:!0});i=t.Ms;const l=[];e.targetChanges.forEach(((d,g)=>{const y=i.get(g);if(!y)return;l.push(t.Pi.removeMatchingKeys(s,d.removedDocuments,g).next((()=>t.Pi.addMatchingKeys(s,d.addedDocuments,g))));let b=y.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(g)!==null?b=b.withResumeToken(Dn.EMPTY_BYTE_STRING,$e.min()).withLastLimboFreeSnapshotVersion($e.min()):d.resumeToken.approximateByteSize()>0&&(b=b.withResumeToken(d.resumeToken,r)),i=i.insert(g,b),(function(E,x,C){return E.resumeToken.approximateByteSize()===0||x.snapshotVersion.toMicroseconds()-E.snapshotVersion.toMicroseconds()>=c9?!0:C.addedDocuments.size+C.modifiedDocuments.size+C.removedDocuments.size>0})(y,b,d)&&l.push(t.Pi.updateTargetData(s,b))}));let u=Bs(),h=it();if(e.documentUpdates.forEach((d=>{e.resolvedLimboDocuments.has(d)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(s,d))})),l.push(p9(s,o,e.documentUpdates).next((d=>{u=d.ks,h=d.qs}))),!r.isEqual($e.min())){const d=t.Pi.getLastRemoteSnapshotVersion(s).next((g=>t.Pi.setTargetsMetadata(s,s.currentSequenceNumber,r)));l.push(d)}return be.waitFor(l).next((()=>o.apply(s))).next((()=>t.localDocuments.getLocalViewOfDocuments(s,u,h))).next((()=>u))})).then((s=>(t.Ms=i,s)))}function p9(n,e,t){let r=it(),i=it();return t.forEach((s=>r=r.add(s))),e.getEntries(n,r).next((s=>{let o=Bs();return t.forEach(((l,u)=>{const h=s.get(l);u.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(l)),u.isNoDocument()&&u.version.isEqual($e.min())?(e.removeEntry(l,u.readTime),o=o.insert(l,u)):!h.isValidDocument()||u.version.compareTo(h.version)>0||u.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(u),o=o.insert(l,u)):Ie(Ew,"Ignoring outdated watch update for ",l,". Current version:",h.version," Watch version:",u.version)})),{ks:o,qs:i}}))}function g9(n,e){const t=qe(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=uw),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function m9(n,e){const t=qe(n);return t.persistence.runTransaction("Allocate target","readwrite",(r=>{let i;return t.Pi.getTargetData(r,e).next((s=>s?(i=s,be.resolve(i)):t.Pi.allocateTargetId(r).next((o=>(i=new Xo(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,i).next((()=>i)))))))})).then((r=>{const i=t.Ms.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r}))}async function B0(n,e,t){const r=qe(n),i=r.Ms.get(e),s=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",s,(o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!Lu(o))throw o;Ie(Ew,`Failed to update sequence numbers for target ${e}: ${o}`)}r.Ms=r.Ms.remove(e),r.xs.delete(i.target)}function q2(n,e,t){const r=qe(n);let i=$e.min(),s=it();return r.persistence.runTransaction("Execute query","readwrite",(o=>(function(u,h,d){const g=qe(u),y=g.xs.get(d);return y!==void 0?be.resolve(g.Ms.get(y)):g.Pi.getTargetData(h,d)})(r,o,Hi(e)).next((l=>{if(l)return i=l.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(o,l.targetId).next((u=>{s=u}))})).next((()=>r.Fs.getDocumentsMatchingQuery(o,e,t?i:$e.min(),t?s:it()))).next((l=>(_9(r,tz(e),l),{documents:l,Qs:s})))))}function _9(n,e,t){let r=n.Os.get(e)||$e.min();t.forEach(((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)})),n.Os.set(e,r)}class X2{constructor(){this.activeTargetIds=az()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class y9{constructor(){this.Mo=new X2,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new X2,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v9{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y2="ConnectivityMonitor";class K2{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Ie(Y2,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){Ie(Y2,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rg=null;function V0(){return rg===null?rg=(function(){return 268435456+Math.round(2147483648*Math.random())})():rg++,"0x"+rg.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const db="RestConnection",b9={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class T9{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${i}`,this.Wo=this.databaseId.database===xm?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Go(e,t,r,i,s){const o=V0(),l=this.zo(e,t.toUriEncodedString());Ie(db,`Sending RPC '${e}' ${o}:`,l,r);const u={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(u,i,s);const{host:h}=new URL(l),d=Mu(h);return this.Jo(e,l,u,r,d).then((g=>(Ie(db,`Received RPC '${e}' ${o}: `,g),g)),(g=>{throw cu(db,`RPC '${e}' ${o} failed with error: `,g,"url: ",l,"request:",r),g}))}Ho(e,t,r,i,s,o){return this.Go(e,t,r,i,s)}jo(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Nu})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((i,s)=>e[s]=i)),r&&r.headers.forEach(((i,s)=>e[s]=i))}zo(e,t){const r=b9[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w9{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zn="WebChannelConnection";class E9 extends T9{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,i,s){const o=V0();return new Promise(((l,u)=>{const h=new tM;h.setWithCredentials(!0),h.listenOnce(nM.COMPLETE,(()=>{try{switch(h.getLastErrorCode()){case $g.NO_ERROR:const g=h.getResponseJson();Ie(zn,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(g)),l(g);break;case $g.TIMEOUT:Ie(zn,`RPC '${e}' ${o} timed out`),u(new Le(Te.DEADLINE_EXCEEDED,"Request time out"));break;case $g.HTTP_ERROR:const y=h.getStatus();if(Ie(zn,`RPC '${e}' ${o} failed with status:`,y,"response text:",h.getResponseText()),y>0){let b=h.getResponseJson();Array.isArray(b)&&(b=b[0]);const w=b?.error;if(w&&w.status&&w.message){const E=(function(C){const M=C.toLowerCase().replace(/_/g,"-");return Object.values(Te).indexOf(M)>=0?M:Te.UNKNOWN})(w.status);u(new Le(E,w.message))}else u(new Le(Te.UNKNOWN,"Server responded with status "+h.getStatus()))}else u(new Le(Te.UNAVAILABLE,"Connection failed."));break;default:je(9055,{l_:e,streamId:o,h_:h.getLastErrorCode(),P_:h.getLastError()})}}finally{Ie(zn,`RPC '${e}' ${o} completed.`)}}));const d=JSON.stringify(i);Ie(zn,`RPC '${e}' ${o} sending request:`,i),h.send(t,"POST",d,r,15)}))}T_(e,t,r){const i=V0(),s=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=sM(),l=iM(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(u.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(u.useFetchStreams=!0),this.jo(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;const d=s.join("");Ie(zn,`Creating RPC '${e}' stream ${i}: ${d}`,u);const g=o.createWebChannel(d,u);this.I_(g);let y=!1,b=!1;const w=new w9({Yo:x=>{b?Ie(zn,`Not sending because RPC '${e}' stream ${i} is closed:`,x):(y||(Ie(zn,`Opening RPC '${e}' stream ${i} transport.`),g.open(),y=!0),Ie(zn,`RPC '${e}' stream ${i} sending:`,x),g.send(x))},Zo:()=>g.close()}),E=(x,C,M)=>{x.listen(C,(O=>{try{M(O)}catch(V){setTimeout((()=>{throw V}),0)}}))};return E(g,ff.EventType.OPEN,(()=>{b||(Ie(zn,`RPC '${e}' stream ${i} transport opened.`),w.o_())})),E(g,ff.EventType.CLOSE,(()=>{b||(b=!0,Ie(zn,`RPC '${e}' stream ${i} transport closed`),w.a_(),this.E_(g))})),E(g,ff.EventType.ERROR,(x=>{b||(b=!0,cu(zn,`RPC '${e}' stream ${i} transport errored. Name:`,x.name,"Message:",x.message),w.a_(new Le(Te.UNAVAILABLE,"The operation could not be completed")))})),E(g,ff.EventType.MESSAGE,(x=>{if(!b){const C=x.data[0];gt(!!C,16349);const M=C,O=M?.error||M[0]?.error;if(O){Ie(zn,`RPC '${e}' stream ${i} received error:`,O);const V=O.status;let H=(function(I){const N=tn[I];if(N!==void 0)return FM(N)})(V),G=O.message;H===void 0&&(H=Te.INTERNAL,G="Unknown error status: "+V+" with message "+O.message),b=!0,w.a_(new Le(H,G)),g.close()}else Ie(zn,`RPC '${e}' stream ${i} received:`,C),w.u_(C)}})),E(l,rM.STAT_EVENT,(x=>{x.stat===C0.PROXY?Ie(zn,`RPC '${e}' stream ${i} detected buffering proxy`):x.stat===C0.NOPROXY&&Ie(zn,`RPC '${e}' stream ${i} detected no buffering proxy`)})),setTimeout((()=>{w.__()}),0),w}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}function pb(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A_(n){return new Rz(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QM{constructor(e,t,r=1e3,i=1.5,s=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=i,this.R_=s,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),i=Math.max(0,t-r);i>0&&Ie("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G2="PersistentStream";class JM{constructor(e,t,r,i,s,o,l,u){this.Mi=e,this.S_=r,this.b_=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=l,this.listener=u,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new QM(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===Te.RESOURCE_EXHAUSTED?(Fs(t.toString()),Fs("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===Te.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,i])=>{this.D_===t&&this.G_(r,i)}),(r=>{e((()=>{const i=new Le(Te.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(i)}))}))}G_(e,t){const r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((i=>{r((()=>this.z_(i)))})),this.stream.onMessage((i=>{r((()=>++this.F_==1?this.J_(i):this.onNext(i)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return Ie(G2,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(Ie(G2,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class x9 extends JM{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=Pz(this.serializer,e),r=(function(s){if(!("targetChange"in s))return $e.min();const o=s.targetChange;return o.targetIds&&o.targetIds.length?$e.min():o.readTime?$i(o.readTime):$e.min()})(e);return this.listener.H_(t,r)}Y_(e){const t={};t.database=F0(this.serializer),t.addTarget=(function(s,o){let l;const u=o.target;if(l=k0(u)?{documents:kz(s,u)}:{query:Nz(s,u).ft},l.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){l.resumeToken=zM(s,o.resumeToken);const h=D0(s,o.expectedCount);h!==null&&(l.expectedCount=h)}else if(o.snapshotVersion.compareTo($e.min())>0){l.readTime=Im(s,o.snapshotVersion.toTimestamp());const h=D0(s,o.expectedCount);h!==null&&(l.expectedCount=h)}return l})(this.serializer,e);const r=Lz(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){const t={};t.database=F0(this.serializer),t.removeTarget=e,this.q_(t)}}class A9 extends JM{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return gt(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,gt(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){gt(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=Oz(e.writeResults,e.commitTime),r=$i(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=F0(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((r=>Mz(this.serializer,r)))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S9{}class R9 extends S9{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new Le(Te.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,o])=>this.connection.Go(e,L0(t,r),i,s,o))).catch((s=>{throw s.name==="FirebaseError"?(s.code===Te.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new Le(Te.UNKNOWN,s.toString())}))}Ho(e,t,r,i,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,l])=>this.connection.Ho(e,L0(t,r),i,o,l,s))).catch((o=>{throw o.name==="FirebaseError"?(o.code===Te.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Le(Te.UNKNOWN,o.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class C9{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Fs(t),this.aa=!1):Ie("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tl="RemoteStore";class I9{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=s,this.Aa.Oo((o=>{r.enqueueAndForget((async()=>{Ol(this)&&(Ie(Tl,"Restarting streams for network reachability change."),await(async function(u){const h=qe(u);h.Ea.add(4),await bd(h),h.Ra.set("Unknown"),h.Ea.delete(4),await S_(h)})(this))}))})),this.Ra=new C9(r,i)}}async function S_(n){if(Ol(n))for(const e of n.da)await e(!0)}async function bd(n){for(const e of n.da)await e(!1)}function eO(n,e){const t=qe(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Rw(t)?Sw(t):Uu(t).O_()&&Aw(t,e))}function xw(n,e){const t=qe(n),r=Uu(t);t.Ia.delete(e),r.O_()&&tO(t,e),t.Ia.size===0&&(r.O_()?r.L_():Ol(t)&&t.Ra.set("Unknown"))}function Aw(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo($e.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Uu(n).Y_(e)}function tO(n,e){n.Va.Ue(e),Uu(n).Z_(e)}function Sw(n){n.Va=new Ez({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Uu(n).start(),n.Ra.ua()}function Rw(n){return Ol(n)&&!Uu(n).x_()&&n.Ia.size>0}function Ol(n){return qe(n).Ea.size===0}function nO(n){n.Va=void 0}async function P9(n){n.Ra.set("Online")}async function M9(n){n.Ia.forEach(((e,t)=>{Aw(n,e)}))}async function O9(n,e){nO(n),Rw(n)?(n.Ra.ha(e),Sw(n)):n.Ra.set("Unknown")}async function k9(n,e,t){if(n.Ra.set("Online"),e instanceof VM&&e.state===2&&e.cause)try{await(async function(i,s){const o=s.cause;for(const l of s.targetIds)i.Ia.has(l)&&(await i.remoteSyncer.rejectListen(l,o),i.Ia.delete(l),i.Va.removeTarget(l))})(n,e)}catch(r){Ie(Tl,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Mm(n,r)}else if(e instanceof Yg?n.Va.Ze(e):e instanceof BM?n.Va.st(e):n.Va.tt(e),!t.isEqual($e.min()))try{const r=await ZM(n.localStore);t.compareTo(r)>=0&&await(function(s,o){const l=s.Va.Tt(o);return l.targetChanges.forEach(((u,h)=>{if(u.resumeToken.approximateByteSize()>0){const d=s.Ia.get(h);d&&s.Ia.set(h,d.withResumeToken(u.resumeToken,o))}})),l.targetMismatches.forEach(((u,h)=>{const d=s.Ia.get(u);if(!d)return;s.Ia.set(u,d.withResumeToken(Dn.EMPTY_BYTE_STRING,d.snapshotVersion)),tO(s,u);const g=new Xo(d.target,u,h,d.sequenceNumber);Aw(s,g)})),s.remoteSyncer.applyRemoteEvent(l)})(n,t)}catch(r){Ie(Tl,"Failed to raise snapshot:",r),await Mm(n,r)}}async function Mm(n,e,t){if(!Lu(e))throw e;n.Ea.add(1),await bd(n),n.Ra.set("Offline"),t||(t=()=>ZM(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{Ie(Tl,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await S_(n)}))}function rO(n,e){return e().catch((t=>Mm(n,t,e)))}async function R_(n){const e=qe(n),t=ha(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:uw;for(;N9(e);)try{const i=await g9(e.localStore,r);if(i===null){e.Ta.length===0&&t.L_();break}r=i.batchId,D9(e,i)}catch(i){await Mm(e,i)}iO(e)&&sO(e)}function N9(n){return Ol(n)&&n.Ta.length<10}function D9(n,e){n.Ta.push(e);const t=ha(n);t.O_()&&t.X_&&t.ea(e.mutations)}function iO(n){return Ol(n)&&!ha(n).x_()&&n.Ta.length>0}function sO(n){ha(n).start()}async function L9(n){ha(n).ra()}async function U9(n){const e=ha(n);for(const t of n.Ta)e.ea(t.mutations)}async function F9(n,e,t){const r=n.Ta.shift(),i=_w.from(r,e,t);await rO(n,(()=>n.remoteSyncer.applySuccessfulWrite(i))),await R_(n)}async function B9(n,e){e&&ha(n).X_&&await(async function(r,i){if((function(o){return bz(o)&&o!==Te.ABORTED})(i.code)){const s=r.Ta.shift();ha(r).B_(),await rO(r,(()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i))),await R_(r)}})(n,e),iO(n)&&sO(n)}async function Z2(n,e){const t=qe(n);t.asyncQueue.verifyOperationInProgress(),Ie(Tl,"RemoteStore received new credentials");const r=Ol(t);t.Ea.add(3),await bd(t),r&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await S_(t)}async function V9(n,e){const t=qe(n);e?(t.Ea.delete(2),await S_(t)):e||(t.Ea.add(2),await bd(t),t.Ra.set("Unknown"))}function Uu(n){return n.ma||(n.ma=(function(t,r,i){const s=qe(t);return s.sa(),new x9(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)})(n.datastore,n.asyncQueue,{Xo:P9.bind(null,n),t_:M9.bind(null,n),r_:O9.bind(null,n),H_:k9.bind(null,n)}),n.da.push((async e=>{e?(n.ma.B_(),Rw(n)?Sw(n):n.Ra.set("Unknown")):(await n.ma.stop(),nO(n))}))),n.ma}function ha(n){return n.fa||(n.fa=(function(t,r,i){const s=qe(t);return s.sa(),new A9(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:L9.bind(null,n),r_:B9.bind(null,n),ta:U9.bind(null,n),na:F9.bind(null,n)}),n.da.push((async e=>{e?(n.fa.B_(),await R_(n)):(await n.fa.stop(),n.Ta.length>0&&(Ie(Tl,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cw{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new na,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((o=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){const o=Date.now()+r,l=new Cw(e,t,o,i,s);return l.start(r),l}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Le(Te.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Iw(n,e){if(Fs("AsyncQueue",`${e}: ${n}`),Lu(n))return new Le(Te.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nu{static emptySet(e){return new nu(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||Ue.comparator(t.key,r.key):(t,r)=>Ue.comparator(t.key,r.key),this.keyedMap=df(),this.sortedSet=new Vt(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,r)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof nu)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new nu;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q2{constructor(){this.ga=new Vt(Ue.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):je(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,r)=>{e.push(r)})),e}}class pu{constructor(e,t,r,i,s,o,l,u,h){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=l,this.excludesMetadataChanges=u,this.hasCachedResults=h}static fromInitialDocuments(e,t,r,i,s){const o=[];return t.forEach((l=>{o.push({type:0,doc:l})})),new pu(e,t,nu.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&b_(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z9{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class j9{constructor(){this.queries=J2(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const i=qe(t),s=i.queries;i.queries=J2(),s.forEach(((o,l)=>{for(const u of l.Sa)u.onError(r)}))})(this,new Le(Te.ABORTED,"Firestore shutting down"))}}function J2(){return new Pl((n=>AM(n)),b_)}async function H9(n,e){const t=qe(n);let r=3;const i=e.query;let s=t.queries.get(i);s?!s.ba()&&e.Da()&&(r=2):(s=new z9,r=e.Da()?0:1);try{switch(r){case 0:s.wa=await t.onListen(i,!0);break;case 1:s.wa=await t.onListen(i,!1);break;case 2:await t.onFirstRemoteStoreListen(i)}}catch(o){const l=Iw(o,`Initialization of query '${Uc(e.query)}' failed`);return void e.onError(l)}t.queries.set(i,s),s.Sa.push(e),e.va(t.onlineState),s.wa&&e.Fa(s.wa)&&Pw(t)}async function $9(n,e){const t=qe(n),r=e.query;let i=3;const s=t.queries.get(r);if(s){const o=s.Sa.indexOf(e);o>=0&&(s.Sa.splice(o,1),s.Sa.length===0?i=e.Da()?0:1:!s.ba()&&e.Da()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function W9(n,e){const t=qe(n);let r=!1;for(const i of e){const s=i.query,o=t.queries.get(s);if(o){for(const l of o.Sa)l.Fa(i)&&(r=!0);o.wa=i}}r&&Pw(t)}function q9(n,e,t){const r=qe(n),i=r.queries.get(e);if(i)for(const s of i.Sa)s.onError(t);r.queries.delete(e)}function Pw(n){n.Ca.forEach((e=>{e.next()}))}var z0,e3;(e3=z0||(z0={})).Ma="default",e3.Cache="cache";class X9{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new pu(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=pu.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==z0.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oO{constructor(e){this.key=e}}class aO{constructor(e){this.key=e}}class Y9{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=it(),this.mutatedKeys=it(),this.eu=SM(e),this.tu=new nu(this.eu)}get nu(){return this.Ya}ru(e,t){const r=t?t.iu:new Q2,i=t?t.tu:this.tu;let s=t?t.mutatedKeys:this.mutatedKeys,o=i,l=!1;const u=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,h=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(((d,g)=>{const y=i.get(d),b=T_(this.query,g)?g:null,w=!!y&&this.mutatedKeys.has(y.key),E=!!b&&(b.hasLocalMutations||this.mutatedKeys.has(b.key)&&b.hasCommittedMutations);let x=!1;y&&b?y.data.isEqual(b.data)?w!==E&&(r.track({type:3,doc:b}),x=!0):this.su(y,b)||(r.track({type:2,doc:b}),x=!0,(u&&this.eu(b,u)>0||h&&this.eu(b,h)<0)&&(l=!0)):!y&&b?(r.track({type:0,doc:b}),x=!0):y&&!b&&(r.track({type:1,doc:y}),x=!0,(u||h)&&(l=!0)),x&&(b?(o=o.add(b),s=E?s.add(d):s.delete(d)):(o=o.delete(d),s=s.delete(d)))})),this.query.limit!==null)for(;o.size>this.query.limit;){const d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),s=s.delete(d.key),r.track({type:1,doc:d})}return{tu:o,iu:r,Cs:l,mutatedKeys:s}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){const s=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort(((d,g)=>(function(b,w){const E=x=>{switch(x){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return je(20277,{Rt:x})}};return E(b)-E(w)})(d.type,g.type)||this.eu(d.doc,g.doc))),this.ou(r),i=i??!1;const l=t&&!i?this._u():[],u=this.Xa.size===0&&this.current&&!i?1:0,h=u!==this.Za;return this.Za=u,o.length!==0||h?{snapshot:new pu(this.query,e.tu,s,o,e.mutatedKeys,u===0,h,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:l}:{au:l}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Q2,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=it(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const t=[];return e.forEach((r=>{this.Xa.has(r)||t.push(new aO(r))})),this.Xa.forEach((r=>{e.has(r)||t.push(new oO(r))})),t}cu(e){this.Ya=e.Qs,this.Xa=it();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return pu.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Mw="SyncEngine";class K9{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class G9{constructor(e){this.key=e,this.hu=!1}}class Z9{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new Pl((l=>AM(l)),b_),this.Iu=new Map,this.Eu=new Set,this.du=new Vt(Ue.comparator),this.Au=new Map,this.Ru=new bw,this.Vu={},this.mu=new Map,this.fu=du.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function Q9(n,e,t=!0){const r=dO(n);let i;const s=r.Tu.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.lu()):i=await lO(r,e,t,!0),i}async function J9(n,e){const t=dO(n);await lO(t,e,!0,!1)}async function lO(n,e,t,r){const i=await m9(n.localStore,Hi(e)),s=i.targetId,o=n.sharedClientState.addLocalQueryTarget(s,t);let l;return r&&(l=await ej(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&eO(n.remoteStore,i),l}async function ej(n,e,t,r,i){n.pu=(g,y,b)=>(async function(E,x,C,M){let O=x.view.ru(C);O.Cs&&(O=await q2(E.localStore,x.query,!1).then((({documents:D})=>x.view.ru(D,O))));const V=M&&M.targetChanges.get(x.targetId),H=M&&M.targetMismatches.get(x.targetId)!=null,G=x.view.applyChanges(O,E.isPrimaryClient,V,H);return n3(E,x.targetId,G.au),G.snapshot})(n,g,y,b);const s=await q2(n.localStore,e,!0),o=new Y9(e,s.Qs),l=o.ru(s.documents),u=vd.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),h=o.applyChanges(l,n.isPrimaryClient,u);n3(n,t,h.au);const d=new K9(e,t,o);return n.Tu.set(e,d),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),h.snapshot}async function tj(n,e,t){const r=qe(n),i=r.Tu.get(e),s=r.Iu.get(i.targetId);if(s.length>1)return r.Iu.set(i.targetId,s.filter((o=>!b_(o,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await B0(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),t&&xw(r.remoteStore,i.targetId),j0(r,i.targetId)})).catch(Du)):(j0(r,i.targetId),await B0(r.localStore,i.targetId,!0))}async function nj(n,e){const t=qe(n),r=t.Tu.get(e),i=t.Iu.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),xw(t.remoteStore,r.targetId))}async function rj(n,e,t){const r=uj(n);try{const i=await(function(o,l){const u=qe(o),h=Ot.now(),d=l.reduce(((b,w)=>b.add(w.key)),it());let g,y;return u.persistence.runTransaction("Locally write mutations","readwrite",(b=>{let w=Bs(),E=it();return u.Ns.getEntries(b,d).next((x=>{w=x,w.forEach(((C,M)=>{M.isValidDocument()||(E=E.add(C))}))})).next((()=>u.localDocuments.getOverlayedDocuments(b,w))).next((x=>{g=x;const C=[];for(const M of l){const O=gz(M,g.get(M.key).overlayedDocument);O!=null&&C.push(new Ml(M.key,O,yM(O.value.mapValue),ks.exists(!0)))}return u.mutationQueue.addMutationBatch(b,h,C,l)})).next((x=>{y=x;const C=x.applyToLocalDocumentSet(g,E);return u.documentOverlayCache.saveOverlays(b,x.batchId,C)}))})).then((()=>({batchId:y.batchId,changes:CM(g)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),(function(o,l,u){let h=o.Vu[o.currentUser.toKey()];h||(h=new Vt(rt)),h=h.insert(l,u),o.Vu[o.currentUser.toKey()]=h})(r,i.batchId,t),await Td(r,i.changes),await R_(r.remoteStore)}catch(i){const s=Iw(i,"Failed to persist write");t.reject(s)}}async function cO(n,e){const t=qe(n);try{const r=await d9(t.localStore,e);e.targetChanges.forEach(((i,s)=>{const o=t.Au.get(s);o&&(gt(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?o.hu=!0:i.modifiedDocuments.size>0?gt(o.hu,14607):i.removedDocuments.size>0&&(gt(o.hu,42227),o.hu=!1))})),await Td(t,r,e)}catch(r){await Du(r)}}function t3(n,e,t){const r=qe(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const i=[];r.Tu.forEach(((s,o)=>{const l=o.view.va(e);l.snapshot&&i.push(l.snapshot)})),(function(o,l){const u=qe(o);u.onlineState=l;let h=!1;u.queries.forEach(((d,g)=>{for(const y of g.Sa)y.va(l)&&(h=!0)})),h&&Pw(u)})(r.eventManager,e),i.length&&r.Pu.H_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function ij(n,e,t){const r=qe(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.Au.get(e),s=i&&i.key;if(s){let o=new Vt(Ue.comparator);o=o.insert(s,Yn.newNoDocument(s,$e.min()));const l=it().add(s),u=new x_($e.min(),new Map,new Vt(rt),o,l);await cO(r,u),r.du=r.du.remove(s),r.Au.delete(e),Ow(r)}else await B0(r.localStore,e,!1).then((()=>j0(r,e,t))).catch(Du)}async function sj(n,e){const t=qe(n),r=e.batch.batchId;try{const i=await f9(t.localStore,e);hO(t,r,null),uO(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Td(t,i)}catch(i){await Du(i)}}async function oj(n,e,t){const r=qe(n);try{const i=await(function(o,l){const u=qe(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",(h=>{let d;return u.mutationQueue.lookupMutationBatch(h,l).next((g=>(gt(g!==null,37113),d=g.keys(),u.mutationQueue.removeMutationBatch(h,g)))).next((()=>u.mutationQueue.performConsistencyCheck(h))).next((()=>u.documentOverlayCache.removeOverlaysForBatchId(h,d,l))).next((()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,d))).next((()=>u.localDocuments.getDocuments(h,d)))}))})(r.localStore,e);hO(r,e,t),uO(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Td(r,i)}catch(i){await Du(i)}}function uO(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function hO(n,e,t){const r=qe(n);let i=r.Vu[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Vu[r.currentUser.toKey()]=i}}function j0(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach((r=>{n.Ru.containsKey(r)||fO(n,r)}))}function fO(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(xw(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),Ow(n))}function n3(n,e,t){for(const r of t)r instanceof oO?(n.Ru.addReference(r.key,e),aj(n,r)):r instanceof aO?(Ie(Mw,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||fO(n,r.key)):je(19791,{wu:r})}function aj(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(Ie(Mw,"New document in limbo: "+t),n.Eu.add(r),Ow(n))}function Ow(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new Ue(Ut.fromString(e)),r=n.fu.next();n.Au.set(r,new G9(t)),n.du=n.du.insert(t,r),eO(n.remoteStore,new Xo(Hi(gw(t.path)),r,"TargetPurposeLimboResolution",m_.ce))}}async function Td(n,e,t){const r=qe(n),i=[],s=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach(((l,u)=>{o.push(r.pu(u,e,t).then((h=>{if((h||t)&&r.isPrimaryClient){const d=h?!h.fromCache:t?.targetChanges.get(u.targetId)?.current;r.sharedClientState.updateQueryState(u.targetId,d?"current":"not-current")}if(h){i.push(h);const d=ww.As(u.targetId,h);s.push(d)}})))})),await Promise.all(o),r.Pu.H_(i),await(async function(u,h){const d=qe(u);try{await d.persistence.runTransaction("notifyLocalViewChanges","readwrite",(g=>be.forEach(h,(y=>be.forEach(y.Es,(b=>d.persistence.referenceDelegate.addReference(g,y.targetId,b))).next((()=>be.forEach(y.ds,(b=>d.persistence.referenceDelegate.removeReference(g,y.targetId,b)))))))))}catch(g){if(!Lu(g))throw g;Ie(Ew,"Failed to update sequence numbers: "+g)}for(const g of h){const y=g.targetId;if(!g.fromCache){const b=d.Ms.get(y),w=b.snapshotVersion,E=b.withLastLimboFreeSnapshotVersion(w);d.Ms=d.Ms.insert(y,E)}}})(r.localStore,s))}async function lj(n,e){const t=qe(n);if(!t.currentUser.isEqual(e)){Ie(Mw,"User change. New user:",e.toKey());const r=await GM(t.localStore,e);t.currentUser=e,(function(s,o){s.mu.forEach((l=>{l.forEach((u=>{u.reject(new Le(Te.CANCELLED,o))}))})),s.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Td(t,r.Ls)}}function cj(n,e){const t=qe(n),r=t.Au.get(e);if(r&&r.hu)return it().add(r.key);{let i=it();const s=t.Iu.get(e);if(!s)return i;for(const o of s){const l=t.Tu.get(o);i=i.unionWith(l.view.nu)}return i}}function dO(n){const e=qe(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=cO.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=cj.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=ij.bind(null,e),e.Pu.H_=W9.bind(null,e.eventManager),e.Pu.yu=q9.bind(null,e.eventManager),e}function uj(n){const e=qe(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=sj.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=oj.bind(null,e),e}class Om{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=A_(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return h9(this.persistence,new l9,e.initialUser,this.serializer)}Cu(e){return new KM(Tw.mi,this.serializer)}Du(e){return new y9}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Om.provider={build:()=>new Om};class hj extends Om{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){gt(this.persistence.referenceDelegate instanceof Pm,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new Xz(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?lr.withCacheSize(this.cacheSizeBytes):lr.DEFAULT;return new KM((r=>Pm.mi(r,t)),this.serializer)}}class H0{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>t3(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=lj.bind(null,this.syncEngine),await V9(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new j9})()}createDatastore(e){const t=A_(e.databaseInfo.databaseId),r=(function(s){return new E9(s)})(e.databaseInfo);return(function(s,o,l,u){return new R9(s,o,l,u)})(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return(function(r,i,s,o,l){return new I9(r,i,s,o,l)})(this.localStore,this.datastore,e.asyncQueue,(t=>t3(this.syncEngine,t,0)),(function(){return K2.v()?new K2:new v9})())}createSyncEngine(e,t){return(function(i,s,o,l,u,h,d){const g=new Z9(i,s,o,l,u,h);return d&&(g.gu=!0),g})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const r=qe(t);Ie(Tl,"RemoteStore shutting down."),r.Ea.add(5),await bd(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}H0.provider={build:()=>new H0};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fj{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Fs("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fa="FirestoreClient";class dj{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Wn.UNAUTHENTICATED,this.clientId=lw.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,(async o=>{Ie(fa,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(r,(o=>(Ie(fa,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new na;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Iw(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function gb(n,e){n.asyncQueue.verifyOperationInProgress(),Ie(fa,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener((async i=>{r.isEqual(i)||(await GM(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function r3(n,e){n.asyncQueue.verifyOperationInProgress();const t=await pj(n);Ie(fa,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((r=>Z2(e.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,i)=>Z2(e.remoteStore,i))),n._onlineComponents=e}async function pj(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){Ie(fa,"Using user provided OfflineComponentProvider");try{await gb(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(i){return i.name==="FirebaseError"?i.code===Te.FAILED_PRECONDITION||i.code===Te.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(t))throw t;cu("Error using user provided cache. Falling back to memory cache: "+t),await gb(n,new Om)}}else Ie(fa,"Using default OfflineComponentProvider"),await gb(n,new hj(void 0));return n._offlineComponents}async function pO(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(Ie(fa,"Using user provided OnlineComponentProvider"),await r3(n,n._uninitializedComponentsProvider._online)):(Ie(fa,"Using default OnlineComponentProvider"),await r3(n,new H0))),n._onlineComponents}function gj(n){return pO(n).then((e=>e.syncEngine))}async function mj(n){const e=await pO(n),t=e.eventManager;return t.onListen=Q9.bind(null,e.syncEngine),t.onUnlisten=tj.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=J9.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=nj.bind(null,e.syncEngine),t}function _j(n,e,t={}){const r=new na;return n.asyncQueue.enqueueAndForget((async()=>(function(s,o,l,u,h){const d=new fj({next:y=>{d.Nu(),o.enqueueAndForget((()=>$9(s,g)));const b=y.docs.has(l);!b&&y.fromCache?h.reject(new Le(Te.UNAVAILABLE,"Failed to get document because the client is offline.")):b&&y.fromCache&&u&&u.source==="server"?h.reject(new Le(Te.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(y)},error:y=>h.reject(y)}),g=new X9(gw(l.path),d,{includeMetadataChanges:!0,qa:!0});return H9(s,g)})(await mj(n),n.asyncQueue,e,t,r))),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gO(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i3=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mO="firestore.googleapis.com",s3=!0;class o3{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new Le(Te.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=mO,this.ssl=s3}else this.host=e.host,this.ssl=e.ssl??s3;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=YM;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Wz)throw new Le(Te.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}R8("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=gO(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new Le(Te.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new Le(Te.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new Le(Te.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,i){return r.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class kw{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new o3({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Le(Te.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Le(Te.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new o3(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new m8;switch(r.type){case"firstParty":return new b8(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Le(Te.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const r=i3.get(t);r&&(Ie("ComponentProvider","Removing Datastore"),i3.delete(t),r.terminate())})(this),Promise.resolve()}}function yj(n,e,t,r={}){n=Hf(n,kw);const i=Mu(e),s=n._getSettings(),o={...s,emulatorOptions:n._getEmulatorOptions()},l=`${e}:${t}`;i&&(fP(`https://${l}`),dP("Firestore",!0)),s.host!==mO&&s.host!==l&&cu("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const u={...s,host:l,ssl:i,emulatorOptions:r};if(!ml(u,o)&&(n._setSettings(u),r.mockUserToken)){let h,d;if(typeof r.mockUserToken=="string")h=r.mockUserToken,d=Wn.MOCK_USER;else{h=SF(r.mockUserToken,n._app?.options.projectId);const g=r.mockUserToken.sub||r.mockUserToken.user_id;if(!g)throw new Le(Te.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");d=new Wn(g)}n._authCredentials=new _8(new aM(h,d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nw{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Nw(this.firestore,e,this._query)}}class xn{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Zf(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new xn(this.firestore,e,this._key)}toJSON(){return{type:xn._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(_d(t,xn._jsonSchema))return new xn(e,r||null,new Ue(Ut.fromString(t.referencePath)))}}xn._jsonSchemaVersion="firestore/documentReference/1.0",xn._jsonSchema={type:sn("string",xn._jsonSchemaVersion),referencePath:sn("string")};class Zf extends Nw{constructor(e,t,r){super(e,t,gw(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new xn(this.firestore,null,new Ue(e))}withConverter(e){return new Zf(this.firestore,e,this._path)}}function gu(n,e,...t){if(n=ur(n),arguments.length===1&&(e=lw.newId()),S8("doc","path",e),n instanceof kw){const r=Ut.fromString(e,...t);return b2(r),new xn(n,null,new Ue(r))}{if(!(n instanceof xn||n instanceof Zf))throw new Le(Te.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Ut.fromString(e,...t));return b2(r),new xn(n.firestore,n instanceof Zf?n.converter:null,new Ue(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a3="AsyncQueue";class l3{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new QM(this,"async_queue_retry"),this._c=()=>{const r=pb();r&&Ie(a3,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=pb();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=pb();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new na;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Lu(e))throw e;Ie(a3,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,Fs("INTERNAL UNHANDLED ERROR: ",c3(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const i=Cw.createAndSchedule(this,e,t,r,(s=>this.hc(s)));return this.tc.push(i),i}uc(){this.nc&&je(47125,{Pc:c3(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,r)=>t.targetTimeMs-r.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function c3(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class Dw extends kw{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new l3,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new l3(e),this._firestoreClient=void 0,await e}}}function vj(n,e){const t=typeof n=="object"?n:_P(),r=typeof n=="string"?n:xm,i=ZT(t,"firestore").getImmediate({identifier:r});if(!i._initialized){const s=xF("firestore");s&&yj(i,...s)}return i}function _O(n){if(n._terminated)throw new Le(Te.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||bj(n),n._firestoreClient}function bj(n){const e=n._freezeSettings(),t=(function(i,s,o,l){return new F8(i,s,o,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,gO(l.experimentalLongPollingOptions),l.useFetchStreams,l.isUsingEmulator)})(n._databaseId,n._app?.options.appId||"",n._persistenceKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new dj(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(i){const s=i?._online.build();return{_offline:i?._offline.build(s),_online:s}})(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new jr(Dn.fromBase64String(e))}catch(t){throw new Le(Te.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new jr(Dn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:jr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(_d(e,jr._jsonSchema))return jr.fromBase64String(e.bytes)}}jr._jsonSchemaVersion="firestore/bytes/1.0",jr._jsonSchema={type:sn("string",jr._jsonSchemaVersion),bytes:sn("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lw{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new Le(Te.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new kn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uw{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wi{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Le(Te.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Le(Te.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return rt(this._lat,e._lat)||rt(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Wi._jsonSchemaVersion}}static fromJSON(e){if(_d(e,Wi._jsonSchema))return new Wi(e.latitude,e.longitude)}}Wi._jsonSchemaVersion="firestore/geoPoint/1.0",Wi._jsonSchema={type:sn("string",Wi._jsonSchemaVersion),latitude:sn("number"),longitude:sn("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qi{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0})(this._values,e._values)}toJSON(){return{type:qi._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(_d(e,qi._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new qi(e.vectorValues);throw new Le(Te.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}qi._jsonSchemaVersion="firestore/vectorValue/1.0",qi._jsonSchema={type:sn("string",qi._jsonSchemaVersion),vectorValues:sn("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tj=/^__.*__$/;class wj{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Ml(e,this.data,this.fieldMask,t,this.fieldTransforms):new yd(e,this.data,t,this.fieldTransforms)}}function yO(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw je(40011,{Ac:n})}}class Fw{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.Rc(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Fw({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return km(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(yO(this.Ac)&&Tj.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class Ej{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||A_(e)}Cc(e,t,r,i=!1){return new Fw({Ac:e,methodName:t,Dc:r,path:kn.emptyPath(),fc:!1,bc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function xj(n){const e=n._freezeSettings(),t=A_(n._databaseId);return new Ej(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Aj(n,e,t,r,i,s={}){const o=n.Cc(s.merge||s.mergeFields?2:0,e,t,i);wO("Data must be an object, but it was:",o,r);const l=bO(r,o);let u,h;if(s.merge)u=new li(o.fieldMask),h=o.fieldTransforms;else if(s.mergeFields){const d=[];for(const g of s.mergeFields){const y=Sj(e,g,t);if(!o.contains(y))throw new Le(Te.INVALID_ARGUMENT,`Field '${y}' is specified in your field mask but missing from your input data.`);Cj(d,y)||d.push(y)}u=new li(d),h=o.fieldTransforms.filter((g=>u.covers(g.field)))}else u=null,h=o.fieldTransforms;return new wj(new zr(l),u,h)}class Bw extends Uw{_toFieldTransform(e){return new hz(e.path,new Yf)}isEqual(e){return e instanceof Bw}}function vO(n,e){if(TO(n=ur(n)))return wO("Unsupported field value:",e,n),bO(n,e);if(n instanceof Uw)return(function(r,i){if(!yO(i.Ac))throw i.Sc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Sc(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,i){const s=[];let o=0;for(const l of r){let u=vO(l,i.wc(o));u==null&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}})(n,e)}return(function(r,i){if((r=ur(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return lz(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const s=Ot.fromDate(r);return{timestampValue:Im(i.serializer,s)}}if(r instanceof Ot){const s=new Ot(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Im(i.serializer,s)}}if(r instanceof Wi)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof jr)return{bytesValue:zM(i.serializer,r._byteString)};if(r instanceof xn){const s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:vw(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof qi)return(function(o,l){return{mapValue:{fields:{[mM]:{stringValue:_M},[Am]:{arrayValue:{values:o.toArray().map((h=>{if(typeof h!="number")throw l.Sc("VectorValues must only contain numeric values.");return mw(l.serializer,h)}))}}}}}})(r,i);throw i.Sc(`Unsupported field value: ${cw(r)}`)})(n,e)}function bO(n,e){const t={};return uM(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Il(n,((r,i)=>{const s=vO(i,e.mc(r));s!=null&&(t[r]=s)})),{mapValue:{fields:t}}}function TO(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Ot||n instanceof Wi||n instanceof jr||n instanceof xn||n instanceof Uw||n instanceof qi)}function wO(n,e,t){if(!TO(t)||!lM(t)){const r=cw(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function Sj(n,e,t){if((e=ur(e))instanceof Lw)return e._internalPath;if(typeof e=="string")return EO(n,e);throw km("Field path arguments must be of type string or ",n,!1,void 0,t)}const Rj=new RegExp("[~\\*/\\[\\]]");function EO(n,e,t){if(e.search(Rj)>=0)throw km(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Lw(...e.split("."))._internalPath}catch{throw km(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function km(n,e,t,r,i){const s=r&&!r.isEmpty(),o=i!==void 0;let l=`Function ${e}() called with invalid data`;t&&(l+=" (via `toFirestore()`)"),l+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new Le(Te.INVALID_ARGUMENT,l+n+u)}function Cj(n,e){return n.some((t=>t.isEqual(e)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xO{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new xn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Ij(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(AO("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class Ij extends xO{data(){return super.data()}}function AO(n,e){return typeof e=="string"?EO(n,e):e instanceof Lw?e._internalPath:e._delegate._internalPath}class Pj{convertValue(e,t="none"){switch(ua(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Zt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ca(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw je(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Il(e,((i,s)=>{r[i]=this.convertValue(s,t)})),r}convertVectorValue(e){const t=e.fields?.[Am].arrayValue?.values?.map((r=>Zt(r.doubleValue)));return new qi(t)}convertGeoPoint(e){return new Wi(Zt(e.latitude),Zt(e.longitude))}convertArray(e,t){return(e.values||[]).map((r=>this.convertValue(r,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const r=y_(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Wf(e));default:return null}}convertTimestamp(e){const t=la(e);return new Ot(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=Ut.fromString(e);gt(XM(r),9688,{name:e});const i=new qf(r.get(1),r.get(3)),s=new Ue(r.popFirst(5));return i.isEqual(t)||Fs(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mj(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class gf{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class ul extends xO{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Kg(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(AO("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Le(Te.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=ul._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}ul._jsonSchemaVersion="firestore/documentSnapshot/1.0",ul._jsonSchema={type:sn("string",ul._jsonSchemaVersion),bundleSource:sn("string","DocumentSnapshot"),bundleName:sn("string"),bundle:sn("string")};class Kg extends ul{data(e={}){return super.data(e)}}class Cf{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new gf(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((r=>{e.call(t,new Kg(this._firestore,this._userDataWriter,r.key,r,new gf(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Le(Te.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map((l=>{const u=new Kg(i._firestore,i._userDataWriter,l.doc.key,l.doc,new gf(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter);return l.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}}))}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter((l=>s||l.type!==3)).map((l=>{const u=new Kg(i._firestore,i._userDataWriter,l.doc.key,l.doc,new gf(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter);let h=-1,d=-1;return l.type!==0&&(h=o.indexOf(l.doc.key),o=o.delete(l.doc.key)),l.type!==1&&(o=o.add(l.doc),d=o.indexOf(l.doc.key)),{type:Oj(l.type),doc:u,oldIndex:h,newIndex:d}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Le(Te.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Cf._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=lw.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],i=[];return this.docs.forEach((s=>{s._document!==null&&(t.push(s._document),r.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),i.push(s.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function Oj(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return je(61501,{type:n})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vw(n){n=Hf(n,xn);const e=Hf(n.firestore,Dw);return _j(_O(e),n._key).then((t=>Dj(e,n,t)))}Cf._jsonSchemaVersion="firestore/querySnapshot/1.0",Cf._jsonSchema={type:sn("string",Cf._jsonSchemaVersion),bundleSource:sn("string","QuerySnapshot"),bundleName:sn("string"),bundle:sn("string")};class kj extends Pj{constructor(e){super(),this.firestore=e}convertBytes(e){return new jr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new xn(this.firestore,null,t)}}function $0(n,e,t){n=Hf(n,xn);const r=Hf(n.firestore,Dw),i=Mj(n.converter,e,t);return Nj(r,[Aj(xj(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,ks.none())])}function Nj(n,e){return(function(r,i){const s=new na;return r.asyncQueue.enqueueAndForget((async()=>rj(await gj(r),i,s))),s.promise})(_O(n),e)}function Dj(n,e,t){const r=t.docs.get(e._key),i=new kj(n);return new ul(n,i,e._key,r,new gf(t.hasPendingWrites,t.fromCache),e.converter)}function SO(){return new Bw("serverTimestamp")}(function(e,t=!0){(function(i){Nu=i})(Ou),lu(new _l("firestore",((r,{instanceIdentifier:i,options:s})=>{const o=r.getProvider("app").getImmediate(),l=new Dw(new y8(r.getProvider("auth-internal")),new T8(o,r.getProvider("app-check-internal")),(function(h,d){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new Le(Te.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new qf(h.options.projectId,d)})(o,i),o);return s={useFetchStreams:t,...s},l._setSettings(s),l}),"PUBLIC").setMultipleInstances(!0)),ea(m2,_2,e),ea(m2,_2,"esm2020")})();const Lj={apiKey:"AIzaSyAk2sPOZkdl-RvB9NA7AZIywwReEAFMdns",authDomain:"openships-500f9.firebaseapp.com",projectId:"openships-500f9",storageBucket:"openships-500f9.firebasestorage.app",messagingSenderId:"962794742649",appId:"1:962794742649:web:e62f8a07c94b8ecf8e45a8",measurementId:"G-5901XXREHT"},RO=mP(Lj),Fu=f8(RO),mu=vj(RO);async function CO(n){try{const e=gu(mu,"userSettings",n),t=await Vw(e);return t.exists()?t.data():null}catch(e){return console.error("Error fetching user settings:",e),null}}async function IO(n,e){try{const t=gu(mu,"userSettings",n);await $0(t,{...e,updatedAt:SO()},{merge:!0})}catch(t){throw console.error("Error saving user settings:",t),t}}const PO=R.createContext({theme:"light",setTheme:()=>{}}),Uj=()=>R.useContext(PO),Fj=({children:n})=>{const[e,t]=R.useState(()=>localStorage.getItem("theme")||"light"),r=R.useRef(null),i=R.useRef(null);return R.useEffect(()=>{const s=iw(Fu,async o=>{const l=o?.uid??null;if(r.current=l,l)try{const u=await CO(l);u&&(u.theme==="dark"||u.theme==="light")&&(t(u.theme),localStorage.setItem("theme",u.theme))}catch(u){console.error("Failed to load user settings:",u)}});return()=>{s()}},[]),R.useEffect(()=>{document.body.classList.toggle("dark",e==="dark"),localStorage.setItem("theme",e);const s=r.current;return s&&(i.current&&window.clearTimeout(i.current),i.current=window.setTimeout(()=>{IO(s,{theme:e}).catch(o=>console.error("Failed to save user settings:",o)),i.current=null},800)),()=>{i.current&&(window.clearTimeout(i.current),i.current=null)}},[e]),X.jsx(PO.Provider,{value:{theme:e,setTheme:t},children:n})},MO=R.createContext({user:null});function Bj({children:n}){const[e,t]=R.useState(null),[r,i]=R.useState(!0);return R.useEffect(()=>{const s=iw(Fu,o=>{t(o),i(!1)});return()=>s()},[]),X.jsx(MO.Provider,{value:{user:e},children:!r&&n})}function zw(n=768){const[e,t]=R.useState(window.innerWidth<=n);return R.useEffect(()=>{const r=()=>t(window.innerWidth<=n);return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[n]),e}var OO={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},u3=vt.createContext&&vt.createContext(OO),Vj=["attr","size","title"];function zj(n,e){if(n==null)return{};var t=jj(n,e),r,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(i=0;i<s.length;i++)r=s[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(n,r)&&(t[r]=n[r])}return t}function jj(n,e){if(n==null)return{};var t={};for(var r in n)if(Object.prototype.hasOwnProperty.call(n,r)){if(e.indexOf(r)>=0)continue;t[r]=n[r]}return t}function Nm(){return Nm=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Nm.apply(this,arguments)}function h3(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function Dm(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?h3(Object(t),!0).forEach(function(r){Hj(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):h3(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function Hj(n,e,t){return e=$j(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function $j(n){var e=Wj(n,"string");return typeof e=="symbol"?e:e+""}function Wj(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function kO(n){return n&&n.map((e,t)=>vt.createElement(e.tag,Dm({key:t},e.attr),kO(e.child)))}function kl(n){return e=>vt.createElement(qj,Nm({attr:Dm({},n.attr)},e),kO(n.child))}function qj(n){var e=t=>{var{attr:r,size:i,title:s}=n,o=zj(n,Vj),l=i||t.size||"1em",u;return t.className&&(u=t.className),n.className&&(u=(u?u+" ":"")+n.className),vt.createElement("svg",Nm({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,r,o,{className:u,style:Dm(Dm({color:n.color||t.color},t.style),n.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),s&&vt.createElement("title",null,s),n.children)};return u3!==void 0?vt.createElement(u3.Consumer,null,t=>e(t)):e(OO)}function f3(n){return kl({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"},child:[]}]})(n)}function Xj(n){return kl({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M12.41 148.02l232.94 105.67c6.8 3.09 14.49 3.09 21.29 0l232.94-105.67c16.55-7.51 16.55-32.52 0-40.03L266.65 2.31a25.607 25.607 0 0 0-21.29 0L12.41 107.98c-16.55 7.51-16.55 32.53 0 40.04zm487.18 88.28l-58.09-26.33-161.64 73.27c-7.56 3.43-15.59 5.17-23.86 5.17s-16.29-1.74-23.86-5.17L70.51 209.97l-58.1 26.33c-16.55 7.5-16.55 32.5 0 40l232.94 105.59c6.8 3.08 14.49 3.08 21.29 0L499.59 276.3c16.55-7.5 16.55-32.5 0-40zm0 127.8l-57.87-26.23-161.86 73.37c-7.56 3.43-15.59 5.17-23.86 5.17s-16.29-1.74-23.86-5.17L70.29 337.87 12.41 364.1c-16.55 7.5-16.55 32.5 0 40l232.94 105.59c6.8 3.08 14.49 3.08 21.29 0L499.59 404.1c16.55-7.5 16.55-32.5 0-40z"},child:[]}]})(n)}function d3(n){return kl({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M0 117.66v346.32c0 11.32 11.43 19.06 21.94 14.86L160 416V32L20.12 87.95A32.006 32.006 0 0 0 0 117.66zM192 416l192 64V96L192 32v384zM554.06 33.16L416 96v384l139.88-55.95A31.996 31.996 0 0 0 576 394.34V48.02c0-11.32-11.43-19.06-21.94-14.86z"},child:[]}]})(n)}function p3(n){return kl({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M496.616 372.639l70.012-70.012c16.899-16.9 9.942-45.771-12.836-53.092L512 236.102V96c0-17.673-14.327-32-32-32h-64V24c0-13.255-10.745-24-24-24H248c-13.255 0-24 10.745-24 24v40h-64c-17.673 0-32 14.327-32 32v140.102l-41.792 13.433c-22.753 7.313-29.754 36.173-12.836 53.092l70.012 70.012C125.828 416.287 85.587 448 24 448c-13.255 0-24 10.745-24 24v16c0 13.255 10.745 24 24 24 61.023 0 107.499-20.61 143.258-59.396C181.677 487.432 216.021 512 256 512h128c39.979 0 74.323-24.568 88.742-59.396C508.495 491.384 554.968 512 616 512c13.255 0 24-10.745 24-24v-16c0-13.255-10.745-24-24-24-60.817 0-101.542-31.001-119.384-75.361zM192 128h256v87.531l-118.208-37.995a31.995 31.995 0 0 0-19.584 0L192 215.531V128z"},child:[]}]})(n)}function g3(n){return kl({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M480 416v16c0 26.51-21.49 48-48 48H48c-26.51 0-48-21.49-48-48V176c0-26.51 21.49-48 48-48h16v48H54a6 6 0 0 0-6 6v244a6 6 0 0 0 6 6h372a6 6 0 0 0 6-6v-10h48zm42-336H150a6 6 0 0 0-6 6v244a6 6 0 0 0 6 6h372a6 6 0 0 0 6-6V86a6 6 0 0 0-6-6zm6-48c26.51 0 48 21.49 48 48v256c0 26.51-21.49 48-48 48H144c-26.51 0-48-21.49-48-48V80c0-26.51 21.49-48 48-48h384zM264 144c0 22.091-17.909 40-40 40s-40-17.909-40-40 17.909-40 40-40 40 17.909 40 40zm-72 96l39.515-39.515c4.686-4.686 12.284-4.686 16.971 0L288 240l103.515-103.515c4.686-4.686 12.284-4.686 16.971 0L480 208v80H192v-48z"},child:[]}]})(n)}function m3(n){return kl({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 4c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm0 14c-2.03 0-4.43-.82-6.14-2.88a9.947 9.947 0 0 1 12.28 0C16.43 19.18 14.03 20 12 20z"},child:[]}]})(n)}function Yj(n){return kl({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M12 10.189V14"},child:[]},{tag:"path",attr:{d:"M12 2v3"},child:[]},{tag:"path",attr:{d:"M19 13V7a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2v6"},child:[]},{tag:"path",attr:{d:"M19.38 20A11.6 11.6 0 0 0 21 14l-8.188-3.639a2 2 0 0 0-1.624 0L3 14a11.6 11.6 0 0 0 2.81 7.76"},child:[]},{tag:"path",attr:{d:"M2 21c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1s1.2 1 2.5 1c2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"},child:[]}]})(n)}function Kj(){return zw()?X.jsxs("div",{className:"fixed w-full h-14 bg-gray-500 bottom-0 p-2 flex justify-between items-center z-50",children:[X.jsx("div",{className:"relative flex-1 flex justify-start",children:X.jsx(Er,{to:"/settings","aria-label":"Settings",className:"absolute -top-15 left-1/2 -translate-x-1/2 bg-white rounded-full shadow-lg flex items-center justify-center w-16 h-16 border-4 border-gray-500 active:scale-95 cursor-pointer transition-transform duration-150 hover:bg-gray-100 active:bg-gray-300",children:X.jsx(f3,{className:"text-gray-700 text-6xl p-2"})})}),X.jsx("div",{className:"relative flex-1 flex justify-start",children:X.jsx(Er,{to:"/account","aria-label":"Account",className:"absolute -top-15 left-1/2 -translate-x-1/2 bg-white rounded-full shadow-lg flex items-center justify-center w-16 h-16 border-4 border-gray-500 active:scale-95 cursor-pointer transition-transform duration-150 hover:bg-gray-100 active:bg-gray-300",children:X.jsx(m3,{className:"text-gray-700 text-6xl p-1"})})}),X.jsx("div",{className:"relative flex-1 flex justify-center",children:X.jsx(Er,{to:"/","aria-label":"Map",className:"absolute -top-18 left-1/2 -translate-x-1/2 bg-white rounded-full shadow-lg flex items-center justify-center w-20 h-20 border-4 border-gray-500 active:scale-95 cursor-pointer transition-transform duration-150 hover:bg-gray-100 active:bg-gray-300",children:X.jsx(d3,{className:"text-5xl text-gray-700"})})}),X.jsx("div",{className:"relative flex-1 flex justify-center",children:X.jsx(Er,{to:"/vessels","aria-label":"Vessel List",className:"absolute -top-15 left-1/2 -translate-x-1/2 bg-white rounded-full shadow-lg flex items-center justify-center w-16 h-16 border-4 border-gray-500 active:scale-95 cursor-pointer transition-transform duration-150 hover:bg-gray-100 active:bg-gray-300",children:X.jsx(p3,{className:"text-gray-700 text-5xl p-1.5"})})}),X.jsx("div",{className:"relative flex-1 flex justify-center",children:X.jsx(Er,{to:"/gallery","aria-label":"Gallery",className:"absolute -top-15 left-1/2 -translate-x-1/2 bg-white rounded-full shadow-lg flex items-center justify-center w-16 h-16 border-4 border-gray-500 active:scale-95 cursor-pointer transition-transform duration-150 hover:bg-gray-100 active:bg-gray-300",children:X.jsx(g3,{className:"text-gray-700 text-5xl p-1.5"})})})]}):X.jsxs("div",{className:"fixed w-full h-16 bg-gray-500 top-0 p-2 shadow-lg z-50",children:[X.jsx("div",{className:"max-w-7xl h-full flex justify-between items-center px-4",children:X.jsxs(Er,{to:"/",className:"text-gray-700 text-2xl font-bold flex items-center space-x-2",children:[X.jsx(Yj,{className:"text-4xl text-gray-700 mr-2"})," OpenShips"]})}),X.jsxs("div",{className:"absolute left-1/2 top-5/6 -translate-x-1/2 -translate-y-1/2 flex space-x-16",children:[X.jsx(Er,{to:"/gallery",className:"relative","aria-label":"Gallery",tabIndex:0,children:X.jsx("button",{className:"bg-white rounded-full shadow-lg flex items-center justify-center w-16 h-16 border-4 border-gray-500 active:scale-95 hover:scale-105 cursor-pointer transition-transform duration-150 hover:bg-gray-100 active:bg-gray-300",role:"button",tabIndex:0,"aria-label":"Gallery",children:X.jsx(g3,{className:"text-gray-700 text-5xl p-1.5"})})}),X.jsx(Er,{to:"/",className:"relative","aria-label":"Map",tabIndex:0,children:X.jsx("button",{className:"bg-white rounded-full shadow-lg flex items-center justify-center w-20 h-20 border-4 border-gray-500 active:scale-95 hover:scale-105 cursor-pointer transition-transform duration-150 hover:bg-gray-100 active:bg-gray-300",role:"button",tabIndex:0,"aria-label":"Map",children:X.jsx(d3,{className:"text-5xl text-gray-700"})})}),X.jsx(Er,{to:"/vessels",className:"relative","aria-label":"Vessel List",tabIndex:0,children:X.jsx("button",{className:"bg-white rounded-full shadow-lg flex items-center justify-center w-16 h-16 border-4 border-gray-500 active:scale-95 hover:scale-105 cursor-pointer transition-transform duration-150 hover:bg-gray-100 active:bg-gray-300",role:"button",tabIndex:0,"aria-label":"Vessel List",children:X.jsx(p3,{className:"text-gray-700 text-5xl p-1.5"})})})]}),X.jsxs("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 flex space-x-6",children:[X.jsx(Er,{to:"/account",className:"relative","aria-label":"Account",tabIndex:0,children:X.jsx("button",{className:"bg-white rounded-full shadow-lg flex items-center justify-center w-14 h-14 border-4 border-gray-500 active:scale-95 hover:scale-105 cursor-pointer transition-transform duration-150 hover:bg-gray-100 active:bg-gray-300",role:"button",tabIndex:0,"aria-label":"Account",children:X.jsx(m3,{className:"text-gray-700 text-5xl p-1"})})}),X.jsx(Er,{to:"/settings",className:"relative","aria-label":"Settings",tabIndex:0,children:X.jsx("button",{className:"bg-white rounded-full shadow-lg flex items-center justify-center w-14 h-14 border-4 border-gray-500 active:scale-95 hover:scale-105 cursor-pointer transition-transform duration-150 hover:bg-gray-100 active:bg-gray-300",role:"button",tabIndex:0,"aria-label":"Settings",children:X.jsx(f3,{className:"text-gray-700 text-5xl p-2"})})})]})]})}const Gj=()=>{const{theme:n,setTheme:e}=Uj(),t=()=>{e(n==="dark"?"light":"dark")};return X.jsx("button",{onClick:t,"aria-label":"Toggle theme",className:"fixed top-20 right-4 p-2 bg-gray-200 dark:bg-gray-800 rounded-full shadow-md hover:bg-gray-300 dark:hover:bg-gray-700 transition",children:n==="dark"?" Dark":" Light"})};function Hr(n,e,{checkForDefaultPrevented:t=!0}={}){return function(i){if(n?.(i),t===!1||!i.defaultPrevented)return e?.(i)}}function _3(n,e){if(typeof n=="function")return n(e);n!=null&&(n.current=e)}function NO(...n){return e=>{let t=!1;const r=n.map(i=>{const s=_3(i,e);return!t&&typeof s=="function"&&(t=!0),s});if(t)return()=>{for(let i=0;i<r.length;i++){const s=r[i];typeof s=="function"?s():_3(n[i],null)}}}}function hr(...n){return R.useCallback(NO(...n),n)}function Bu(n,e=[]){let t=[];function r(s,o){const l=R.createContext(o),u=t.length;t=[...t,o];const h=g=>{const{scope:y,children:b,...w}=g,E=y?.[n]?.[u]||l,x=R.useMemo(()=>w,Object.values(w));return X.jsx(E.Provider,{value:x,children:b})};h.displayName=s+"Provider";function d(g,y){const b=y?.[n]?.[u]||l,w=R.useContext(b);if(w)return w;if(o!==void 0)return o;throw new Error(`\`${g}\` must be used within \`${s}\``)}return[h,d]}const i=()=>{const s=t.map(o=>R.createContext(o));return function(l){const u=l?.[n]||s;return R.useMemo(()=>({[`__scope${n}`]:{...l,[n]:u}}),[l,u])}};return i.scopeName=n,[r,Zj(i,...e)]}function Zj(...n){const e=n[0];if(n.length===1)return e;const t=()=>{const r=n.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(s){const o=r.reduce((l,{useScope:u,scopeName:h})=>{const g=u(s)[`__scope${h}`];return{...l,...g}},{});return R.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return t.scopeName=e.scopeName,t}function Lm(n){const e=Qj(n),t=R.forwardRef((r,i)=>{const{children:s,...o}=r,l=R.Children.toArray(s),u=l.find(e7);if(u){const h=u.props.children,d=l.map(g=>g===u?R.Children.count(h)>1?R.Children.only(null):R.isValidElement(h)?h.props.children:null:g);return X.jsx(e,{...o,ref:i,children:R.isValidElement(h)?R.cloneElement(h,void 0,d):null})}return X.jsx(e,{...o,ref:i,children:s})});return t.displayName=`${n}.Slot`,t}function Qj(n){const e=R.forwardRef((t,r)=>{const{children:i,...s}=t;if(R.isValidElement(i)){const o=n7(i),l=t7(s,i.props);return i.type!==R.Fragment&&(l.ref=r?NO(r,o):o),R.cloneElement(i,l)}return R.Children.count(i)>1?R.Children.only(null):null});return e.displayName=`${n}.SlotClone`,e}var Jj=Symbol("radix.slottable");function e7(n){return R.isValidElement(n)&&typeof n.type=="function"&&"__radixId"in n.type&&n.type.__radixId===Jj}function t7(n,e){const t={...e};for(const r in e){const i=n[r],s=e[r];/^on[A-Z]/.test(r)?i&&s?t[r]=(...l)=>{const u=s(...l);return i(...l),u}:i&&(t[r]=i):r==="style"?t[r]={...i,...s}:r==="className"&&(t[r]=[i,s].filter(Boolean).join(" "))}return{...n,...t}}function n7(n){let e=Object.getOwnPropertyDescriptor(n.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=Object.getOwnPropertyDescriptor(n,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}var r7=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Ln=r7.reduce((n,e)=>{const t=Lm(`Primitive.${e}`),r=R.forwardRef((i,s)=>{const{asChild:o,...l}=i,u=o?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),X.jsx(u,{...l,ref:s})});return r.displayName=`Primitive.${e}`,{...n,[e]:r}},{});function i7(n,e){n&&YT.flushSync(()=>n.dispatchEvent(e))}function _u(n){const e=R.useRef(n);return R.useEffect(()=>{e.current=n}),R.useMemo(()=>(...t)=>e.current?.(...t),[])}function s7(n,e=globalThis?.document){const t=_u(n);R.useEffect(()=>{const r=i=>{i.key==="Escape"&&t(i)};return e.addEventListener("keydown",r,{capture:!0}),()=>e.removeEventListener("keydown",r,{capture:!0})},[t,e])}var o7="DismissableLayer",W0="dismissableLayer.update",a7="dismissableLayer.pointerDownOutside",l7="dismissableLayer.focusOutside",y3,DO=R.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),LO=R.forwardRef((n,e)=>{const{disableOutsidePointerEvents:t=!1,onEscapeKeyDown:r,onPointerDownOutside:i,onFocusOutside:s,onInteractOutside:o,onDismiss:l,...u}=n,h=R.useContext(DO),[d,g]=R.useState(null),y=d?.ownerDocument??globalThis?.document,[,b]=R.useState({}),w=hr(e,D=>g(D)),E=Array.from(h.layers),[x]=[...h.layersWithOutsidePointerEventsDisabled].slice(-1),C=E.indexOf(x),M=d?E.indexOf(d):-1,O=h.layersWithOutsidePointerEventsDisabled.size>0,V=M>=C,H=h7(D=>{const I=D.target,N=[...h.branches].some(j=>j.contains(I));!V||N||(i?.(D),o?.(D),D.defaultPrevented||l?.())},y),G=f7(D=>{const I=D.target;[...h.branches].some(j=>j.contains(I))||(s?.(D),o?.(D),D.defaultPrevented||l?.())},y);return s7(D=>{M===h.layers.size-1&&(r?.(D),!D.defaultPrevented&&l&&(D.preventDefault(),l()))},y),R.useEffect(()=>{if(d)return t&&(h.layersWithOutsidePointerEventsDisabled.size===0&&(y3=y.body.style.pointerEvents,y.body.style.pointerEvents="none"),h.layersWithOutsidePointerEventsDisabled.add(d)),h.layers.add(d),v3(),()=>{t&&h.layersWithOutsidePointerEventsDisabled.size===1&&(y.body.style.pointerEvents=y3)}},[d,y,t,h]),R.useEffect(()=>()=>{d&&(h.layers.delete(d),h.layersWithOutsidePointerEventsDisabled.delete(d),v3())},[d,h]),R.useEffect(()=>{const D=()=>b({});return document.addEventListener(W0,D),()=>document.removeEventListener(W0,D)},[]),X.jsx(Ln.div,{...u,ref:w,style:{pointerEvents:O?V?"auto":"none":void 0,...n.style},onFocusCapture:Hr(n.onFocusCapture,G.onFocusCapture),onBlurCapture:Hr(n.onBlurCapture,G.onBlurCapture),onPointerDownCapture:Hr(n.onPointerDownCapture,H.onPointerDownCapture)})});LO.displayName=o7;var c7="DismissableLayerBranch",u7=R.forwardRef((n,e)=>{const t=R.useContext(DO),r=R.useRef(null),i=hr(e,r);return R.useEffect(()=>{const s=r.current;if(s)return t.branches.add(s),()=>{t.branches.delete(s)}},[t.branches]),X.jsx(Ln.div,{...n,ref:i})});u7.displayName=c7;function h7(n,e=globalThis?.document){const t=_u(n),r=R.useRef(!1),i=R.useRef(()=>{});return R.useEffect(()=>{const s=l=>{if(l.target&&!r.current){let u=function(){UO(a7,t,h,{discrete:!0})};const h={originalEvent:l};l.pointerType==="touch"?(e.removeEventListener("click",i.current),i.current=u,e.addEventListener("click",i.current,{once:!0})):u()}else e.removeEventListener("click",i.current);r.current=!1},o=window.setTimeout(()=>{e.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(o),e.removeEventListener("pointerdown",s),e.removeEventListener("click",i.current)}},[e,t]),{onPointerDownCapture:()=>r.current=!0}}function f7(n,e=globalThis?.document){const t=_u(n),r=R.useRef(!1);return R.useEffect(()=>{const i=s=>{s.target&&!r.current&&UO(l7,t,{originalEvent:s},{discrete:!1})};return e.addEventListener("focusin",i),()=>e.removeEventListener("focusin",i)},[e,t]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function v3(){const n=new CustomEvent(W0);document.dispatchEvent(n)}function UO(n,e,t,{discrete:r}){const i=t.originalEvent.target,s=new CustomEvent(n,{bubbles:!1,cancelable:!0,detail:t});e&&i.addEventListener(n,e,{once:!0}),r?i7(i,s):i.dispatchEvent(s)}var mb=0;function d7(){R.useEffect(()=>{const n=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",n[0]??b3()),document.body.insertAdjacentElement("beforeend",n[1]??b3()),mb++,()=>{mb===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),mb--}},[])}function b3(){const n=document.createElement("span");return n.setAttribute("data-radix-focus-guard",""),n.tabIndex=0,n.style.outline="none",n.style.opacity="0",n.style.position="fixed",n.style.pointerEvents="none",n}var _b="focusScope.autoFocusOnMount",yb="focusScope.autoFocusOnUnmount",T3={bubbles:!1,cancelable:!0},p7="FocusScope",FO=R.forwardRef((n,e)=>{const{loop:t=!1,trapped:r=!1,onMountAutoFocus:i,onUnmountAutoFocus:s,...o}=n,[l,u]=R.useState(null),h=_u(i),d=_u(s),g=R.useRef(null),y=hr(e,E=>u(E)),b=R.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;R.useEffect(()=>{if(r){let E=function(O){if(b.paused||!l)return;const V=O.target;l.contains(V)?g.current=V:Vo(g.current,{select:!0})},x=function(O){if(b.paused||!l)return;const V=O.relatedTarget;V!==null&&(l.contains(V)||Vo(g.current,{select:!0}))},C=function(O){if(document.activeElement===document.body)for(const H of O)H.removedNodes.length>0&&Vo(l)};document.addEventListener("focusin",E),document.addEventListener("focusout",x);const M=new MutationObserver(C);return l&&M.observe(l,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",E),document.removeEventListener("focusout",x),M.disconnect()}}},[r,l,b.paused]),R.useEffect(()=>{if(l){E3.add(b);const E=document.activeElement;if(!l.contains(E)){const C=new CustomEvent(_b,T3);l.addEventListener(_b,h),l.dispatchEvent(C),C.defaultPrevented||(g7(b7(BO(l)),{select:!0}),document.activeElement===E&&Vo(l))}return()=>{l.removeEventListener(_b,h),setTimeout(()=>{const C=new CustomEvent(yb,T3);l.addEventListener(yb,d),l.dispatchEvent(C),C.defaultPrevented||Vo(E??document.body,{select:!0}),l.removeEventListener(yb,d),E3.remove(b)},0)}}},[l,h,d,b]);const w=R.useCallback(E=>{if(!t&&!r||b.paused)return;const x=E.key==="Tab"&&!E.altKey&&!E.ctrlKey&&!E.metaKey,C=document.activeElement;if(x&&C){const M=E.currentTarget,[O,V]=m7(M);O&&V?!E.shiftKey&&C===V?(E.preventDefault(),t&&Vo(O,{select:!0})):E.shiftKey&&C===O&&(E.preventDefault(),t&&Vo(V,{select:!0})):C===M&&E.preventDefault()}},[t,r,b.paused]);return X.jsx(Ln.div,{tabIndex:-1,...o,ref:y,onKeyDown:w})});FO.displayName=p7;function g7(n,{select:e=!1}={}){const t=document.activeElement;for(const r of n)if(Vo(r,{select:e}),document.activeElement!==t)return}function m7(n){const e=BO(n),t=w3(e,n),r=w3(e.reverse(),n);return[t,r]}function BO(n){const e=[],t=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const i=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||i?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function w3(n,e){for(const t of n)if(!_7(t,{upTo:e}))return t}function _7(n,{upTo:e}){if(getComputedStyle(n).visibility==="hidden")return!0;for(;n;){if(e!==void 0&&n===e)return!1;if(getComputedStyle(n).display==="none")return!0;n=n.parentElement}return!1}function y7(n){return n instanceof HTMLInputElement&&"select"in n}function Vo(n,{select:e=!1}={}){if(n&&n.focus){const t=document.activeElement;n.focus({preventScroll:!0}),n!==t&&y7(n)&&e&&n.select()}}var E3=v7();function v7(){let n=[];return{add(e){const t=n[0];e!==t&&t?.pause(),n=x3(n,e),n.unshift(e)},remove(e){n=x3(n,e),n[0]?.resume()}}}function x3(n,e){const t=[...n],r=t.indexOf(e);return r!==-1&&t.splice(r,1),t}function b7(n){return n.filter(e=>e.tagName!=="A")}var Vs=globalThis?.document?R.useLayoutEffect:()=>{},T7=jI[" useId ".trim().toString()]||(()=>{}),w7=0;function jw(n){const[e,t]=R.useState(T7());return Vs(()=>{t(r=>r??String(w7++))},[n]),n||(e?`radix-${e}`:"")}const E7=["top","right","bottom","left"],da=Math.min,xr=Math.max,Um=Math.round,ig=Math.floor,Xi=n=>({x:n,y:n}),x7={left:"right",right:"left",bottom:"top",top:"bottom"},A7={start:"end",end:"start"};function q0(n,e,t){return xr(n,da(e,t))}function zs(n,e){return typeof n=="function"?n(e):n}function js(n){return n.split("-")[0]}function Vu(n){return n.split("-")[1]}function Hw(n){return n==="x"?"y":"x"}function $w(n){return n==="y"?"height":"width"}const S7=new Set(["top","bottom"]);function Bi(n){return S7.has(js(n))?"y":"x"}function Ww(n){return Hw(Bi(n))}function R7(n,e,t){t===void 0&&(t=!1);const r=Vu(n),i=Ww(n),s=$w(i);let o=i==="x"?r===(t?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(o=Fm(o)),[o,Fm(o)]}function C7(n){const e=Fm(n);return[X0(n),e,X0(e)]}function X0(n){return n.replace(/start|end/g,e=>A7[e])}const A3=["left","right"],S3=["right","left"],I7=["top","bottom"],P7=["bottom","top"];function M7(n,e,t){switch(n){case"top":case"bottom":return t?e?S3:A3:e?A3:S3;case"left":case"right":return e?I7:P7;default:return[]}}function O7(n,e,t,r){const i=Vu(n);let s=M7(js(n),t==="start",r);return i&&(s=s.map(o=>o+"-"+i),e&&(s=s.concat(s.map(X0)))),s}function Fm(n){return n.replace(/left|right|bottom|top/g,e=>x7[e])}function k7(n){return{top:0,right:0,bottom:0,left:0,...n}}function VO(n){return typeof n!="number"?k7(n):{top:n,right:n,bottom:n,left:n}}function Bm(n){const{x:e,y:t,width:r,height:i}=n;return{width:r,height:i,top:t,left:e,right:e+r,bottom:t+i,x:e,y:t}}function R3(n,e,t){let{reference:r,floating:i}=n;const s=Bi(e),o=Ww(e),l=$w(o),u=js(e),h=s==="y",d=r.x+r.width/2-i.width/2,g=r.y+r.height/2-i.height/2,y=r[l]/2-i[l]/2;let b;switch(u){case"top":b={x:d,y:r.y-i.height};break;case"bottom":b={x:d,y:r.y+r.height};break;case"right":b={x:r.x+r.width,y:g};break;case"left":b={x:r.x-i.width,y:g};break;default:b={x:r.x,y:r.y}}switch(Vu(e)){case"start":b[o]-=y*(t&&h?-1:1);break;case"end":b[o]+=y*(t&&h?-1:1);break}return b}const N7=async(n,e,t)=>{const{placement:r="bottom",strategy:i="absolute",middleware:s=[],platform:o}=t,l=s.filter(Boolean),u=await(o.isRTL==null?void 0:o.isRTL(e));let h=await o.getElementRects({reference:n,floating:e,strategy:i}),{x:d,y:g}=R3(h,r,u),y=r,b={},w=0;for(let E=0;E<l.length;E++){const{name:x,fn:C}=l[E],{x:M,y:O,data:V,reset:H}=await C({x:d,y:g,initialPlacement:r,placement:y,strategy:i,middlewareData:b,rects:h,platform:o,elements:{reference:n,floating:e}});d=M??d,g=O??g,b={...b,[x]:{...b[x],...V}},H&&w<=50&&(w++,typeof H=="object"&&(H.placement&&(y=H.placement),H.rects&&(h=H.rects===!0?await o.getElementRects({reference:n,floating:e,strategy:i}):H.rects),{x:d,y:g}=R3(h,y,u)),E=-1)}return{x:d,y:g,placement:y,strategy:i,middlewareData:b}};async function Qf(n,e){var t;e===void 0&&(e={});const{x:r,y:i,platform:s,rects:o,elements:l,strategy:u}=n,{boundary:h="clippingAncestors",rootBoundary:d="viewport",elementContext:g="floating",altBoundary:y=!1,padding:b=0}=zs(e,n),w=VO(b),x=l[y?g==="floating"?"reference":"floating":g],C=Bm(await s.getClippingRect({element:(t=await(s.isElement==null?void 0:s.isElement(x)))==null||t?x:x.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(l.floating)),boundary:h,rootBoundary:d,strategy:u})),M=g==="floating"?{x:r,y:i,width:o.floating.width,height:o.floating.height}:o.reference,O=await(s.getOffsetParent==null?void 0:s.getOffsetParent(l.floating)),V=await(s.isElement==null?void 0:s.isElement(O))?await(s.getScale==null?void 0:s.getScale(O))||{x:1,y:1}:{x:1,y:1},H=Bm(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:l,rect:M,offsetParent:O,strategy:u}):M);return{top:(C.top-H.top+w.top)/V.y,bottom:(H.bottom-C.bottom+w.bottom)/V.y,left:(C.left-H.left+w.left)/V.x,right:(H.right-C.right+w.right)/V.x}}const D7=n=>({name:"arrow",options:n,async fn(e){const{x:t,y:r,placement:i,rects:s,platform:o,elements:l,middlewareData:u}=e,{element:h,padding:d=0}=zs(n,e)||{};if(h==null)return{};const g=VO(d),y={x:t,y:r},b=Ww(i),w=$w(b),E=await o.getDimensions(h),x=b==="y",C=x?"top":"left",M=x?"bottom":"right",O=x?"clientHeight":"clientWidth",V=s.reference[w]+s.reference[b]-y[b]-s.floating[w],H=y[b]-s.reference[b],G=await(o.getOffsetParent==null?void 0:o.getOffsetParent(h));let D=G?G[O]:0;(!D||!await(o.isElement==null?void 0:o.isElement(G)))&&(D=l.floating[O]||s.floating[w]);const I=V/2-H/2,N=D/2-E[w]/2-1,j=da(g[C],N),W=da(g[M],N),Y=j,z=D-E[w]-W,de=D/2-E[w]/2+I,xe=q0(Y,de,z),P=!u.arrow&&Vu(i)!=null&&de!==xe&&s.reference[w]/2-(de<Y?j:W)-E[w]/2<0,q=P?de<Y?de-Y:de-z:0;return{[b]:y[b]+q,data:{[b]:xe,centerOffset:de-xe-q,...P&&{alignmentOffset:q}},reset:P}}}),L7=function(n){return n===void 0&&(n={}),{name:"flip",options:n,async fn(e){var t,r;const{placement:i,middlewareData:s,rects:o,initialPlacement:l,platform:u,elements:h}=e,{mainAxis:d=!0,crossAxis:g=!0,fallbackPlacements:y,fallbackStrategy:b="bestFit",fallbackAxisSideDirection:w="none",flipAlignment:E=!0,...x}=zs(n,e);if((t=s.arrow)!=null&&t.alignmentOffset)return{};const C=js(i),M=Bi(l),O=js(l)===l,V=await(u.isRTL==null?void 0:u.isRTL(h.floating)),H=y||(O||!E?[Fm(l)]:C7(l)),G=w!=="none";!y&&G&&H.push(...O7(l,E,w,V));const D=[l,...H],I=await Qf(e,x),N=[];let j=((r=s.flip)==null?void 0:r.overflows)||[];if(d&&N.push(I[C]),g){const de=R7(i,o,V);N.push(I[de[0]],I[de[1]])}if(j=[...j,{placement:i,overflows:N}],!N.every(de=>de<=0)){var W,Y;const de=(((W=s.flip)==null?void 0:W.index)||0)+1,xe=D[de];if(xe&&(!(g==="alignment"?M!==Bi(xe):!1)||j.every(U=>Bi(U.placement)===M?U.overflows[0]>0:!0)))return{data:{index:de,overflows:j},reset:{placement:xe}};let P=(Y=j.filter(q=>q.overflows[0]<=0).sort((q,U)=>q.overflows[1]-U.overflows[1])[0])==null?void 0:Y.placement;if(!P)switch(b){case"bestFit":{var z;const q=(z=j.filter(U=>{if(G){const oe=Bi(U.placement);return oe===M||oe==="y"}return!0}).map(U=>[U.placement,U.overflows.filter(oe=>oe>0).reduce((oe,L)=>oe+L,0)]).sort((U,oe)=>U[1]-oe[1])[0])==null?void 0:z[0];q&&(P=q);break}case"initialPlacement":P=l;break}if(i!==P)return{reset:{placement:P}}}return{}}}};function C3(n,e){return{top:n.top-e.height,right:n.right-e.width,bottom:n.bottom-e.height,left:n.left-e.width}}function I3(n){return E7.some(e=>n[e]>=0)}const U7=function(n){return n===void 0&&(n={}),{name:"hide",options:n,async fn(e){const{rects:t}=e,{strategy:r="referenceHidden",...i}=zs(n,e);switch(r){case"referenceHidden":{const s=await Qf(e,{...i,elementContext:"reference"}),o=C3(s,t.reference);return{data:{referenceHiddenOffsets:o,referenceHidden:I3(o)}}}case"escaped":{const s=await Qf(e,{...i,altBoundary:!0}),o=C3(s,t.floating);return{data:{escapedOffsets:o,escaped:I3(o)}}}default:return{}}}}},zO=new Set(["left","top"]);async function F7(n,e){const{placement:t,platform:r,elements:i}=n,s=await(r.isRTL==null?void 0:r.isRTL(i.floating)),o=js(t),l=Vu(t),u=Bi(t)==="y",h=zO.has(o)?-1:1,d=s&&u?-1:1,g=zs(e,n);let{mainAxis:y,crossAxis:b,alignmentAxis:w}=typeof g=="number"?{mainAxis:g,crossAxis:0,alignmentAxis:null}:{mainAxis:g.mainAxis||0,crossAxis:g.crossAxis||0,alignmentAxis:g.alignmentAxis};return l&&typeof w=="number"&&(b=l==="end"?w*-1:w),u?{x:b*d,y:y*h}:{x:y*h,y:b*d}}const B7=function(n){return n===void 0&&(n=0),{name:"offset",options:n,async fn(e){var t,r;const{x:i,y:s,placement:o,middlewareData:l}=e,u=await F7(e,n);return o===((t=l.offset)==null?void 0:t.placement)&&(r=l.arrow)!=null&&r.alignmentOffset?{}:{x:i+u.x,y:s+u.y,data:{...u,placement:o}}}}},V7=function(n){return n===void 0&&(n={}),{name:"shift",options:n,async fn(e){const{x:t,y:r,placement:i}=e,{mainAxis:s=!0,crossAxis:o=!1,limiter:l={fn:x=>{let{x:C,y:M}=x;return{x:C,y:M}}},...u}=zs(n,e),h={x:t,y:r},d=await Qf(e,u),g=Bi(js(i)),y=Hw(g);let b=h[y],w=h[g];if(s){const x=y==="y"?"top":"left",C=y==="y"?"bottom":"right",M=b+d[x],O=b-d[C];b=q0(M,b,O)}if(o){const x=g==="y"?"top":"left",C=g==="y"?"bottom":"right",M=w+d[x],O=w-d[C];w=q0(M,w,O)}const E=l.fn({...e,[y]:b,[g]:w});return{...E,data:{x:E.x-t,y:E.y-r,enabled:{[y]:s,[g]:o}}}}}},z7=function(n){return n===void 0&&(n={}),{options:n,fn(e){const{x:t,y:r,placement:i,rects:s,middlewareData:o}=e,{offset:l=0,mainAxis:u=!0,crossAxis:h=!0}=zs(n,e),d={x:t,y:r},g=Bi(i),y=Hw(g);let b=d[y],w=d[g];const E=zs(l,e),x=typeof E=="number"?{mainAxis:E,crossAxis:0}:{mainAxis:0,crossAxis:0,...E};if(u){const O=y==="y"?"height":"width",V=s.reference[y]-s.floating[O]+x.mainAxis,H=s.reference[y]+s.reference[O]-x.mainAxis;b<V?b=V:b>H&&(b=H)}if(h){var C,M;const O=y==="y"?"width":"height",V=zO.has(js(i)),H=s.reference[g]-s.floating[O]+(V&&((C=o.offset)==null?void 0:C[g])||0)+(V?0:x.crossAxis),G=s.reference[g]+s.reference[O]+(V?0:((M=o.offset)==null?void 0:M[g])||0)-(V?x.crossAxis:0);w<H?w=H:w>G&&(w=G)}return{[y]:b,[g]:w}}}},j7=function(n){return n===void 0&&(n={}),{name:"size",options:n,async fn(e){var t,r;const{placement:i,rects:s,platform:o,elements:l}=e,{apply:u=()=>{},...h}=zs(n,e),d=await Qf(e,h),g=js(i),y=Vu(i),b=Bi(i)==="y",{width:w,height:E}=s.floating;let x,C;g==="top"||g==="bottom"?(x=g,C=y===(await(o.isRTL==null?void 0:o.isRTL(l.floating))?"start":"end")?"left":"right"):(C=g,x=y==="end"?"top":"bottom");const M=E-d.top-d.bottom,O=w-d.left-d.right,V=da(E-d[x],M),H=da(w-d[C],O),G=!e.middlewareData.shift;let D=V,I=H;if((t=e.middlewareData.shift)!=null&&t.enabled.x&&(I=O),(r=e.middlewareData.shift)!=null&&r.enabled.y&&(D=M),G&&!y){const j=xr(d.left,0),W=xr(d.right,0),Y=xr(d.top,0),z=xr(d.bottom,0);b?I=w-2*(j!==0||W!==0?j+W:xr(d.left,d.right)):D=E-2*(Y!==0||z!==0?Y+z:xr(d.top,d.bottom))}await u({...e,availableWidth:I,availableHeight:D});const N=await o.getDimensions(l.floating);return w!==N.width||E!==N.height?{reset:{rects:!0}}:{}}}};function C_(){return typeof window<"u"}function zu(n){return jO(n)?(n.nodeName||"").toLowerCase():"#document"}function Rr(n){var e;return(n==null||(e=n.ownerDocument)==null?void 0:e.defaultView)||window}function Ji(n){var e;return(e=(jO(n)?n.ownerDocument:n.document)||window.document)==null?void 0:e.documentElement}function jO(n){return C_()?n instanceof Node||n instanceof Rr(n).Node:!1}function di(n){return C_()?n instanceof Element||n instanceof Rr(n).Element:!1}function Zi(n){return C_()?n instanceof HTMLElement||n instanceof Rr(n).HTMLElement:!1}function P3(n){return!C_()||typeof ShadowRoot>"u"?!1:n instanceof ShadowRoot||n instanceof Rr(n).ShadowRoot}const H7=new Set(["inline","contents"]);function wd(n){const{overflow:e,overflowX:t,overflowY:r,display:i}=pi(n);return/auto|scroll|overlay|hidden|clip/.test(e+r+t)&&!H7.has(i)}const $7=new Set(["table","td","th"]);function W7(n){return $7.has(zu(n))}const q7=[":popover-open",":modal"];function I_(n){return q7.some(e=>{try{return n.matches(e)}catch{return!1}})}const X7=["transform","translate","scale","rotate","perspective"],Y7=["transform","translate","scale","rotate","perspective","filter"],K7=["paint","layout","strict","content"];function qw(n){const e=Xw(),t=di(n)?pi(n):n;return X7.some(r=>t[r]?t[r]!=="none":!1)||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||Y7.some(r=>(t.willChange||"").includes(r))||K7.some(r=>(t.contain||"").includes(r))}function G7(n){let e=pa(n);for(;Zi(e)&&!yu(e);){if(qw(e))return e;if(I_(e))return null;e=pa(e)}return null}function Xw(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const Z7=new Set(["html","body","#document"]);function yu(n){return Z7.has(zu(n))}function pi(n){return Rr(n).getComputedStyle(n)}function P_(n){return di(n)?{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}:{scrollLeft:n.scrollX,scrollTop:n.scrollY}}function pa(n){if(zu(n)==="html")return n;const e=n.assignedSlot||n.parentNode||P3(n)&&n.host||Ji(n);return P3(e)?e.host:e}function HO(n){const e=pa(n);return yu(e)?n.ownerDocument?n.ownerDocument.body:n.body:Zi(e)&&wd(e)?e:HO(e)}function Jf(n,e,t){var r;e===void 0&&(e=[]),t===void 0&&(t=!0);const i=HO(n),s=i===((r=n.ownerDocument)==null?void 0:r.body),o=Rr(i);if(s){const l=Y0(o);return e.concat(o,o.visualViewport||[],wd(i)?i:[],l&&t?Jf(l):[])}return e.concat(i,Jf(i,[],t))}function Y0(n){return n.parent&&Object.getPrototypeOf(n.parent)?n.frameElement:null}function $O(n){const e=pi(n);let t=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const i=Zi(n),s=i?n.offsetWidth:t,o=i?n.offsetHeight:r,l=Um(t)!==s||Um(r)!==o;return l&&(t=s,r=o),{width:t,height:r,$:l}}function Yw(n){return di(n)?n:n.contextElement}function ru(n){const e=Yw(n);if(!Zi(e))return Xi(1);const t=e.getBoundingClientRect(),{width:r,height:i,$:s}=$O(e);let o=(s?Um(t.width):t.width)/r,l=(s?Um(t.height):t.height)/i;return(!o||!Number.isFinite(o))&&(o=1),(!l||!Number.isFinite(l))&&(l=1),{x:o,y:l}}const Q7=Xi(0);function WO(n){const e=Rr(n);return!Xw()||!e.visualViewport?Q7:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function J7(n,e,t){return e===void 0&&(e=!1),!t||e&&t!==Rr(n)?!1:e}function wl(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=!1);const i=n.getBoundingClientRect(),s=Yw(n);let o=Xi(1);e&&(r?di(r)&&(o=ru(r)):o=ru(n));const l=J7(s,t,r)?WO(s):Xi(0);let u=(i.left+l.x)/o.x,h=(i.top+l.y)/o.y,d=i.width/o.x,g=i.height/o.y;if(s){const y=Rr(s),b=r&&di(r)?Rr(r):r;let w=y,E=Y0(w);for(;E&&r&&b!==w;){const x=ru(E),C=E.getBoundingClientRect(),M=pi(E),O=C.left+(E.clientLeft+parseFloat(M.paddingLeft))*x.x,V=C.top+(E.clientTop+parseFloat(M.paddingTop))*x.y;u*=x.x,h*=x.y,d*=x.x,g*=x.y,u+=O,h+=V,w=Rr(E),E=Y0(w)}}return Bm({width:d,height:g,x:u,y:h})}function M_(n,e){const t=P_(n).scrollLeft;return e?e.left+t:wl(Ji(n)).left+t}function qO(n,e){const t=n.getBoundingClientRect(),r=t.left+e.scrollLeft-M_(n,t),i=t.top+e.scrollTop;return{x:r,y:i}}function eH(n){let{elements:e,rect:t,offsetParent:r,strategy:i}=n;const s=i==="fixed",o=Ji(r),l=e?I_(e.floating):!1;if(r===o||l&&s)return t;let u={scrollLeft:0,scrollTop:0},h=Xi(1);const d=Xi(0),g=Zi(r);if((g||!g&&!s)&&((zu(r)!=="body"||wd(o))&&(u=P_(r)),Zi(r))){const b=wl(r);h=ru(r),d.x=b.x+r.clientLeft,d.y=b.y+r.clientTop}const y=o&&!g&&!s?qO(o,u):Xi(0);return{width:t.width*h.x,height:t.height*h.y,x:t.x*h.x-u.scrollLeft*h.x+d.x+y.x,y:t.y*h.y-u.scrollTop*h.y+d.y+y.y}}function tH(n){return Array.from(n.getClientRects())}function nH(n){const e=Ji(n),t=P_(n),r=n.ownerDocument.body,i=xr(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),s=xr(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let o=-t.scrollLeft+M_(n);const l=-t.scrollTop;return pi(r).direction==="rtl"&&(o+=xr(e.clientWidth,r.clientWidth)-i),{width:i,height:s,x:o,y:l}}const M3=25;function rH(n,e){const t=Rr(n),r=Ji(n),i=t.visualViewport;let s=r.clientWidth,o=r.clientHeight,l=0,u=0;if(i){s=i.width,o=i.height;const d=Xw();(!d||d&&e==="fixed")&&(l=i.offsetLeft,u=i.offsetTop)}const h=M_(r);if(h<=0){const d=r.ownerDocument,g=d.body,y=getComputedStyle(g),b=d.compatMode==="CSS1Compat"&&parseFloat(y.marginLeft)+parseFloat(y.marginRight)||0,w=Math.abs(r.clientWidth-g.clientWidth-b);w<=M3&&(s-=w)}else h<=M3&&(s+=h);return{width:s,height:o,x:l,y:u}}const iH=new Set(["absolute","fixed"]);function sH(n,e){const t=wl(n,!0,e==="fixed"),r=t.top+n.clientTop,i=t.left+n.clientLeft,s=Zi(n)?ru(n):Xi(1),o=n.clientWidth*s.x,l=n.clientHeight*s.y,u=i*s.x,h=r*s.y;return{width:o,height:l,x:u,y:h}}function O3(n,e,t){let r;if(e==="viewport")r=rH(n,t);else if(e==="document")r=nH(Ji(n));else if(di(e))r=sH(e,t);else{const i=WO(n);r={x:e.x-i.x,y:e.y-i.y,width:e.width,height:e.height}}return Bm(r)}function XO(n,e){const t=pa(n);return t===e||!di(t)||yu(t)?!1:pi(t).position==="fixed"||XO(t,e)}function oH(n,e){const t=e.get(n);if(t)return t;let r=Jf(n,[],!1).filter(l=>di(l)&&zu(l)!=="body"),i=null;const s=pi(n).position==="fixed";let o=s?pa(n):n;for(;di(o)&&!yu(o);){const l=pi(o),u=qw(o);!u&&l.position==="fixed"&&(i=null),(s?!u&&!i:!u&&l.position==="static"&&!!i&&iH.has(i.position)||wd(o)&&!u&&XO(n,o))?r=r.filter(d=>d!==o):i=l,o=pa(o)}return e.set(n,r),r}function aH(n){let{element:e,boundary:t,rootBoundary:r,strategy:i}=n;const o=[...t==="clippingAncestors"?I_(e)?[]:oH(e,this._c):[].concat(t),r],l=o[0],u=o.reduce((h,d)=>{const g=O3(e,d,i);return h.top=xr(g.top,h.top),h.right=da(g.right,h.right),h.bottom=da(g.bottom,h.bottom),h.left=xr(g.left,h.left),h},O3(e,l,i));return{width:u.right-u.left,height:u.bottom-u.top,x:u.left,y:u.top}}function lH(n){const{width:e,height:t}=$O(n);return{width:e,height:t}}function cH(n,e,t){const r=Zi(e),i=Ji(e),s=t==="fixed",o=wl(n,!0,s,e);let l={scrollLeft:0,scrollTop:0};const u=Xi(0);function h(){u.x=M_(i)}if(r||!r&&!s)if((zu(e)!=="body"||wd(i))&&(l=P_(e)),r){const b=wl(e,!0,s,e);u.x=b.x+e.clientLeft,u.y=b.y+e.clientTop}else i&&h();s&&!r&&i&&h();const d=i&&!r&&!s?qO(i,l):Xi(0),g=o.left+l.scrollLeft-u.x-d.x,y=o.top+l.scrollTop-u.y-d.y;return{x:g,y,width:o.width,height:o.height}}function vb(n){return pi(n).position==="static"}function k3(n,e){if(!Zi(n)||pi(n).position==="fixed")return null;if(e)return e(n);let t=n.offsetParent;return Ji(n)===t&&(t=t.ownerDocument.body),t}function YO(n,e){const t=Rr(n);if(I_(n))return t;if(!Zi(n)){let i=pa(n);for(;i&&!yu(i);){if(di(i)&&!vb(i))return i;i=pa(i)}return t}let r=k3(n,e);for(;r&&W7(r)&&vb(r);)r=k3(r,e);return r&&yu(r)&&vb(r)&&!qw(r)?t:r||G7(n)||t}const uH=async function(n){const e=this.getOffsetParent||YO,t=this.getDimensions,r=await t(n.floating);return{reference:cH(n.reference,await e(n.floating),n.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function hH(n){return pi(n).direction==="rtl"}const fH={convertOffsetParentRelativeRectToViewportRelativeRect:eH,getDocumentElement:Ji,getClippingRect:aH,getOffsetParent:YO,getElementRects:uH,getClientRects:tH,getDimensions:lH,getScale:ru,isElement:di,isRTL:hH};function KO(n,e){return n.x===e.x&&n.y===e.y&&n.width===e.width&&n.height===e.height}function dH(n,e){let t=null,r;const i=Ji(n);function s(){var l;clearTimeout(r),(l=t)==null||l.disconnect(),t=null}function o(l,u){l===void 0&&(l=!1),u===void 0&&(u=1),s();const h=n.getBoundingClientRect(),{left:d,top:g,width:y,height:b}=h;if(l||e(),!y||!b)return;const w=ig(g),E=ig(i.clientWidth-(d+y)),x=ig(i.clientHeight-(g+b)),C=ig(d),O={rootMargin:-w+"px "+-E+"px "+-x+"px "+-C+"px",threshold:xr(0,da(1,u))||1};let V=!0;function H(G){const D=G[0].intersectionRatio;if(D!==u){if(!V)return o();D?o(!1,D):r=setTimeout(()=>{o(!1,1e-7)},1e3)}D===1&&!KO(h,n.getBoundingClientRect())&&o(),V=!1}try{t=new IntersectionObserver(H,{...O,root:i.ownerDocument})}catch{t=new IntersectionObserver(H,O)}t.observe(n)}return o(!0),s}function pH(n,e,t,r){r===void 0&&(r={});const{ancestorScroll:i=!0,ancestorResize:s=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:l=typeof IntersectionObserver=="function",animationFrame:u=!1}=r,h=Yw(n),d=i||s?[...h?Jf(h):[],...Jf(e)]:[];d.forEach(C=>{i&&C.addEventListener("scroll",t,{passive:!0}),s&&C.addEventListener("resize",t)});const g=h&&l?dH(h,t):null;let y=-1,b=null;o&&(b=new ResizeObserver(C=>{let[M]=C;M&&M.target===h&&b&&(b.unobserve(e),cancelAnimationFrame(y),y=requestAnimationFrame(()=>{var O;(O=b)==null||O.observe(e)})),t()}),h&&!u&&b.observe(h),b.observe(e));let w,E=u?wl(n):null;u&&x();function x(){const C=wl(n);E&&!KO(E,C)&&t(),E=C,w=requestAnimationFrame(x)}return t(),()=>{var C;d.forEach(M=>{i&&M.removeEventListener("scroll",t),s&&M.removeEventListener("resize",t)}),g?.(),(C=b)==null||C.disconnect(),b=null,u&&cancelAnimationFrame(w)}}const gH=B7,mH=V7,_H=L7,yH=j7,vH=U7,N3=D7,bH=z7,TH=(n,e,t)=>{const r=new Map,i={platform:fH,...t},s={...i.platform,_c:r};return N7(n,e,{...i,platform:s})};var wH=typeof document<"u",EH=function(){},Gg=wH?R.useLayoutEffect:EH;function Vm(n,e){if(n===e)return!0;if(typeof n!=typeof e)return!1;if(typeof n=="function"&&n.toString()===e.toString())return!0;let t,r,i;if(n&&e&&typeof n=="object"){if(Array.isArray(n)){if(t=n.length,t!==e.length)return!1;for(r=t;r--!==0;)if(!Vm(n[r],e[r]))return!1;return!0}if(i=Object.keys(n),t=i.length,t!==Object.keys(e).length)return!1;for(r=t;r--!==0;)if(!{}.hasOwnProperty.call(e,i[r]))return!1;for(r=t;r--!==0;){const s=i[r];if(!(s==="_owner"&&n.$$typeof)&&!Vm(n[s],e[s]))return!1}return!0}return n!==n&&e!==e}function GO(n){return typeof window>"u"?1:(n.ownerDocument.defaultView||window).devicePixelRatio||1}function D3(n,e){const t=GO(n);return Math.round(e*t)/t}function bb(n){const e=R.useRef(n);return Gg(()=>{e.current=n}),e}function xH(n){n===void 0&&(n={});const{placement:e="bottom",strategy:t="absolute",middleware:r=[],platform:i,elements:{reference:s,floating:o}={},transform:l=!0,whileElementsMounted:u,open:h}=n,[d,g]=R.useState({x:0,y:0,strategy:t,placement:e,middlewareData:{},isPositioned:!1}),[y,b]=R.useState(r);Vm(y,r)||b(r);const[w,E]=R.useState(null),[x,C]=R.useState(null),M=R.useCallback(U=>{U!==G.current&&(G.current=U,E(U))},[]),O=R.useCallback(U=>{U!==D.current&&(D.current=U,C(U))},[]),V=s||w,H=o||x,G=R.useRef(null),D=R.useRef(null),I=R.useRef(d),N=u!=null,j=bb(u),W=bb(i),Y=bb(h),z=R.useCallback(()=>{if(!G.current||!D.current)return;const U={placement:e,strategy:t,middleware:y};W.current&&(U.platform=W.current),TH(G.current,D.current,U).then(oe=>{const L={...oe,isPositioned:Y.current!==!1};de.current&&!Vm(I.current,L)&&(I.current=L,YT.flushSync(()=>{g(L)}))})},[y,e,t,W,Y]);Gg(()=>{h===!1&&I.current.isPositioned&&(I.current.isPositioned=!1,g(U=>({...U,isPositioned:!1})))},[h]);const de=R.useRef(!1);Gg(()=>(de.current=!0,()=>{de.current=!1}),[]),Gg(()=>{if(V&&(G.current=V),H&&(D.current=H),V&&H){if(j.current)return j.current(V,H,z);z()}},[V,H,z,j,N]);const xe=R.useMemo(()=>({reference:G,floating:D,setReference:M,setFloating:O}),[M,O]),P=R.useMemo(()=>({reference:V,floating:H}),[V,H]),q=R.useMemo(()=>{const U={position:t,left:0,top:0};if(!P.floating)return U;const oe=D3(P.floating,d.x),L=D3(P.floating,d.y);return l?{...U,transform:"translate("+oe+"px, "+L+"px)",...GO(P.floating)>=1.5&&{willChange:"transform"}}:{position:t,left:oe,top:L}},[t,l,P.floating,d.x,d.y]);return R.useMemo(()=>({...d,update:z,refs:xe,elements:P,floatingStyles:q}),[d,z,xe,P,q])}const AH=n=>{function e(t){return{}.hasOwnProperty.call(t,"current")}return{name:"arrow",options:n,fn(t){const{element:r,padding:i}=typeof n=="function"?n(t):n;return r&&e(r)?r.current!=null?N3({element:r.current,padding:i}).fn(t):{}:r?N3({element:r,padding:i}).fn(t):{}}}},SH=(n,e)=>({...gH(n),options:[n,e]}),RH=(n,e)=>({...mH(n),options:[n,e]}),CH=(n,e)=>({...bH(n),options:[n,e]}),IH=(n,e)=>({..._H(n),options:[n,e]}),PH=(n,e)=>({...yH(n),options:[n,e]}),MH=(n,e)=>({...vH(n),options:[n,e]}),OH=(n,e)=>({...AH(n),options:[n,e]});var kH="Arrow",ZO=R.forwardRef((n,e)=>{const{children:t,width:r=10,height:i=5,...s}=n;return X.jsx(Ln.svg,{...s,ref:e,width:r,height:i,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:n.asChild?t:X.jsx("polygon",{points:"0,0 30,0 15,10"})})});ZO.displayName=kH;var NH=ZO;function QO(n){const[e,t]=R.useState(void 0);return Vs(()=>{if(n){t({width:n.offsetWidth,height:n.offsetHeight});const r=new ResizeObserver(i=>{if(!Array.isArray(i)||!i.length)return;const s=i[0];let o,l;if("borderBoxSize"in s){const u=s.borderBoxSize,h=Array.isArray(u)?u[0]:u;o=h.inlineSize,l=h.blockSize}else o=n.offsetWidth,l=n.offsetHeight;t({width:o,height:l})});return r.observe(n,{box:"border-box"}),()=>r.unobserve(n)}else t(void 0)},[n]),e}var Kw="Popper",[JO,ek]=Bu(Kw),[DH,tk]=JO(Kw),nk=n=>{const{__scopePopper:e,children:t}=n,[r,i]=R.useState(null);return X.jsx(DH,{scope:e,anchor:r,onAnchorChange:i,children:t})};nk.displayName=Kw;var rk="PopperAnchor",ik=R.forwardRef((n,e)=>{const{__scopePopper:t,virtualRef:r,...i}=n,s=tk(rk,t),o=R.useRef(null),l=hr(e,o),u=R.useRef(null);return R.useEffect(()=>{const h=u.current;u.current=r?.current||o.current,h!==u.current&&s.onAnchorChange(u.current)}),r?null:X.jsx(Ln.div,{...i,ref:l})});ik.displayName=rk;var Gw="PopperContent",[LH,UH]=JO(Gw),sk=R.forwardRef((n,e)=>{const{__scopePopper:t,side:r="bottom",sideOffset:i=0,align:s="center",alignOffset:o=0,arrowPadding:l=0,avoidCollisions:u=!0,collisionBoundary:h=[],collisionPadding:d=0,sticky:g="partial",hideWhenDetached:y=!1,updatePositionStrategy:b="optimized",onPlaced:w,...E}=n,x=tk(Gw,t),[C,M]=R.useState(null),O=hr(e,Ce=>M(Ce)),[V,H]=R.useState(null),G=QO(V),D=G?.width??0,I=G?.height??0,N=r+(s!=="center"?"-"+s:""),j=typeof d=="number"?d:{top:0,right:0,bottom:0,left:0,...d},W=Array.isArray(h)?h:[h],Y=W.length>0,z={padding:j,boundary:W.filter(BH),altBoundary:Y},{refs:de,floatingStyles:xe,placement:P,isPositioned:q,middlewareData:U}=xH({strategy:"fixed",placement:N,whileElementsMounted:(...Ce)=>pH(...Ce,{animationFrame:b==="always"}),elements:{reference:x.anchor},middleware:[SH({mainAxis:i+I,alignmentAxis:o}),u&&RH({mainAxis:!0,crossAxis:!1,limiter:g==="partial"?CH():void 0,...z}),u&&IH({...z}),PH({...z,apply:({elements:Ce,rects:Me,availableWidth:at,availableHeight:Ke})=>{const{width:mn,height:on}=Me.reference,Gn=Ce.floating.style;Gn.setProperty("--radix-popper-available-width",`${at}px`),Gn.setProperty("--radix-popper-available-height",`${Ke}px`),Gn.setProperty("--radix-popper-anchor-width",`${mn}px`),Gn.setProperty("--radix-popper-anchor-height",`${on}px`)}}),V&&OH({element:V,padding:l}),VH({arrowWidth:D,arrowHeight:I}),y&&MH({strategy:"referenceHidden",...z})]}),[oe,L]=lk(P),Z=_u(w);Vs(()=>{q&&Z?.()},[q,Z]);const ie=U.arrow?.x,ae=U.arrow?.y,me=U.arrow?.centerOffset!==0,[Ee,Se]=R.useState();return Vs(()=>{C&&Se(window.getComputedStyle(C).zIndex)},[C]),X.jsx("div",{ref:de.setFloating,"data-radix-popper-content-wrapper":"",style:{...xe,transform:q?xe.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Ee,"--radix-popper-transform-origin":[U.transformOrigin?.x,U.transformOrigin?.y].join(" "),...U.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:n.dir,children:X.jsx(LH,{scope:t,placedSide:oe,onArrowChange:H,arrowX:ie,arrowY:ae,shouldHideArrow:me,children:X.jsx(Ln.div,{"data-side":oe,"data-align":L,...E,ref:O,style:{...E.style,animation:q?void 0:"none"}})})})});sk.displayName=Gw;var ok="PopperArrow",FH={top:"bottom",right:"left",bottom:"top",left:"right"},ak=R.forwardRef(function(e,t){const{__scopePopper:r,...i}=e,s=UH(ok,r),o=FH[s.placedSide];return X.jsx("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0},children:X.jsx(NH,{...i,ref:t,style:{...i.style,display:"block"}})})});ak.displayName=ok;function BH(n){return n!==null}var VH=n=>({name:"transformOrigin",options:n,fn(e){const{placement:t,rects:r,middlewareData:i}=e,o=i.arrow?.centerOffset!==0,l=o?0:n.arrowWidth,u=o?0:n.arrowHeight,[h,d]=lk(t),g={start:"0%",center:"50%",end:"100%"}[d],y=(i.arrow?.x??0)+l/2,b=(i.arrow?.y??0)+u/2;let w="",E="";return h==="bottom"?(w=o?g:`${y}px`,E=`${-u}px`):h==="top"?(w=o?g:`${y}px`,E=`${r.floating.height+u}px`):h==="right"?(w=`${-u}px`,E=o?g:`${b}px`):h==="left"&&(w=`${r.floating.width+u}px`,E=o?g:`${b}px`),{data:{x:w,y:E}}}});function lk(n){const[e,t="center"]=n.split("-");return[e,t]}var zH=nk,ck=ik,jH=sk,HH=ak,$H="Portal",uk=R.forwardRef((n,e)=>{const{container:t,...r}=n,[i,s]=R.useState(!1);Vs(()=>s(!0),[]);const o=t||i&&globalThis?.document?.body;return o?gF.createPortal(X.jsx(Ln.div,{...r,ref:e}),o):null});uk.displayName=$H;function WH(n,e){return R.useReducer((t,r)=>e[t][r]??t,n)}var Ed=n=>{const{present:e,children:t}=n,r=qH(e),i=typeof t=="function"?t({present:r.isPresent}):R.Children.only(t),s=hr(r.ref,XH(i));return typeof t=="function"||r.isPresent?R.cloneElement(i,{ref:s}):null};Ed.displayName="Presence";function qH(n){const[e,t]=R.useState(),r=R.useRef(null),i=R.useRef(n),s=R.useRef("none"),o=n?"mounted":"unmounted",[l,u]=WH(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return R.useEffect(()=>{const h=sg(r.current);s.current=l==="mounted"?h:"none"},[l]),Vs(()=>{const h=r.current,d=i.current;if(d!==n){const y=s.current,b=sg(h);n?u("MOUNT"):b==="none"||h?.display==="none"?u("UNMOUNT"):u(d&&y!==b?"ANIMATION_OUT":"UNMOUNT"),i.current=n}},[n,u]),Vs(()=>{if(e){let h;const d=e.ownerDocument.defaultView??window,g=b=>{const E=sg(r.current).includes(CSS.escape(b.animationName));if(b.target===e&&E&&(u("ANIMATION_END"),!i.current)){const x=e.style.animationFillMode;e.style.animationFillMode="forwards",h=d.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=x)})}},y=b=>{b.target===e&&(s.current=sg(r.current))};return e.addEventListener("animationstart",y),e.addEventListener("animationcancel",g),e.addEventListener("animationend",g),()=>{d.clearTimeout(h),e.removeEventListener("animationstart",y),e.removeEventListener("animationcancel",g),e.removeEventListener("animationend",g)}}else u("ANIMATION_END")},[e,u]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:R.useCallback(h=>{r.current=h?getComputedStyle(h):null,t(h)},[])}}function sg(n){return n?.animationName||"none"}function XH(n){let e=Object.getOwnPropertyDescriptor(n.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=Object.getOwnPropertyDescriptor(n,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}var YH=jI[" useInsertionEffect ".trim().toString()]||Vs;function xd({prop:n,defaultProp:e,onChange:t=()=>{},caller:r}){const[i,s,o]=KH({defaultProp:e,onChange:t}),l=n!==void 0,u=l?n:i;{const d=R.useRef(n!==void 0);R.useEffect(()=>{const g=d.current;g!==l&&console.warn(`${r} is changing from ${g?"controlled":"uncontrolled"} to ${l?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),d.current=l},[l,r])}const h=R.useCallback(d=>{if(l){const g=GH(d)?d(n):d;g!==n&&o.current?.(g)}else s(d)},[l,n,s,o]);return[u,h]}function KH({defaultProp:n,onChange:e}){const[t,r]=R.useState(n),i=R.useRef(t),s=R.useRef(e);return YH(()=>{s.current=e},[e]),R.useEffect(()=>{i.current!==t&&(s.current?.(t),i.current=t)},[t,i]),[t,r,s]}function GH(n){return typeof n=="function"}var ZH=function(n){if(typeof document>"u")return null;var e=Array.isArray(n)?n[0]:n;return e.ownerDocument.body},Ac=new WeakMap,og=new WeakMap,ag={},Tb=0,hk=function(n){return n&&(n.host||hk(n.parentNode))},QH=function(n,e){return e.map(function(t){if(n.contains(t))return t;var r=hk(t);return r&&n.contains(r)?r:(console.error("aria-hidden",t,"in not contained inside",n,". Doing nothing"),null)}).filter(function(t){return!!t})},JH=function(n,e,t,r){var i=QH(e,Array.isArray(n)?n:[n]);ag[t]||(ag[t]=new WeakMap);var s=ag[t],o=[],l=new Set,u=new Set(i),h=function(g){!g||l.has(g)||(l.add(g),h(g.parentNode))};i.forEach(h);var d=function(g){!g||u.has(g)||Array.prototype.forEach.call(g.children,function(y){if(l.has(y))d(y);else try{var b=y.getAttribute(r),w=b!==null&&b!=="false",E=(Ac.get(y)||0)+1,x=(s.get(y)||0)+1;Ac.set(y,E),s.set(y,x),o.push(y),E===1&&w&&og.set(y,!0),x===1&&y.setAttribute(t,"true"),w||y.setAttribute(r,"true")}catch(C){console.error("aria-hidden: cannot operate on ",y,C)}})};return d(e),l.clear(),Tb++,function(){o.forEach(function(g){var y=Ac.get(g)-1,b=s.get(g)-1;Ac.set(g,y),s.set(g,b),y||(og.has(g)||g.removeAttribute(r),og.delete(g)),b||g.removeAttribute(t)}),Tb--,Tb||(Ac=new WeakMap,Ac=new WeakMap,og=new WeakMap,ag={})}},e$=function(n,e,t){t===void 0&&(t="data-aria-hidden");var r=Array.from(Array.isArray(n)?n:[n]),i=ZH(n);return i?(r.push.apply(r,Array.from(i.querySelectorAll("[aria-live], script"))),JH(r,i,t,"aria-hidden")):function(){return null}},Ui=function(){return Ui=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},Ui.apply(this,arguments)};function fk(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t}function t$(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))}var Zg="right-scroll-bar-position",Qg="width-before-scroll-bar",n$="with-scroll-bars-hidden",r$="--removed-body-scroll-bar-size";function wb(n,e){return typeof n=="function"?n(e):n&&(n.current=e),n}function i$(n,e){var t=R.useState(function(){return{value:n,callback:e,facade:{get current(){return t.value},set current(r){var i=t.value;i!==r&&(t.value=r,t.callback(r,i))}}}})[0];return t.callback=e,t.facade}var s$=typeof window<"u"?R.useLayoutEffect:R.useEffect,L3=new WeakMap;function o$(n,e){var t=i$(null,function(r){return n.forEach(function(i){return wb(i,r)})});return s$(function(){var r=L3.get(t);if(r){var i=new Set(r),s=new Set(n),o=t.current;i.forEach(function(l){s.has(l)||wb(l,null)}),s.forEach(function(l){i.has(l)||wb(l,o)})}L3.set(t,n)},[n]),t}function a$(n){return n}function l$(n,e){e===void 0&&(e=a$);var t=[],r=!1,i={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return t.length?t[t.length-1]:n},useMedium:function(s){var o=e(s,r);return t.push(o),function(){t=t.filter(function(l){return l!==o})}},assignSyncMedium:function(s){for(r=!0;t.length;){var o=t;t=[],o.forEach(s)}t={push:function(l){return s(l)},filter:function(){return t}}},assignMedium:function(s){r=!0;var o=[];if(t.length){var l=t;t=[],l.forEach(s),o=t}var u=function(){var d=o;o=[],d.forEach(s)},h=function(){return Promise.resolve().then(u)};h(),t={push:function(d){o.push(d),h()},filter:function(d){return o=o.filter(d),t}}}};return i}function c$(n){n===void 0&&(n={});var e=l$(null);return e.options=Ui({async:!0,ssr:!1},n),e}var dk=function(n){var e=n.sideCar,t=fk(n,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=e.read();if(!r)throw new Error("Sidecar medium not found");return R.createElement(r,Ui({},t))};dk.isSideCarExport=!0;function u$(n,e){return n.useMedium(e),dk}var pk=c$(),Eb=function(){},O_=R.forwardRef(function(n,e){var t=R.useRef(null),r=R.useState({onScrollCapture:Eb,onWheelCapture:Eb,onTouchMoveCapture:Eb}),i=r[0],s=r[1],o=n.forwardProps,l=n.children,u=n.className,h=n.removeScrollBar,d=n.enabled,g=n.shards,y=n.sideCar,b=n.noRelative,w=n.noIsolation,E=n.inert,x=n.allowPinchZoom,C=n.as,M=C===void 0?"div":C,O=n.gapMode,V=fk(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),H=y,G=o$([t,e]),D=Ui(Ui({},V),i);return R.createElement(R.Fragment,null,d&&R.createElement(H,{sideCar:pk,removeScrollBar:h,shards:g,noRelative:b,noIsolation:w,inert:E,setCallbacks:s,allowPinchZoom:!!x,lockRef:t,gapMode:O}),o?R.cloneElement(R.Children.only(l),Ui(Ui({},D),{ref:G})):R.createElement(M,Ui({},D,{className:u,ref:G}),l))});O_.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};O_.classNames={fullWidth:Qg,zeroRight:Zg};var h$=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function f$(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var e=h$();return e&&n.setAttribute("nonce",e),n}function d$(n,e){n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}function p$(n){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(n)}var g$=function(){var n=0,e=null;return{add:function(t){n==0&&(e=f$())&&(d$(e,t),p$(e)),n++},remove:function(){n--,!n&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},m$=function(){var n=g$();return function(e,t){R.useEffect(function(){return n.add(e),function(){n.remove()}},[e&&t])}},gk=function(){var n=m$(),e=function(t){var r=t.styles,i=t.dynamic;return n(r,i),null};return e},_$={left:0,top:0,right:0,gap:0},xb=function(n){return parseInt(n||"",10)||0},y$=function(n){var e=window.getComputedStyle(document.body),t=e[n==="padding"?"paddingLeft":"marginLeft"],r=e[n==="padding"?"paddingTop":"marginTop"],i=e[n==="padding"?"paddingRight":"marginRight"];return[xb(t),xb(r),xb(i)]},v$=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return _$;var e=y$(n),t=document.documentElement.clientWidth,r=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,r-t+e[2]-e[0])}},b$=gk(),iu="data-scroll-locked",T$=function(n,e,t,r){var i=n.left,s=n.top,o=n.right,l=n.gap;return t===void 0&&(t="margin"),`
  .`.concat(n$,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(l,"px ").concat(r,`;
  }
  body[`).concat(iu,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(r,";"),t==="margin"&&`
    padding-left: `.concat(i,`px;
    padding-top: `).concat(s,`px;
    padding-right: `).concat(o,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(l,"px ").concat(r,`;
    `),t==="padding"&&"padding-right: ".concat(l,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Zg,` {
    right: `).concat(l,"px ").concat(r,`;
  }
  
  .`).concat(Qg,` {
    margin-right: `).concat(l,"px ").concat(r,`;
  }
  
  .`).concat(Zg," .").concat(Zg,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(Qg," .").concat(Qg,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(iu,`] {
    `).concat(r$,": ").concat(l,`px;
  }
`)},U3=function(){var n=parseInt(document.body.getAttribute(iu)||"0",10);return isFinite(n)?n:0},w$=function(){R.useEffect(function(){return document.body.setAttribute(iu,(U3()+1).toString()),function(){var n=U3()-1;n<=0?document.body.removeAttribute(iu):document.body.setAttribute(iu,n.toString())}},[])},E$=function(n){var e=n.noRelative,t=n.noImportant,r=n.gapMode,i=r===void 0?"margin":r;w$();var s=R.useMemo(function(){return v$(i)},[i]);return R.createElement(b$,{styles:T$(s,!e,i,t?"":"!important")})},K0=!1;if(typeof window<"u")try{var lg=Object.defineProperty({},"passive",{get:function(){return K0=!0,!0}});window.addEventListener("test",lg,lg),window.removeEventListener("test",lg,lg)}catch{K0=!1}var Sc=K0?{passive:!1}:!1,x$=function(n){return n.tagName==="TEXTAREA"},mk=function(n,e){if(!(n instanceof Element))return!1;var t=window.getComputedStyle(n);return t[e]!=="hidden"&&!(t.overflowY===t.overflowX&&!x$(n)&&t[e]==="visible")},A$=function(n){return mk(n,"overflowY")},S$=function(n){return mk(n,"overflowX")},F3=function(n,e){var t=e.ownerDocument,r=e;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var i=_k(n,r);if(i){var s=yk(n,r),o=s[1],l=s[2];if(o>l)return!0}r=r.parentNode}while(r&&r!==t.body);return!1},R$=function(n){var e=n.scrollTop,t=n.scrollHeight,r=n.clientHeight;return[e,t,r]},C$=function(n){var e=n.scrollLeft,t=n.scrollWidth,r=n.clientWidth;return[e,t,r]},_k=function(n,e){return n==="v"?A$(e):S$(e)},yk=function(n,e){return n==="v"?R$(e):C$(e)},I$=function(n,e){return n==="h"&&e==="rtl"?-1:1},P$=function(n,e,t,r,i){var s=I$(n,window.getComputedStyle(e).direction),o=s*r,l=t.target,u=e.contains(l),h=!1,d=o>0,g=0,y=0;do{if(!l)break;var b=yk(n,l),w=b[0],E=b[1],x=b[2],C=E-x-s*w;(w||C)&&_k(n,l)&&(g+=C,y+=w);var M=l.parentNode;l=M&&M.nodeType===Node.DOCUMENT_FRAGMENT_NODE?M.host:M}while(!u&&l!==document.body||u&&(e.contains(l)||e===l));return(d&&Math.abs(g)<1||!d&&Math.abs(y)<1)&&(h=!0),h},cg=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},B3=function(n){return[n.deltaX,n.deltaY]},V3=function(n){return n&&"current"in n?n.current:n},M$=function(n,e){return n[0]===e[0]&&n[1]===e[1]},O$=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},k$=0,Rc=[];function N$(n){var e=R.useRef([]),t=R.useRef([0,0]),r=R.useRef(),i=R.useState(k$++)[0],s=R.useState(gk)[0],o=R.useRef(n);R.useEffect(function(){o.current=n},[n]),R.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(i));var E=t$([n.lockRef.current],(n.shards||[]).map(V3),!0).filter(Boolean);return E.forEach(function(x){return x.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),E.forEach(function(x){return x.classList.remove("allow-interactivity-".concat(i))})}}},[n.inert,n.lockRef.current,n.shards]);var l=R.useCallback(function(E,x){if("touches"in E&&E.touches.length===2||E.type==="wheel"&&E.ctrlKey)return!o.current.allowPinchZoom;var C=cg(E),M=t.current,O="deltaX"in E?E.deltaX:M[0]-C[0],V="deltaY"in E?E.deltaY:M[1]-C[1],H,G=E.target,D=Math.abs(O)>Math.abs(V)?"h":"v";if("touches"in E&&D==="h"&&G.type==="range")return!1;var I=F3(D,G);if(!I)return!0;if(I?H=D:(H=D==="v"?"h":"v",I=F3(D,G)),!I)return!1;if(!r.current&&"changedTouches"in E&&(O||V)&&(r.current=H),!H)return!0;var N=r.current||H;return P$(N,x,E,N==="h"?O:V)},[]),u=R.useCallback(function(E){var x=E;if(!(!Rc.length||Rc[Rc.length-1]!==s)){var C="deltaY"in x?B3(x):cg(x),M=e.current.filter(function(H){return H.name===x.type&&(H.target===x.target||x.target===H.shadowParent)&&M$(H.delta,C)})[0];if(M&&M.should){x.cancelable&&x.preventDefault();return}if(!M){var O=(o.current.shards||[]).map(V3).filter(Boolean).filter(function(H){return H.contains(x.target)}),V=O.length>0?l(x,O[0]):!o.current.noIsolation;V&&x.cancelable&&x.preventDefault()}}},[]),h=R.useCallback(function(E,x,C,M){var O={name:E,delta:x,target:C,should:M,shadowParent:D$(C)};e.current.push(O),setTimeout(function(){e.current=e.current.filter(function(V){return V!==O})},1)},[]),d=R.useCallback(function(E){t.current=cg(E),r.current=void 0},[]),g=R.useCallback(function(E){h(E.type,B3(E),E.target,l(E,n.lockRef.current))},[]),y=R.useCallback(function(E){h(E.type,cg(E),E.target,l(E,n.lockRef.current))},[]);R.useEffect(function(){return Rc.push(s),n.setCallbacks({onScrollCapture:g,onWheelCapture:g,onTouchMoveCapture:y}),document.addEventListener("wheel",u,Sc),document.addEventListener("touchmove",u,Sc),document.addEventListener("touchstart",d,Sc),function(){Rc=Rc.filter(function(E){return E!==s}),document.removeEventListener("wheel",u,Sc),document.removeEventListener("touchmove",u,Sc),document.removeEventListener("touchstart",d,Sc)}},[]);var b=n.removeScrollBar,w=n.inert;return R.createElement(R.Fragment,null,w?R.createElement(s,{styles:O$(i)}):null,b?R.createElement(E$,{noRelative:n.noRelative,gapMode:n.gapMode}):null)}function D$(n){for(var e=null;n!==null;)n instanceof ShadowRoot&&(e=n.host,n=n.host),n=n.parentNode;return e}const L$=u$(pk,N$);var vk=R.forwardRef(function(n,e){return R.createElement(O_,Ui({},n,{ref:e,sideCar:L$}))});vk.classNames=O_.classNames;var k_="Popover",[bk,Qle]=Bu(k_,[ek]),Ad=ek(),[U$,va]=bk(k_),Tk=n=>{const{__scopePopover:e,children:t,open:r,defaultOpen:i,onOpenChange:s,modal:o=!1}=n,l=Ad(e),u=R.useRef(null),[h,d]=R.useState(!1),[g,y]=xd({prop:r,defaultProp:i??!1,onChange:s,caller:k_});return X.jsx(zH,{...l,children:X.jsx(U$,{scope:e,contentId:jw(),triggerRef:u,open:g,onOpenChange:y,onOpenToggle:R.useCallback(()=>y(b=>!b),[y]),hasCustomAnchor:h,onCustomAnchorAdd:R.useCallback(()=>d(!0),[]),onCustomAnchorRemove:R.useCallback(()=>d(!1),[]),modal:o,children:t})})};Tk.displayName=k_;var wk="PopoverAnchor",F$=R.forwardRef((n,e)=>{const{__scopePopover:t,...r}=n,i=va(wk,t),s=Ad(t),{onCustomAnchorAdd:o,onCustomAnchorRemove:l}=i;return R.useEffect(()=>(o(),()=>l()),[o,l]),X.jsx(ck,{...s,...r,ref:e})});F$.displayName=wk;var Ek="PopoverTrigger",xk=R.forwardRef((n,e)=>{const{__scopePopover:t,...r}=n,i=va(Ek,t),s=Ad(t),o=hr(e,i.triggerRef),l=X.jsx(Ln.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":Ik(i.open),...r,ref:o,onClick:Hr(n.onClick,i.onOpenToggle)});return i.hasCustomAnchor?l:X.jsx(ck,{asChild:!0,...s,children:l})});xk.displayName=Ek;var Zw="PopoverPortal",[B$,V$]=bk(Zw,{forceMount:void 0}),Ak=n=>{const{__scopePopover:e,forceMount:t,children:r,container:i}=n,s=va(Zw,e);return X.jsx(B$,{scope:e,forceMount:t,children:X.jsx(Ed,{present:t||s.open,children:X.jsx(uk,{asChild:!0,container:i,children:r})})})};Ak.displayName=Zw;var vu="PopoverContent",Sk=R.forwardRef((n,e)=>{const t=V$(vu,n.__scopePopover),{forceMount:r=t.forceMount,...i}=n,s=va(vu,n.__scopePopover);return X.jsx(Ed,{present:r||s.open,children:s.modal?X.jsx(j$,{...i,ref:e}):X.jsx(H$,{...i,ref:e})})});Sk.displayName=vu;var z$=Lm("PopoverContent.RemoveScroll"),j$=R.forwardRef((n,e)=>{const t=va(vu,n.__scopePopover),r=R.useRef(null),i=hr(e,r),s=R.useRef(!1);return R.useEffect(()=>{const o=r.current;if(o)return e$(o)},[]),X.jsx(vk,{as:z$,allowPinchZoom:!0,children:X.jsx(Rk,{...n,ref:i,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Hr(n.onCloseAutoFocus,o=>{o.preventDefault(),s.current||t.triggerRef.current?.focus()}),onPointerDownOutside:Hr(n.onPointerDownOutside,o=>{const l=o.detail.originalEvent,u=l.button===0&&l.ctrlKey===!0,h=l.button===2||u;s.current=h},{checkForDefaultPrevented:!1}),onFocusOutside:Hr(n.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1})})})}),H$=R.forwardRef((n,e)=>{const t=va(vu,n.__scopePopover),r=R.useRef(!1),i=R.useRef(!1);return X.jsx(Rk,{...n,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{n.onCloseAutoFocus?.(s),s.defaultPrevented||(r.current||t.triggerRef.current?.focus(),s.preventDefault()),r.current=!1,i.current=!1},onInteractOutside:s=>{n.onInteractOutside?.(s),s.defaultPrevented||(r.current=!0,s.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const o=s.target;t.triggerRef.current?.contains(o)&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&i.current&&s.preventDefault()}})}),Rk=R.forwardRef((n,e)=>{const{__scopePopover:t,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:s,disableOutsidePointerEvents:o,onEscapeKeyDown:l,onPointerDownOutside:u,onFocusOutside:h,onInteractOutside:d,...g}=n,y=va(vu,t),b=Ad(t);return d7(),X.jsx(FO,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:s,children:X.jsx(LO,{asChild:!0,disableOutsidePointerEvents:o,onInteractOutside:d,onEscapeKeyDown:l,onPointerDownOutside:u,onFocusOutside:h,onDismiss:()=>y.onOpenChange(!1),children:X.jsx(jH,{"data-state":Ik(y.open),role:"dialog",id:y.contentId,...b,...g,ref:e,style:{...g.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Ck="PopoverClose",$$=R.forwardRef((n,e)=>{const{__scopePopover:t,...r}=n,i=va(Ck,t);return X.jsx(Ln.button,{type:"button",...r,ref:e,onClick:Hr(n.onClick,()=>i.onOpenChange(!1))})});$$.displayName=Ck;var W$="PopoverArrow",q$=R.forwardRef((n,e)=>{const{__scopePopover:t,...r}=n,i=Ad(t);return X.jsx(HH,{...i,...r,ref:e})});q$.displayName=W$;function Ik(n){return n?"open":"closed"}var X$=Tk,Y$=xk,K$=Ak,G$=Sk;function Pk(n){var e,t,r="";if(typeof n=="string"||typeof n=="number")r+=n;else if(typeof n=="object")if(Array.isArray(n)){var i=n.length;for(e=0;e<i;e++)n[e]&&(t=Pk(n[e]))&&(r&&(r+=" "),r+=t)}else for(t in n)n[t]&&(r&&(r+=" "),r+=t);return r}function Z$(){for(var n,e,t=0,r="",i=arguments.length;t<i;t++)(n=arguments[t])&&(e=Pk(n))&&(r&&(r+=" "),r+=e);return r}const Qw="-",Q$=n=>{const e=eW(n),{conflictingClassGroups:t,conflictingClassGroupModifiers:r}=n;return{getClassGroupId:o=>{const l=o.split(Qw);return l[0]===""&&l.length!==1&&l.shift(),Mk(l,e)||J$(o)},getConflictingClassGroupIds:(o,l)=>{const u=t[o]||[];return l&&r[o]?[...u,...r[o]]:u}}},Mk=(n,e)=>{if(n.length===0)return e.classGroupId;const t=n[0],r=e.nextPart.get(t),i=r?Mk(n.slice(1),r):void 0;if(i)return i;if(e.validators.length===0)return;const s=n.join(Qw);return e.validators.find(({validator:o})=>o(s))?.classGroupId},z3=/^\[(.+)\]$/,J$=n=>{if(z3.test(n)){const e=z3.exec(n)[1],t=e?.substring(0,e.indexOf(":"));if(t)return"arbitrary.."+t}},eW=n=>{const{theme:e,classGroups:t}=n,r={nextPart:new Map,validators:[]};for(const i in t)G0(t[i],r,i,e);return r},G0=(n,e,t,r)=>{n.forEach(i=>{if(typeof i=="string"){const s=i===""?e:j3(e,i);s.classGroupId=t;return}if(typeof i=="function"){if(tW(i)){G0(i(r),e,t,r);return}e.validators.push({validator:i,classGroupId:t});return}Object.entries(i).forEach(([s,o])=>{G0(o,j3(e,s),t,r)})})},j3=(n,e)=>{let t=n;return e.split(Qw).forEach(r=>{t.nextPart.has(r)||t.nextPart.set(r,{nextPart:new Map,validators:[]}),t=t.nextPart.get(r)}),t},tW=n=>n.isThemeGetter,nW=n=>{if(n<1)return{get:()=>{},set:()=>{}};let e=0,t=new Map,r=new Map;const i=(s,o)=>{t.set(s,o),e++,e>n&&(e=0,r=t,t=new Map)};return{get(s){let o=t.get(s);if(o!==void 0)return o;if((o=r.get(s))!==void 0)return i(s,o),o},set(s,o){t.has(s)?t.set(s,o):i(s,o)}}},Z0="!",Q0=":",rW=Q0.length,iW=n=>{const{prefix:e,experimentalParseClassName:t}=n;let r=i=>{const s=[];let o=0,l=0,u=0,h;for(let w=0;w<i.length;w++){let E=i[w];if(o===0&&l===0){if(E===Q0){s.push(i.slice(u,w)),u=w+rW;continue}if(E==="/"){h=w;continue}}E==="["?o++:E==="]"?o--:E==="("?l++:E===")"&&l--}const d=s.length===0?i:i.substring(u),g=sW(d),y=g!==d,b=h&&h>u?h-u:void 0;return{modifiers:s,hasImportantModifier:y,baseClassName:g,maybePostfixModifierPosition:b}};if(e){const i=e+Q0,s=r;r=o=>o.startsWith(i)?s(o.substring(i.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:o,maybePostfixModifierPosition:void 0}}if(t){const i=r;r=s=>t({className:s,parseClassName:i})}return r},sW=n=>n.endsWith(Z0)?n.substring(0,n.length-1):n.startsWith(Z0)?n.substring(1):n,oW=n=>{const e=Object.fromEntries(n.orderSensitiveModifiers.map(r=>[r,!0]));return r=>{if(r.length<=1)return r;const i=[];let s=[];return r.forEach(o=>{o[0]==="["||e[o]?(i.push(...s.sort(),o),s=[]):s.push(o)}),i.push(...s.sort()),i}},aW=n=>({cache:nW(n.cacheSize),parseClassName:iW(n),sortModifiers:oW(n),...Q$(n)}),lW=/\s+/,cW=(n,e)=>{const{parseClassName:t,getClassGroupId:r,getConflictingClassGroupIds:i,sortModifiers:s}=e,o=[],l=n.trim().split(lW);let u="";for(let h=l.length-1;h>=0;h-=1){const d=l[h],{isExternal:g,modifiers:y,hasImportantModifier:b,baseClassName:w,maybePostfixModifierPosition:E}=t(d);if(g){u=d+(u.length>0?" "+u:u);continue}let x=!!E,C=r(x?w.substring(0,E):w);if(!C){if(!x){u=d+(u.length>0?" "+u:u);continue}if(C=r(w),!C){u=d+(u.length>0?" "+u:u);continue}x=!1}const M=s(y).join(":"),O=b?M+Z0:M,V=O+C;if(o.includes(V))continue;o.push(V);const H=i(C,x);for(let G=0;G<H.length;++G){const D=H[G];o.push(O+D)}u=d+(u.length>0?" "+u:u)}return u};function uW(){let n=0,e,t,r="";for(;n<arguments.length;)(e=arguments[n++])&&(t=Ok(e))&&(r&&(r+=" "),r+=t);return r}const Ok=n=>{if(typeof n=="string")return n;let e,t="";for(let r=0;r<n.length;r++)n[r]&&(e=Ok(n[r]))&&(t&&(t+=" "),t+=e);return t};function hW(n,...e){let t,r,i,s=o;function o(u){const h=e.reduce((d,g)=>g(d),n());return t=aW(h),r=t.cache.get,i=t.cache.set,s=l,l(u)}function l(u){const h=r(u);if(h)return h;const d=cW(u,t);return i(u,d),d}return function(){return s(uW.apply(null,arguments))}}const hn=n=>{const e=t=>t[n]||[];return e.isThemeGetter=!0,e},kk=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,Nk=/^\((?:(\w[\w-]*):)?(.+)\)$/i,fW=/^\d+\/\d+$/,dW=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,pW=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,gW=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,mW=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,_W=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Cc=n=>fW.test(n),Ze=n=>!!n&&!Number.isNaN(Number(n)),No=n=>!!n&&Number.isInteger(Number(n)),Ab=n=>n.endsWith("%")&&Ze(n.slice(0,-1)),Es=n=>dW.test(n),yW=()=>!0,vW=n=>pW.test(n)&&!gW.test(n),Dk=()=>!1,bW=n=>mW.test(n),TW=n=>_W.test(n),wW=n=>!ke(n)&&!Ne(n),EW=n=>ju(n,Fk,Dk),ke=n=>kk.test(n),nl=n=>ju(n,Bk,vW),Sb=n=>ju(n,CW,Ze),H3=n=>ju(n,Lk,Dk),xW=n=>ju(n,Uk,TW),ug=n=>ju(n,Vk,bW),Ne=n=>Nk.test(n),nf=n=>Hu(n,Bk),AW=n=>Hu(n,IW),$3=n=>Hu(n,Lk),SW=n=>Hu(n,Fk),RW=n=>Hu(n,Uk),hg=n=>Hu(n,Vk,!0),ju=(n,e,t)=>{const r=kk.exec(n);return r?r[1]?e(r[1]):t(r[2]):!1},Hu=(n,e,t=!1)=>{const r=Nk.exec(n);return r?r[1]?e(r[1]):t:!1},Lk=n=>n==="position"||n==="percentage",Uk=n=>n==="image"||n==="url",Fk=n=>n==="length"||n==="size"||n==="bg-size",Bk=n=>n==="length",CW=n=>n==="number",IW=n=>n==="family-name",Vk=n=>n==="shadow",PW=()=>{const n=hn("color"),e=hn("font"),t=hn("text"),r=hn("font-weight"),i=hn("tracking"),s=hn("leading"),o=hn("breakpoint"),l=hn("container"),u=hn("spacing"),h=hn("radius"),d=hn("shadow"),g=hn("inset-shadow"),y=hn("text-shadow"),b=hn("drop-shadow"),w=hn("blur"),E=hn("perspective"),x=hn("aspect"),C=hn("ease"),M=hn("animate"),O=()=>["auto","avoid","all","avoid-page","page","left","right","column"],V=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],H=()=>[...V(),Ne,ke],G=()=>["auto","hidden","clip","visible","scroll"],D=()=>["auto","contain","none"],I=()=>[Ne,ke,u],N=()=>[Cc,"full","auto",...I()],j=()=>[No,"none","subgrid",Ne,ke],W=()=>["auto",{span:["full",No,Ne,ke]},No,Ne,ke],Y=()=>[No,"auto",Ne,ke],z=()=>["auto","min","max","fr",Ne,ke],de=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],xe=()=>["start","end","center","stretch","center-safe","end-safe"],P=()=>["auto",...I()],q=()=>[Cc,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...I()],U=()=>[n,Ne,ke],oe=()=>[...V(),$3,H3,{position:[Ne,ke]}],L=()=>["no-repeat",{repeat:["","x","y","space","round"]}],Z=()=>["auto","cover","contain",SW,EW,{size:[Ne,ke]}],ie=()=>[Ab,nf,nl],ae=()=>["","none","full",h,Ne,ke],me=()=>["",Ze,nf,nl],Ee=()=>["solid","dashed","dotted","double"],Se=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Ce=()=>[Ze,Ab,$3,H3],Me=()=>["","none",w,Ne,ke],at=()=>["none",Ze,Ne,ke],Ke=()=>["none",Ze,Ne,ke],mn=()=>[Ze,Ne,ke],on=()=>[Cc,"full",...I()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[Es],breakpoint:[Es],color:[yW],container:[Es],"drop-shadow":[Es],ease:["in","out","in-out"],font:[wW],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[Es],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[Es],shadow:[Es],spacing:["px",Ze],text:[Es],"text-shadow":[Es],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",Cc,ke,Ne,x]}],container:["container"],columns:[{columns:[Ze,ke,Ne,l]}],"break-after":[{"break-after":O()}],"break-before":[{"break-before":O()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:H()}],overflow:[{overflow:G()}],"overflow-x":[{"overflow-x":G()}],"overflow-y":[{"overflow-y":G()}],overscroll:[{overscroll:D()}],"overscroll-x":[{"overscroll-x":D()}],"overscroll-y":[{"overscroll-y":D()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:N()}],"inset-x":[{"inset-x":N()}],"inset-y":[{"inset-y":N()}],start:[{start:N()}],end:[{end:N()}],top:[{top:N()}],right:[{right:N()}],bottom:[{bottom:N()}],left:[{left:N()}],visibility:["visible","invisible","collapse"],z:[{z:[No,"auto",Ne,ke]}],basis:[{basis:[Cc,"full","auto",l,...I()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[Ze,Cc,"auto","initial","none",ke]}],grow:[{grow:["",Ze,Ne,ke]}],shrink:[{shrink:["",Ze,Ne,ke]}],order:[{order:[No,"first","last","none",Ne,ke]}],"grid-cols":[{"grid-cols":j()}],"col-start-end":[{col:W()}],"col-start":[{"col-start":Y()}],"col-end":[{"col-end":Y()}],"grid-rows":[{"grid-rows":j()}],"row-start-end":[{row:W()}],"row-start":[{"row-start":Y()}],"row-end":[{"row-end":Y()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":z()}],"auto-rows":[{"auto-rows":z()}],gap:[{gap:I()}],"gap-x":[{"gap-x":I()}],"gap-y":[{"gap-y":I()}],"justify-content":[{justify:[...de(),"normal"]}],"justify-items":[{"justify-items":[...xe(),"normal"]}],"justify-self":[{"justify-self":["auto",...xe()]}],"align-content":[{content:["normal",...de()]}],"align-items":[{items:[...xe(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...xe(),{baseline:["","last"]}]}],"place-content":[{"place-content":de()}],"place-items":[{"place-items":[...xe(),"baseline"]}],"place-self":[{"place-self":["auto",...xe()]}],p:[{p:I()}],px:[{px:I()}],py:[{py:I()}],ps:[{ps:I()}],pe:[{pe:I()}],pt:[{pt:I()}],pr:[{pr:I()}],pb:[{pb:I()}],pl:[{pl:I()}],m:[{m:P()}],mx:[{mx:P()}],my:[{my:P()}],ms:[{ms:P()}],me:[{me:P()}],mt:[{mt:P()}],mr:[{mr:P()}],mb:[{mb:P()}],ml:[{ml:P()}],"space-x":[{"space-x":I()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":I()}],"space-y-reverse":["space-y-reverse"],size:[{size:q()}],w:[{w:[l,"screen",...q()]}],"min-w":[{"min-w":[l,"screen","none",...q()]}],"max-w":[{"max-w":[l,"screen","none","prose",{screen:[o]},...q()]}],h:[{h:["screen","lh",...q()]}],"min-h":[{"min-h":["screen","lh","none",...q()]}],"max-h":[{"max-h":["screen","lh",...q()]}],"font-size":[{text:["base",t,nf,nl]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[r,Ne,Sb]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",Ab,ke]}],"font-family":[{font:[AW,ke,e]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[i,Ne,ke]}],"line-clamp":[{"line-clamp":[Ze,"none",Ne,Sb]}],leading:[{leading:[s,...I()]}],"list-image":[{"list-image":["none",Ne,ke]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",Ne,ke]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:U()}],"text-color":[{text:U()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Ee(),"wavy"]}],"text-decoration-thickness":[{decoration:[Ze,"from-font","auto",Ne,nl]}],"text-decoration-color":[{decoration:U()}],"underline-offset":[{"underline-offset":[Ze,"auto",Ne,ke]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:I()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Ne,ke]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Ne,ke]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:oe()}],"bg-repeat":[{bg:L()}],"bg-size":[{bg:Z()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},No,Ne,ke],radial:["",Ne,ke],conic:[No,Ne,ke]},RW,xW]}],"bg-color":[{bg:U()}],"gradient-from-pos":[{from:ie()}],"gradient-via-pos":[{via:ie()}],"gradient-to-pos":[{to:ie()}],"gradient-from":[{from:U()}],"gradient-via":[{via:U()}],"gradient-to":[{to:U()}],rounded:[{rounded:ae()}],"rounded-s":[{"rounded-s":ae()}],"rounded-e":[{"rounded-e":ae()}],"rounded-t":[{"rounded-t":ae()}],"rounded-r":[{"rounded-r":ae()}],"rounded-b":[{"rounded-b":ae()}],"rounded-l":[{"rounded-l":ae()}],"rounded-ss":[{"rounded-ss":ae()}],"rounded-se":[{"rounded-se":ae()}],"rounded-ee":[{"rounded-ee":ae()}],"rounded-es":[{"rounded-es":ae()}],"rounded-tl":[{"rounded-tl":ae()}],"rounded-tr":[{"rounded-tr":ae()}],"rounded-br":[{"rounded-br":ae()}],"rounded-bl":[{"rounded-bl":ae()}],"border-w":[{border:me()}],"border-w-x":[{"border-x":me()}],"border-w-y":[{"border-y":me()}],"border-w-s":[{"border-s":me()}],"border-w-e":[{"border-e":me()}],"border-w-t":[{"border-t":me()}],"border-w-r":[{"border-r":me()}],"border-w-b":[{"border-b":me()}],"border-w-l":[{"border-l":me()}],"divide-x":[{"divide-x":me()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":me()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...Ee(),"hidden","none"]}],"divide-style":[{divide:[...Ee(),"hidden","none"]}],"border-color":[{border:U()}],"border-color-x":[{"border-x":U()}],"border-color-y":[{"border-y":U()}],"border-color-s":[{"border-s":U()}],"border-color-e":[{"border-e":U()}],"border-color-t":[{"border-t":U()}],"border-color-r":[{"border-r":U()}],"border-color-b":[{"border-b":U()}],"border-color-l":[{"border-l":U()}],"divide-color":[{divide:U()}],"outline-style":[{outline:[...Ee(),"none","hidden"]}],"outline-offset":[{"outline-offset":[Ze,Ne,ke]}],"outline-w":[{outline:["",Ze,nf,nl]}],"outline-color":[{outline:U()}],shadow:[{shadow:["","none",d,hg,ug]}],"shadow-color":[{shadow:U()}],"inset-shadow":[{"inset-shadow":["none",g,hg,ug]}],"inset-shadow-color":[{"inset-shadow":U()}],"ring-w":[{ring:me()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:U()}],"ring-offset-w":[{"ring-offset":[Ze,nl]}],"ring-offset-color":[{"ring-offset":U()}],"inset-ring-w":[{"inset-ring":me()}],"inset-ring-color":[{"inset-ring":U()}],"text-shadow":[{"text-shadow":["none",y,hg,ug]}],"text-shadow-color":[{"text-shadow":U()}],opacity:[{opacity:[Ze,Ne,ke]}],"mix-blend":[{"mix-blend":[...Se(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":Se()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[Ze]}],"mask-image-linear-from-pos":[{"mask-linear-from":Ce()}],"mask-image-linear-to-pos":[{"mask-linear-to":Ce()}],"mask-image-linear-from-color":[{"mask-linear-from":U()}],"mask-image-linear-to-color":[{"mask-linear-to":U()}],"mask-image-t-from-pos":[{"mask-t-from":Ce()}],"mask-image-t-to-pos":[{"mask-t-to":Ce()}],"mask-image-t-from-color":[{"mask-t-from":U()}],"mask-image-t-to-color":[{"mask-t-to":U()}],"mask-image-r-from-pos":[{"mask-r-from":Ce()}],"mask-image-r-to-pos":[{"mask-r-to":Ce()}],"mask-image-r-from-color":[{"mask-r-from":U()}],"mask-image-r-to-color":[{"mask-r-to":U()}],"mask-image-b-from-pos":[{"mask-b-from":Ce()}],"mask-image-b-to-pos":[{"mask-b-to":Ce()}],"mask-image-b-from-color":[{"mask-b-from":U()}],"mask-image-b-to-color":[{"mask-b-to":U()}],"mask-image-l-from-pos":[{"mask-l-from":Ce()}],"mask-image-l-to-pos":[{"mask-l-to":Ce()}],"mask-image-l-from-color":[{"mask-l-from":U()}],"mask-image-l-to-color":[{"mask-l-to":U()}],"mask-image-x-from-pos":[{"mask-x-from":Ce()}],"mask-image-x-to-pos":[{"mask-x-to":Ce()}],"mask-image-x-from-color":[{"mask-x-from":U()}],"mask-image-x-to-color":[{"mask-x-to":U()}],"mask-image-y-from-pos":[{"mask-y-from":Ce()}],"mask-image-y-to-pos":[{"mask-y-to":Ce()}],"mask-image-y-from-color":[{"mask-y-from":U()}],"mask-image-y-to-color":[{"mask-y-to":U()}],"mask-image-radial":[{"mask-radial":[Ne,ke]}],"mask-image-radial-from-pos":[{"mask-radial-from":Ce()}],"mask-image-radial-to-pos":[{"mask-radial-to":Ce()}],"mask-image-radial-from-color":[{"mask-radial-from":U()}],"mask-image-radial-to-color":[{"mask-radial-to":U()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":V()}],"mask-image-conic-pos":[{"mask-conic":[Ze]}],"mask-image-conic-from-pos":[{"mask-conic-from":Ce()}],"mask-image-conic-to-pos":[{"mask-conic-to":Ce()}],"mask-image-conic-from-color":[{"mask-conic-from":U()}],"mask-image-conic-to-color":[{"mask-conic-to":U()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:oe()}],"mask-repeat":[{mask:L()}],"mask-size":[{mask:Z()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",Ne,ke]}],filter:[{filter:["","none",Ne,ke]}],blur:[{blur:Me()}],brightness:[{brightness:[Ze,Ne,ke]}],contrast:[{contrast:[Ze,Ne,ke]}],"drop-shadow":[{"drop-shadow":["","none",b,hg,ug]}],"drop-shadow-color":[{"drop-shadow":U()}],grayscale:[{grayscale:["",Ze,Ne,ke]}],"hue-rotate":[{"hue-rotate":[Ze,Ne,ke]}],invert:[{invert:["",Ze,Ne,ke]}],saturate:[{saturate:[Ze,Ne,ke]}],sepia:[{sepia:["",Ze,Ne,ke]}],"backdrop-filter":[{"backdrop-filter":["","none",Ne,ke]}],"backdrop-blur":[{"backdrop-blur":Me()}],"backdrop-brightness":[{"backdrop-brightness":[Ze,Ne,ke]}],"backdrop-contrast":[{"backdrop-contrast":[Ze,Ne,ke]}],"backdrop-grayscale":[{"backdrop-grayscale":["",Ze,Ne,ke]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[Ze,Ne,ke]}],"backdrop-invert":[{"backdrop-invert":["",Ze,Ne,ke]}],"backdrop-opacity":[{"backdrop-opacity":[Ze,Ne,ke]}],"backdrop-saturate":[{"backdrop-saturate":[Ze,Ne,ke]}],"backdrop-sepia":[{"backdrop-sepia":["",Ze,Ne,ke]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":I()}],"border-spacing-x":[{"border-spacing-x":I()}],"border-spacing-y":[{"border-spacing-y":I()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",Ne,ke]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[Ze,"initial",Ne,ke]}],ease:[{ease:["linear","initial",C,Ne,ke]}],delay:[{delay:[Ze,Ne,ke]}],animate:[{animate:["none",M,Ne,ke]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[E,Ne,ke]}],"perspective-origin":[{"perspective-origin":H()}],rotate:[{rotate:at()}],"rotate-x":[{"rotate-x":at()}],"rotate-y":[{"rotate-y":at()}],"rotate-z":[{"rotate-z":at()}],scale:[{scale:Ke()}],"scale-x":[{"scale-x":Ke()}],"scale-y":[{"scale-y":Ke()}],"scale-z":[{"scale-z":Ke()}],"scale-3d":["scale-3d"],skew:[{skew:mn()}],"skew-x":[{"skew-x":mn()}],"skew-y":[{"skew-y":mn()}],transform:[{transform:[Ne,ke,"","none","gpu","cpu"]}],"transform-origin":[{origin:H()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:on()}],"translate-x":[{"translate-x":on()}],"translate-y":[{"translate-y":on()}],"translate-z":[{"translate-z":on()}],"translate-none":["translate-none"],accent:[{accent:U()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:U()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Ne,ke]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":I()}],"scroll-mx":[{"scroll-mx":I()}],"scroll-my":[{"scroll-my":I()}],"scroll-ms":[{"scroll-ms":I()}],"scroll-me":[{"scroll-me":I()}],"scroll-mt":[{"scroll-mt":I()}],"scroll-mr":[{"scroll-mr":I()}],"scroll-mb":[{"scroll-mb":I()}],"scroll-ml":[{"scroll-ml":I()}],"scroll-p":[{"scroll-p":I()}],"scroll-px":[{"scroll-px":I()}],"scroll-py":[{"scroll-py":I()}],"scroll-ps":[{"scroll-ps":I()}],"scroll-pe":[{"scroll-pe":I()}],"scroll-pt":[{"scroll-pt":I()}],"scroll-pr":[{"scroll-pr":I()}],"scroll-pb":[{"scroll-pb":I()}],"scroll-pl":[{"scroll-pl":I()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Ne,ke]}],fill:[{fill:["none",...U()]}],"stroke-w":[{stroke:[Ze,nf,nl,Sb]}],stroke:[{stroke:["none",...U()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},MW=hW(PW);function Sd(...n){return MW(Z$(n))}function OW({...n}){return X.jsx(X$,{"data-slot":"popover",...n})}function kW({...n}){return X.jsx(Y$,{"data-slot":"popover-trigger",...n})}function NW({className:n,align:e="center",sideOffset:t=4,...r}){return X.jsx(K$,{children:X.jsx(G$,{"data-slot":"popover-content",align:e,sideOffset:t,className:Sd("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",n),...r})})}function DW(n){const e=R.useRef({value:n,previous:n});return R.useMemo(()=>(e.current.value!==n&&(e.current.previous=e.current.value,e.current.value=n),e.current.previous),[n])}var N_="Checkbox",[LW,Jle]=Bu(N_),[UW,Jw]=LW(N_);function FW(n){const{__scopeCheckbox:e,checked:t,children:r,defaultChecked:i,disabled:s,form:o,name:l,onCheckedChange:u,required:h,value:d="on",internal_do_not_use_render:g}=n,[y,b]=xd({prop:t,defaultProp:i??!1,onChange:u,caller:N_}),[w,E]=R.useState(null),[x,C]=R.useState(null),M=R.useRef(!1),O=w?!!o||!!w.closest("form"):!0,V={checked:y,disabled:s,setChecked:b,control:w,setControl:E,name:l,form:o,value:d,hasConsumerStoppedPropagationRef:M,required:h,defaultChecked:ra(i)?!1:i,isFormControl:O,bubbleInput:x,setBubbleInput:C};return X.jsx(UW,{scope:e,...V,children:BW(g)?g(V):r})}var zk="CheckboxTrigger",jk=R.forwardRef(({__scopeCheckbox:n,onKeyDown:e,onClick:t,...r},i)=>{const{control:s,value:o,disabled:l,checked:u,required:h,setControl:d,setChecked:g,hasConsumerStoppedPropagationRef:y,isFormControl:b,bubbleInput:w}=Jw(zk,n),E=hr(i,d),x=R.useRef(u);return R.useEffect(()=>{const C=s?.form;if(C){const M=()=>g(x.current);return C.addEventListener("reset",M),()=>C.removeEventListener("reset",M)}},[s,g]),X.jsx(Ln.button,{type:"button",role:"checkbox","aria-checked":ra(u)?"mixed":u,"aria-required":h,"data-state":Yk(u),"data-disabled":l?"":void 0,disabled:l,value:o,...r,ref:E,onKeyDown:Hr(e,C=>{C.key==="Enter"&&C.preventDefault()}),onClick:Hr(t,C=>{g(M=>ra(M)?!0:!M),w&&b&&(y.current=C.isPropagationStopped(),y.current||C.stopPropagation())})})});jk.displayName=zk;var Hk=R.forwardRef((n,e)=>{const{__scopeCheckbox:t,name:r,checked:i,defaultChecked:s,required:o,disabled:l,value:u,onCheckedChange:h,form:d,...g}=n;return X.jsx(FW,{__scopeCheckbox:t,checked:i,defaultChecked:s,disabled:l,required:o,onCheckedChange:h,name:r,form:d,value:u,internal_do_not_use_render:({isFormControl:y})=>X.jsxs(X.Fragment,{children:[X.jsx(jk,{...g,ref:e,__scopeCheckbox:t}),y&&X.jsx(Xk,{__scopeCheckbox:t})]})})});Hk.displayName=N_;var $k="CheckboxIndicator",Wk=R.forwardRef((n,e)=>{const{__scopeCheckbox:t,forceMount:r,...i}=n,s=Jw($k,t);return X.jsx(Ed,{present:r||ra(s.checked)||s.checked===!0,children:X.jsx(Ln.span,{"data-state":Yk(s.checked),"data-disabled":s.disabled?"":void 0,...i,ref:e,style:{pointerEvents:"none",...n.style}})})});Wk.displayName=$k;var qk="CheckboxBubbleInput",Xk=R.forwardRef(({__scopeCheckbox:n,...e},t)=>{const{control:r,hasConsumerStoppedPropagationRef:i,checked:s,defaultChecked:o,required:l,disabled:u,name:h,value:d,form:g,bubbleInput:y,setBubbleInput:b}=Jw(qk,n),w=hr(t,b),E=DW(s),x=QO(r);R.useEffect(()=>{const M=y;if(!M)return;const O=window.HTMLInputElement.prototype,H=Object.getOwnPropertyDescriptor(O,"checked").set,G=!i.current;if(E!==s&&H){const D=new Event("click",{bubbles:G});M.indeterminate=ra(s),H.call(M,ra(s)?!1:s),M.dispatchEvent(D)}},[y,E,s,i]);const C=R.useRef(ra(s)?!1:s);return X.jsx(Ln.input,{type:"checkbox","aria-hidden":!0,defaultChecked:o??C.current,required:l,disabled:u,name:h,value:d,form:g,...e,tabIndex:-1,ref:w,style:{...e.style,...x,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});Xk.displayName=qk;function BW(n){return typeof n=="function"}function ra(n){return n==="indeterminate"}function Yk(n){return ra(n)?"indeterminate":n?"checked":"unchecked"}/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VW=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),zW=n=>n.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()),W3=n=>{const e=zW(n);return e.charAt(0).toUpperCase()+e.slice(1)},Kk=(...n)=>n.filter((e,t,r)=>!!e&&e.trim()!==""&&r.indexOf(e)===t).join(" ").trim(),jW=n=>{for(const e in n)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var HW={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $W=R.forwardRef(({color:n="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:r,className:i="",children:s,iconNode:o,...l},u)=>R.createElement("svg",{ref:u,...HW,width:e,height:e,stroke:n,strokeWidth:r?Number(t)*24/Number(e):t,className:Kk("lucide",i),...!s&&!jW(l)&&{"aria-hidden":"true"},...l},[...o.map(([h,d])=>R.createElement(h,d)),...Array.isArray(s)?s:[s]]));/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gk=(n,e)=>{const t=R.forwardRef(({className:r,...i},s)=>R.createElement($W,{ref:s,iconNode:e,className:Kk(`lucide-${VW(W3(n))}`,`lucide-${n}`,r),...i}));return t.displayName=W3(n),t};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WW=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],qW=Gk("check",WW);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XW=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],YW=Gk("chevron-down",XW);function Pn({className:n,...e}){return X.jsx(Hk,{"data-slot":"checkbox",className:Sd("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",n),...e,children:X.jsx(Wk,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:X.jsx(qW,{className:"size-3.5"})})})}function KW(n){const e=n+"CollectionProvider",[t,r]=Bu(e),[i,s]=t(e,{collectionRef:{current:null},itemMap:new Map}),o=E=>{const{scope:x,children:C}=E,M=vt.useRef(null),O=vt.useRef(new Map).current;return X.jsx(i,{scope:x,itemMap:O,collectionRef:M,children:C})};o.displayName=e;const l=n+"CollectionSlot",u=Lm(l),h=vt.forwardRef((E,x)=>{const{scope:C,children:M}=E,O=s(l,C),V=hr(x,O.collectionRef);return X.jsx(u,{ref:V,children:M})});h.displayName=l;const d=n+"CollectionItemSlot",g="data-radix-collection-item",y=Lm(d),b=vt.forwardRef((E,x)=>{const{scope:C,children:M,...O}=E,V=vt.useRef(null),H=hr(x,V),G=s(d,C);return vt.useEffect(()=>(G.itemMap.set(V,{ref:V,...O}),()=>void G.itemMap.delete(V))),X.jsx(y,{[g]:"",ref:H,children:M})});b.displayName=d;function w(E){const x=s(n+"CollectionConsumer",E);return vt.useCallback(()=>{const M=x.collectionRef.current;if(!M)return[];const O=Array.from(M.querySelectorAll(`[${g}]`));return Array.from(x.itemMap.values()).sort((G,D)=>O.indexOf(G.ref.current)-O.indexOf(D.ref.current))},[x.collectionRef,x.itemMap])}return[{Provider:o,Slot:h,ItemSlot:b},w,r]}var D_="Collapsible",[GW,Zk]=Bu(D_),[ZW,eE]=GW(D_),Qk=R.forwardRef((n,e)=>{const{__scopeCollapsible:t,open:r,defaultOpen:i,disabled:s,onOpenChange:o,...l}=n,[u,h]=xd({prop:r,defaultProp:i??!1,onChange:o,caller:D_});return X.jsx(ZW,{scope:t,disabled:s,contentId:jw(),open:u,onOpenToggle:R.useCallback(()=>h(d=>!d),[h]),children:X.jsx(Ln.div,{"data-state":nE(u),"data-disabled":s?"":void 0,...l,ref:e})})});Qk.displayName=D_;var Jk="CollapsibleTrigger",eN=R.forwardRef((n,e)=>{const{__scopeCollapsible:t,...r}=n,i=eE(Jk,t);return X.jsx(Ln.button,{type:"button","aria-controls":i.contentId,"aria-expanded":i.open||!1,"data-state":nE(i.open),"data-disabled":i.disabled?"":void 0,disabled:i.disabled,...r,ref:e,onClick:Hr(n.onClick,i.onOpenToggle)})});eN.displayName=Jk;var tE="CollapsibleContent",tN=R.forwardRef((n,e)=>{const{forceMount:t,...r}=n,i=eE(tE,n.__scopeCollapsible);return X.jsx(Ed,{present:t||i.open,children:({present:s})=>X.jsx(QW,{...r,ref:e,present:s})})});tN.displayName=tE;var QW=R.forwardRef((n,e)=>{const{__scopeCollapsible:t,present:r,children:i,...s}=n,o=eE(tE,t),[l,u]=R.useState(r),h=R.useRef(null),d=hr(e,h),g=R.useRef(0),y=g.current,b=R.useRef(0),w=b.current,E=o.open||l,x=R.useRef(E),C=R.useRef(void 0);return R.useEffect(()=>{const M=requestAnimationFrame(()=>x.current=!1);return()=>cancelAnimationFrame(M)},[]),Vs(()=>{const M=h.current;if(M){C.current=C.current||{transitionDuration:M.style.transitionDuration,animationName:M.style.animationName},M.style.transitionDuration="0s",M.style.animationName="none";const O=M.getBoundingClientRect();g.current=O.height,b.current=O.width,x.current||(M.style.transitionDuration=C.current.transitionDuration,M.style.animationName=C.current.animationName),u(r)}},[o.open,r]),X.jsx(Ln.div,{"data-state":nE(o.open),"data-disabled":o.disabled?"":void 0,id:o.contentId,hidden:!E,...s,ref:d,style:{"--radix-collapsible-content-height":y?`${y}px`:void 0,"--radix-collapsible-content-width":w?`${w}px`:void 0,...n.style},children:E&&i})});function nE(n){return n?"open":"closed"}var JW=Qk,eq=eN,tq=tN,nq=R.createContext(void 0);function rq(n){const e=R.useContext(nq);return n||e||"ltr"}var mi="Accordion",iq=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[rE,sq,oq]=KW(mi),[L_,ece]=Bu(mi,[oq,Zk]),iE=Zk(),nN=vt.forwardRef((n,e)=>{const{type:t,...r}=n,i=r,s=r;return X.jsx(rE.Provider,{scope:n.__scopeAccordion,children:t==="multiple"?X.jsx(uq,{...s,ref:e}):X.jsx(cq,{...i,ref:e})})});nN.displayName=mi;var[rN,aq]=L_(mi),[iN,lq]=L_(mi,{collapsible:!1}),cq=vt.forwardRef((n,e)=>{const{value:t,defaultValue:r,onValueChange:i=()=>{},collapsible:s=!1,...o}=n,[l,u]=xd({prop:t,defaultProp:r??"",onChange:i,caller:mi});return X.jsx(rN,{scope:n.__scopeAccordion,value:vt.useMemo(()=>l?[l]:[],[l]),onItemOpen:u,onItemClose:vt.useCallback(()=>s&&u(""),[s,u]),children:X.jsx(iN,{scope:n.__scopeAccordion,collapsible:s,children:X.jsx(sN,{...o,ref:e})})})}),uq=vt.forwardRef((n,e)=>{const{value:t,defaultValue:r,onValueChange:i=()=>{},...s}=n,[o,l]=xd({prop:t,defaultProp:r??[],onChange:i,caller:mi}),u=vt.useCallback(d=>l((g=[])=>[...g,d]),[l]),h=vt.useCallback(d=>l((g=[])=>g.filter(y=>y!==d)),[l]);return X.jsx(rN,{scope:n.__scopeAccordion,value:o,onItemOpen:u,onItemClose:h,children:X.jsx(iN,{scope:n.__scopeAccordion,collapsible:!0,children:X.jsx(sN,{...s,ref:e})})})}),[hq,U_]=L_(mi),sN=vt.forwardRef((n,e)=>{const{__scopeAccordion:t,disabled:r,dir:i,orientation:s="vertical",...o}=n,l=vt.useRef(null),u=hr(l,e),h=sq(t),g=rq(i)==="ltr",y=Hr(n.onKeyDown,b=>{if(!iq.includes(b.key))return;const w=b.target,E=h().filter(I=>!I.ref.current?.disabled),x=E.findIndex(I=>I.ref.current===w),C=E.length;if(x===-1)return;b.preventDefault();let M=x;const O=0,V=C-1,H=()=>{M=x+1,M>V&&(M=O)},G=()=>{M=x-1,M<O&&(M=V)};switch(b.key){case"Home":M=O;break;case"End":M=V;break;case"ArrowRight":s==="horizontal"&&(g?H():G());break;case"ArrowDown":s==="vertical"&&H();break;case"ArrowLeft":s==="horizontal"&&(g?G():H());break;case"ArrowUp":s==="vertical"&&G();break}const D=M%C;E[D].ref.current?.focus()});return X.jsx(hq,{scope:t,disabled:r,direction:i,orientation:s,children:X.jsx(rE.Slot,{scope:t,children:X.jsx(Ln.div,{...o,"data-orientation":s,ref:u,onKeyDown:r?void 0:y})})})}),zm="AccordionItem",[fq,sE]=L_(zm),oN=vt.forwardRef((n,e)=>{const{__scopeAccordion:t,value:r,...i}=n,s=U_(zm,t),o=aq(zm,t),l=iE(t),u=jw(),h=r&&o.value.includes(r)||!1,d=s.disabled||n.disabled;return X.jsx(fq,{scope:t,open:h,disabled:d,triggerId:u,children:X.jsx(JW,{"data-orientation":s.orientation,"data-state":fN(h),...l,...i,ref:e,disabled:d,open:h,onOpenChange:g=>{g?o.onItemOpen(r):o.onItemClose(r)}})})});oN.displayName=zm;var aN="AccordionHeader",lN=vt.forwardRef((n,e)=>{const{__scopeAccordion:t,...r}=n,i=U_(mi,t),s=sE(aN,t);return X.jsx(Ln.h3,{"data-orientation":i.orientation,"data-state":fN(s.open),"data-disabled":s.disabled?"":void 0,...r,ref:e})});lN.displayName=aN;var J0="AccordionTrigger",cN=vt.forwardRef((n,e)=>{const{__scopeAccordion:t,...r}=n,i=U_(mi,t),s=sE(J0,t),o=lq(J0,t),l=iE(t);return X.jsx(rE.ItemSlot,{scope:t,children:X.jsx(eq,{"aria-disabled":s.open&&!o.collapsible||void 0,"data-orientation":i.orientation,id:s.triggerId,...l,...r,ref:e})})});cN.displayName=J0;var uN="AccordionContent",hN=vt.forwardRef((n,e)=>{const{__scopeAccordion:t,...r}=n,i=U_(mi,t),s=sE(uN,t),o=iE(t);return X.jsx(tq,{role:"region","aria-labelledby":s.triggerId,"data-orientation":i.orientation,...o,...r,ref:e,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...n.style}})});hN.displayName=uN;function fN(n){return n?"open":"closed"}var dq=nN,pq=oN,gq=lN,mq=cN,_q=hN;function yq({...n}){return X.jsx(dq,{"data-slot":"accordion",...n})}function Rb({className:n,...e}){return X.jsx(pq,{"data-slot":"accordion-item",className:Sd("border-b last:border-b-0",n),...e})}function Cb({className:n,children:e,...t}){return X.jsx(gq,{className:"flex",children:X.jsxs(mq,{"data-slot":"accordion-trigger",className:Sd("focus-visible:border-ring focus-visible:ring-ring/50 flex flex-1 items-start justify-between gap-4 rounded-md py-4 text-left text-sm font-medium transition-all outline-none hover:underline focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&[data-state=open]>svg]:rotate-180",n),...t,children:[e,X.jsx(YW,{className:"text-muted-foreground pointer-events-none size-4 shrink-0 translate-y-0.5 transition-transform duration-100"})]})})}function Ib({className:n,children:e,...t}){return X.jsx(_q,{"data-slot":"accordion-content",className:"data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down overflow-hidden text-sm",...t,children:X.jsx("div",{className:Sd("pt-0 pb-4",n),children:e})})}function jm(n,e){if(!n)throw new Error(e||"loader assertion failed.")}const oE=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),q3=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);q3&&parseFloat(q3[1]);const X3=globalThis,Y3=globalThis.process||{},vq=globalThis.navigator||{};function dN(n){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function Nl(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||dN()}function bq(n){return Nl()?dN()?"Electron":(vq.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const pN="4.1.0";function Tq(n){try{const e=window[n],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class wq{constructor(e,t,r="sessionStorage"){this.storage=Tq(r),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function Eq(n){let e;return n<10?e=`${n.toFixed(2)}ms`:n<100?e=`${n.toFixed(1)}ms`:n<1e3?e=`${n.toFixed(0)}ms`:e=`${(n/1e3).toFixed(2)}s`,e}function xq(n,e=8){const t=Math.max(e-n.length,0);return`${" ".repeat(t)}${n}`}var Hm;(function(n){n[n.BLACK=30]="BLACK",n[n.RED=31]="RED",n[n.GREEN=32]="GREEN",n[n.YELLOW=33]="YELLOW",n[n.BLUE=34]="BLUE",n[n.MAGENTA=35]="MAGENTA",n[n.CYAN=36]="CYAN",n[n.WHITE=37]="WHITE",n[n.BRIGHT_BLACK=90]="BRIGHT_BLACK",n[n.BRIGHT_RED=91]="BRIGHT_RED",n[n.BRIGHT_GREEN=92]="BRIGHT_GREEN",n[n.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",n[n.BRIGHT_BLUE=94]="BRIGHT_BLUE",n[n.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",n[n.BRIGHT_CYAN=96]="BRIGHT_CYAN",n[n.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Hm||(Hm={}));const Aq=10;function K3(n){return typeof n!="string"?n:(n=n.toUpperCase(),Hm[n]||Hm.WHITE)}function Sq(n,e,t){return!Nl&&typeof n=="string"&&(e&&(n=`\x1B[${K3(e)}m${n}\x1B[39m`),t&&(n=`\x1B[${K3(t)+Aq}m${n}\x1B[49m`)),n}function Rq(n,e=["constructor"]){const t=Object.getPrototypeOf(n),r=Object.getOwnPropertyNames(t),i=n;for(const s of r){const o=i[s];typeof o=="function"&&(e.find(l=>s===l)||(i[s]=o.bind(n)))}}function aE(n,e){if(!n)throw new Error("Assertion failed")}function Ic(){let n;if(Nl()&&X3.performance)n=X3?.performance?.now?.();else if("hrtime"in Y3){const e=Y3?.hrtime?.();n=e[0]*1e3+e[1]/1e6}else n=Date.now();return n}const Pc={debug:Nl()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Cq={enabled:!0,level:0};function Mc(){}const G3={},Z3={once:!0};class Rd{constructor({id:e}={id:""}){this.VERSION=pN,this._startTs=Ic(),this._deltaTs=Ic(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new wq(`__probe-${this.id}__`,Cq),this.timeStamp(`${this.id} started`),Rq(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Ic()-this._startTs).toPrecision(10))}getDelta(){return Number((Ic()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Pc.warn,arguments,Z3)}error(e){return this._getLogFunction(0,e,Pc.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,Pc.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,Pc.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,Pc.debug||Pc.info,arguments,Z3)}table(e,t,r){return t?this._getLogFunction(e,t,console.table||Mc,r&&[r],{tag:Pq(t)}):Mc}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||Mc)}group(e,t,r={collapsed:!1}){const i=Q3({logLevel:e,message:t,opts:r}),{collapsed:s}=r;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,t,r={}){return this.group(e,t,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Mc)}withGroup(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=gN(e)}_getLogFunction(e,t,r,i,s){if(this._shouldLog(e)){s=Q3({logLevel:e,message:t,args:i,opts:s}),r=r||s.method,aE(r),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=Ic();const o=s.tag||s.message;if(s.once&&o)if(!G3[o])G3[o]=Ic();else return Mc;return t=Iq(this.id,s.message,s),r.bind(console,t,...s.args)}return Mc}}Rd.VERSION=pN;function gN(n){if(!n)return 0;let e;switch(typeof n){case"number":e=n;break;case"object":e=n.logLevel||n.priority||0;break;default:return 0}return aE(Number.isFinite(e)&&e>=0),e}function Q3(n){const{logLevel:e,message:t}=n;n.logLevel=gN(e);const r=n.args?Array.from(n.args):[];for(;r.length&&r.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&r.unshift(t),n.message=e;break;case"object":Object.assign(n,e);break}typeof n.message=="function"&&(n.message=n.message());const i=typeof n.message;return aE(i==="string"||i==="object"),Object.assign(n,{args:r},n.opts)}function Iq(n,e,t){if(typeof e=="string"){const r=t.time?xq(Eq(t.total)):"";e=t.time?`${n}: ${r}  ${e}`:`${n}: ${e}`,e=Sq(e,t.color,t.background)}return e}function Pq(n){for(const e in n)for(const t in n[e])return t||"untitled";return"empty"}const Pb="4.3.3",Mq=Pb[0]>="0"&&Pb[0]<="9"?`v${Pb}`:"";function Oq(){const n=new Rd({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=n,globalThis.loaders.version=Mq,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=n,n}const kq=Oq();function Nq(n,e){return mN(n||{},e)}function mN(n,e,t=0){if(t>3)return e;const r={...n};for(const[i,s]of Object.entries(e))s&&typeof s=="object"&&!Array.isArray(s)?r[i]=mN(r[i]||{},e[i],t+1):r[i]=e[i];return r}const Dq="latest";function Lq(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}const Uq=Lq();function ga(n,e){if(!n)throw new Error(e||"loaders.gl assertion failed.")}const hl=typeof process!="object"||String(process)!=="[object process]"||process.browser,Fq=typeof window<"u"&&typeof window.orientation<"u",J3=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);J3&&parseFloat(J3[1]);class Bq{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,t){this.name=e,this.workerThread=t,this.result=new Promise((r,i)=>{this._resolve=r,this._reject=i})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){ga(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){ga(this.isRunning),this.isRunning=!1,this._reject(e)}}class Mb{terminate(){}}const Ob=new Map;function Vq(n){ga(n.source&&!n.url||!n.source&&n.url);let e=Ob.get(n.source||n.url);return e||(n.url&&(e=zq(n.url),Ob.set(n.url,e)),n.source&&(e=_N(n.source),Ob.set(n.source,e))),ga(e),e}function zq(n){if(!n.startsWith("http"))return n;const e=jq(n);return _N(e)}function _N(n){const e=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(e)}function jq(n){return`try {
  importScripts('${n}');
} catch (error) {
  console.error(error);
  throw error;
}`}function yN(n,e=!0,t){const r=t||new Set;if(n){if(eR(n))r.add(n);else if(eR(n.buffer))r.add(n.buffer);else if(!ArrayBuffer.isView(n)){if(e&&typeof n=="object")for(const i in n)yN(n[i],e,r)}}return t===void 0?Array.from(r):[]}function eR(n){return n?n instanceof ArrayBuffer||typeof MessagePort<"u"&&n instanceof MessagePort||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas:!1}const kb=()=>{};class eT{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&hl||typeof Mb<"u"&&!hl}constructor(e){const{name:t,source:r,url:i}=e;ga(r||i),this.name=t,this.source=r,this.url=i,this.onMessage=kb,this.onError=s=>console.log(s),this.worker=hl?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=kb,this.onError=kb,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||yN(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=Vq({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new Mb(r,{eval:!1})}else if(this.source)e=new Mb(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class Hq{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return eT.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,t=(i,s,o)=>i.done(o),r=(i,s)=>i.error(s)){const i=new Promise(s=>(this.jobQueue.push({name:e,onMessage:t,onError:r,onStart:s}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const r=new Bq(t.name,e);e.onMessage=i=>t.onMessage(r,i.type,i.payload),e.onError=i=>t.onError(r,i),t.onStart(r);try{await r.result}catch(i){console.error(`Worker exception: ${i}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!hl||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new eT({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return Fq?this.maxMobileConcurrency:this.maxConcurrency}}const $q={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class qo{props;workerPools=new Map;static _workerFarm;static isSupported(){return eT.isSupported()}static getWorkerFarm(e={}){return qo._workerFarm=qo._workerFarm||new qo({}),qo._workerFarm.setProps(e),qo._workerFarm}constructor(e){this.props={...$q},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:r,url:i}=e;let s=this.workerPools.get(t);return s||(s=new Hq({name:t,source:r,url:i}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}function Wq(n,e={}){const t=e[n.id]||{},r=hl?`${n.id}-worker.js`:`${n.id}-worker-node.js`;let i=t.workerUrl;if(!i&&n.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(hl?i=`modules/${n.module}/dist/${r}`:i=`modules/${n.module}/src/workers/${n.id}-worker-node.ts`),!i){let s=n.version;s==="latest"&&(s=Dq);const o=s?`@${s}`:"";i=`https://unpkg.com/@loaders.gl/${n.module}${o}/dist/${r}`}return ga(i),i}function qq(n,e=Uq){ga(n,"no worker provided");const t=n.version;return!(!e||!t)}function Xq(n,e){return!qo.isSupported()||!hl&&!e?._nodeWorkers?!1:n.worker&&e?.worker}async function Yq(n,e,t,r,i){const s=n.id,o=Wq(n,t),u=qo.getWorkerFarm(t).getWorkerPool({name:s,url:o});t=JSON.parse(JSON.stringify(t)),r=JSON.parse(JSON.stringify(r||{}));const h=await u.startJob("process-on-worker",Kq.bind(null,i));return h.postMessage("process",{input:e,options:t,context:r}),await(await h.result).result}async function Kq(n,e,t,r){switch(t){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:i,input:s,options:o}=r;try{const l=await n(s,o);e.postMessage("done",{id:i,result:l})}catch(l){const u=l instanceof Error?l.message:"unknown error";e.postMessage("error",{id:i,error:u})}break;default:console.warn(`parse-with-worker unknown message ${t}`)}}function Gq(n,e,t){if(t=t||n.byteLength,n.byteLength<t||e.byteLength<t)return!1;const r=new Uint8Array(n),i=new Uint8Array(e);for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}function Zq(...n){return Qq(n)}function Qq(n){const e=n.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),t=e.reduce((s,o)=>s+o.byteLength,0),r=new Uint8Array(t);let i=0;for(const s of e)r.set(s,i),i+=s.byteLength;return r.buffer}async function Jq(n){const e=[];for await(const t of n)e.push(t);return Zq(...e)}function tR(){let n;if(typeof window<"u"&&window.performance)n=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();n=e[0]*1e3+e[1]/1e6}else n=Date.now();return n}class nR{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=tR(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(tR()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Cd{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:r}=e;let i=this.stats[t];return i||(e instanceof nR?i=e:i=new nR(t,r),this.stats[t]=i),i}}const eX="Queued Requests",tX="Active Requests",nX="Cancelled Requests",rX="Queued Requests Ever",iX="Active Requests Ever",sX={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class oX{props;stats;activeRequestCount=0;requestQueue=[];requestMap=new Map;updateTimer=null;constructor(e={}){this.props={...sX,...e},this.stats=new Cd({id:this.props.id}),this.stats.get(eX),this.stats.get(tX),this.stats.get(nX),this.stats.get(rX),this.stats.get(iX)}scheduleRequest(e,t=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const r={handle:e,priority:0,getPriority:t},i=new Promise(s=>(r.resolve=s,r));return this.requestQueue.push(r),this.requestMap.set(e,i),this._issueNewRequests(),i}_issueRequest(e){const{handle:t,resolve:r}=e;let i=!1;const s=()=>{i||(i=!0,this.requestMap.delete(t),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,r?r({done:s}):Promise.resolve({done:s})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let t=0;t<e;++t){const r=this.requestQueue.shift();r&&this._issueRequest(r)}}}_updateAllRequests(){const e=this.requestQueue;for(let t=0;t<e.length;++t){const r=e[t];this._updateRequest(r)||(e.splice(t,1),this.requestMap.delete(r.handle),t--)}e.sort((t,r)=>t.priority-r.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let aX="";const rR={};function lX(n){for(const e in rR)if(n.startsWith(e)){const t=rR[e];n=n.replace(e,t)}return!n.startsWith("http://")&&!n.startsWith("https://")&&(n=`${aX}${n}`),n}function cX(n){return n&&typeof n=="object"&&n.isBuffer}function vN(n){if(cX(n))return n;if(n instanceof ArrayBuffer)return n;if(ArrayBuffer.isView(n))return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength);if(typeof n=="string"){const e=n;return new TextEncoder().encode(e).buffer}if(n&&typeof n=="object"&&n._toArrayBuffer)return n._toArrayBuffer();throw new Error("toArrayBuffer")}function bN(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(e+1):""}function uX(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(0,e):""}const hX=n=>typeof n=="boolean",If=n=>typeof n=="function",Id=n=>n!==null&&typeof n=="object",iR=n=>Id(n)&&n.constructor==={}.constructor,fX=n=>!!n&&typeof n[Symbol.iterator]=="function",dX=n=>n&&typeof n[Symbol.asyncIterator]=="function",Dl=n=>typeof Response<"u"&&n instanceof Response||n&&n.arrayBuffer&&n.text&&n.json,Ll=n=>typeof Blob<"u"&&n instanceof Blob,pX=n=>n&&typeof n=="object"&&n.isBuffer,gX=n=>typeof ReadableStream<"u"&&n instanceof ReadableStream||Id(n)&&If(n.tee)&&If(n.cancel)&&If(n.getReader),mX=n=>Id(n)&&If(n.read)&&If(n.pipe)&&hX(n.readable),TN=n=>gX(n)||mX(n);class _X extends Error{constructor(e,t){super(e),this.reason=t.reason,this.url=t.url,this.response=t.response}reason;url;response}const yX=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,vX=/^([-\w.]+\/[-\w.+]+)/;function sR(n,e){return n.toLowerCase()===e.toLowerCase()}function bX(n){const e=vX.exec(n);return e?e[1]:n}function oR(n){const e=yX.exec(n);return e?e[1]:""}const wN=/\?.*/;function TX(n){const e=n.match(wN);return e&&e[0]}function lE(n){return n.replace(wN,"")}function wX(n){if(n.length<50)return n;const e=n.slice(n.length-15);return`${n.substr(0,32)}...${e}`}function F_(n){return Dl(n)?n.url:Ll(n)?n.name||"":typeof n=="string"?n:""}function cE(n){if(Dl(n)){const e=n,t=e.headers.get("content-type")||"",r=lE(e.url);return bX(t)||oR(r)}return Ll(n)?n.type||"":typeof n=="string"?oR(n):""}function EX(n){return Dl(n)?n.headers["content-length"]||-1:Ll(n)?n.size:typeof n=="string"?n.length:n instanceof ArrayBuffer||ArrayBuffer.isView(n)?n.byteLength:-1}async function EN(n){if(Dl(n))return n;const e={},t=EX(n);t>=0&&(e["content-length"]=String(t));const r=F_(n),i=cE(n);i&&(e["content-type"]=i);const s=await SX(n);s&&(e["x-first-bytes"]=s),typeof n=="string"&&(n=new TextEncoder().encode(n));const o=new Response(n,{headers:e});return Object.defineProperty(o,"url",{value:r}),o}async function xX(n){if(!n.ok)throw await AX(n)}async function AX(n){const e=wX(n.url);let t=`Failed to fetch resource (${n.status}) ${n.statusText}: ${e}`;t=t.length>100?`${t.slice(0,100)}...`:t;const r={reason:n.statusText,url:n.url,response:n};try{const i=n.headers.get("Content-Type");r.reason=!n.bodyUsed&&i?.includes("application/json")?await n.json():await n.text()}catch{}return new _X(t,r)}async function SX(n){if(typeof n=="string")return`data:,${n.slice(0,5)}`;if(n instanceof Blob){const t=n.slice(0,5);return await new Promise(r=>{const i=new FileReader;i.onload=s=>r(s?.target?.result),i.readAsDataURL(t)})}if(n instanceof ArrayBuffer){const t=n.slice(0,5);return`data:base64,${RX(t)}`}return null}function RX(n){let e="";const t=new Uint8Array(n);for(let r=0;r<t.byteLength;r++)e+=String.fromCharCode(t[r]);return btoa(e)}function CX(n){return!IX(n)&&!PX(n)}function IX(n){return n.startsWith("http:")||n.startsWith("https:")}function PX(n){return n.startsWith("data:")}async function aR(n,e){if(typeof n=="string"){const t=lX(n);return CX(t)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(t,e):await fetch(t,e)}return await EN(n)}const lR=new Rd({id:"loaders.gl"});class MX{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class OX{console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const xN={fetch:null,mimeType:void 0,nothrow:!1,log:new OX,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:oE,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},kX={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function AN(){globalThis.loaders=globalThis.loaders||{};const{loaders:n}=globalThis;return n._state||(n._state={}),n._state}function SN(){const n=AN();return n.globalOptions=n.globalOptions||{...xN},n.globalOptions}function NX(n,e,t,r){return t=t||[],t=Array.isArray(t)?t:[t],DX(n,t),UX(e,n,r)}function DX(n,e){cR(n,null,xN,kX,e);for(const t of e){const r=n&&n[t.id]||{},i=t.options&&t.options[t.id]||{},s=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};cR(r,t.id,i,s,e)}}function cR(n,e,t,r,i){const s=e||"Top level",o=e?`${e}.`:"";for(const l in n){const u=!e&&Id(n[l]),h=l==="baseUri"&&!e,d=l==="workerUrl"&&e;if(!(l in t)&&!h&&!d){if(l in r)lR.warn(`${s} loader option '${o}${l}' no longer supported, use '${r[l]}'`)();else if(!u){const g=LX(l,i);lR.warn(`${s} loader option '${o}${l}' not recognized. ${g}`)()}}}}function LX(n,e){const t=n.toLowerCase();let r="";for(const i of e)for(const s in i.options){if(n===s)return`Did you mean '${i.id}.${s}'?`;const o=s.toLowerCase();(t.startsWith(o)||o.startsWith(t))&&(r=r||`Did you mean '${i.id}.${s}'?`)}return r}function UX(n,e,t){const i={...n.options||{}};return FX(i,t),i.log===null&&(i.log=new MX),uR(i,SN()),uR(i,e),i}function uR(n,e){for(const t in e)if(t in e){const r=e[t];iR(r)&&iR(n[t])?n[t]={...n[t],...e[t]}:n[t]=e[t]}}function FX(n,e){e&&!("baseUri"in n)&&(n.baseUri=e)}function uE(n){return n?(Array.isArray(n)&&(n=n[0]),Array.isArray(n?.extensions)):!1}function hE(n){jm(n,"null loader"),jm(uE(n),"invalid loader");let e;return Array.isArray(n)&&(e=n[1],n=n[0],n={...n,options:{...n.options,...e}}),(n?.parseTextSync||n?.parseText)&&(n.text=!0),n.text||(n.binary=!0),n}const RN=()=>{const n=AN();return n.loaderRegistry=n.loaderRegistry||[],n.loaderRegistry};function BX(n){const e=RN();n=Array.isArray(n)?n:[n];for(const t of n){const r=hE(t);e.find(i=>r===i)||e.unshift(r)}}function VX(){return RN()}const zX=/\.([^.]+)$/;async function jX(n,e=[],t,r){if(!CN(n))return null;let i=hR(n,e,{...t,nothrow:!0},r);if(i)return i;if(Ll(n)&&(n=await n.slice(0,10).arrayBuffer(),i=hR(n,e,t,r)),!i&&!t?.nothrow)throw new Error(IN(n));return i}function hR(n,e=[],t,r){if(!CN(n))return null;if(e&&!Array.isArray(e))return hE(e);let i=[];e&&(i=i.concat(e)),t?.ignoreRegisteredLoaders||i.push(...VX()),$X(i);const s=HX(n,i,t,r);if(!s&&!t?.nothrow)throw new Error(IN(n));return s}function HX(n,e,t,r){const i=F_(n),s=cE(n),o=lE(i)||r?.url;let l=null,u="";return t?.mimeType&&(l=Nb(e,t?.mimeType),u=`match forced by supplied MIME type ${t?.mimeType}`),l=l||WX(e,o),u=u||(l?`matched url ${o}`:""),l=l||Nb(e,s),u=u||(l?`matched MIME type ${s}`:""),l=l||XX(e,n),u=u||(l?`matched initial data ${PN(n)}`:""),t?.fallbackMimeType&&(l=l||Nb(e,t?.fallbackMimeType),u=u||(l?`matched fallback MIME type ${s}`:"")),u&&kq.log(1,`selectLoader selected ${l?.name}: ${u}.`),l}function CN(n){return!(n instanceof Response&&n.status===204)}function IN(n){const e=F_(n),t=cE(n);let r="No valid loader found (";r+=e?`${bN(e)}, `:"no url provided, ",r+=`MIME type: ${t?`"${t}"`:"not provided"}, `;const i=n?PN(n):"";return r+=i?` first bytes: "${i}"`:"first bytes: not available",r+=")",r}function $X(n){for(const e of n)hE(e)}function WX(n,e){const t=e&&zX.exec(e),r=t&&t[1];return r?qX(n,r):null}function qX(n,e){e=e.toLowerCase();for(const t of n)for(const r of t.extensions)if(r.toLowerCase()===e)return t;return null}function Nb(n,e){for(const t of n)if(t.mimeTypes?.some(r=>sR(e,r))||sR(e,`application/x.${t.id}`))return t;return null}function XX(n,e){if(!e)return null;for(const t of n)if(typeof e=="string"){if(YX(e,t))return t}else if(ArrayBuffer.isView(e)){if(fR(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&fR(e,0,t))return t;return null}function YX(n,e){return e.testText?e.testText(n):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>n.startsWith(r))}function fR(n,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(i=>KX(n,e,t,i))}function KX(n,e,t,r){if(r instanceof ArrayBuffer)return Gq(r,n,r.byteLength);switch(typeof r){case"function":return r(n);case"string":const i=tT(n,e,r.length);return r===i;default:return!1}}function PN(n,e=5){return typeof n=="string"?n.slice(0,e):ArrayBuffer.isView(n)?tT(n.buffer,n.byteOffset,e):n instanceof ArrayBuffer?tT(n,0,e):""}function tT(n,e,t){if(n.byteLength<e+t)return"";const r=new DataView(n);let i="";for(let s=0;s<t;s++)i+=String.fromCharCode(r.getUint8(e+s));return i}const GX=256*1024;function*ZX(n,e){const t=e?.chunkSize||GX;let r=0;const i=new TextEncoder;for(;r<n.length;){const s=Math.min(n.length-r,t),o=n.slice(r,r+s);r+=s,yield i.encode(o)}}const QX=256*1024;function*JX(n,e={}){const{chunkSize:t=QX}=e;let r=0;for(;r<n.byteLength;){const i=Math.min(n.byteLength-r,t),s=new ArrayBuffer(i),o=new Uint8Array(n,r,i);new Uint8Array(s).set(o),r+=i,yield s}}const eY=1024*1024;async function*tY(n,e){const t=e?.chunkSize||eY;let r=0;for(;r<n.size;){const i=r+t,s=await n.slice(r,i).arrayBuffer();r=i,yield s}}function dR(n,e){return oE?nY(n,e):rY(n)}async function*nY(n,e){const t=n.getReader();let r;try{for(;;){const i=r||t.read();e?._streamReadAhead&&(r=t.read());const{done:s,value:o}=await i;if(s)return;yield vN(o)}}catch{t.releaseLock()}}async function*rY(n,e){for await(const t of n)yield vN(t)}function iY(n,e){if(typeof n=="string")return ZX(n,e);if(n instanceof ArrayBuffer)return JX(n,e);if(Ll(n))return tY(n,e);if(TN(n))return dR(n,e);if(Dl(n))return dR(n.body,e);throw new Error("makeIterator")}const MN="Cannot convert supplied data type";function sY(n,e,t){if(e.text&&typeof n=="string")return n;if(pX(n)&&(n=n.buffer),n instanceof ArrayBuffer){const r=n;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(n)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(n);let r=n.buffer;const i=n.byteLength||n.length;return(n.byteOffset!==0||i!==r.byteLength)&&(r=r.slice(n.byteOffset,n.byteOffset+i)),r}throw new Error(MN)}async function oY(n,e,t){const r=n instanceof ArrayBuffer||ArrayBuffer.isView(n);if(typeof n=="string"||r)return sY(n,e);if(Ll(n)&&(n=await EN(n)),Dl(n)){const i=n;return await xX(i),e.binary?await i.arrayBuffer():await i.text()}if(TN(n)&&(n=iY(n,t)),fX(n)||dX(n))return Jq(n);throw new Error(MN)}function ON(n,e){const t=SN(),r=n||t;return typeof r.fetch=="function"?r.fetch:Id(r.fetch)?i=>aR(i,r.fetch):e?.fetch?e?.fetch:aR}function aY(n,e,t){if(t)return t;const r={fetch:ON(e,n),...n};if(r.url){const i=lE(r.url);r.baseUrl=i,r.queryString=TX(r.url),r.filename=bN(i),r.baseUrl=uX(i)}return Array.isArray(r.loaders)||(r.loaders=null),r}function lY(n,e){if(n&&!Array.isArray(n))return n;let t;if(n&&(t=Array.isArray(n)?n:[n]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...r]:r}return t&&t.length?t:void 0}async function $m(n,e,t,r){e&&!Array.isArray(e)&&!uE(e)&&(r=void 0,t=e,e=void 0),n=await n,t=t||{};const i=F_(n),o=lY(e,r),l=await jX(n,o,t);return l?(t=NX(t,l,o,i),r=aY({url:i,_parse:$m,loaders:o},t,r||null),await cY(l,n,t,r)):null}async function cY(n,e,t,r){if(qq(n),t=Nq(n.options,t),Dl(e)){const s=e,{ok:o,redirected:l,status:u,statusText:h,type:d,url:g}=s,y=Object.fromEntries(s.headers.entries());r.response={headers:y,ok:o,redirected:l,status:u,statusText:h,type:d,url:g}}e=await oY(e,n,t);const i=n;if(i.parseTextSync&&typeof e=="string")return i.parseTextSync(e,t,r);if(Xq(n,t))return await Yq(n,e,t,r,$m);if(i.parseText&&typeof e=="string")return await i.parseText(e,t,r);if(i.parse)return await i.parse(e,t,r);throw ga(!i.parseSync),new Error(`${n.id} loader - no parser found and worker is disabled`)}async function Wm(n,e,t,r){let i,s;!Array.isArray(e)&&!uE(e)?(i=[],s=e):(i=e,s=t);const o=ON(s);let l=n;return typeof n=="string"&&(l=await o(n)),Ll(n)&&(l=await o(n)),Array.isArray(i)?await $m(l,i,s):await $m(l,i,s)}const uY="4.3.3",hY=globalThis.loaders?.parseImageNode,nT=typeof Image<"u",rT=typeof ImageBitmap<"u",fY=!!hY,iT=oE?!0:fY;function dY(n){switch(n){case"auto":return rT||nT||iT;case"imagebitmap":return rT;case"image":return nT;case"data":return iT;default:throw new Error(`@loaders.gl/images: image ${n} not supported in this environment`)}}function pY(){if(rT)return"imagebitmap";if(nT)return"image";if(iT)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function gY(n){const e=_Y(n);if(!e)throw new Error("Not an image");return e}function mY(n){switch(gY(n)){case"data":return n;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=n.width,e.height=n.height,t.drawImage(n,0,0),t.getImageData(0,0,n.width,n.height);default:throw new Error("getImageData")}}function _Y(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&n instanceof Image?"image":n&&typeof n=="object"&&n.data&&n.width&&n.height?"data":null}const yY=/^data:image\/svg\+xml/,vY=/\.svg((\?|#).*)?$/;function fE(n){return n&&(yY.test(n)||vY.test(n))}function bY(n,e){if(fE(e)){let r=new TextDecoder().decode(n);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(s){throw new Error(s.message)}return`data:image/svg+xml;base64,${btoa(r)}`}return kN(n,e)}function kN(n,e){if(fE(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(n)])}async function NN(n,e,t){const r=bY(n,t),i=self.URL||self.webkitURL,s=typeof r!="string"&&i.createObjectURL(r);try{return await TY(s||r,e)}finally{s&&i.revokeObjectURL(s)}}async function TY(n,e){const t=new Image;return t.src=n,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((r,i)=>{try{t.onload=()=>r(t),t.onerror=s=>{const o=s instanceof Error?s.message:"error";i(new Error(o))}}catch(s){i(s)}})}const wY={};let pR=!0;async function EY(n,e,t){let r;fE(t)?r=await NN(n,e,t):r=kN(n,t);const i=e&&e.imagebitmap;return await xY(r,i)}async function xY(n,e=null){if((AY(e)||!pR)&&(e=null),e)try{return await createImageBitmap(n,e)}catch(t){console.warn(t),pR=!1}return await createImageBitmap(n)}function AY(n){for(const e in n||wY)return!1;return!0}function SY(n){return!PY(n,"ftyp",4)||(n[8]&96)===0?null:RY(n)}function RY(n){switch(CY(n,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function CY(n,e,t){return String.fromCharCode(...n.slice(e,t))}function IY(n){return[...n].map(e=>e.charCodeAt(0))}function PY(n,e,t=0){const r=IY(e);for(let i=0;i<r.length;++i)if(r[i]!==n[i+t])return!1;return!0}const Fi=!1,Pf=!0;function DN(n){const e=Pd(n);return OY(e)||DY(e)||kY(e)||NY(e)||MY(e)}function MY(n){const e=new Uint8Array(n instanceof DataView?n.buffer:n),t=SY(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function OY(n){const e=Pd(n);return e.byteLength>=24&&e.getUint32(0,Fi)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Fi),height:e.getUint32(20,Fi)}:null}function kY(n){const e=Pd(n);return e.byteLength>=10&&e.getUint32(0,Fi)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Pf),height:e.getUint16(8,Pf)}:null}function NY(n){const e=Pd(n);return e.byteLength>=14&&e.getUint16(0,Fi)===16973&&e.getUint32(2,Pf)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Pf),height:e.getUint32(22,Pf)}:null}function DY(n){const e=Pd(n);if(!(e.byteLength>=3&&e.getUint16(0,Fi)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:i}=LY();let s=2;for(;s+9<e.byteLength;){const o=e.getUint16(s,Fi);if(i.has(o))return{mimeType:"image/jpeg",height:e.getUint16(s+5,Fi),width:e.getUint16(s+7,Fi)};if(!r.has(o))return null;s+=2,s+=e.getUint16(s,Fi)}return null}function LY(){const n=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)n.add(t);return{tableMarkers:n,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Pd(n){if(n instanceof DataView)return n;if(ArrayBuffer.isView(n))return new DataView(n.buffer);if(n instanceof ArrayBuffer)return new DataView(n);throw new Error("toDataView")}async function UY(n,e){const{mimeType:t}=DN(n)||{},r=globalThis.loaders?.parseImageNode;return jm(r),await r(n,t)}async function FY(n,e,t){e=e||{};const i=(e.image||{}).type||"auto",{url:s}=t||{},o=BY(i);let l;switch(o){case"imagebitmap":l=await EY(n,e,s);break;case"image":l=await NN(n,e,s);break;case"data":l=await UY(n);break;default:jm(!1)}return i==="data"&&(l=mY(l)),l}function BY(n){switch(n){case"auto":case"data":return pY();default:return dY(n),n}}const VY=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],zY=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],jY={image:{type:"auto",decode:!0}},HY={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:uY,mimeTypes:zY,extensions:VY,parse:FY,tests:[n=>!!DN(new DataView(n))],options:jY},ot=new Rd({id:"deck"});let sT={};function $Y(n){sT=n}function qn(n,e,t,r){ot.level>0&&sT[n]&&sT[n].call(null,e,t,r)}function WY(n){const e=n[0],t=n[n.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}const qY={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:WY,parseTextSync:JSON.parse};function XY(){const n="9.1.14",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==n)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${n}`);return e||(ot.log(1,`deck.gl ${n}`)(),globalThis.deck={...globalThis.deck,VERSION:n,version:n,log:ot,_registerLoggers:$Y},BX([qY,[HY,{imagebitmap:{premultiplyAlpha:"none"}}]])),n}const YY=XY();function dE(n,e){if(!n)throw new Error(e||"shadertools: assertion failed.")}const Db={number:{type:"number",validate(n,e){return Number.isFinite(n)&&typeof e=="object"&&(e.max===void 0||n<=e.max)&&(e.min===void 0||n>=e.min)}},array:{type:"array",validate(n,e){return Array.isArray(n)||ArrayBuffer.isView(n)}}};function KY(n){const e={};for(const[t,r]of Object.entries(n))e[t]=GY(r);return e}function GY(n){let e=gR(n);if(e!=="object")return{value:n,...Db[e],type:e};if(typeof n=="object")return n?n.type!==void 0?{...n,...Db[n.type],type:n.type}:n.value===void 0?{type:"object",value:n}:(e=gR(n.value),{...n,...Db[e],type:e}):{type:"object",value:null};throw new Error("props")}function gR(n){return Array.isArray(n)||ArrayBuffer.isView(n)?"array":typeof n}const ZY=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,QY=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,JY={vertex:ZY,fragment:QY},mR=/void\s+main\s*\([^)]*\)\s*\{\n?/,_R=/}\n?[^{}]*$/,Lb=[],Jg="__LUMA_INJECT_DECLARATIONS__";function eK(n){const e={vertex:{},fragment:{}};for(const t in n){let r=n[t];const i=tK(t);typeof r=="string"&&(r={order:0,injection:r}),e[i][t]=r}return e}function tK(n){const e=n.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function qm(n,e,t,r=!1){const i=e==="vertex";for(const s in t){const o=t[s];o.sort((u,h)=>u.order-h.order),Lb.length=o.length;for(let u=0,h=o.length;u<h;++u)Lb[u]=o[u].injection;const l=`${Lb.join(`
`)}
`;switch(s){case"vs:#decl":i&&(n=n.replace(Jg,l));break;case"vs:#main-start":i&&(n=n.replace(mR,u=>u+l));break;case"vs:#main-end":i&&(n=n.replace(_R,u=>l+u));break;case"fs:#decl":i||(n=n.replace(Jg,l));break;case"fs:#main-start":i||(n=n.replace(mR,u=>u+l));break;case"fs:#main-end":i||(n=n.replace(_R,u=>l+u));break;default:n=n.replace(s,u=>u+l)}}return n=n.replace(Jg,""),r&&(n=n.replace(/\}\s*$/,s=>s+JY[e])),n}function Xm(n){n.map(e=>nK(e))}function nK(n){if(n.instance)return;Xm(n.dependencies||[]);const{propTypes:e={},deprecations:t=[],inject:r={}}=n,i={normalizedInjections:eK(r),parsedDeprecations:rK(t)};e&&(i.propValidators=KY(e)),n.instance=i;let s={};e&&(s=Object.entries(e).reduce((o,[l,u])=>{const h=u?.value;return h&&(o[l]=h),o},{})),n.defaultUniforms={...n.defaultUniforms,...s}}function LN(n,e,t){n.deprecations?.forEach(r=>{r.regex?.test(e)&&(r.deprecated?t.deprecated(r.old,r.new)():t.removed(r.old,r.new)())})}function rK(n){return n.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),n}function pE(n){Xm(n);const e={},t={};UN({modules:n,level:0,moduleMap:e,moduleDepth:t});const r=Object.keys(t).sort((i,s)=>t[s]-t[i]).map(i=>e[i]);return Xm(r),r}function UN(n){const{modules:e,level:t,moduleMap:r,moduleDepth:i}=n;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const s of e)r[s.name]=s,(i[s.name]===void 0||i[s.name]<t)&&(i[s.name]=t);for(const s of e)s.dependencies&&UN({modules:s.dependencies,level:t+1,moduleMap:r,moduleDepth:i})}function iK(n){switch(n?.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function sK(n,e){if(Number(n.match(/^#version[ \t]+(\d+)/m)?.[1]||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return n=yR(n,oK),n;case"fragment":return n=yR(n,aK),n;default:throw new Error(e)}}const FN=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],oK=[...FN,[oT("attribute"),"in $1"],[oT("varying"),"out $1"]],aK=[...FN,[oT("varying"),"in $1"]];function yR(n,e){for(const[t,r]of e)n=n.replace(t,r);return n}function oT(n){return new RegExp(`\\b${n}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function BN(n,e){let t="";for(const r in n){const i=n[r];if(t+=`void ${i.signature} {
`,i.header&&(t+=`  ${i.header}`),e[r]){const s=e[r];s.sort((o,l)=>o.order-l.order);for(const o of s)t+=`  ${o.injection}
`}i.footer&&(t+=`  ${i.footer}`),t+=`}
`}return t}function VN(n){const e={vertex:{},fragment:{}};for(const t of n){let r,i;typeof t!="string"?(r=t,i=r.hook):(r={},i=t),i=i.trim();const[s,o]=i.split(":"),l=i.replace(/\(.+/,""),u=Object.assign(r,{signature:o});switch(s){case"vs":e.vertex[l]=u;break;case"fs":e.fragment[l]=u;break;default:throw new Error(s)}}return e}function lK(n,e){return{name:cK(n,e),language:"glsl",version:uK(n)}}function cK(n,e="unnamed"){const r=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(n);return r?r[1]:e}function uK(n){let e=100;const t=n.match(/[^\s]+/g);if(t&&t.length>=2&&t[0]==="#version"){const r=parseInt(t[1],10);Number.isFinite(r)&&(e=r)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const zN=`

${Jg}
`,hK=`precision highp float;
`;function fK(n){const e=pE(n.modules||[]);return{source:pK(n.platformInfo,{...n,source:n.source,stage:"vertex",modules:e}),getUniforms:jN(e)}}function dK(n){const{vs:e,fs:t}=n,r=pE(n.modules||[]);return{vs:vR(n.platformInfo,{...n,source:e,stage:"vertex",modules:r}),fs:vR(n.platformInfo,{...n,source:t,stage:"fragment",modules:r}),getUniforms:jN(r)}}function pK(n,e){const{source:t,stage:r,modules:i,hookFunctions:s=[],inject:o={},log:l}=e;dE(typeof t=="string","shader source must be a string");const u=t;let h="";const d=VN(s),g={},y={},b={};for(const E in o){const x=typeof o[E]=="string"?{injection:o[E],order:0}:o[E],C=/^(v|f)s:(#)?([\w-]+)$/.exec(E);if(C){const M=C[2],O=C[3];M?O==="decl"?y[E]=[x]:b[E]=[x]:g[E]=[x]}else b[E]=[x]}const w=i;for(const E of w){l&&LN(E,u,l);const x=HN(E,"wgsl");h+=x;const C=E.injections?.[r]||{};for(const M in C){const O=/^(v|f)s:#([\w-]+)$/.exec(M);if(O){const H=O[2]==="decl"?y:b;H[M]=H[M]||[],H[M].push(C[M])}else g[M]=g[M]||[],g[M].push(C[M])}}return h+=zN,h=qm(h,r,y),h+=BN(d[r],g),h+=u,h=qm(h,r,b),h}function vR(n,e){const{id:t,source:r,stage:i,language:s="glsl",modules:o,defines:l={},hookFunctions:u=[],inject:h={},prologue:d=!0,log:g}=e;dE(typeof r=="string","shader source must be a string");const y=s==="glsl"?lK(r).version:-1,b=n.shaderLanguageVersion,w=y===100?"#version 100":"#version 300 es",x=r.split(`
`).slice(1).join(`
`),C={};o.forEach(D=>{Object.assign(C,D.defines)}),Object.assign(C,l);let M="";switch(s){case"wgsl":break;case"glsl":M=d?`${w}

// ----- PROLOGUE -------------------------
${gK({id:t,source:r,stage:i})}
${`#define SHADER_TYPE_${i.toUpperCase()}`}

${iK(n)}
${i==="fragment"?hK:""}

// ----- APPLICATION DEFINES -------------------------

${mK(C)}

`:`${w}
`;break}const O=VN(u),V={},H={},G={};for(const D in h){const I=typeof h[D]=="string"?{injection:h[D],order:0}:h[D],N=/^(v|f)s:(#)?([\w-]+)$/.exec(D);if(N){const j=N[2],W=N[3];j?W==="decl"?H[D]=[I]:G[D]=[I]:V[D]=[I]}else G[D]=[I]}for(const D of o){g&&LN(D,x,g);const I=HN(D,i);M+=I;const N=D.instance?.normalizedInjections[i]||{};for(const j in N){const W=/^(v|f)s:#([\w-]+)$/.exec(j);if(W){const z=W[2]==="decl"?H:G;z[j]=z[j]||[],z[j].push(N[j])}else V[j]=V[j]||[],V[j].push(N[j])}}return M+="// ----- MAIN SHADER SOURCE -------------------------",M+=zN,M=qm(M,i,H),M+=BN(O[i],V),M+=x,M=qm(M,i,G),s==="glsl"&&y!==b&&(M=sK(M,i)),M.trim()}function jN(n){return function(t){const r={};for(const i of n){const s=i.getUniforms?.(t,r);Object.assign(r,s)}return r}}function gK(n){const{id:e,source:t,stage:r}=n;return e&&t.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${r}`:""}function mK(n={}){let e="";for(const t in n){const r=n[t];(r||Number.isFinite(r))&&(e+=`#define ${t.toUpperCase()} ${n[t]}
`)}return e}function HN(n,e){let t;switch(e){case"vertex":t=n.vs||"";break;case"fragment":t=n.fs||"";break;case"wgsl":t=n.source||"";break;default:dE(!1)}if(!n.name)throw new Error("Shader module must have a name");const r=n.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let i=`// ----- MODULE ${n.name} ---------------

`;return e!=="wgsl"&&(i+=`#define MODULE_${r}
`),i+=`${t}
`,i}const _K=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,yK=/^\s*\#\s*endif\s*$/;function vK(n,e){const t=n.split(`
`),r=[];let i=!0,s=null;for(const o of t){const l=o.match(_K),u=o.match(yK);l?(s=l[1],i=!!e?.defines?.[s]):u?i=!0:i&&r.push(o)}return r.join(`
`)}class ll{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return ll.defaultShaderAssembler=ll.defaultShaderAssembler||new ll,ll.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const t=this._getModuleList(e.modules),r=this._hookFunctions,{source:i,getUniforms:s}=fK({...e,source:e.source,modules:t,hookFunctions:r});return{source:e.platformInfo.shaderLanguage==="wgsl"?vK(i):i,getUniforms:s,modules:t}}assembleGLSLShaderPair(e){const t=this._getModuleList(e.modules),r=this._hookFunctions;return{...dK({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:r}),modules:t}}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),r={};let i=0;for(let s=0,o=this._defaultModules.length;s<o;++s){const l=this._defaultModules[s],u=l.name;t[i++]=l,r[u]=!0}for(let s=0,o=e.length;s<o;++s){const l=e[s],u=l.name;r[u]||(t[i++]=l,r[u]=!0)}return t.length=i,Xm(t),t}}const bK=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,TK=`#version 300 es
${bK}`;function wK(n){const{input:e,inputChannels:t,output:r}={};if(!e)return TK;if(!t)throw new Error("inputChannels");const i=EK(t),s=xK(e,t);return`#version 300 es
in ${i} ${e};
out vec4 ${r};
void main() {
  ${r} = ${s};
}`}function EK(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${n}`)}}function xK(n,e){switch(e){case 1:return`vec4(${n}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${n}, 0.0, 1.0)`;case 3:return`vec4(${n}, 1.0)`;case 4:return n;default:throw new Error(`invalid channels: ${e}`)}}class AK{stats=new Map;getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Cd({id:e})),this.stats.get(e)}}const $N=new AK,we=new Rd({id:"luma.gl"}),Ub={};function B_(n="id"){Ub[n]=Ub[n]||1;const e=Ub[n]++;return`${n}-${e}`}let St=class{static defaultProps={id:"undefined",handle:void 0,userData:void 0};toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(e,t,r){if(!e)throw new Error("no device");this._device=e,this.props=SK(t,r);const i=this.props.id!=="undefined"?this.props.id:B_(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").addCount(e),r.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}};function SK(n,e){const t={...e};for(const r in n)n[r]!==void 0&&(t[r]=n[r]);return t}let Ft=class em extends St{static defaultProps={...St.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1};static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(e,t){const r={...t};(t.usage||0)&em.INDEX&&!t.indexType&&(t.data instanceof Uint32Array?r.indexType="uint32":t.data instanceof Uint16Array&&(r.indexType="uint16")),delete r.data,super(e,r,em.defaultProps),this.usage=r.usage||0,this.indexType=r.indexType,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createBuffer({...this.props,...e})}readSyncWebGL(e,t){throw new Error("not implemented")}static DEBUG_DATA_MAX_LENGTH=32;debugData=new ArrayBuffer(0);_setDebugData(e,t,r){const i=ArrayBuffer.isView(e)?e.buffer:e,s=Math.min(e?e.byteLength:r,em.DEBUG_DATA_MAX_LENGTH);i===null?this.debugData=new ArrayBuffer(s):t===0&&r===i.byteLength?this.debugData=i.slice(0,s):this.debugData=i.slice(t,t+s)}};function WN(n){const e=bR[n],t=RK(e),r=n.includes("norm"),i=!r&&!n.startsWith("float"),s=n.startsWith("s");return{dataType:bR[n],byteLength:t,integer:i,signed:s,normalized:r}}function RK(n){return CK[n]}const bR={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},CK={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},jn="texture-compression-bc",xt="texture-compression-astc",Oi="texture-compression-etc2",IK="texture-compression-etc1-webgl",fg="texture-compression-pvrtc-webgl",Fb="texture-compression-atc-webgl",dg="float32-renderable-webgl",Bb="float16-renderable-webgl",PK="rgb9e5ufloat-renderable-webgl",Vb="snorm8-renderable-webgl",rf="norm16-renderable-webgl",zb="snorm16-renderable-webgl",pg="float32-filterable",TR="float16-filterable-webgl";function qN(n){const e=MK[n];if(!e)throw new Error(`Unsupported texture format ${n}`);return e}const MK={r8unorm:{},r8snorm:{render:Vb},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:Vb},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:Bb,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:rf},"r16snorm-webgl":{f:zb},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:Vb},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:Bb,filter:TR},"rg16unorm-webgl":{render:rf},"rg16snorm-webgl":{render:zb},r32uint:{},r32sint:{},r32float:{render:dg,filter:pg},rgb9e5ufloat:{channels:"rgb",packed:!0,render:PK},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:dg},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:rf},"rgb16snorm-webgl":{f:rf},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:pg},rgba16uint:{},rgba16sint:{},rgba16float:{render:Bb,filter:TR},"rgba16unorm-webgl":{render:rf},"rgba16snorm-webgl":{render:zb},"rgb32float-webgl":{render:dg,filter:pg},rgba32uint:{},rgba32sint:{},rgba32float:{render:dg,filter:pg},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:jn},"bc1-rgb-unorm-srgb-webgl":{f:jn},"bc1-rgba-unorm":{f:jn},"bc1-rgba-unorm-srgb":{f:jn},"bc2-rgba-unorm":{f:jn},"bc2-rgba-unorm-srgb":{f:jn},"bc3-rgba-unorm":{f:jn},"bc3-rgba-unorm-srgb":{f:jn},"bc4-r-unorm":{f:jn},"bc4-r-snorm":{f:jn},"bc5-rg-unorm":{f:jn},"bc5-rg-snorm":{f:jn},"bc6h-rgb-ufloat":{f:jn},"bc6h-rgb-float":{f:jn},"bc7-rgba-unorm":{f:jn},"bc7-rgba-unorm-srgb":{f:jn},"etc2-rgb8unorm":{f:Oi},"etc2-rgb8unorm-srgb":{f:Oi},"etc2-rgb8a1unorm":{f:Oi},"etc2-rgb8a1unorm-srgb":{f:Oi},"etc2-rgba8unorm":{f:Oi},"etc2-rgba8unorm-srgb":{f:Oi},"eac-r11unorm":{f:Oi},"eac-r11snorm":{f:Oi},"eac-rg11unorm":{f:Oi},"eac-rg11snorm":{f:Oi},"astc-4x4-unorm":{f:xt},"astc-4x4-unorm-srgb":{f:xt},"astc-5x4-unorm":{f:xt},"astc-5x4-unorm-srgb":{f:xt},"astc-5x5-unorm":{f:xt},"astc-5x5-unorm-srgb":{f:xt},"astc-6x5-unorm":{f:xt},"astc-6x5-unorm-srgb":{f:xt},"astc-6x6-unorm":{f:xt},"astc-6x6-unorm-srgb":{f:xt},"astc-8x5-unorm":{f:xt},"astc-8x5-unorm-srgb":{f:xt},"astc-8x6-unorm":{f:xt},"astc-8x6-unorm-srgb":{f:xt},"astc-8x8-unorm":{f:xt},"astc-8x8-unorm-srgb":{f:xt},"astc-10x5-unorm":{f:xt},"astc-10x5-unorm-srgb":{f:xt},"astc-10x6-unorm":{f:xt},"astc-10x6-unorm-srgb":{f:xt},"astc-10x8-unorm":{f:xt},"astc-10x8-unorm-srgb":{f:xt},"astc-10x10-unorm":{f:xt},"astc-10x10-unorm-srgb":{f:xt},"astc-12x10-unorm":{f:xt},"astc-12x10-unorm-srgb":{f:xt},"astc-12x12-unorm":{f:xt},"astc-12x12-unorm-srgb":{f:xt},"pvrtc-rgb4unorm-webgl":{f:fg},"pvrtc-rgba4unorm-webgl":{f:fg},"pvrtc-rbg2unorm-webgl":{f:fg},"pvrtc-rgba2unorm-webgl":{f:fg},"etc1-rbg-unorm-webgl":{f:IK},"atc-rgb-unorm-webgl":{f:Fb},"atc-rgba-unorm-webgl":{f:Fb},"atc-rgbai-unorm-webgl":{f:Fb}},OK=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],kK=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function XN(n){return OK.some(e=>n.startsWith(e))}function gE(n){let e=NK(n);if(XN(n)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const r=DK(n);r&&(e.blockWidth=r.blockWidth,e.blockHeight=r.blockHeight)}const t=kK.exec(n);if(t){const[,r,i,s,o,l]=t,u=`${s}${i}`,h=WN(u),d=h.byteLength*8,g=r.length,y=[d,g>=2?d:0,g>=3?d:0,g>=4?d:0];e={format:n,attachment:e.attachment,dataType:h.dataType,components:g,channels:r,integer:h.integer,signed:h.signed,normalized:h.normalized,bitsPerChannel:y,bytesPerPixel:h.byteLength*r.length,packed:e.packed,srgb:e.srgb},l==="-webgl"&&(e.webgl=!0),o==="-srgb"&&(e.srgb=!0)}return n.endsWith("-webgl")&&(e.webgl=!0),n.endsWith("-srgb")&&(e.srgb=!0),e}function NK(n){const e=qN(n),t=e.bytesPerPixel||1,r=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:n,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||e.channels?.length||1,bytesPerPixel:t,bitsPerChannel:r,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function DK(n){const t=/.*-(\d+)x(\d+)-.*/.exec(n);if(t){const[,r,i]=t;return{blockWidth:Number(r),blockHeight:Number(i)}}return null}function LK(n){const e=qN(n),t={format:n,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},r=gE(n),i=n.startsWith("depth")||n.startsWith("stencil"),s=r?.signed,o=r?.integer,l=r?.webgl;return t.render&&=!s,t.filter&&=!i&&!s&&!o&&!l,t}class UK{}class FK{features;disabledFeatures;constructor(e=[],t){this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures?.[e]&&this.features.has(e)}}class ia{static defaultProps={id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>we.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:we.get("debug")||void 0,debugShaders:we.get("debug-shaders")||void 0,debugFramebuffers:!!we.get("debug-framebuffers"),debugWebGL:!!we.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0};get[Symbol.toStringTag](){return"Device"}constructor(e){this.props={...ia.defaultProps,...e},this.id=this.props.id||B_(this[Symbol.toStringTag].toLowerCase())}id;props;userData={};statsManager=$N;timestamp=0;_reused=!1;_lumaData={};getTextureFormatCapabilities(e){const t=LK(e),r=o=>(typeof o=="string"?this.features.has(o):o)??!0,i=r(t.create),s={format:e,create:i,render:i&&r(t.render),filter:i&&r(t.filter),blend:i&&r(t.blend),store:i&&r(t.store)};return this._getDeviceSpecificTextureFormatCapabilities(s)}isTextureFormatSupported(e,t){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return XN(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};return(e.usage||0)&Ft.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array?t.indexType="uint16":we.warn("indices buffer content must be of integer type")()),t}}const BK=Nl()&&typeof document<"u",VK=()=>BK&&document.readyState==="complete",zK="set luma.log.level=1 (or higher) to trace rendering",wR="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.";class jc{static defaultProps={...ia.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0};static pageLoaded=jK().then(()=>{we.probe(2,"DOM is loaded")()});stats=$N;log=we;VERSION="9.1.9";spector;preregisteredAdapters=new Map;constructor(){if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw we.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),we.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");we.error("This version of luma.gl has already been initialized")()}we.log(1,`${this.VERSION} - ${zK}`)(),globalThis.luma=this}registerAdapters(e){for(const t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(e=[]){const t=this.getAdapterMap(e);return Array.from(t).map(([,r])=>r).filter(r=>r.isSupported?.()).map(r=>r.type)}getBestAvailableAdapter(e=[]){const t=this.getAdapterMap(e);return t.get("webgpu")?.isSupported?.()?"webgpu":t.get("webgl")?.isSupported?.()?"webgl":null}setDefaultDeviceProps(e){Object.assign(jc.defaultProps,e)}async createDevice(e={}){e={...jc.defaultProps,...e},e.waitForPageLoad&&await jc.pageLoaded;const t=this.getAdapterMap(e.adapters);let r=e.type||"";r==="best-available"&&(r=this.getBestAvailableAdapter(e.adapters)||r);const o=await(this.getAdapterMap(e.adapters)||t).get(r)?.create?.(e);if(o)return o;throw new Error(wR)}async attachDevice(e){const t=this.getAdapterMap(e.adapters);let r="";e.handle instanceof WebGL2RenderingContext&&(r="webgl"),e.createCanvasContext&&await jc.pageLoaded,e.handle===null&&(r="unknown");const s=await t.get(r)?.attach?.(null);if(s)return s;throw new Error(wR)}enforceWebGL2(e=!0,t=[]){const i=this.getAdapterMap(t).get("webgl");i||we.warn("enforceWebGL2: webgl adapter not found")(),i?.enforceWebGL2?.(e)}getAdapterMap(e=[]){const t=new Map(this.preregisteredAdapters);for(const r of e)t.set(r.type,r);return t}registerDevices(e){we.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const t of e){const r=t.adapter;r&&this.preregisteredAdapters.set(r.type,r)}}}const aT=new jc;function jK(){return VK()||typeof window>"u"?Promise.resolve():new Promise(n=>{window.addEventListener("load",()=>n())})}class HK{}class mE{static defaultProps={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"};id;props;canvas;htmlCanvas;offscreenCanvas;type;width=1;height=1;resizeObserver;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};toString(){return`${this[Symbol.toStringTag]}(${this.id})`}constructor(e){if(this.props={...mE.defaultProps,...e},e=this.props,!Nl()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=WK(e.canvas):this.canvas=e.canvas;else{const t=qK(e),r=$K(e?.container||null);r.insertBefore(t,r.firstChild),this.canvas=t,e?.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(t=>{for(const r of t)r.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),t=this.canvas;return t.parentElement?[t.clientWidth*e,t.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,t]=this.getPixelSize();return e/t}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),t=this._canvasSizeInfo.clientWidth||this.htmlCanvas?.clientWidth;return t?e/t:1}catch{return 1}}cssToDevicePixels(e,t=!0){const r=this.cssToDeviceRatio(),[i,s]=this.getDrawingBufferSize();return XK(e,r,i,s,t)}setDevicePixelRatio(e,t={}){if(!this.htmlCanvas)return;let r="width"in t?t.width:this.htmlCanvas.clientWidth,i="height"in t?t.height:this.htmlCanvas.clientHeight;(!r||!i)&&(we.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=this.htmlCanvas.width||1,i=this.htmlCanvas.height||1);const s=this._canvasSizeInfo;if(s.clientWidth!==r||s.clientHeight!==i||s.devicePixelRatio!==e){let o=e;const l=Math.floor(r*o),u=Math.floor(i*o);if(this.htmlCanvas.width=l,this.htmlCanvas.height=u,this.device.gl){const[d,g]=this.getDrawingBufferSize();(d!==l||g!==u)&&(o=Math.min(d/r,g/i),this.htmlCanvas.width=Math.floor(r*o),this.htmlCanvas.height=Math.floor(i*o),we.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=r,this._canvasSizeInfo.clientHeight=i,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}}function $K(n){if(typeof n=="string"){const e=document.getElementById(n);if(!e)throw new Error(`${n} is not an HTML element`);return e}else if(n)return n;return document.body}function WK(n){const e=document.getElementById(n);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function qK(n){const{width:e,height:t}=n,r=document.createElement("canvas");return r.id=B_("lumagl-auto-created-canvas"),r.width=e||1,r.height=t||1,r.style.width=Number.isFinite(e)?`${e}px`:"100%",r.style.height=Number.isFinite(t)?`${t}px`:"100%",r}function XK(n,e,t,r,i){const s=n,o=ER(s[0],e,t);let l=xR(s[1],e,r,i),u=ER(s[0]+1,e,t);const h=u===t-1?u:u-1;u=xR(s[1]+1,e,r,i);let d;return i?(u=u===0?u:u+1,d=l,l=u):d=u===r-1?u:u-1,{x:o,y:l,width:Math.max(h-o+1,1),height:Math.max(d-l+1,1)}}function ER(n,e,t){return Math.min(Math.round(n*e),t-1)}function xR(n,e,t,r){return r?Math.max(0,t-1-Math.round(n*e)):Math.min(Math.round(n*e),t-1)}class At extends St{static COPY_SRC=1;static COPY_DST=2;static TEXTURE=4;static STORAGE=8;static RENDER_ATTACHMENT=16;static CubeFaces=["+X","-X","+Y","-Y","+Z","-Z"];static defaultProps={...St.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0};get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}dimension;format;width;height;depth;mipLevels;updateTimestamp;constructor(e,t){if(t=At.normalizeProps(e,t),super(e,t,At.defaultProps),this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const r=At.getTextureDataSize(this.props.data);this.width=r?.width||1,this.height=r?.height||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?At.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createTexture({...this.props,...e})}static isExternalImage(e){return typeof ImageData<"u"&&e instanceof ImageData||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement||typeof VideoFrame<"u"&&e instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas}static getExternalImageSize(e){if(typeof ImageData<"u"&&e instanceof ImageData||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height};if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement)return{width:e.naturalWidth,height:e.naturalHeight};if(typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement)return{width:e.videoWidth,height:e.videoHeight};if(typeof VideoFrame<"u"&&e instanceof VideoFrame)return{width:e.displayWidth,height:e.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(e){const t=e?.data;return ArrayBuffer.isView(t)}static getTextureDataSize(e){if(!e||ArrayBuffer.isView(e))return null;if(Array.isArray(e))return At.getTextureDataSize(e[0]);if(At.isExternalImage(e))return At.getExternalImageSize(e);if(e&&typeof e=="object"&&e.constructor===Object){const r=Object.values(e)[0];return{width:r.width,height:r.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(e,t){let r;return ArrayBuffer.isView(e)?r=[{data:e,width:t.width,height:t.height}]:Array.isArray(e)?r=e:r=[e],r}static getMipLevelCount(e,t){return Math.floor(Math.log2(Math.max(e,t)))+1}static getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(e)}}static defaultCopyExternalImageOptions={image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1};static normalizeProps(e,t){const r={...t},i=e?.props?._resourceDefaults?.texture||{};Object.assign(r,i);const{width:s,height:o}=r;return typeof s=="number"&&(r.width=Math.max(1,Math.ceil(s))),typeof o=="number"&&(r.height=Math.max(1,Math.ceil(o))),r}}class V_ extends St{static defaultProps={...St.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0};get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,V_.defaultProps)}}function YK(n,e,t){let r="";const i=e.split(/\r?\n/),s=n.slice().sort((o,l)=>o.lineNum-l.lineNum);switch(t?.showSourceCode||"no"){case"all":let o=0;for(let l=1;l<=i.length;l++)for(r+=YN(i[l-1],l,t);s.length>o&&s[o].lineNum===l;){const u=s[o++];r+=AR(u,i,u.lineNum,{...t,inlineSource:!1})}return r;case"issues":case"no":for(const l of n)r+=AR(l,i,l.lineNum,{inlineSource:t?.showSourceCode!=="no"});return r}}function AR(n,e,t,r){if(r?.inlineSource){const s=KK(e,t),o=n.linePos>0?`${" ".repeat(n.linePos+5)}^^^
`:"";return`
${s}${o}${n.type.toUpperCase()}: ${n.message}

`}const i=n.type==="error"?"red":"#8B4000";return r?.html?`<div class='luma-compiler-log-error' style="color:${i};"><b> ${n.type.toUpperCase()}: ${n.message}</b></div>`:`${n.type.toUpperCase()}: ${n.message}`}function KK(n,e,t){let r="";for(let i=e-2;i<=e;i++){const s=n[i-1];s!==void 0&&(r+=YN(s,e,t))}return r}function YN(n,e,t){const r=t?.html?ZK(n):n;return`${GK(String(e),4)}: ${r}${t?.html?"<br/>":`
`}`}function GK(n,e){let t="";for(let r=n.length;r<e;++r)t+=" ";return t+n}function ZK(n){return n.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}class z_ extends St{static defaultProps={...St.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0};get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(e,t){t={...t,debugShaders:t.debugShaders||e.props.debugShaders||"errors"},super(e,{id:QK(t),...t},z_.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const e=this.props.debugShaders;switch(e){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const t=await this.getCompilationInfo();e==="warnings"&&t?.length===0||this._displayShaderLog(t)}_displayShaderLog(e){if(typeof document>"u"||!document?.createElement)return;const t=KN(this.source),r=`${this.stage} ${t}`;let i=YK(e,this.source,{showSourceCode:"all",html:!0});const s=this.getTranslatedSource();s&&(i+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${s}</pre></code>`);const o=document.createElement("Button");o.innerHTML=`
<h1>Shader Compilation Error in ${r}</h1><br /><br />
<code style="user-select:text;"><pre>
${i}
</pre></code>`,o.style.top="10px",o.style.left="10px",o.style.position="absolute",o.style.zIndex="9999",o.style.width="100%",o.style.textAlign="left",document.body.appendChild(o),document.getElementsByClassName("luma-compiler-log-error")[0]?.scrollIntoView(),o.onclick=()=>{const u=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(u)}}}function QK(n){return KN(n.source)||n.id||B_(`unnamed ${n.stage}-shader`)}function KN(n,e="unnamed"){const r=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(n);return r?r[1]:e}class ed extends St{static defaultProps={...St.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){t=ed.normalizeProps(e,t),super(e,t,ed.defaultProps)}static normalizeProps(e,t){const r=e?.props?._resourceDefaults?.sampler||{};return{...t,...r}}}class j_ extends St{static defaultProps={...St.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null};get[Symbol.toStringTag](){return"Framebuffer"}width;height;constructor(e,t={}){super(e,t,j_.defaultProps),this.width=this.props.width,this.height=this.props.height}clone(e){const t=this.colorAttachments.map(i=>i.texture.clone(e)),r=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(e);return this.device.createFramebuffer({...this.props,colorAttachments:t,depthStencilAttachment:r})}resize(e){let t=!e;if(e){const[r,i]=Array.isArray(e)?e:[e.width,e.height];t=t||i!==this.height||r!==this.width,this.width=r,this.height=i}t&&(we.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((t,r)=>{if(typeof t=="string"){const i=this.createColorTexture(t,r);return this.attachResource(i),i.view}return t instanceof At?t.view:t});const e=this.props.depthStencilAttachment;if(e)if(typeof e=="string"){const t=this.createDepthStencilTexture(e);this.attachResource(t),this.depthStencilAttachment=t.view}else e instanceof At?this.depthStencilAttachment=e.view:this.depthStencilAttachment=e}createColorTexture(e,t){return this.device.createTexture({id:`${this.id}-color-attachment-${t}`,usage:At.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(e){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:At.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(e,t){for(let r=0;r<this.colorAttachments.length;++r)if(this.colorAttachments[r]){const i=this.colorAttachments[r].texture.clone({width:e,height:t});this.destroyAttachedResource(this.colorAttachments[r]),this.colorAttachments[r]=i.view,this.attachResource(i.view)}if(this.depthStencilAttachment){const r=this.depthStencilAttachment.texture.clone({width:e,height:t});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=r.view,this.attachResource(r)}this.updateAttachments()}}class bu extends St{static defaultProps={...St.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}};get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(e,t){super(e,t,bu.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}setUniformsWebGL(e){throw new Error("Use uniform blocks")}}class ol extends St{static defaultClearColor=[0,0,0,1];static defaultClearDepth=1;static defaultClearStencil=0;static defaultProps={...St.defaultProps,framebuffer:null,parameters:void 0,clearColor:ol.defaultClearColor,clearColors:void 0,clearDepth:ol.defaultClearDepth,clearStencil:ol.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0};get[Symbol.toStringTag](){return"RenderPass"}constructor(e,t){t=ol.normalizeProps(e,t),super(e,t,ol.defaultProps)}static normalizeProps(e,t){return{...e.props._resourceDefaults?.renderPass,...t}}}class Ym extends St{static defaultProps={...St.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0};get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(e,t){super(e,t,Ym.defaultProps),this.shaderLayout=t.shaderLayout}}class _E extends St{static defaultProps={...St.defaultProps,measureExecutionTime:void 0};get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,t){super(e,t,_E.defaultProps)}}class yE extends St{static defaultProps={...St.defaultProps};get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,t){super(e,t,yE.defaultProps)}}function JK(n){const[e,t]=tG[n],r=e==="i32"||e==="u32",i=e!=="u32",s=nG[e]*t,o=eG(e,t);return{dataType:e,components:t,defaultVertexFormat:o,byteLength:s,integer:r,signed:i}}function eG(n,e){let t;switch(n){case"f32":t="float32";break;case"i32":t="sint32";break;case"u32":t="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?t:`${t}x${e}`}const tG={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},nG={f32:4,f16:2,i32:4,u32:4};function GN(n){let e;n.endsWith("-webgl")&&(n.replace("-webgl",""),e=!0);const[t,r]=n.split("x"),i=t,s=r?parseInt(r):1,o=WN(i),l={type:i,components:s,byteLength:o.byteLength*s,integer:o.integer,signed:o.signed,normalized:o.normalized};return e&&(l.webglOnly=!0),l}function ZN(n,e){const t={};for(const r of n.attributes){const i=iG(n,e,r.name);i&&(t[r.name]=i)}return t}function rG(n,e,t=16){const r=ZN(n,e),i=new Array(t).fill(null);for(const s of Object.values(r))i[s.location]=s;return i}function iG(n,e,t){const r=sG(n,t),i=oG(e,t);if(!r)return null;const s=JK(r.type),o=i?.vertexFormat||s.defaultVertexFormat,l=GN(o);return{attributeName:i?.attributeName||r.name,bufferName:i?.bufferName||r.name,location:r.location,shaderType:r.type,shaderDataType:s.dataType,shaderComponents:s.components,vertexFormat:o,bufferDataType:l.type,bufferComponents:l.components,normalized:l.normalized,integer:s.integer,stepMode:i?.stepMode||r.stepMode||"vertex",byteOffset:i?.byteOffset||0,byteStride:i?.byteStride||0}}function sG(n,e){const t=n.attributes.find(r=>r.name===e);return t||we.warn(`shader layout attribute "${e}" not present in shader`),t||null}function oG(n,e){aG(n);let t=lG(n,e);return t||(t=cG(n,e),t)?t:(we.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function aG(n){for(const e of n)(e.attributes&&e.format||!e.attributes&&!e.format)&&we.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function lG(n,e){for(const t of n)if(t.format&&t.name===e)return{attributeName:t.name,bufferName:e,stepMode:t.stepMode,vertexFormat:t.format,byteOffset:0,byteStride:t.byteStride||0};return null}function cG(n,e){for(const t of n){let r=t.byteStride;if(typeof t.byteStride!="number")for(const s of t.attributes||[]){const o=GN(s.format);r+=o.byteLength}const i=t.attributes?.find(s=>s.attribute===e);if(i)return{attributeName:i.attribute,bufferName:t.name,stepMode:t.stepMode,vertexFormat:i.format,byteOffset:i.byteOffset,byteStride:r}}return null}class vE extends St{static defaultProps={...St.defaultProps,renderPipeline:null};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(e,t){super(e,t,vE.defaultProps),this.maxVertexAttributes=e.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:r,bufferLayout:i}=t.renderPipeline||{};if(!r||!i)throw new Error("VertexArray");this.attributeInfos=rG(r,i,this.maxVertexAttributes)}setConstantWebGL(e,t){this.device.reportError(new Error("constant attributes not supported"))}}class bE extends St{static defaultProps={...St.defaultProps,layout:void 0,buffers:{}};get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,t){super(e,t,bE.defaultProps)}}class TE extends St{static defaultProps={...St.defaultProps,type:void 0,count:void 0};get[Symbol.toStringTag](){return"QuerySet"}constructor(e,t){super(e,t,TE.defaultProps)}}const uG={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function hG(n){return uG[n]}function fG(n,e){switch(e){case 1:return n;case 2:return n+n%2;default:return n+(4-n%4)%4}}let gg;function QN(n){return(!gg||gg.byteLength<n)&&(gg=new ArrayBuffer(n)),gg}function dG(n,e){const t=QN(n.BYTES_PER_ELEMENT*e);return new n(t,0,e)}function pG(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function Km(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":pG(n)}const SR=1024;class gG{layout={};byteLength;constructor(e){let t=0;for(const[i,s]of Object.entries(e)){const o=hG(s),{type:l,components:u}=o;t=fG(t,u);const h=t;t+=u,this.layout[i]={type:l,size:u,offset:h}}t+=(4-t%4)%4;const r=t*4;this.byteLength=Math.max(r,SR)}getData(e){const t=Math.max(this.byteLength,SR),r=QN(t),i={i32:new Int32Array(r),u32:new Uint32Array(r),f32:new Float32Array(r),f16:new Uint16Array(r)};for(const[s,o]of Object.entries(e)){const l=this.layout[s];if(!l){we.warn(`Supplied uniform value ${s} not present in uniform block layout`)();continue}const{type:u,size:h,offset:d}=l,g=i[u];if(h===1){if(typeof o!="number"&&typeof o!="boolean"){we.warn(`Supplied value for single component uniform ${s} is not a number: ${o}`)();continue}g[d]=Number(o)}else{if(!Km(o)){we.warn(`Supplied value for multi component / array uniform ${s} is not a numeric array: ${o}`)();continue}g.set(o,d)}}return new Uint8Array(r)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function mG(n,e,t=16){if(n!==e)return!1;const r=n,i=e;if(!Km(r))return!1;if(Km(i)&&r.length===i.length){for(let s=0;s<r.length;++s)if(i[s]!==r[s])return!1}return!0}function _G(n){return Km(n)?n.slice():n}class yG{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(e){if(this.name=e?.name||"unnamed",e?.name&&e?.shaderLayout){const t=e?.shaderLayout.bindings?.find(i=>i.type==="uniform"&&i.name===e?.name);if(!t)throw new Error(e?.name);const r=t;for(const i of r.uniforms||[])this.bindingLayout[i.name]=i}}setUniforms(e){for(const[t,r]of Object.entries(e))this._setUniform(t,r),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${r}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){mG(this.uniforms[e],t)||(this.uniforms[e]=_G(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}class vG{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(e){for(const[t,r]of Object.entries(e)){const i=t,s=new gG(r.uniformTypes||{});this.uniformBufferLayouts.set(i,s);const o=new yG({name:t});o.setUniforms(r.defaultUniforms||{}),this.uniformBlocks.set(i,o)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[t,r]of Object.entries(e))this.uniformBlocks.get(t)?.setUniforms(r);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e)?.byteLength||0}getUniformBufferData(e){const t=this.uniformBlocks.get(e)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(e)?.getData(t)}createUniformBuffer(e,t,r){r&&this.setUniforms(r);const i=this.getUniformBufferByteLength(t),s=e.createBuffer({usage:Ft.UNIFORM|Ft.COPY_DST,byteLength:i}),o=this.getUniformBufferData(t);return s.write(o),s}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const r=this.getUniformBufferByteLength(t),i=e.createBuffer({usage:Ft.UNIFORM|Ft.COPY_DST,byteLength:r});this.uniformBuffers.set(t,i)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const r=this.updateUniformBuffer(t);e||=r}return e&&we.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const t=this.uniformBlocks.get(e);let r=this.uniformBuffers.get(e),i=!1;if(r&&t?.needsRedraw){i||=t.needsRedraw;const s=this.getUniformBufferData(e);r=this.uniformBuffers.get(e),r?.write(s);const o=this.uniformBlocks.get(e)?.getAllUniforms();we.log(4,`Writing to uniform buffer ${String(e)}`,s,o)()}return i}}function JN(n){const e=ArrayBuffer.isView(n)?n.constructor:n;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function e4(n){switch(n){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(n)}}function bG(n,e,t){if(!e||e>4)throw new Error(`size ${e}`);const r=e;let i=JN(n);if(i==="uint8"&&t&&r===1)return"unorm8-webgl";if(i==="uint8"&&t&&r===3)return"unorm8x3-webgl";if(i==="uint8"||i==="sint8"){if(r===1||r===3)throw new Error(`size: ${e}`);return t&&(i=i.replace("int","norm")),`${i}x${r}`}if(i==="uint16"||i==="sint16"){if(r===1||r===3)throw new Error(`size: ${e}`);return t&&(i=i.replace("int","norm")),`${i}x${r}`}return r===1?i:`${i}x${r}`}class jb{bufferLayouts;constructor(e){this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){return e.attributes?e.attributes?.map(t=>t.attribute):[e.name]}mergeBufferLayouts(e,t){const r=[...e];for(const i of t){const s=r.findIndex(o=>o.name===i.name);s<0?r.push(i):r[s]=i}return r}getBufferIndex(e){const t=this.bufferLayouts.findIndex(r=>r.name===e);return t===-1&&we.warn(`BufferLayout: Missing buffer for "${e}".`)(),t}}function TG(n,e){const t=Object.fromEntries(n.attributes.map(i=>[i.name,i.location])),r=e.slice();return r.sort((i,s)=>{const o=i.attributes?i.attributes.map(d=>d.attribute):[i.name],l=s.attributes?s.attributes.map(d=>d.attribute):[s.name],u=Math.min(...o.map(d=>t[d])),h=Math.min(...l.map(d=>t[d]));return u-h}),r}class $r{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class RR{constructor(e,t,r){this.name=e,this.type=t,this.attributes=r,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Yo extends $r{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class sa extends $r{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class lT extends $r{constructor(e,t,r){super(e,r),this.format=t}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class El extends $r{constructor(e,t,r,i){super(e,r),this.format=t,this.access=i}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}var zo;(n=>{n[n.Uniform=0]="Uniform",n[n.Storage=1]="Storage",n[n.Texture=2]="Texture",n[n.Sampler=3]="Sampler",n[n.StorageTexture=4]="StorageTexture"})(zo||(zo={}));class mg{constructor(e,t,r,i,s,o,l){this.name=e,this.type=t,this.group=r,this.binding=i,this.attributes=s,this.resourceType=o,this.access=l}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class wG{constructor(e,t){this.name=e,this.type=t}}class EG{constructor(e,t,r,i){this.name=e,this.type=t,this.locationType=r,this.location=i,this.interpolation=null}}class CR{constructor(e,t,r,i){this.name=e,this.type=t,this.locationType=r,this.location=i}}class xG{constructor(e,t,r,i){this.name=e,this.type=t,this.attributes=r,this.id=i}}class AG{constructor(e,t,r){this.name=e,this.type=t,this.attributes=r}}class SG{constructor(e,t=null,r){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=r}}class RG{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}function CG(n){var e=(32768&n)>>15,t=(31744&n)>>10,r=1023&n;return t==0?(e?-1:1)*Math.pow(2,-14)*(r/Math.pow(2,10)):t==31?r?NaN:1/0*(e?-1:1):(e?-1:1)*Math.pow(2,t-15)*(1+r/Math.pow(2,10))}const t4=new Float32Array(1),IG=new Int32Array(t4.buffer),Hn=new Uint16Array(1);function PG(n){t4[0]=n;const e=IG[0],t=e>>31&1;let r=e>>23&255,i=8388607&e;if(r===255)return Hn[0]=t<<15|31744|(i!==0?512:0),Hn[0];if(r===0){if(i===0)return Hn[0]=t<<15,Hn[0];i|=8388608;let s=113;for(;!(8388608&i);)i<<=1,s--;return r=127-s,i&=8388607,r>0?(i=(i>>126-r)+(i>>127-r&1),Hn[0]=t<<15|r<<10|i>>13,Hn[0]):(Hn[0]=t<<15,Hn[0])}return r=r-127+15,r>=31?(Hn[0]=t<<15|31744,Hn[0]):r<=0?r<-10?(Hn[0]=t<<15,Hn[0]):(i=(8388608|i)>>1-r,Hn[0]=t<<15|i>>13,Hn[0]):(i>>=13,Hn[0]=t<<15|r<<10|i,Hn[0])}const wE=new Uint32Array(1),n4=new Float32Array(wE.buffer,0,1);function IR(n){const e=112+(n>>6&31)<<23|(63&n)<<17;return wE[0]=e,n4[0]}function MG(n,e,t,r,i,s,o,l,u){const h=r*(o>>=i)*(s>>=i)+t*o+e*l;switch(u){case"r8unorm":return[dt(n,h,"8unorm",1)[0]];case"r8snorm":return[dt(n,h,"8snorm",1)[0]];case"r8uint":return[dt(n,h,"8uint",1)[0]];case"r8sint":return[dt(n,h,"8sint",1)[0]];case"rg8unorm":{const d=dt(n,h,"8unorm",2);return[d[0],d[1]]}case"rg8snorm":{const d=dt(n,h,"8snorm",2);return[d[0],d[1]]}case"rg8uint":{const d=dt(n,h,"8uint",2);return[d[0],d[1]]}case"rg8sint":{const d=dt(n,h,"8sint",2);return[d[0],d[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const d=dt(n,h,"8unorm",4);return[d[0],d[1],d[2],d[3]]}case"rgba8snorm":{const d=dt(n,h,"8snorm",4);return[d[0],d[1],d[2],d[3]]}case"rgba8uint":{const d=dt(n,h,"8uint",4);return[d[0],d[1],d[2],d[3]]}case"rgba8sint":{const d=dt(n,h,"8sint",4);return[d[0],d[1],d[2],d[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const d=dt(n,h,"8unorm",4);return[d[2],d[1],d[0],d[3]]}case"r16uint":return[dt(n,h,"16uint",1)[0]];case"r16sint":return[dt(n,h,"16sint",1)[0]];case"r16float":return[dt(n,h,"16float",1)[0]];case"rg16uint":{const d=dt(n,h,"16uint",2);return[d[0],d[1]]}case"rg16sint":{const d=dt(n,h,"16sint",2);return[d[0],d[1]]}case"rg16float":{const d=dt(n,h,"16float",2);return[d[0],d[1]]}case"rgba16uint":{const d=dt(n,h,"16uint",4);return[d[0],d[1],d[2],d[3]]}case"rgba16sint":{const d=dt(n,h,"16sint",4);return[d[0],d[1],d[2],d[3]]}case"rgba16float":{const d=dt(n,h,"16float",4);return[d[0],d[1],d[2],d[3]]}case"r32uint":return[dt(n,h,"32uint",1)[0]];case"r32sint":return[dt(n,h,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[dt(n,h,"32float",1)[0]];case"rg32uint":{const d=dt(n,h,"32uint",2);return[d[0],d[1]]}case"rg32sint":{const d=dt(n,h,"32sint",2);return[d[0],d[1]]}case"rg32float":{const d=dt(n,h,"32float",2);return[d[0],d[1]]}case"rgba32uint":{const d=dt(n,h,"32uint",4);return[d[0],d[1],d[2],d[3]]}case"rgba32sint":{const d=dt(n,h,"32sint",4);return[d[0],d[1],d[2],d[3]]}case"rgba32float":{const d=dt(n,h,"32float",4);return[d[0],d[1],d[2],d[3]]}case"rg11b10ufloat":{const d=new Uint32Array(n.buffer,h,1)[0],g=(4192256&d)>>11,y=(4290772992&d)>>22;return[IR(2047&d),IR(g),(function(b){const w=112+(b>>5&31)<<23|(31&b)<<18;return wE[0]=w,n4[0]})(y),1]}}return null}function dt(n,e,t,r){const i=[0,0,0,0];for(let s=0;s<r;++s)switch(t){case"8unorm":i[s]=n[e]/255,e++;break;case"8snorm":i[s]=n[e]/255*2-1,e++;break;case"8uint":i[s]=n[e],e++;break;case"8sint":i[s]=n[e]-127,e++;break;case"16uint":i[s]=n[e]|n[e+1]<<8,e+=2;break;case"16sint":i[s]=(n[e]|n[e+1]<<8)-32768,e+=2;break;case"16float":i[s]=CG(n[e]|n[e+1]<<8),e+=2;break;case"32uint":case"32sint":i[s]=n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24,e+=4;break;case"32float":i[s]=new Float32Array(n.buffer,e,1)[0],e+=4}return i}function pt(n,e,t,r,i){for(let s=0;s<r;++s)switch(t){case"8unorm":n[e]=255*i[s],e++;break;case"8snorm":n[e]=.5*(i[s]+1)*255,e++;break;case"8uint":n[e]=i[s],e++;break;case"8sint":n[e]=i[s]+127,e++;break;case"16uint":new Uint16Array(n.buffer,e,1)[0]=i[s],e+=2;break;case"16sint":new Int16Array(n.buffer,e,1)[0]=i[s],e+=2;break;case"16float":{const o=PG(i[s]);new Uint16Array(n.buffer,e,1)[0]=o,e+=2;break}case"32uint":new Uint32Array(n.buffer,e,1)[0]=i[s],e+=4;break;case"32sint":new Int32Array(n.buffer,e,1)[0]=i[s],e+=4;break;case"32float":new Float32Array(n.buffer,e,1)[0]=i[s],e+=4}return i}const Hb={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class Yr{constructor(){this.id=Yr._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){t(Gm.instance);for(const r of e)r instanceof Array?this.searchBlock(r,t):r.search(t);t(Zm.instance)}}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}Yr._id=0;class Gm extends Yr{}Gm.instance=new Gm;class Zm extends Yr{}Zm.instance=new Zm;const r4=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class Nt extends Yr{constructor(){super()}}class td extends Nt{constructor(e,t,r,i,s,o){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=r,this.body=i,this.startLine=s,this.endLine=o}get astNodeType(){return"function"}search(e){if(this.attributes)for(const t of this.attributes)e(t);e(this);for(const t of this.args)e(t);this.searchBlock(this.body,e)}}class OG extends Nt{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class i4 extends Nt{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class cT extends Nt{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class s4 extends Nt{constructor(e,t,r,i){super(),this.init=e,this.condition=t,this.increment=r,this.body=i}get astNodeType(){return"for"}search(e){var t,r,i;(t=this.init)===null||t===void 0||t.search(e),(r=this.condition)===null||r===void 0||r.search(e),(i=this.increment)===null||i===void 0||i.search(e),this.searchBlock(this.body,e)}}class Rs extends Nt{constructor(e,t,r,i,s){super(),this.attributes=null,this.name=e,this.type=t,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"var"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class EE extends Nt{constructor(e,t,r){super(),this.attributes=null,this.name=e,this.type=t,this.value=r}get astNodeType(){return"override"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class Mf extends Nt{constructor(e,t,r,i,s){super(),this.attributes=null,this.name=e,this.type=t,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"let"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class tm extends Nt{constructor(e,t,r,i,s){super(),this.attributes=null,this.name=e,this.type=t,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}var Hc,mf,se,ee;(n=>{n.increment="++",n.decrement="--"})(Hc||(Hc={})),(n=>{n.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for IncrementOperator");return n[t]}})(Hc||(Hc={}));class o4 extends Nt{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(n=>{n.assign="=",n.addAssign="+=",n.subtractAssin="-=",n.multiplyAssign="*=",n.divideAssign="/=",n.moduloAssign="%=",n.andAssign="&=",n.orAssign="|=",n.xorAssign="^=",n.shiftLeftAssign="<<=",n.shiftRightAssign=">>="})(mf||(mf={})),(n=>{n.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for AssignOperator");return t}})(mf||(mf={}));class a4 extends Nt{constructor(e,t,r){super(),this.operator=e,this.variable=t,this.value=r}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class xE extends Nt{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return r4.has(this.name)}search(e){for(const t of this.args)t.search(e);e(this)}}class l4 extends Nt{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}search(e){var t;this.searchBlock(this.body,e),(t=this.continuing)===null||t===void 0||t.search(e)}}class c4 extends Nt{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}search(e){e(this);for(const t of this.cases)t.search(e)}}class u4 extends Nt{constructor(e,t,r,i){super(),this.condition=e,this.body=t,this.elseif=r,this.else=i}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class h4 extends Nt{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class kG extends Nt{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class NG extends Nt{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class f4 extends Nt{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class AE extends Nt{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class DG extends Nt{constructor(){super()}get astNodeType(){return"discard"}}class d4 extends Nt{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class p4 extends Nt{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class ye extends Nt{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if(t.name==="f32")return t;for(let r=1;r<e.length;++r){const i=ye._priority.get(t.name);ye._priority.get(e[r].name)<i&&(t=e[r])}return t.name==="x32"?ye.i32:t}getTypeName(){return this.name}}ye.x32=new ye("x32"),ye.f32=new ye("f32"),ye.i32=new ye("i32"),ye.u32=new ye("u32"),ye.f16=new ye("f16"),ye.bool=new ye("bool"),ye.void=new ye("void"),ye._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class PR extends ye{constructor(e){super(e)}}class As extends ye{constructor(e,t,r,i){super(e),this.members=t,this.startLine=r,this.endLine=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}search(e){for(const t of this.members)e(t)}}class re extends ye{constructor(e,t,r){super(e),this.format=t,this.access=r}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}re.vec2f=new re("vec2",ye.f32,null),re.vec3f=new re("vec3",ye.f32,null),re.vec4f=new re("vec4",ye.f32,null),re.vec2i=new re("vec2",ye.i32,null),re.vec3i=new re("vec3",ye.i32,null),re.vec4i=new re("vec4",ye.i32,null),re.vec2u=new re("vec2",ye.u32,null),re.vec3u=new re("vec3",ye.u32,null),re.vec4u=new re("vec4",ye.u32,null),re.vec2h=new re("vec2",ye.f16,null),re.vec3h=new re("vec3",ye.f16,null),re.vec4h=new re("vec4",ye.f16,null),re.vec2b=new re("vec2",ye.bool,null),re.vec3b=new re("vec3",ye.bool,null),re.vec4b=new re("vec4",ye.bool,null),re.mat2x2f=new re("mat2x2",ye.f32,null),re.mat2x3f=new re("mat2x3",ye.f32,null),re.mat2x4f=new re("mat2x4",ye.f32,null),re.mat3x2f=new re("mat3x2",ye.f32,null),re.mat3x3f=new re("mat3x3",ye.f32,null),re.mat3x4f=new re("mat3x4",ye.f32,null),re.mat4x2f=new re("mat4x2",ye.f32,null),re.mat4x3f=new re("mat4x3",ye.f32,null),re.mat4x4f=new re("mat4x4",ye.f32,null),re.mat2x2h=new re("mat2x2",ye.f16,null),re.mat2x3h=new re("mat2x3",ye.f16,null),re.mat2x4h=new re("mat2x4",ye.f16,null),re.mat3x2h=new re("mat3x2",ye.f16,null),re.mat3x3h=new re("mat3x3",ye.f16,null),re.mat3x4h=new re("mat3x4",ye.f16,null),re.mat4x2h=new re("mat4x2",ye.f16,null),re.mat4x3h=new re("mat4x3",ye.f16,null),re.mat4x4h=new re("mat4x4",ye.f16,null),re.mat2x2i=new re("mat2x2",ye.i32,null),re.mat2x3i=new re("mat2x3",ye.i32,null),re.mat2x4i=new re("mat2x4",ye.i32,null),re.mat3x2i=new re("mat3x2",ye.i32,null),re.mat3x3i=new re("mat3x3",ye.i32,null),re.mat3x4i=new re("mat3x4",ye.i32,null),re.mat4x2i=new re("mat4x2",ye.i32,null),re.mat4x3i=new re("mat4x3",ye.i32,null),re.mat4x4i=new re("mat4x4",ye.i32,null),re.mat2x2u=new re("mat2x2",ye.u32,null),re.mat2x3u=new re("mat2x3",ye.u32,null),re.mat2x4u=new re("mat2x4",ye.u32,null),re.mat3x2u=new re("mat3x2",ye.u32,null),re.mat3x3u=new re("mat3x3",ye.u32,null),re.mat3x4u=new re("mat3x4",ye.u32,null),re.mat4x2u=new re("mat4x2",ye.u32,null),re.mat4x3u=new re("mat4x3",ye.u32,null),re.mat4x4u=new re("mat4x4",ye.u32,null);class nm extends ye{constructor(e,t,r,i){super(e),this.storage=t,this.type=r,this.access=i}get astNodeType(){return"pointer"}}class Of extends ye{constructor(e,t,r,i){super(e),this.attributes=t,this.format=r,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}}class _f extends ye{constructor(e,t,r){super(e),this.format=t,this.access=r}get astNodeType(){return"sampler"}}class _i extends Yr{constructor(){super(),this.postfix=null}}class xl extends _i{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class Li extends _i{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class SE extends _i{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return r4.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}}class Ar extends _i{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class g4 extends _i{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const r=e.evalExpression(this.initializer,e.context);return r!==null&&this.postfix?r.getSubData(e,this.postfix,e.context):r}return null}search(e){this.initializer.search(e)}}class fn extends _i{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return t!==void 0&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof J}get isVector(){return this.value instanceof $||this.value instanceof Ve}get scalarValue(){return this.value instanceof J?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof $||this.value instanceof Ve?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class m4 extends _i{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class Tu extends _i{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class _4 extends _i{constructor(){super()}}class nn extends _4{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class oi extends _4{constructor(e,t,r){super(),this.operator=e,this.left=t,this.right=r}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:e.name==="f32"||t.name==="f32"?ye.f32:e.name==="u32"||t.name==="u32"?ye.u32:ye.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class y4 extends Yr{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class rm extends _i{constructor(){super()}get astNodeType(){return"default"}}class v4 extends y4{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class b4 extends y4{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class MR extends Yr{constructor(e,t,r){super(),this.name=e,this.type=t,this.attributes=r}get astNodeType(){return"argument"}}class LG extends Yr{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class OR extends Yr{constructor(e,t,r){super(),this.name=e,this.type=t,this.attributes=r}get astNodeType(){return"member"}}class T4 extends Yr{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class Xr{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=Xr._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,r,i){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,t,r){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}Xr._id=0;class uT extends Xr{constructor(){super(new $r("void",null),null)}toString(){return"void"}}uT.void=new uT;class Oc extends Xr{constructor(e){super(new lT("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,t,r,i){this.reference.setDataValue(e,t,r,i)}getSubData(e,t,r){return t?this.reference.getSubData(e,t,r):this}toString(){return`&${this.reference.toString()}`}}class J extends Xr{constructor(e,t,r=null){super(t,r),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!==0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",t)}clone(){if(this.data instanceof Float32Array)return new J(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new J(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new J(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,r,i){if(r)return void console.error("SetDataValue: Scalar data does not support postfix",r);if(!(t instanceof J))return void console.error("SetDataValue: Invalid value",t);let s=t.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?s=Math.floor(s):this.typeInfo.name==="bool"&&(s=s?1:0),this.data[0]=s}getSubData(e,t,r){return t?(console.error("getSubData: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}}function UG(n,e,t){const r=e.length;return r===2?t==="f32"?new $(new Float32Array(e),n.getTypeInfo("vec2f")):t==="i32"||t==="bool"?new $(new Int32Array(e),n.getTypeInfo("vec2i")):t==="u32"?new $(new Uint32Array(e),n.getTypeInfo("vec2u")):t==="f16"?new $(new Float32Array(e),n.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${t}`),null):r===3?t==="f32"?new $(new Float32Array(e),n.getTypeInfo("vec3f")):t==="i32"||t==="bool"?new $(new Int32Array(e),n.getTypeInfo("vec3i")):t==="u32"?new $(new Uint32Array(e),n.getTypeInfo("vec3u")):t==="f16"?new $(new Float32Array(e),n.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${t}`),null):r===4?t==="f32"?new $(new Float32Array(e),n.getTypeInfo("vec4f")):t==="i32"||t==="bool"?new $(new Int32Array(e),n.getTypeInfo("vec4i")):t==="u32"?new $(new Uint32Array(e),n.getTypeInfo("vec4u")):t==="f16"?new $(new Float32Array(e),n.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${t}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class $ extends Xr{constructor(e,t,r=null){if(super(t,r),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const i=this.typeInfo.name;i==="vec2f"||i==="vec3f"||i==="vec4f"?this.data=new Float32Array(e):i==="vec2i"||i==="vec3i"||i==="vec4i"?this.data=new Int32Array(e):i==="vec2u"||i==="vec3u"||i==="vec4u"?this.data=new Uint32Array(e):i==="vec2h"||i==="vec3h"||i==="vec4h"?this.data=new Float32Array(e):i==="vec2b"||i==="vec3b"||i==="vec4b"?this.data=new Int32Array(e):i==="vec2"||i==="vec3"||i==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${i}`)}}clone(){if(this.data instanceof Float32Array)return new $(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new $(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new $(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,r,i){r instanceof xl?console.error("TODO: Set vector postfix"):t instanceof $?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,r){if(t===null)return this;let i=e.getTypeInfo("f32");if(this.typeInfo instanceof El)i=this.typeInfo.format||i;else{const o=this.typeInfo.name;o==="vec2f"||o==="vec3f"||o==="vec4f"?i=e.getTypeInfo("f32"):o==="vec2i"||o==="vec3i"||o==="vec4i"?i=e.getTypeInfo("i32"):o==="vec2b"||o==="vec3b"||o==="vec4b"?i=e.getTypeInfo("bool"):o==="vec2u"||o==="vec3u"||o==="vec4u"?i=e.getTypeInfo("u32"):o==="vec2h"||o==="vec3h"||o==="vec4h"?i=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${o}`)}let s=this;for(;t!==null&&s!==null;){if(t instanceof Tu){const o=t.index;let l=-1;if(o instanceof fn){if(!(o.value instanceof J))return console.error(`GetSubData: Invalid array index ${o.value}`),null;l=o.value.value}else{const u=e.evalExpression(o,r);if(!(u instanceof J))return console.error("GetSubData: Unknown index type",o),null;l=u.value}if(l<0||l>=s.data.length)return console.error("GetSubData: Index out of range",l),null;if(s.data instanceof Float32Array){const u=new Float32Array(s.data.buffer,s.data.byteOffset+4*l,1);return new J(u,i)}if(s.data instanceof Int32Array){const u=new Int32Array(s.data.buffer,s.data.byteOffset+4*l,1);return new J(u,i)}if(s.data instanceof Uint32Array){const u=new Uint32Array(s.data.buffer,s.data.byteOffset+4*l,1);return new J(u,i)}throw"GetSubData: Invalid data type"}if(!(t instanceof xl))return console.error("GetSubData: Unknown postfix",t),null;{const o=t.value.toLowerCase();if(o.length===1){let u=0;if(o==="x"||o==="r")u=0;else if(o==="y"||o==="g")u=1;else if(o==="z"||o==="b")u=2;else{if(o!=="w"&&o!=="a")return console.error(`GetSubData: Unknown member ${o}`),null;u=3}if(this.data instanceof Float32Array){let h=new Float32Array(this.data.buffer,this.data.byteOffset+4*u,1);return new J(h,i,this)}if(this.data instanceof Int32Array){let h=new Int32Array(this.data.buffer,this.data.byteOffset+4*u,1);return new J(h,i,this)}if(this.data instanceof Uint32Array){let h=new Uint32Array(this.data.buffer,this.data.byteOffset+4*u,1);return new J(h,i,this)}}const l=[];for(const u of o)u==="x"||u==="r"?l.push(this.data[0]):u==="y"||u==="g"?l.push(this.data[1]):u==="z"||u==="b"?l.push(this.data[2]):u==="w"||u==="a"?l.push(this.data[3]):console.error(`GetDataValue: Unknown member ${u}`);s=UG(e,l,i.name)}t=t.postfix}return s}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class Ve extends Xr{constructor(e,t,r=null){super(t,r),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new Ve(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,r,i){r instanceof xl?console.error("TODO: Set matrix postfix"):t instanceof Ve?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,r){if(t===null)return this;const i=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof El)this.typeInfo.format;else if(i.endsWith("f"))e.getTypeInfo("f32");else if(i.endsWith("i"))e.getTypeInfo("i32");else if(i.endsWith("u"))e.getTypeInfo("u32");else{if(!i.endsWith("h"))return console.error(`GetDataValue: Unknown type ${i}`),null;e.getTypeInfo("f16")}if(t instanceof Tu){const s=t.index;let o=-1;if(s instanceof fn){if(!(s.value instanceof J))return console.error(`GetDataValue: Invalid array index ${s.value}`),null;o=s.value.value}else{const h=e.evalExpression(s,r);if(!(h instanceof J))return console.error("GetDataValue: Unknown index type",s),null;o=h.value}if(o<0||o>=this.data.length)return console.error("GetDataValue: Index out of range",o),null;const l=i.endsWith("h")?"h":"f";let u;if(i==="mat2x2"||i==="mat2x2f"||i==="mat2x2h"||i==="mat3x2"||i==="mat3x2f"||i==="mat3x2h"||i==="mat4x2"||i==="mat4x2f"||i==="mat4x2h")u=new $(new Float32Array(this.data.buffer,this.data.byteOffset+2*o*4,2),e.getTypeInfo(`vec2${l}`));else if(i==="mat2x3"||i==="mat2x3f"||i==="mat2x3h"||i==="mat3x3"||i==="mat3x3f"||i==="mat3x3h"||i==="mat4x3"||i==="mat4x3f"||i==="mat4x3h")u=new $(new Float32Array(this.data.buffer,this.data.byteOffset+3*o*4,3),e.getTypeInfo(`vec3${l}`));else{if(i!=="mat2x4"&&i!=="mat2x4f"&&i!=="mat2x4h"&&i!=="mat3x4"&&i!=="mat3x4f"&&i!=="mat3x4h"&&i!=="mat4x4"&&i!=="mat4x4f"&&i!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${i}`),null;u=new $(new Float32Array(this.data.buffer,this.data.byteOffset+4*o*4,4),e.getTypeInfo(`vec4${l}`))}return t.postfix?u.getSubData(e,t.postfix,r):u}return console.error("GetDataValue: Invalid postfix",t),null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class $t extends Xr{constructor(e,t,r=0,i=null){super(t,i),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=r}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new $t(e.buffer,this.typeInfo,0,null)}setDataValue(e,t,r,i){if(t===null)return void console.log("setDataValue: NULL data.");let s=this.offset,o=this.typeInfo;for(;r;){if(r instanceof Tu)if(o instanceof sa){const l=r.index;if(l instanceof fn){if(!(l.value instanceof J))return void console.error(`SetDataValue: Invalid index type ${l.value}`);s+=l.value.value*o.stride}else{const u=e.evalExpression(l,i);if(!(u instanceof J))return void console.error("SetDataValue: Unknown index type",l);s+=u.value*o.stride}o=o.format}else console.error(`SetDataValue: Type ${o.getTypeName()} is not an array`);else{if(!(r instanceof xl))return void console.error("SetDataValue: Unknown postfix type",r);{const l=r.value;if(o instanceof Yo){let u=!1;for(const h of o.members)if(h.name===l){s+=h.offset,o=h.type,u=!0;break}if(!u)return void console.error(`SetDataValue: Member ${l} not found`)}else if(o instanceof $r){const u=o.getTypeName();let h=0;if(l==="x"||l==="r")h=0;else if(l==="y"||l==="g")h=1;else if(l==="z"||l==="b")h=2;else{if(l!=="w"&&l!=="a")return void console.error(`SetDataValue: Unknown member ${l}`);h=3}if(!(t instanceof J))return void console.error("SetDataValue: Invalid value",t);const d=t.value;return u==="vec2f"?void(new Float32Array(this.buffer,s,2)[h]=d):u==="vec3f"?void(new Float32Array(this.buffer,s,3)[h]=d):u==="vec4f"?void(new Float32Array(this.buffer,s,4)[h]=d):u==="vec2i"?void(new Int32Array(this.buffer,s,2)[h]=d):u==="vec3i"?void(new Int32Array(this.buffer,s,3)[h]=d):u==="vec4i"?void(new Int32Array(this.buffer,s,4)[h]=d):u==="vec2u"?void(new Uint32Array(this.buffer,s,2)[h]=d):u==="vec3u"?void(new Uint32Array(this.buffer,s,3)[h]=d):u==="vec4u"?void(new Uint32Array(this.buffer,s,4)[h]=d):void console.error(`SetDataValue: Type ${u} is not a struct`)}}}r=r.postfix}this.setData(e,t,o,s,i)}setData(e,t,r,i,s){const o=r.getTypeName();if(o!=="f32"&&o!=="f16")if(o!=="i32"&&o!=="atomic<i32>"&&o!=="x32")if(o!=="u32"&&o!=="atomic<u32>")if(o!=="bool"){if(o==="vec2f"||o==="vec2h"){const l=new Float32Array(this.buffer,i,2);return void(t instanceof $?(l[0]=t.data[0],l[1]=t.data[1]):(l[0]=t[0],l[1]=t[1]))}if(o==="vec3f"||o==="vec3h"){const l=new Float32Array(this.buffer,i,3);return void(t instanceof $?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2]):(l[0]=t[0],l[1]=t[1],l[2]=t[2]))}if(o==="vec4f"||o==="vec4h"){const l=new Float32Array(this.buffer,i,4);return void(t instanceof $?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3]))}if(o==="vec2i"){const l=new Int32Array(this.buffer,i,2);return void(t instanceof $?(l[0]=t.data[0],l[1]=t.data[1]):(l[0]=t[0],l[1]=t[1]))}if(o==="vec3i"){const l=new Int32Array(this.buffer,i,3);return void(t instanceof $?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2]):(l[0]=t[0],l[1]=t[1],l[2]=t[2]))}if(o==="vec4i"){const l=new Int32Array(this.buffer,i,4);return void(t instanceof $?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3]))}if(o==="vec2u"){const l=new Uint32Array(this.buffer,i,2);return void(t instanceof $?(l[0]=t.data[0],l[1]=t.data[1]):(l[0]=t[0],l[1]=t[1]))}if(o==="vec3u"){const l=new Uint32Array(this.buffer,i,3);return void(t instanceof $?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2]):(l[0]=t[0],l[1]=t[1],l[2]=t[2]))}if(o==="vec4u"){const l=new Uint32Array(this.buffer,i,4);return void(t instanceof $?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3]))}if(o==="vec2b"){const l=new Uint32Array(this.buffer,i,2);return void(t instanceof $?(l[0]=t.data[0],l[1]=t.data[1]):(l[0]=t[0],l[1]=t[1]))}if(o==="vec3b"){const l=new Uint32Array(this.buffer,i,3);return void(t instanceof $?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2]):(l[0]=t[0],l[1]=t[1],l[2]=t[2]))}if(o==="vec4b"){const l=new Uint32Array(this.buffer,i,4);return void(t instanceof $?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3]))}if(o==="mat2x2f"||o==="mat2x2h"){const l=new Float32Array(this.buffer,i,4);return void(t instanceof Ve?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3]))}if(o==="mat2x3f"||o==="mat2x3h"){const l=new Float32Array(this.buffer,i,6);return void(t instanceof Ve?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3],l[4]=t.data[4],l[5]=t.data[5]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3],l[4]=t[4],l[5]=t[5]))}if(o==="mat2x4f"||o==="mat2x4h"){const l=new Float32Array(this.buffer,i,8);return void(t instanceof Ve?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3],l[4]=t.data[4],l[5]=t.data[5],l[6]=t.data[6],l[7]=t.data[7]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3],l[4]=t[4],l[5]=t[5],l[6]=t[6],l[7]=t[7]))}if(o==="mat3x2f"||o==="mat3x2h"){const l=new Float32Array(this.buffer,i,6);return void(t instanceof Ve?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3],l[4]=t.data[4],l[5]=t.data[5]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3],l[4]=t[4],l[5]=t[5]))}if(o==="mat3x3f"||o==="mat3x3h"){const l=new Float32Array(this.buffer,i,9);return void(t instanceof Ve?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3],l[4]=t.data[4],l[5]=t.data[5],l[6]=t.data[6],l[7]=t.data[7],l[8]=t.data[8]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3],l[4]=t[4],l[5]=t[5],l[6]=t[6],l[7]=t[7],l[8]=t[8]))}if(o==="mat3x4f"||o==="mat3x4h"){const l=new Float32Array(this.buffer,i,12);return void(t instanceof Ve?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3],l[4]=t.data[4],l[5]=t.data[5],l[6]=t.data[6],l[7]=t.data[7],l[8]=t.data[8],l[9]=t.data[9],l[10]=t.data[10],l[11]=t.data[11]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3],l[4]=t[4],l[5]=t[5],l[6]=t[6],l[7]=t[7],l[8]=t[8],l[9]=t[9],l[10]=t[10],l[11]=t[11]))}if(o==="mat4x2f"||o==="mat4x2h"){const l=new Float32Array(this.buffer,i,8);return void(t instanceof Ve?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3],l[4]=t.data[4],l[5]=t.data[5],l[6]=t.data[6],l[7]=t.data[7]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3],l[4]=t[4],l[5]=t[5],l[6]=t[6],l[7]=t[7]))}if(o==="mat4x3f"||o==="mat4x3h"){const l=new Float32Array(this.buffer,i,12);return void(t instanceof Ve?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3],l[4]=t.data[4],l[5]=t.data[5],l[6]=t.data[6],l[7]=t.data[7],l[8]=t.data[8],l[9]=t.data[9],l[10]=t.data[10],l[11]=t.data[11]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3],l[4]=t[4],l[5]=t[5],l[6]=t[6],l[7]=t[7],l[8]=t[8],l[9]=t[9],l[10]=t[10],l[11]=t[11]))}if(o==="mat4x4f"||o==="mat4x4h"){const l=new Float32Array(this.buffer,i,16);return void(t instanceof Ve?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3],l[4]=t.data[4],l[5]=t.data[5],l[6]=t.data[6],l[7]=t.data[7],l[8]=t.data[8],l[9]=t.data[9],l[10]=t.data[10],l[11]=t.data[11],l[12]=t.data[12],l[13]=t.data[13],l[14]=t.data[14],l[15]=t.data[15]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3],l[4]=t[4],l[5]=t[5],l[6]=t[6],l[7]=t[7],l[8]=t[8],l[9]=t[9],l[10]=t[10],l[11]=t[11],l[12]=t[12],l[13]=t[13],l[14]=t[14],l[15]=t[15]))}if(t instanceof $t){if(r===t.typeInfo)return void new Uint8Array(this.buffer,i,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",o,t.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${o}`)}else t instanceof J&&(new Int32Array(this.buffer,i,1)[0]=t.value);else t instanceof J&&(new Uint32Array(this.buffer,i,1)[0]=t.value);else t instanceof J&&(new Int32Array(this.buffer,i,1)[0]=t.value);else t instanceof J&&(new Float32Array(this.buffer,i,1)[0]=t.value)}getSubData(e,t,r){var i,s,o;if(t===null)return this;let l=this.offset,u=this.typeInfo;for(;t;){if(t instanceof Tu){const d=t.index,g=d instanceof _i?e.evalExpression(d,r):d;let y=0;if(g instanceof J?y=g.value:typeof g=="number"?y=g:console.error("GetDataValue: Invalid index type",d),u instanceof sa)l+=y*u.stride,u=u.format;else{const b=u.getTypeName();b==="mat4x4"||b==="mat4x4f"||b==="mat4x4h"?(l+=16*y,u=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${u.getTypeName()} is not an array`)}}else{if(!(t instanceof xl))return console.error("GetDataValue: Unknown postfix type",t),null;{const d=t.value;if(u instanceof Yo){let g=!1;for(const y of u.members)if(y.name===d){l+=y.offset,u=y.type,g=!0;break}if(!g)return console.error(`GetDataValue: Member ${d} not found`),null}else if(u instanceof $r){const g=u.getTypeName();if(g==="vec2f"||g==="vec3f"||g==="vec4f"||g==="vec2i"||g==="vec3i"||g==="vec4i"||g==="vec2u"||g==="vec3u"||g==="vec4u"||g==="vec2b"||g==="vec3b"||g==="vec4b"||g==="vec2h"||g==="vec3h"||g==="vec4h"||g==="vec2"||g==="vec3"||g==="vec4"){if(d.length>0&&d.length<5){let y="f";const b=[];for(let w=0;w<d.length;++w){const E=d[w].toLowerCase();let x=0;if(E==="x"||E==="r")x=0;else if(E==="y"||E==="g")x=1;else if(E==="z"||E==="b")x=2;else{if(E!=="w"&&E!=="a")return console.error(`Unknown member ${d}`),null;x=3}if(d.length===1){if(g.endsWith("f"))return this.buffer.byteLength<l+4*x+4?(console.log("Insufficient buffer data"),null):new J(new Float32Array(this.buffer,l+4*x,1),e.getTypeInfo("f32"),this);if(g.endsWith("h"))return new J(new Float32Array(this.buffer,l+4*x,1),e.getTypeInfo("f16"),this);if(g.endsWith("i"))return new J(new Int32Array(this.buffer,l+4*x,1),e.getTypeInfo("i32"),this);if(g.endsWith("b"))return new J(new Int32Array(this.buffer,l+4*x,1),e.getTypeInfo("bool"),this);if(g.endsWith("u"))return new J(new Uint32Array(this.buffer,l+4*x,1),e.getTypeInfo("i32"),this)}if(g==="vec2f")b.push(new Float32Array(this.buffer,l,2)[x]);else if(g==="vec3f"){if(l+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const C=new Float32Array(this.buffer,l,3);b.push(C[x])}else if(g==="vec4f")b.push(new Float32Array(this.buffer,l,4)[x]);else if(g==="vec2i")y="i",b.push(new Int32Array(this.buffer,l,2)[x]);else if(g==="vec3i")y="i",b.push(new Int32Array(this.buffer,l,3)[x]);else if(g==="vec4i")y="i",b.push(new Int32Array(this.buffer,l,4)[x]);else if(g==="vec2u"){y="u";const C=new Uint32Array(this.buffer,l,2);b.push(C[x])}else g==="vec3u"?(y="u",b.push(new Uint32Array(this.buffer,l,3)[x])):g==="vec4u"&&(y="u",b.push(new Uint32Array(this.buffer,l,4)[x]))}return b.length===2?u=e.getTypeInfo(`vec2${y}`):b.length===3?u=e.getTypeInfo(`vec3${y}`):b.length===4?u=e.getTypeInfo(`vec4${y}`):console.error(`GetDataValue: Invalid vector length ${b.length}`),new $(b,u,null)}return console.error(`GetDataValue: Unknown member ${d}`),null}return console.error(`GetDataValue: Type ${g} is not a struct`),null}}}t=t.postfix}const h=u.getTypeName();return h==="f32"?new J(new Float32Array(this.buffer,l,1),u,this):h==="i32"?new J(new Int32Array(this.buffer,l,1),u,this):h==="u32"?new J(new Uint32Array(this.buffer,l,1),u,this):h==="vec2f"?new $(new Float32Array(this.buffer,l,2),u,this):h==="vec3f"?new $(new Float32Array(this.buffer,l,3),u,this):h==="vec4f"?new $(new Float32Array(this.buffer,l,4),u,this):h==="vec2i"?new $(new Int32Array(this.buffer,l,2),u,this):h==="vec3i"?new $(new Int32Array(this.buffer,l,3),u,this):h==="vec4i"?new $(new Int32Array(this.buffer,l,4),u,this):h==="vec2u"?new $(new Uint32Array(this.buffer,l,2),u,this):h==="vec3u"?new $(new Uint32Array(this.buffer,l,3),u,this):h==="vec4u"?new $(new Uint32Array(this.buffer,l,4),u,this):u instanceof El&&u.name==="atomic"?((i=u.format)===null||i===void 0?void 0:i.name)==="u32"?new J(new Uint32Array(this.buffer,l,1)[0],u.format,this):((s=u.format)===null||s===void 0?void 0:s.name)==="i32"?new J(new Int32Array(this.buffer,l,1)[0],u.format,this):(console.error(`GetDataValue: Invalid atomic format ${(o=u.format)===null||o===void 0?void 0:o.name}`),null):new $t(this.buffer,u,l,this)}toString(){let e="";if(this.typeInfo instanceof sa)if(this.typeInfo.format.name==="f32"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let r=1;r<t.length;++r)e+=`, ${t[r]}`}else if(this.typeInfo.format.name==="i32"){const t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let r=1;r<t.length;++r)e+=`, ${t[r]}`}else if(this.typeInfo.format.name==="u32"){const t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let r=1;r<t.length;++r)e+=`, ${t[r]}`}else if(this.typeInfo.format.name==="vec2f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let r=1;r<t.length/2;++r)e+=`, [${t[2*r]}, ${t[2*r+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let r=4;r<t.length;r+=4)e+=`, [${t[r]}, ${t[r+1]}, ${t[r+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let r=4;r<t.length;r+=4)e+=`, [${t[r]}, ${t[r+1]}, ${t[r+2]}, ${t[r+3]}]`}else e="[...]";else this.typeInfo instanceof Yo?e+="{...}":e="[...]";return e}}class Ss extends Xr{constructor(e,t,r,i){super(t,null),this.data=e,this.descriptor=r,this.view=i}clone(){return new Ss(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;const r=this.descriptor.size;return r instanceof Array&&r.length>0?(e=r[0])!==null&&e!==void 0?e:0:r instanceof Object&&(t=r.width)!==null&&t!==void 0?t:0}get height(){var e,t;const r=this.descriptor.size;return r instanceof Array&&r.length>1?(e=r[1])!==null&&e!==void 0?e:0:r instanceof Object&&(t=r.height)!==null&&t!==void 0?t:0}get depthOrArrayLayers(){var e,t;const r=this.descriptor.size;return r instanceof Array&&r.length>2?(e=r[2])!==null&&e!==void 0?e:0:r instanceof Object&&(t=r.depthOrArrayLayers)!==null&&t!==void 0?t:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const t=[this.width,this.height,this.depthOrArrayLayers];for(let r=0;r<t.length;++r)t[r]=Math.max(1,t[r]>>e);return t}get texelByteSize(){const e=this.format,t=Hb[e];return t?t.isDepthStencil?4:t.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,t=Hb[e];return!!t&&t.isDepthStencil}getGpuSize(){const e=this.format,t=Hb[e],r=this.width;if(!e||r<=0||!t)return-1;const i=this.height,s=this.depthOrArrayLayers,o=this.dimension;return r/t.blockWidth*(o==="1d"?1:i/t.blockHeight)*t.bytesPerBlock*s}getPixel(e,t,r=0,i=0){const s=this.texelByteSize,o=this.bytesPerRow,l=this.height,u=this.data[i];return MG(new Uint8Array(u),e,t,r,i,l,o,s,this.format)}setPixel(e,t,r,i,s){const o=this.texelByteSize,l=this.bytesPerRow,u=this.height,h=this.data[i];(function(d,g,y,b,w,E,x,C,M,O){const V=b*(x>>=w)*(E>>=w)+y*x+g*C;switch(M){case"r8unorm":return void pt(d,V,"8unorm",1,O);case"r8snorm":return void pt(d,V,"8snorm",1,O);case"r8uint":return void pt(d,V,"8uint",1,O);case"r8sint":return void pt(d,V,"8sint",1,O);case"rg8unorm":return void pt(d,V,"8unorm",2,O);case"rg8snorm":return void pt(d,V,"8snorm",2,O);case"rg8uint":return void pt(d,V,"8uint",2,O);case"rg8sint":return void pt(d,V,"8sint",2,O);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void pt(d,V,"8unorm",4,O);case"rgba8snorm":return void pt(d,V,"8snorm",4,O);case"rgba8uint":return void pt(d,V,"8uint",4,O);case"rgba8sint":return void pt(d,V,"8sint",4,O);case"r16uint":return void pt(d,V,"16uint",1,O);case"r16sint":return void pt(d,V,"16sint",1,O);case"r16float":return void pt(d,V,"16float",1,O);case"rg16uint":return void pt(d,V,"16uint",2,O);case"rg16sint":return void pt(d,V,"16sint",2,O);case"rg16float":return void pt(d,V,"16float",2,O);case"rgba16uint":return void pt(d,V,"16uint",4,O);case"rgba16sint":return void pt(d,V,"16sint",4,O);case"rgba16float":return void pt(d,V,"16float",4,O);case"r32uint":return void pt(d,V,"32uint",1,O);case"r32sint":return void pt(d,V,"32sint",1,O);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void pt(d,V,"32float",1,O);case"rg32uint":return void pt(d,V,"32uint",2,O);case"rg32sint":return void pt(d,V,"32sint",2,O);case"rg32float":return void pt(d,V,"32float",2,O);case"rgba32uint":return void pt(d,V,"32uint",4,O);case"rgba32sint":return void pt(d,V,"32sint",4,O);case"rgba32float":return void pt(d,V,"32float",4,O);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(h),e,t,r,i,u,l,o,this.format,s)}}(n=>{n[n.token=0]="token",n[n.keyword=1]="keyword",n[n.reserved=2]="reserved"})(ee||(ee={}));class te{constructor(e,t,r){this.name=e,this.type=t,this.rule=r}toString(){return this.name}}class B{}se=B,B.none=new te("",ee.reserved,""),B.eof=new te("EOF",ee.token,""),B.reserved={asm:new te("asm",ee.reserved,"asm"),bf16:new te("bf16",ee.reserved,"bf16"),do:new te("do",ee.reserved,"do"),enum:new te("enum",ee.reserved,"enum"),f16:new te("f16",ee.reserved,"f16"),f64:new te("f64",ee.reserved,"f64"),handle:new te("handle",ee.reserved,"handle"),i8:new te("i8",ee.reserved,"i8"),i16:new te("i16",ee.reserved,"i16"),i64:new te("i64",ee.reserved,"i64"),mat:new te("mat",ee.reserved,"mat"),premerge:new te("premerge",ee.reserved,"premerge"),regardless:new te("regardless",ee.reserved,"regardless"),typedef:new te("typedef",ee.reserved,"typedef"),u8:new te("u8",ee.reserved,"u8"),u16:new te("u16",ee.reserved,"u16"),u64:new te("u64",ee.reserved,"u64"),unless:new te("unless",ee.reserved,"unless"),using:new te("using",ee.reserved,"using"),vec:new te("vec",ee.reserved,"vec"),void:new te("void",ee.reserved,"void")},B.keywords={array:new te("array",ee.keyword,"array"),atomic:new te("atomic",ee.keyword,"atomic"),bool:new te("bool",ee.keyword,"bool"),f32:new te("f32",ee.keyword,"f32"),i32:new te("i32",ee.keyword,"i32"),mat2x2:new te("mat2x2",ee.keyword,"mat2x2"),mat2x3:new te("mat2x3",ee.keyword,"mat2x3"),mat2x4:new te("mat2x4",ee.keyword,"mat2x4"),mat3x2:new te("mat3x2",ee.keyword,"mat3x2"),mat3x3:new te("mat3x3",ee.keyword,"mat3x3"),mat3x4:new te("mat3x4",ee.keyword,"mat3x4"),mat4x2:new te("mat4x2",ee.keyword,"mat4x2"),mat4x3:new te("mat4x3",ee.keyword,"mat4x3"),mat4x4:new te("mat4x4",ee.keyword,"mat4x4"),ptr:new te("ptr",ee.keyword,"ptr"),sampler:new te("sampler",ee.keyword,"sampler"),sampler_comparison:new te("sampler_comparison",ee.keyword,"sampler_comparison"),struct:new te("struct",ee.keyword,"struct"),texture_1d:new te("texture_1d",ee.keyword,"texture_1d"),texture_2d:new te("texture_2d",ee.keyword,"texture_2d"),texture_2d_array:new te("texture_2d_array",ee.keyword,"texture_2d_array"),texture_3d:new te("texture_3d",ee.keyword,"texture_3d"),texture_cube:new te("texture_cube",ee.keyword,"texture_cube"),texture_cube_array:new te("texture_cube_array",ee.keyword,"texture_cube_array"),texture_multisampled_2d:new te("texture_multisampled_2d",ee.keyword,"texture_multisampled_2d"),texture_storage_1d:new te("texture_storage_1d",ee.keyword,"texture_storage_1d"),texture_storage_2d:new te("texture_storage_2d",ee.keyword,"texture_storage_2d"),texture_storage_2d_array:new te("texture_storage_2d_array",ee.keyword,"texture_storage_2d_array"),texture_storage_3d:new te("texture_storage_3d",ee.keyword,"texture_storage_3d"),texture_depth_2d:new te("texture_depth_2d",ee.keyword,"texture_depth_2d"),texture_depth_2d_array:new te("texture_depth_2d_array",ee.keyword,"texture_depth_2d_array"),texture_depth_cube:new te("texture_depth_cube",ee.keyword,"texture_depth_cube"),texture_depth_cube_array:new te("texture_depth_cube_array",ee.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new te("texture_depth_multisampled_2d",ee.keyword,"texture_depth_multisampled_2d"),texture_external:new te("texture_external",ee.keyword,"texture_external"),u32:new te("u32",ee.keyword,"u32"),vec2:new te("vec2",ee.keyword,"vec2"),vec3:new te("vec3",ee.keyword,"vec3"),vec4:new te("vec4",ee.keyword,"vec4"),bitcast:new te("bitcast",ee.keyword,"bitcast"),block:new te("block",ee.keyword,"block"),break:new te("break",ee.keyword,"break"),case:new te("case",ee.keyword,"case"),continue:new te("continue",ee.keyword,"continue"),continuing:new te("continuing",ee.keyword,"continuing"),default:new te("default",ee.keyword,"default"),diagnostic:new te("diagnostic",ee.keyword,"diagnostic"),discard:new te("discard",ee.keyword,"discard"),else:new te("else",ee.keyword,"else"),enable:new te("enable",ee.keyword,"enable"),fallthrough:new te("fallthrough",ee.keyword,"fallthrough"),false:new te("false",ee.keyword,"false"),fn:new te("fn",ee.keyword,"fn"),for:new te("for",ee.keyword,"for"),function:new te("function",ee.keyword,"function"),if:new te("if",ee.keyword,"if"),let:new te("let",ee.keyword,"let"),const:new te("const",ee.keyword,"const"),loop:new te("loop",ee.keyword,"loop"),while:new te("while",ee.keyword,"while"),private:new te("private",ee.keyword,"private"),read:new te("read",ee.keyword,"read"),read_write:new te("read_write",ee.keyword,"read_write"),return:new te("return",ee.keyword,"return"),requires:new te("requires",ee.keyword,"requires"),storage:new te("storage",ee.keyword,"storage"),switch:new te("switch",ee.keyword,"switch"),true:new te("true",ee.keyword,"true"),alias:new te("alias",ee.keyword,"alias"),type:new te("type",ee.keyword,"type"),uniform:new te("uniform",ee.keyword,"uniform"),var:new te("var",ee.keyword,"var"),override:new te("override",ee.keyword,"override"),workgroup:new te("workgroup",ee.keyword,"workgroup"),write:new te("write",ee.keyword,"write"),r8unorm:new te("r8unorm",ee.keyword,"r8unorm"),r8snorm:new te("r8snorm",ee.keyword,"r8snorm"),r8uint:new te("r8uint",ee.keyword,"r8uint"),r8sint:new te("r8sint",ee.keyword,"r8sint"),r16uint:new te("r16uint",ee.keyword,"r16uint"),r16sint:new te("r16sint",ee.keyword,"r16sint"),r16float:new te("r16float",ee.keyword,"r16float"),rg8unorm:new te("rg8unorm",ee.keyword,"rg8unorm"),rg8snorm:new te("rg8snorm",ee.keyword,"rg8snorm"),rg8uint:new te("rg8uint",ee.keyword,"rg8uint"),rg8sint:new te("rg8sint",ee.keyword,"rg8sint"),r32uint:new te("r32uint",ee.keyword,"r32uint"),r32sint:new te("r32sint",ee.keyword,"r32sint"),r32float:new te("r32float",ee.keyword,"r32float"),rg16uint:new te("rg16uint",ee.keyword,"rg16uint"),rg16sint:new te("rg16sint",ee.keyword,"rg16sint"),rg16float:new te("rg16float",ee.keyword,"rg16float"),rgba8unorm:new te("rgba8unorm",ee.keyword,"rgba8unorm"),rgba8unorm_srgb:new te("rgba8unorm_srgb",ee.keyword,"rgba8unorm_srgb"),rgba8snorm:new te("rgba8snorm",ee.keyword,"rgba8snorm"),rgba8uint:new te("rgba8uint",ee.keyword,"rgba8uint"),rgba8sint:new te("rgba8sint",ee.keyword,"rgba8sint"),bgra8unorm:new te("bgra8unorm",ee.keyword,"bgra8unorm"),bgra8unorm_srgb:new te("bgra8unorm_srgb",ee.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new te("rgb10a2unorm",ee.keyword,"rgb10a2unorm"),rg11b10float:new te("rg11b10float",ee.keyword,"rg11b10float"),rg32uint:new te("rg32uint",ee.keyword,"rg32uint"),rg32sint:new te("rg32sint",ee.keyword,"rg32sint"),rg32float:new te("rg32float",ee.keyword,"rg32float"),rgba16uint:new te("rgba16uint",ee.keyword,"rgba16uint"),rgba16sint:new te("rgba16sint",ee.keyword,"rgba16sint"),rgba16float:new te("rgba16float",ee.keyword,"rgba16float"),rgba32uint:new te("rgba32uint",ee.keyword,"rgba32uint"),rgba32sint:new te("rgba32sint",ee.keyword,"rgba32sint"),rgba32float:new te("rgba32float",ee.keyword,"rgba32float"),static_assert:new te("static_assert",ee.keyword,"static_assert")},B.tokens={decimal_float_literal:new te("decimal_float_literal",ee.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new te("hex_float_literal",ee.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new te("int_literal",ee.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new te("uint_literal",ee.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new te("name",ee.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new te("ident",ee.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new te("and",ee.token,"&"),and_and:new te("and_and",ee.token,"&&"),arrow:new te("arrow ",ee.token,"->"),attr:new te("attr",ee.token,"@"),forward_slash:new te("forward_slash",ee.token,"/"),bang:new te("bang",ee.token,"!"),bracket_left:new te("bracket_left",ee.token,"["),bracket_right:new te("bracket_right",ee.token,"]"),brace_left:new te("brace_left",ee.token,"{"),brace_right:new te("brace_right",ee.token,"}"),colon:new te("colon",ee.token,":"),comma:new te("comma",ee.token,","),equal:new te("equal",ee.token,"="),equal_equal:new te("equal_equal",ee.token,"=="),not_equal:new te("not_equal",ee.token,"!="),greater_than:new te("greater_than",ee.token,">"),greater_than_equal:new te("greater_than_equal",ee.token,">="),shift_right:new te("shift_right",ee.token,">>"),less_than:new te("less_than",ee.token,"<"),less_than_equal:new te("less_than_equal",ee.token,"<="),shift_left:new te("shift_left",ee.token,"<<"),modulo:new te("modulo",ee.token,"%"),minus:new te("minus",ee.token,"-"),minus_minus:new te("minus_minus",ee.token,"--"),period:new te("period",ee.token,"."),plus:new te("plus",ee.token,"+"),plus_plus:new te("plus_plus",ee.token,"++"),or:new te("or",ee.token,"|"),or_or:new te("or_or",ee.token,"||"),paren_left:new te("paren_left",ee.token,"("),paren_right:new te("paren_right",ee.token,")"),semicolon:new te("semicolon",ee.token,";"),star:new te("star",ee.token,"*"),tilde:new te("tilde",ee.token,"~"),underscore:new te("underscore",ee.token,"_"),xor:new te("xor",ee.token,"^"),plus_equal:new te("plus_equal",ee.token,"+="),minus_equal:new te("minus_equal",ee.token,"-="),times_equal:new te("times_equal",ee.token,"*="),division_equal:new te("division_equal",ee.token,"/="),modulo_equal:new te("modulo_equal",ee.token,"%="),and_equal:new te("and_equal",ee.token,"&="),or_equal:new te("or_equal",ee.token,"|="),xor_equal:new te("xor_equal",ee.token,"^="),shift_right_equal:new te("shift_right_equal",ee.token,">>="),shift_left_equal:new te("shift_left_equal",ee.token,"<<=")},B.simpleTokens={"@":se.tokens.attr,"{":se.tokens.brace_left,"}":se.tokens.brace_right,":":se.tokens.colon,",":se.tokens.comma,"(":se.tokens.paren_left,")":se.tokens.paren_right,";":se.tokens.semicolon},B.literalTokens={"&":se.tokens.and,"&&":se.tokens.and_and,"->":se.tokens.arrow,"/":se.tokens.forward_slash,"!":se.tokens.bang,"[":se.tokens.bracket_left,"]":se.tokens.bracket_right,"=":se.tokens.equal,"==":se.tokens.equal_equal,"!=":se.tokens.not_equal,">":se.tokens.greater_than,">=":se.tokens.greater_than_equal,">>":se.tokens.shift_right,"<":se.tokens.less_than,"<=":se.tokens.less_than_equal,"<<":se.tokens.shift_left,"%":se.tokens.modulo,"-":se.tokens.minus,"--":se.tokens.minus_minus,".":se.tokens.period,"+":se.tokens.plus,"++":se.tokens.plus_plus,"|":se.tokens.or,"||":se.tokens.or_or,"*":se.tokens.star,"~":se.tokens.tilde,_:se.tokens.underscore,"^":se.tokens.xor,"+=":se.tokens.plus_equal,"-=":se.tokens.minus_equal,"*=":se.tokens.times_equal,"/=":se.tokens.division_equal,"%=":se.tokens.modulo_equal,"&=":se.tokens.and_equal,"|=":se.tokens.or_equal,"^=":se.tokens.xor_equal,">>=":se.tokens.shift_right_equal,"<<=":se.tokens.shift_left_equal},B.regexTokens={decimal_float_literal:se.tokens.decimal_float_literal,hex_float_literal:se.tokens.hex_float_literal,int_literal:se.tokens.int_literal,uint_literal:se.tokens.uint_literal,ident:se.tokens.ident},B.storage_class=[se.keywords.function,se.keywords.private,se.keywords.workgroup,se.keywords.uniform,se.keywords.storage],B.access_mode=[se.keywords.read,se.keywords.write,se.keywords.read_write],B.sampler_type=[se.keywords.sampler,se.keywords.sampler_comparison],B.sampled_texture_type=[se.keywords.texture_1d,se.keywords.texture_2d,se.keywords.texture_2d_array,se.keywords.texture_3d,se.keywords.texture_cube,se.keywords.texture_cube_array],B.multisampled_texture_type=[se.keywords.texture_multisampled_2d],B.storage_texture_type=[se.keywords.texture_storage_1d,se.keywords.texture_storage_2d,se.keywords.texture_storage_2d_array,se.keywords.texture_storage_3d],B.depth_texture_type=[se.keywords.texture_depth_2d,se.keywords.texture_depth_2d_array,se.keywords.texture_depth_cube,se.keywords.texture_depth_cube_array,se.keywords.texture_depth_multisampled_2d],B.texture_external_type=[se.keywords.texture_external],B.any_texture_type=[...se.sampled_texture_type,...se.multisampled_texture_type,...se.storage_texture_type,...se.depth_texture_type,...se.texture_external_type],B.texel_format=[se.keywords.r8unorm,se.keywords.r8snorm,se.keywords.r8uint,se.keywords.r8sint,se.keywords.r16uint,se.keywords.r16sint,se.keywords.r16float,se.keywords.rg8unorm,se.keywords.rg8snorm,se.keywords.rg8uint,se.keywords.rg8sint,se.keywords.r32uint,se.keywords.r32sint,se.keywords.r32float,se.keywords.rg16uint,se.keywords.rg16sint,se.keywords.rg16float,se.keywords.rgba8unorm,se.keywords.rgba8unorm_srgb,se.keywords.rgba8snorm,se.keywords.rgba8uint,se.keywords.rgba8sint,se.keywords.bgra8unorm,se.keywords.bgra8unorm_srgb,se.keywords.rgb10a2unorm,se.keywords.rg11b10float,se.keywords.rg32uint,se.keywords.rg32sint,se.keywords.rg32float,se.keywords.rgba16uint,se.keywords.rgba16sint,se.keywords.rgba16float,se.keywords.rgba32uint,se.keywords.rgba32sint,se.keywords.rgba32float],B.const_literal=[se.tokens.int_literal,se.tokens.uint_literal,se.tokens.decimal_float_literal,se.tokens.hex_float_literal,se.keywords.true,se.keywords.false],B.literal_or_ident=[se.tokens.ident,se.tokens.int_literal,se.tokens.uint_literal,se.tokens.decimal_float_literal,se.tokens.hex_float_literal,se.tokens.name],B.element_count_expression=[se.tokens.int_literal,se.tokens.uint_literal,se.tokens.ident],B.template_types=[se.keywords.vec2,se.keywords.vec3,se.keywords.vec4,se.keywords.mat2x2,se.keywords.mat2x3,se.keywords.mat2x4,se.keywords.mat3x2,se.keywords.mat3x3,se.keywords.mat3x4,se.keywords.mat4x2,se.keywords.mat4x3,se.keywords.mat4x4,se.keywords.atomic,se.keywords.bitcast,...se.any_texture_type],B.attribute_name=[se.tokens.ident,se.keywords.block,se.keywords.diagnostic],B.assignment_operators=[se.tokens.equal,se.tokens.plus_equal,se.tokens.minus_equal,se.tokens.times_equal,se.tokens.division_equal,se.tokens.modulo_equal,se.tokens.and_equal,se.tokens.or_equal,se.tokens.xor_equal,se.tokens.shift_right_equal,se.tokens.shift_left_equal],B.increment_operators=[se.tokens.plus_plus,se.tokens.minus_minus];class kR{constructor(e,t,r,i,s){this.type=e,this.lexeme=t,this.line=r,this.start=i,this.end=s}toString(){return this.lexeme}isTemplateType(){return B.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==B.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class FG{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new kR(B.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let o=1;for(;o>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),o--,o==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),o++)}return!0}}const t=B.simpleTokens[e];if(t)return this._addToken(t),!0;let r=B.none;const i=this._isAlpha(e),s=e==="_";if(this._isAlphaNumeric(e)){let o=this._peekAhead();for(;this._isAlphaNumeric(o);)e+=this._advance(),o=this._peekAhead()}if(i){const o=B.keywords[e];if(o)return this._addToken(o),!0}if(i||s)return this._addToken(B.tokens.ident),!0;for(;;){let o=this._findType(e);const l=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(l=="=")return this._current++,e+=l,this._addToken(B.tokens.minus_equal),!0;if(l=="-")return this._current++,e+=l,this._addToken(B.tokens.minus_minus),!0;const u=this._tokens.length-1;if((B.literal_or_ident.indexOf(this._tokens[u].type)!=-1||this._tokens[u].type==B.tokens.paren_right)&&l!=">")return this._addToken(o),!0}if(e==">"&&(l==">"||l=="=")){let u=!1,h=this._tokens.length-1;for(let d=0;d<5&&h>=0&&B.assignment_operators.indexOf(this._tokens[h].type)===-1;++d,--h)if(this._tokens[h].type===B.tokens.less_than){h>0&&this._tokens[h-1].isArrayOrTemplateType()&&(u=!0);break}if(u)return this._addToken(o),!0}if(o===B.none){let u=e,h=0;const d=2;for(let g=0;g<d;++g)if(u+=this._peekAhead(g),o=this._findType(u),o!==B.none){h=g;break}if(o===B.none)return r!==B.none&&(this._current--,this._addToken(r),!0);e=u,this._current+=h+1}if(r=o,this._isAtEnd())break;e+=this._advance()}return r!==B.none&&(this._addToken(r),!0)}_findType(e){for(const r in B.regexTokens){const i=B.regexTokens[r];if(this._match(e,i.rule))return i}return B.literalTokens[e]||B.none}_match(e,t){const r=t.exec(e);return r&&r.index==0&&r[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new kR(e,t,this._line,this._start,this._current))}}function Re(n){return Array.isArray(n)||n?.buffer instanceof ArrayBuffer}const Qm=new Float32Array(1),BG=new Uint32Array(Qm.buffer),VG=new Uint32Array(Qm.buffer),Jm=new Int32Array(1),zG=new Float32Array(Jm.buffer),jG=new Uint32Array(Jm.buffer),e_=new Uint32Array(1),HG=new Float32Array(e_.buffer),$G=new Int32Array(e_.buffer);function NR(n,e,t){if(e===t)return n;if(e==="f32"){if(t==="i32"||t==="x32")return Qm[0]=n,BG[0];if(t==="u32")return Qm[0]=n,VG[0]}else if(e==="i32"||e==="x32"){if(t==="f32")return Jm[0]=n,zG[0];if(t==="u32")return Jm[0]=n,jG[0]}else if(e==="u32"){if(t==="f32")return e_[0]=n,HG[0];if(t==="i32"||t==="x32")return e_[0]=n,$G[0]}return console.error(`Unsupported cast from ${e} to ${t}`),n}class WG{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class _g{constructor(e,t){this.align=e,this.size=t}}class Vi{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new RG,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const t of e)t instanceof td&&this._functions.set(t.name,new WG(t));for(const t of e)if(t instanceof As){const r=this.getTypeInfo(t,null);r instanceof Yo&&this.structs.push(r)}for(const t of e)if(t instanceof AE)this.aliases.push(this._getAliasInfo(t));else{if(t instanceof EE){const r=t,i=this._getAttributeNum(r.attributes,"id",0),s=r.type!=null?this.getTypeInfo(r.type,r.attributes):null;this.overrides.push(new xG(r.name,s,r.attributes,i));continue}if(this._isUniformVar(t)){const r=t,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),l=new mg(r.name,o,i,s,r.attributes,zo.Uniform,r.access);l.access||(l.access="read"),this.uniforms.push(l);continue}if(this._isStorageVar(t)){const r=t,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),l=this._isStorageTexture(o),u=new mg(r.name,o,i,s,r.attributes,l?zo.StorageTexture:zo.Storage,r.access);u.access||(u.access="read"),this.storage.push(u);continue}if(this._isTextureVar(t)){const r=t,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),l=this._isStorageTexture(o),u=new mg(r.name,o,i,s,r.attributes,l?zo.StorageTexture:zo.Texture,r.access);u.access||(u.access="read"),l?this.storage.push(u):this.textures.push(u);continue}if(this._isSamplerVar(t)){const r=t,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),l=new mg(r.name,o,i,s,r.attributes,zo.Sampler,r.access);this.samplers.push(l);continue}}for(const t of e)if(t instanceof td){const r=this._getAttribute(t,"vertex"),i=this._getAttribute(t,"fragment"),s=this._getAttribute(t,"compute"),o=r||i||s,l=new SG(t.name,o?.name,t.attributes);l.attributes=t.attributes,l.startLine=t.startLine,l.endLine=t.endLine,this.functions.push(l),this._functions.get(t.name).info=l,o&&(this._functions.get(t.name).inUse=!0,l.inUse=!0,l.resources=this._findResources(t,!!o),l.inputs=this._getInputs(t.args),l.outputs=this._getOutputs(t.returnType),this.entry[o.name].push(l)),l.arguments=t.args.map(u=>new AG(u.name,this.getTypeInfo(u.type,u.attributes),u.attributes)),l.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null;continue}for(const t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(const t of this._functions.values())t.node.search(r=>{var i,s,o;if(r instanceof T4){if(r.value)if(Re(r.value))for(const l of r.value)for(const u of this.overrides)l===u.name&&((i=t.info)===null||i===void 0||i.overrides.push(u));else for(const l of this.overrides)r.value===l.name&&((s=t.info)===null||s===void 0||s.overrides.push(l))}else if(r instanceof Ar)for(const l of this.overrides)r.name===l.name&&((o=t.info)===null||o===void 0||o.overrides.push(l))});for(const t of this.uniforms)this._markStructsInUse(t.type);for(const t of this.storage)this._markStructsInUse(t.type)}getFunctionInfo(e){for(const t of this.functions)if(t.name==e)return t;return null}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var r;for(const i of e.calls){const s=(r=this._functions.get(i.name))===null||r===void 0?void 0:r.info;s&&t.add(s)}}findResource(e,t,r){if(r){for(const i of this.entry.compute)if(i.name===r){for(const s of i.resources)if(s.group==e&&s.binding==t)return s}for(const i of this.entry.vertex)if(i.name===r){for(const s of i.resources)if(s.group==e&&s.binding==t)return s}for(const i of this.entry.fragment)if(i.name===r){for(const s of i.resources)if(s.group==e&&s.binding==t)return s}}for(const i of this.uniforms)if(i.group==e&&i.binding==t)return i;for(const i of this.storage)if(i.group==e&&i.binding==t)return i;for(const i of this.textures)if(i.group==e&&i.binding==t)return i;for(const i of this.samplers)if(i.group==e&&i.binding==t)return i;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const r=[],i=this,s=[];return e.search(o=>{if(o instanceof Gm)s.push({});else if(o instanceof Zm)s.pop();else if(o instanceof Rs){const l=o;t&&l.type!==null&&this._markStructsFromAST(l.type),s.length>0&&(s[s.length-1][l.name]=l)}else if(o instanceof Li){const l=o;t&&l.type!==null&&this._markStructsFromAST(l.type)}else if(o instanceof Mf){const l=o;t&&l.type!==null&&this._markStructsFromAST(l.type),s.length>0&&(s[s.length-1][l.name]=l)}else if(o instanceof Ar){const l=o;if(s.length>0&&s[s.length-1][l.name])return;const u=i._findResource(l.name);u&&r.push(u)}else if(o instanceof SE){const l=o,u=i._functions.get(l.name);u&&(t&&(u.inUse=!0),e.calls.add(u.node),u.resources===null&&(u.resources=i._findResources(u.node,t)),r.push(...u.resources))}else if(o instanceof xE){const l=o,u=i._functions.get(l.name);u&&(t&&(u.inUse=!0),e.calls.add(u.node),u.resources===null&&(u.resources=i._findResources(u.node,t)),r.push(...u.resources))}}),[...new Map(r.map(o=>[o.name,o])).values()]}getBindGroups(){const e=[];function t(r,i){r>=e.length&&(e.length=r+1),e[r]===void 0&&(e[r]=[]),i>=e[r].length&&(e[r].length=i+1)}for(const r of this.uniforms)t(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.storage)t(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.textures)t(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.samplers)t(r.group,r.binding),e[r.group][r.binding]=r;return e}_getOutputs(e,t=void 0){if(t===void 0&&(t=[]),e instanceof As)this._getStructOutputs(e,t);else{const r=this._getOutputInfo(e);r!==null&&t.push(r)}return t}_getStructOutputs(e,t){for(const r of e.members)if(r.type instanceof As)this._getStructOutputs(r.type,t);else{const i=this._getAttribute(r,"location")||this._getAttribute(r,"builtin");if(i!==null){const s=this.getTypeInfo(r.type,r.type.attributes),o=this._parseInt(i.value),l=new CR(r.name,s,i.name,o);t.push(l)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const r=this.getTypeInfo(e,e.attributes),i=this._parseInt(t.value);return new CR("",r,t.name,i)}return null}_getInputs(e,t=void 0){t===void 0&&(t=[]);for(const r of e)if(r.type instanceof As)this._getStructInputs(r.type,t);else{const i=this._getInputInfo(r);i!==null&&t.push(i)}return t}_getStructInputs(e,t){for(const r of e.members)if(r.type instanceof As)this._getStructInputs(r.type,t);else{const i=this._getInputInfo(r);i!==null&&t.push(i)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const r=this._getAttribute(e,"interpolation"),i=this.getTypeInfo(e.type,e.attributes),s=this._parseInt(t.value),o=new EG(e.name,i,t.name,s);return r!==null&&(o.interpolation=this._parseString(r.value)),o}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new wG(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const t of this.structs)if(t.name==e)return t;for(const t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof nm){const i=e.type?this.getTypeInfo(e.type,e.attributes):null,s=new lT(e.name,i,t);return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof Of){const i=e,s=i.format?this.getTypeInfo(i.format,i.attributes):null,o=new sa(i.name,t);return o.format=s,o.count=i.count,this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof As){const i=e,s=new Yo(i.name,t);s.startLine=i.startLine,s.endLine=i.endLine;for(const o of i.members){const l=this.getTypeInfo(o.type,o.attributes);s.members.push(new RR(o.name,l,o.attributes))}return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof _f){const i=e,s=i.format instanceof ye,o=i.format?s?this.getTypeInfo(i.format,null):new $r(i.format,null):null,l=new El(i.name,o,t,i.access);return this._types.set(e,l),this._updateTypeInfo(l),l}if(e instanceof re){const i=e,s=i.format?this.getTypeInfo(i.format,null):null,o=new El(i.name,s,t,i.access);return this._types.set(e,o),this._updateTypeInfo(o),o}const r=new $r(e.name,t);return this._types.set(e,r),this._updateTypeInfo(r),r}_updateTypeInfo(e){var t,r,i;const s=this._getTypeSize(e);if(e.size=(t=s?.size)!==null&&t!==void 0?t:0,e instanceof sa&&e.format){const o=this._getTypeSize(e.format);e.stride=Math.max((r=o?.size)!==null&&r!==void 0?r:0,(i=o?.align)!==null&&i!==void 0?i:0),this._updateTypeInfo(e.format)}e instanceof lT&&this._updateTypeInfo(e.format),e instanceof Yo&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let r=0,i=0,s=0,o=0;for(let l=0,u=e.members.length;l<u;++l){const h=e.members[l],d=this._getTypeSize(h);if(!d)continue;(t=this._getAlias(h.type.name))!==null&&t!==void 0||h.type;const g=d.align,y=d.size;r=this._roundUp(g,r+i),i=y,s=r,o=Math.max(o,g),h.offset=r,h.size=y,this._updateTypeInfo(h.type)}e.size=this._roundUp(o,s+i),e.align=o}_getTypeSize(e){var t,r;if(e==null)return null;const i=this._getAttributeNum(e.attributes,"size",0),s=this._getAttributeNum(e.attributes,"align",0);if(e instanceof RR&&(e=e.type),e instanceof $r){const o=this._getAlias(e.name);o!==null&&(e=o)}{const o=Vi._typeInfo[e.name];if(o!==void 0){const l=((t=e.format)===null||t===void 0?void 0:t.name)==="f16"?2:1;return new _g(Math.max(s,o.align/l),Math.max(i,o.size/l))}}{const o=Vi._typeInfo[e.name.substring(0,e.name.length-1)];if(o){const l=e.name[e.name.length-1]==="h"?2:1;return new _g(Math.max(s,o.align/l),Math.max(i,o.size/l))}}if(e instanceof sa){let o=e,l=8,u=8;const h=this._getTypeSize(o.format);return h!==null&&(u=h.size,l=h.align),u=o.count*this._getAttributeNum((r=e?.attributes)!==null&&r!==void 0?r:null,"stride",this._roundUp(l,u)),i&&(u=i),new _g(Math.max(s,l),Math.max(i,u))}if(e instanceof Yo){let o=0,l=0,u=0,h=0,d=0;for(const g of e.members){const y=this._getTypeSize(g.type);y!==null&&(o=Math.max(y.align,o),u=this._roundUp(y.align,u+h),h=y.size,d=u)}return l=this._roundUp(o,d+h),new _g(Math.max(s,o),Math.max(i,l))}return null}_isUniformVar(e){return e instanceof Rs&&e.storage=="uniform"}_isStorageVar(e){return e instanceof Rs&&e.storage=="storage"}_isTextureVar(e){return e instanceof Rs&&e.type!==null&&Vi._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof Rs&&e.type!==null&&Vi._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,t){const r=e;if(!r||!r.attributes)return null;const i=r.attributes;for(let s of i)if(s.name==t)return s;return null}_getAttributeNum(e,t,r){if(e===null)return r;for(let i of e)if(i.name==t){let s=i!==null&&i.value!==null?i.value:r;return s instanceof Array&&(s=s[0]),typeof s=="number"?s:typeof s=="string"?parseInt(s):r}return r}_roundUp(e,t){return Math.ceil(t/e)*e}}Vi._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},Vi._textureTypes=B.any_texture_type.map(n=>n.name),Vi._samplerTypes=B.sampler_type.map(n=>n.name);let RE=0;class CE{constructor(e,t,r){this.id=RE++,this.name=e,this.value=t,this.node=r}clone(){return new CE(this.name,this.value,this.node)}}class IE{constructor(e){this.id=RE++,this.name=e.name,this.node=e}clone(){return new IE(this.node)}}class PE{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=RE++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?(t=this.variables.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?(t=this.functions.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,r){this.variables.set(e,new CE(e,t,r??null))}setVariable(e,t,r){const i=this.getVariable(e);i!==null?i.value=t:this.createVariable(e,t,r)}getVariableValue(e){var t;const r=this.getVariable(e);return(t=r?.value)!==null&&t!==void 0?t:null}clone(){return new PE(this)}}class qG{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}}class XG{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const r=this.exec.evalExpression(e.args[0],t);let i=!0;if(r instanceof $)return r.data.forEach(s=>{s||(i=!1)}),new J(i?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof $){const i=r.data.some(s=>s);return new J(i?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){const r=this.exec.evalExpression(e.args[2],t);if(!(r instanceof J))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return r.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let r=e.args[0];r instanceof nn&&(r=r.right);const i=this.exec.evalExpression(r,t);if(i instanceof $t&&i.typeInfo.size===0){const s=i.typeInfo,o=i.buffer.byteLength/s.stride;return new J(o,this.getTypeInfo("u32"))}return new J(i.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof $)return new $(r.data.map(s=>Math.abs(s)),r.typeInfo);const i=r;return new J(Math.abs(i.value),i.typeInfo)}Acos(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof $)return new $(r.data.map(s=>Math.acos(s)),r.typeInfo);const i=r;return new J(Math.acos(i.value),r.typeInfo)}Acosh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof $)return new $(r.data.map(s=>Math.acosh(s)),r.typeInfo);const i=r;return new J(Math.acosh(i.value),r.typeInfo)}Asin(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof $)return new $(r.data.map(s=>Math.asin(s)),r.typeInfo);const i=r;return new J(Math.asin(i.value),r.typeInfo)}Asinh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof $)return new $(r.data.map(s=>Math.asinh(s)),r.typeInfo);const i=r;return new J(Math.asinh(i.value),r.typeInfo)}Atan(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof $)return new $(r.data.map(s=>Math.atan(s)),r.typeInfo);const i=r;return new J(Math.atan(i.value),r.typeInfo)}Atanh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof $)return new $(r.data.map(s=>Math.atanh(s)),r.typeInfo);const i=r;return new J(Math.atanh(i.value),r.typeInfo)}Atan2(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(r instanceof $&&i instanceof $)return new $(r.data.map((l,u)=>Math.atan2(l,i.data[u])),r.typeInfo);const s=r,o=i;return new J(Math.atan2(s.value,o.value),r.typeInfo)}Ceil(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof $)return new $(r.data.map(s=>Math.ceil(s)),r.typeInfo);const i=r;return new J(Math.ceil(i.value),r.typeInfo)}_clamp(e,t,r){return Math.min(Math.max(e,t),r)}Clamp(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(r instanceof $&&i instanceof $&&s instanceof $)return new $(r.data.map((h,d)=>this._clamp(h,i.data[d],s.data[d])),r.typeInfo);const o=r,l=i,u=s;return new J(this._clamp(o.value,l.value,u.value),r.typeInfo)}Cos(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof $)return new $(r.data.map(s=>Math.cos(s)),r.typeInfo);const i=r;return new J(Math.cos(i.value),r.typeInfo)}Cosh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof $)return new $(r.data.map(s=>Math.cosh(s)),r.typeInfo);const i=r;return new J(Math.cos(i.value),r.typeInfo)}CountLeadingZeros(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof $)return new $(r.data.map(s=>Math.clz32(s)),r.typeInfo);const i=r;return new J(Math.clz32(i.value),r.typeInfo)}_countOneBits(e){let t=0;for(;e!==0;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof $)return new $(r.data.map(s=>this._countOneBits(s)),r.typeInfo);const i=r;return new J(this._countOneBits(i.value),r.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof $)return new $(r.data.map(s=>this._countTrailingZeros(s)),r.typeInfo);const i=r;return new J(this._countTrailingZeros(i.value),r.typeInfo)}Cross(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(r instanceof $&&i instanceof $){if(r.data.length!==3||i.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const s=r.data,o=i.data;return new $([s[1]*o[2]-o[1]*s[2],s[2]*o[0]-o[2]*s[0],s[0]*o[1]-o[0]*s[1]],r.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){const r=this.exec.evalExpression(e.args[0],t),i=180/Math.PI;return r instanceof $?new $(r.data.map(s=>s*i),r.typeInfo):new J(r.value*i,this.getTypeInfo("f32"))}Determinant(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Ve){const i=r.data,s=r.typeInfo.getTypeName(),o=s.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(s==="mat2x2"||s==="mat2x2f"||s==="mat2x2h")return new J(i[0]*i[3]-i[1]*i[2],o);if(s==="mat2x3"||s==="mat2x3f"||s==="mat2x3h")return new J(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),o);if(s==="mat2x4"||s==="mat2x4f"||s==="mat2x4h")console.error(`TODO: Determinant for ${s}`);else if(s==="mat3x2"||s==="mat3x2f"||s==="mat3x2h")console.error(`TODO: Determinant for ${s}`);else{if(s==="mat3x3"||s==="mat3x3f"||s==="mat3x3h")return new J(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),o);s==="mat3x4"||s==="mat3x4f"||s==="mat3x4h"||s==="mat4x2"||s==="mat4x2f"||s==="mat4x2h"||s==="mat4x3"||s==="mat4x3f"||s==="mat4x3h"?console.error(`TODO: Determinant for ${s}`):s!=="mat4x4"&&s!=="mat4x4f"&&s!=="mat4x4h"||console.error(`TODO: Determinant for ${s}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(r instanceof $&&i instanceof $){let l=0;for(let u=0;u<r.data.length;++u)l+=(r.data[u]-i.data[u])*(r.data[u]-i.data[u]);return new J(Math.sqrt(l),this.getTypeInfo("f32"))}const s=r,o=i;return new J(Math.abs(s.value-o.value),r.typeInfo)}_dot(e,t){let r=0;for(let i=0;i<e.length;++i)r+=t[i]*e[i];return r}Dot(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);return r instanceof $&&i instanceof $?new J(this._dot(r.data,i.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof $)return new $(r.data.map(s=>Math.exp(s)),r.typeInfo);const i=r;return new J(Math.exp(i.value),r.typeInfo)}Exp2(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof $)return new $(r.data.map(s=>Math.pow(2,s)),r.typeInfo);const i=r;return new J(Math.pow(2,i.value),r.typeInfo)}ExtractBits(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(i.typeInfo.name!=="u32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const o=i.value,l=s.value;if(r instanceof $)return new $(r.data.map(h=>h>>o&(1<<l)-1),r.typeInfo);if(r.typeInfo.name!=="i32"&&r.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const u=r.value;return new J(u>>o&(1<<l)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(r instanceof $&&i instanceof $&&s instanceof $){const o=this._dot(i.data,s.data);return new $(o<0?Array.from(r.data):r.data.map(l=>-l),r.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof $)return new $(r.data.map(s=>this._firstLeadingBit(s)),r.typeInfo);const i=r;return new J(this._firstLeadingBit(i.value),r.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof $)return new $(r.data.map(s=>this._firstTrailingBit(s)),r.typeInfo);const i=r;return new J(this._firstTrailingBit(i.value),r.typeInfo)}Floor(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof $)return new $(r.data.map(s=>Math.floor(s)),r.typeInfo);const i=r;return new J(Math.floor(i.value),r.typeInfo)}Fma(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(r instanceof $&&i instanceof $&&s instanceof $)return r.data.length!==i.data.length||r.data.length!==s.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new $(r.data.map((h,d)=>h*i.data[d]+s.data[d]),r.typeInfo);const o=r,l=i,u=s;return new J(o.value*l.value+u.value,o.typeInfo)}Fract(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof $)return new $(r.data.map(s=>s-Math.floor(s)),r.typeInfo);const i=r;return new J(i.value-Math.floor(i.value),r.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t),o=this.exec.evalExpression(e.args[3],t);if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const l=s.value,u=(1<<o.value)-1<<l,h=~u;if(r instanceof $&&i instanceof $)return new $(r.data.map((y,b)=>y&h|i.data[b]<<l&u),r.typeInfo);const d=r.value,g=i.value;return new J(d&h|g<<l&u,r.typeInfo)}InverseSqrt(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof $)return new $(r.data.map(s=>1/Math.sqrt(s)),r.typeInfo);const i=r;return new J(1/Math.sqrt(i.value),r.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof $){let s=0;return r.data.forEach(o=>{s+=o*o}),new J(Math.sqrt(s),this.getTypeInfo("f32"))}const i=r;return new J(Math.abs(i.value),r.typeInfo)}Log(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof $)return new $(r.data.map(s=>Math.log(s)),r.typeInfo);const i=r;return new J(Math.log(i.value),r.typeInfo)}Log2(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof $)return new $(r.data.map(s=>Math.log2(s)),r.typeInfo);const i=r;return new J(Math.log2(i.value),r.typeInfo)}Max(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(r instanceof $&&i instanceof $)return new $(r.data.map((l,u)=>Math.max(l,i.data[u])),r.typeInfo);const s=r,o=i;return new J(Math.max(s.value,o.value),r.typeInfo)}Min(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(r instanceof $&&i instanceof $)return new $(r.data.map((l,u)=>Math.min(l,i.data[u])),r.typeInfo);const s=r,o=i;return new J(Math.min(s.value,o.value),r.typeInfo)}Mix(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(r instanceof $&&i instanceof $&&s instanceof $)return new $(r.data.map((u,h)=>r.data[h]*(1-s.data[h])+i.data[h]*s.data[h]),r.typeInfo);const o=i,l=s;return new J(r.value*(1-l.value)+o.value*l.value,r.typeInfo)}Modf(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(r instanceof $&&i instanceof $)return new $(r.data.map((o,l)=>o%i.data[l]),r.typeInfo);const s=i;return new J(r.value%s.value,r.typeInfo)}Normalize(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof $){const i=this.Length(e,t).value;return new $(r.data.map(s=>s/i),r.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(r instanceof $&&i instanceof $)return new $(r.data.map((l,u)=>Math.pow(l,i.data[u])),r.typeInfo);const s=r,o=i;return new J(Math.pow(s.value,o.value),r.typeInfo)}QuantizeToF16(e,t){const r=this.exec.evalExpression(e.args[0],t);return r instanceof $?new $(r.data.map(i=>i),r.typeInfo):new J(r.value,r.typeInfo)}Radians(e,t){const r=this.exec.evalExpression(e.args[0],t);return r instanceof $?new $(r.data.map(i=>i*Math.PI/180),r.typeInfo):new J(r.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(r instanceof $&&i instanceof $){const s=this._dot(r.data,i.data);return new $(r.data.map((o,l)=>o-2*s*i.data[l]),r.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(r instanceof $&&i instanceof $&&s instanceof J){const o=this._dot(i.data,r.data);return new $(r.data.map((l,u)=>{const h=1-s.value*s.value*(1-o*o);if(h<0)return 0;const d=Math.sqrt(h);return s.value*l-(s.value*o+d)*i.data[u]}),r.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof $)return new $(r.data.map(s=>Math.round(s)),r.typeInfo);const i=r;return new J(Math.round(i.value),r.typeInfo)}Saturate(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof $)return new $(r.data.map(s=>Math.min(Math.max(s,0),1)),r.typeInfo);const i=r;return new J(Math.min(Math.max(i.value,0),1),r.typeInfo)}Sign(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof $)return new $(r.data.map(s=>Math.sign(s)),r.typeInfo);const i=r;return new J(Math.sign(i.value),r.typeInfo)}Sin(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof $)return new $(r.data.map(s=>Math.sin(s)),r.typeInfo);const i=r;return new J(Math.sin(i.value),r.typeInfo)}Sinh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof $)return new $(r.data.map(s=>Math.sinh(s)),r.typeInfo);const i=r;return new J(Math.sinh(i.value),r.typeInfo)}_smoothstep(e,t,r){const i=Math.min(Math.max((r-e)/(t-e),0),1);return i*i*(3-2*i)}SmoothStep(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(s instanceof $&&r instanceof $&&i instanceof $)return new $(s.data.map((h,d)=>this._smoothstep(r.data[d],i.data[d],h)),s.typeInfo);const o=r,l=i,u=s;return new J(this._smoothstep(o.value,l.value,u.value),s.typeInfo)}Sqrt(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof $)return new $(r.data.map(s=>Math.sqrt(s)),r.typeInfo);const i=r;return new J(Math.sqrt(i.value),r.typeInfo)}Step(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(i instanceof $&&r instanceof $)return new $(i.data.map((o,l)=>o<r.data[l]?0:1),i.typeInfo);const s=r;return new J(i.value<s.value?0:1,s.typeInfo)}Tan(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof $)return new $(r.data.map(s=>Math.tan(s)),r.typeInfo);const i=r;return new J(Math.tan(i.value),r.typeInfo)}Tanh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof $)return new $(r.data.map(s=>Math.tanh(s)),r.typeInfo);const i=r;return new J(Math.tanh(i.value),r.typeInfo)}_getTransposeType(e){const t=e.getTypeName();return t==="mat2x2f"||t==="mat2x2h"?e:t==="mat2x3f"?this.getTypeInfo("mat3x2f"):t==="mat2x3h"?this.getTypeInfo("mat3x2h"):t==="mat2x4f"?this.getTypeInfo("mat4x2f"):t==="mat2x4h"?this.getTypeInfo("mat4x2h"):t==="mat3x2f"?this.getTypeInfo("mat2x3f"):t==="mat3x2h"?this.getTypeInfo("mat2x3h"):t==="mat3x3f"||t==="mat3x3h"?e:t==="mat3x4f"?this.getTypeInfo("mat4x3f"):t==="mat3x4h"?this.getTypeInfo("mat4x3h"):t==="mat4x2f"?this.getTypeInfo("mat2x4f"):t==="mat4x2h"?this.getTypeInfo("mat2x4h"):t==="mat4x3f"?this.getTypeInfo("mat3x4f"):t==="mat4x3h"?this.getTypeInfo("mat3x4h"):(t==="mat4x4f"||t==="mat4x4h"||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){const r=this.exec.evalExpression(e.args[0],t);if(!(r instanceof Ve))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const i=this._getTransposeType(r.typeInfo);if(r.typeInfo.name==="mat2x2"||r.typeInfo.name==="mat2x2f"||r.typeInfo.name==="mat2x2h"){const s=r.data;return new Ve([s[0],s[2],s[1],s[3]],i)}if(r.typeInfo.name==="mat2x3"||r.typeInfo.name==="mat2x3f"||r.typeInfo.name==="mat2x3h"){const s=r.data;return new Ve([s[0],s[3],s[6],s[1],s[4],s[7]],i)}if(r.typeInfo.name==="mat2x4"||r.typeInfo.name==="mat2x4f"||r.typeInfo.name==="mat2x4h"){const s=r.data;return new Ve([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13]],i)}if(r.typeInfo.name==="mat3x2"||r.typeInfo.name==="mat3x2f"||r.typeInfo.name==="mat3x2h"){const s=r.data;return new Ve([s[0],s[3],s[1],s[4],s[2],s[5]],i)}if(r.typeInfo.name==="mat3x3"||r.typeInfo.name==="mat3x3f"||r.typeInfo.name==="mat3x3h"){const s=r.data;return new Ve([s[0],s[3],s[6],s[1],s[4],s[7],s[2],s[5],s[8]],i)}if(r.typeInfo.name==="mat3x4"||r.typeInfo.name==="mat3x4f"||r.typeInfo.name==="mat3x4h"){const s=r.data;return new Ve([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14]],i)}if(r.typeInfo.name==="mat4x2"||r.typeInfo.name==="mat4x2f"||r.typeInfo.name==="mat4x2h"){const s=r.data;return new Ve([s[0],s[4],s[1],s[5],s[2],s[6]],i)}if(r.typeInfo.name==="mat4x3"||r.typeInfo.name==="mat4x3f"||r.typeInfo.name==="mat4x3h"){const s=r.data;return new Ve([s[0],s[4],s[8],s[1],s[5],s[9],s[2],s[6],s[10]],i)}if(r.typeInfo.name==="mat4x4"||r.typeInfo.name==="mat4x4f"||r.typeInfo.name==="mat4x4h"){const s=r.data;return new Ve([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14],s[3],s[7],s[11],s[15]],i)}return console.error(`Invalid matrix type ${r.typeInfo.name}`),null}Trunc(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof $)return new $(r.data.map(s=>Math.trunc(s)),r.typeInfo);const i=r;return new J(Math.trunc(i.value),r.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){const r=e.args[0],i=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(r instanceof Ar){const s=r.name,o=t.getVariableValue(s);if(o instanceof Ss){if(i<0||i>=o.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const l=o.getMipLevelSize(i),u=o.dimension;return u==="1d"?new J(l[0],this.getTypeInfo("u32")):u==="3d"?new $(l,this.getTypeInfo("vec3u")):u==="2d"?new $(l.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${u} not found. Line ${e.line}`),null)}return console.error(`Texture ${s} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){const r=e.args[0],i=this.exec.evalExpression(e.args[1],t),s=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(i instanceof $)||i.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(r instanceof Ar){const o=r.name,l=t.getVariableValue(o);if(l instanceof Ss){const u=Math.floor(i.data[0]),h=Math.floor(i.data[1]);if(u<0||u>=l.width||h<0||h>=l.height)return console.error(`Texture ${o} out of bounds. Line ${e.line}`),null;const d=l.getPixel(u,h,0,s);return d===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new $(d,this.getTypeInfo("vec4f"))}return console.error(`Texture ${o} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){const r=e.args[0];if(r instanceof Ar){const i=r.name,s=t.getVariableValue(i);return s instanceof Ss?new J(s.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,t){const r=e.args[0];if(r instanceof Ar){const i=r.name,s=t.getVariableValue(i);return s instanceof Ss?new J(s.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,t){const r=e.args[0];if(r instanceof Ar){const i=r.name,s=t.getVariableValue(i);return s instanceof Ss?new J(s.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){const r=e.args[0],i=this.exec.evalExpression(e.args[1],t),s=e.args.length===4?this.exec.evalExpression(e.args[2],t).value:0,o=e.args.length===4?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(o.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(i instanceof $)||i.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(r instanceof Ar){const l=r.name,u=t.getVariableValue(l);if(u instanceof Ss){const h=u.getMipLevelSize(0),d=Math.floor(i.data[0]),g=Math.floor(i.data[1]);return d<0||d>=h[0]||g<0||g>=h[1]?(console.error(`Texture ${l} out of bounds. Line ${e.line}`),null):(u.setPixel(d,g,0,s,Array.from(o)),null)}return console.error(`Texture ${l} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let r=e.args[0];r instanceof nn&&(r=r.right);const i=this.exec.getVariableName(r,t);return t.getVariable(i).value.getSubData(this.exec,r.postfix,t)}AtomicStore(e,t){let r=e.args[0];r instanceof nn&&(r=r.right);const i=this.exec.getVariableName(r,t),s=t.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,t),u=s.value.getSubData(this.exec,r.postfix,t);return u instanceof J&&l instanceof J&&(u.value=l.value),s.value instanceof $t&&s.value.setDataValue(this.exec,u,r.postfix,t),null}AtomicAdd(e,t){let r=e.args[0];r instanceof nn&&(r=r.right);const i=this.exec.getVariableName(r,t),s=t.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,t),u=s.value.getSubData(this.exec,r.postfix,t),h=new J(u.value,u.typeInfo);return u instanceof J&&l instanceof J&&(u.value+=l.value),s.value instanceof $t&&s.value.setDataValue(this.exec,u,r.postfix,t),h}AtomicSub(e,t){let r=e.args[0];r instanceof nn&&(r=r.right);const i=this.exec.getVariableName(r,t),s=t.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,t),u=s.value.getSubData(this.exec,r.postfix,t),h=new J(u.value,u.typeInfo);return u instanceof J&&l instanceof J&&(u.value-=l.value),s.value instanceof $t&&s.value.setDataValue(this.exec,u,r.postfix,t),h}AtomicMax(e,t){let r=e.args[0];r instanceof nn&&(r=r.right);const i=this.exec.getVariableName(r,t),s=t.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,t),u=s.value.getSubData(this.exec,r.postfix,t),h=new J(u.value,u.typeInfo);return u instanceof J&&l instanceof J&&(u.value=Math.max(u.value,l.value)),s.value instanceof $t&&s.value.setDataValue(this.exec,u,r.postfix,t),h}AtomicMin(e,t){let r=e.args[0];r instanceof nn&&(r=r.right);const i=this.exec.getVariableName(r,t),s=t.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,t),u=s.value.getSubData(this.exec,r.postfix,t),h=new J(u.value,u.typeInfo);return u instanceof J&&l instanceof J&&(u.value=Math.min(u.value,l.value)),s.value instanceof $t&&s.value.setDataValue(this.exec,u,r.postfix,t),h}AtomicAnd(e,t){let r=e.args[0];r instanceof nn&&(r=r.right);const i=this.exec.getVariableName(r,t),s=t.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,t),u=s.value.getSubData(this.exec,r.postfix,t),h=new J(u.value,u.typeInfo);return u instanceof J&&l instanceof J&&(u.value=u.value&l.value),s.value instanceof $t&&s.value.setDataValue(this.exec,u,r.postfix,t),h}AtomicOr(e,t){let r=e.args[0];r instanceof nn&&(r=r.right);const i=this.exec.getVariableName(r,t),s=t.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,t),u=s.value.getSubData(this.exec,r.postfix,t),h=new J(u.value,u.typeInfo);return u instanceof J&&l instanceof J&&(u.value=u.value|l.value),s.value instanceof $t&&s.value.setDataValue(this.exec,u,r.postfix,t),h}AtomicXor(e,t){let r=e.args[0];r instanceof nn&&(r=r.right);const i=this.exec.getVariableName(r,t),s=t.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,t),u=s.value.getSubData(this.exec,r.postfix,t),h=new J(u.value,u.typeInfo);return u instanceof J&&l instanceof J&&(u.value=u.value^l.value),s.value instanceof $t&&s.value.setDataValue(this.exec,u,r.postfix,t),h}AtomicExchange(e,t){let r=e.args[0];r instanceof nn&&(r=r.right);const i=this.exec.getVariableName(r,t),s=t.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,t),u=s.value.getSubData(this.exec,r.postfix,t),h=new J(u.value,u.typeInfo);return u instanceof J&&l instanceof J&&(u.value=l.value),s.value instanceof $t&&s.value.setDataValue(this.exec,u,r.postfix,t),h}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}}const $b={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},nr={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class $n extends qG{constructor(e,t){var r;super(),this.ast=e??[],this.reflection=new Vi,this.reflection.updateAST(this.ast),this.context=(r=t?.clone())!==null&&r!==void 0?r:new PE,this.builtins=new XG(this),this.typeInfo={bool:this.getTypeInfo(ye.bool),i32:this.getTypeInfo(ye.i32),u32:this.getTypeInfo(ye.u32),f32:this.getTypeInfo(ye.f32),f16:this.getTypeInfo(ye.f16),vec2f:this.getTypeInfo(re.vec2f),vec2u:this.getTypeInfo(re.vec2u),vec2i:this.getTypeInfo(re.vec2i),vec2h:this.getTypeInfo(re.vec2h),vec3f:this.getTypeInfo(re.vec3f),vec3u:this.getTypeInfo(re.vec3u),vec3i:this.getTypeInfo(re.vec3i),vec3h:this.getTypeInfo(re.vec3h),vec4f:this.getTypeInfo(re.vec4f),vec4u:this.getTypeInfo(re.vec4u),vec4i:this.getTypeInfo(re.vec4i),vec4h:this.getTypeInfo(re.vec4h),mat2x2f:this.getTypeInfo(re.mat2x2f),mat2x3f:this.getTypeInfo(re.mat2x3f),mat2x4f:this.getTypeInfo(re.mat2x4f),mat3x2f:this.getTypeInfo(re.mat3x2f),mat3x3f:this.getTypeInfo(re.mat3x3f),mat3x4f:this.getTypeInfo(re.mat3x4f),mat4x2f:this.getTypeInfo(re.mat4x2f),mat4x3f:this.getTypeInfo(re.mat4x3f),mat4x4f:this.getTypeInfo(re.mat4x4f)}}getVariableValue(e){var t,r;const i=(r=(t=this.context.getVariable(e))===null||t===void 0?void 0:t.value)!==null&&r!==void 0?r:null;if(i===null)return null;if(i instanceof J)return i.value;if(i instanceof $||i instanceof Ve)return Array.from(i.data);if(i instanceof $t&&i.typeInfo instanceof sa){if(i.typeInfo.format.name==="u32")return Array.from(new Uint32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="i32")return Array.from(new Int32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="f32")return Array.from(new Float32Array(i.buffer,i.offset,i.typeInfo.count))}return console.error(`Unsupported return variable type ${i.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,r,i){const s=this.context.clone();(i=i??{}).constants&&this._setOverrides(i.constants,s),this._execStatements(this.ast,s);const o=s.getFunction(e);if(!o)return void console.error(`Function ${e} not found`);if(typeof t=="number")t=[t,1,1];else{if(t.length===0)return void console.error("Invalid dispatch count");t.length===1?t=[t[0],1,1]:t.length===2?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const l=t[0],u=t[1],h=t[2],d=this.getTypeInfo("vec3u");s.setVariable("@num_workgroups",new $(t,d));const g=this.reflection.getFunctionInfo(e);g===null&&console.error(`Function ${e} not found in reflection data`);for(const y in r)for(const b in r[y]){const w=r[y][b];s.variables.forEach(E=>{var x;const C=E.node;if(C?.attributes){let M=null,O=null;for(const V of C.attributes)V.name==="binding"?M=V.value:V.name==="group"&&(O=V.value);if(b==M&&y==O){let V=!1;for(const H of g.resources)if(H.name===E.name&&H.group===parseInt(y)&&H.binding===parseInt(b)){V=!0;break}if(V)if(w.texture!==void 0&&w.descriptor!==void 0){const H=new Ss(w.texture,this.getTypeInfo(C.type),w.descriptor,(x=w.texture.view)!==null&&x!==void 0?x:null);E.value=H}else w.uniform!==void 0?E.value=new $t(w.uniform,this.getTypeInfo(C.type)):E.value=new $t(w,this.getTypeInfo(C.type))}}})}for(let y=0;y<h;++y)for(let b=0;b<u;++b)for(let w=0;w<l;++w)s.setVariable("@workgroup_id",new $([w,b,y],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(o,[w,b,y],s)}execStatement(e,t){if(e instanceof h4)return this.evalExpression(e.value,t);if(e instanceof d4){if(e.condition){const r=this.evalExpression(e.condition,t);if(!(r instanceof J))throw new Error("Invalid break-if condition");if(!r.value)return null}return $n._breakObj}if(e instanceof p4)return $n._continueObj;if(e instanceof Mf)this._let(e,t);else if(e instanceof Rs)this._var(e,t);else if(e instanceof tm)this._const(e,t);else if(e instanceof td)this._function(e,t);else{if(e instanceof u4)return this._if(e,t);if(e instanceof c4)return this._switch(e,t);if(e instanceof s4)return this._for(e,t);if(e instanceof i4)return this._while(e,t);if(e instanceof l4)return this._loop(e,t);if(e instanceof cT){const r=t.clone();return r.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,r)}if(e instanceof a4)this._assign(e,t);else if(e instanceof o4)this._increment(e,t);else{if(e instanceof As)return null;if(e instanceof EE){const r=e.name;t.getVariable(r)===null&&t.setVariable(r,new J(0,this.getTypeInfo("u32")))}else if(e instanceof xE)this._call(e,t);else{if(e instanceof f4||e instanceof AE)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){return e instanceof oi?this._evalBinaryOp(e,t):e instanceof fn?this._evalLiteral(e,t):e instanceof Ar?this._evalVariable(e,t):e instanceof SE?this._evalCall(e,t):e instanceof Li?this._evalCreate(e,t):e instanceof g4?this._evalConst(e,t):e instanceof m4?this._evalBitcast(e,t):e instanceof nn?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof ye){const i=this.reflection.getTypeInfo(e);if(i!==null)return i}let r=(t=this.typeInfo[e])!==null&&t!==void 0?t:null;return r!==null||(r=this.reflection.getTypeInfoByName(e)),r}_setOverrides(e,t){for(const r in e){const i=e[r],s=this.reflection.getOverrideInfo(r);s!==null?(s.type===null&&(s.type=this.getTypeInfo("u32")),s.type.name==="u32"||s.type.name==="i32"||s.type.name==="f32"||s.type.name==="f16"?t.setVariable(r,new J(i,s.type)):s.type.name==="bool"?t.setVariable(r,new J(i?1:0,s.type)):s.type.name==="vec2"||s.type.name==="vec3"||s.type.name==="vec4"||s.type.name==="vec2f"||s.type.name==="vec3f"||s.type.name==="vec4f"||s.type.name==="vec2i"||s.type.name==="vec3i"||s.type.name==="vec4i"||s.type.name==="vec2u"||s.type.name==="vec3u"||s.type.name==="vec4u"||s.type.name==="vec2h"||s.type.name==="vec3h"||s.type.name==="vec4h"?t.setVariable(r,new $(i,s.type)):console.error(`Invalid constant type for ${r}`)):console.error(`Override ${r} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,r){const i=[1,1,1];for(const d of e.node.attributes)if(d.name==="workgroup_size"){if(d.value.length>0){const g=r.getVariableValue(d.value[0]);i[0]=g instanceof J?g.value:parseInt(d.value[0])}if(d.value.length>1){const g=r.getVariableValue(d.value[1]);i[1]=g instanceof J?g.value:parseInt(d.value[1])}if(d.value.length>2){const g=r.getVariableValue(d.value[2]);i[2]=g instanceof J?g.value:parseInt(d.value[2])}}const s=this.getTypeInfo("vec3u"),o=this.getTypeInfo("u32");r.setVariable("@workgroup_size",new $(i,s));const l=i[0],u=i[1],h=i[2];for(let d=0,g=0;d<h;++d)for(let y=0;y<u;++y)for(let b=0;b<l;++b,++g){const w=[b,y,d],E=[b+t[0]*i[0],y+t[1]*i[1],d+t[2]*i[2]];r.setVariable("@local_invocation_id",new $(w,s)),r.setVariable("@global_invocation_id",new $(E,s)),r.setVariable("@local_invocation_index",new J(g,o)),this._dispatchExec(e,r)}}_dispatchExec(e,t){for(const r of e.node.args)for(const i of r.attributes)if(i.name==="builtin"){const s=`@${i.value}`,o=t.getVariable(s);o!==void 0&&t.variables.set(r.name,o)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof nn;)e=e.right;return e instanceof Ar?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(const r of e){if(r instanceof Array){const s=t.clone(),o=this._execStatements(r,s);if(o)return o;continue}const i=this.execStatement(r,t);if(i)return i}return null}_call(e,t){const r=t.clone();r.currentFunctionName=e.name;const i=t.getFunction(e.name);if(i){for(let s=0;s<i.node.args.length;++s){const o=i.node.args[s],l=this.evalExpression(e.args[s],r);r.setVariable(o.name,l,o)}this._execStatements(i.node.body,r)}else e.isBuiltin?this._callBuiltinFunction(e,r):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){const r=this.getVariableName(e.variable,t),i=t.getVariable(r);i?e.operator==="++"?i.value instanceof J?i.value.value++:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):e.operator==="--"?i.value instanceof J?i.value.value--:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${r} not found. Line ${e.line}`)}_getVariableData(e,t){if(e instanceof Ar){const r=this.getVariableName(e,t),i=t.getVariable(r);return i===null?(console.error(`Variable ${r} not found. Line ${e.line}`),null):i.value.getSubData(this,e.postfix,t)}if(e instanceof nn){if(e.operator==="*"){const r=this._getVariableData(e.right,t);return r instanceof Oc?r.reference.getSubData(this,e.postfix,t):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const r=this._getVariableData(e.right,t);return new Oc(r)}}return null}_assign(e,t){let r=null,i="<var>",s=null;if(e.variable instanceof nn){const u=this._getVariableData(e.variable,t),h=this.evalExpression(e.value,t),d=e.operator;if(d==="="){if(u instanceof J||u instanceof $||u instanceof Ve){if(h instanceof J||h instanceof $||h instanceof Ve&&u.data.length===h.data.length)return void u.data.set(h.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(u instanceof $t&&h instanceof $t&&u.buffer.byteLength-u.offset>=h.buffer.byteLength-h.offset)return void(u.buffer.byteLength%4==0?new Uint32Array(u.buffer,u.offset,u.typeInfo.size/4).set(new Uint32Array(h.buffer,h.offset,h.typeInfo.size/4)):new Uint8Array(u.buffer,u.offset,u.typeInfo.size).set(new Uint8Array(h.buffer,h.offset,h.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(d==="+=")return u instanceof J||u instanceof $||u instanceof Ve?h instanceof J||h instanceof $||h instanceof Ve?void u.data.set(h.data.map((g,y)=>u.data[y]+g)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(d==="-=")return(u instanceof J||u instanceof $||u instanceof Ve)&&(h instanceof J||h instanceof $||h instanceof Ve)?void u.data.set(h.data.map((g,y)=>u.data[y]-g)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof nn){if(e.variable.operator==="*"){i=this.getVariableName(e.variable.right,t);const u=t.getVariable(i);if(!(u&&u.value instanceof Oc))return void console.error(`Variable ${i} is not a pointer. Line ${e.line}`);r=u.value.reference;let h=e.variable.postfix;if(!h){let d=e.variable.right;for(;d instanceof nn;){if(d.postfix){h=d.postfix;break}d=d.right}}h&&(r=r.getSubData(this,h,t))}}else{s=e.variable.postfix,i=this.getVariableName(e.variable,t);const u=t.getVariable(i);if(u===null)return void console.error(`Variable ${i} not found. Line ${e.line}`);r=u.value}if(r instanceof Oc&&(r=r.reference),r===null)return void console.error(`Variable ${i} not found. Line ${e.line}`);const o=this.evalExpression(e.value,t),l=e.operator;if(l!=="="){const u=r.getSubData(this,s,t);if(u instanceof $&&o instanceof J){const h=u.data,d=o.value;if(l==="+=")for(let g=0;g<h.length;++g)h[g]+=d;else if(l==="-=")for(let g=0;g<h.length;++g)h[g]-=d;else if(l==="*=")for(let g=0;g<h.length;++g)h[g]*=d;else if(l==="/=")for(let g=0;g<h.length;++g)h[g]/=d;else if(l==="%=")for(let g=0;g<h.length;++g)h[g]%=d;else if(l==="&=")for(let g=0;g<h.length;++g)h[g]&=d;else if(l==="|=")for(let g=0;g<h.length;++g)h[g]|=d;else if(l==="^=")for(let g=0;g<h.length;++g)h[g]^=d;else if(l==="<<=")for(let g=0;g<h.length;++g)h[g]<<=d;else if(l===">>=")for(let g=0;g<h.length;++g)h[g]>>=d;else console.error(`Invalid operator ${l}. Line ${e.line}`)}else if(u instanceof $&&o instanceof $){const h=u.data,d=o.data;if(h.length!==d.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(l==="+=")for(let g=0;g<h.length;++g)h[g]+=d[g];else if(l==="-=")for(let g=0;g<h.length;++g)h[g]-=d[g];else if(l==="*=")for(let g=0;g<h.length;++g)h[g]*=d[g];else if(l==="/=")for(let g=0;g<h.length;++g)h[g]/=d[g];else if(l==="%=")for(let g=0;g<h.length;++g)h[g]%=d[g];else if(l==="&=")for(let g=0;g<h.length;++g)h[g]&=d[g];else if(l==="|=")for(let g=0;g<h.length;++g)h[g]|=d[g];else if(l==="^=")for(let g=0;g<h.length;++g)h[g]^=d[g];else if(l==="<<=")for(let g=0;g<h.length;++g)h[g]<<=d[g];else if(l===">>=")for(let g=0;g<h.length;++g)h[g]>>=d[g];else console.error(`Invalid operator ${l}. Line ${e.line}`)}else{if(!(u instanceof J&&o instanceof J))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);l==="+="?u.value+=o.value:l==="-="?u.value-=o.value:l==="*="?u.value*=o.value:l==="/="?u.value/=o.value:l==="%="?u.value%=o.value:l==="&="?u.value&=o.value:l==="|="?u.value|=o.value:l==="^="?u.value^=o.value:l==="<<="?u.value<<=o.value:l===">>="?u.value>>=o.value:console.error(`Invalid operator ${l}. Line ${e.line}`)}return void(r instanceof $t&&r.setDataValue(this,u,s,t))}if(r instanceof $t)r.setDataValue(this,o,s,t);else if(s){if(!(r instanceof $||r instanceof Ve))return void console.error(`Variable ${i} is not a vector or matrix. Line ${e.line}`);if(s instanceof Tu){const u=this.evalExpression(s.index,t).value;if(r instanceof $){if(!(o instanceof J))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[u]=o.value}else{if(!(r instanceof Ve))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const h=this.evalExpression(s.index,t).value;if(h<0)return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(o instanceof $))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const d=r.typeInfo.getTypeName();if(d==="mat2x2"||d==="mat2x2f"||d==="mat2x2h"){if(!(h<2&&o.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[2*h]=o.data[0],r.data[2*h+1]=o.data[1]}else if(d==="mat2x3"||d==="mat2x3f"||d==="mat2x3h"){if(!(h<2&&o.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[3*h]=o.data[0],r.data[3*h+1]=o.data[1],r.data[3*h+2]=o.data[2]}else if(d==="mat2x4"||d==="mat2x4f"||d==="mat2x4h"){if(!(h<2&&o.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[4*h]=o.data[0],r.data[4*h+1]=o.data[1],r.data[4*h+2]=o.data[2],r.data[4*h+3]=o.data[3]}else if(d==="mat3x2"||d==="mat3x2f"||d==="mat3x2h"){if(!(h<3&&o.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[2*h]=o.data[0],r.data[2*h+1]=o.data[1]}else if(d==="mat3x3"||d==="mat3x3f"||d==="mat3x3h"){if(!(h<3&&o.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[3*h]=o.data[0],r.data[3*h+1]=o.data[1],r.data[3*h+2]=o.data[2]}else if(d==="mat3x4"||d==="mat3x4f"||d==="mat3x4h"){if(!(h<3&&o.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[4*h]=o.data[0],r.data[4*h+1]=o.data[1],r.data[4*h+2]=o.data[2],r.data[4*h+3]=o.data[3]}else if(d==="mat4x2"||d==="mat4x2f"||d==="mat4x2h"){if(!(h<4&&o.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[2*h]=o.data[0],r.data[2*h+1]=o.data[1]}else if(d==="mat4x3"||d==="mat4x3f"||d==="mat4x3h"){if(!(h<4&&o.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[3*h]=o.data[0],r.data[3*h+1]=o.data[1],r.data[3*h+2]=o.data[2]}else{if(d!=="mat4x4"&&d!=="mat4x4f"&&d!=="mat4x4h")return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(h<4&&o.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[4*h]=o.data[0],r.data[4*h+1]=o.data[1],r.data[4*h+2]=o.data[2],r.data[4*h+3]=o.data[3]}}}}}else if(s instanceof xl){const u=s.value;if(!(r instanceof $))return void console.error(`Invalid assignment to ${u}. Variable ${i} is not a vector. Line ${e.line}`);if(o instanceof J){if(u.length>1)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);if(u==="x")r.data[0]=o.value;else if(u==="y"){if(r.data.length<2)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);r.data[1]=o.value}else if(u==="z"){if(r.data.length<3)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);r.data[2]=o.value}else if(u==="w"){if(r.data.length<4)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);r.data[3]=o.value}}else{if(!(o instanceof $))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(u.length!==o.data.length)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);for(let h=0;h<u.length;++h){const d=u[h];if(d==="x"||d==="r")r.data[0]=o.data[h];else if(d==="y"||d==="g"){if(o.data.length<2)return void console.error(`Invalid assignment to ${d} for variable ${i}. Line ${e.line}`);r.data[1]=o.data[h]}else if(d==="z"||d==="b"){if(o.data.length<3)return void console.error(`Invalid assignment to ${d} for variable ${i}. Line ${e.line}`);r.data[2]=o.data[h]}else{if(d!=="w"&&d!=="a")return void console.error(`Invalid assignment to ${d} for variable ${i}. Line ${e.line}`);if(o.data.length<4)return void console.error(`Invalid assignment to ${d} for variable ${i}. Line ${e.line}`);r.data[3]=o.data[h]}}}}}else r instanceof J&&o instanceof J?r.value=o.value:r instanceof $&&o instanceof $||r instanceof Ve&&o instanceof Ve?r.data.set(o.data):console.error(`Invalid assignment to ${i}. Line ${e.line}`)}_function(e,t){const r=new IE(e);t.functions.set(e.name,r)}_const(e,t){let r=null;e.value!==null&&(r=this.evalExpression(e.value,t)),t.createVariable(e.name,r,e)}_let(e,t){let r=null;if(e.value!==null){if(r=this.evalExpression(e.value,t),r===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof nn||(r=r.clone())}else{const i=e.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||i==="array"){const s=new Li(e.type,[]);r=this._evalCreate(s,t)}}t.createVariable(e.name,r,e)}_var(e,t){let r=null;if(e.value!==null){if(r=this.evalExpression(e.value,t),r===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof nn||(r=r.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const i=e.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||e.type instanceof Of||e.type instanceof As||e.type instanceof re){const s=new Li(e.type,[]);r=this._evalCreate(s,t)}}t.createVariable(e.name,r,e)}_switch(e,t){t=t.clone();const r=this.evalExpression(e.condition,t);if(!(r instanceof J))return console.error(`Invalid if condition. Line ${e.line}`),null;let i=null;for(const s of e.cases)if(s instanceof v4)for(const o of s.selectors){if(o instanceof rm){i=s;continue}const l=this.evalExpression(o,t);if(!(l instanceof J))return console.error(`Invalid case selector. Line ${e.line}`),null;if(l.value===r.value)return this._execStatements(s.body,t)}else s instanceof b4&&(i=s);return i?this._execStatements(i.body,t):null}_if(e,t){t=t.clone();const r=this.evalExpression(e.condition,t);if(!(r instanceof J))return console.error(`Invalid if condition. Line ${e.line}`),null;if(r.value)return this._execStatements(e.body,t);for(const i of e.elseif){const s=this.evalExpression(i.condition,t);if(!(s instanceof J))return console.error(`Invalid if condition. Line ${e.line}`),null;if(s.value)return this._execStatements(i.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof J?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const r=this._execStatements(e.body,t);if(r===$n._breakObj)break;if(r!==null&&r!==$n._continueObj)return r;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const r=this._execStatements(e.body,t);if(r===$n._breakObj)break;if(r===$n._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===$n._breakObj)break}else if(r!==null)return r}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const r=this._execStatements(e.body,t);if(r===$n._breakObj)break;if(r!==$n._continueObj&&r!==null)return r}return null}_evalBitcast(e,t){const r=this.evalExpression(e.value,t),i=e.type;if(r instanceof J){const s=NR(r.value,r.typeInfo.name,i.name);return new J(s,this.getTypeInfo(i))}if(r instanceof $){const s=r.typeInfo.getTypeName();let o="";if(s.endsWith("f"))o="f32";else if(s.endsWith("i"))o="i32";else if(s.endsWith("u"))o="u32";else if(s.endsWith("b"))o="bool";else{if(!s.endsWith("h"))return console.error(`Unknown vector type ${s}. Line ${e.line}`),null;o="f16"}const l=i.getTypeName();let u="";if(l.endsWith("f"))u="f32";else if(l.endsWith("i"))u="i32";else if(l.endsWith("u"))u="u32";else if(l.endsWith("b"))u="bool";else{if(!l.endsWith("h"))return console.error(`Unknown vector type ${u}. Line ${e.line}`),null;u="f16"}const h=(function(d,g,y){if(g===y)return d;const b=new Array(d.length);for(let w=0;w<d.length;w++)b[w]=NR(d[w],g,y);return b})(Array.from(r.data),o,u);return new $(h,this.getTypeInfo(i))}return console.error(`TODO: bitcast for ${r.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var r;if(e instanceof Li){if(e.type===null)return uT.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}const i=e instanceof Li?e.type.name:e.name,s=e instanceof Li?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(s===null)return console.error(`Unknown type ${i}. Line ${e.line}`),null;if(s.size===0)return null;const o=new $t(new ArrayBuffer(s.size),s,0);if(s instanceof Yo){if(e.args)for(let l=0;l<e.args.length;++l){const u=s.members[l],h=e.args[l],d=this.evalExpression(h,t);o.setData(this,d,u.type,u.offset,t)}}else if(s instanceof sa){let l=0;if(e.args)for(let u=0;u<e.args.length;++u){const h=e.args[u],d=this.evalExpression(h,t);s.format===null&&(((r=d.typeInfo)===null||r===void 0?void 0:r.name)==="x32"?s.format=this.getTypeInfo("i32"):s.format=d.typeInfo),o.setData(this,d,s.format,l,t),l+=s.stride}}else console.error(`Unknown type "${i}". Line ${e.line}`);return e instanceof Li?o.getSubData(this,e.postfix,t):o}_evalLiteral(e,t){const r=this.getTypeInfo(e.type),i=r.name;return i==="x32"||i==="u32"||i==="f32"||i==="f16"||i==="i32"||i==="bool"?new J(e.scalarValue,r):i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"?this._callConstructorVec(e,t):i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const r=t.getVariableValue(e.name);return r===null?r:r.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if(t.name==="f32")return t;for(let r=1;r<e.length;++r){const i=$n._priority.get(t.name);$n._priority.get(e[r].name)<i&&(t=e[r])}return t.name==="x32"?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const r=this.evalExpression(e.right,t);if(e.operator==="&")return new Oc(r);if(e.operator==="*")return r instanceof Oc?r.reference.getSubData(this,e.postfix,t):(console.error(`Invalid dereference. Line ${e.line}`),null);const i=r instanceof J?r.value:r instanceof $?Array.from(r.data):null;switch(e.operator){case"+":{if(Re(i)){const l=i.map((u,h)=>+u);return new $(l,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new J(+s,o)}case"-":{if(Re(i)){const l=i.map((u,h)=>-u);return new $(l,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new J(-s,o)}case"!":{if(Re(i)){const l=i.map((u,h)=>u?0:1);return new $(l,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new J(s?0:1,o)}case"~":{if(Re(i)){const l=i.map((u,h)=>~u);return new $(l,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new J(~s,o)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){const r=this.evalExpression(e.left,t),i=this.evalExpression(e.right,t),s=r instanceof J?r.value:r instanceof $||r instanceof Ve?Array.from(r.data):null,o=i instanceof J?i.value:i instanceof $||i instanceof Ve?Array.from(i.data):null;switch(e.operator){case"+":{if(Re(s)&&Re(o)){const d=s,g=o;if(d.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=d.map((b,w)=>b+g[w]);return new $(y,r.typeInfo)}if(Re(s)){const d=o,g=s.map((y,b)=>y+d);return new $(g,r.typeInfo)}if(Re(o)){const d=s,g=o.map((y,b)=>d+y);return new $(g,i.typeInfo)}const l=s,u=o,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new J(l+u,h)}case"-":{if(Re(s)&&Re(o)){const d=s,g=o;if(d.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=d.map((b,w)=>b-g[w]);return new $(y,r.typeInfo)}if(Re(s)){const d=o,g=s.map((y,b)=>y-d);return new $(g,r.typeInfo)}if(Re(o)){const d=s,g=o.map((y,b)=>d-y);return new $(g,i.typeInfo)}const l=s,u=o,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new J(l-u,h)}case"*":{if(Re(s)&&Re(o)){const d=s,g=o;if(r instanceof Ve&&i instanceof Ve){const y=(function(x,C,M,O){if(nr[C.name]===void 0||nr[O.name]===void 0)return null;const V=nr[C.name][0],H=nr[C.name][1],G=nr[O.name][0];if(V!==nr[O.name][1])return null;const D=new Array(G*H);for(let I=0;I<H;I++)for(let N=0;N<G;N++){let j=0;for(let W=0;W<V;W++)j+=x[W*H+I]*M[N*V+W];D[I*G+N]=j}return D})(d,r.typeInfo,g,i.typeInfo);if(y===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const b=nr[i.typeInfo.name][0],w=nr[r.typeInfo.name][1],E=this.getTypeInfo(`mat${b}x${w}f`);return new Ve(y,E)}if(r instanceof Ve&&i instanceof $){const y=(function(b,w,E,x){if(nr[w.name]===void 0||$b[x.name]===void 0)return null;const C=nr[w.name][0],M=nr[w.name][1];if(C!==E.length)return null;const O=new Array(M);for(let V=0;V<M;V++){let H=0;for(let G=0;G<C;G++)H+=b[G*M+V]*E[G];O[V]=H}return O})(d,r.typeInfo,g,i.typeInfo);return y===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new $(y,i.typeInfo)}if(r instanceof $&&i instanceof Ve){const y=(function(b,w,E,x){if($b[w.name]===void 0||nr[x.name]===void 0)return null;const C=nr[x.name][0],M=nr[x.name][1];if(M!==b.length)return null;const O=[];for(let V=0;V<C;V++){let H=0;for(let G=0;G<M;G++)H+=b[G]*E[G*C+V];O[V]=H}return O})(d,r.typeInfo,g,i.typeInfo);return y===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new $(y,r.typeInfo)}{if(d.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=d.map((b,w)=>b*g[w]);return new $(y,r.typeInfo)}}if(Re(s)){const d=o,g=s.map((y,b)=>y*d);return r instanceof Ve?new Ve(g,r.typeInfo):new $(g,r.typeInfo)}if(Re(o)){const d=s,g=o.map((y,b)=>d*y);return i instanceof Ve?new Ve(g,i.typeInfo):new $(g,i.typeInfo)}const l=s,u=o,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new J(l*u,h)}case"%":{if(Re(s)&&Re(o)){const d=s,g=o;if(d.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=d.map((b,w)=>b%g[w]);return new $(y,r.typeInfo)}if(Re(s)){const d=o,g=s.map((y,b)=>y%d);return new $(g,r.typeInfo)}if(Re(o)){const d=s,g=o.map((y,b)=>d%y);return new $(g,i.typeInfo)}const l=s,u=o,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new J(l%u,h)}case"/":{if(Re(s)&&Re(o)){const d=s,g=o;if(d.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=d.map((b,w)=>b/g[w]);return new $(y,r.typeInfo)}if(Re(s)){const d=o,g=s.map((y,b)=>y/d);return new $(g,r.typeInfo)}if(Re(o)){const d=s,g=o.map((y,b)=>d/y);return new $(g,i.typeInfo)}const l=s,u=o,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new J(l/u,h)}case"&":{if(Re(s)&&Re(o)){const d=s,g=o;if(d.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=d.map((b,w)=>b&g[w]);return new $(y,r.typeInfo)}if(Re(s)){const d=o,g=s.map((y,b)=>y&d);return new $(g,r.typeInfo)}if(Re(o)){const d=s,g=o.map((y,b)=>d&y);return new $(g,i.typeInfo)}const l=s,u=o,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new J(l&u,h)}case"|":{if(Re(s)&&Re(o)){const d=s,g=o;if(d.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=d.map((b,w)=>b|g[w]);return new $(y,r.typeInfo)}if(Re(s)){const d=o,g=s.map((y,b)=>y|d);return new $(g,r.typeInfo)}if(Re(o)){const d=s,g=o.map((y,b)=>d|y);return new $(g,i.typeInfo)}const l=s,u=o,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new J(l|u,h)}case"^":{if(Re(s)&&Re(o)){const d=s,g=o;if(d.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=d.map((b,w)=>b^g[w]);return new $(y,r.typeInfo)}if(Re(s)){const d=o,g=s.map((y,b)=>y^d);return new $(g,r.typeInfo)}if(Re(o)){const d=s,g=o.map((y,b)=>d^y);return new $(g,i.typeInfo)}const l=s,u=o,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new J(l^u,h)}case"<<":{if(Re(s)&&Re(o)){const d=s,g=o;if(d.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=d.map((b,w)=>b<<g[w]);return new $(y,r.typeInfo)}if(Re(s)){const d=o,g=s.map((y,b)=>y<<d);return new $(g,r.typeInfo)}if(Re(o)){const d=s,g=o.map((y,b)=>d<<y);return new $(g,i.typeInfo)}const l=s,u=o,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new J(l<<u,h)}case">>":{if(Re(s)&&Re(o)){const d=s,g=o;if(d.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=d.map((b,w)=>b>>g[w]);return new $(y,r.typeInfo)}if(Re(s)){const d=o,g=s.map((y,b)=>y>>d);return new $(g,r.typeInfo)}if(Re(o)){const d=s,g=o.map((y,b)=>d>>y);return new $(g,i.typeInfo)}const l=s,u=o,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new J(l>>u,h)}case">":if(Re(s)&&Re(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=l.map((d,g)=>d>u[g]?1:0);return new $(h,r.typeInfo)}if(Re(s)){const l=o,u=s.map((h,d)=>h>l?1:0);return new $(u,r.typeInfo)}if(Re(o)){const l=s,u=o.map((h,d)=>l>h?1:0);return new $(u,i.typeInfo)}return new J(s>o?1:0,this.getTypeInfo("bool"));case"<":if(Re(s)&&Re(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=l.map((d,g)=>d<u[g]?1:0);return new $(h,r.typeInfo)}if(Re(s)){const l=o,u=s.map((h,d)=>h<l?1:0);return new $(u,r.typeInfo)}if(Re(o)){const l=s,u=o.map((h,d)=>l<h?1:0);return new $(u,i.typeInfo)}return new J(s<o?1:0,this.getTypeInfo("bool"));case"==":if(Re(s)&&Re(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=l.map((d,g)=>d===u[g]?1:0);return new $(h,r.typeInfo)}if(Re(s)){const l=o,u=s.map((h,d)=>h==l?1:0);return new $(u,r.typeInfo)}if(Re(o)){const l=s,u=o.map((h,d)=>l==h?1:0);return new $(u,i.typeInfo)}return new J(s===o?1:0,this.getTypeInfo("bool"));case"!=":if(Re(s)&&Re(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=l.map((d,g)=>d!==u[g]?1:0);return new $(h,r.typeInfo)}if(Re(s)){const l=o,u=s.map((h,d)=>h!==l?1:0);return new $(u,r.typeInfo)}if(Re(o)){const l=s,u=o.map((h,d)=>l!==h?1:0);return new $(u,i.typeInfo)}return new J(s!==o?1:0,this.getTypeInfo("bool"));case">=":if(Re(s)&&Re(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=l.map((d,g)=>d>=u[g]?1:0);return new $(h,r.typeInfo)}if(Re(s)){const l=o,u=s.map((h,d)=>h>=l?1:0);return new $(u,r.typeInfo)}if(Re(o)){const l=s,u=o.map((h,d)=>l>=h?1:0);return new $(u,i.typeInfo)}return new J(s>=o?1:0,this.getTypeInfo("bool"));case"<=":if(Re(s)&&Re(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=l.map((d,g)=>d<=u[g]?1:0);return new $(h,r.typeInfo)}if(Re(s)){const l=o,u=s.map((h,d)=>h<=l?1:0);return new $(u,r.typeInfo)}if(Re(o)){const l=s,u=o.map((h,d)=>l<=h?1:0);return new $(u,i.typeInfo)}return new J(s<=o?1:0,this.getTypeInfo("bool"));case"&&":if(Re(s)&&Re(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=l.map((d,g)=>d&&u[g]?1:0);return new $(h,r.typeInfo)}if(Re(s)){const l=o,u=s.map((h,d)=>h&&l?1:0);return new $(u,r.typeInfo)}if(Re(o)){const l=s,u=o.map((h,d)=>l&&h?1:0);return new $(u,i.typeInfo)}return new J(s&&o?1:0,this.getTypeInfo("bool"));case"||":if(Re(s)&&Re(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=l.map((d,g)=>d||u[g]?1:0);return new $(h,r.typeInfo)}if(Re(s)){const l=o,u=s.map((h,d)=>h||l?1:0);return new $(u,r.typeInfo)}if(Re(o)){const l=s,u=o.map((h,d)=>l||h?1:0);return new $(u,i.typeInfo)}return new J(s||o?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const r=t.clone();r.currentFunctionName=e.name;const i=t.getFunction(e.name);if(!i)return e.isBuiltin?this._callBuiltinFunction(e,r):this.getTypeInfo(e.name)?this._evalCreate(e,t):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let s=0;s<i.node.args.length;++s){const o=i.node.args[s],l=this.evalExpression(e.args[s],r);r.createVariable(o.name,l,o)}return this._execStatements(i.node.body,r)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothstep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const r=t.getFunction(e.name);if(r){const i=t.clone();for(let s=0;s<r.node.args.length;++s){const o=r.node.args[s],l=this.evalExpression(e.args[s],i);i.setVariable(o.name,l,o)}return this._execStatements(r.node.body,i)}return null}_callConstructorValue(e,t){if(!e.args||e.args.length===0)return new J(0,this.getTypeInfo(e.type));const r=this.evalExpression(e.args[0],t);return r.typeInfo=this.getTypeInfo(e.type),r.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){const r=this.getTypeInfo(e.type),i=e.type.getTypeName(),s=$b[i];if(s===void 0)return console.error(`Invalid vec constructor ${i}. Line ${e.line}`),null;const o=[];if(e instanceof fn)if(e.isVector){const l=e.vectorValue;for(const u of l)o.push(u)}else o.push(e.scalarValue);else if(e.args)for(const l of e.args){const u=this.evalExpression(l,t);if(u instanceof $){const h=u.data;for(let d=0;d<h.length;++d){let g=h[d];o.push(g)}}else if(u instanceof J){let h=u.value;o.push(h)}}if(e.type instanceof re&&e.type.format===null&&(e.type.format=re.f32),o.length===0){const l=new Array(s).fill(0);return new $(l,r).getSubData(this,e.postfix,t)}if(o.length===1)for(;o.length<s;)o.push(o[0]);return o.length<s?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new $(o.length>s?o.slice(0,s):o,r).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){const r=this.getTypeInfo(e.type),i=e.type.getTypeName(),s=nr[i];if(s===void 0)return console.error(`Invalid matrix constructor ${i}. Line ${e.line}`),null;const o=[];if(e instanceof fn)if(e.isVector){const l=e.vectorValue;for(const u of l)o.push(u)}else o.push(e.scalarValue);else if(e.args)for(const l of e.args){const u=this.evalExpression(l,t);u instanceof $?o.push(...u.data):u instanceof J?o.push(u.value):u instanceof Ve&&o.push(...u.data)}if(r instanceof El&&r.format===null&&(r.format=this.getTypeInfo("f32")),o.length===0){const l=new Array(s[2]).fill(0);return new Ve(l,r).getSubData(this,e.postfix,t)}return o.length!==s[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new Ve(o,r).getSubData(this,e.postfix,t)}}$n._breakObj=new Xr(new $r("BREAK",null),null),$n._continueObj=new Xr(new $r("CONTINUE",null),null),$n._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class YG{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class KG{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new YG,this._exec=new $n,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const r=this._global_decl_or_directive();if(!r)break;t.push(r)}if(this._deferArrayCountEval.length>0){for(const r of this._deferArrayCountEval){const i=r.arrayType,s=r.countNode;if(s instanceof Ar){const o=s.name,l=this._context.constants.get(o);if(l)try{const u=l.constEvaluate(this._exec);i.count=u}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const r of t)r.search(i=>{i instanceof OR||i instanceof nm?i.type=this._forwardType(i.type):i instanceof Of?i.format=this._forwardType(i.format):i instanceof Rs||i instanceof Mf||i instanceof tm?i.type=this._forwardType(i.type):i instanceof td?i.returnType=this._forwardType(i.returnType):i instanceof MR&&(i.type=this._forwardType(i.type))});return t}_forwardType(e){if(e instanceof PR){const t=this._getType(e.name);if(t)return t}else e instanceof nm?e.type=this._forwardType(e.type):e instanceof Of&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const t=new FG(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=t??this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==B.eof}_match(e){if(e instanceof te)return!!this._check(e)&&(this._advance(),!0);for(let t=0,r=e.length;t<r;++t){const i=e[t];if(this._check(i))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const r=t.type;let i=!1;for(const s of e){if(r===s)return!0;s===B.tokens.name&&(i=!0)}if(i){const s=B.tokens.name.rule.exec(t.lexeme);if(s&&s.index==0&&s[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===B.tokens.name){const r=B.tokens.name.rule.exec(t.lexeme);return r&&r.index==0&&r[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=(t=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&t!==void 0?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(B.tokens.semicolon)&&!this._isAtEnd(););if(this._match(B.keywords.alias)){const t=this._type_alias();return this._consume(B.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(B.keywords.diagnostic)){const t=this._diagnostic();return this._consume(B.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(B.keywords.requires)){const t=this._requires_directive();return this._consume(B.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(B.keywords.enable)){const t=this._enable_directive();return this._consume(B.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}const e=this._attribute();if(this._check(B.keywords.var)){const t=this._global_variable_decl();return t!=null&&(t.attributes=e),this._consume(B.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(B.keywords.override)){const t=this._override_variable_decl();return t!=null&&(t.attributes=e),this._consume(B.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(B.keywords.let)){const t=this._global_let_decl();return t!=null&&(t.attributes=e),this._consume(B.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(B.keywords.const)){const t=this._global_const_decl();return t!=null&&(t.attributes=e),this._consume(B.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(B.keywords.struct)){const t=this._struct_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(B.keywords.fn)){const t=this._function_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(B.keywords.fn))return null;const e=this._currentLine,t=this._consume(B.tokens.ident,"Expected function name.").toString();this._consume(B.tokens.paren_left,"Expected '(' for function arguments.");const r=[];if(!this._check(B.tokens.paren_right))do{if(this._check(B.tokens.paren_right))break;const l=this._attribute(),u=this._consume(B.tokens.name,"Expected argument name.").toString();this._consume(B.tokens.colon,"Expected ':' for argument type.");const h=this._attribute(),d=this._type_decl();d!=null&&(d.attributes=h,r.push(this._updateNode(new MR(u,d,l))))}while(this._match(B.tokens.comma));this._consume(B.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(B.tokens.arrow)){const l=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=l)}const s=this._compound_statement(),o=this._currentLine;return this._updateNode(new td(t,r,i,s,e,o),e)}_compound_statement(){const e=[];for(this._consume(B.tokens.brace_left,"Expected '{' for block.");!this._check(B.tokens.brace_right);){const t=this._statement();t!==null&&e.push(t)}return this._consume(B.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(B.tokens.semicolon)&&!this._isAtEnd(););if(this._check(B.tokens.attr)&&this._attribute(),this._check(B.keywords.if))return this._if_statement();if(this._check(B.keywords.switch))return this._switch_statement();if(this._check(B.keywords.loop))return this._loop_statement();if(this._check(B.keywords.for))return this._for_statement();if(this._check(B.keywords.while))return this._while_statement();if(this._check(B.keywords.continuing))return this._continuing_statement();if(this._check(B.keywords.static_assert))return this._static_assert_statement();if(this._check(B.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(B.keywords.return))e=this._return_statement();else if(this._check([B.keywords.var,B.keywords.let,B.keywords.const]))e=this._variable_statement();else if(this._match(B.keywords.discard))e=this._updateNode(new DG);else if(this._match(B.keywords.break)){const t=this._updateNode(new d4);if(this._currentLoop.length>0){const r=this._currentLoop[this._currentLoop.length-1];t.loopId=r.id}e=t,this._check(B.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(B.keywords.continue)){const t=this._updateNode(new p4);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{const r=this._currentLoop[this._currentLoop.length-1];t.loopId=r.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(B.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(B.keywords.static_assert))return null;const e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new OG(t),e)}_while_statement(){if(!this._match(B.keywords.while))return null;const e=this._updateNode(new i4(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(B.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(B.keywords.continuing))return null;const t=this._currentLine,r=this._compound_statement();return this._updateNode(new cT(r,e),t)}_for_statement(){if(!this._match(B.keywords.for))return null;this._consume(B.tokens.paren_left,"Expected '('.");const e=this._updateNode(new s4(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(B.tokens.semicolon)?null:this._for_init(),this._consume(B.tokens.semicolon,"Expected ';'."),e.condition=this._check(B.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(B.tokens.semicolon,"Expected ';'."),e.increment=this._check(B.tokens.paren_right)?null:this._for_increment(),this._consume(B.tokens.paren_right,"Expected ')'."),this._check(B.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(B.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(B.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new Rs(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(B.keywords.let)){const e=this._currentLine,t=this._consume(B.tokens.name,"Expected name for let.").toString();let r=null;if(this._match(B.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}this._consume(B.tokens.equal,"Expected '=' for let.");const i=this._short_circuit_or_expression();return this._updateNode(new Mf(t,r,null,null,i),e)}if(this._match(B.keywords.const)){const e=this._currentLine,t=this._consume(B.tokens.name,"Expected name for const.").toString();let r=null;if(this._match(B.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}this._consume(B.tokens.equal,"Expected '=' for const.");const i=this._short_circuit_or_expression();return r===null&&i instanceof fn&&(r=i.type),this._updateNode(new tm(t,r,null,null,i),e)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(t==null)return null;if(!this._check(B.increment_operators))return this._current=e,null;const r=this._consume(B.increment_operators,"Expected increment operator");return this._updateNode(new o4(r.type===B.tokens.plus_plus?Hc.increment:Hc.decrement,t))}_assignment_statement(){let e=null;const t=this._currentLine;if(this._check(B.tokens.brace_right))return null;let r=this._match(B.tokens.underscore);if(r||(e=this._unary_expression()),!r&&e==null)return null;const i=this._consume(B.assignment_operators,"Expected assignment operator."),s=this._short_circuit_or_expression();return this._updateNode(new a4(mf.parse(i.lexeme),e,s),t)}_func_call_statement(){if(!this._check(B.tokens.ident))return null;const e=this._currentLine,t=this._current,r=this._consume(B.tokens.ident,"Expected function name."),i=this._argument_expression_list();return i===null?(this._current=t,null):this._updateNode(new xE(r.lexeme,i),e)}_loop_statement(){if(!this._match(B.keywords.loop))return null;this._check(B.tokens.attr)&&this._attribute(),this._consume(B.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new l4([],null));this._currentLoop.push(e);let t=this._statement();for(;t!==null;){if(Array.isArray(t))for(let r of t)e.body.push(r);else e.body.push(t);if(t instanceof cT){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(B.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(B.keywords.switch))return null;const e=this._updateNode(new c4(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(B.tokens.attr)&&this._attribute(),this._consume(B.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(B.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([B.keywords.default,B.keywords.case]);){if(this._match(B.keywords.case)){const r=this._case_selectors();for(const s of r)if(s instanceof rm){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(B.tokens.colon),this._check(B.tokens.attr)&&this._attribute(),this._consume(B.tokens.brace_left,"Exected '{' for switch case.");const i=this._case_body();this._consume(B.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new v4(r,i)))}if(this._match(B.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(B.tokens.colon),this._check(B.tokens.attr)&&this._attribute(),this._consume(B.tokens.brace_left,"Exected '{' for switch default.");const r=this._case_body();this._consume(B.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new b4(r)))}}return e}_case_selectors(){const e=[];for(this._match(B.keywords.default)?e.push(this._updateNode(new rm)):e.push(this._shift_expression());this._match(B.tokens.comma);)this._match(B.keywords.default)?e.push(this._updateNode(new rm)):e.push(this._shift_expression());return e}_case_body(){if(this._match(B.keywords.fallthrough))return this._consume(B.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const t=this._case_body();return t.length==0?e:[...e,t[0]]}_if_statement(){if(!this._match(B.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(B.tokens.attr)&&this._attribute();const r=this._compound_statement();let i=[];this._match_elseif()&&(this._check(B.tokens.attr)&&this._attribute(),i=this._elseif_statement(i));let s=null;return this._match(B.keywords.else)&&(this._check(B.tokens.attr)&&this._attribute(),s=this._compound_statement()),this._updateNode(new u4(t,r,i,s),e)}_match_elseif(){return this._tokens[this._current].type===B.keywords.else&&this._tokens[this._current+1].type===B.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const t=this._optional_paren_expression(),r=this._compound_statement();return e.push(this._updateNode(new LG(t,r))),this._match_elseif()&&(this._check(B.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(B.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new h4(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(B.tokens.or_or);)e=this._updateNode(new oi(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(B.tokens.and_and);)e=this._updateNode(new oi(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(B.tokens.or);)e=this._updateNode(new oi(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(B.tokens.xor);)e=this._updateNode(new oi(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(B.tokens.and);)e=this._updateNode(new oi(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([B.tokens.equal_equal,B.tokens.not_equal])?this._updateNode(new oi(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([B.tokens.less_than,B.tokens.greater_than,B.tokens.less_than_equal,B.tokens.greater_than_equal]);)e=this._updateNode(new oi(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([B.tokens.shift_left,B.tokens.shift_right]);)e=this._updateNode(new oi(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([B.tokens.plus,B.tokens.minus]);)e=this._updateNode(new oi(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([B.tokens.star,B.tokens.forward_slash,B.tokens.modulo]);)e=this._updateNode(new oi(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([B.tokens.minus,B.tokens.bang,B.tokens.tilde,B.tokens.star,B.tokens.and])?this._updateNode(new nn(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(B.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(B.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new Tu(e)),r=this._postfix_expression();return r&&(t.postfix=r),t}if(this._match(B.tokens.period)){const e=this._consume(B.tokens.name,"Expected member name."),t=this._postfix_expression(),r=this._updateNode(new xl(e.lexeme));return t&&(r.postfix=t),r}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(t!==null)return t;switch(e){case"void":return ye.void;case"bool":return ye.bool;case"i32":return ye.i32;case"u32":return ye.u32;case"f32":return ye.f32;case"f16":return ye.f16;case"vec2f":return re.vec2f;case"vec3f":return re.vec3f;case"vec4f":return re.vec4f;case"vec2i":return re.vec2i;case"vec3i":return re.vec3i;case"vec4i":return re.vec4i;case"vec2u":return re.vec2u;case"vec3u":return re.vec3u;case"vec4u":return re.vec4u;case"vec2h":return re.vec2h;case"vec3h":return re.vec3h;case"vec4h":return re.vec4h;case"mat2x2f":return re.mat2x2f;case"mat2x3f":return re.mat2x3f;case"mat2x4f":return re.mat2x4f;case"mat3x2f":return re.mat3x2f;case"mat3x3f":return re.mat3x3f;case"mat3x4f":return re.mat3x4f;case"mat4x2f":return re.mat4x2f;case"mat4x3f":return re.mat4x3f;case"mat4x4f":return re.mat4x4f;case"mat2x2h":return re.mat2x2h;case"mat2x3h":return re.mat2x3h;case"mat2x4h":return re.mat2x4h;case"mat3x2h":return re.mat3x2h;case"mat3x3h":return re.mat3x3h;case"mat3x4h":return re.mat3x4h;case"mat4x2h":return re.mat4x2h;case"mat4x3h":return re.mat4x3h;case"mat4x4h":return re.mat4x4h;case"mat2x2i":return re.mat2x2i;case"mat2x3i":return re.mat2x3i;case"mat2x4i":return re.mat2x4i;case"mat3x2i":return re.mat3x2i;case"mat3x3i":return re.mat3x3i;case"mat3x4i":return re.mat3x4i;case"mat4x2i":return re.mat4x2i;case"mat4x3i":return re.mat4x3i;case"mat4x4i":return re.mat4x4i;case"mat2x2u":return re.mat2x2u;case"mat2x3u":return re.mat2x3u;case"mat2x4u":return re.mat2x4u;case"mat3x2u":return re.mat3x2u;case"mat3x3u":return re.mat3x3u;case"mat3x4u":return re.mat3x4u;case"mat4x2u":return re.mat4x2u;case"mat4x3u":return re.mat4x3u;case"mat4x4u":return re.mat4x4u}return null}_validateTypeRange(e,t){if(t.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(t.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(B.tokens.ident)){const r=this._previous().toString();if(this._check(B.tokens.paren_left)){const i=this._argument_expression_list(),s=this._getType(r);return s!==null?this._updateNode(new Li(s,i)):this._updateNode(new SE(r,i))}if(this._context.constants.has(r)){const i=this._context.constants.get(r);return this._updateNode(new g4(r,i.value))}return this._updateNode(new Ar(r))}if(this._match(B.tokens.int_literal)){const r=this._previous().toString();let i=r.endsWith("i")||r.endsWith("i")?ye.i32:r.endsWith("u")||r.endsWith("U")?ye.u32:ye.x32;const s=parseInt(r);return this._validateTypeRange(s,i),this._updateNode(new fn(new J(s,this._exec.getTypeInfo(i)),i))}if(this._match(B.tokens.uint_literal)){const r=parseInt(this._previous().toString());return this._validateTypeRange(r,ye.u32),this._updateNode(new fn(new J(r,this._exec.getTypeInfo(ye.u32)),ye.u32))}if(this._match([B.tokens.decimal_float_literal,B.tokens.hex_float_literal])){let r=this._previous().toString(),i=r.endsWith("h");i&&(r=r.substring(0,r.length-1));const s=parseFloat(r);this._validateTypeRange(s,i?ye.f16:ye.f32);const o=i?ye.f16:ye.f32;return this._updateNode(new fn(new J(s,this._exec.getTypeInfo(o)),o))}if(this._match([B.keywords.true,B.keywords.false])){let r=this._previous().toString()===B.keywords.true.rule;return this._updateNode(new fn(new J(r?1:0,this._exec.getTypeInfo(ye.bool)),ye.bool))}if(this._check(B.tokens.paren_left))return this._paren_expression();if(this._match(B.keywords.bitcast)){this._consume(B.tokens.less_than,"Expected '<'.");const r=this._type_decl();this._consume(B.tokens.greater_than,"Expected '>'.");const i=this._paren_expression();return this._updateNode(new m4(r,i))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new Li(e,t))}_argument_expression_list(){if(!this._match(B.tokens.paren_left))return null;const e=[];do{if(this._check(B.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(B.tokens.comma));return this._consume(B.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(B.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(B.tokens.paren_right),e}_paren_expression(){this._consume(B.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(B.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(B.keywords.struct))return null;const e=this._currentLine,t=this._consume(B.tokens.ident,"Expected name for struct.").toString();this._consume(B.tokens.brace_left,"Expected '{' for struct body.");const r=[];for(;!this._check(B.tokens.brace_right);){const o=this._attribute(),l=this._consume(B.tokens.name,"Expected variable name.").toString();this._consume(B.tokens.colon,"Expected ':' for struct member type.");const u=this._attribute(),h=this._type_decl();h!=null&&(h.attributes=u),this._check(B.tokens.brace_right)?this._match(B.tokens.comma):this._consume(B.tokens.comma,"Expected ',' for struct member."),r.push(this._updateNode(new OR(l,h,o)))}this._consume(B.tokens.brace_right,"Expected '}' after struct body.");const i=this._currentLine,s=this._updateNode(new As(t,r,e,i),e);return this._context.structs.set(t,s),s}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(B.tokens.equal)){const t=this._const_expression();e.value=t}if(e.type!==null&&e.value instanceof fn){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof fn&&(e.type=e.value.type.name==="x32"?ye.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(B.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(B.keywords.const))return null;const t=this._consume(B.tokens.name,"Expected variable name"),r=this._currentLine;let i=null;if(this._match(B.tokens.colon)){const u=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=u)}let s=null;this._consume(B.tokens.equal,"const declarations require an assignment");const o=this._short_circuit_or_expression();try{let u=[ye.f32],h=o.constEvaluate(this._exec,u);h instanceof J&&this._validateTypeRange(h.value,u[0]),u[0]instanceof re&&u[0].format===null&&h.typeInfo instanceof El&&h.typeInfo.format!==null&&(h.typeInfo.format.name==="f16"?u[0].format=ye.f16:h.typeInfo.format.name==="f32"?u[0].format=ye.f32:h.typeInfo.format.name==="i32"?u[0].format=ye.i32:h.typeInfo.format.name==="u32"?u[0].format=ye.u32:h.typeInfo.format.name==="bool"?u[0].format=ye.bool:console.error(`TODO: impelement template format type ${h.typeInfo.format.name}`)),s=this._updateNode(new fn(h,u[0])),this._exec.context.setVariable(t.toString(),h)}catch{s=o}if(i!==null&&s instanceof fn){if(s.type.name!=="x32"&&i.getTypeName()!==s.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${s.type.name} to ${i.name}. Line:${this._currentLine}`);s.type=i,s.isScalar&&this._validateTypeRange(s.scalarValue,s.type)}else i===null&&s instanceof fn&&(i=(e=s?.type)!==null&&e!==void 0?e:ye.f32,i===ye.x32&&(i=ye.i32));const l=this._updateNode(new tm(t.toString(),i,"","",s),r);return this._context.constants.set(l.name,l),l}_global_let_decl(){if(!this._match(B.keywords.let))return null;const e=this._currentLine,t=this._consume(B.tokens.name,"Expected variable name");let r=null;if(this._match(B.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}let i=null;if(this._match(B.tokens.equal)&&(i=this._const_expression()),r!==null&&i instanceof fn){if(i.type.name!=="x32"&&r.getTypeName()!==i.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${i.type.name} to ${r.name}. Line:${this._currentLine}`);i.type=r}else r===null&&i instanceof fn&&(r=i.type.name==="x32"?ye.i32:i.type);return i instanceof fn&&i.isScalar&&this._validateTypeRange(i.scalarValue,r),this._updateNode(new Mf(t.toString(),r,"","",i),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(B.keywords.var))return null;const e=this._currentLine;let t="",r="";this._match(B.tokens.less_than)&&(t=this._consume(B.storage_class,"Expected storage_class.").toString(),this._match(B.tokens.comma)&&(r=this._consume(B.access_mode,"Expected access_mode.").toString()),this._consume(B.tokens.greater_than,"Expected '>'."));const i=this._consume(B.tokens.name,"Expected variable name");let s=null;if(this._match(B.tokens.colon)){const o=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=o)}return this._updateNode(new Rs(i.toString(),s,t,r,null),e)}_override_decl(){if(!this._match(B.keywords.override))return null;const e=this._consume(B.tokens.name,"Expected variable name");let t=null;if(this._match(B.tokens.colon)){const r=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=r)}return this._updateNode(new EE(e.toString(),t,null))}_diagnostic(){this._consume(B.tokens.paren_left,"Expected '('");const e=this._consume(B.tokens.ident,"Expected severity control name.");this._consume(B.tokens.comma,"Expected ','");let t=this._consume(B.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(B.tokens.period)&&(t+=`.${this._consume(B.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(B.tokens.paren_right,"Expected ')'"),this._updateNode(new f4(e.toString(),t))}_enable_directive(){const e=this._consume(B.tokens.ident,"identity expected.");return this._updateNode(new kG(e.toString()))}_requires_directive(){const e=[this._consume(B.tokens.ident,"identity expected.").toString()];for(;this._match(B.tokens.comma);){const t=this._consume(B.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new NG(e))}_type_alias(){const e=this._consume(B.tokens.ident,"identity expected.");this._consume(B.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(t===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const r=this._updateNode(new AE(e.toString(),t));return this._context.aliases.set(r.name,r),r}_type_decl(){if(this._check([B.tokens.ident,...B.texel_format,B.keywords.bool,B.keywords.f32,B.keywords.i32,B.keywords.u32])){const r=this._advance().toString();if(this._context.structs.has(r))return this._context.structs.get(r);if(this._context.aliases.has(r))return this._context.aliases.get(r).type;if(!this._getType(r)){const i=this._updateNode(new PR(r));return this._forwardTypeCount++,i}return this._updateNode(new ye(r))}let e=this._texture_sampler_types();if(e)return e;if(this._check(B.template_types)){let r=this._advance().toString(),i=null,s=null;return this._match(B.tokens.less_than)&&(i=this._type_decl(),s=null,this._match(B.tokens.comma)&&(s=this._consume(B.access_mode,"Expected access_mode for pointer").toString()),this._consume(B.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new re(r,i,s))}if(this._match(B.keywords.ptr)){let r=this._previous().toString();this._consume(B.tokens.less_than,"Expected '<' for pointer.");const i=this._consume(B.storage_class,"Expected storage_class for pointer");this._consume(B.tokens.comma,"Expected ',' for pointer.");const s=this._type_decl();let o=null;return this._match(B.tokens.comma)&&(o=this._consume(B.access_mode,"Expected access_mode for pointer").toString()),this._consume(B.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new nm(r,i.toString(),s,o))}const t=this._attribute();if(this._match(B.keywords.array)){let r=null,i=-1;const s=this._previous();let o=null;if(this._match(B.tokens.less_than)){r=this._type_decl(),this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let u="";if(this._match(B.tokens.comma)){o=this._shift_expression();try{u=o.constEvaluate(this._exec).toString(),o=null}catch{u="1"}}this._consume(B.tokens.greater_than,"Expected '>' for array."),i=u?parseInt(u):0}const l=this._updateNode(new Of(s.toString(),t,r,i));return o&&this._deferArrayCountEval.push({arrayType:l,countNode:o}),l}return null}_texture_sampler_types(){if(this._match(B.sampler_type))return this._updateNode(new _f(this._previous().toString(),null,null));if(this._match(B.depth_texture_type))return this._updateNode(new _f(this._previous().toString(),null,null));if(this._match(B.sampled_texture_type)||this._match(B.multisampled_texture_type)){const e=this._previous();this._consume(B.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(B.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new _f(e.toString(),t,null))}if(this._match(B.storage_texture_type)){const e=this._previous();this._consume(B.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(B.texel_format,"Invalid texel format.").toString();this._consume(B.tokens.comma,"Expected ',' after texel format.");const r=this._consume(B.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(B.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new _f(e.toString(),t,r))}return null}_attribute(){let e=[];for(;this._match(B.tokens.attr);){const t=this._consume(B.attribute_name,"Expected attribute name"),r=this._updateNode(new T4(t.toString(),null));if(this._match(B.tokens.paren_left)){if(r.value=this._consume(B.literal_or_ident,"Expected attribute value").toString(),this._check(B.tokens.comma)){this._advance();do{const i=this._consume(B.literal_or_ident,"Expected attribute value").toString();r.value instanceof Array||(r.value=[r.value]),r.value.push(i)}while(this._match(B.tokens.comma))}this._consume(B.tokens.paren_right,"Expected ')'")}e.push(r)}return e.length==0?null:e}}class GG extends Vi{constructor(e){super(),e&&this.update(e)}update(e){const t=new KG().parse(e);this.updateAST(t)}}function ZG(n){const e={attributes:[],bindings:[]};let t;try{t=QG(n)}catch(s){return we.error(s.message)(),e}for(const s of t.uniforms){const o=[];for(const l of s.type?.members||[])o.push({name:l.name,type:DR(l.type)});e.bindings.push({type:"uniform",name:s.name,group:s.group,location:s.binding,members:o})}for(const s of t.textures)e.bindings.push({type:"texture",name:s.name,group:s.group,location:s.binding});for(const s of t.samplers)e.bindings.push({type:"sampler",name:s.name,group:s.group,location:s.binding});const r=t.entry.vertex[0],i=r?.inputs.length||0;for(let s=0;s<i;s++){const o=r.inputs[s];if(o.locationType==="location"){const l=DR(o.type);e.attributes.push({name:o.name,location:Number(o.location),type:l})}}return e}function DR(n){return n.format?`${n.name}<${n.format.name}>`:n.name}function QG(n){try{return new GG(n)}catch(e){if(e instanceof Error)throw e;let t="WGSL parse error";throw typeof e=="object"&&e?.message&&(t+=`: ${e.message} `),typeof e=="object"&&e?.token&&(t+=e.token.line||""),new Error(t,{cause:e})}}const JG={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...JG}};const cr=globalThis.mathgl.config;function eZ(n,{precision:e=cr.precision}={}){return n=tZ(n),`${parseFloat(n.toPrecision(e))}`}function Al(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}function Ko(n,e,t){return rZ(n,r=>Math.max(e,Math.min(t,r)))}function fl(n,e,t){return Al(n)?n.map((r,i)=>fl(r,e[i],t)):t*e+(1-t)*n}function Ns(n,e,t){const r=cr.EPSILON;try{if(n===e)return!0;if(Al(n)&&Al(e)){if(n.length!==e.length)return!1;for(let i=0;i<n.length;++i)if(!Ns(n[i],e[i]))return!1;return!0}return n&&n.equals?n.equals(e):e&&e.equals?e.equals(n):typeof n=="number"&&typeof e=="number"?Math.abs(n-e)<=cr.EPSILON*Math.max(1,Math.abs(n),Math.abs(e)):!1}finally{cr.EPSILON=r}}function tZ(n){return Math.round(n/cr.EPSILON)*cr.EPSILON}function nZ(n){return n.clone?n.clone():new Array(n.length)}function rZ(n,e,t){if(Al(n)){const r=n;t=t||nZ(r);for(let i=0;i<t.length&&i<r.length;++i){const s=typeof n=="number"?n:n[i];t[i]=e(s,i,t)}return t}return e(n)}class ME extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,t=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+t];return this.check()}toArray(e=[],t=0){for(let r=0;r<this.ELEMENTS;++r)e[t+r]=this[r];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Al(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(cr)}formatString(e){let t="";for(let r=0;r<this.ELEMENTS;++r)t+=(r>0?", ":"")+eZ(this[r],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!Ns(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,r){if(r===void 0)return this.lerp(this,e,t);for(let i=0;i<this.ELEMENTS;++i){const s=e[i],o=typeof t=="number"?t:t[i];this[i]=s+r*(o-s)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),t[r]);return this.check()}add(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=t[r];return this.check()}subtract(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=t[r];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(cr.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),t);return this.check()}get elements(){return this}}function iZ(n,e){if(n.length!==e)return!1;for(let t=0;t<n.length;++t)if(!Number.isFinite(n[t]))return!1;return!0}function Ct(n){if(!Number.isFinite(n))throw new Error(`Invalid number ${JSON.stringify(n)}`);return n}function kf(n,e,t=""){if(cr.debug&&!iZ(n,e))throw new Error(`math.gl: ${t} some fields set to invalid numbers'`);return n}function nd(n,e){if(!n)throw new Error(`math.gl assertion ${e}`)}class w4 extends ME{get x(){return this[0]}set x(e){this[0]=Ct(e)}get y(){return this[1]}set y(e){this[1]=Ct(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let r=0;r<this.ELEMENTS;++r){const i=this[r]-e[r];t+=i*i}return Ct(t)}dot(e){let t=0;for(let r=0;r<this.ELEMENTS;++r)t+=this[r]*e[r];return Ct(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=t[r];return this.check()}divide(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=t[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return nd(e>=0&&e<this.ELEMENTS,"index is out of range"),Ct(this[e])}setComponent(e,t){return nd(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}const Nf=1e-6;let gi=typeof Float32Array<"u"?Float32Array:Array;function sZ(){const n=new gi(2);return gi!=Float32Array&&(n[0]=0,n[1]=0),n}function LR(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n}function oZ(n,e){return n[0]=-e[0],n[1]=-e[1],n}function E4(n,e,t,r){const i=e[0],s=e[1];return n[0]=i+r*(t[0]-i),n[1]=s+r*(t[1]-s),n}function aZ(n,e,t){const r=e[0],i=e[1];return n[0]=t[0]*r+t[3]*i+t[6],n[1]=t[1]*r+t[4]*i+t[7],n}function lZ(n,e,t){const r=e[0],i=e[1];return n[0]=t[0]*r+t[4]*i+t[12],n[1]=t[1]*r+t[5]*i+t[13],n}(function(){const n=sZ();return function(e,t,r,i,s,o){let l,u;for(t||(t=2),r||(r=0),i?u=Math.min(i*t+r,e.length):u=e.length,l=r;l<u;l+=t)n[0]=e[l],n[1]=e[l+1],s(n,n,o),e[l]=n[0],e[l+1]=n[1];return e}})();function cZ(n,e,t){const r=e[0],i=e[1],s=t[3]*r+t[7]*i||1;return n[0]=(t[0]*r+t[4]*i)/s,n[1]=(t[1]*r+t[5]*i)/s,n}function x4(n,e,t){const r=e[0],i=e[1],s=e[2],o=t[3]*r+t[7]*i+t[11]*s||1;return n[0]=(t[0]*r+t[4]*i+t[8]*s)/o,n[1]=(t[1]*r+t[5]*i+t[9]*s)/o,n[2]=(t[2]*r+t[6]*i+t[10]*s)/o,n}function uZ(n,e,t){const r=e[0],i=e[1];return n[0]=t[0]*r+t[2]*i,n[1]=t[1]*r+t[3]*i,n[2]=e[2],n}function hZ(n,e,t){const r=e[0],i=e[1];return n[0]=t[0]*r+t[2]*i,n[1]=t[1]*r+t[3]*i,n[2]=e[2],n[3]=e[3],n}function A4(n,e,t){const r=e[0],i=e[1],s=e[2];return n[0]=t[0]*r+t[3]*i+t[6]*s,n[1]=t[1]*r+t[4]*i+t[7]*s,n[2]=t[2]*r+t[5]*i+t[8]*s,n[3]=e[3],n}function S4(){const n=new gi(3);return gi!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function fZ(n){const e=n[0],t=n[1],r=n[2];return Math.sqrt(e*e+t*t+r*r)}function UR(n,e,t){const r=new gi(3);return r[0]=n,r[1]=e,r[2]=t,r}function dZ(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function pZ(n){const e=n[0],t=n[1],r=n[2];return e*e+t*t+r*r}function gZ(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function mZ(n,e){const t=e[0],r=e[1],i=e[2];let s=t*t+r*r+i*i;return s>0&&(s=1/Math.sqrt(s)),n[0]=e[0]*s,n[1]=e[1]*s,n[2]=e[2]*s,n}function R4(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function im(n,e,t){const r=e[0],i=e[1],s=e[2],o=t[0],l=t[1],u=t[2];return n[0]=i*u-s*l,n[1]=s*o-r*u,n[2]=r*l-i*o,n}function _Z(n,e,t,r){const i=e[0],s=e[1],o=e[2];return n[0]=i+r*(t[0]-i),n[1]=s+r*(t[1]-s),n[2]=o+r*(t[2]-o),n}function OE(n,e,t){const r=e[0],i=e[1],s=e[2];let o=t[3]*r+t[7]*i+t[11]*s+t[15];return o=o||1,n[0]=(t[0]*r+t[4]*i+t[8]*s+t[12])/o,n[1]=(t[1]*r+t[5]*i+t[9]*s+t[13])/o,n[2]=(t[2]*r+t[6]*i+t[10]*s+t[14])/o,n}function C4(n,e,t){const r=e[0],i=e[1],s=e[2];return n[0]=r*t[0]+i*t[3]+s*t[6],n[1]=r*t[1]+i*t[4]+s*t[7],n[2]=r*t[2]+i*t[5]+s*t[8],n}function I4(n,e,t){const r=t[0],i=t[1],s=t[2],o=t[3],l=e[0],u=e[1],h=e[2];let d=i*h-s*u,g=s*l-r*h,y=r*u-i*l,b=i*y-s*g,w=s*d-r*y,E=r*g-i*d;const x=o*2;return d*=x,g*=x,y*=x,b*=2,w*=2,E*=2,n[0]=l+d+b,n[1]=u+g+w,n[2]=h+y+E,n}function yZ(n,e,t,r){const i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[0],s[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),s[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),n[0]=s[0]+t[0],n[1]=s[1]+t[1],n[2]=s[2]+t[2],n}function vZ(n,e,t,r){const i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),s[1]=i[1],s[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),n[0]=s[0]+t[0],n[1]=s[1]+t[1],n[2]=s[2]+t[2],n}function bZ(n,e,t,r){const i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),s[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),s[2]=i[2],n[0]=s[0]+t[0],n[1]=s[1]+t[1],n[2]=s[2]+t[2],n}function TZ(n,e){const t=n[0],r=n[1],i=n[2],s=e[0],o=e[1],l=e[2],u=Math.sqrt((t*t+r*r+i*i)*(s*s+o*o+l*l)),h=u&&R4(n,e)/u;return Math.acos(Math.min(Math.max(h,-1),1))}const P4=dZ,M4=fZ,Wb=pZ;(function(){const n=S4();return function(e,t,r,i,s,o){let l,u;for(t||(t=3),r||(r=0),i?u=Math.min(i*t+r,e.length):u=e.length,l=r;l<u;l+=t)n[0]=e[l],n[1]=e[l+1],n[2]=e[l+2],s(n,n,o),e[l]=n[0],e[l+1]=n[1],e[l+2]=n[2];return e}})();const qb=[0,0,0];let yg;class Pe extends w4{static get ZERO(){return yg||(yg=new Pe(0,0,0),Object.freeze(yg)),yg}constructor(e=0,t=0,r=0){super(-0,-0,-0),arguments.length===1&&Al(e)?this.copy(e):(cr.debug&&(Ct(e),Ct(t),Ct(r)),this[0]=e,this[1]=t,this[2]=r)}set(e,t,r){return this[0]=e,this[1]=t,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return cr.debug&&(Ct(e.x),Ct(e.y),Ct(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Ct(e)}angle(e){return TZ(this,e)}cross(e){return im(this,this,e),this.check()}rotateX({radians:e,origin:t=qb}){return yZ(this,this,t,e),this.check()}rotateY({radians:e,origin:t=qb}){return vZ(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=qb}){return bZ(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return OE(this,this,e),this.check()}transformAsVector(e){return x4(this,this,e),this.check()}transformByMatrix3(e){return C4(this,this,e),this.check()}transformByMatrix2(e){return uZ(this,this,e),this.check()}transformByQuaternion(e){return I4(this,this,e),this.check()}}let vg;class kE extends w4{static get ZERO(){return vg||(vg=new kE(0,0,0,0),Object.freeze(vg)),vg}constructor(e=0,t=0,r=0,i=0){super(-0,-0,-0,-0),Al(e)&&arguments.length===1?this.copy(e):(cr.debug&&(Ct(e),Ct(t),Ct(r),Ct(i)),this[0]=e,this[1]=t,this[2]=r,this[3]=i)}set(e,t,r,i){return this[0]=e,this[1]=t,this[2]=r,this[3]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return cr.debug&&(Ct(e.x),Ct(e.y),Ct(e.z),Ct(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=Ct(e)}get w(){return this[3]}set w(e){this[3]=Ct(e)}transform(e){return OE(this,this,e),this.check()}transformByMatrix3(e){return A4(this,this,e),this.check()}transformByMatrix2(e){return hZ(this,this,e),this.check()}transformByQuaternion(e){return I4(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class O4 extends ME{toString(){let e="[";if(cr.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let r=0;r<this.RANK;++r)e+=` ${this[r*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,r){return this[t*this.RANK+e]=Ct(r),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)t[i]=this[r+i];return t}setColumn(e,t){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)this[r+i]=t[i];return this}}function wZ(){const n=new gi(9);return gi!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function EZ(n,e){if(n===e){const t=e[1],r=e[2],i=e[5];n[1]=e[3],n[2]=e[6],n[3]=t,n[5]=e[7],n[6]=r,n[7]=i}else n[0]=e[0],n[1]=e[3],n[2]=e[6],n[3]=e[1],n[4]=e[4],n[5]=e[7],n[6]=e[2],n[7]=e[5],n[8]=e[8];return n}function xZ(n,e){const t=e[0],r=e[1],i=e[2],s=e[3],o=e[4],l=e[5],u=e[6],h=e[7],d=e[8],g=d*o-l*h,y=-d*s+l*u,b=h*s-o*u;let w=t*g+r*y+i*b;return w?(w=1/w,n[0]=g*w,n[1]=(-d*r+i*h)*w,n[2]=(l*r-i*o)*w,n[3]=y*w,n[4]=(d*t-i*u)*w,n[5]=(-l*t+i*s)*w,n[6]=b*w,n[7]=(-h*t+r*u)*w,n[8]=(o*t-r*s)*w,n):null}function AZ(n){const e=n[0],t=n[1],r=n[2],i=n[3],s=n[4],o=n[5],l=n[6],u=n[7],h=n[8];return e*(h*s-o*u)+t*(-h*i+o*l)+r*(u*i-s*l)}function FR(n,e,t){const r=e[0],i=e[1],s=e[2],o=e[3],l=e[4],u=e[5],h=e[6],d=e[7],g=e[8],y=t[0],b=t[1],w=t[2],E=t[3],x=t[4],C=t[5],M=t[6],O=t[7],V=t[8];return n[0]=y*r+b*o+w*h,n[1]=y*i+b*l+w*d,n[2]=y*s+b*u+w*g,n[3]=E*r+x*o+C*h,n[4]=E*i+x*l+C*d,n[5]=E*s+x*u+C*g,n[6]=M*r+O*o+V*h,n[7]=M*i+O*l+V*d,n[8]=M*s+O*u+V*g,n}function SZ(n,e,t){const r=e[0],i=e[1],s=e[2],o=e[3],l=e[4],u=e[5],h=e[6],d=e[7],g=e[8],y=t[0],b=t[1];return n[0]=r,n[1]=i,n[2]=s,n[3]=o,n[4]=l,n[5]=u,n[6]=y*r+b*o+h,n[7]=y*i+b*l+d,n[8]=y*s+b*u+g,n}function RZ(n,e,t){const r=e[0],i=e[1],s=e[2],o=e[3],l=e[4],u=e[5],h=e[6],d=e[7],g=e[8],y=Math.sin(t),b=Math.cos(t);return n[0]=b*r+y*o,n[1]=b*i+y*l,n[2]=b*s+y*u,n[3]=b*o-y*r,n[4]=b*l-y*i,n[5]=b*u-y*s,n[6]=h,n[7]=d,n[8]=g,n}function BR(n,e,t){const r=t[0],i=t[1];return n[0]=r*e[0],n[1]=r*e[1],n[2]=r*e[2],n[3]=i*e[3],n[4]=i*e[4],n[5]=i*e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n}function CZ(n,e){const t=e[0],r=e[1],i=e[2],s=e[3],o=t+t,l=r+r,u=i+i,h=t*o,d=r*o,g=r*l,y=i*o,b=i*l,w=i*u,E=s*o,x=s*l,C=s*u;return n[0]=1-g-w,n[3]=d-C,n[6]=y+x,n[1]=d+C,n[4]=1-h-w,n[7]=b-E,n[2]=y-x,n[5]=b+E,n[8]=1-h-g,n}var hT;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL1ROW0=3]="COL1ROW0",n[n.COL1ROW1=4]="COL1ROW1",n[n.COL1ROW2=5]="COL1ROW2",n[n.COL2ROW0=6]="COL2ROW0",n[n.COL2ROW1=7]="COL2ROW1",n[n.COL2ROW2=8]="COL2ROW2"})(hT||(hT={}));const IZ=Object.freeze([1,0,0,0,1,0,0,0,1]);class Nn extends O4{static get IDENTITY(){return MZ()}static get ZERO(){return PZ()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return hT}constructor(e,...t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):t.length>0?this.copy([e,...t]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(IZ)}fromObject(e){return this.check()}fromQuaternion(e){return CZ(this,e),this.check()}set(e,t,r,i,s,o,l,u,h){return this[0]=e,this[1]=t,this[2]=r,this[3]=i,this[4]=s,this[5]=o,this[6]=l,this[7]=u,this[8]=h,this.check()}setRowMajor(e,t,r,i,s,o,l,u,h){return this[0]=e,this[1]=i,this[2]=l,this[3]=t,this[4]=s,this[5]=u,this[6]=r,this[7]=o,this[8]=h,this.check()}determinant(){return AZ(this)}transpose(){return EZ(this,this),this.check()}invert(){return xZ(this,this),this.check()}multiplyLeft(e){return FR(this,e,this),this.check()}multiplyRight(e){return FR(this,this,e),this.check()}rotate(e){return RZ(this,this,e),this.check()}scale(e){return Array.isArray(e)?BR(this,this,e):BR(this,this,[e,e]),this.check()}translate(e){return SZ(this,this,e),this.check()}transform(e,t){let r;switch(e.length){case 2:r=aZ(t||[-0,-0],e,this);break;case 3:r=C4(t||[-0,-0,-0],e,this);break;case 4:r=A4(t||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return kf(r,e.length),r}transformVector(e,t){return this.transform(e,t)}transformVector2(e,t){return this.transform(e,t)}transformVector3(e,t){return this.transform(e,t)}}let bg,Tg=null;function PZ(){return bg||(bg=new Nn([0,0,0,0,0,0,0,0,0]),Object.freeze(bg)),bg}function MZ(){return Tg||(Tg=new Nn,Object.freeze(Tg)),Tg}function OZ(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function kZ(n,e){if(n===e){const t=e[1],r=e[2],i=e[3],s=e[6],o=e[7],l=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=t,n[6]=e[9],n[7]=e[13],n[8]=r,n[9]=s,n[11]=e[14],n[12]=i,n[13]=o,n[14]=l}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n}function fT(n,e){const t=e[0],r=e[1],i=e[2],s=e[3],o=e[4],l=e[5],u=e[6],h=e[7],d=e[8],g=e[9],y=e[10],b=e[11],w=e[12],E=e[13],x=e[14],C=e[15],M=t*l-r*o,O=t*u-i*o,V=t*h-s*o,H=r*u-i*l,G=r*h-s*l,D=i*h-s*u,I=d*E-g*w,N=d*x-y*w,j=d*C-b*w,W=g*x-y*E,Y=g*C-b*E,z=y*C-b*x;let de=M*z-O*Y+V*W+H*j-G*N+D*I;return de?(de=1/de,n[0]=(l*z-u*Y+h*W)*de,n[1]=(i*Y-r*z-s*W)*de,n[2]=(E*D-x*G+C*H)*de,n[3]=(y*G-g*D-b*H)*de,n[4]=(u*j-o*z-h*N)*de,n[5]=(t*z-i*j+s*N)*de,n[6]=(x*V-w*D-C*O)*de,n[7]=(d*D-y*V+b*O)*de,n[8]=(o*Y-l*j+h*I)*de,n[9]=(r*j-t*Y-s*I)*de,n[10]=(w*G-E*V+C*M)*de,n[11]=(g*V-d*G-b*M)*de,n[12]=(l*N-o*W-u*I)*de,n[13]=(t*W-r*N+i*I)*de,n[14]=(E*O-w*H-x*M)*de,n[15]=(d*H-g*O+y*M)*de,n):null}function NZ(n){const e=n[0],t=n[1],r=n[2],i=n[3],s=n[4],o=n[5],l=n[6],u=n[7],h=n[8],d=n[9],g=n[10],y=n[11],b=n[12],w=n[13],E=n[14],x=n[15],C=e*o-t*s,M=e*l-r*s,O=t*l-r*o,V=h*w-d*b,H=h*E-g*b,G=d*E-g*w,D=e*G-t*H+r*V,I=s*G-o*H+l*V,N=h*O-d*M+g*C,j=b*O-w*M+E*C;return u*D-i*I+x*N-y*j}function dl(n,e,t){const r=e[0],i=e[1],s=e[2],o=e[3],l=e[4],u=e[5],h=e[6],d=e[7],g=e[8],y=e[9],b=e[10],w=e[11],E=e[12],x=e[13],C=e[14],M=e[15];let O=t[0],V=t[1],H=t[2],G=t[3];return n[0]=O*r+V*l+H*g+G*E,n[1]=O*i+V*u+H*y+G*x,n[2]=O*s+V*h+H*b+G*C,n[3]=O*o+V*d+H*w+G*M,O=t[4],V=t[5],H=t[6],G=t[7],n[4]=O*r+V*l+H*g+G*E,n[5]=O*i+V*u+H*y+G*x,n[6]=O*s+V*h+H*b+G*C,n[7]=O*o+V*d+H*w+G*M,O=t[8],V=t[9],H=t[10],G=t[11],n[8]=O*r+V*l+H*g+G*E,n[9]=O*i+V*u+H*y+G*x,n[10]=O*s+V*h+H*b+G*C,n[11]=O*o+V*d+H*w+G*M,O=t[12],V=t[13],H=t[14],G=t[15],n[12]=O*r+V*l+H*g+G*E,n[13]=O*i+V*u+H*y+G*x,n[14]=O*s+V*h+H*b+G*C,n[15]=O*o+V*d+H*w+G*M,n}function t_(n,e,t){const r=t[0],i=t[1],s=t[2];let o,l,u,h,d,g,y,b,w,E,x,C;return e===n?(n[12]=e[0]*r+e[4]*i+e[8]*s+e[12],n[13]=e[1]*r+e[5]*i+e[9]*s+e[13],n[14]=e[2]*r+e[6]*i+e[10]*s+e[14],n[15]=e[3]*r+e[7]*i+e[11]*s+e[15]):(o=e[0],l=e[1],u=e[2],h=e[3],d=e[4],g=e[5],y=e[6],b=e[7],w=e[8],E=e[9],x=e[10],C=e[11],n[0]=o,n[1]=l,n[2]=u,n[3]=h,n[4]=d,n[5]=g,n[6]=y,n[7]=b,n[8]=w,n[9]=E,n[10]=x,n[11]=C,n[12]=o*r+d*i+w*s+e[12],n[13]=l*r+g*i+E*s+e[13],n[14]=u*r+y*i+x*s+e[14],n[15]=h*r+b*i+C*s+e[15]),n}function NE(n,e,t){const r=t[0],i=t[1],s=t[2];return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n[3]=e[3]*r,n[4]=e[4]*i,n[5]=e[5]*i,n[6]=e[6]*i,n[7]=e[7]*i,n[8]=e[8]*s,n[9]=e[9]*s,n[10]=e[10]*s,n[11]=e[11]*s,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function DZ(n,e,t,r){let i=r[0],s=r[1],o=r[2],l=Math.sqrt(i*i+s*s+o*o),u,h,d,g,y,b,w,E,x,C,M,O,V,H,G,D,I,N,j,W,Y,z,de,xe;return l<Nf?null:(l=1/l,i*=l,s*=l,o*=l,h=Math.sin(t),u=Math.cos(t),d=1-u,g=e[0],y=e[1],b=e[2],w=e[3],E=e[4],x=e[5],C=e[6],M=e[7],O=e[8],V=e[9],H=e[10],G=e[11],D=i*i*d+u,I=s*i*d+o*h,N=o*i*d-s*h,j=i*s*d-o*h,W=s*s*d+u,Y=o*s*d+i*h,z=i*o*d+s*h,de=s*o*d-i*h,xe=o*o*d+u,n[0]=g*D+E*I+O*N,n[1]=y*D+x*I+V*N,n[2]=b*D+C*I+H*N,n[3]=w*D+M*I+G*N,n[4]=g*j+E*W+O*Y,n[5]=y*j+x*W+V*Y,n[6]=b*j+C*W+H*Y,n[7]=w*j+M*W+G*Y,n[8]=g*z+E*de+O*xe,n[9]=y*z+x*de+V*xe,n[10]=b*z+C*de+H*xe,n[11]=w*z+M*de+G*xe,e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n)}function k4(n,e,t){const r=Math.sin(t),i=Math.cos(t),s=e[4],o=e[5],l=e[6],u=e[7],h=e[8],d=e[9],g=e[10],y=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=s*i+h*r,n[5]=o*i+d*r,n[6]=l*i+g*r,n[7]=u*i+y*r,n[8]=h*i-s*r,n[9]=d*i-o*r,n[10]=g*i-l*r,n[11]=y*i-u*r,n}function LZ(n,e,t){const r=Math.sin(t),i=Math.cos(t),s=e[0],o=e[1],l=e[2],u=e[3],h=e[8],d=e[9],g=e[10],y=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=s*i-h*r,n[1]=o*i-d*r,n[2]=l*i-g*r,n[3]=u*i-y*r,n[8]=s*r+h*i,n[9]=o*r+d*i,n[10]=l*r+g*i,n[11]=u*r+y*i,n}function N4(n,e,t){const r=Math.sin(t),i=Math.cos(t),s=e[0],o=e[1],l=e[2],u=e[3],h=e[4],d=e[5],g=e[6],y=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=s*i+h*r,n[1]=o*i+d*r,n[2]=l*i+g*r,n[3]=u*i+y*r,n[4]=h*i-s*r,n[5]=d*i-o*r,n[6]=g*i-l*r,n[7]=y*i-u*r,n}function UZ(n,e){const t=e[0],r=e[1],i=e[2],s=e[4],o=e[5],l=e[6],u=e[8],h=e[9],d=e[10];return n[0]=Math.sqrt(t*t+r*r+i*i),n[1]=Math.sqrt(s*s+o*o+l*l),n[2]=Math.sqrt(u*u+h*h+d*d),n}function FZ(n,e){const t=e[0],r=e[1],i=e[2],s=e[3],o=t+t,l=r+r,u=i+i,h=t*o,d=r*o,g=r*l,y=i*o,b=i*l,w=i*u,E=s*o,x=s*l,C=s*u;return n[0]=1-g-w,n[1]=d+C,n[2]=y-x,n[3]=0,n[4]=d-C,n[5]=1-h-w,n[6]=b+E,n[7]=0,n[8]=y+x,n[9]=b-E,n[10]=1-h-g,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function BZ(n,e,t,r,i,s,o){const l=1/(t-e),u=1/(i-r),h=1/(s-o);return n[0]=s*2*l,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=s*2*u,n[6]=0,n[7]=0,n[8]=(t+e)*l,n[9]=(i+r)*u,n[10]=(o+s)*h,n[11]=-1,n[12]=0,n[13]=0,n[14]=o*s*2*h,n[15]=0,n}function VZ(n,e,t,r,i){const s=1/Math.tan(e/2);if(n[0]=s/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=s,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,i!=null&&i!==1/0){const o=1/(r-i);n[10]=(i+r)*o,n[14]=2*i*r*o}else n[10]=-1,n[14]=-2*r;return n}const zZ=VZ;function jZ(n,e,t,r,i,s,o){const l=1/(e-t),u=1/(r-i),h=1/(s-o);return n[0]=-2*l,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*u,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*h,n[11]=0,n[12]=(e+t)*l,n[13]=(i+r)*u,n[14]=(o+s)*h,n[15]=1,n}const HZ=jZ;function $Z(n,e,t,r){let i,s,o,l,u,h,d,g,y,b;const w=e[0],E=e[1],x=e[2],C=r[0],M=r[1],O=r[2],V=t[0],H=t[1],G=t[2];return Math.abs(w-V)<Nf&&Math.abs(E-H)<Nf&&Math.abs(x-G)<Nf?OZ(n):(g=w-V,y=E-H,b=x-G,i=1/Math.sqrt(g*g+y*y+b*b),g*=i,y*=i,b*=i,s=M*b-O*y,o=O*g-C*b,l=C*y-M*g,i=Math.sqrt(s*s+o*o+l*l),i?(i=1/i,s*=i,o*=i,l*=i):(s=0,o=0,l=0),u=y*l-b*o,h=b*s-g*l,d=g*o-y*s,i=Math.sqrt(u*u+h*h+d*d),i?(i=1/i,u*=i,h*=i,d*=i):(u=0,h=0,d=0),n[0]=s,n[1]=u,n[2]=g,n[3]=0,n[4]=o,n[5]=h,n[6]=y,n[7]=0,n[8]=l,n[9]=d,n[10]=b,n[11]=0,n[12]=-(s*w+o*E+l*x),n[13]=-(u*w+h*E+d*x),n[14]=-(g*w+y*E+b*x),n[15]=1,n)}function WZ(){const n=new gi(4);return gi!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function qZ(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n}function DE(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n}function XZ(n){const e=n[0],t=n[1],r=n[2],i=n[3];return Math.sqrt(e*e+t*t+r*r+i*i)}function YZ(n){const e=n[0],t=n[1],r=n[2],i=n[3];return e*e+t*t+r*r+i*i}function KZ(n,e){const t=e[0],r=e[1],i=e[2],s=e[3];let o=t*t+r*r+i*i+s*s;return o>0&&(o=1/Math.sqrt(o)),n[0]=t*o,n[1]=r*o,n[2]=i*o,n[3]=s*o,n}function GZ(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]*e[3]}function ZZ(n,e,t,r){const i=e[0],s=e[1],o=e[2],l=e[3];return n[0]=i+r*(t[0]-i),n[1]=s+r*(t[1]-s),n[2]=o+r*(t[2]-o),n[3]=l+r*(t[3]-l),n}function $u(n,e,t){const r=e[0],i=e[1],s=e[2],o=e[3];return n[0]=t[0]*r+t[4]*i+t[8]*s+t[12]*o,n[1]=t[1]*r+t[5]*i+t[9]*s+t[13]*o,n[2]=t[2]*r+t[6]*i+t[10]*s+t[14]*o,n[3]=t[3]*r+t[7]*i+t[11]*s+t[15]*o,n}function QZ(n,e,t){const r=e[0],i=e[1],s=e[2],o=t[0],l=t[1],u=t[2],h=t[3],d=h*r+l*s-u*i,g=h*i+u*r-o*s,y=h*s+o*i-l*r,b=-o*r-l*i-u*s;return n[0]=d*h+b*-o+g*-u-y*-l,n[1]=g*h+b*-l+y*-o-d*-u,n[2]=y*h+b*-u+d*-l-g*-o,n[3]=e[3],n}(function(){const n=WZ();return function(e,t,r,i,s,o){let l,u;for(t||(t=4),r||(r=0),i?u=Math.min(i*t+r,e.length):u=e.length,l=r;l<u;l+=t)n[0]=e[l],n[1]=e[l+1],n[2]=e[l+2],n[3]=e[l+3],s(n,n,o),e[l]=n[0],e[l+1]=n[1],e[l+2]=n[2],e[l+3]=n[3];return e}})();var dT;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL0ROW3=3]="COL0ROW3",n[n.COL1ROW0=4]="COL1ROW0",n[n.COL1ROW1=5]="COL1ROW1",n[n.COL1ROW2=6]="COL1ROW2",n[n.COL1ROW3=7]="COL1ROW3",n[n.COL2ROW0=8]="COL2ROW0",n[n.COL2ROW1=9]="COL2ROW1",n[n.COL2ROW2=10]="COL2ROW2",n[n.COL2ROW3=11]="COL2ROW3",n[n.COL3ROW0=12]="COL3ROW0",n[n.COL3ROW1=13]="COL3ROW1",n[n.COL3ROW2=14]="COL3ROW2",n[n.COL3ROW3=15]="COL3ROW3"})(dT||(dT={}));const JZ=45*Math.PI/180,eQ=1,Xb=.1,Yb=500,tQ=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class rr extends O4{static get IDENTITY(){return rQ()}static get ZERO(){return nQ()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return dT}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,r,i,s,o,l,u,h,d,g,y,b,w,E,x){return this[0]=e,this[1]=t,this[2]=r,this[3]=i,this[4]=s,this[5]=o,this[6]=l,this[7]=u,this[8]=h,this[9]=d,this[10]=g,this[11]=y,this[12]=b,this[13]=w,this[14]=E,this[15]=x,this.check()}setRowMajor(e,t,r,i,s,o,l,u,h,d,g,y,b,w,E,x){return this[0]=e,this[1]=s,this[2]=h,this[3]=b,this[4]=t,this[5]=o,this[6]=d,this[7]=w,this[8]=r,this[9]=l,this[10]=g,this[11]=E,this[12]=i,this[13]=u,this[14]=y,this[15]=x,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(tQ)}fromObject(e){return this.check()}fromQuaternion(e){return FZ(this,e),this.check()}frustum(e){const{left:t,right:r,bottom:i,top:s,near:o=Xb,far:l=Yb}=e;return l===1/0?iQ(this,t,r,i,s,o):BZ(this,t,r,i,s,o,l),this.check()}lookAt(e){const{eye:t,center:r=[0,0,0],up:i=[0,1,0]}=e;return $Z(this,t,r,i),this.check()}ortho(e){const{left:t,right:r,bottom:i,top:s,near:o=Xb,far:l=Yb}=e;return HZ(this,t,r,i,s,o,l),this.check()}orthographic(e){const{fovy:t=JZ,aspect:r=eQ,focalDistance:i=1,near:s=Xb,far:o=Yb}=e;VR(t);const l=t/2,u=i*Math.tan(l),h=u*r;return this.ortho({left:-h,right:h,bottom:-u,top:u,near:s,far:o})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:r=1,near:i=.1,far:s=500}=e;return VR(t),zZ(this,t,r,i,s),this.check()}determinant(){return NZ(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const r=this.getScale(t),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*s,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*s,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const r=this.getScale(t),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=this[4]*i,e[4]=this[5]*s,e[5]=this[6]*o,e[6]=this[8]*i,e[7]=this[9]*s,e[8]=this[10]*o,e}transpose(){return kZ(this,this),this.check()}invert(){return fT(this,this),this.check()}multiplyLeft(e){return dl(this,e,this),this.check()}multiplyRight(e){return dl(this,this,e),this.check()}rotateX(e){return k4(this,this,e),this.check()}rotateY(e){return LZ(this,this,e),this.check()}rotateZ(e){return N4(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return DZ(this,this,e,t),this.check()}scale(e){return NE(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return t_(this,this,e),this.check()}transform(e,t){return e.length===4?(t=$u(t||[-0,-0,-0,-0],e,this),kf(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:r}=e;let i;switch(r){case 2:i=lZ(t||[-0,-0],e,this);break;case 3:i=OE(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return kf(i,e.length),i}transformAsVector(e,t){let r;switch(e.length){case 2:r=cZ(t||[-0,-0],e,this);break;case 3:r=x4(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return kf(r,e.length),r}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,r){return this.identity().translate([e,t,r])}}let wg,Eg;function nQ(){return wg||(wg=new rr([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(wg)),wg}function rQ(){return Eg||(Eg=new rr,Object.freeze(Eg)),Eg}function VR(n){if(n>Math.PI*2)throw Error("expected radians")}function iQ(n,e,t,r,i,s){const o=2*s/(t-e),l=2*s/(i-r),u=(t+e)/(t-e),h=(i+r)/(i-r),d=-1,g=-1,y=-2*s;return n[0]=o,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=l,n[6]=0,n[7]=0,n[8]=u,n[9]=h,n[10]=d,n[11]=g,n[12]=0,n[13]=0,n[14]=y,n[15]=0,n}function zR(){const n=new gi(4);return gi!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function sQ(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function D4(n,e,t){t=t*.5;const r=Math.sin(t);return n[0]=r*e[0],n[1]=r*e[1],n[2]=r*e[2],n[3]=Math.cos(t),n}function jR(n,e,t){const r=e[0],i=e[1],s=e[2],o=e[3],l=t[0],u=t[1],h=t[2],d=t[3];return n[0]=r*d+o*l+i*h-s*u,n[1]=i*d+o*u+s*l-r*h,n[2]=s*d+o*h+r*u-i*l,n[3]=o*d-r*l-i*u-s*h,n}function oQ(n,e,t){t*=.5;const r=e[0],i=e[1],s=e[2],o=e[3],l=Math.sin(t),u=Math.cos(t);return n[0]=r*u+o*l,n[1]=i*u+s*l,n[2]=s*u-i*l,n[3]=o*u-r*l,n}function aQ(n,e,t){t*=.5;const r=e[0],i=e[1],s=e[2],o=e[3],l=Math.sin(t),u=Math.cos(t);return n[0]=r*u-s*l,n[1]=i*u+o*l,n[2]=s*u+r*l,n[3]=o*u-i*l,n}function lQ(n,e,t){t*=.5;const r=e[0],i=e[1],s=e[2],o=e[3],l=Math.sin(t),u=Math.cos(t);return n[0]=r*u+i*l,n[1]=i*u-r*l,n[2]=s*u+o*l,n[3]=o*u-s*l,n}function cQ(n,e){const t=e[0],r=e[1],i=e[2];return n[0]=t,n[1]=r,n[2]=i,n[3]=Math.sqrt(Math.abs(1-t*t-r*r-i*i)),n}function sm(n,e,t,r){const i=e[0],s=e[1],o=e[2],l=e[3];let u=t[0],h=t[1],d=t[2],g=t[3],y,b,w,E,x;return y=i*u+s*h+o*d+l*g,y<0&&(y=-y,u=-u,h=-h,d=-d,g=-g),1-y>Nf?(b=Math.acos(y),x=Math.sin(b),w=Math.sin((1-r)*b)/x,E=Math.sin(r*b)/x):(w=1-r,E=r),n[0]=w*i+E*u,n[1]=w*s+E*h,n[2]=w*o+E*d,n[3]=w*l+E*g,n}function uQ(n,e){const t=e[0],r=e[1],i=e[2],s=e[3],o=t*t+r*r+i*i+s*s,l=o?1/o:0;return n[0]=-t*l,n[1]=-r*l,n[2]=-i*l,n[3]=s*l,n}function hQ(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n}function L4(n,e){const t=e[0]+e[4]+e[8];let r;if(t>0)r=Math.sqrt(t+1),n[3]=.5*r,r=.5/r,n[0]=(e[5]-e[7])*r,n[1]=(e[6]-e[2])*r,n[2]=(e[1]-e[3])*r;else{let i=0;e[4]>e[0]&&(i=1),e[8]>e[i*3+i]&&(i=2);const s=(i+1)%3,o=(i+2)%3;r=Math.sqrt(e[i*3+i]-e[s*3+s]-e[o*3+o]+1),n[i]=.5*r,r=.5/r,n[3]=(e[s*3+o]-e[o*3+s])*r,n[s]=(e[s*3+i]+e[i*3+s])*r,n[o]=(e[o*3+i]+e[i*3+o])*r}return n}const fQ=qZ,dQ=DE,pQ=GZ,gQ=ZZ,mQ=XZ,_Q=YZ,U4=KZ,yQ=(function(){const n=S4(),e=UR(1,0,0),t=UR(0,1,0);return function(r,i,s){const o=R4(i,s);return o<-.999999?(im(n,e,i),M4(n)<1e-6&&im(n,t,i),mZ(n,n),D4(r,n,Math.PI),r):o>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(im(n,i,s),r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=1+o,U4(r,r))}})();(function(){const n=zR(),e=zR();return function(t,r,i,s,o,l){return sm(n,r,o,l),sm(e,i,s,l),sm(t,n,e,2*l*(1-l)),t}})();(function(){const n=wZ();return function(e,t,r,i){return n[0]=r[0],n[3]=r[1],n[6]=r[2],n[1]=i[0],n[4]=i[1],n[7]=i[2],n[2]=-t[0],n[5]=-t[1],n[8]=-t[2],U4(e,L4(e,n))}})();const vQ=[0,0,0,1];class HR extends ME{constructor(e=0,t=0,r=0,i=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,t,r,i)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,t,r,i){return this[0]=e,this[1]=t,this[2]=r,this[3]=i,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return L4(this,e),this.check()}fromAxisRotation(e,t){return D4(this,e,t),this.check()}identity(){return sQ(this),this.check()}setAxisAngle(e,t){return this.fromAxisRotation(e,t)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=Ct(e)}get y(){return this[1]}set y(e){this[1]=Ct(e)}get z(){return this[2]}set z(e){this[2]=Ct(e)}get w(){return this[3]}set w(e){this[3]=Ct(e)}len(){return mQ(this)}lengthSquared(){return _Q(this)}dot(e){return pQ(this,e)}rotationTo(e,t){return yQ(this,e,t),this.check()}add(e){return fQ(this,this,e),this.check()}calculateW(){return cQ(this,this),this.check()}conjugate(){return hQ(this,this),this.check()}invert(){return uQ(this,this),this.check()}lerp(e,t,r){return r===void 0?this.lerp(this,e,t):(gQ(this,e,t,r),this.check())}multiplyRight(e){return jR(this,this,e),this.check()}multiplyLeft(e){return jR(this,e,this),this.check()}normalize(){const e=this.len(),t=e>0?1/e:0;return this[0]=this[0]*t,this[1]=this[1]*t,this[2]=this[2]*t,this[3]=this[3]*t,e===0&&(this[3]=1),this.check()}rotateX(e){return oQ(this,this,e),this.check()}rotateY(e){return aQ(this,this,e),this.check()}rotateZ(e){return lQ(this,this,e),this.check()}scale(e){return dQ(this,this,e),this.check()}slerp(e,t,r){let i,s,o;switch(arguments.length){case 1:({start:i=vQ,target:s,ratio:o}=e);break;case 2:i=this,s=e,o=t;break;default:i=e,s=t,o=r}return sm(this,i,s,o),this.check()}transformVector4(e,t=new kE){return QZ(t,e,this),kf(t,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,t){return this.setAxisAngle(e,t)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const bQ=1e-15,TQ=1e-20;function F4(n,e=[],t=0){const r=Math.fround(n),i=n-r;return e[t]=r,e[t+1]=i,e}function wQ(n){return n-Math.fround(n)}function EQ(n){const e=new Float32Array(32);for(let t=0;t<4;++t)for(let r=0;r<4;++r){const i=t*4+r;F4(n[r*4+t],e,i*2)}return e}const xQ=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,AQ={name:"fp32",vs:xQ},SQ=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,RQ={ONE:1},CQ={name:"fp64arithmetic",vs:SQ,defaultUniforms:RQ,uniformTypes:{ONE:"f32"},fp64ify:F4,fp64LowPart:wQ,fp64ifyMatrix4:EQ},IQ=[0,1,1,1],PQ=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,MQ=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,$R={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:IQ},vs:PQ,fs:MQ,getUniforms:OQ};function OQ(n={},e){const t={};if(n.highlightedObjectColor!==void 0)if(n.highlightedObjectColor===null)t.isHighlightActive=!1;else{t.isHighlightActive=!0;const r=n.highlightedObjectColor.slice(0,3);t.highlightedObjectColor=r}if(n.highlightColor){const r=Array.from(n.highlightColor,i=>i/255);Number.isFinite(r[3])||(r[3]=1),t.highlightColor=r}return n.isActive!==void 0&&(t.isActive=!!n.isActive,t.isAttribute=!!n.isAttribute),n.useFloatColors!==void 0&&(t.useFloatColors=!!n.useFloatColors),t}const WR=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,kQ=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  pointLightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,B4=3,NQ=255;var rd;(function(n){n[n.POINT=0]="POINT",n[n.DIRECTIONAL=1]="DIRECTIONAL"})(rd||(rd={}));const om={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS:B4},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:rd.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:kQ,vs:WR,fs:WR,getUniforms:DQ};function DQ(n,e={}){if(n=n&&{...n},!n)return{...om.defaultUniforms};n.lights&&(n={...n,...UQ(n.lights),lights:void 0});const{ambientLight:t,pointLights:r,directionalLights:i}=n||{};if(!(t||r&&r.length>0||i&&i.length>0))return{...om.defaultUniforms,enabled:0};const o={...om.defaultUniforms,...e,...LQ({ambientLight:t,pointLights:r,directionalLights:i})};return n.enabled!==void 0&&(o.enabled=n.enabled?1:0),o}function LQ({ambientLight:n,pointLights:e=[],directionalLights:t=[]}){const r={};r.ambientLightColor=Kb(n);let i=0;for(const s of e){r.lightType=rd.POINT;const o=i;r[`lightColor${o}`]=Kb(s),r[`lightPosition${o}`]=s.position,r[`lightAttenuation${o}`]=s.attenuation||[1,0,0],i++}for(const s of t){r.lightType=rd.DIRECTIONAL;const o=i;r[`lightColor${o}`]=Kb(s),r[`lightDirection${o}`]=s.direction,i++}return i>B4&&we.warn("MAX_LIGHTS exceeded")(),r.directionalLightCount=t.length,r.pointLightCount=e.length,r}function UQ(n){const e={pointLights:[],directionalLights:[]};for(const t of n||[])switch(t.type){case"ambient":e.ambientLight=t;break;case"directional":e.directionalLights?.push(t);break;case"point":e.pointLights?.push(t);break}return e}function Kb(n={}){const{color:e=[0,0,0],intensity:t=1}=n;return e.map(r=>r*t/NQ)}const FQ=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,BQ=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,VQ=`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, phongMaterial.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,V4={props:{},name:"gouraudMaterial",vs:BQ.replace("phongMaterial","gouraudMaterial"),fs:FQ.replace("phongMaterial","gouraudMaterial"),source:VQ.replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:1},dependencies:[om],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(n){const e={...n};return e.specularColor&&(e.specularColor=e.specularColor.map(t=>t/255)),{...V4.defaultUniforms,...e}}},qR=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,zQ={name:"layer",vs:qR,fs:qR,getUniforms:n=>({opacity:Math.pow(n.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},jQ=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,z4="#define SMOOTH_EDGE_RADIUS 0.5",HQ=`${z4}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,$Q=`${z4}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,j4={name:"geometry",source:jQ,vs:HQ,fs:$Q},WQ=25;var rn;(function(n){n[n.Start=1]="Start",n[n.Move=2]="Move",n[n.End=4]="End",n[n.Cancel=8]="Cancel"})(rn||(rn={}));var dn;(function(n){n[n.None=0]="None",n[n.Left=1]="Left",n[n.Right=2]="Right",n[n.Up=4]="Up",n[n.Down=8]="Down",n[n.Horizontal=3]="Horizontal",n[n.Vertical=12]="Vertical",n[n.All=15]="All"})(dn||(dn={}));var Xe;(function(n){n[n.Possible=1]="Possible",n[n.Began=2]="Began",n[n.Changed=4]="Changed",n[n.Ended=8]="Ended",n[n.Recognized=8]="Recognized",n[n.Cancelled=16]="Cancelled",n[n.Failed=32]="Failed"})(Xe||(Xe={}));const qQ="compute",XQ="auto",pT="manipulation",am="none",gT="pan-x",mT="pan-y";function YQ(n){if(n.includes(am))return am;const e=n.includes(gT),t=n.includes(mT);return e&&t?am:e||t?e?gT:mT:n.includes(pT)?pT:XQ}class KQ{constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){e===qQ&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));return YQ(e.join(" "))}}function n_(n){return n.trim().split(/\s+/g)}function Gb(n,e,t){if(n)for(const r of n_(e))n.addEventListener(r,t,!1)}function Zb(n,e,t){if(n)for(const r of n_(e))n.removeEventListener(r,t,!1)}function XR(n){return(n.ownerDocument||n).defaultView}function GQ(n,e){let t=n;for(;t;){if(t===e)return!0;t=t.parentNode}return!1}function H4(n){const e=n.length;if(e===1)return{x:Math.round(n[0].clientX),y:Math.round(n[0].clientY)};let t=0,r=0,i=0;for(;i<e;)t+=n[i].clientX,r+=n[i].clientY,i++;return{x:Math.round(t/e),y:Math.round(r/e)}}function YR(n){const e=[];let t=0;for(;t<n.pointers.length;)e[t]={clientX:Math.round(n.pointers[t].clientX),clientY:Math.round(n.pointers[t].clientY)},t++;return{timeStamp:Date.now(),pointers:e,center:H4(e),deltaX:n.deltaX,deltaY:n.deltaY}}function $4(n,e){const t=e.x-n.x,r=e.y-n.y;return Math.sqrt(t*t+r*r)}function KR(n,e){const t=e.clientX-n.clientX,r=e.clientY-n.clientY;return Math.sqrt(t*t+r*r)}function ZQ(n,e){const t=e.x-n.x,r=e.y-n.y;return Math.atan2(r,t)*180/Math.PI}function GR(n,e){const t=e.clientX-n.clientX,r=e.clientY-n.clientY;return Math.atan2(r,t)*180/Math.PI}function W4(n,e){return n===e?dn.None:Math.abs(n)>=Math.abs(e)?n<0?dn.Left:dn.Right:e<0?dn.Up:dn.Down}function QQ(n,e){const t=e.center;let r=n.offsetDelta,i=n.prevDelta;const s=n.prevInput;return(e.eventType===rn.Start||s?.eventType===rn.End)&&(i=n.prevDelta={x:s?.deltaX||0,y:s?.deltaY||0},r=n.offsetDelta={x:t.x,y:t.y}),{deltaX:i.x+(t.x-r.x),deltaY:i.y+(t.y-r.y)}}function q4(n,e,t){return{x:e/n||0,y:t/n||0}}function JQ(n,e){return KR(e[0],e[1])/KR(n[0],n[1])}function eJ(n,e){return GR(e[1],e[0])-GR(n[1],n[0])}function tJ(n,e){const t=n.lastInterval||e,r=e.timeStamp-t.timeStamp;let i,s,o,l;if(e.eventType!==rn.Cancel&&(r>WQ||t.velocity===void 0)){const u=e.deltaX-t.deltaX,h=e.deltaY-t.deltaY,d=q4(r,u,h);s=d.x,o=d.y,i=Math.abs(d.x)>Math.abs(d.y)?d.x:d.y,l=W4(u,h),n.lastInterval=e}else i=t.velocity,s=t.velocityX,o=t.velocityY,l=t.direction;e.velocity=i,e.velocityX=s,e.velocityY=o,e.direction=l}function nJ(n,e){const{session:t}=n,{pointers:r}=e,{length:i}=r;t.firstInput||(t.firstInput=YR(e)),i>1&&!t.firstMultiple?t.firstMultiple=YR(e):i===1&&(t.firstMultiple=!1);const{firstInput:s,firstMultiple:o}=t,l=o?o.center:s.center,u=e.center=H4(r);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-s.timeStamp,e.angle=ZQ(l,u),e.distance=$4(l,u);const{deltaX:h,deltaY:d}=QQ(t,e);e.deltaX=h,e.deltaY=d,e.offsetDirection=W4(e.deltaX,e.deltaY);const g=q4(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=g.x,e.overallVelocityY=g.y,e.overallVelocity=Math.abs(g.x)>Math.abs(g.y)?g.x:g.y,e.scale=o?JQ(o.pointers,r):1,e.rotation=o?eJ(o.pointers,r):0,e.maxPointers=t.prevInput?e.pointers.length>t.prevInput.maxPointers?e.pointers.length:t.prevInput.maxPointers:e.pointers.length;let y=n.element;return GQ(e.srcEvent.target,y)&&(y=e.srcEvent.target),e.target=y,tJ(t,e),e}function rJ(n,e,t){const r=t.pointers.length,i=t.changedPointers.length,s=e&rn.Start&&r-i===0,o=e&(rn.End|rn.Cancel)&&r-i===0;t.isFirst=!!s,t.isFinal=!!o,s&&(n.session={}),t.eventType=e;const l=nJ(n,t);n.emit("hammer.input",l),n.recognize(l),n.session.prevInput=l}let iJ=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=t=>{this.manager.options.enable&&this.handler(t)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){rJ(this.manager,e,t)}init(){Gb(this.element,this.evEl,this.domHandler),Gb(this.target,this.evTarget,this.domHandler),Gb(XR(this.element),this.evWin,this.domHandler)}destroy(){Zb(this.element,this.evEl,this.domHandler),Zb(this.target,this.evTarget,this.domHandler),Zb(XR(this.element),this.evWin,this.domHandler)}};const sJ={pointerdown:rn.Start,pointermove:rn.Move,pointerup:rn.End,pointercancel:rn.Cancel,pointerout:rn.Cancel},oJ="pointerdown",aJ="pointermove pointerup pointercancel";class lJ extends iJ{constructor(e){super(e),this.evEl=oJ,this.evWin=aJ,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:t}=this;let r=!1;const i=sJ[e.type],s=e.pointerType,o=s==="touch";let l=t.findIndex(u=>u.pointerId===e.pointerId);i&rn.Start&&(e.buttons||o)?l<0&&(t.push(e),l=t.length-1):i&(rn.End|rn.Cancel)&&(r=!0),!(l<0)&&(t[l]=e,this.callback(i,{pointers:t,changedPointers:[e],eventType:i,pointerType:s,srcEvent:e}),r&&t.splice(l,1))}}const cJ=["","webkit","Moz","MS","ms","o"];function uJ(n,e){const t=e[0].toUpperCase()+e.slice(1);for(const r of cJ){const i=r?r+t:e;if(i in n)return i}}const hJ=1,ZR=2,QR={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class fJ{constructor(e,t){this.options={...QR,...t,cssProps:{...QR.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new lJ(this),this.touchAction=new KQ(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?ZR:hJ}recognize(e){const{session:t}=this;if(t.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let r;const{recognizers:i}=this;let{curRecognizer:s}=t;(!s||s&&s.state&Xe.Recognized)&&(s=t.curRecognizer=null);let o=0;for(;o<i.length;)r=i[o],t.stopped!==ZR&&(!s||r===s||r.canRecognizeWith(s))?r.recognize(e):r.reset(),!s&&r.state&(Xe.Began|Xe.Changed|Xe.Ended)&&(s=t.curRecognizer=r),o++}get(e){const{recognizers:t}=this;for(let r=0;r<t.length;r++)if(t[r].options.event===e)return t[r];return null}add(e){if(Array.isArray(e)){for(const r of e)this.add(r);return this}const t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const r of e)this.remove(r);return this}const t=typeof e=="string"?this.get(e):e;if(t){const{recognizers:r}=this,i=r.indexOf(t);i!==-1&&(r.splice(i,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;const{handlers:r}=this;for(const i of n_(e))r[i]=r[i]||[],r[i].push(t)}off(e,t){if(!e)return;const{handlers:r}=this;for(const i of n_(e))t?r[i]&&r[i].splice(r[i].indexOf(t),1):delete r[i]}emit(e,t){const r=this.handlers[e]&&this.handlers[e].slice();if(!r||!r.length)return;const i=t;i.type=e,i.preventDefault=function(){t.srcEvent.preventDefault()};let s=0;for(;s<r.length;)r[s](i),s++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:t}=this;if(t){for(const[r,i]of Object.entries(this.options.cssProps)){const s=uJ(t.style,r);e?(this.oldCssProps[s]=t.style[s],t.style[s]=i):t.style[s]=this.oldCssProps[s]||""}e||(this.oldCssProps={})}}}let dJ=1;function pJ(){return dJ++}function JR(n){return n&Xe.Cancelled?"cancel":n&Xe.Ended?"end":n&Xe.Changed?"move":n&Xe.Began?"start":""}class X4{constructor(e){this.options=e,this.id=pJ(),this.state=Xe.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const i of e)this.recognizeWith(i);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{simultaneous:r}=this;return r[t.id]||(r[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const r of e)this.dropRecognizeWith(r);return this}let t;return typeof e=="string"?t=this.manager.get(e):t=e,t&&delete this.simultaneous[t.id],this}requireFailure(e){if(Array.isArray(e)){for(const i of e)this.requireFailure(i);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{requireFail:r}=this;return r.indexOf(t)===-1&&(r.push(t),t.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const r of e)this.dropRequireFailure(r);return this}let t;if(typeof e=="string"?t=this.manager.get(e):t=e,t){const r=this.requireFail.indexOf(t);r>-1&&this.requireFail.splice(r,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:t}=this;t<Xe.Ended&&this.manager.emit(this.options.event+JR(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=Xe.Ended&&this.manager.emit(this.options.event+JR(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=Xe.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(Xe.Failed|Xe.Possible)))return!1;e++}return!0}recognize(e){const t={...e};if(!this.options.enable){this.reset(),this.state=Xe.Failed;return}this.state&(Xe.Recognized|Xe.Cancelled|Xe.Failed)&&(this.state=Xe.Possible),this.state=this.process(t),this.state&(Xe.Began|Xe.Changed|Xe.Ended|Xe.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class Y4 extends X4{attrTest(e){const t=this.options.pointers;return t===0||e.pointers.length===t}process(e){const{state:t}=this,{eventType:r}=e,i=t&(Xe.Began|Xe.Changed),s=this.attrTest(e);return i&&(r&rn.Cancel||!s)?t|Xe.Cancelled:i||s?r&rn.End?t|Xe.Ended:t&Xe.Began?t|Xe.Changed:Xe.Began:Xe.Failed}}class eC extends X4{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[pT]}process(e){const{options:t}=this,r=e.pointers.length===t.pointers,i=e.distance<t.threshold,s=e.deltaTime<t.time;if(this.reset(),e.eventType&rn.Start&&this.count===0)return this.failTimeout();if(i&&s&&r){if(e.eventType!==rn.End)return this.failTimeout();const o=this.pTime?e.timeStamp-this.pTime<t.interval:!0,l=!this.pCenter||$4(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!l||!o?this.count=1:this.count+=1,this._input=e,this.count%t.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=Xe.Recognized,this.tryEmit(this._input)},t.interval),Xe.Began):Xe.Recognized}return Xe.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=Xe.Failed},this.options.interval),Xe.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===Xe.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const gJ=["","start","move","end","cancel","up","down","left","right"];class tC extends Y4{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:dn.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,t=[];return e&dn.Horizontal&&t.push(mT),e&dn.Vertical&&t.push(gT),t}getEventNames(){return gJ.map(e=>this.options.event+e)}directionTest(e){const{options:t}=this;let r=!0,{distance:i}=e,{direction:s}=e;const o=e.deltaX,l=e.deltaY;return s&t.direction||(t.direction&dn.Horizontal?(s=o===0?dn.None:o<0?dn.Left:dn.Right,r=o!==this.pX,i=Math.abs(e.deltaX)):(s=l===0?dn.None:l<0?dn.Up:dn.Down,r=l!==this.pY,i=Math.abs(e.deltaY))),e.direction=s,r&&i>t.threshold&&!!(s&t.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&Xe.Began)||!(this.state&Xe.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const t=dn[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}const mJ=["","start","move","end","cancel","in","out"];class _J extends Y4{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[am]}getEventNames(){return mJ.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&Xe.Began))}emit(e){if(e.scale!==1){const t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}}class H_{constructor(e,t,r){this.element=e,this.callback=t,this.options=r}}const yJ=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",vJ=yJ.indexOf("firefox")!==-1,nC=4.000244140625,bJ=40,TJ=.25;class wJ extends H_{constructor(e,t,r){super(e,t,{enable:!0,...r}),this.handleEvent=i=>{if(!this.options.enable)return;let s=i.deltaY;globalThis.WheelEvent&&(vJ&&i.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(s/=globalThis.devicePixelRatio),i.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(s*=bJ)),s!==0&&s%nC===0&&(s=Math.floor(s/nC)),i.shiftKey&&s&&(s=s*TJ),this.callback({type:"wheel",center:{x:i.clientX,y:i.clientY},delta:-s,srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){e==="wheel"&&(this.options.enable=t)}}const rC=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class EJ extends H_{constructor(e,t,r){super(e,t,{enable:!0,...r}),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,rC.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){rC.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const iC=["keydown","keyup"];class xJ extends H_{constructor(e,t,r){super(e,t,{enable:!0,tabIndex:0,...r}),this.handleEvent=i=>{const s=i.target||i.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:"keydown",srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:"keyup",srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",iC.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){iC.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e==="keydown"&&(this.enableDownEvent=t),e==="keyup"&&(this.enableUpEvent=t)}}class AJ extends H_{constructor(e,t,r){super(e,t,r),this.handleEvent=i=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e==="contextmenu"&&(this.options.enable=t)}}const sC=1,_T=2,oC=4,SJ={pointerdown:sC,pointermove:_T,pointerup:oC,mousedown:sC,mousemove:_T,mouseup:oC},RJ=0,CJ=1,IJ=2,PJ=1,MJ=2,OJ=4;function kJ(n){const e=SJ[n.srcEvent.type];if(!e)return null;const{buttons:t,button:r}=n.srcEvent;let i=!1,s=!1,o=!1;return e===_T?(i=!!(t&PJ),s=!!(t&OJ),o=!!(t&MJ)):(i=r===RJ,s=r===CJ,o=r===IJ),{leftButton:i,middleButton:s,rightButton:o}}function NJ(n,e){const t=n.center;if(!t)return null;const r=e.getBoundingClientRect(),i=r.width/e.offsetWidth||1,s=r.height/e.offsetHeight||1,o={x:(t.x-r.left-e.clientLeft)/i,y:(t.y-r.top-e.clientTop)/s};return{center:t,offsetCenter:o}}const DJ={srcElement:"root",priority:0};class LJ{constructor(e,t){this.handleEvent=r=>{if(this.isEmpty())return;const i=this._normalizeEvent(r);let s=r.srcEvent.target;for(;s&&s!==i.rootElement;){if(this._emit(i,s),i.handled)return;s=s.parentNode}this._emit(i,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,r,i=!1,s=!1){const{handlers:o,handlersByElement:l}=this,u={...DJ,...r};let h=l.get(u.srcElement);h||(h=[],l.set(u.srcElement,h));const d={type:e,handler:t,srcElement:u.srcElement,priority:u.priority};i&&(d.once=!0),s&&(d.passive=!0),o.push(d),this._active=this._active||!d.passive;let g=h.length-1;for(;g>=0&&!(h[g].priority>=d.priority);)g--;h.splice(g+1,0,d)}remove(e,t){const{handlers:r,handlersByElement:i}=this;for(let s=r.length-1;s>=0;s--){const o=r[s];if(o.type===e&&o.handler===t){r.splice(s,1);const l=i.get(o.srcElement);l.splice(l.indexOf(o),1),l.length===0&&i.delete(o.srcElement)}}this._active=r.some(s=>!s.passive)}_emit(e,t){const r=this.handlersByElement.get(t);if(r){let i=!1;const s=()=>{e.handled=!0},o=()=>{e.handled=!0,i=!0},l=[];for(let u=0;u<r.length;u++){const{type:h,handler:d,once:g}=r[u];if(d({...e,type:h,stopPropagation:s,stopImmediatePropagation:o}),g&&l.push(r[u]),i)break}for(let u=0;u<l.length;u++){const{type:h,handler:d}=l[u];this.remove(h,d)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...kJ(e),...NJ(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}function UJ(n){if("recognizer"in n)return n;let e;const t=Array.isArray(n)?[...n]:[n];if(typeof t[0]=="function"){const r=t.shift(),i=t.shift()||{};e=new r(i)}else e=t.shift();return{recognizer:e,recognizeWith:typeof t[0]=="string"?[t[0]]:t[0],requireFailure:typeof t[1]=="string"?[t[1]]:t[1]}}class FJ{constructor(e=null,t={}){if(this._onBasicInput=r=>{this.manager.emit(r.srcEvent.type,r)},this._onOtherEvent=r=>{this.manager.emit(r.type,r)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,!!e){this.manager=new fJ(e,this.options);for(const r of this.options.recognizers){const{recognizer:i,recognizeWith:s,requireFailure:o}=UJ(r);this.manager.add(i),s&&i.recognizeWith(s),o&&i.requireFailure(o)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new wJ(e,this._onOtherEvent,{enable:!1}),this.moveInput=new EJ(e,this._onOtherEvent,{enable:!1}),this.keyInput=new xJ(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new AJ(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,r){this._addEventHandler(e,t,r,!1)}once(e,t,r){this._addEventHandler(e,t,r,!0)}watch(e,t,r){this._addEventHandler(e,t,r,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){const{manager:r}=this;if(!r)return;const i=r.get(e);i&&(i.set({enable:t}),r.touchAction.update()),this.wheelInput?.enableEventType(e,t),this.moveInput?.enableEventType(e,t),this.keyInput?.enableEventType(e,t),this.contextmenuInput?.enableEventType(e,t)}_addEventHandler(e,t,r,i,s){if(typeof e!="string"){r=t;for(const[h,d]of Object.entries(e))this._addEventHandler(h,d,r,i,s);return}const{manager:o,events:l}=this;if(!o)return;let u=l.get(e);if(!u){const h=this._getRecognizerName(e)||e;u=new LJ(this,h),l.set(e,u),o&&o.on(e,u.handleEvent)}u.add(e,t,r,i,s),u.isEmpty()||this._toggleRecognizer(u.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const[s,o]of Object.entries(e))this._removeEventHandler(s,o);return}const{events:r}=this,i=r.get(e);if(i&&(i.remove(e,t),i.isEmpty())){const{recognizerName:s}=i;let o=!1;for(const l of r.values())if(l.recognizerName===s&&!l.isEmpty()){o=!0;break}o||this._toggleRecognizer(s,!1)}}_getRecognizerName(e){return this.manager.recognizers.find(t=>t.getEventNames().includes(e))?.options.event}}const st={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(st,"IDENTITY",{get:()=>(ot.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Sr={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Hs={common:0,meters:1,pixels:2},yT={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},aC={multipan:[tC,{threshold:10,direction:dn.Vertical,pointers:2}],pinch:[_J,{},null,["multipan"]],pan:[tC,{threshold:1},["pinch"],["multipan"]],dblclick:[eC,{event:"dblclick",taps:2}],click:[eC,{event:"click"},null,["dblclick"]]};function BJ(n,e){if(n===e)return!0;if(Array.isArray(n)){const t=n.length;if(!e||e.length!==t)return!1;for(let r=0;r<t;r++)if(n[r]!==e[r])return!1;return!0}return!1}function Md(n){let e={},t;return r=>{for(const i in r)if(!BJ(r[i],e[i])){t=n(r),e=r;break}return t}}const lC=[0,0,0,0],VJ=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],K4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],zJ=[0,0,0],G4=[0,0,0],jJ=Md(WJ);function Z4(n,e,t=G4){t.length<3&&(t=[t[0],t[1],0]);let r=t,i,s=!0;switch(e===st.LNGLAT_OFFSETS||e===st.METER_OFFSETS?i=t:i=n.isGeospatial?[Math.fround(n.longitude),Math.fround(n.latitude),0]:null,n.projectionMode){case Sr.WEB_MERCATOR:(e===st.LNGLAT||e===st.CARTESIAN)&&(i=[0,0,0],s=!1);break;case Sr.WEB_MERCATOR_AUTO_OFFSET:e===st.LNGLAT?r=i:e===st.CARTESIAN&&(r=[Math.fround(n.center[0]),Math.fround(n.center[1]),0],i=n.unprojectPosition(r),r[0]-=t[0],r[1]-=t[1],r[2]-=t[2]);break;case Sr.IDENTITY:r=n.position.map(Math.fround),r[2]=r[2]||0;break;case Sr.GLOBE:s=!1,i=null;break;default:s=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:r,offsetMode:s}}function HJ(n,e,t){const{viewMatrixUncentered:r,projectionMatrix:i}=n;let{viewMatrix:s,viewProjectionMatrix:o}=n,l=lC,u=lC,h=n.cameraPosition;const{geospatialOrigin:d,shaderCoordinateOrigin:g,offsetMode:y}=Z4(n,e,t);return y&&(u=n.projectPosition(d||g),h=[h[0]-u[0],h[1]-u[1],h[2]-u[2]],u[3]=1,l=$u([],u,o),s=r||s,o=dl([],i,s),o=dl([],o,VJ)),{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:l,originCommon:u,cameraPosCommon:h,shaderCoordinateOrigin:g,geospatialOrigin:d}}function $J({viewport:n,devicePixelRatio:e=1,modelMatrix:t=null,coordinateSystem:r=st.DEFAULT,coordinateOrigin:i=G4,autoWrapLongitude:s=!1}){r===st.DEFAULT&&(r=n.isGeospatial?st.LNGLAT:st.CARTESIAN);const o=jJ({viewport:n,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:i});return o.wrapLongitude=s,o.modelMatrix=t||K4,o}function WJ({viewport:n,devicePixelRatio:e,coordinateSystem:t,coordinateOrigin:r}){const{projectionCenter:i,viewProjectionMatrix:s,originCommon:o,cameraPosCommon:l,shaderCoordinateOrigin:u,geospatialOrigin:h}=HJ(n,t,r),d=n.getDistanceScales(),g=[n.width*e,n.height*e],y=$u([],[0,0,-n.focalDistance,1],n.projectionMatrix)[3]||1,b={coordinateSystem:t,projectionMode:n.projectionMode,coordinateOrigin:u,commonOrigin:o.slice(0,3),center:i,pseudoMeters:!!n._pseudoMeters,viewportSize:g,devicePixelRatio:e,focalDistance:y,commonUnitsPerMeter:d.unitsPerMeter,commonUnitsPerWorldUnit:d.unitsPerMeter,commonUnitsPerWorldUnit2:zJ,scale:n.scale,wrapLongitude:!1,viewProjectionMatrix:s,modelMatrix:K4,cameraPosition:l};if(h){const w=n.getDistanceScales(h);switch(t){case st.METER_OFFSETS:b.commonUnitsPerWorldUnit=w.unitsPerMeter,b.commonUnitsPerWorldUnit2=w.unitsPerMeter2;break;case st.LNGLAT:case st.LNGLAT_OFFSETS:n._pseudoMeters||(b.commonUnitsPerMeter=w.unitsPerMeter),b.commonUnitsPerWorldUnit=w.unitsPerDegree,b.commonUnitsPerWorldUnit2=w.unitsPerDegree2;break;case st.CARTESIAN:b.commonUnitsPerWorldUnit=[1,1,w.unitsPerMeter[2]],b.commonUnitsPerWorldUnit2=[0,0,w.unitsPerMeter2[2]];break}}return b}const qJ=Object.keys(st).map(n=>`const COORDINATE_SYSTEM_${n}: i32 = ${st[n]};`).join(""),XJ=Object.keys(Sr).map(n=>`const PROJECTION_MODE_${n}: i32 = ${Sr[n]};`).join(""),YJ=Object.keys(Hs).map(n=>`const UNIT_${n.toUpperCase()}: i32 = ${Hs[n]};`).join(""),KJ=`${qJ}
${XJ}
${YJ}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,GJ=`${KJ}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the zaxis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,ZJ=Object.keys(st).map(n=>`const int COORDINATE_SYSTEM_${n} = ${st[n]};`).join(""),QJ=Object.keys(Sr).map(n=>`const int PROJECTION_MODE_${n} = ${Sr[n]};`).join(""),JJ=Object.keys(Hs).map(n=>`const int UNIT_${n.toUpperCase()} = ${Hs[n]};`).join(""),eee=`${ZJ}
${QJ}
${JJ}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,tee={};function nee(n=tee){return"viewport"in n?$J(n):{}}const LE={name:"project",dependencies:[AQ,j4],source:GJ,vs:eee,getUniforms:nee,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},ree=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,iee=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Wu={name:"project32",dependencies:[LE],source:ree,vs:iee};function see(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function su(n,e){const t=$u([],e,n);return DE(t,t,1/t[3]),t}function cC(n,e){const t=n%e;return t<0?e+t:t}function vT(n,e,t){return n<e?e:n>t?t:n}function oee(n){return Math.log(n)*Math.LOG2E}const UE=Math.log2||oee;function $s(n,e){if(!n)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const ci=Math.PI,Q4=ci/4,Wr=ci/180,bT=180/ci,wu=512,r_=4003e4,$c=85.051129,aee=1.5;function lee(n){return UE(n)}function ma(n){const[e,t]=n;$s(Number.isFinite(e)),$s(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const r=e*Wr,i=t*Wr,s=wu*(r+ci)/(2*ci),o=wu*(ci+Math.log(Math.tan(Q4+i*.5)))/(2*ci);return[s,o]}function Eu(n){const[e,t]=n,r=e/wu*(2*ci)-ci,i=2*(Math.atan(Math.exp(t/wu*(2*ci)-ci))-Q4);return[r*bT,i*bT]}function cee(n){const{latitude:e}=n;$s(Number.isFinite(e));const t=Math.cos(e*Wr);return lee(r_*t)-9}function Qb(n){const e=Math.cos(n*Wr);return wu/r_/e}function TT(n){const{latitude:e,longitude:t,highPrecision:r=!1}=n;$s(Number.isFinite(e)&&Number.isFinite(t));const i=wu,s=Math.cos(e*Wr),o=i/360,l=o/s,u=i/r_/s,h={unitsPerMeter:[u,u,u],metersPerUnit:[1/u,1/u,1/u],unitsPerDegree:[o,l,u],degreesPerUnit:[1/o,1/l,1/u]};if(r){const d=Wr*Math.tan(e*Wr)/s,g=o*d/2,y=i/r_*d,b=y/l*u;h.unitsPerDegree2=[0,g,y],h.unitsPerMeter2=[b,0,b]}return h}function J4(n,e){const[t,r,i]=n,[s,o,l]=e,{unitsPerMeter:u,unitsPerMeter2:h}=TT({longitude:t,latitude:r,highPrecision:!0}),d=ma(n);d[0]+=s*(u[0]+h[0]*o),d[1]+=o*(u[1]+h[1]*o);const g=Eu(d),y=(i||0)+(l||0);return Number.isFinite(i)||Number.isFinite(l)?[g[0],g[1],y]:g}function uee(n){const{height:e,pitch:t,bearing:r,altitude:i,scale:s,center:o}=n,l=see();t_(l,l,[0,0,-i]),k4(l,l,-t*Wr),N4(l,l,r*Wr);const u=s/e;return NE(l,l,[u,u,u]),o&&t_(l,l,gZ([],o)),l}function hee(n){const{width:e,height:t,altitude:r,pitch:i=0,offset:s,center:o,scale:l,nearZMultiplier:u=1,farZMultiplier:h=1}=n;let{fovy:d=id(aee)}=n;r!==void 0&&(d=id(r));const g=d*Wr,y=i*Wr,b=FE(d);let w=b;o&&(w+=o[2]*l/Math.cos(y)/t);const E=g*(.5+(s?s[1]:0)/t),x=Math.sin(E)*w/Math.sin(vT(Math.PI/2-y-E,.01,Math.PI-.01)),C=Math.sin(y)*x+w,M=w*10,O=Math.min(C*h,M);return{fov:g,aspect:e/t,focalDistance:b,near:u,far:O}}function id(n){return 2*Math.atan(.5/n)*bT}function FE(n){return .5/Math.tan(.5*n*Wr)}function eD(n,e){const[t,r,i=0]=n;return $s(Number.isFinite(t)&&Number.isFinite(r)&&Number.isFinite(i)),su(e,[t,r,i,1])}function BE(n,e,t=0){const[r,i,s]=n;if($s(Number.isFinite(r)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(s))return su(e,[r,i,s,1]);const o=su(e,[r,i,0,1]),l=su(e,[r,i,1,1]),u=o[2],h=l[2],d=u===h?0:((t||0)-u)/(h-u);return E4([],o,l,d)}function fee(n){const{width:e,height:t,bounds:r,minExtent:i=0,maxZoom:s=24,offset:o=[0,0]}=n,[[l,u],[h,d]]=r,g=dee(n.padding),y=ma([l,vT(d,-$c,$c)]),b=ma([h,vT(u,-$c,$c)]),w=[Math.max(Math.abs(b[0]-y[0]),i),Math.max(Math.abs(b[1]-y[1]),i)],E=[e-g.left-g.right-Math.abs(o[0])*2,t-g.top-g.bottom-Math.abs(o[1])*2];$s(E[0]>0&&E[1]>0);const x=E[0]/w[0],C=E[1]/w[1],M=(g.right-g.left)/2/x,O=(g.top-g.bottom)/2/C,V=[(b[0]+y[0])/2+M,(b[1]+y[1])/2+O],H=Eu(V),G=Math.min(s,UE(Math.abs(Math.min(x,C))));return $s(Number.isFinite(G)),{longitude:H[0],latitude:H[1],zoom:G}}function dee(n=0){return typeof n=="number"?{top:n,bottom:n,left:n,right:n}:($s(Number.isFinite(n.top)&&Number.isFinite(n.bottom)&&Number.isFinite(n.left)&&Number.isFinite(n.right)),n)}const uC=Math.PI/180;function pee(n,e=0){const{width:t,height:r,unproject:i}=n,s={targetZ:e},o=i([0,r],s),l=i([t,r],s);let u,h;const d=n.fovy?.5*n.fovy*uC:Math.atan(.5/n.altitude),g=(90-n.pitch)*uC;return d>g-.01?(u=hC(n,0,e),h=hC(n,t,e)):(u=i([0,0],s),h=i([t,0],s)),[o,l,h,u]}function hC(n,e,t){const{pixelUnprojectionMatrix:r}=n,i=su(r,[e,0,1,1]),s=su(r,[e,n.height,1,1]),l=(t*n.distanceScales.unitsPerMeter[2]-i[2])/(s[2]-i[2]),u=E4([],i,s,l),h=Eu(u);return h.push(t),h}const fC=512;function gee(n){const{width:e,height:t,pitch:r=0}=n;let{longitude:i,latitude:s,zoom:o,bearing:l=0}=n;(i<-180||i>180)&&(i=cC(i+180,360)-180),(l<-180||l>180)&&(l=cC(l+180,360)-180);const u=UE(t/fC);if(o<=u)o=u,s=0;else{const h=t/2/Math.pow(2,o),d=Eu([0,h])[1];if(s<d)s=d;else{const g=Eu([0,fC-h])[1];s>g&&(s=g)}}return{width:e,height:t,longitude:i,latitude:s,zoom:o,pitch:r,bearing:l}}const tD=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,mee=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,_ee=`
${tD}
${mee}
`,yee=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,vee=`
${tD}
${yee}
`,bee=Md(Aee),Tee=Md(See),wee=[0,0,0,1],Eee=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function xee(n,e){const[t,r,i]=n,s=BE([t,r,i],e);return Number.isFinite(i)?s:[s[0],s[1],0]}function Aee({viewport:n,center:e}){return new rr(n.viewProjectionMatrix).invert().transform(e)}function See({viewport:n,shadowMatrices:e}){const t=[],r=n.pixelUnprojectionMatrix,i=n.isGeospatial?void 0:1,s=[[0,0,i],[n.width,0,i],[0,n.height,i],[n.width,n.height,i],[0,0,-1],[n.width,0,-1],[0,n.height,-1],[n.width,n.height,-1]].map(o=>xee(o,r));for(const o of e){const l=o.clone().translate(new Pe(n.center).negate()),u=s.map(d=>l.transform(d)),h=new rr().ortho({left:Math.min(...u.map(d=>d[0])),right:Math.max(...u.map(d=>d[0])),bottom:Math.min(...u.map(d=>d[1])),top:Math.max(...u.map(d=>d[1])),near:Math.min(...u.map(d=>-d[2])),far:Math.max(...u.map(d=>-d[2]))});t.push(h.multiplyRight(o))}return t}function Ree(n){const{shadowEnabled:e=!0,project:t}=n;if(!e||!t||!n.shadowMatrices||!n.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};const r=LE.getUniforms(t),i=bee({viewport:t.viewport,center:r.center}),s=[],o=Tee({shadowMatrices:n.shadowMatrices,viewport:t.viewport}).slice();for(let u=0;u<n.shadowMatrices.length;u++){const h=o[u],d=h.clone().translate(new Pe(t.viewport.center).negate());r.coordinateSystem===st.LNGLAT&&r.projectionMode===Sr.WEB_MERCATOR?(o[u]=d,s[u]=i):(o[u]=h.clone().multiplyRight(Eee),s[u]=d.transform(i))}const l={drawShadowMap:!!n.drawToShadowMap,useShadowMap:n.shadowMaps?n.shadowMaps.length>0:!1,color:n.shadowColor||wee,lightId:n.shadowLightId||0,lightCount:n.shadowMatrices.length,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};for(let u=0;u<o.length;u++)l[`viewProjectionMatrix${u}`]=o[u],l[`projectCenter${u}`]=s[u];for(let u=0;u<2;u++)l[`shadow_uShadowMap${u}`]=n.shadowMaps&&n.shadowMaps[u]||n.dummyShadowMap;return l}const dC={name:"shadow",dependencies:[LE],vs:_ee,fs:vee,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:Ree,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},qu={...$R,defaultUniforms:{...$R.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},Cee=[j4],Iee=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],Pee=[];function Mee(n){const e=ll.getDefaultShaderAssembler();for(const r of Cee)e.addDefaultModule(r);const t=n==="glsl"?Iee:Pee;for(const r of t)e.addShaderHook(r);return e}const Oee=[255,255,255],kee=1;let Nee=0;class Dee{constructor(e={}){this.type="ambient";const{color:t=Oee}=e,{intensity:r=kee}=e;this.id=e.id||`ambient-${Nee++}`,this.color=t,this.intensity=r}}const Lee=[255,255,255],Uee=1,Fee=[0,0,-1];let Bee=0;class pC{constructor(e={}){this.type="directional";const{color:t=Lee}=e,{intensity:r=Uee}=e,{direction:i=Fee}=e,{_shadow:s=!1}=e;this.id=e.id||`directional-${Bee++}`,this.color=t,this.intensity=r,this.type="directional",this.direction=new Pe(i).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}}class Vee{constructor(e,t={id:"pass"}){const{id:r}=t;this.id=r,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class VE extends Vee{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[t,r]=this.device.canvasContext.getDrawingBufferSize(),i=e.clearCanvas??!0,s=e.clearColor??(i?[0,0,0,0]:!1),o=i?1:!1,l=i?0:!1,u=e.colorMask??15,h={viewport:[0,0,t,r]};e.colorMask&&(h.colorMask=u),e.scissorRect&&(h.scissorRect=e.scissorRect);const d=this.device.beginRenderPass({framebuffer:e.target,parameters:h,clearColor:s,clearDepth:o,clearStencil:l});try{return this._drawLayers(d,e)}finally{d.end(),this.device.submit()}}_drawLayers(e,t){const{target:r,shaderModuleProps:i,viewports:s,views:o,onViewportActive:l,clearStack:u=!0}=t;t.pass=t.pass||"unknown",u&&(this._lastRenderIndex=-1);const h=[];for(const d of s){const g=o&&o[d.id];l?.(d);const y=this._getDrawLayerParams(d,t),b=d.subViewports||[d];for(const w of b){const E=this._drawLayersInViewport(e,{target:r,shaderModuleProps:i,viewport:w,view:g,pass:t.pass,layers:t.layers},y);h.push(E)}}return h}_getDrawLayerParams(e,{layers:t,pass:r,isPicking:i=!1,layerFilter:s,cullRect:o,effects:l,shaderModuleProps:u},h=!1){const d=[],g=nD(this._lastRenderIndex+1),y={layer:t[0],viewport:e,isPicking:i,renderPass:r,cullRect:o},b={};for(let w=0;w<t.length;w++){const E=t[w],x=this._shouldDrawLayer(E,y,s,b),C={shouldDrawLayer:x};x&&!h&&(C.shouldDrawLayer=!0,C.layerRenderIndex=g(E,x),C.shaderModuleProps=this._getShaderModuleProps(E,l,r,u),C.layerParameters={...E.context.deck?.props.parameters,...this.getLayerParameters(E,w,e)}),d[w]=C}return d}_drawLayersInViewport(e,{layers:t,shaderModuleProps:r,pass:i,target:s,viewport:o,view:l},u){const h=zee(this.device,{shaderModuleProps:r,target:s,viewport:o});if(l&&l.props.clear){const g=l.props.clear===!0?{color:!0,depth:!0}:l.props.clear;this.device.beginRenderPass({framebuffer:s,parameters:{viewport:h,scissorRect:h},clearColor:g.color?[0,0,0,0]:!1,clearDepth:g.depth?1:!1}).end()}const d={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:h});for(let g=0;g<t.length;g++){const y=t[g],b=u[g],{shouldDrawLayer:w}=b;if(w&&y.props.pickable&&d.pickableCount++,y.isComposite&&d.compositeCount++,y.isDrawable&&b.shouldDrawLayer){const{layerRenderIndex:E,shaderModuleProps:x,layerParameters:C}=b;d.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,E),x.project&&(x.project.viewport=o),y.context.renderPass=e;try{y._drawLayer({renderPass:e,shaderModuleProps:x,uniforms:{layerIndex:E},parameters:C})}catch(M){y.raiseError(M,`drawing ${y} to ${i}`)}}}return d}shouldDrawLayer(e){return!0}getShaderModuleProps(e,t,r){return null}getLayerParameters(e,t,r){return e.props.parameters}_shouldDrawLayer(e,t,r,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(t))return!1;t.layer=o,o=o.parent}if(r){const l=t.layer.id;if(l in i||(i[l]=r(t)),!i[l])return!1}return e.activateViewport(t.viewport),!0}_getShaderModuleProps(e,t,r,i){const s=this.device.canvasContext.cssToDeviceRatio(),o=e.internalState?.propsInTransition||e.props,l={layer:o,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:s,modelMatrix:o.modelMatrix,coordinateSystem:o.coordinateSystem,coordinateOrigin:o.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(t)for(const u of t)gC(l,u.getShaderModuleProps?.(e,l));return gC(l,this.getShaderModuleProps(e,t,l),i)}}function nD(n=0,e={}){const t={},r=(i,s)=>{const o=i.props._offset,l=i.id,u=i.parent&&i.parent.id;let h;if(u&&!(u in e)&&r(i.parent,!1),u in t){const d=t[u]=t[u]||nD(e[u],e);h=d(i,s),t[l]=d}else Number.isFinite(o)?(h=o+(e[u]||0),t[l]=null):h=n;return s&&h>=n&&(n=h+1),e[l]=h,h};return r}function zee(n,{shaderModuleProps:e,target:t,viewport:r}){const i=e?.project?.devicePixelRatio??n.canvasContext.cssToDeviceRatio(),[,s]=n.canvasContext.getDrawingBufferSize(),o=t?t.height:s,l=r;return[l.x*i,o-(l.y+l.height)*i,l.width*i,l.height*i]}function gC(n,...e){for(const t of e)if(t)for(const r in t)n[r]?Object.assign(n[r],t[r]):n[r]=t[r];return n}class jee extends VE{constructor(e,t){super(e,t);const r=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),i=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[r],depthStencilAttachment:i})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const t=this.fbo,r=this.device.canvasContext.cssToDeviceRatio(),i=e.viewports[0],s=i.width*r,o=i.height*r,l=[1,1,1,1];(s!==t.width||o!==t.height)&&t.resize({width:s,height:o}),super.render({...e,clearColor:l,target:t,pass:"shadow"})}getLayerParameters(e,t,r){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,t,r){return{shadow:{project:r.project,drawToShadowMap:!0}}}}const Hee={color:[255,255,255],intensity:1},mC=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],$ee=[0,0,0,200/255];class rD{constructor(e={}){this.id="lighting-effect",this.shadowColor=$ee,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:t,deck:r}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),r._addDefaultShaderModule(dC),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const t in e){const r=e[t];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:r,onViewportActive:i,views:s}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let o=0;o<this.shadowPasses.length;o++)this.shadowPasses[o].render({layers:e,layerFilter:t,viewports:r,onViewportActive:i,views:s,shaderModuleProps:{shadow:{shadowLightId:o,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,t){const r=this.shadow?{project:t.project,shadowMaps:this.shadowPasses.map(o=>o.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},i={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(o=>o.getProjectedLight({layer:e})),pointLights:this.pointLights.map(o=>o.getProjectedLight({layer:e}))},s=e.props.material;return{shadow:r,lighting:i,phongMaterial:s,gouraudMaterial:s}}cleanup(e){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(dC))}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const r=new rr().lookAt({eye:new Pe(t.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const r=new jee(e);this.shadowPasses[t]=r}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:r}=this;!e&&t.length===0&&r.length===0&&(this.ambientLight=new Dee(Hee),this.directionalLights.push(new pC(mC[0]),new pC(mC[1])))}}class Wee{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:r=1,type:i,padding:s=0,copy:o=!1,initialize:l=!1,maxCount:u}){const h=i||e&&e.constructor||Float32Array,d=t*r+s;if(ArrayBuffer.isView(e)){if(d<=e.length)return e;if(d*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new h(e.buffer,0,d)}let g=1/0;u&&(g=u*r+s);const y=this._allocate(h,d,l,g);return e&&o?y.set(e):l||y.fill(0,0,4),this._release(e),y}release(e){this._release(e)}_allocate(e,t,r,i){let s=Math.max(Math.ceil(t*this.opts.overAlloc),1);s>i&&(s=i);const o=this._pool,l=e.BYTES_PER_ELEMENT*s,u=o.findIndex(h=>h.byteLength>=l);if(u>=0){const h=new e(o.splice(u,1)[0],0,s);return r&&h.fill(0),h}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:r}=e,{byteLength:i}=r,s=t.findIndex(o=>o.byteLength>=i);s<0?t.push(r):(s>0||t.length<this.opts.poolSize)&&t.splice(s,0,r),t.length>this.opts.poolSize&&t.shift()}}const xu=new Wee;function yf(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function qee(n){return[n[12],n[13],n[14]]}function Xee(n){return{left:kc(n[3]+n[0],n[7]+n[4],n[11]+n[8],n[15]+n[12]),right:kc(n[3]-n[0],n[7]-n[4],n[11]-n[8],n[15]-n[12]),bottom:kc(n[3]+n[1],n[7]+n[5],n[11]+n[9],n[15]+n[13]),top:kc(n[3]-n[1],n[7]-n[5],n[11]-n[9],n[15]-n[13]),near:kc(n[3]+n[2],n[7]+n[6],n[11]+n[10],n[15]+n[14]),far:kc(n[3]-n[2],n[7]-n[6],n[11]-n[10],n[15]-n[14])}}const _C=new Pe;function kc(n,e,t,r){_C.set(n,e,t);const i=_C.len();return{distance:r/i,normal:new Pe(-n/i,-e/i,-t/i)}}function Yee(n){return n-Math.fround(n)}let sf;function Jb(n,e){const{size:t=1,startIndex:r=0}=e,i=e.endIndex!==void 0?e.endIndex:n.length,s=(i-r)/t;sf=xu.allocate(sf,s,{type:Float32Array,size:t*2});let o=r,l=0;for(;o<i;){for(let u=0;u<t;u++){const h=n[o++];sf[l+u]=h,sf[l+u+t]=Yee(h)}l+=t*2}return sf.subarray(0,s*t*2)}function Kee(n){let e=null,t=!1;for(const r of n)r&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const Gee=Math.PI/180,Zee=yf(),yC=[0,0,0],Qee={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function Jee({width:n,height:e,orthographic:t,fovyRadians:r,focalDistance:i,padding:s,near:o,far:l}){const u=n/e,h=t?new rr().orthographic({fovy:r,aspect:u,focalDistance:i,near:o,far:l}):new rr().perspective({fovy:r,aspect:u,near:o,far:l});if(s){const{left:d=0,right:g=0,top:y=0,bottom:b=0}=s,w=Ko((d+n-g)/2,0,n)-n/2,E=Ko((y+e-b)/2,0,e)-e/2;h[8]-=w*2/n,h[9]+=E*2/e}return h}class Xu{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||Qee,this.focalDistance=e.focalDistance||1,this.position=e.position||yC,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Sr.WEB_MERCATOR:Sr.WEB_MERCATOR_AUTO_OFFSET:Sr.IDENTITY}equals(e){return e instanceof Xu?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Ns(e.projectionMatrix,this.projectionMatrix)&&Ns(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:t=!0}={}){const r=this.projectPosition(e),i=eD(r,this.pixelProjectionMatrix),[s,o]=i,l=t?o:this.height-o;return e.length===2?[s,l]:[s,l,i[2]]}unproject(e,{topLeft:t=!0,targetZ:r}={}){const[i,s,o]=e,l=t?s:this.height-s,u=r&&r*this.distanceScales.unitsPerMeter[2],h=BE([i,l,o],this.pixelUnprojectionMatrix,u),[d,g,y]=this.unprojectPosition(h);return Number.isFinite(o)?[d,g,y]:Number.isFinite(r)?[d,g,r]:[d,g]}projectPosition(e){const[t,r]=this.projectFlat(e),i=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,r,i]}unprojectPosition(e){const[t,r]=this.unprojectFlat(e),i=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,r,i]}projectFlat(e){if(this.isGeospatial){const t=ma(e);return t[1]=Ko(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?Eu(e):e}getBounds(e={}){const t={targetZ:e.z||0},r=this.unproject([0,0],t),i=this.unproject([this.width,0],t),s=this.unproject([0,this.height],t),o=this.unproject([this.width,this.height],t);return[Math.min(r[0],i[0],s[0],o[0]),Math.min(r[1],i[1],s[1],o[1]),Math.max(r[0],i[0],s[0],o[0]),Math.max(r[1],i[1],s[1],o[1])]}getDistanceScales(e){return e&&this.isGeospatial?TT({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:r=1,height:i=1}){return e<this.x+this.width&&this.x<e+r&&t<this.y+this.height&&this.y<t+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,Xee(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=cee({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||TT({latitude:r,longitude:t}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:s,modelMatrix:o}=e;let l=yC;if(s&&(l=o?new rr(o).transformAsVector(s,[]):s),this.isGeospatial){const u=this.projectPosition([t,r,0]);this.center=new Pe(l).scale(this.distanceScales.unitsPerMeter).add(u)}else this.center=this.projectPosition(l)}_initMatrices(e){const{viewMatrix:t=Zee,projectionMatrix:r=null,orthographic:i=!1,fovyRadians:s,fovy:o=75,near:l=.1,far:u=1e3,padding:h=null,focalDistance:d=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new rr().multiplyRight(t).translate(new Pe(this.center).negate()),this.projectionMatrix=r||Jee({width:this.width,height:this.height,orthographic:i,fovyRadians:s||o*Gee,focalDistance:d,padding:h,near:l,far:u});const g=yf();dl(g,g,this.projectionMatrix),dl(g,g,this.viewMatrix),this.viewProjectionMatrix=g,this.viewMatrixInverse=fT([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=qee(this.viewMatrixInverse);const y=yf(),b=yf();NE(y,y,[this.width/2,-this.height/2,1]),t_(y,y,[1,-1,0]),dl(b,y,this.viewProjectionMatrix),this.pixelProjectionMatrix=b,this.pixelUnprojectionMatrix=fT(yf(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||ot.warn("Pixel project matrix not invertible")()}}Xu.displayName="Viewport";class Ws extends Xu{constructor(e={}){const{latitude:t=0,longitude:r=0,zoom:i=0,pitch:s=0,bearing:o=0,nearZMultiplier:l=.1,farZMultiplier:u=1.01,nearZ:h,farZ:d,orthographic:g=!1,projectionMatrix:y,repeat:b=!1,worldOffset:w=0,position:E,padding:x,legacyMeterSizes:C=!1}=e;let{width:M,height:O,altitude:V=1.5}=e;const H=Math.pow(2,i);M=M||1,O=O||1;let G,D=null;if(y)V=y[5]/2,G=id(V);else{e.fovy?(G=e.fovy,V=FE(G)):G=id(V);let N;if(x){const{top:j=0,bottom:W=0}=x;N=[0,Ko((j+O-W)/2,0,O)-O/2]}D=hee({width:M,height:O,scale:H,center:E&&[0,0,E[2]*Qb(t)],offset:N,pitch:s,fovy:G,nearZMultiplier:l,farZMultiplier:u}),Number.isFinite(h)&&(D.near=h),Number.isFinite(d)&&(D.far=d)}let I=uee({height:O,pitch:s,bearing:o,scale:H,altitude:V});w&&(I=new rr().translate([512*w,0,0]).multiplyLeft(I)),super({...e,width:M,height:O,viewMatrix:I,longitude:r,latitude:t,zoom:i,...D,fovy:G,focalDistance:V}),this.latitude=t,this.longitude=r,this.zoom=i,this.pitch=s,this.bearing=o,this.altitude=V,this.fovy=G,this.orthographic=g,this._subViewports=b?[]:null,this._pseudoMeters=C,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let i=t;i<=r;i++){const s=i?new Ws({...this,worldOffset:i}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,r]=this.projectFlat(e),i=(e[2]||0)*Qb(e[1]);return[t,r,i]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,r]=this.unprojectFlat(e),i=(e[2]||0)/Qb(r);return[t,r,i]}addMetersToLngLat(e,t){return J4(e,t)}panByPosition(e,t){const r=BE(t,this.pixelUnprojectionMatrix),i=this.projectFlat(e),s=LR([],i,oZ([],r)),o=LR([],this.center,s),[l,u]=this.unprojectFlat(o);return{longitude:l,latitude:u}}getBounds(e={}){const t=pee(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:r,height:i}=this,{longitude:s,latitude:o,zoom:l}=fee({width:r,height:i,bounds:e,...t});return new Ws({width:r,height:i,longitude:s,latitude:o,zoom:l})}}Ws.displayName="WebMercatorViewport";const vC=[0,0,0];function e0(n,e,t=!1){const r=e.projectPosition(n);if(t&&e instanceof Ws){const[i,s,o=0]=n,l=e.getDistanceScales([i,s]);r[2]=o*l.unitsPerMeter[2]}return r}function ete(n){const{viewport:e,modelMatrix:t,coordinateOrigin:r}=n;let{coordinateSystem:i,fromCoordinateSystem:s,fromCoordinateOrigin:o}=n;return i===st.DEFAULT&&(i=e.isGeospatial?st.LNGLAT:st.CARTESIAN),s===void 0&&(s=i),o===void 0&&(o=r),{viewport:e,coordinateSystem:i,coordinateOrigin:r,modelMatrix:t,fromCoordinateSystem:s,fromCoordinateOrigin:o}}function iD(n,{viewport:e,modelMatrix:t,coordinateSystem:r,coordinateOrigin:i,offsetMode:s}){let[o,l,u=0]=n;switch(t&&([o,l,u]=$u([],[o,l,u,1],t)),r){case st.LNGLAT:return e0([o,l,u],e,s);case st.LNGLAT_OFFSETS:return e0([o+i[0],l+i[1],u+(i[2]||0)],e,s);case st.METER_OFFSETS:return e0(J4(i,[o,l,u]),e,s);case st.CARTESIAN:default:return e.isGeospatial?[o+i[0],l+i[1],u+i[2]]:e.projectPosition([o,l,u])}}function tte(n,e){const{viewport:t,coordinateSystem:r,coordinateOrigin:i,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:l}=ete(e),{autoOffset:u=!0}=e,{geospatialOrigin:h=vC,shaderCoordinateOrigin:d=vC,offsetMode:g=!1}=u?Z4(t,r,i):{},y=iD(n,{viewport:t,modelMatrix:s,coordinateSystem:o,coordinateOrigin:l,offsetMode:g});if(g){const b=t.projectPosition(h||d);P4(y,y,b)}return y}let nte=1,rte=1;class sD{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(e){const{delay:t=0,duration:r=Number.POSITIVE_INFINITY,rate:i=1,repeat:s=1}=e,o=nte++,l={time:0,delay:t,duration:r,rate:i,repeat:s};return this._setChannelTime(l,this.time),this.channels.set(o,l),o}removeChannel(e){this.channels.delete(e);for(const[t,r]of this.animations)r.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;const t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const i of t)this._setChannelTime(i,this.time);const r=this.animations.values();for(const i of r){const{animation:s,channel:o}=i;s.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const r=rte++;return this.animations.set(r,{animation:e,channel:t}),e.setTime(this.getTime(t)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const r=t-e.delay,i=e.duration*e.repeat;r>=i?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}function ite(n){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(n):setTimeout(n,1e3/60)}function ste(n){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(n):clearTimeout(n)}let ote=0;const ate={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:n=>console.error(n),stats:aT.stats.get(`animation-loop-${ote++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class lte{device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;_error=null;constructor(e){if(this.props={...ate,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:t=!0}=this.props;this.stats=e.stats||new Cd({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:t}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){if(this.props.onError(e),this._error=Error(),this.device?.canvasContext?.canvas instanceof HTMLCanvasElement){const r=document.createElement("h1");r.innerHTML=e.message,r.style.position="absolute",r.style.top="20%",r.style.left="10px",r.style.color="black",r.style.backgroundColor="red",document.body.appendChild(r)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=ite(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(ste(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device?.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){const e=this.device?.canvasContext?.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.canvasContext?.canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const r=this.props.onAddHTML(t);r&&(t.innerHTML=r)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};const[e,t]=this.device?.canvasContext?.getPixelSize()||[1,1];let r=1;const i=this.device?.canvasContext?.canvas;return i&&i.clientHeight?r=i.clientWidth/i.clientHeight:e>0&&t>0&&(r=e/t),{width:e,height:t,aspect:r}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.props.autoResizeDrawingBuffer&&this.device?.canvasContext?.resize({useDevicePixels:this.props.useDevicePixels})}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const t0={};function $_(n="id"){t0[n]=t0[n]||1;const e=t0[n]++;return`${n}-${e}`}class bC{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(e){if(this.id=e.id||$_("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&Ft.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){this.indices?.destroy();for(const e of Object.values(this.attributes))e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function cte(n,e){if(e instanceof bC)return e;const t=ute(n,e),{attributes:r,bufferLayout:i}=hte(n,e);return new bC({topology:e.topology||"triangle-list",bufferLayout:i,vertexCount:e.vertexCount,indices:t,attributes:r})}function ute(n,e){if(!e.indices)return;const t=e.indices.value;return n.createBuffer({usage:Ft.INDEX,data:t})}function hte(n,e){const t=[],r={};for(const[s,o]of Object.entries(e.attributes)){let l=s;switch(s){case"POSITION":l="positions";break;case"NORMAL":l="normals";break;case"TEXCOORD_0":l="texCoords";break;case"COLOR_0":l="colors";break}if(o){r[l]=n.createBuffer({data:o.value,id:`${s}-buffer`});const{value:u,size:h,normalized:d}=o;t.push({name:l,format:bG(u,h,d)})}}const i=e._calculateVertexCount(e.attributes,e.indices);return{attributes:r,bufferLayout:t,vertexCount:i}}class zE{static defaultProps={...bu.defaultProps};static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new zE(e),e._lumaData.defaultPipelineFactory}device;destroyPolicy;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};constructor(e){this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}createRenderPipeline(e){const t={...bu.defaultProps,...e},r=this._hashRenderPipeline(t);if(!this._renderPipelineCache[r]){const i=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:void 0});i.hash=r,this._renderPipelineCache[r]={pipeline:i,useCount:0}}return this._renderPipelineCache[r].useCount++,this._renderPipelineCache[r].pipeline}createComputePipeline(e){const t={...Ym.defaultProps,...e},r=this._hashComputePipeline(t);if(!this._computePipelineCache[r]){const i=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0});i.hash=r,this._computePipelineCache[r]={pipeline:i,useCount:0}}return this._computePipelineCache[r].useCount++,this._computePipelineCache[r].pipeline}release(e){const t=e.hash,r=e instanceof Ym?this._computePipelineCache:this._renderPipelineCache;r[t].useCount--,r[t].useCount===0&&this.destroyPolicy==="unused"&&(r[t].pipeline.destroy(),delete r[t])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const t=e.vs?this._getHash(e.vs.source):0,r=e.fs?this._getHash(e.fs.source):0,i="-",s=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${t}/${r}V${i}BL${s}`;default:const o=this._getHash(JSON.stringify(e.parameters));return`${t}/${r}V${i}T${e.topology}P${o}BL${s}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}}class jE{static defaultProps={...z_.defaultProps};static getDefaultShaderFactory(e){return e._lumaData.defaultShaderFactory||=new jE(e),e._lumaData.defaultShaderFactory}device;destroyPolicy;_cache={};constructor(e){this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}createShader(e){const t=this._hashShader(e);let r=this._cache[t];if(!r){const i=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=r={shader:i,useCount:0}}return r.useCount++,r.shader}release(e){const t=this._hashShader(e),r=this._cache[t];r&&(r.useCount--,r.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[t],r.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}}function fte(n,e){const t={},r="Values";if(n.attributes.length===0&&!n.varyings?.length)return{"No attributes or varyings":{[r]:"N/A"}};for(const i of n.attributes)if(i){const s=`${i.location} ${i.name}: ${i.type}`;t[`in ${s}`]={[r]:i.stepMode||"vertex"}}for(const i of n.varyings||[]){const s=`${i.location} ${i.name}`;t[`out ${s}`]={[r]:JSON.stringify(i)}}return t}let wn=null,n0=null;function dte(n,{id:e,minimap:t,opaque:r,top:i="0",left:s="0",rgbaScale:o=1}){wn||(wn=document.createElement("canvas"),wn.id=e,wn.title=e,wn.style.zIndex="100",wn.style.position="absolute",wn.style.top=i,wn.style.left=s,wn.style.border="blue 5px solid",wn.style.transform="scaleY(-1)",document.body.appendChild(wn),n0=wn.getContext("2d")),(wn.width!==n.width||wn.height!==n.height)&&(wn.width=n.width/2,wn.height=n.height/2,wn.style.width="400px",wn.style.height="400px");const l=n.device.readPixelsToArrayWebGL(n),u=n0?.createImageData(n.width,n.height);if(u){for(let d=0;d<l.length;d+=4)u.data[0+d+0]=l[d+0]*o,u.data[0+d+1]=l[d+1]*o,u.data[0+d+2]=l[d+2]*o,u.data[0+d+3]=r?255:l[d+3]*o;n0?.putImageData(u,0,0)}}function wT(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let r=0;r<n.length;r++)if(!wT(n[r],e[r],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const r=Object.keys(n),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!e.hasOwnProperty(s)||!wT(n[s],e[s],t-1))return!1;return!0}return!1}function pte(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function gte(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":!1}function oD(n){return pte(n)||gte(n)}function mte(n){return oD(n)||typeof n=="number"||typeof n=="boolean"}function aD(n){const e={bindings:{},uniforms:{}};return Object.keys(n).forEach(t=>{const r=n[t];mte(r)?e.uniforms[t]=r:e.bindings[t]=r}),e}class _te{options={disableWarnings:!1};modules;moduleUniforms;moduleBindings;constructor(e,t){Object.assign(this.options,t);const r=pE(Object.values(e).filter(i=>i.dependencies));for(const i of r)e[i.name]=i;we.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[i,s]of Object.entries(e))this._addModule(s),s.name&&i!==s.name&&!this.options.disableWarnings&&we.warn(`Module name: ${i} vs ${s.name}`)()}destroy(){}setProps(e){for(const t of Object.keys(e)){const r=t,i=e[r]||{},s=this.modules[r];if(!s){this.options.disableWarnings||we.warn(`Module ${t} not found`)();continue}const o=this.moduleUniforms[r],l=this.moduleBindings[r],u=s.getUniforms?.(i,o)||i,{uniforms:h,bindings:d}=aD(u);this.moduleUniforms[r]={...o,...h},this.moduleBindings[r]={...l,...d}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){const e={};for(const[t,r]of Object.entries(this.moduleUniforms))for(const[i,s]of Object.entries(r))e[`${t}.${i}`]={type:this.modules[t].uniformTypes?.[i],value:String(s)};return e}_addModule(e){const t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}let yte="";async function vte(n,e){const t=new Image;return t.crossOrigin="anonymous",t.src=n.startsWith("http")?n:yte+n,await t.decode(),e?await createImageBitmap(t,e):await createImageBitmap(t)}class r0{device;id;texture;sampler;view;ready;isReady=!1;destroyed=!1;resolveReady=()=>{};rejectReady=()=>{};get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}constructor(e,t){this.device=e,this.id=t.id||$_("async-texture"),typeof t?.data=="string"&&t.dimension==="2d"&&(t={...t,data:vte(t.data)}),this.ready=new Promise((r,i)=>{this.resolveReady=()=>{this.isReady=!0,r()},this.rejectReady=i}),this.initAsync(t)}async initAsync(e){const t=e.data;let r;try{r=await lD(t)}catch(s){this.rejectReady(s)}if(this.destroyed)return;const i={...e,data:r};this.texture=this.device.createTexture(i),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0,this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}}async function lD(n){if(n=await n,Array.isArray(n))return await Promise.all(n.map(lD));if(n&&typeof n=="object"&&n.constructor===Object){const e=n,t=await Promise.all(Object.values(e)),r=Object.keys(e),i={};for(let s=0;s<r.length;s++)i[r[s]]=t[s];return i}return n}const rl=2,bte=1e4;class qr{static defaultProps={...bu.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:ll.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};uniforms={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;_getModuleUniforms;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}constructor(e,t){this.props={...qr.defaultProps,...t},t=this.props,this.id=t.id||$_("model"),this.device=e,Object.assign(this.userData,t.userData);const r=Object.fromEntries(this.props.modules?.map(u=>[u.name,u])||[]),i=t.shaderInputs||new _te(r,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(i);const s=wte(e),o=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:u,getUniforms:h}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:s,...this.props,modules:o});this.source=u,this._getModuleUniforms=h,this.props.shaderLayout||=ZG(this.source)}else{const{vs:u,fs:h,getUniforms:d}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:s,...this.props,modules:o});this.vs=u,this.fs=h,this._getModuleUniforms=d}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||zE.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||jE.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.uniforms&&this.setUniformsWebGL(t.uniforms),t.moduleSettings&&this.updateModuleSettingsWebGL(t.moduleSettings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||=e}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const t=this._areBindingsLoading();if(t)return we.info(rl,`>>> DRAWING ABORTED ${this.id}: ${t} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let r;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const i=this._getBindings();this.pipeline.setBindings(i,{disableWarnings:this.props.disableWarnings}),ET(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:s}=this.vertexArray,o=s?s.byteLength/(s.indexType==="uint32"?4:2):void 0;r=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:o,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),r?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",r}setGeometry(e){this._gpuGeometry?.destroy();const t=e&&cte(this.device,e);if(t){this.setTopology(t.topology||"triangle-list");const r=new jb(this.bufferLayout);this.bufferLayout=r.mergeBufferLayouts(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)}this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const t=new jb(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){wT(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new vG(this.shaderInputs.modules);for(const[t,r]of Object.entries(this.shaderInputs.modules))if(Tte(r)){const i=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=i}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){const r=t?.disableWarnings??this.props.disableWarnings;e.indices&&we.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=TG(this.pipeline.shaderLayout,this.bufferLayout);const i=new jb(this.bufferLayout);for(const[s,o]of Object.entries(e)){const l=i.getBufferLayout(s);if(!l){r||we.warn(`Model(${this.id}): Missing layout for buffer "${s}".`)();continue}const u=i.getAttributeNamesForBuffer(l);let h=!1;for(const d of u){const g=this._attributeInfos[d];if(g){const y=this.device.type==="webgpu"?i.getBufferIndex(g.bufferName):g.location;this.vertexArray.setBuffer(y,o),h=!0}}!h&&!r&&we.warn(`Model(${this.id}): Ignoring buffer "${o.id}" for unknown attribute "${s}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[r,i]of Object.entries(e)){const s=this._attributeInfos[r];s?this.vertexArray.setConstantWebGL(s.location,i):(t?.disableWarnings??this.props.disableWarnings)||we.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${r}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){ET(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){const{bindings:t,uniforms:r}=aD(this._getModuleUniforms(e));Object.assign(this.bindings,t),Object.assign(this.uniforms,r),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof r0&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[t,r]of Object.entries(this.bindings))r instanceof r0?r.isReady&&(e[t]=r.texture):e[t]=r;return e}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof V_?e=Math.max(e,t.texture.updateTimestamp):t instanceof Ft||t instanceof At?e=Math.max(e,t.updateTimestamp):t instanceof r0?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof ed||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[r]of Object.entries(t))!this.pipeline.shaderLayout.attributes.find(i=>i.name===r)&&r!=="positions"&&delete t[r];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||=e,this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(we.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const r=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let i=null;this.source?i=r:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:r,fs:i}),this._attributeInfos=ZN(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){const e=we.level>3?0:bte;we.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,we.group(rl,`>>> DRAWING MODEL ${this.id}`,{collapsed:we.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=fte(this.pipeline.shaderLayout,this.id);we.table(rl,e)();const t=this.shaderInputs.getDebugTable();for(const[i,s]of Object.entries(this.uniforms))t[i]={value:s};we.table(rl,t)();const r=this._getAttributeDebugTable();we.table(rl,this._attributeInfos)(),we.table(rl,r)(),we.groupEnd(rl)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(e){const t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;const r=e.props.framebuffer;r&&dte(r,{id:r.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,r]of Object.entries(this._attributeInfos)){const i=this.vertexArray.attributes[r.location];e[r.location]={name:t,type:r.shaderType,values:i?this._getBufferOrConstantValues(i,r.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,r=t.indexType==="uint32"?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:r.toString()}}return e}_getBufferOrConstantValues(e,t){const r=e4(t);return(e instanceof Ft?new r(e.debugData):e).toString()}}function Tte(n){return!!(n.uniformTypes&&!ET(n.uniformTypes))}function wte(n){return{type:n.type,shaderLanguage:n.info.shadingLanguage,shaderLanguageVersion:n.info.shadingLanguageVersion,gpu:n.info.gpu,features:n.features}}function ET(n){for(const e in n)return!1;return!0}class Au{device;model;transformFeedback;static defaultProps={...qr.defaultProps,outputs:void 0,feedbackBuffers:void 0};static isSupported(e){return e?.info?.type==="webgl"}constructor(e,t=Au.defaultProps){if(!Au.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new qr(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||wK(),topology:t.topology||"point-list",varyings:t.outputs||t.varyings,...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e?.inputBuffers&&this.model.setAttributes(e.inputBuffers),e?.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(!t)throw new Error("BufferTransform#getBuffer");if(t instanceof Ft)return t.readAsync();const{buffer:r,byteOffset:i=0,byteLength:s=r.byteLength}=t;return r.readAsync(i,s)}}class Su{id;topology;vertexCount;indices;attributes;userData={};constructor(e){const{attributes:t={},indices:r=null,vertexCount:i=null}=e;this.id=e.id||$_("geometry"),this.topology=e.topology,r&&(this.indices=ArrayBuffer.isView(r)?{value:r,size:1}:r),this.attributes={};for(const[s,o]of Object.entries(t)){const l=ArrayBuffer.isView(o)?{value:o}:o;if(!ArrayBuffer.isView(l.value))throw new Error(`${this._print(s)}: must be typed array or object with value as typed array`);if((s==="POSITION"||s==="positions")&&!l.size&&(l.size=3),s==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=l}else this.attributes[s]=l}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let r=1/0;for(const i of Object.values(e)){const{value:s,size:o,constant:l}=i;!l&&s&&o!==void 0&&o>=1&&(r=Math.min(r,s.length/o))}return r}}const Ete={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class cD extends VE{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:r,viewports:i,onViewportActive:s,pickingFBO:o,deviceRect:{x:l,y:u,width:h,height:d},cullRect:g,effects:y,pass:b="picking",pickZ:w,shaderModuleProps:E}){this.pickZ=w;const x=this._resetColorEncoder(w),C=[l,u,h,d],M=super.render({target:o,layers:e,layerFilter:t,views:r,viewports:i,onViewportActive:s,cullRect:g,effects:y?.filter(V=>V.useInPicking),pass:b,isPicking:!0,shaderModuleProps:E,clearColor:[0,0,0,0],colorMask:15,scissorRect:C});return this._colorEncoderState=null,{decodePickingColor:x&&Ate.bind(null,x),stats:M}}shouldDrawLayer(e){const{pickable:t,operation:r}=e.props;return t&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getShaderModuleProps(e,t,r){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,t,r){const i={...e.props.parameters},{pickable:s,operation:o}=e.props;return!this._colorEncoderState||o.includes("terrain")?i.blend=!1:s&&o.includes("draw")&&(Object.assign(i,Ete),i.blend=!0,i.blendColor=xte(this._colorEncoderState,e,r)),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function xte(n,e,t){const{byLayer:r,byAlpha:i}=n;let s,o=r.get(e);return o?(o.viewports.push(t),s=o.a):(s=r.size+1,s<=255?(o={a:s,layer:e,viewports:[t]},r.set(e,o),i[s]=o):(ot.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function Ate(n,e){const t=n.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}const Vc={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},i_=Symbol.for("component"),oa=Symbol.for("propTypes"),i0=Symbol.for("deprecatedProps"),ou=Symbol.for("asyncPropDefaults"),Sl=Symbol.for("asyncPropOriginal"),Go=Symbol.for("asyncPropResolved");function W_(n,e=()=>!0){return Array.isArray(n)?uD(n,e,[]):e(n)?[n]:[]}function uD(n,e,t){let r=-1;for(;++r<n.length;){const i=n[r];Array.isArray(i)?uD(i,e,t):e(i)&&t.push(i)}return t}function Ste({target:n,source:e,start:t=0,count:r=1}){const i=e.length,s=r*i;let o=0;for(let l=t;o<i;o++)n[l++]=e[o];for(;o<s;)o<s-o?(n.copyWithin(t+o,t,t+o),o*=2):(n.copyWithin(t+o,t,t+s-o),o=s);return n}class Rte{constructor(e,t,r){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=r,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const r=++this._loadCount;let i=e;typeof e=="string"&&(i=Wm(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const s of this._subscribers)s.onChange(this.getData())}}class Cte{constructor(e){this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:e.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:t,forceUpdate:r=!1,persistent:i=!0}){let s=this._resources[e];s?s.setData(t,r):(s=new Rte(e,t,this._context),this._resources[e]=s),s.persistent=i}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const r in t){const i=t[r],s=this._resources[i.resourceId];s&&s.unsubscribe(i)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:r,requestId:i="default"}){const{_resources:s,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),s[e]||this.add({resourceId:e,data:null,persistent:!1}));const l=s[e];if(this._track(r,i,l,t),l)return l.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,r,i){const s=this._consumers,o=s[e]=s[e]||{};let l=o[t];const u=l&&l.resourceId&&this._resources[l.resourceId];u&&(u.unsubscribe(l),this.prune()),r&&(l?(l.onChange=i,l.resourceId=r.id):l={onChange:i,resourceId:r.id},o[t]=l,r.subscribe(l))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}const Ite="layerManager.setLayers",Pte="layerManager.activateViewport";class Mte{constructor(e,t){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=l=>{qn(Pte,this,l),l&&(this.context.viewport=l)};const{deck:r,stats:i,viewport:s,timeline:o}=t||{};this.layers=[],this.resourceManager=new Cte({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e?.gl,deck:r,shaderAssembler:Mee(e?.info?.shadingLanguage||"glsl"),defaultShaderModules:[zQ],renderPass:void 0,stats:i||new Cd({id:"deck.gl"}),viewport:s||new Xu({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new sD,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const i=r.getNeedsRedraw(e);t=t||i}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(r=>t.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){qn(Ite,this,t,e),this._lastRenderedLayers=e;const r=W_(e,Boolean);for(const i of r)i.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:t}=this.context;t.find(r=>r.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:t}=this.context,r=t.findIndex(i=>i.name===e.name);r>=0&&(t.splice(r,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,r){r.raiseError(t,`${e} of ${r}`)}_updateLayers(e,t){const r={};for(const o of e)r[o.id]?ot.warn(`Multiple old layers with same id ${o.id}`)():r[o.id]=o;if(this._defaultShaderModulesChanged){for(const o of e)o.setNeedsUpdate(),o.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const i=[];this._updateSublayersRecursively(t,r,i),this._finalizeOldLayers(r);let s=!1;for(const o of i)if(o.hasUniformTransition()){s=`Uniform transition in ${o}`;break}this._needsUpdate=s,this.layers=i}_updateSublayersRecursively(e,t,r){for(const i of e){i.context=this.context;const s=t[i.id];s===null&&ot.warn(`Multiple new layers with same id ${i.id}`)(),t[i.id]=null;let o=null;try{this._debug&&s!==i&&i.validateProps(),s?(this._transferLayerState(s,i),this._updateLayer(i)):this._initializeLayer(i),r.push(i),o=i.isComposite?i.getSubLayers():null}catch(l){this._handleError("matching",l,i)}o&&this._updateSublayersRecursively(o,t,r)}}_finalizeOldLayers(e){for(const t in e){const r=e[t];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Vc.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=Vc.MATCHED,t!==e&&(e.lifecycle=Vc.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=Vc.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Vc.FINALIZED}catch(t){this._handleError("finalization",t,e)}}}function ui(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let r=0;r<n.length;r++)if(!ui(n[r],e[r],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const r=Object.keys(n),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!e.hasOwnProperty(s)||!ui(n[s],e[s],t-1))return!1;return!0}return!1}class Ote{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t=typeof e=="string"?this.getView(e):e,r=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,t){const r=this.getViewports(),i={x:e[0],y:e[1]};for(let s=r.length-1;s>=0;--s){const o=r[s];if(o.containsPixel(i)){const l=e.slice();return l[0]-=o.x,l[1]-=o.y,o.unproject(l,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=W_(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!ui(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):ot.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){const r=t.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>this.getView(e.id)?.makeViewport({viewState:s,width:this.width,height:this.height})})}_updateController(e,t,r,i){const s=e.controller;if(s&&r){const o={...t,...s,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!i||i.constructor!==s.type)&&(i=this._createController(e,o)),i&&i.setProps(o),i}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let i=e.length;i--;){const s=e[i],o=this.getViewState(s),l=s.makeViewport({viewState:o,width:this.width,height:this.height});let u=t[s.id];const h=!!s.controller;h&&!u&&(r=!0),(r||!h)&&u&&(u.finalize(),u=null),this.controllers[s.id]=this._updateController(s,o,l,u),l&&this._viewports.unshift(l)}for(const i in t){const s=t[i];s&&!this.controllers[i]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((r,i)=>!e[i].equals(t[i]))}}const kte=/([0-9]+\.?[0-9]*)(%|px)/;function Do(n){switch(typeof n){case"number":return{position:n,relative:!1};case"string":const e=kte.exec(n);if(e&&e.length>=3){const t=e[2]==="%",r=parseFloat(e[1]);return{position:t?r/100:r,relative:t}}default:throw new Error(`Could not parse position string ${n}`)}}function Lo(n,e){return n.relative?Math.round(n.position*e):n.position}class Ru{constructor(e){const{id:t,x:r=0,y:i=0,width:s="100%",height:o="100%",padding:l=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Do(r),this._y=Do(i),this._width=Do(s),this._height=Do(o),this._padding=l&&{left:Do(l.left||0),right:Do(l.right||0),top:Do(l.top||0),bottom:Do(l.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&ui(this.props,e.props,2)}makeViewport({width:e,height:t,viewState:r}){r=this.filterViewState(r);const i=this.getDimensions({width:e,height:t});if(!i.height||!i.width)return null;const s=this.getViewportType(r);return new s({...r,...this.props,...i})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:e?.id||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const r in this.props.viewState)r!=="id"&&(t[r]=this.props.viewState[r]);return t}return e}getDimensions({width:e,height:t}){const r={x:Lo(this._x,e),y:Lo(this._y,t),width:Lo(this._width,e),height:Lo(this._height,t)};return this._padding&&(r.padding={left:Lo(this._padding.left,e),top:Lo(this._padding.top,t),right:Lo(this._padding.right,e),bottom:Lo(this._padding.bottom,t)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class q_{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){this.cancel(),this.settings=e,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:e,settings:t}=this;this._handle=e.addChannel({delay:e.getTime(),duration:t.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const TC=()=>{},xT={BREAK:1,SNAP_TO_END:2,IGNORE:3},Nte=n=>n,Dte=xT.BREAK;class Lte{constructor(e){this._onTransitionUpdate=t=>{const{time:r,settings:{interpolator:i,startProps:s,endProps:o,duration:l,easing:u}}=t,h=u(r/l),d=i.interpolateProps(s,o,h);this.propsInTransition=this.getControllerState({...this.props,...d}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new q_(e.timeline),this.onViewStateChange=e.onViewStateChange||TC,this.onStateChange=e.onStateChange||TC}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let i=r;if(this.transition.inProgress){const{interruption:s,endProps:o}=this.transition.settings;i={...r,...s===xT.SNAP_TO_END?o:this.propsInTransition||r}}this._triggerTransition(i,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:r}=e;return(t>0||t==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===xT.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const r=this.getControllerState(e),i=this.getControllerState(t).shortestPathFrom(r),s=t.transitionInterpolator,o=s.getDuration?s.getDuration(e,t):t.transitionDuration;if(o===0)return;const l=s.initializeProps(e,i);this.propsInTransition={};const u={duration:o,easing:t.transitionEasing||Nte,interpolator:s,interruption:t.transitionInterruption||Dte,startProps:l.start,endProps:l.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(u),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(t)}}}function On(n,e){if(!n)throw new Error(e||"deck.gl: assertion failed.")}class Ute{constructor(e){const{compare:t,extract:r,required:i}=e;this._propsToCompare=t,this._propsToExtract=r||t,this._requiredProps=i}arePropsEqual(e,t){for(const r of this._propsToCompare)if(!(r in e)||!(r in t)||!Ns(e[r],t[r]))return!1;return!0}initializeProps(e,t){const r={},i={};for(const s of this._propsToExtract)(s in e||s in t)&&(r[s]=e[s],i[s]=t[s]);return this._checkRequiredProps(r),this._checkRequiredProps(i),{start:r,end:i}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const r=e[t];On(Number.isFinite(r)||Array.isArray(r),`${t} is required for transition`)})}}const Fte=["longitude","latitude","zoom","bearing","pitch"],Bte=["longitude","latitude","zoom"];class hD extends Ute{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:Fte,required:Bte},super(r.transitionProps),this.opts=r}initializeProps(e,t){const r=super.initializeProps(e,t),{makeViewport:i,around:s}=this.opts;if(i&&s){const o=i(e),l=i(t),u=o.unproject(s);r.start.around=s,Object.assign(r.end,{around:l.project(u),aroundPosition:u,width:t.width,height:t.height})}return r}interpolateProps(e,t,r){const i={};for(const s of this._propsToExtract)i[s]=fl(e[s]||0,t[s]||0,r);if(t.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...t,...i});Object.assign(i,s.panByPosition(t.aroundPosition,fl(e.around,t.around,r)))}return i}}const Uo={transitionDuration:0},Vte=300,xg=n=>1-(1-n)*(1-n),Nc={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},il={};class zte{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new Lte({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const e in this._events)this._events[e]&&this.eventManager?.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return t?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:r}=this.props,{offsetCenter:i}=e;return[i.x-t,i.y-r]}isPointInBounds(e,t){const{width:r,height:i}=this.props;if(t&&t.handled)return!1;const s=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=i;return s&&t&&t.stopPropagation(),s}isFunctionKeyPressed(e){const{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?Vte:0;const{scrollZoom:r=!0,dragPan:i=!0,dragRotate:s=!0,doubleClickZoom:o=!0,touchZoom:l=!0,touchRotate:u=!1,keyboard:h=!0}=e,d=!!this.onViewStateChange;this.toggleEvents(Nc.WHEEL,d&&r),this.toggleEvents(Nc.PAN,d),this.toggleEvents(Nc.PINCH,d&&(l||u)),this.toggleEvents(Nc.MULTI_PAN,d&&u),this.toggleEvents(Nc.DOUBLE_CLICK,d&&o),this.toggleEvents(Nc.KEYBOARD,d&&h),this.scrollZoom=r,this.dragPan=i,this.dragRotate=s,this.doubleClickZoom=o,this.touchZoom=l,this.touchRotate=u,this.keyboard=h}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(r=>{this._events[r]!==t&&(this._events[r]=t,t?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,t=null,r={}){const i={...e.getViewportProps(),...t},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),s){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:o,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const i=this.controllerState[r?"panStart":"rotateStart"]({pos:t});return this._panMove=r,this.updateViewport(i,Uo,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),r=this.controllerState.pan({pos:t});return this.updateViewport(r,Uo,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2],s=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:xg},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),r=this.controllerState.rotate({pos:t});return this.updateViewport(r,Uo,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2],s=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:xg},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:r=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=e;let o=2/(1+Math.exp(-Math.abs(s*r)));s<0&&o!==0&&(o=1/o);const l=this.controllerState.zoom({pos:t,scale:o});return this.updateViewport(l,{...this._getTransitionProps({around:t}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.controllerState.rotateStart({pos:t});return this.updateViewport(r,Uo,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const r=this.controllerState.rotate({pos:t});return this.updateViewport(r,Uo,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const r=this.getCenter(e),i=[r[0],r[1]+=e.velocityY*t/2],s=this.controllerState.rotate({pos:i});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:xg},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return il._startPinchRotation=e.rotation,il._lastPinchEvent=e,this.updateViewport(r,Uo,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:r}=e,i=this.getCenter(e);t=t.zoom({pos:i,scale:r})}if(this.touchRotate){const{rotation:r}=e;t=t.rotate({deltaAngleX:il._startPinchRotation-r})}return this.updateViewport(t,Uo,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),il._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:r}=il;if(this.touchZoom&&t&&r&&e.scale!==r.scale){const i=this.getCenter(e);let s=this.controllerState.rotateEnd();const o=Math.log2(e.scale),l=(o-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),u=Math.pow(2,o+l*t/2);s=s.zoom({pos:i,scale:u}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:i}),transitionDuration:t,transitionEasing:xg},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return il._startPinchRotation=null,il._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:t,scale:r?.5:2});return this.updateViewport(i,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:i,rotateSpeedX:s,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:l}=this;let u;const h={};switch(e.srcEvent.code){case"Minus":u=t?l.zoomOut(r).zoomOut(r):l.zoomOut(r),h.isZooming=!0;break;case"Equal":u=t?l.zoomIn(r).zoomIn(r):l.zoomIn(r),h.isZooming=!0;break;case"ArrowLeft":t?(u=l.rotateLeft(s),h.isRotating=!0):(u=l.moveLeft(i),h.isPanning=!0);break;case"ArrowRight":t?(u=l.rotateRight(s),h.isRotating=!0):(u=l.moveRight(i),h.isPanning=!0);break;case"ArrowUp":t?(u=l.rotateUp(o),h.isRotating=!0):(u=l.moveUp(i),h.isPanning=!0);break;case"ArrowDown":t?(u=l.rotateDown(o),h.isRotating=!0):(u=l.moveDown(i),h.isPanning=!0);break;default:return!1}return this.updateViewport(u,this._getTransitionProps(),h),!0}_getTransitionProps(e){const{transition:t}=this;return!t||!t.transitionInterpolator?Uo:e?{...t,transitionInterpolator:new hD({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}}class jte{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}const wC=5,Hte=1.2;class $te extends jte{constructor(e){const{width:t,height:r,latitude:i,longitude:s,zoom:o,bearing:l=0,pitch:u=0,altitude:h=1.5,position:d=[0,0,0],maxZoom:g=20,minZoom:y=0,maxPitch:b=60,minPitch:w=0,startPanLngLat:E,startZoomLngLat:x,startRotatePos:C,startBearing:M,startPitch:O,startZoom:V,normalize:H=!0}=e;On(Number.isFinite(s)),On(Number.isFinite(i)),On(Number.isFinite(o)),super({width:t,height:r,latitude:i,longitude:s,zoom:o,bearing:l,pitch:u,altitude:h,maxZoom:g,minZoom:y,maxPitch:b,minPitch:w,normalize:H,position:d},{startPanLngLat:E,startZoomLngLat:x,startRotatePos:C,startBearing:M,startPitch:O,startZoom:V}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const r=this.getState().startPanLngLat||this._unproject(t);if(!r)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:r=0}){const{startRotatePos:i,startBearing:s,startPitch:o}=this.getState();if(!i||s===void 0||o===void 0)return this;let l;return e?l=this._getNewRotation(e,i,o,s):l={bearing:s+t,pitch:o+r},this._getUpdatedState(l)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:r}){let{startZoom:i,startZoomLngLat:s}=this.getState();if(s||(i=this.getViewportProps().zoom,s=this._unproject(t)||this._unproject(e)),!s)return this;const{maxZoom:o,minZoom:l}=this.getViewportProps();let u=i+Math.log2(r);u=Ko(u,l,o);const h=this.makeViewport({...this.getViewportProps(),zoom:u});return this._getUpdatedState({zoom:u,...h.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),r={...this.getViewportProps()},{bearing:i,longitude:s}=r;return Math.abs(i-t.bearing)>180&&(r.bearing=i<0?i+360:i-360),Math.abs(s-t.longitude)>180&&(r.longitude=s<0?s+360:s-360),r}applyConstraints(e){const{maxZoom:t,minZoom:r,zoom:i}=e;e.zoom=Ko(i,r,t);const{maxPitch:s,minPitch:o,pitch:l}=e;e.pitch=Ko(l,o,s);const{normalize:u=!0}=e;return u&&Object.assign(e,gee(e)),e}_zoomFromCenter(e){const{width:t,height:r}=this.getViewportProps();return this.zoom({pos:[t/2,r/2],scale:e})}_panFromCenter(e){const{width:t,height:r}=this.getViewportProps();return this.pan({startPos:[t/2,r/2],pos:[t/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,r,i){const s=e[0]-t[0],o=e[1]-t[1],l=e[1],u=t[1],{width:h,height:d}=this.getViewportProps(),g=s/h;let y=0;o>0?Math.abs(d-u)>wC&&(y=o/(u-d)*Hte):o<0&&u>wC&&(y=1-l/u),y=Ko(y,-1,1);const{minPitch:b,maxPitch:w}=this.getViewportProps(),E=i+180*g;let x=r;return y>0?x=r+y*(w-r):y<0&&(x=r-y*(b-r)),{pitch:x,bearing:E}}}class Wte extends zte{constructor(){super(...arguments),this.ControllerState=$te,this.transition={transitionDuration:300,transitionInterpolator:new hD({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class HE extends Ru{constructor(e={}){super(e)}getViewportType(){return Ws}get ControllerType(){return Wte}}HE.displayName="MapView";const qte=new rD;function Xte(n,e){const t=n.order??1/0,r=e.order??1/0;return t-r}class Yte{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(r=>r.id===e.id)){const r=t.findIndex(i=>Xte(i,e)>0);r<0?t.push(e):t.splice(r,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(ui(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const i of this.effects)t[i.id]=i;const r=[];for(const i of e){const s=t[i.id];let o=i;s&&s!==i?s.setProps?(s.setProps(i.props),o=s):s.cleanup(this._context):s||i.setup(this._context),r.push(o),delete t[i.id]}for(const i in t)t[i].cleanup(this._context);this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(i=>i instanceof rD)||this._resolvedEffects.push(qte),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class Kte extends VE{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const Gte="deckRenderer.renderLayers";class Zte{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new Kte(e),this.pickLayersPass=new cD(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};r.effects&&this._preRender(r.effects,r);const i=this.lastPostProcessEffect?this.renderBuffers[0]:r.target;this.lastPostProcessEffect&&(r.clearColor=[0,0,0,0],r.clearCanvas=!0);const s=t.render({...r,target:i});r.effects&&this._postRender(r.effects,r),this.renderCount++,qn(Gte,this,s,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const r of e)t.preRenderStats[r.id]=r.preRender(t),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(r=>{const i=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${r}`,colorAttachments:[i]}))});for(const r of e)r.resize(t)}_postRender(e,t){const{renderBuffers:r}=this,i={...t,inputBuffer:r[0],swapBuffer:r[1]};for(const s of e)if(s.postRender){i.target=s.id===this.lastPostProcessEffect?t.target:void 0;const o=s.postRender(i);i.inputBuffer=o,i.swapBuffer=o===r[0]?r[1]:r[0]}}}const Qte={pickedColor:null,pickedObjectIndex:-1};function Jte({pickedColors:n,decodePickingColor:e,deviceX:t,deviceY:r,deviceRadius:i,deviceRect:s}){const{x:o,y:l,width:u,height:h}=s;let d=i*i,g=-1,y=0;for(let b=0;b<h;b++){const w=b+l-r,E=w*w;if(E>d)y+=4*u;else for(let x=0;x<u;x++){if(n[y+3]-1>=0){const M=x+o-t,O=M*M+E;O<=d&&(d=O,g=y)}y+=4}}if(g>=0){const b=n.slice(g,g+4),w=e(b);if(w){const E=Math.floor(g/4/u),x=g/4-E*u;return{...w,pickedColor:b,pickedX:o+x,pickedY:l+E}}ot.error("Picked non-existent layer. Is picking buffer corrupt?")()}return Qte}function ene({pickedColors:n,decodePickingColor:e}){const t=new Map;if(n){for(let r=0;r<n.length;r+=4)if(n[r+3]-1>=0){const s=n.slice(r,r+4),o=s.join(",");if(!t.has(o)){const l=e(s);l?t.set(o,{...l,color:s}):ot.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(t.values())}function fD({pickInfo:n,viewports:e,pixelRatio:t,x:r,y:i,z:s}){let o=e[0];e.length>1&&(o=nne(n?.pickedViewports||e,{x:r,y:i}));let l;if(o){const u=[r-o.x,i-o.y];s!==void 0&&(u[2]=s),l=o.unproject(u)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:r,y:i,pixel:[r,i],coordinate:l,devicePixel:n&&"pickedX"in n?[n.pickedX,n.pickedY]:void 0,pixelRatio:t}}function tne(n){const{pickInfo:e,lastPickedInfo:t,mode:r,layers:i}=n,{pickedColor:s,pickedLayer:o,pickedObjectIndex:l}=e,u=o?[o]:[];if(r==="hover"){const g=t.index,y=t.layerId,b=o?o.props.id:null;if(b!==y||l!==g){if(b!==y){const w=i.find(E=>E.props.id===y);w&&u.unshift(w)}t.layerId=b,t.index=l,t.info=null}}const h=fD(n),d=new Map;return d.set(null,h),u.forEach(g=>{let y={...h};g===o&&(y.color=s,y.index=l,y.picked=!0),y=dD({layer:g,info:y,mode:r});const b=y.layer;g===o&&r==="hover"&&(t.info=y),d.set(b.id,y),r==="hover"&&b.updateAutoHighlight(y)}),d}function dD({layer:n,info:e,mode:t}){for(;n&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=n,e=n.getPickingInfo({info:e,mode:t,sourceLayer:r}),n=n.parent}return e}function nne(n,e){for(let t=n.length-1;t>=0;t--){const r=n[t];if(r.containsPixel(e))return r}return n[0]}class rne{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new cD(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:r,viewports:i},s=this.lastPickedInfo.info){const o=s&&s.layer&&s.layer.id,l=s&&s.viewport&&s.viewport.id,u=o?r.find(y=>y.id===o):null,h=l&&i.find(y=>y.id===l)||i[0],d=h&&h.unproject([e-h.x,t-h.y]);return{...s,...{x:e,y:t,viewport:h,coordinate:d,layer:u}}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const t=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=t}const{canvas:e}=this.device.getDefaultCanvasContext();this.pickingFBO?.resize({width:e.width,height:e.height}),this.depthFBO?.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const t=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return t.length?t:null}_pickClosestObject({layers:e,views:t,viewports:r,x:i,y:s,radius:o=0,depth:l=1,mode:u="query",unproject3D:h,onViewportActive:d,effects:g}){const y=this.device.canvasContext.cssToDeviceRatio(),b=this._getPickable(e);if(!b||r.length===0)return{result:[],emptyInfo:fD({viewports:r,x:i,y:s,pixelRatio:y})};this._resizeBuffer();const w=this.device.canvasContext.cssToDevicePixels([i,s],!0),E=[w.x+Math.floor(w.width/2),w.y+Math.floor(w.height/2)],x=Math.round(o*y),{width:C,height:M}=this.pickingFBO,O=this._getPickingRect({deviceX:E[0],deviceY:E[1],deviceRadius:x,deviceWidth:C,deviceHeight:M}),V={x:i-o,y:s-o,width:o*2+1,height:o*2+1};let H;const G=[],D=new Set;for(let I=0;I<l;I++){let N;if(O){const W=this._drawAndSample({layers:b,views:t,viewports:r,onViewportActive:d,deviceRect:O,cullRect:V,effects:g,pass:`picking:${u}`});N=Jte({...W,deviceX:E[0],deviceY:E[1],deviceRadius:x,deviceRect:O})}else N={pickedColor:null,pickedObjectIndex:-1};let j;if(N.pickedLayer&&h&&this.depthFBO){const{pickedColors:W}=this._drawAndSample({layers:[N.pickedLayer],views:t,viewports:r,onViewportActive:d,deviceRect:{x:N.pickedX,y:N.pickedY,width:1,height:1},cullRect:V,effects:g,pass:`picking:${u}:z`},!0);W[3]&&(j=W[0])}N.pickedLayer&&I+1<l&&(D.add(N.pickedLayer),N.pickedLayer.disablePickingIndex(N.pickedObjectIndex)),H=tne({pickInfo:N,lastPickedInfo:this.lastPickedInfo,mode:u,layers:b,viewports:r,x:i,y:s,z:j,pixelRatio:y});for(const W of H.values())W.layer&&G.push(W);if(!N.pickedColor)break}for(const I of D)I.restorePickingColors();return{result:G,emptyInfo:H.get(null)}}_pickVisibleObjects({layers:e,views:t,viewports:r,x:i,y:s,width:o=1,height:l=1,mode:u="query",maxObjects:h=null,onViewportActive:d,effects:g}){const y=this._getPickable(e);if(!y||r.length===0)return[];this._resizeBuffer();const b=this.device.canvasContext.cssToDeviceRatio(),w=this.device.canvasContext.cssToDevicePixels([i,s],!0),E=w.x,x=w.y+w.height,C=this.device.canvasContext.cssToDevicePixels([i+o,s+l],!0),M=C.x+C.width,O=C.y,V={x:E,y:O,width:M-E,height:x-O},H=this._drawAndSample({layers:y,views:t,viewports:r,onViewportActive:d,deviceRect:V,cullRect:{x:i,y:s,width:o,height:l},effects:g,pass:`picking:${u}`}),G=ene(H),D=new Map,I=[],N=Number.isFinite(h);for(let j=0;j<G.length&&!(N&&I.length>=h);j++){const W=G[j];let Y={color:W.pickedColor,layer:null,index:W.pickedObjectIndex,picked:!0,x:i,y:s,pixelRatio:b};Y=dD({layer:W.pickedLayer,info:Y,mode:u});const z=Y.layer.id;D.has(z)||D.set(z,new Set);const de=D.get(z),xe=Y.object??Y.index;de.has(xe)||(de.add(xe),I.push(Y))}return I}_drawAndSample({layers:e,views:t,viewports:r,onViewportActive:i,deviceRect:s,cullRect:o,effects:l,pass:u},h=!1){const d=h?this.depthFBO:this.pickingFBO,g={layers:e,layerFilter:this.layerFilter,views:t,viewports:r,onViewportActive:i,pickingFBO:d,deviceRect:s,cullRect:o,effects:l,pass:u,pickZ:h,preRenderStats:{},isPicking:!0};for(const M of l)M.useInPicking&&(g.preRenderStats[M.id]=M.preRender(g));const{decodePickingColor:y}=this.pickLayersPass.render(g),{x:b,y:w,width:E,height:x}=s,C=new(h?Float32Array:Uint8Array)(E*x*4);return this.device.readPixelsToArrayWebGL(d,{sourceX:b,sourceY:w,sourceWidth:E,sourceHeight:x,target:C}),{pickedColors:C,decodePickingColor:y}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:r,deviceWidth:i,deviceHeight:s}){const o=Math.max(0,e-r),l=Math.max(0,t-r),u=Math.min(i,e+r+1)-o,h=Math.min(s,t+r+1)-l;return u<=0||h<=0?null:{x:o,y:l,width:u,height:h}}}const ine={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},sne="top-left",EC="__root";class one{constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!ui(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const t={};for(const r of this.resolvedWidgets)t[r.id]=r;this.resolvedWidgets.length=0;for(const r of this.defaultWidgets)t[r.id]=null,this.resolvedWidgets.push(r);for(let r of e){const i=t[r.id];i?i.viewId!==r.viewId||i.placement!==r.placement?(this._remove(i),this._add(r)):r!==i&&(i.setProps(r.props),r=i):this._add(r),t[r.id]=null,this.resolvedWidgets.push(r)}for(const r in t){const i=t[r];i&&this._remove(i)}this.widgets=e}_add(e){const{viewId:t=null,placement:r=sne}=e,i=e.onAdd({deck:this.deck,viewId:t});i&&this._getContainer(t,r).append(i),e._element=i}_remove(e){e.onRemove?.(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,t){const r=e||EC;let i=this.containers[r];i||(i=document.createElement("div"),i.style.pointerEvents="none",i.style.position="absolute",i.style.overflow="hidden",this.parentElement?.append(i),this.containers[r]=i);let s=i.querySelector(`.${t}`);return s||(s=document.createElement("div"),s.className=t,s.style.position="absolute",s.style.zIndex="2",Object.assign(s.style,ine[t]),i.append(s)),s}_updateContainers(){const e=this.deck.width,t=this.deck.height;for(const r in this.containers){const i=this.lastViewports[r]||null,s=r===EC||i,o=this.containers[r];s?(o.style.display="block",o.style.left=`${i?i.x:0}px`,o.style.top=`${i?i.y:0}px`,o.style.width=`${i?i.width:e}px`,o.style.height=`${i?i.height:t}px`):o.style.display="none"}}onRedraw({viewports:e,layers:t}){const r=e.reduce((i,s)=>(i[s.id]=s,i),{});for(const i of this.getWidgets()){const{viewId:s}=i;if(s){const o=r[s];o&&(i.onViewportChange&&i.onViewportChange(o),i.onRedraw?.({viewports:[o],layers:t}))}else{if(i.onViewportChange)for(const o of e)i.onViewportChange(o);i.onRedraw?.({viewports:e,layers:t})}}this.lastViewports=r,this._updateContainers()}onHover(e,t){for(const r of this.getWidgets()){const{viewId:i}=r;(!i||i===e.viewport?.id)&&r.onHover?.(e,t)}}onEvent(e,t){const r=yT[t.type];if(r)for(const i of this.getWidgets()){const{viewId:s}=i;(!s||s===e.viewport?.id)&&i[r]?.(e,t)}}}const ane={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class lne{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const t=document.createElement("div");return t.className="deck-tooltip",Object.assign(t.style,ane),this.deck=e,this.element=t,t}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){this.isVisible&&e.id===this.lastViewport?.id&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:t}=this,r=t&&t.props.getTooltip;if(!r)return;const i=r(e);this.lastViewport=e.viewport,this.setTooltip(i,e.x,e.y)}setTooltip(e,t,r){const i=this.element;if(i){if(typeof e=="string")i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${t}px, ${r}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(i.style,e.style)}}}var Wc;(function(n){n[n.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",n[n.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",n[n.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",n[n.POINTS=0]="POINTS",n[n.LINES=1]="LINES",n[n.LINE_LOOP=2]="LINE_LOOP",n[n.LINE_STRIP=3]="LINE_STRIP",n[n.TRIANGLES=4]="TRIANGLES",n[n.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",n[n.TRIANGLE_FAN=6]="TRIANGLE_FAN",n[n.ZERO=0]="ZERO",n[n.ONE=1]="ONE",n[n.SRC_COLOR=768]="SRC_COLOR",n[n.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",n[n.SRC_ALPHA=770]="SRC_ALPHA",n[n.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",n[n.DST_ALPHA=772]="DST_ALPHA",n[n.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",n[n.DST_COLOR=774]="DST_COLOR",n[n.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",n[n.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",n[n.CONSTANT_COLOR=32769]="CONSTANT_COLOR",n[n.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",n[n.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",n[n.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",n[n.FUNC_ADD=32774]="FUNC_ADD",n[n.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",n[n.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",n[n.BLEND_EQUATION=32777]="BLEND_EQUATION",n[n.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",n[n.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",n[n.BLEND_DST_RGB=32968]="BLEND_DST_RGB",n[n.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",n[n.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",n[n.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",n[n.BLEND_COLOR=32773]="BLEND_COLOR",n[n.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",n[n.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",n[n.LINE_WIDTH=2849]="LINE_WIDTH",n[n.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",n[n.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",n[n.CULL_FACE_MODE=2885]="CULL_FACE_MODE",n[n.FRONT_FACE=2886]="FRONT_FACE",n[n.DEPTH_RANGE=2928]="DEPTH_RANGE",n[n.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",n[n.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",n[n.DEPTH_FUNC=2932]="DEPTH_FUNC",n[n.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",n[n.STENCIL_FUNC=2962]="STENCIL_FUNC",n[n.STENCIL_FAIL=2964]="STENCIL_FAIL",n[n.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",n[n.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",n[n.STENCIL_REF=2967]="STENCIL_REF",n[n.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",n[n.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",n[n.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",n[n.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",n[n.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",n[n.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",n[n.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",n[n.VIEWPORT=2978]="VIEWPORT",n[n.SCISSOR_BOX=3088]="SCISSOR_BOX",n[n.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",n[n.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",n[n.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",n[n.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",n[n.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",n[n.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",n[n.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",n[n.RED_BITS=3410]="RED_BITS",n[n.GREEN_BITS=3411]="GREEN_BITS",n[n.BLUE_BITS=3412]="BLUE_BITS",n[n.ALPHA_BITS=3413]="ALPHA_BITS",n[n.DEPTH_BITS=3414]="DEPTH_BITS",n[n.STENCIL_BITS=3415]="STENCIL_BITS",n[n.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",n[n.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",n[n.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",n[n.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",n[n.SAMPLES=32937]="SAMPLES",n[n.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",n[n.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",n[n.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",n[n.VENDOR=7936]="VENDOR",n[n.RENDERER=7937]="RENDERER",n[n.VERSION=7938]="VERSION",n[n.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",n[n.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",n[n.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",n[n.STATIC_DRAW=35044]="STATIC_DRAW",n[n.STREAM_DRAW=35040]="STREAM_DRAW",n[n.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",n[n.ARRAY_BUFFER=34962]="ARRAY_BUFFER",n[n.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",n[n.BUFFER_SIZE=34660]="BUFFER_SIZE",n[n.BUFFER_USAGE=34661]="BUFFER_USAGE",n[n.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",n[n.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",n[n.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",n[n.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",n[n.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",n[n.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",n[n.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",n[n.CULL_FACE=2884]="CULL_FACE",n[n.FRONT=1028]="FRONT",n[n.BACK=1029]="BACK",n[n.FRONT_AND_BACK=1032]="FRONT_AND_BACK",n[n.BLEND=3042]="BLEND",n[n.DEPTH_TEST=2929]="DEPTH_TEST",n[n.DITHER=3024]="DITHER",n[n.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",n[n.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",n[n.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",n[n.SCISSOR_TEST=3089]="SCISSOR_TEST",n[n.STENCIL_TEST=2960]="STENCIL_TEST",n[n.NO_ERROR=0]="NO_ERROR",n[n.INVALID_ENUM=1280]="INVALID_ENUM",n[n.INVALID_VALUE=1281]="INVALID_VALUE",n[n.INVALID_OPERATION=1282]="INVALID_OPERATION",n[n.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",n[n.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",n[n.CW=2304]="CW",n[n.CCW=2305]="CCW",n[n.DONT_CARE=4352]="DONT_CARE",n[n.FASTEST=4353]="FASTEST",n[n.NICEST=4354]="NICEST",n[n.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",n[n.BYTE=5120]="BYTE",n[n.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",n[n.SHORT=5122]="SHORT",n[n.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",n[n.INT=5124]="INT",n[n.UNSIGNED_INT=5125]="UNSIGNED_INT",n[n.FLOAT=5126]="FLOAT",n[n.DOUBLE=5130]="DOUBLE",n[n.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",n[n.ALPHA=6406]="ALPHA",n[n.RGB=6407]="RGB",n[n.RGBA=6408]="RGBA",n[n.LUMINANCE=6409]="LUMINANCE",n[n.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",n[n.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",n[n.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",n[n.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",n[n.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",n[n.VERTEX_SHADER=35633]="VERTEX_SHADER",n[n.COMPILE_STATUS=35713]="COMPILE_STATUS",n[n.DELETE_STATUS=35712]="DELETE_STATUS",n[n.LINK_STATUS=35714]="LINK_STATUS",n[n.VALIDATE_STATUS=35715]="VALIDATE_STATUS",n[n.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",n[n.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",n[n.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",n[n.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",n[n.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",n[n.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",n[n.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",n[n.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",n[n.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",n[n.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",n[n.SHADER_TYPE=35663]="SHADER_TYPE",n[n.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",n[n.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",n[n.NEVER=512]="NEVER",n[n.LESS=513]="LESS",n[n.EQUAL=514]="EQUAL",n[n.LEQUAL=515]="LEQUAL",n[n.GREATER=516]="GREATER",n[n.NOTEQUAL=517]="NOTEQUAL",n[n.GEQUAL=518]="GEQUAL",n[n.ALWAYS=519]="ALWAYS",n[n.KEEP=7680]="KEEP",n[n.REPLACE=7681]="REPLACE",n[n.INCR=7682]="INCR",n[n.DECR=7683]="DECR",n[n.INVERT=5386]="INVERT",n[n.INCR_WRAP=34055]="INCR_WRAP",n[n.DECR_WRAP=34056]="DECR_WRAP",n[n.NEAREST=9728]="NEAREST",n[n.LINEAR=9729]="LINEAR",n[n.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",n[n.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",n[n.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",n[n.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",n[n.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",n[n.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",n[n.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",n[n.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",n[n.TEXTURE_2D=3553]="TEXTURE_2D",n[n.TEXTURE=5890]="TEXTURE",n[n.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",n[n.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",n[n.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",n[n.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",n[n.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",n[n.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",n[n.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",n[n.TEXTURE0=33984]="TEXTURE0",n[n.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",n[n.REPEAT=10497]="REPEAT",n[n.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",n[n.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",n[n.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",n[n.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",n[n.FLOAT_VEC2=35664]="FLOAT_VEC2",n[n.FLOAT_VEC3=35665]="FLOAT_VEC3",n[n.FLOAT_VEC4=35666]="FLOAT_VEC4",n[n.INT_VEC2=35667]="INT_VEC2",n[n.INT_VEC3=35668]="INT_VEC3",n[n.INT_VEC4=35669]="INT_VEC4",n[n.BOOL=35670]="BOOL",n[n.BOOL_VEC2=35671]="BOOL_VEC2",n[n.BOOL_VEC3=35672]="BOOL_VEC3",n[n.BOOL_VEC4=35673]="BOOL_VEC4",n[n.FLOAT_MAT2=35674]="FLOAT_MAT2",n[n.FLOAT_MAT3=35675]="FLOAT_MAT3",n[n.FLOAT_MAT4=35676]="FLOAT_MAT4",n[n.SAMPLER_2D=35678]="SAMPLER_2D",n[n.SAMPLER_CUBE=35680]="SAMPLER_CUBE",n[n.LOW_FLOAT=36336]="LOW_FLOAT",n[n.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",n[n.HIGH_FLOAT=36338]="HIGH_FLOAT",n[n.LOW_INT=36339]="LOW_INT",n[n.MEDIUM_INT=36340]="MEDIUM_INT",n[n.HIGH_INT=36341]="HIGH_INT",n[n.FRAMEBUFFER=36160]="FRAMEBUFFER",n[n.RENDERBUFFER=36161]="RENDERBUFFER",n[n.RGBA4=32854]="RGBA4",n[n.RGB5_A1=32855]="RGB5_A1",n[n.RGB565=36194]="RGB565",n[n.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",n[n.STENCIL_INDEX=6401]="STENCIL_INDEX",n[n.STENCIL_INDEX8=36168]="STENCIL_INDEX8",n[n.DEPTH_STENCIL=34041]="DEPTH_STENCIL",n[n.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",n[n.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",n[n.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",n[n.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",n[n.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",n[n.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",n[n.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",n[n.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",n[n.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",n[n.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",n[n.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",n[n.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",n[n.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",n[n.NONE=0]="NONE",n[n.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",n[n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",n[n.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",n[n.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",n[n.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",n[n.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",n[n.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",n[n.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",n[n.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",n[n.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",n[n.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",n[n.READ_BUFFER=3074]="READ_BUFFER",n[n.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",n[n.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",n[n.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",n[n.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",n[n.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",n[n.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",n[n.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",n[n.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",n[n.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",n[n.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",n[n.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",n[n.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",n[n.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",n[n.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",n[n.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",n[n.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",n[n.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",n[n.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",n[n.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",n[n.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",n[n.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",n[n.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",n[n.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",n[n.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",n[n.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",n[n.RED=6403]="RED",n[n.RGB8=32849]="RGB8",n[n.RGBA8=32856]="RGBA8",n[n.RGB10_A2=32857]="RGB10_A2",n[n.TEXTURE_3D=32879]="TEXTURE_3D",n[n.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",n[n.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",n[n.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",n[n.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",n[n.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",n[n.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",n[n.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",n[n.SRGB=35904]="SRGB",n[n.SRGB8=35905]="SRGB8",n[n.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",n[n.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",n[n.RGBA32F=34836]="RGBA32F",n[n.RGB32F=34837]="RGB32F",n[n.RGBA16F=34842]="RGBA16F",n[n.RGB16F=34843]="RGB16F",n[n.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",n[n.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",n[n.R11F_G11F_B10F=35898]="R11F_G11F_B10F",n[n.RGB9_E5=35901]="RGB9_E5",n[n.RGBA32UI=36208]="RGBA32UI",n[n.RGB32UI=36209]="RGB32UI",n[n.RGBA16UI=36214]="RGBA16UI",n[n.RGB16UI=36215]="RGB16UI",n[n.RGBA8UI=36220]="RGBA8UI",n[n.RGB8UI=36221]="RGB8UI",n[n.RGBA32I=36226]="RGBA32I",n[n.RGB32I=36227]="RGB32I",n[n.RGBA16I=36232]="RGBA16I",n[n.RGB16I=36233]="RGB16I",n[n.RGBA8I=36238]="RGBA8I",n[n.RGB8I=36239]="RGB8I",n[n.RED_INTEGER=36244]="RED_INTEGER",n[n.RGB_INTEGER=36248]="RGB_INTEGER",n[n.RGBA_INTEGER=36249]="RGBA_INTEGER",n[n.R8=33321]="R8",n[n.RG8=33323]="RG8",n[n.R16F=33325]="R16F",n[n.R32F=33326]="R32F",n[n.RG16F=33327]="RG16F",n[n.RG32F=33328]="RG32F",n[n.R8I=33329]="R8I",n[n.R8UI=33330]="R8UI",n[n.R16I=33331]="R16I",n[n.R16UI=33332]="R16UI",n[n.R32I=33333]="R32I",n[n.R32UI=33334]="R32UI",n[n.RG8I=33335]="RG8I",n[n.RG8UI=33336]="RG8UI",n[n.RG16I=33337]="RG16I",n[n.RG16UI=33338]="RG16UI",n[n.RG32I=33339]="RG32I",n[n.RG32UI=33340]="RG32UI",n[n.R8_SNORM=36756]="R8_SNORM",n[n.RG8_SNORM=36757]="RG8_SNORM",n[n.RGB8_SNORM=36758]="RGB8_SNORM",n[n.RGBA8_SNORM=36759]="RGBA8_SNORM",n[n.RGB10_A2UI=36975]="RGB10_A2UI",n[n.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",n[n.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",n[n.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",n[n.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",n[n.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",n[n.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",n[n.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",n[n.HALF_FLOAT=5131]="HALF_FLOAT",n[n.RG=33319]="RG",n[n.RG_INTEGER=33320]="RG_INTEGER",n[n.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",n[n.CURRENT_QUERY=34917]="CURRENT_QUERY",n[n.QUERY_RESULT=34918]="QUERY_RESULT",n[n.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",n[n.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",n[n.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",n[n.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",n[n.DRAW_BUFFER0=34853]="DRAW_BUFFER0",n[n.DRAW_BUFFER1=34854]="DRAW_BUFFER1",n[n.DRAW_BUFFER2=34855]="DRAW_BUFFER2",n[n.DRAW_BUFFER3=34856]="DRAW_BUFFER3",n[n.DRAW_BUFFER4=34857]="DRAW_BUFFER4",n[n.DRAW_BUFFER5=34858]="DRAW_BUFFER5",n[n.DRAW_BUFFER6=34859]="DRAW_BUFFER6",n[n.DRAW_BUFFER7=34860]="DRAW_BUFFER7",n[n.DRAW_BUFFER8=34861]="DRAW_BUFFER8",n[n.DRAW_BUFFER9=34862]="DRAW_BUFFER9",n[n.DRAW_BUFFER10=34863]="DRAW_BUFFER10",n[n.DRAW_BUFFER11=34864]="DRAW_BUFFER11",n[n.DRAW_BUFFER12=34865]="DRAW_BUFFER12",n[n.DRAW_BUFFER13=34866]="DRAW_BUFFER13",n[n.DRAW_BUFFER14=34867]="DRAW_BUFFER14",n[n.DRAW_BUFFER15=34868]="DRAW_BUFFER15",n[n.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",n[n.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",n[n.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",n[n.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",n[n.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",n[n.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",n[n.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",n[n.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",n[n.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",n[n.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",n[n.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",n[n.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",n[n.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",n[n.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",n[n.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",n[n.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",n[n.SAMPLER_3D=35679]="SAMPLER_3D",n[n.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",n[n.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",n[n.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",n[n.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",n[n.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",n[n.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",n[n.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",n[n.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",n[n.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",n[n.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",n[n.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",n[n.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",n[n.MAX_SAMPLES=36183]="MAX_SAMPLES",n[n.SAMPLER_BINDING=35097]="SAMPLER_BINDING",n[n.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",n[n.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",n[n.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",n[n.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",n[n.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",n[n.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",n[n.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",n[n.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",n[n.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",n[n.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",n[n.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",n[n.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",n[n.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",n[n.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",n[n.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",n[n.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",n[n.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",n[n.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",n[n.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",n[n.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",n[n.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",n[n.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",n[n.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",n[n.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",n[n.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",n[n.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",n[n.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",n[n.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",n[n.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",n[n.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",n[n.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",n[n.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",n[n.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",n[n.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",n[n.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",n[n.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",n[n.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",n[n.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",n[n.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",n[n.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",n[n.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",n[n.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",n[n.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",n[n.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",n[n.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",n[n.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",n[n.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",n[n.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",n[n.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",n[n.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",n[n.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",n[n.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",n[n.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",n[n.UNIFORM_TYPE=35383]="UNIFORM_TYPE",n[n.UNIFORM_SIZE=35384]="UNIFORM_SIZE",n[n.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",n[n.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",n[n.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",n[n.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",n[n.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",n[n.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",n[n.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",n[n.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",n[n.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",n[n.OBJECT_TYPE=37138]="OBJECT_TYPE",n[n.SYNC_CONDITION=37139]="SYNC_CONDITION",n[n.SYNC_STATUS=37140]="SYNC_STATUS",n[n.SYNC_FLAGS=37141]="SYNC_FLAGS",n[n.SYNC_FENCE=37142]="SYNC_FENCE",n[n.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",n[n.UNSIGNALED=37144]="UNSIGNALED",n[n.SIGNALED=37145]="SIGNALED",n[n.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",n[n.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",n[n.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",n[n.WAIT_FAILED=37149]="WAIT_FAILED",n[n.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",n[n.COLOR=6144]="COLOR",n[n.DEPTH=6145]="DEPTH",n[n.STENCIL=6146]="STENCIL",n[n.MIN=32775]="MIN",n[n.MAX=32776]="MAX",n[n.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",n[n.STREAM_READ=35041]="STREAM_READ",n[n.STREAM_COPY=35042]="STREAM_COPY",n[n.STATIC_READ=35045]="STATIC_READ",n[n.STATIC_COPY=35046]="STATIC_COPY",n[n.DYNAMIC_READ=35049]="DYNAMIC_READ",n[n.DYNAMIC_COPY=35050]="DYNAMIC_COPY",n[n.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",n[n.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",n[n.INVALID_INDEX=4294967295]="INVALID_INDEX",n[n.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",n[n.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",n[n.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",n[n.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",n[n.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",n[n.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",n[n.R16_EXT=33322]="R16_EXT",n[n.RG16_EXT=33324]="RG16_EXT",n[n.RGB16_EXT=32852]="RGB16_EXT",n[n.RGBA16_EXT=32859]="RGBA16_EXT",n[n.R16_SNORM_EXT=36760]="R16_SNORM_EXT",n[n.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",n[n.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",n[n.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",n[n.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",n[n.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",n[n.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",n[n.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",n[n.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",n[n.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",n[n.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",n[n.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",n[n.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",n[n.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",n[n.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",n[n.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",n[n.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",n[n.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",n[n.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",n[n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",n[n.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",n[n.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",n[n.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",n[n.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",n[n.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",n[n.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",n[n.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",n[n.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",n[n.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",n[n.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",n[n.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",n[n.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",n[n.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",n[n.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",n[n.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",n[n.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",n[n.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",n[n.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",n[n.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",n[n.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",n[n.LINE_WEBGL=6913]="LINE_WEBGL",n[n.FILL_WEBGL=6914]="FILL_WEBGL",n[n.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",n[n.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",n[n.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",n[n.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",n[n.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",n[n.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",n[n.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",n[n.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",n[n.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",n[n.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",n[n.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",n[n.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",n[n.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",n[n.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",n[n.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",n[n.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",n[n.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",n[n.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",n[n.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",n[n.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",n[n.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",n[n.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",n[n.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",n[n.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(Wc||(Wc={}));const $E={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},en=(n,e,t)=>e?n.enable(t):n.disable(t),xC=(n,e,t)=>n.hint(t,e),Tr=(n,e,t)=>n.pixelStorei(t,e),AC=(n,e,t)=>{const r=t===36006?36009:36008;return n.bindFramebuffer(r,e)},of=(n,e,t)=>{const i={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[t];n.bindBuffer(i,e)};function s0(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}const cne={3042:en,32773:(n,e)=>n.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(n,e)=>n.clearColor(...e),3107:(n,e)=>n.colorMask(...e),2884:en,2885:(n,e)=>n.cullFace(e),2929:en,2931:(n,e)=>n.clearDepth(e),2932:(n,e)=>n.depthFunc(e),2928:(n,e)=>n.depthRange(...e),2930:(n,e)=>n.depthMask(e),3024:en,35723:xC,35725:(n,e)=>n.useProgram(e),36007:(n,e)=>n.bindRenderbuffer(36161,e),36389:(n,e)=>n.bindTransformFeedback?.(36386,e),34229:(n,e)=>n.bindVertexArray(e),36006:AC,36010:AC,34964:of,36662:of,36663:of,35053:of,35055:of,2886:(n,e)=>n.frontFace(e),33170:xC,2849:(n,e)=>n.lineWidth(e),32823:en,32824:"polygonOffset",10752:"polygonOffset",35977:en,32926:en,32928:en,32938:"sampleCoverage",32939:"sampleCoverage",3089:en,3088:(n,e)=>n.scissor(...e),2960:en,2961:(n,e)=>n.clearStencil(e),2968:(n,e)=>n.stencilMaskSeparate(1028,e),36005:(n,e)=>n.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(n,e)=>n.viewport(...e),34383:en,10754:en,12288:en,12289:en,12290:en,12291:en,12292:en,12293:en,12294:en,12295:en,3333:Tr,3317:Tr,37440:Tr,37441:Tr,37443:Tr,3330:Tr,3332:Tr,3331:Tr,3314:Tr,32878:Tr,3316:Tr,3315:Tr,32877:Tr,framebuffer:(n,e)=>{const t=e&&"handle"in e?e.handle:e;return n.bindFramebuffer(36160,t)},blend:(n,e)=>e?n.enable(3042):n.disable(3042),blendColor:(n,e)=>n.blendColor(...e),blendEquation:(n,e)=>{const t=typeof e=="number"?[e,e]:e;n.blendEquationSeparate(...t)},blendFunc:(n,e)=>{const t=e?.length===2?[...e,...e]:e;n.blendFuncSeparate(...t)},clearColor:(n,e)=>n.clearColor(...e),clearDepth:(n,e)=>n.clearDepth(e),clearStencil:(n,e)=>n.clearStencil(e),colorMask:(n,e)=>n.colorMask(...e),cull:(n,e)=>e?n.enable(2884):n.disable(2884),cullFace:(n,e)=>n.cullFace(e),depthTest:(n,e)=>e?n.enable(2929):n.disable(2929),depthFunc:(n,e)=>n.depthFunc(e),depthMask:(n,e)=>n.depthMask(e),depthRange:(n,e)=>n.depthRange(...e),dither:(n,e)=>e?n.enable(3024):n.disable(3024),derivativeHint:(n,e)=>{n.hint(35723,e)},frontFace:(n,e)=>n.frontFace(e),mipmapHint:(n,e)=>n.hint(33170,e),lineWidth:(n,e)=>n.lineWidth(e),polygonOffsetFill:(n,e)=>e?n.enable(32823):n.disable(32823),polygonOffset:(n,e)=>n.polygonOffset(...e),sampleCoverage:(n,e)=>n.sampleCoverage(e[0],e[1]||!1),scissorTest:(n,e)=>e?n.enable(3089):n.disable(3089),scissor:(n,e)=>n.scissor(...e),stencilTest:(n,e)=>e?n.enable(2960):n.disable(2960),stencilMask:(n,e)=>{e=s0(e)?e:[e,e];const[t,r]=e;n.stencilMaskSeparate(1028,t),n.stencilMaskSeparate(1029,r)},stencilFunc:(n,e)=>{e=s0(e)&&e.length===3?[...e,...e]:e;const[t,r,i,s,o,l]=e;n.stencilFuncSeparate(1028,t,r,i),n.stencilFuncSeparate(1029,s,o,l)},stencilOp:(n,e)=>{e=s0(e)&&e.length===3?[...e,...e]:e;const[t,r,i,s,o,l]=e;n.stencilOpSeparate(1028,t,r,i),n.stencilOpSeparate(1029,s,o,l)},viewport:(n,e)=>n.viewport(...e)};function Ht(n,e,t){return e[n]!==void 0?e[n]:t[n]}const une={blendEquation:(n,e,t)=>n.blendEquationSeparate(Ht(32777,e,t),Ht(34877,e,t)),blendFunc:(n,e,t)=>n.blendFuncSeparate(Ht(32969,e,t),Ht(32968,e,t),Ht(32971,e,t),Ht(32970,e,t)),polygonOffset:(n,e,t)=>n.polygonOffset(Ht(32824,e,t),Ht(10752,e,t)),sampleCoverage:(n,e,t)=>n.sampleCoverage(Ht(32938,e,t),Ht(32939,e,t)),stencilFuncFront:(n,e,t)=>n.stencilFuncSeparate(1028,Ht(2962,e,t),Ht(2967,e,t),Ht(2963,e,t)),stencilFuncBack:(n,e,t)=>n.stencilFuncSeparate(1029,Ht(34816,e,t),Ht(36003,e,t),Ht(36004,e,t)),stencilOpFront:(n,e,t)=>n.stencilOpSeparate(1028,Ht(2964,e,t),Ht(2965,e,t),Ht(2966,e,t)),stencilOpBack:(n,e,t)=>n.stencilOpSeparate(1029,Ht(34817,e,t),Ht(34818,e,t),Ht(34819,e,t))},SC={enable:(n,e)=>n({[e]:!0}),disable:(n,e)=>n({[e]:!1}),pixelStorei:(n,e,t)=>n({[e]:t}),hint:(n,e,t)=>n({[e]:t}),useProgram:(n,e)=>n({35725:e}),bindRenderbuffer:(n,e,t)=>n({36007:t}),bindTransformFeedback:(n,e,t)=>n({36389:t}),bindVertexArray:(n,e)=>n({34229:e}),bindFramebuffer:(n,e,t)=>{switch(e){case 36160:return n({36006:t,36010:t});case 36009:return n({36006:t});case 36008:return n({36010:t});default:return null}},bindBuffer:(n,e,t)=>{const r={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return r?n({[r]:t}):{valueChanged:!0}},blendColor:(n,e,t,r,i)=>n({32773:new Float32Array([e,t,r,i])}),blendEquation:(n,e)=>n({32777:e,34877:e}),blendEquationSeparate:(n,e,t)=>n({32777:e,34877:t}),blendFunc:(n,e,t)=>n({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(n,e,t,r,i)=>n({32969:e,32968:t,32971:r,32970:i}),clearColor:(n,e,t,r,i)=>n({3106:new Float32Array([e,t,r,i])}),clearDepth:(n,e)=>n({2931:e}),clearStencil:(n,e)=>n({2961:e}),colorMask:(n,e,t,r,i)=>n({3107:[e,t,r,i]}),cullFace:(n,e)=>n({2885:e}),depthFunc:(n,e)=>n({2932:e}),depthRange:(n,e,t)=>n({2928:new Float32Array([e,t])}),depthMask:(n,e)=>n({2930:e}),frontFace:(n,e)=>n({2886:e}),lineWidth:(n,e)=>n({2849:e}),polygonOffset:(n,e,t)=>n({32824:e,10752:t}),sampleCoverage:(n,e,t)=>n({32938:e,32939:t}),scissor:(n,e,t,r,i)=>n({3088:new Int32Array([e,t,r,i])}),stencilMask:(n,e)=>n({2968:e,36005:e}),stencilMaskSeparate:(n,e,t)=>n({[e===1028?2968:36005]:t}),stencilFunc:(n,e,t,r)=>n({2962:e,2967:t,2963:r,34816:e,36003:t,36004:r}),stencilFuncSeparate:(n,e,t,r,i)=>n({[e===1028?2962:34816]:t,[e===1028?2967:36003]:r,[e===1028?2963:36004]:i}),stencilOp:(n,e,t,r)=>n({2964:e,2965:t,2966:r,34817:e,34818:t,34819:r}),stencilOpSeparate:(n,e,t,r,i)=>n({[e===1028?2964:34817]:t,[e===1028?2965:34818]:r,[e===1028?2966:34819]:i}),viewport:(n,e,t,r,i)=>n({2978:[e,t,r,i]})},ki=(n,e)=>n.isEnabled(e),RC={3042:ki,2884:ki,2929:ki,3024:ki,32823:ki,32926:ki,32928:ki,3089:ki,2960:ki,35977:ki},hne=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Yu(n,e){if(dne(e))return;const t={};for(const i in e){const s=Number(i),o=cne[i];o&&(typeof o=="string"?t[o]=!0:o(n,e[i],s))}const r=n.state&&n.state.cache;if(r)for(const i in t){const s=une[i];s(n,e,r)}}function pD(n,e=$E){if(typeof e=="number"){const i=e,s=RC[i];return s?s(n,i):n.getParameter(i)}const t=Array.isArray(e)?e:Object.keys(e),r={};for(const i of t){const s=RC[i];r[i]=s?s(n,Number(i)):n.getParameter(Number(i))}return r}function fne(n){Yu(n,$E)}function dne(n){for(const e in n)return!1;return!0}function pne(n,e){if(n===e)return!0;const t=Array.isArray(n)||ArrayBuffer.isView(n),r=Array.isArray(e)||ArrayBuffer.isView(e);if(t&&r&&n.length===e.length){for(let i=0;i<n.length;++i)if(n[i]!==e[i])return!1;return!0}return!1}class pl{static get(e){return e.state}gl;program=null;stateStack=[];enable=!0;cache=null;log;initialized=!1;constructor(e,t){this.gl=e,this.log=t?.log||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];Yu(this.gl,e),this.stateStack.pop()}trackState(e,t){if(this.cache=t.copyState?pD(e):Object.assign({},$E),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,mne(e);for(const r in SC){const i=SC[r];gne(e,r,i)}CC(e,"getParameter"),CC(e,"isEnabled")}_updateCache(e){let t=!1,r;const i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const s in e){const o=e[s],l=this.cache[s];pne(o,l)||(t=!0,r=l,i&&!(s in i)&&(i[s]=l),this.cache[s]=o)}return{valueChanged:t,oldValue:r}}}function CC(n,e){const t=n[e].bind(n);n[e]=function(i){if(i===void 0||hne.has(i))return t(i);const s=pl.get(n);return i in s.cache||(s.cache[i]=t(i)),s.enable?s.cache[i]:t(i)},Object.defineProperty(n[e],"name",{value:`${e}-from-cache`,configurable:!1})}function gne(n,e,t){if(!n[e])return;const r=n[e].bind(n);n[e]=function(...s){const o=pl.get(n),{valueChanged:l,oldValue:u}=t(o._updateCache,...s);return l&&r(...s),u},Object.defineProperty(n[e],"name",{value:`${e}-to-cache`,configurable:!1})}function mne(n){const e=n.useProgram.bind(n);n.useProgram=function(r){const i=pl.get(n);i.program!==r&&(e(r),i.program=r)}}function _ne(n,e,t){let r="";const i={preserveDrawingBuffer:!0,...t};let s=null;if(s||=n.getContext("webgl2",i),i.failIfMajorPerformanceCaveat&&(r||="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow."),!s&&!t.failIfMajorPerformanceCaveat&&(i.failIfMajorPerformanceCaveat=!1,s=n.getContext("webgl2",i),s.luma||={},s.luma.softwareRenderer=!0),s||(s=n.getContext("webgl",{}),s&&(s=null,r||="Your browser only supports WebGL1")),!s)throw r||="Your browser does not support WebGL",new Error(`Failed to create WebGL context: ${r}`);const{onContextLost:o,onContextRestored:l}=e;return n.addEventListener("webglcontextlost",u=>o(u),!1),n.addEventListener("webglcontextrestored",u=>l(u),!1),s.luma||={},s}function Cu(n,e,t){return t[e]===void 0&&(t[e]=n.getExtension(e)||null),t[e]}function yne(n,e){const t=n.getParameter(7936),r=n.getParameter(7937);Cu(n,"WEBGL_debug_renderer_info",e);const i=e.WEBGL_debug_renderer_info,s=n.getParameter(i?i.UNMASKED_VENDOR_WEBGL:7936),o=n.getParameter(i?i.UNMASKED_RENDERER_WEBGL:7937),l=s||t,u=o||r,h=n.getParameter(7938),d=gD(l,u),g=vne(l,u),y=bne(l,u);return{type:"webgl",gpu:d,gpuType:y,gpuBackend:g,vendor:l,renderer:u,version:h,shadingLanguage:"glsl",shadingLanguageVersion:300}}function gD(n,e){return/NVIDIA/i.exec(n)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(n)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(n)||/Apple/i.exec(e)?"apple":/AMD/i.exec(n)||/AMD/i.exec(e)||/ATI/i.exec(n)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(n)||/SwiftShader/i.exec(e)?"software":"unknown"}function vne(n,e){return/Metal/i.exec(n)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(n)||/ANGLE/i.exec(e)?"opengl":"unknown"}function bne(n,e){if(/SwiftShader/i.exec(n)||/SwiftShader/i.exec(e))return"cpu";switch(gD(n,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function mD(n){switch(n){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(n))}const vf="WEBGL_compressed_texture_s3tc",bf="WEBGL_compressed_texture_s3tc_srgb",qc="EXT_texture_compression_rgtc",Xc="EXT_texture_compression_bptc",Tne="WEBGL_compressed_texture_etc",wne="WEBGL_compressed_texture_astc",Ene="WEBGL_compressed_texture_etc1",xne="WEBGL_compressed_texture_pvrtc",Ane="WEBGL_compressed_texture_atc",IC="EXT_texture_norm16",PC="EXT_render_snorm",Sne="EXT_color_buffer_float",WE={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[PC],"norm16-renderable-webgl":[IC],"snorm16-renderable-webgl":[IC,PC],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[vf,bf,qc,Xc],"texture-compression-bc5-webgl":[qc],"texture-compression-bc7-webgl":[Xc],"texture-compression-etc2":[Tne],"texture-compression-astc":[wne],"texture-compression-etc1-webgl":[Ene],"texture-compression-pvrtc-webgl":[xne],"texture-compression-atc-webgl":[Ane]};function Rne(n){return n in WE}function Cne(n,e,t){return(WE[e]||[]).every(i=>Cu(n,i,t))}const qE={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:Sne,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:vf},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:bf},"bc1-rgba-unorm":{gl:33777,x:vf},"bc1-rgba-unorm-srgb":{gl:35916,x:bf},"bc2-rgba-unorm":{gl:33778,x:vf},"bc2-rgba-unorm-srgb":{gl:35918,x:bf},"bc3-rgba-unorm":{gl:33779,x:vf},"bc3-rgba-unorm-srgb":{gl:35919,x:bf},"bc4-r-unorm":{gl:36283,x:qc},"bc4-r-snorm":{gl:36284,x:qc},"bc5-rg-unorm":{gl:36285,x:qc},"bc5-rg-snorm":{gl:36286,x:qc},"bc6h-rgb-ufloat":{gl:36495,x:Xc},"bc6h-rgb-float":{gl:36494,x:Xc},"bc7-rgba-unorm":{gl:36492,x:Xc},"bc7-rgba-unorm-srgb":{gl:36493,x:Xc},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function Ine(n,e,t){let r=e.create;const i=qE[e.format];return i?.gl===void 0&&(r=!1),i?.x&&(r=r&&!!Cu(n,i.x,t)),{format:e.format,create:r&&e.create,render:r&&e.render,filter:r&&e.filter,blend:r&&e.blend,store:r&&e.store}}function _D(n){const e=qE[n],t=One(n),r=gE(n);return{internalFormat:t,format:e?.dataFormat||Mne(r.channels,r.integer,r.normalized,t),type:r.dataType?mD(r.dataType):e?.types?.[0]||5121,compressed:r.compressed||!1}}function Pne(n){switch(gE(n).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${n}`)}}function Mne(n,e,t,r){if(r===6408||r===6407)return r;switch(n){case"r":return e&&!t?36244:6403;case"rg":return e&&!t?33320:33319;case"rgb":return e&&!t?36248:6407;case"rgba":return e&&!t?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function One(n){const t=qE[n]?.gl;if(t===void 0)throw new Error(`Unsupported texture format ${n}`);return t}const MC={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class kne extends FK{gl;extensions;testedFeatures=new Set;constructor(e,t,r){super([],r),this.gl=e,this.extensions=t,Cu(e,"EXT_color_buffer_float",t)}*[Symbol.iterator](){const e=this.getFeatures();for(const t of e)this.has(t)&&(yield t);return[]}has(e){return this.disabledFeatures?.[e]?!1:(this.testedFeatures.has(e)||(this.testedFeatures.add(e),Rne(e)&&Cne(this.gl,e,this.extensions)&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)),this.features.has(e))}initializeFeatures(){const e=this.getFeatures().filter(t=>t!=="polygon-mode-webgl");for(const t of e)this.has(t)}getFeatures(){return[...Object.keys(MC),...Object.keys(WE)]}getWebGLFeature(e){const t=MC[e];return typeof t=="string"?!!Cu(this.gl,t,this.extensions):!!t}}class Nne extends UK{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(e){super(),this.gl=e}getParameter(e){return this.limits[e]===void 0&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]||0}}class Df extends j_{device;gl;handle;colorAttachments=[];depthStencilAttachment=null;constructor(e,t){super(e,t);const r=t.handle===null;this.device=e,this.gl=e.gl,this.handle=this.props.handle||r?this.props.handle:this.gl.createFramebuffer(),r||(e.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const e=this.gl.bindFramebuffer(36160,this.handle);for(let t=0;t<this.colorAttachments.length;++t){const r=this.colorAttachments[t];if(r){const i=36064+t;this._attachTextureView(i,r)}}if(this.depthStencilAttachment){const t=Pne(this.depthStencilAttachment.props.format);this._attachTextureView(t,this.depthStencilAttachment)}if(this.device.props.debug){const t=this.gl.checkFramebufferStatus(36160);if(t!==36053)throw new Error(`Framebuffer ${Lne(t)}`)}this.gl.bindFramebuffer(36160,e)}_attachTextureView(e,t){const{gl:r}=this.device,{texture:i}=t,s=t.props.baseMipLevel,o=t.props.baseArrayLayer;switch(r.bindTexture(i.glTarget,i.handle),i.glTarget){case 35866:case 32879:r.framebufferTextureLayer(36160,e,i.handle,s,o);break;case 34067:const l=Dne(o);r.framebufferTexture2D(36160,e,l,i.handle,s);break;case 3553:r.framebufferTexture2D(36160,e,3553,i.handle,s);break;default:throw new Error("Illegal texture type")}r.bindTexture(i.glTarget,null)}}function Dne(n){return n<34069?n+34069:n}function Lne(n){switch(n){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${n}`}}class Une extends mE{device;format="rgba8unorm";depthStencilFormat="depth24plus";presentationSize;_framebuffer=null;get[Symbol.toStringTag](){return"WebGLCanvasContext"}constructor(e,t){super(t),this.device=e,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new Df(this.device,{handle:null}),this._framebuffer}update(){const e=this.getPixelSize();(e[0]!==this.presentationSize[0]||e[1]!==this.presentationSize[1])&&(this.presentationSize=e,this.resize())}resize(e){if(this.device.gl&&this.canvas){const t=this.getDevicePixelRatio(e?.useDevicePixels);this.setDevicePixelRatio(t,e);return}}commit(){}}async function yD(n,e){const t=document.getElementsByTagName("head")[0];if(!t)throw new Error("loadScript");const r=document.createElement("script");return r.setAttribute("type","text/javascript"),r.setAttribute("src",n),new Promise((i,s)=>{r.onload=i,r.onerror=o=>s(new Error(`Unable to load script '${n}': ${o}`)),t.appendChild(r)})}const Fne=1;let wr=null,OC=!1;const XE={debugSpectorJS:we.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function Bne(n){if(!globalThis.SPECTOR)try{await yD(n.debugSpectorJSUrl||XE.debugSpectorJSUrl)}catch(e){we.warn(String(e))}}function Vne(n){if(n={...XE,...n},!n.debugSpectorJS)return null;if(!wr&&globalThis.SPECTOR&&!globalThis.luma?.spector){we.probe(Fne,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:e}=globalThis.SPECTOR;wr=new e,globalThis.luma&&(globalThis.luma.spector=wr)}if(!wr)return null;if(OC||(OC=!0,wr.spyCanvases(),wr?.onCaptureStarted.add(e=>we.info("Spector capture started:",e)()),wr?.onCapture.add(e=>{we.info("Spector capture complete:",e)(),wr?.getResultUI(),wr?.resultView.display(),wr?.resultView.addCapture(e)})),n.gl){const e=n.gl,t=e.device;wr?.startCapture(n.gl,500),e.device=t,new Promise(r=>setTimeout(r,2e3)).then(r=>{we.info("Spector capture stopped after 2 seconds")(),wr?.stopCapture()})}return wr}const zne="https://unpkg.com/webgl-debug@2.0.1/index.js";function vD(n){return n.luma=n.luma||{},n.luma}async function jne(){Nl()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await yD(zne))}function Hne(n,e={}){return e.debugWebGL||e.traceWebGL?Wne(n,e):$ne(n)}function $ne(n){const e=vD(n);return e.realContext?e.realContext:n}function Wne(n,e){if(!globalThis.WebGLDebugUtils)return we.warn("webgl-debug not loaded")(),n;const t=vD(n);if(t.debugContext)return t.debugContext;globalThis.WebGLDebugUtils.init({...Wc,...n});const r=globalThis.WebGLDebugUtils.makeDebugContext(n,qne.bind(null,e),Xne.bind(null,e));for(const o in Wc)!(o in r)&&typeof Wc[o]=="number"&&(r[o]=Wc[o]);class i{}Object.setPrototypeOf(r,Object.getPrototypeOf(n)),Object.setPrototypeOf(i,r);const s=Object.create(i);return t.realContext=n,t.debugContext=s,s.debug=!0,s}function kC(n,e){e=Array.from(e).map(r=>r===void 0?"undefined":r);let t=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,e);return t=`${t.slice(0,100)}${t.length>100?"...":""}`,`gl.${n}(${t})`}function qne(n,e,t,r){r=Array.from(r).map(l=>l===void 0?"undefined":l);const i=globalThis.WebGLDebugUtils.glEnumToString(e),s=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,r),o=`${i} in gl.${t}(${s})`;we.error(o)();debugger}function Xne(n,e,t){let r="";we.level>=1&&(r=kC(e,t),n.traceWebGL&&we.log(1,r)());for(const i of t)if(i===void 0){r=r||kC(e,t);debugger}}const o0={};function Yne(n="id"){o0[n]=o0[n]||1;const e=o0[n]++;return`${n}-${e}`}class Lf extends Ft{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength;bytesUsed;constructor(e,t={}){super(e,t),this.device=e,this.gl=this.device.gl;const r=typeof t=="object"?t.handle:void 0;this.handle=r||this.gl.createBuffer(),e.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=Kne(this.props.usage),this.glUsage=Gne(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,t.data?this._initWithData(t.data,t.byteOffset,t.byteLength):this._initWithByteLength(t.byteLength||0)}_initWithData(e,t=0,r=e.byteLength+t){const i=this.glTarget;this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,this.glUsage),this.gl.bufferSubData(i,t,e),this.gl.bindBuffer(i,null),this.bytesUsed=r,this.byteLength=r,this._setDebugData(e,t,r),this.trackAllocatedMemory(r)}_initWithByteLength(e){let t=e;e===0&&(t=new Float32Array(0));const r=this.glTarget;return this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,t,this.glUsage),this.gl.bindBuffer(r,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(e,t=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,t,e),this.gl.bindBuffer(36663,null),this._setDebugData(e,t,e.byteLength)}async readAsync(e=0,t){return this.readSyncWebGL(e,t)}readSyncWebGL(e=0,t){t=t??this.byteLength-e;const r=new Uint8Array(t),i=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,r,i,t),this.gl.bindBuffer(36662,null),this._setDebugData(r,e,t),r}}function Kne(n){return n&Ft.INDEX?34963:n&Ft.VERTEX?34962:n&Ft.UNIFORM?35345:34962}function Gne(n){return n&Ft.INDEX||n&Ft.VERTEX?35044:n&Ft.UNIFORM?35048:35044}function Zne(n){const e=n.split(/\r?\n/),t=[];for(const r of e){if(r.length<=1)continue;const i=r.split(":");if(i.length===2){const[g,y]=i;t.push({message:y.trim(),type:NC(g),lineNum:0,linePos:0});continue}const[s,o,l,...u]=i;let h=parseInt(l,10);isNaN(h)&&(h=0);let d=parseInt(o,10);isNaN(d)&&(d=0),t.push({message:u.join(":").trim(),type:NC(s),lineNum:h,linePos:d})}return t}function NC(n){const e=["warning","error","info"],t=n.toLowerCase();return e.includes(t)?t:"info"}class Qne extends z_{device;handle;constructor(e,t){switch(super(e,t),this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const e=this.device.gl.getShaderInfoLog(this.handle);return e?Zne(e):[]}getTranslatedSource(){return this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders?.getTranslatedShaderSource(this.handle)||null}async _compile(e){e=e.startsWith("#version ")?e:`#version 300 es
${e}`;const{gl:t}=this.device;if(t.shaderSource(this.handle,e),t.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}we.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),we.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const e=async i=>await new Promise(s=>setTimeout(s,i));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:r}=this.device;for(;;){if(r.getShaderParameter(this.handle,37297))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function Jne(n,e,t,r){if(rre(e))return r(n);const i=n;i.pushState();try{return ere(n,e),Yu(i.gl,t),r(n)}finally{i.popState()}}function ere(n,e){const t=n,{gl:r}=t;if(e.cullMode)switch(e.cullMode){case"none":r.disable(2884);break;case"front":r.enable(2884),r.cullFace(1028);break;case"back":r.enable(2884),r.cullFace(1029);break}if(e.frontFace&&r.frontFace(gl("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&n.features.has("depth-clip-control")&&r.enable(34383),e.depthBias!==void 0&&(r.enable(32823),r.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&n.features.has("provoking-vertex-webgl")){const s=t.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,o=gl("provokingVertex",e.provokingVertex,{first:36429,last:36430});s?.provokingVertexWEBGL(o)}if((e.polygonMode||e.polygonOffsetLine)&&n.features.has("polygon-mode-webgl")){if(e.polygonMode){const s=t.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,o=gl("polygonMode",e.polygonMode,{fill:6914,line:6913});s?.polygonModeWEBGL(1028,o),s?.polygonModeWEBGL(1029,o)}e.polygonOffsetLine&&r.enable(10754)}if(n.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&r.enable(12288),e.clipDistance1&&r.enable(12289),e.clipDistance2&&r.enable(12290),e.clipDistance3&&r.enable(12291),e.clipDistance4&&r.enable(12292),e.clipDistance5&&r.enable(12293),e.clipDistance6&&r.enable(12294),e.clipDistance7&&r.enable(12295)),e.depthWriteEnabled!==void 0&&r.depthMask(nre("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?r.enable(2929):r.disable(2929),r.depthFunc(AT("depthCompare",e.depthCompare))),e.stencilWriteMask){const i=e.stencilWriteMask;r.stencilMaskSeparate(1028,i),r.stencilMaskSeparate(1029,i)}if(e.stencilReadMask&&we.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const i=e.stencilReadMask||4294967295,s=AT("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?r.enable(2960):r.disable(2960),r.stencilFuncSeparate(1028,s,0,i),r.stencilFuncSeparate(1029,s,0,i)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const i=a0("stencilPassOperation",e.stencilPassOperation),s=a0("stencilFailOperation",e.stencilFailOperation),o=a0("stencilDepthFailOperation",e.stencilDepthFailOperation);r.stencilOpSeparate(1028,s,o,i),r.stencilOpSeparate(1029,s,o,i)}switch(e.blend){case!0:r.enable(3042);break;case!1:r.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const i=DC("blendColorOperation",e.blendColorOperation||"add"),s=DC("blendAlphaOperation",e.blendAlphaOperation||"add");r.blendEquationSeparate(i,s);const o=Ag("blendColorSrcFactor",e.blendColorSrcFactor||"one"),l=Ag("blendColorDstFactor",e.blendColorDstFactor||"zero"),u=Ag("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),h=Ag("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");r.blendFuncSeparate(o,l,u,h)}}function AT(n,e){return gl(n,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function a0(n,e){return gl(n,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function DC(n,e){return gl(n,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function Ag(n,e){return gl(n,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function tre(n,e){return`Illegal parameter ${e} for ${n}`}function gl(n,e,t){if(!(e in t))throw new Error(tre(n,e));return t[e]}function nre(n,e){return e}function rre(n){let e=!0;for(const t in n){e=!1;break}return e}function bD(n){const e={};return n.addressModeU&&(e[10242]=l0(n.addressModeU)),n.addressModeV&&(e[10243]=l0(n.addressModeV)),n.addressModeW&&(e[32882]=l0(n.addressModeW)),n.magFilter&&(e[10240]=ST(n.magFilter)),(n.minFilter||n.mipmapFilter)&&(e[10241]=ire(n.minFilter||"linear",n.mipmapFilter)),n.lodMinClamp!==void 0&&(e[33082]=n.lodMinClamp),n.lodMaxClamp!==void 0&&(e[33083]=n.lodMaxClamp),n.type==="comparison-sampler"&&(e[34892]=34894),n.compare&&(e[34893]=AT("compare",n.compare)),n.maxAnisotropy&&(e[34046]=n.maxAnisotropy),e}function l0(n){switch(n){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function ST(n){switch(n){case"nearest":return 9728;case"linear":return 9729}}function ire(n,e="none"){if(!e)return ST(n);switch(e){case"none":return ST(n);case"nearest":return n==="nearest"?9984:9986;case"linear":return n==="nearest"?9985:9987}}class RT extends ed{device;handle;parameters;constructor(e,t){super(e,t),this.device=e,this.parameters=bD(t),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(e){for(const[t,r]of Object.entries(e)){const i=Number(t);switch(i){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,i,r);break;default:this.device.gl.samplerParameteri(this.handle,i,r);break}}}}class Yc extends V_{device;gl;handle;texture;constructor(e,t){super(e,{...At.defaultProps,...t}),this.device=e,this.gl=this.device.gl,this.handle=null,this.texture=t.texture}}const sre="Failed to deduce GL constant from typed array";function ore(n){switch(ArrayBuffer.isView(n)?n.constructor:n){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(sre)}}function are(n,e){const{clamped:t=!0}=e||{};switch(n){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return t?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function TD(n){switch(n){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function lre(n){switch(n){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function s_(n,e,t){if(cre(e))return t(n);const{nocatch:r=!0}=e,i=pl.get(n);i.push(),Yu(n,e);let s;if(r)s=t(n),i.pop();else try{s=t(n)}finally{i.pop()}return s}function cre(n){for(const e in n)return!1;return!0}function ure(n,e,t){const{dimension:r,width:i,height:s,depth:o=0}=t,{glInternalFormat:l}=t,u=t.glTarget;switch(r){case"2d-array":case"3d":n.texStorage3D(u,e,l,i,s,o);break;default:n.texStorage2D(u,e,l,i,s)}}function LC(n,e,t,r){const{width:i,height:s}=r,{dimension:o,depth:l=0,mipLevel:u=0}=r,{x:h=0,y:d=0,z:g=0}=r,{glFormat:y,glType:b}=r,w=wD(r.glTarget,o,l),E=r.flipY?{37440:!0}:{};s_(n,E,()=>{switch(o){case"2d-array":case"3d":n.bindTexture(w,e),n.texSubImage3D(w,u,h,d,g,i,s,l,y,b,t),n.bindTexture(w,null);break;case"2d":case"cube":n.bindTexture(w,e),n.texSubImage2D(w,u,h,d,i,s,y,b,t),n.bindTexture(w,null);break;default:throw new Error(o)}})}function UC(n,e,t){const{dimension:r,width:i,height:s,depth:o=0,mipLevel:l=0,byteOffset:u=0}=t,{x:h=0,y:d=0,z:g=0}=t,{glFormat:y,glType:b,compressed:w}=t,E=wD(t.glTarget,r,o);switch(r){case"2d-array":case"3d":w?n.compressedTexSubImage3D(E,l,h,d,g,i,s,o,y,e,u):n.texSubImage3D(E,l,h,d,g,i,s,o,y,b,e,u);break;case"2d":case"cube":w?n.compressedTexSubImage2D(E,l,h,d,i,s,y,e,u):n.texSubImage2D(E,l,h,d,i,s,y,b,e,u);break;default:throw new Error(r)}}function hre(n){switch(n){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(n)}function wD(n,e,t){return e==="cube"?34069+t:n}function fre(n,e){const{sourceX:t=0,sourceY:r=0,sourceAttachment:i=0}=e||{};let{target:s=null,sourceWidth:o,sourceHeight:l,sourceDepth:u,sourceFormat:h,sourceType:d}=e||{};const{framebuffer:g,deleteFramebuffer:y}=ED(n),{gl:b,handle:w}=g;o||=g.width,l||=g.height;const E=g.colorAttachments[i]?.texture;if(!E)throw new Error(`Invalid framebuffer attachment ${i}`);u=E?.depth||1,h||=E?.glFormat||6408,d||=E?.glType||5121,s=gre(s,d,h,o,l),d=d||ore(s);const x=b.bindFramebuffer(36160,w);return b.readBuffer(36064+i),b.readPixels(t,r,o,l,h,d,s),b.readBuffer(36064),b.bindFramebuffer(36160,x||null),y&&g.destroy(),s}function dre(n,e){const{target:t,sourceX:r=0,sourceY:i=0,sourceFormat:s=6408,targetByteOffset:o=0}=e||{};let{sourceWidth:l,sourceHeight:u,sourceType:h}=e||{};const{framebuffer:d,deleteFramebuffer:g}=ED(n);l=l||d.width,u=u||d.height;const y=d;h=h||5121;let b=t;if(!b){const E=TD(s),x=lre(h),C=o+l*u*E*x;b=y.device.createBuffer({byteLength:C})}const w=n.device.createCommandEncoder();return w.copyTextureToBuffer({sourceTexture:n,width:l,height:u,origin:[r,i],destinationBuffer:b,byteOffset:o}),w.destroy(),g&&d.destroy(),b}function ED(n){return n instanceof j_?{framebuffer:n,deleteFramebuffer:!1}:{framebuffer:pre(n),deleteFramebuffer:!0}}function pre(n,e){const{device:t,width:r,height:i,id:s}=n;return t.createFramebuffer({...e,id:`framebuffer-for-${s}`,width:r,height:i,colorAttachments:[n]})}function gre(n,e,t,r,i,s){if(n)return n;e||=5121;const o=are(e,{clamped:!1}),l=TD(t);return new o(r*i*l)}class Uf extends At{device;gl;handle;sampler=void 0;view=void 0;mipmaps;compressed;glTarget;glFormat;glType;glInternalFormat;textureUnit=0;constructor(e,t){super(e,t);const r={...this.props};r.data=t.data,this.device=e,this.gl=this.device.gl,this.glTarget=hre(this.props.dimension);const i=_D(this.props.format);this.glInternalFormat=i.internalFormat,this.glFormat=i.format,this.glType=i.type,this.compressed=i.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(r),Object.seal(this)}_initialize(e){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:e.data});let{width:t,height:r}=e;if(!t||!r){const i=At.getTextureDataSize(e.data);t=i?.width||1,r=i?.height||1}if(this.width=t,this.height=r,this.depth=e.depth,this.setSampler(e.sampler),this.view=new Yc(this.device,{...this.props,texture:this}),this.bind(),ure(this.gl,this.mipLevels,this),e.data)switch(e.dimension){case"1d":this.setTexture1DData(e.data);break;case"2d":this.setTexture2DData(e.data);break;case"3d":this.setTexture3DData(e.data);break;case"cube":this.setTextureCubeData(e.data);break;case"2d-array":this.setTextureArrayData(e.data);break;case"cube-array":this.setTextureCubeArrayData(e.data);break;default:throw new Error(e.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(e){return new Yc(this.device,{...e,texture:this})}setSampler(e={}){let t;e instanceof RT?(this.sampler=e,t=e.props):(this.sampler=new RT(this.device,e),t=e);const r=bD(t);this._setSamplerParameters(r)}generateMipmap(e){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(we.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!e?.force)))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(r){we.warn(`Error generating mipmap for ${this}: ${r.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(e){const t=At.getExternalImageSize(e.image),r={...At.defaultCopyExternalImageOptions,...t,...e},{image:i,depth:s,mipLevel:o,x:l,y:u,z:h,flipY:d}=r;let{width:g,height:y}=r;const{dimension:b,glTarget:w,glFormat:E,glInternalFormat:x,glType:C}=this;if(g=Math.min(g,this.width-l),y=Math.min(y,this.height-u),e.sourceX||e.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return LC(this.device.gl,this.handle,i,{dimension:b,mipLevel:o,x:l,y:u,z:h,width:g,height:y,depth:s,glFormat:E,glType:C,glTarget:w,flipY:d}),{width:r.width,height:r.height}}setTexture1DData(e){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(e,t=0){this.bind();const r=At.normalizeTextureData(e,this);r.length>1&&this.props.mipmaps!==!1&&we.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let i=0;i<r.length;i++){const s=r[i];this._setMipLevel(t,i,s)}this.unbind()}setTexture3DData(e){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(e)&&(this.bind(),UC(this.device.gl,e,this),this.unbind())}setTextureCubeData(e,t=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const r of At.CubeFaces)this.setTextureCubeFaceData(e[r],r)}setTextureArrayData(e){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(e){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(e,t,r=0){Array.isArray(e)&&e.length>1&&this.props.mipmaps!==!1&&we.warn(`${this.id} has mipmap and multiple LODs.`)();const i=At.CubeFaces.indexOf(t);this.setTexture2DData(e,i)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(e){const{face:t,width:r,height:i,pixels:s,data:o,format:l=6408,type:u=5121}=e,{gl:h}=this,d=s||o;this.bind(),d instanceof Promise?d.then(g=>this.setImageDataForFace(Object.assign({},e,{face:t,data:g,pixels:g}))):this.width||this.height?h.texImage2D(t,0,l,r,i,0,l,u,d):h.texImage2D(t,0,l,l,u,d)}_getImageDataMap(e){for(let t=0;t<At.CubeFaces.length;++t){const r=At.CubeFaces[t];e[r]&&(e[34069+t]=e[r],delete e[r])}return e}_setSamplerParameters(e){we.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(e))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[t,r]of Object.entries(e)){const i=Number(t),s=r;switch(i){case 33082:case 33083:this.gl.texParameterf(this.glTarget,i,s);break;case 10241:this.gl.texParameteri(this.glTarget,i,s);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,i,s);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,i,s);break;default:this.gl.texParameteri(this.glTarget,i,s);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(e,t,r,i=this.glTarget){if(At.isExternalImage(r)){LC(this.device.gl,this.handle,r,{...this,depth:e,mipLevel:t,glTarget:i,flipY:this.props.flipY});return}if(At.isTextureLevelData(r)){UC(this.device.gl,r.data,{...this,depth:e,mipLevel:t,glTarget:i});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(e){const{gl:t}=this;return e!==void 0&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,this.handle),e}unbind(e){const{gl:t}=this;return e!==void 0&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,null),e}}const mre=[1,2,4,8];class _re extends ol{device;glParameters;constructor(e,t){super(e,t),this.device=e;let r;if(!t?.parameters?.viewport)if(t?.framebuffer){const{width:s,height:o}=t.framebuffer;r=[0,0,s,o]}else{const[s,o]=e.getCanvasContext().getDrawingBufferSize();r=[0,0,s,o]}if(this.device.pushState(),this.setParameters({viewport:r,...this.props.parameters}),this.props.framebuffer?.handle)if(this.props.framebuffer){const s=this.props.framebuffer.colorAttachments.map((o,l)=>36064+l);this.device.gl.drawBuffers(s)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(e={}){const t={...this.glParameters};t.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(t.depthMask=!this.props.depthReadOnly),t.stencilMask=this.props.stencilReadOnly?0:1,t[35977]=this.props.discard,e.viewport&&(e.viewport.length>=6?(t.viewport=e.viewport.slice(0,4),t.depthRange=[e.viewport[4],e.viewport[5]]):t.viewport=e.viewport),e.scissorRect&&(t.scissorTest=!0,t.scissor=e.scissorRect),e.blendConstant&&(t.blendColor=e.blendConstant),e.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),e[2967]=e.stencilReference),e.colorMask&&(t.colorMask=mre.map(r=>!!(r&e.colorMask))),this.glParameters=t,Yu(this.device.gl,t)}beginOcclusionQuery(e){this.props.occlusionQuerySet?.beginOcclusionQuery()}endOcclusionQuery(){this.props.occlusionQuerySet?.endOcclusionQuery()}clear(){const e={...this.glParameters};let t=0;this.props.clearColors&&this.props.clearColors.forEach((r,i)=>{r&&this.clearColorBuffer(i,r)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(t|=16384,e.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(t|=256,e.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(t|=1024,e.clearStencil=this.props.clearStencil),t!==0&&s_(this.device.gl,e,()=>{this.device.gl.clear(t)})}clearColorBuffer(e=0,t=[0,0,0,0]){s_(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(t.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,e,t);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,e,t);break;case Float32Array:this.device.gl.clearBufferfv(6144,e,t);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function yre(n){return vre.includes(n)}const vre=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],xD={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function AD(n){const e=xD[n];if(!e)throw new Error("uniform");const[t,r,,i]=e;return{format:i,components:r,glType:t}}function bre(n){const e=xD[n];if(!e)throw new Error("attribute");const[,t,,r,i]=e;return{attributeType:r,vertexFormat:i,components:t}}function Tre(n,e){const t={attributes:[],bindings:[]};t.attributes=wre(n,e);const r=Are(n,e);for(const l of r){const u=l.uniforms.map(h=>({name:h.name,format:h.format,byteOffset:h.byteOffset,byteStride:h.byteStride,arrayLength:h.arrayLength}));t.bindings.push({type:"uniform",name:l.name,group:0,location:l.location,visibility:(l.vertex?1:0)&(l.fragment?2:0),minBindingSize:l.byteLength,uniforms:u})}const i=xre(n,e);let s=0;for(const l of i)if(yre(l.type)){const{viewDimension:u,sampleType:h}=Rre(l.type);t.bindings.push({type:"texture",name:l.name,group:0,location:s,viewDimension:u,sampleType:h}),l.textureUnit=s,s+=1}i.length&&(t.uniforms=i);const o=Ere(n,e);return o?.length&&(t.varyings=o),t}function wre(n,e){const t=[],r=n.getProgramParameter(e,35721);for(let i=0;i<r;i++){const s=n.getActiveAttrib(e,i);if(!s)throw new Error("activeInfo");const{name:o,type:l}=s,u=n.getAttribLocation(e,o);if(u>=0){const{attributeType:h}=bre(l),d=/instance/i.test(o)?"instance":"vertex";t.push({name:o,location:u,stepMode:d,type:h})}}return t.sort((i,s)=>i.location-s.location),t}function Ere(n,e){const t=[],r=n.getProgramParameter(e,35971);for(let i=0;i<r;i++){const s=n.getTransformFeedbackVarying(e,i);if(!s)throw new Error("activeInfo");const{name:o,type:l,size:u}=s,{glType:h,components:d}=AD(l),g={location:i,name:o,type:h,size:u*d};t.push(g)}return t.sort((i,s)=>i.location-s.location),t}function xre(n,e){const t=[],r=n.getProgramParameter(e,35718);for(let i=0;i<r;i++){const s=n.getActiveUniform(e,i);if(!s)throw new Error("activeInfo");const{name:o,size:l,type:u}=s,{name:h,isArray:d}=Cre(o);let g=n.getUniformLocation(e,h);const y={location:g,name:h,size:l,type:u,isArray:d};if(t.push(y),y.size>1)for(let b=0;b<y.size;b++){const w=`${h}[${b}]`;g=n.getUniformLocation(e,w);const E={...y,name:w,location:g};t.push(E)}}return t}function Are(n,e){const t=(s,o)=>n.getActiveUniformBlockParameter(e,s,o),r=[],i=n.getProgramParameter(e,35382);for(let s=0;s<i;s++){const o={name:n.getActiveUniformBlockName(e,s)||"",location:t(s,35391),byteLength:t(s,35392),vertex:t(s,35396),fragment:t(s,35398),uniformCount:t(s,35394),uniforms:[]},l=t(s,35395)||[],u=n.getActiveUniforms(e,l,35383),h=n.getActiveUniforms(e,l,35384),d=n.getActiveUniforms(e,l,35387),g=n.getActiveUniforms(e,l,35388);for(let y=0;y<o.uniformCount;++y){const b=n.getActiveUniform(e,l[y]);if(!b)throw new Error("activeInfo");o.uniforms.push({name:b.name,format:AD(u[y]).format,type:u[y],arrayLength:h[y],byteOffset:d[y],byteStride:g[y]})}r.push(o)}return r.sort((s,o)=>s.location-o.location),r}const Sre={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function Rre(n){const e=Sre[n];if(!e)throw new Error("sampler");const[t,r]=e;return{viewDimension:t,sampleType:r}}function Cre(n){if(n[n.length-1]!=="]")return{name:n,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(n);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${n}`);return{name:t[1],length:t[2]?1:0,isArray:!!t[2]}}function Ire(n,e,t,r){const i=n;let s=r;s===!0&&(s=1),s===!1&&(s=0);const o=typeof s=="number"?[s]:s;switch(t){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof r!="number")throw new Error("samplers must be set to integers");return n.uniform1i(e,r);case 5126:return n.uniform1fv(e,o);case 35664:return n.uniform2fv(e,o);case 35665:return n.uniform3fv(e,o);case 35666:return n.uniform4fv(e,o);case 5124:return n.uniform1iv(e,o);case 35667:return n.uniform2iv(e,o);case 35668:return n.uniform3iv(e,o);case 35669:return n.uniform4iv(e,o);case 35670:return n.uniform1iv(e,o);case 35671:return n.uniform2iv(e,o);case 35672:return n.uniform3iv(e,o);case 35673:return n.uniform4iv(e,o);case 5125:return i.uniform1uiv(e,o,1);case 36294:return i.uniform2uiv(e,o,2);case 36295:return i.uniform3uiv(e,o,3);case 36296:return i.uniform4uiv(e,o,4);case 35674:return n.uniformMatrix2fv(e,!1,o);case 35675:return n.uniformMatrix3fv(e,!1,o);case 35676:return n.uniformMatrix4fv(e,!1,o);case 35685:return i.uniformMatrix2x3fv(e,!1,o);case 35686:return i.uniformMatrix2x4fv(e,!1,o);case 35687:return i.uniformMatrix3x2fv(e,!1,o);case 35688:return i.uniformMatrix3x4fv(e,!1,o);case 35689:return i.uniformMatrix4x2fv(e,!1,o);case 35690:return i.uniformMatrix4x3fv(e,!1,o)}throw new Error("Illegal uniform")}function Pre(n){return oD(n)!==null||typeof n=="number"||typeof n=="boolean"}function Mre(n){const e={bindings:{},uniforms:{}};return Object.keys(n).forEach(t=>{const r=n[t];Pre(r)?e.uniforms[t]=r:e.bindings[t]=r}),e}function Ore(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(n)}}function kre(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(n)}}const FC=4;class Nre extends bu{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};constructor(e,t){super(e,t),this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=t.vs,this.fs=t.fs;const{varyings:r,bufferMode:i=35981}=t;r&&r.length>0&&(this.varyings=r,this.device.gl.transformFeedbackVaryings(this.handle,r,i)),this._linkShaders(),we.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=Tre(this.device.gl,this.handle),we.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=Dre(this.introspectedLayout,t.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(e,t){for(const[r,i]of Object.entries(e)){const s=this.shaderLayout.bindings.find(o=>o.name===r)||this.shaderLayout.bindings.find(o=>o.name===`${r}Uniforms`);if(!s){const o=this.shaderLayout.bindings.map(l=>`"${l.name}"`).join(", ");t?.disableWarnings||we.warn(`No binding "${r}" in render pipeline "${this.id}", expected one of ${o}`,i)();continue}switch(i||we.warn(`Unsetting binding "${r}" in render pipeline "${this.id}"`)(),s.type){case"uniform":if(!(i instanceof Lf)&&!(i.buffer instanceof Lf))throw new Error("buffer value");break;case"texture":if(!(i instanceof Yc||i instanceof Uf||i instanceof Df))throw new Error("texture value");break;case"sampler":we.warn(`Ignoring sampler ${r}`)();break;default:throw new Error(s.type)}this.bindings[r]=i}}draw(e){const{renderPass:t,parameters:r=this.props.parameters,topology:i=this.props.topology,vertexArray:s,vertexCount:o,instanceCount:l,isInstanced:u=!1,firstVertex:h=0,transformFeedback:d}=e,g=Ore(i),y=!!s.indexBuffer,b=s.indexBuffer?.glIndexType;if(this.linkStatus!=="success")return we.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return we.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),s.bindBeforeRender(t),d&&d.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const w=t;return Jne(this.device,r,w.glParameters,()=>{y&&u?this.device.gl.drawElementsInstanced(g,o||0,b,h,l||0):y?this.device.gl.drawElements(g,o||0,b,h):u?this.device.gl.drawArraysInstanced(g,h,o||0,l||0):this.device.gl.drawArrays(g,h,o||0),d&&d.end()}),s.unbindAfterRender(t),!0}setUniformsWebGL(e){const{bindings:t}=Mre(e);Object.keys(t).forEach(r=>{we.warn(`Unsupported value "${JSON.stringify(t[r])}" used in setUniforms() for key ${r}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,e)}async _linkShaders(){const{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),we.time(FC,`linkProgram for ${this.id}`)(),e.linkProgram(this.handle),we.timeEnd(FC,`linkProgram for ${this.id}`)(),we.level,!this.device.features.has("compilation-status-async-webgl")){const r=this._getLinkStatus();this._reportLinkStatus(r);return}we.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),we.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const t=this._getLinkStatus();this._reportLinkStatus(t)}async _reportLinkStatus(e){switch(e){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch(this.fs?.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const t=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${e}: ${t}`)}}_getLinkStatus(){const{gl:e}=this.device;return e.getProgramParameter(this.handle,35714)?(e.validateProgram(this.handle),e.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const e=async i=>await new Promise(s=>setTimeout(s,i));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:r}=this.device;for(;;){if(r.getProgramParameter(this.handle,37297))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(const t of this.shaderLayout.bindings)!this.bindings[t.name]&&!this.bindings[t.name.replace(/Uniforms$/,"")]&&(we.warn(`Binding ${t.name} not found in ${this.id}`)(),e=!1);return e}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:e}=this.device;e.useProgram(this.handle);let t=0,r=0;for(const i of this.shaderLayout.bindings){const s=this.bindings[i.name]||this.bindings[i.name.replace(/Uniforms$/,"")];if(!s)throw new Error(`No value for binding ${i.name} in ${this.id}`);switch(i.type){case"uniform":const{name:o}=i,l=e.getUniformBlockIndex(this.handle,o);if(l===4294967295)throw new Error(`Invalid uniform block name ${o}`);e.uniformBlockBinding(this.handle,r,l),s instanceof Lf?e.bindBufferBase(35345,r,s.handle):e.bindBufferRange(35345,r,s.buffer.handle,s.offset||0,s.size||s.buffer.byteLength-s.offset),r+=1;break;case"texture":if(!(s instanceof Yc||s instanceof Uf||s instanceof Df))throw new Error("texture");let u;if(s instanceof Yc)u=s.texture;else if(s instanceof Uf)u=s;else if(s instanceof Df&&s.colorAttachments[0]instanceof Yc)we.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),u=s.colorAttachments[0].texture;else throw new Error("No texture");e.activeTexture(33984+t),e.bindTexture(u.glTarget,u.handle),t+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${i.type}' not supported in WebGL`)}}}_applyUniforms(){for(const e of this.shaderLayout.uniforms||[]){const{name:t,location:r,type:i,textureUnit:s}=e,o=this.uniforms[t]??s;o!==void 0&&Ire(this.device.gl,r,i,o)}}}function Dre(n,e){const t={...n,attributes:n.attributes.map(r=>({...r}))};for(const r of e?.attributes||[]){const i=t.attributes.find(s=>s.name===r.name);i?(i.type=r.type||i.type,i.stepMode=r.stepMode||i.stepMode):we.warn(`shader layout attribute ${r.name} not present in shader`)}return t}class Lre extends yE{device;commands=[];constructor(e){super(e,{}),this.device=e}submitCommands(e=this.commands){for(const t of e)switch(t.name){case"copy-buffer-to-buffer":Ure(this.device,t.options);break;case"copy-buffer-to-texture":Fre(this.device,t.options);break;case"copy-texture-to-buffer":Bre(this.device,t.options);break;case"copy-texture-to-texture":Vre(this.device,t.options);break;default:throw new Error(t.name)}}}function Ure(n,e){const t=e.sourceBuffer,r=e.destinationBuffer;n.gl.bindBuffer(36662,t.handle),n.gl.bindBuffer(36663,r.handle),n.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),n.gl.bindBuffer(36662,null),n.gl.bindBuffer(36663,null)}function Fre(n,e){throw new Error("Not implemented")}function Bre(n,e){const{sourceTexture:t,mipLevel:r=0,aspect:i="all",width:s=e.sourceTexture.width,height:o=e.sourceTexture.height,depthOrArrayLayers:l=0,origin:u=[0,0],destinationBuffer:h,byteOffset:d=0,bytesPerRow:g,rowsPerImage:y}=e;if(i!=="all")throw new Error("aspect not supported in WebGL");if(r!==0||l!==0||g||y)throw new Error("not implemented");const{framebuffer:b,destroyFramebuffer:w}=SD(t);let E;try{const x=h,C=s||b.width,M=o||b.height,O=_D(b.colorAttachments[0].texture.props.format),V=O.format,H=O.type;n.gl.bindBuffer(35051,x.handle),E=n.gl.bindFramebuffer(36160,b.handle),n.gl.readPixels(u[0],u[1],C,M,V,H,d)}finally{n.gl.bindBuffer(35051,null),E!==void 0&&n.gl.bindFramebuffer(36160,E),w&&b.destroy()}}function Vre(n,e){const{sourceTexture:t,destinationMipLevel:r=0,origin:i=[0,0],destinationOrigin:s=[0,0],destinationTexture:o}=e;let{width:l=e.destinationTexture.width,height:u=e.destinationTexture.height}=e;const{framebuffer:h,destroyFramebuffer:d}=SD(t),[g,y]=i,[b,w,E]=s,x=n.gl.bindFramebuffer(36160,h.handle);let C=null,M;if(o instanceof Uf)C=o,l=Number.isFinite(l)?l:C.width,u=Number.isFinite(u)?u:C.height,C.bind(0),M=C.glTarget;else throw new Error("invalid destination");switch(M){case 3553:case 34067:n.gl.copyTexSubImage2D(M,r,b,w,g,y,l,u);break;case 35866:case 32879:n.gl.copyTexSubImage3D(M,r,b,w,E,g,y,l,u);break}C&&C.unbind(),n.gl.bindFramebuffer(36160,x),d&&h.destroy()}function SD(n){if(n instanceof At){const{width:e,height:t,id:r}=n;return{framebuffer:n.device.createFramebuffer({id:`framebuffer-for-${r}`,width:e,height:t,colorAttachments:[n]}),destroyFramebuffer:!0}}return{framebuffer:n,destroyFramebuffer:!1}}class zre extends _E{device;commandBuffer;constructor(e,t){super(e,t),this.device=e,this.commandBuffer=new Lre(e)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}resolveQuerySet(e,t,r){}}function jre(n){const{target:e,source:t,start:r=0,count:i=1}=n,s=t.length,o=i*s;let l=0;for(let u=r;l<s;l++)e[u++]=t[l];for(;l<o;)l<o-l?(e.copyWithin(r+l,r,r+l),l*=2):(e.copyWithin(r+l,r,r+o-l),l=o);return n.target}class YE extends vE{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(e){return bq()==="Chrome"}constructor(e,t){super(e,t),this.device=e,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){const t=e;if(t&&t.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,t?t.handle:null),this.indexBuffer=t,this.device.gl.bindVertexArray(null)}setBuffer(e,t){const r=t;if(r.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:i,type:s,stride:o,offset:l,normalized:u,integer:h,divisor:d}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,r.handle),h?this.device.gl.vertexAttribIPointer(e,i,s,o,l):this.device.gl.vertexAttribPointer(e,i,s,u,o,l),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,d||0),this.attributes[e]=r,this.device.gl.bindVertexArray(null)}setConstantWebGL(e,t){this._enable(e,!1),this.attributes[e]=t}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){const t=this.attributes[e];ArrayBuffer.isView(t)&&this.device.setConstantAttributeWebGL(e,t)}}_getAccessor(e){const t=this.attributeInfos[e];if(!t)throw new Error(`Unknown attribute location ${e}`);const r=mD(t.bufferDataType);return{size:t.bufferComponents,type:r,stride:t.byteStride,offset:t.byteOffset,normalized:t.normalized,integer:t.integer,divisor:t.stepMode==="instance"?1:0}}_enable(e,t=!0){const i=YE.isConstantAttributeZeroSupported(this.device)||e!==0;(t||i)&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),t?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,t){const r=Hre(t),i=r.byteLength*e,s=r.length*e;if(this.buffer&&i!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${i} !== ${this.buffer.byteLength}.`);let o=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:i}),o=o||!$re(r,this.bufferValue),o){const l=dG(t.constructor,s);jre({target:l,source:r,start:0,count:s}),this.buffer.write(l),this.bufferValue=t}return this.buffer}}function Hre(n){return Array.isArray(n)?new Float32Array(n):n}function $re(n,e){if(!n||!e||n.length!==e.length||n.constructor!==e.constructor)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}class Wre extends bE{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(e,t){super(e,t),this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,t.buffers&&this.setBuffers(t.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(e="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(kre(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const t in e)this.setBuffer(t,e[t])})}setBuffer(e,t){const r=this._getVaryingIndex(e),{buffer:i,byteLength:s,byteOffset:o}=this._getBufferRange(t);if(r<0){this.unusedBuffers[e]=i,we.warn(`${this.id} unusedBuffers varying buffer ${e}`)();return}this.buffers[r]={buffer:i,byteLength:s,byteOffset:o},this.bindOnUse||this._bindBuffer(r,i,o,s)}getBuffer(e){if(BC(e))return this.buffers[e]||null;const t=this._getVaryingIndex(e);return t>=0?this.buffers[t]:null}bind(e=this.handle){if(typeof e!="function")return this.gl.bindTransformFeedback(36386,e),this;let t;return this._bound?t=e():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,t=e(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),t}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof Lf)return{buffer:e,byteOffset:0,byteLength:e.byteLength};const{buffer:t,byteOffset:r=0,byteLength:i=e.buffer.byteLength}=e;return{buffer:t,byteOffset:r,byteLength:i}}_getVaryingIndex(e){if(BC(e))return Number(e);for(const t of this.layout.varyings)if(e===t.name)return t.location;return-1}_bindBuffers(){for(const e in this.buffers){const{buffer:t,byteLength:r,byteOffset:i}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),t,i,r)}}_unbindBuffers(){for(const e in this.buffers)this.gl.bindBufferBase(35982,Number(e),null)}_bindBuffer(e,t,r=0,i){const s=t&&t.handle;!s||i===void 0?this.gl.bindBufferBase(35982,e,s):this.gl.bindBufferRange(35982,e,s,r,i)}}function BC(n){return typeof n=="number"?Number.isInteger(n):/^\d+$/.test(n)}class qre extends TE{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(e,t){if(super(e,t),this.device=e,t.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(e){return this._begin(e?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(e){this._queryPending||(this.target=e,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.device.gl.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise((r,i)=>{const s=()=>{this.isResultAvailable()?(r(this.getResult()),this._pollingPromise=null):t++>e?(i("Timed out"),this._pollingPromise=null):requestAnimationFrame(s)};requestAnimationFrame(s)}),this._pollingPromise}}class Kc extends ia{type="webgl";handle;features;limits;info;canvasContext;lost;_resolveContextLost;gl;debug=!1;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};_extensions={};_polyfilled=!1;spectorJS;constructor(e){super({...e,id:e.id||Yne("webgl-device")});const t=ia._getCanvasContextProps(e);if(!t)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let r=t.canvas?.gl?.device;if(r)throw new Error(`WebGL context already attached to device ${r.id}`);this.canvasContext=new Une(this,t),this.lost=new Promise(d=>{this._resolveContextLost=d});const i={...e.webgl};t.alphaMode==="premultiplied"&&(i.premultipliedAlpha=!0),e.powerPreference!==void 0&&(i.powerPreference=e.powerPreference);const o=this.props._handle||_ne(this.canvasContext.canvas,{onContextLost:d=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."}),onContextRestored:d=>console.log("WebGL context restored")},i);if(!o)throw new Error("WebGL context creation failed");if(r=o.device,r){if(e._reuseDevices)return we.log(1,`Not creating a new Device, instead returning a reference to Device ${r.id} already attached to WebGL context`,r)(),r._reused=!0,r;throw new Error(`WebGL context already attached to device ${r.id}`)}this.handle=o,this.gl=o,this.spectorJS=Vne({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=yne(this.gl,this._extensions),this.limits=new Nne(this.gl),this.features=new kne(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),t.autoResize!==!1&&this.canvasContext.resize(),new pl(this.gl,{log:(...d)=>we.log(1,...d)()}).trackState(this.gl,{copyState:!1});const u=e.debugWebGL||e.debug,h=e.debugWebGL;u&&(this.gl=Hne(this.gl,{debugWebGL:u,traceWebGL:h}),we.warn("WebGL debug mode activated. Performance reduced.")(),e.debugWebGL&&(we.level=Math.max(we.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){const t=this._normalizeBufferProps(e);return new Lf(this,t)}createTexture(e){return new Uf(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new RT(this,e)}createShader(e){return new Qne(this,e)}createFramebuffer(e){return new Df(this,e)}createVertexArray(e){return new YE(this,e)}createTransformFeedback(e){return new Wre(this,e)}createQuerySet(e){return new qre(this,e)}createRenderPipeline(e){return new Nre(this,e)}beginRenderPass(e){return new _re(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}renderPass=null;createCommandEncoder(e={}){return new zre(this,e)}submit(){this.renderPass?.end(),this.renderPass=null}readPixelsToArrayWebGL(e,t){return fre(e,t)}readPixelsToBufferWebGL(e,t){return dre(e,t)}setParametersWebGL(e){Yu(this.gl,e)}getParametersWebGL(e){return pD(this.gl,e)}withParametersWebGL(e,t){return s_(this.gl,e,t)}resetWebGL(){we.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),fne(this.gl)}_getDeviceSpecificTextureFormatCapabilities(e){return Ine(this.gl,e,this._extensions)}loseDevice(){let e=!1;const r=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return r&&(e=!0,r.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),e}pushState(){pl.get(this.gl).push()}popState(){pl.get(this.gl).pop()}setSpectorMetadata(e,t){e.__SPECTOR_Metadata=t}getGLKey(e,t){const r=Number(e);for(const i in this.gl)if(this.gl[i]===r)return`GL.${i}`;return t?.emptyIfUnknown?"":String(e)}getGLKeys(e){const t={emptyIfUnknown:!0};return Object.entries(e).reduce((r,[i,s])=>(r[`${i}:${this.getGLKey(i,t)}`]=`${s}:${this.getGLKey(s,t)}`,r),{})}_constants;setConstantAttributeWebGL(e,t){const r=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(r).fill(null);const i=this._constants[e];switch(i&&Gre(i,t)&&we.info(1,`setConstantAttributeWebGL(${e}) could have been skipped, value unchanged`)(),this._constants[e]=t,t.constructor){case Float32Array:Xre(this,e,t);break;case Int32Array:Yre(this,e,t);break;case Uint32Array:Kre(this,e,t);break;default:throw new Error("constant")}}getExtension(e){return Cu(this.gl,e,this._extensions),this._extensions}}function Xre(n,e,t){switch(t.length){case 1:n.gl.vertexAttrib1fv(e,t);break;case 2:n.gl.vertexAttrib2fv(e,t);break;case 3:n.gl.vertexAttrib3fv(e,t);break;case 4:n.gl.vertexAttrib4fv(e,t);break}}function Yre(n,e,t){n.gl.vertexAttribI4iv(e,t)}function Kre(n,e,t){n.gl.vertexAttribI4uiv(e,t)}function Gre(n,e){if(!n||!e||n.length!==e.length||n.constructor!==e.constructor)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}const Zre={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},Qre=n=>({drawBuffersWEBGL(e){return n.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),Jre=n=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return n.createVertexArray()},deleteVertexArrayOES(e){return n.deleteVertexArray(e)},isVertexArrayOES(e){return n.isVertexArray(e)},bindVertexArrayOES(e){return n.bindVertexArray(e)}}),eie=n=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return n.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return n.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return n.vertexAttribDivisor(...e)}});function tie(n=!0){const e=HTMLCanvasElement.prototype;if(!n&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(t,r){if(t==="webgl"||t==="experimental-webgl"){const i=this.originalGetContext("webgl2",r);return i instanceof HTMLElement&&nie(i),i}return this.originalGetContext(t,r)}}function nie(n){n.getExtension("EXT_color_buffer_float");const e={...Zre,WEBGL_disjoint_timer_query:n.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:Qre(n),OES_vertex_array_object:Jre(n),ANGLE_instanced_arrays:eie(n)},t=n.getExtension;n.getExtension=function(i){const s=t.call(n,i);return s||(i in e?e[i]:null)};const r=n.getSupportedExtensions;n.getSupportedExtensions=function(){return(r.apply(n)||[])?.concat(Object.keys(e))}}const Sg=1;class rie extends HK{type="webgl";constructor(){super(),ia.defaultProps={...ia.defaultProps,...XE},Kc.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(e){tie(e)}async attach(e){if(e instanceof Kc)return e;if(e?.device instanceof ia)return e.device;if(!iie(e))throw new Error("Invalid WebGL2RenderingContext");return new Kc({_handle:e,createCanvasContext:{canvas:e.canvas,autoResize:!1}})}async create(e={}){we.groupCollapsed(Sg,"WebGLDevice created")();const t=[];(e.debugWebGL||e.debug)&&t.push(jne()),e.debugSpectorJS&&t.push(Bne(e));const r=await Promise.allSettled(t);for(const o of r)o.status==="rejected"&&we.error(`Failed to initialize debug libraries ${o.reason}`)();const i=new Kc(e),s=`${i._reused?"Reusing":"Created"} device with WebGL2 ${i.debug?"debug ":""}context: ${i.info.vendor}, ${i.info.renderer} for canvas: ${i.canvasContext.id}`;return we.probe(Sg,s)(),we.table(Sg,i.info)(),we.groupEnd(Sg)(),i}}function iie(n){return typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext?!0:!!(n&&Number.isFinite(n._version))}const VC=new rie;function Fo(){}const sie=({isDragging:n})=>n?"grabbing":"grab",RD={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Fo,onWebGLInitialized:Fo,onResize:Fo,onViewStateChange:Fo,onInteractionStateChange:Fo,onBeforeRender:Fo,onAfterRender:Fo,onLoad:Fo,onError:n=>ot.error(n.message,n.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:sie,getTooltip:null,debug:!1,drawPickingColors:!1};class KE{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Cd({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=r=>{const{_pickRequest:i}=this;if(r.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(r.leftButton||r.rightButton)return;{const s=r.offsetCenter;if(!s)return;i.x=s.x,i.y=s.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=r},this._onEvent=r=>{const i=yT[r.type],s=r.offsetCenter;if(!i||!s||!this.layerManager)return;const o=this.layerManager.getLayers(),l=this.deckPicker.getLastPickedObject({x:s.x,y:s.y,layers:o,viewports:this.getViewports(s)},this._lastPointerDownInfo),{layer:u}=l,h=u&&(u[i]||u.props[i]),d=this.props[i];let g=!1;h&&(g=h.call(u,l,r)),g||(d?.(l,r),this.widgetManager.onEvent(l,r))},this._onPointerDown=r=>{if(this.device?.type==="webgpu")return;const i=r.offsetCenter,s=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=s.result[0]||s.emptyInfo},this.props={...RD,...e},e=this.props,e.viewState&&e.initialViewState&&ot.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let t=this.device;!t&&e.gl&&(e.gl instanceof WebGLRenderingContext&&ot.error("WebGL1 context not supported.")(),t=VC.attach(e.gl)),t||(t=aT.createDevice({type:"best-available",_reuseDevices:!0,adapters:[VC],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&xu.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&ot.removed("onLayerHover","onHover")(),"onLayerClick"in e&&ot.removed("onLayerClick","onClick")(),e.initialViewState&&!ui(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop?.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t),this.widgetManager.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return t=t||r||i||s||o,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return On(this.viewManager),this.viewManager.views}getViewports(e){return On(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){this.layerManager?.removeDefaultShaderModule(e)}_pick(e,t,r){On(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(t).timeStart();const s=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return i.get(t).timeEnd(),s}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),On(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){if(!this.canvas)return;const{width:t,height:r}=e;if(t||t===0){const i=Number.isFinite(t)?`${t}px`:t;this.canvas.style.width=i}if(r||r===0){const i=Number.isFinite(r)?`${r}px`:r;this.canvas.style.position=e.style?.position||"absolute",this.canvas.style.height=i}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const t=e.clientWidth??e.width,r=e.clientHeight??e.height;(t!==this.width||r!==this.height)&&(this.width=t,this.height=r,this.viewManager?.setProps({width:t,height:r}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:t,height:r}))}_createAnimationLoop(e,t){const{gl:r,onError:i,useDevicePixels:s}=t;return new lte({device:e,useDevicePixels:s,autoResizeDrawingBuffer:!r,autoResizeViewport:!1,onInitialize:o=>this._setDevice(o.device),onRender:this._onRenderFrame.bind(this),onError:i})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new HE({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){if(this.device?.type==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const{result:t,emptyInfo:r}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=t.length>0;let i=r,s=!1;for(const o of t)i=o,s=o.layer?.onHover(o,e.event)||s;s||(this.props.onHover?.(i,e.event),this.widgetManager.onHover(i,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const t=new sD;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new FJ(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(aC).map(i=>{const[s,o,l,u]=aC[i],h=this.props.eventRecognizerOptions?.[i],d={...o,...h,event:i};return{recognizer:new s(d),recognizeWith:l,requestFailure:u}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const i in yT)this.eventManager.on(i,this._onEvent);this.viewManager=new Ote({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new Mte(this.device,{deck:this,stats:this.stats,viewport:r,timeline:t}),this.effectManager=new Yte({deck:this,device:this.device}),this.deckRenderer=new Zte(this.device),this.deckPicker=new rne(this.device),this.widgetManager=new one({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new lne),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){const{device:r,gl:i}=this.layerManager.context;this.props.onBeforeRender({device:r,gl:i});const s={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};this.deckRenderer?.renderLayers(s),s.pass==="screen"&&this.widgetManager.onRedraw({viewports:s.viewports,layers:s.layers}),this.props.onAfterRender({device:r,gl:i})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),ot.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this.device?.type!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const r=aT.stats.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}KE.defaultProps=RD;KE.VERSION=YY;function oie(n){switch(n){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return e4(n)}}const aie=JN;function Rg(n,e,t){const r=t==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:n,format:e.size>1?`${r}x${e.size}`:e.type,byteOffset:e.offset||0}}function cl(n){return n.stride||n.size*n.bytesPerElement}function lie(n,e){return n.type===e.type&&n.size===e.size&&cl(n)===cl(e)&&(n.offset||0)===(e.offset||0)}function CT(n,e){e.offset&&ot.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=cl(n),r=e.vertexOffset!==void 0?e.vertexOffset:n.vertexOffset||0,i=e.elementOffset||0,s=r*t+i*n.bytesPerElement+(n.offset||0);return{...e,offset:s,stride:t}}function cie(n,e){const t=CT(n,e);return{high:t,low:{...t,offset:t.offset+n.size*4}}}class uie{constructor(e,t,r){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const i=t.logicalType||t.type,s=i==="float64";let{defaultValue:o}=t;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let l;s?l="float32":!i&&t.isIndexed?l="uint32":l=i||"float32";let u=oie(i||l);this.doublePrecision=s,s&&t.fp64===!1&&(u=Float32Array),this.value=null,this.settings={...t,defaultType:u,defaultValue:o,logicalType:i,type:l,normalized:l.includes("norm"),size:this.size,bytesPerElement:u.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*cl(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),xu.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){const r={};if(this.state.constant){const i=this.value;if(t){const s=CT(this.getAccessor(),t),o=s.offset/i.BYTES_PER_ELEMENT,l=s.size||this.size;r[e]=i.subarray(o,o+l)}else r[e]=i}else r[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?r[`${e}64Low`]=r[e]:r[`${e}64Low`]=new Float32Array(this.size)),r}_getBufferLayout(e=this.id,t=null){const r=this.getAccessor(),i=[],s={name:this.id,byteStride:cl(r),attributes:i};if(this.doublePrecision){const o=cie(r,t||{});i.push(Rg(e,{...r,...o.high},this.device.type),Rg(`${e}64Low`,{...r,...o.low},this.device.type))}else if(t){const o=CT(r,t);i.push(Rg(e,{...r,...o},this.device.type))}else i.push(Rg(e,r,this.device.type));return s}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:r,size:i}=this,s=r*i;if(t&&s&&t.length>=s){const o=new Array(i).fill(1/0),l=new Array(i).fill(-1/0);for(let u=0;u<s;)for(let h=0;h<i;h++){const d=t[u++];d<o[h]&&(o[h]=d),d>l[h]&&(l[h]=d)}e=[o,l]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof Ft?r={buffer:e}:r=e;const i={...this.settings,...r};if(ArrayBuffer.isView(r.value)){if(!r.type)if(this.doublePrecision&&r.value instanceof Float64Array)i.type="float32";else{const o=aie(r.value);i.type=i.normalized?o.replace("int","norm"):o}i.bytesPerElement=r.value.BYTES_PER_ELEMENT,i.stride=cl(i)}if(t.bounds=null,r.constant){let s=r.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!t.constant||!this._areValuesEqual(s,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(s)?s:new Float32Array(s)}else if(r.buffer){const s=r.buffer;t.externalBuffer=s,t.constant=!1,this.value=r.value||null}else if(r.value){this._checkExternalBuffer(r);let s=r.value;t.externalBuffer=null,t.constant=!1,this.value=s;let{buffer:o}=this;const l=cl(i),u=(i.vertexOffset||0)*l;if(this.doublePrecision&&s instanceof Float64Array&&(s=Jb(s,i)),this.settings.isIndexed){const d=this.settings.defaultType;s.constructor!==d&&(s=new d(s))}const h=s.byteLength+u+l*2;(!o||o.byteLength<h)&&(o=this._createBuffer(h)),o.write(s,u)}return this.setAccessor(i),!0}updateSubBuffer(e={}){this.state.bounds=null;const t=this.value,{startOffset:r=0,endOffset:i}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?Jb(t,{size:this.size,startIndex:r,endIndex:i}):t.subarray(r,i),r*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){const{state:r}=this,i=r.allocatedValue,s=xu.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=s;const{byteOffset:o}=this;let{buffer:l}=this;return(!l||l.byteLength<s.byteLength+o)&&(l=this._createBuffer(s.byteLength+o),t&&i&&l.write(i instanceof Float64Array?Jb(i,this):i,o)),r.allocatedValue=s,r.constant=!1,r.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);const r=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=t.BYTES_PER_ELEMENT<4),i)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);!(t instanceof r)&&this.settings.normalized&&!("normalized"in e)&&ot.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(t=>(t+128)/255*2-1);case"snorm16":return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(t=>t/255);case"unorm16":return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,r){const{defaultValue:i,size:s}=this.settings;if(Number.isFinite(e))return t[r]=e,t;if(!e){let o=s;for(;--o>=0;)t[r+o]=i[o];return t}switch(s){case 4:t[r+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:t[r+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:t[r+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:t[r+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let o=s;for(;--o>=0;)t[r+o]=Number.isFinite(e[o])?e[o]:i[o]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:r}=this;for(let i=0;i<r;i++)if(e[i]!==t[i])return!1;return!0}_createBuffer(e){this._buffer&&this._buffer.destroy();const{isIndexed:t,type:r}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:(t?Ft.INDEX:Ft.VERTEX)|Ft.COPY_DST,indexType:t?r:void 0,byteLength:e}),this._buffer}}const zC=[],jC=[];function X_(n,e=0,t=1/0){let r=zC;const i={index:-1,data:n,target:[]};return n?typeof n[Symbol.iterator]=="function"?r=n:n.length>0&&(jC.length=n.length,r=jC):r=zC,(e>0||Number.isFinite(t))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,t),i.index=e-1),{iterable:r,objectInfo:i}}function CD(n){return n&&n[Symbol.asyncIterator]}function ID(n,e){const{size:t,stride:r,offset:i,startIndices:s,nested:o}=e,l=n.BYTES_PER_ELEMENT,u=r?r/l:t,h=i?i/l:0,d=Math.floor((n.length-h)/u);return(g,{index:y,target:b})=>{if(!s){const C=y*u+h;for(let M=0;M<t;M++)b[M]=n[C+M];return b}const w=s[y],E=s[y+1]||d;let x;if(o){x=new Array(E-w);for(let C=w;C<E;C++){const M=C*u+h;b=new Array(t);for(let O=0;O<t;O++)b[O]=n[M+O];x[C-w]=b}}else if(u===t)x=n.subarray(w*t+h,E*t+h);else{x=new n.constructor((E-w)*t);let C=0;for(let M=w;M<E;M++){const O=M*u+h;for(let V=0;V<t;V++)x[C++]=n[O+V]}}return x}}const hie=[],lm=[[0,1/0]];function fie(n,e){if(n===lm||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return n;const t=[],r=n.length;let i=0;for(let s=0;s<r;s++){const o=n[s];o[1]<e[0]?(t.push(o),i=s+1):o[0]>e[1]?t.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return t.splice(i,0,e),t}const die={interpolation:{duration:0,easing:n=>n},spring:{stiffness:.05,damping:.5}};function PD(n,e){if(!n)return null;Number.isFinite(n)&&(n={type:"interpolation",duration:n});const t=n.type||"interpolation";return{...die[t],...e,...n,type:t}}class MD extends uie{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:lm}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t;(t=this.state).layoutChanged||(t.layoutChanged=!lie(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,r=this.settings.transition,i=Array.isArray(t)?e[t.find(s=>e[s])]:e[t];return PD(i,r)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:r=0,endRow:i=1/0}=t;this.state.updateRanges=fie(this.state.updateRanges,[r,i])}else this.state.updateRanges=lm}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=hie}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,t.updateRanges!==lm),!0):!1}updateBuffer({numInstances:e,data:t,props:r,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:o,noAlloc:l}}=this;let u=!0;if(o){for(const[h,d]of s)o.call(i,this,{data:t,startRow:h,endRow:d,props:r,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[h,d]of s){const g=Number.isFinite(h)?this.getVertexOffset(h):0,y=Number.isFinite(d)?this.getVertexOffset(d):l||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:g,endOffset:y})}this._checkAttributeArray()}else u=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),u}setConstantValue(e){return this.device.type==="webgpu"||e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:r,settings:i}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),i.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const o=e;On(ArrayBuffer.isView(o.value),`invalid ${i.accessor}`);const l=!!o.size&&o.size!==this.size;return r.binaryAccessor=ID(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:t,nested:l}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const r in e)Object.assign(t,super.getValue(r,e[r]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,r=super._getBufferLayout(),{stepMode:i}=this.settings;if(i==="dynamic"?r.stepMode=e?e.isInstanced?"instance":"vertex":"instance":r.stepMode=i??"vertex",!t)return r;for(const s in t){const o=super._getBufferLayout(s,t[s]);r.attributes.push(...o.attributes)}return r}_autoUpdater(e,{data:t,startRow:r,endRow:i,props:s,numInstances:o}){if(e.constant&&this.context.device.type!=="webgpu")return;const{settings:l,state:u,value:h,size:d,startIndices:g}=e,{accessor:y,transform:b}=l;let w=u.binaryAccessor||(typeof y=="function"?y:s[y]);typeof w!="function"&&(w=()=>w),On(typeof w=="function",`accessor "${y}" is not a function`);let E=e.getVertexOffset(r);const{iterable:x,objectInfo:C}=X_(t,r,i);for(const M of x){C.index++;let O=w(M,C);if(b&&(O=b.call(this,O)),g){const V=(C.index<g.length-1?g[C.index+1]:o)-g[C.index];if(O&&Array.isArray(O[0])){let H=E;for(const G of O)e._normalizeValue(G,h,H),H+=d}else O&&O.length>d?h.set(O,E):(e._normalizeValue(O,C.target,0),Ste({target:h,source:C.target,start:E,count:V}));E+=V*d}else e._normalizeValue(O,h,E),E+=d}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let r=!0;switch(t){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function c0(n){const{source:e,target:t,start:r=0,size:i,getData:s}=n,o=n.end||t.length,l=e.length,u=o-r;if(l>u){t.set(e.subarray(0,u),r);return}if(t.set(e,r),!s)return;let h=l;for(;h<u;){const d=s(h,e);for(let g=0;g<i;g++)t[r+h]=d[g]||0,h++}}function pie({source:n,target:e,size:t,getData:r,sourceStartIndices:i,targetStartIndices:s}){if(!i||!s)return c0({source:n,target:e,size:t,getData:r}),e;let o=0,l=0;const u=r&&((d,g)=>r(d+l,g)),h=Math.min(i.length,s.length);for(let d=1;d<h;d++){const g=i[d]*t,y=s[d]*t;c0({source:n.subarray(o,g),target:e,start:l,end:y,size:t,getData:u}),o=g,l=y}return l<e.length&&c0({source:[],target:e,start:l,size:t,getData:u}),e}function gie(n){const{device:e,settings:t,value:r}=n,i=new MD(e,t);return i.setData({value:r instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:t.normalized}),i}function OD(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${n}"`)}}function kD(n){switch(n){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function ND(n){n.push(n.shift())}function mie(n,e){const{doublePrecision:t,settings:r,value:i,size:s}=n,o=t&&i instanceof Float64Array?2:1;let l=0;const{shaderAttributes:u}=n.settings;if(u)for(const h of Object.values(u))l=Math.max(l,h.vertexOffset??0);return(r.noAlloc?i.length:(e+l)*s)*o}function DD({device:n,source:e,target:t}){return(!t||t.byteLength<e.byteLength)&&(t?.destroy(),t=n.createBuffer({byteLength:e.byteLength,usage:e.usage})),t}function LD({device:n,buffer:e,attribute:t,fromLength:r,toLength:i,fromStartIndices:s,getData:o=l=>l}){const l=t.doublePrecision&&t.value instanceof Float64Array?2:1,u=t.size*l,h=t.byteOffset,d=t.settings.bytesPerElement<4?h/t.settings.bytesPerElement*4:h,g=t.startIndices,y=s&&g,b=t.isConstant;if(!y&&e&&r>=i)return e;const w=t.value instanceof Float64Array?Float32Array:t.value.constructor,E=b?t.value:new w(t.getBuffer().readSyncWebGL(h,i*w.BYTES_PER_ELEMENT).buffer);if(t.settings.normalized&&!b){const O=o;o=(V,H)=>t.normalizeConstant(O(V,H))}const x=b?(O,V)=>o(E,V):(O,V)=>o(E.subarray(O+h,O+h+u),V),C=e?new Float32Array(e.readSyncWebGL(d,r*4).buffer):new Float32Array(0),M=new Float32Array(i);return pie({source:C,target:M,sourceStartIndices:s,targetStartIndices:g,size:u,getData:x}),(!e||e.byteLength<M.byteLength+d)&&(e?.destroy(),e=n.createBuffer({byteLength:M.byteLength+d,usage:35050})),e.write(M,d),e}class UD{constructor({device:e,attribute:t,timeline:r}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new q_(r),this.attribute=t,this.attributeInTransition=gie(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,r=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=mie(this.attribute,t),this.transition.start({...e,duration:r})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class _ie extends UD{constructor({device:e,attribute:t,timeline:r}){super({device:e,attribute:t,timeline:r}),this.type="interpolation",this.transform=Tie(e,t)}start(e,t){const r=this.currentLength,i=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:s,attribute:o}=this;ND(s),s[0]=LD({device:this.device,buffer:s[0],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter}),s[1]=DD({device:this.device,source:s[0],target:s[1]}),this.setBuffer(s[1]);const{transform:l}=this,u=l.model;let h=Math.floor(this.currentLength/o.size);FD(o)&&(h/=2),u.setVertexCount(h),o.isConstant?(u.setAttributes({aFrom:s[0]}),u.setConstantAttributes({aTo:o.value})):u.setAttributes({aFrom:s[0],aTo:o.getBuffer()}),l.transformFeedback.setBuffers({vCurrent:s[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:r}=this.transition;let i=r/e;t&&(i=t(i));const{model:s}=this.transform,o={time:i};s.shaderInputs.setProps({interpolation:o}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const yie=`uniform interpolationUniforms {
  float time;
} interpolation;
`,HC={name:"interpolation",vs:yie,uniformTypes:{time:"f32"}},vie=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,bie=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function FD(n){return n.doublePrecision&&n.value instanceof Float64Array}function Tie(n,e){const t=e.size,r=OD(t),i=kD(t),s=e.getBufferLayout();return FD(e)?new Au(n,{vs:bie,bufferLayout:[{name:"aFrom",byteStride:8*t,attributes:[{attribute:"aFrom",format:i,byteOffset:0},{attribute:"aFrom64Low",format:i,byteOffset:4*t}]},{name:"aTo",byteStride:8*t,attributes:[{attribute:"aTo",format:i,byteOffset:0},{attribute:"aTo64Low",format:i,byteOffset:4*t}]}],modules:[CQ,HC],defines:{ATTRIBUTE_TYPE:r,ATTRIBUTE_SIZE:t},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new Au(n,{vs:vie,bufferLayout:[{name:"aFrom",format:i},{name:"aTo",format:s.attributes[0].format}],modules:[HC],defines:{ATTRIBUTE_TYPE:r},varyings:["vCurrent"],disableWarnings:!0})}class wie extends UD{constructor({device:e,attribute:t,timeline:r}){super({device:e,attribute:t,timeline:r}),this.type="spring",this.texture=Cie(e),this.framebuffer=Iie(e,this.texture),this.transform=Rie(e,t)}start(e,t){const r=this.currentLength,i=this.currentStartIndices;super.start(e,t);const{buffers:s,attribute:o}=this;for(let u=0;u<2;u++)s[u]=LD({device:this.device,buffer:s[u],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter});s[2]=DD({device:this.device,source:s[0],target:s[2]}),this.setBuffer(s[1]);const{model:l}=this.transform;l.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?l.setConstantAttributes({aTo:o.value}):l.setAttributes({aTo:o.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:r,transition:i}=this,s=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});const o={stiffness:s.stiffness,damping:s.damping};t.model.shaderInputs.setProps({spring:o}),t.run({framebuffer:r,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),ND(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(r)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const Eie=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,xie={name:"spring",vs:Eie,uniformTypes:{damping:"f32",stiffness:"f32"}},Aie=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,Sie=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function Rie(n,e){const t=OD(e.size),r=kD(e.size);return new Au(n,{vs:Aie,fs:Sie,bufferLayout:[{name:"aPrev",format:r},{name:"aCur",format:r},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[xie],defines:{ATTRIBUTE_TYPE:t},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function Cie(n){return n.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function Iie(n,e){return n.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const Pie={interpolation:_ie,spring:wie};class Mie{constructor(e,{id:t,timeline:r}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:r}){this.numInstances=r||1;for(const i in e){const s=e[i],o=s.getTransitionSetting(t);o&&this._updateAttribute(i,s,o)}for(const i in this.transitions){const s=e[i];(!s||!s.getTransitionSetting(t))&&this._removeTransition(i)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const r=this.transitions[t];r.inProgress&&(e[t]=r.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,r){const i=this.transitions[e];let s=!i||i.type!==r.type;if(s){i&&this._removeTransition(e);const o=Pie[r.type];o?this.transitions[e]=new o({attribute:t,timeline:this.timeline,device:this.device}):(ot.error(`unsupported transition type '${r.type}'`)(),s=!1)}(s||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const $C="attributeManager.invalidate",Oie="attributeManager.updateStart",kie="attributeManager.updateEnd",Nie="attribute.updateStart",Die="attribute.allocate",Lie="attribute.updateEnd";class Uie{constructor(e,{id:t="attribute-manager",stats:r,timeline:i}={}){this.mergeBoundsMemoized=Md(Kee),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new Mie(e,{id:`${t}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const r=this._invalidateTrigger(e,t);qn($C,this,e,r)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);qn($C,this,"all")}update({data:e,numInstances:t,startIndices:r=null,transitions:i,props:s={},buffers:o={},context:l={}}){let u=!1;qn(Oie,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const h in this.attributes){const d=this.attributes[h],g=d.settings.accessor;d.startIndices=r,d.numInstances=t,s[h]&&ot.removed(`props.${h}`,`data.attributes.${h}`)(),d.setExternalBuffer(o[h])||d.setBinaryValue(typeof g=="string"?o[g]:void 0,e.startIndices)||typeof g=="string"&&!o[g]&&d.setConstantValue(s[g])||d.needsUpdate()&&(u=!0,this._updateAttribute({attribute:d,numInstances:t,data:e,props:s,context:l})),this.needsRedraw=this.needsRedraw||d.needsRedraw()}u&&qn(kie,this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const t=e.map(r=>this.attributes[r]?.getBounds());return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:r}=this,i={...r.getAttributes()};for(const s in t){const o=t[s];o.needsRedraw(e)&&!r.hasAttribute(s)&&(i[s]=o)}return i}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(const r in e){const i=e[r],s={...i,id:r,size:i.isIndexed&&1||i.size||1,...t};this.attributes[r]=new MD(this.device,s)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(i=>{e[i]||(e[i]=[]),e[i].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:r,updateTriggers:i}=this,s=i[e];return s&&s.forEach(o=>{const l=r[o];l&&l.setNeedsUpdate(l.id,t)}),s}_updateAttribute(e){const{attribute:t,numInstances:r}=e;if(qn(Nie,t),t.constant){t.setConstantValue(t.value);return}t.allocate(r)&&qn(Die,t,r),t.updateBuffer(e)&&(this.needsRedraw=!0,qn(Lie,t,r))}}class Fie extends q_{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:r,duration:i,easing:s}}=this,o=s(e/i);this._value=fl(t,r,o)}}const WC=1e-5;function qC(n,e,t,r,i){const s=e-n,l=(t-e)*i,u=-s*r;return l+u+s+e}function Bie(n,e,t,r,i){if(Array.isArray(t)){const s=[];for(let o=0;o<t.length;o++)s[o]=qC(n[o],e[o],t[o],r,i);return s}return qC(n,e,t,r,i)}function XC(n,e){if(Array.isArray(n)){let t=0;for(let r=0;r<n.length;r++){const i=n[r]-e[r];t+=i*i}return Math.sqrt(t)}return Math.abs(n-e)}class Vie extends q_{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:r,stiffness:i}=this.settings,{_prevValue:s=e,_currValue:o=e}=this;let l=Bie(s,o,t,r,i);const u=XC(l,t),h=XC(l,o);u<WC&&h<WC&&(l=t,this.end()),this._prevValue=o,this._currValue=l}}const zie={interpolation:Fie,spring:Vie};class jie{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,r,i){const{transitions:s}=this;if(s.has(e)){const u=s.get(e),{value:h=u.settings.fromValue}=u;t=h,this.remove(e)}if(i=PD(i),!i)return;const o=zie[i.type];if(!o){ot.error(`unsupported transition type '${i.type}'`)();return}const l=new o(this.timeline);l.start({...i,fromValue:t,toValue:r}),s.set(e,l)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,r]of this.transitions)r.update(),e[t]=r.value,r.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function Hie(n){const e=n[oa];for(const t in e){const r=e[t],{validate:i}=r;if(i&&!i(n[t],r))throw new Error(`Invalid prop ${t}: ${n[t]}`)}}function $ie(n,e){const t=BD({newProps:n,oldProps:e,propTypes:n[oa],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=qie(n,e);let i=!1;return r||(i=Xie(n,e)),{dataChanged:r,propsChanged:t,updateTriggersChanged:i,extensionsChanged:Yie(n,e),transitionsChanged:Wie(n,e)}}function Wie(n,e){if(!n.transitions)return!1;const t={},r=n[oa];let i=!1;for(const s in n.transitions){const o=r[s],l=o&&o.type;(l==="number"||l==="color"||l==="array")&&IT(n[s],e[s],o)&&(t[s]=!0,i=!0)}return i?t:!1}function BD({newProps:n,oldProps:e,ignoreProps:t={},propTypes:r={},triggerName:i="props"}){if(e===n)return!1;if(typeof n!="object"||n===null)return`${i} changed shallowly`;if(typeof e!="object"||e===null)return`${i} changed shallowly`;for(const s of Object.keys(n))if(!(s in t)){if(!(s in e))return`${i}.${s} added`;const o=IT(n[s],e[s],r[s]);if(o)return`${i}.${s} ${o}`}for(const s of Object.keys(e))if(!(s in t)){if(!(s in n))return`${i}.${s} dropped`;if(!Object.hasOwnProperty.call(n,s)){const o=IT(n[s],e[s],r[s]);if(o)return`${i}.${s} ${o}`}}return!1}function IT(n,e,t){let r=t&&t.equal;return r&&!r(n,e,t)||!r&&(r=n&&e&&n.equals,r&&!r.call(n,e))?"changed deeply":!r&&e!==n?"changed shallowly":null}function qie(n,e){if(e===null)return"oldProps is null, initial diff";let t=!1;const{dataComparator:r,_dataDiff:i}=n;return r?r(n.data,e.data)||(t="Data comparator detected a change"):n.data!==e.data&&(t="A new data container was supplied"),t&&i&&(t=i(n.data,e.data)||t),t}function Xie(n,e){if(e===null)return{all:!0};if("all"in n.updateTriggers&&YC(n,e,"all"))return{all:!0};const t={};let r=!1;for(const i in n.updateTriggers)i!=="all"&&YC(n,e,i)&&(t[i]=!0,r=!0);return r?t:!1}function Yie(n,e){if(e===null)return!0;const t=e.extensions,{extensions:r}=n;if(r===t)return!1;if(!t||!r||r.length!==t.length)return!0;for(let i=0;i<r.length;i++)if(!r[i].equals(t[i]))return!0;return!1}function YC(n,e,t){let r=n.updateTriggers[t];r=r??{};let i=e.updateTriggers[t];return i=i??{},BD({oldProps:i,newProps:r,triggerName:t})}const Kie="count(): argument not an object",Gie="count(): argument not a container";function Zie(n){if(!Jie(n))throw new Error(Kie);if(typeof n.count=="function")return n.count();if(Number.isFinite(n.size))return n.size;if(Number.isFinite(n.length))return n.length;if(Qie(n))return Object.keys(n).length;throw new Error(Gie)}function Qie(n){return n!==null&&typeof n=="object"&&n.constructor===Object}function Jie(n){return n!==null&&typeof n=="object"}function KC(n,e){if(!e)return n;const t={...n,...e};if("defines"in e&&(t.defines={...n.defines,...e.defines}),"modules"in e&&(t.modules=(n.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=t.modules.findIndex(i=>i.name==="project32");r>=0&&t.modules.splice(r,1)}if("inject"in e)if(!n.inject)t.inject=e.inject;else{const r={...n.inject};for(const i in e.inject)r[i]=(r[i]||"")+e.inject[i];t.inject=r}return t}const ese={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},PT={};function tse(n,e,t,r){if(t instanceof At)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let i=null;t.compressed&&(i={minFilter:"linear",mipmapFilter:t.data.length>1?"nearest":"linear"});const s=e.createTexture({...t,sampler:{...ese,...i,...r},mipmaps:!0});return PT[s.id]=n,s}function nse(n,e){!e||!(e instanceof At)||PT[e.id]===n&&(e.delete(),delete PT[e.id])}const rse={boolean:{validate(n,e){return!0},equal(n,e,t){return!!n==!!e}},number:{validate(n,e){return Number.isFinite(n)&&(!("max"in e)||n<=e.max)&&(!("min"in e)||n>=e.min)}},color:{validate(n,e){return e.optional&&!n||MT(n)&&(n.length===3||n.length===4)},equal(n,e,t){return ui(n,e,1)}},accessor:{validate(n,e){const t=o_(n);return t==="function"||t===o_(e.value)},equal(n,e,t){return typeof e=="function"?!0:ui(n,e,1)}},array:{validate(n,e){return e.optional&&!n||MT(n)},equal(n,e,t){const{compare:r}=t,i=Number.isInteger(r)?r:r?1:0;return r?ui(n,e,i):n===e}},object:{equal(n,e,t){if(t.ignore)return!0;const{compare:r}=t,i=Number.isInteger(r)?r:r?1:0;return r?ui(n,e,i):n===e}},function:{validate(n,e){return e.optional&&!n||typeof n=="function"},equal(n,e,t){return!t.compare&&t.ignore!==!1||n===e}},data:{transform:(n,e,t)=>{if(!n)return n;const{dataTransform:r}=t.props;return r?r(n):typeof n.shape=="string"&&n.shape.endsWith("-table")&&Array.isArray(n.data)?n.data:n}},image:{transform:(n,e,t)=>{const r=t.context;return!r||!r.device?null:tse(t.id,r.device,n,{...e.parameters,...t.props.textureParameters})},release:(n,e,t)=>{nse(t.id,n)}}};function ise(n){const e={},t={},r={};for(const[i,s]of Object.entries(n)){const o=s?.deprecatedFor;if(o)r[i]=Array.isArray(o)?o:[o];else{const l=sse(i,s);e[i]=l,t[i]=l.value}}return{propTypes:e,defaultProps:t,deprecatedProps:r}}function sse(n,e){switch(o_(e)){case"object":return af(n,e);case"array":return af(n,{type:"array",value:e,compare:!1});case"boolean":return af(n,{type:"boolean",value:e});case"number":return af(n,{type:"number",value:e});case"function":return af(n,{type:"function",value:e,compare:!0});default:return{name:n,type:"unknown",value:e}}}function af(n,e){return"type"in e?{name:n,...rse[e.type],...e}:"value"in e?{name:n,type:o_(e.value),...e}:{name:n,type:"object",value:e}}function MT(n){return Array.isArray(n)||ArrayBuffer.isView(n)}function o_(n){return MT(n)?"array":n===null?"null":typeof n}function ose(n,e){let t;for(let s=e.length-1;s>=0;s--){const o=e[s];"extensions"in o&&(t=o.extensions)}const r=OT(n.constructor,t),i=Object.create(r);i[i_]=n,i[Sl]={},i[Go]={};for(let s=0;s<e.length;++s){const o=e[s];for(const l in o)i[l]=o[l]}return Object.freeze(i),i}const ase="_mergedDefaultProps";function OT(n,e){if(!(n instanceof Y_.constructor))return{};let t=ase;if(e)for(const i of e){const s=i.constructor;s&&(t+=`:${s.extensionName||s.name}`)}const r=VD(n,t);return r||(n[t]=lse(n,e||[]))}function lse(n,e){if(!n.prototype)return null;const r=Object.getPrototypeOf(n),i=OT(r),s=VD(n,"defaultProps")||{},o=ise(s),l=Object.assign(Object.create(null),i,o.defaultProps),u=Object.assign(Object.create(null),i?.[oa],o.propTypes),h=Object.assign(Object.create(null),i?.[i0],o.deprecatedProps);for(const d of e){const g=OT(d.constructor);g&&(Object.assign(l,g),Object.assign(u,g[oa]),Object.assign(h,g[i0]))}return cse(l,n),hse(l,u),use(l,h),l[oa]=u,l[i0]=h,e.length===0&&!GE(n,"_propTypes")&&(n._propTypes=u),l}function cse(n,e){const t=dse(e);Object.defineProperties(n,{id:{writable:!0,value:t}})}function use(n,e){for(const t in e)Object.defineProperty(n,t,{enumerable:!1,set(r){const i=`${this.id}: ${t}`;for(const s of e[t])GE(this,s)||(this[s]=r);ot.deprecated(i,e[t].join("/"))()}})}function hse(n,e){const t={},r={};for(const i in e){const s=e[i],{name:o,value:l}=s;s.async&&(t[o]=l,r[o]=fse(o))}n[ou]=t,n[Sl]={},Object.defineProperties(n,r)}function fse(n){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||CD(e)?this[Sl][n]=e:this[Go][n]=e},get(){if(this[Go]){if(n in this[Go])return this[Go][n]||this[ou][n];if(n in this[Sl]){const e=this[i_]&&this[i_].internalState;if(e&&e.hasAsyncProp(n))return e.getAsyncProp(n)||this[ou][n]}}return this[ou][n]}}}function GE(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function VD(n,e){return GE(n,e)&&n[e]}function dse(n){const e=n.componentName;return e||ot.warn(`${n.name}.componentName not specified`)(),e||n.name}let pse=0;class Y_{constructor(...e){this.props=ose(this,e),this.id=this.props.id,this.count=pse++}clone(e){const{props:t}=this,r={};for(const i in t[ou])i in t[Go]?r[i]=t[Go][i]:i in t[Sl]&&(r[i]=t[Sl][i]);return new this.constructor({...t,...r,...e})}}Y_.componentName="Component";Y_.defaultProps={};const gse=Object.freeze({});class mse{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||gse}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[i_]||this.component;const t=e[Go]||{},r=e[Sl]||e,i=e[ou]||{};for(const s in t){const o=t[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o),t[s]=this.getAsyncProp(s)}for(const s in r){const o=r[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(CD(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const r=this.asyncProps[e];return t===r.resolvedValue||t===r.lastValue?!1:(r.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(t=this._postProcessValue(r,t),r.resolvedValue=t,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,t,r){const i=this.asyncProps[e];i&&r>=i.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=t,i.resolvedLoadCount=r,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const i=r.pendingLoadCount;t.then(s=>{this.component&&(s=this._postProcessValue(r,s),this._setAsyncPropValue(e,s,i),this._onResolve(e,s))}).catch(s=>{this._onError(e,s)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const i=r.pendingLoadCount;let s=[],o=0;for await(const l of t){if(!this.component)return;const{dataTransform:u}=this.component.props;u?s=u(l,s):s=s.concat(l),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:o,endRow:s.length}]}),o=s.length,this._setAsyncPropValue(e,s,i)}this._onResolve(e,s)}_postProcessValue(e,t){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(t,r,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const i=this.component&&this.component.props[oa];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class _se extends mse{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const r=this.layer,i=r?.props.fetch;return i?i(t,{propName:e,layer:r}):super._fetch(e,t)}_onResolve(e,t){const r=this.layer;if(r){const i=r.props.onDataLoad;e==="data"&&i&&i(t,{propName:e,layer:r})}}_onError(e,t){const r=this.layer;r&&r.raiseError(t,`loading ${e} of ${this.layer}`)}}const yse="layer.changeFlag",vse="layer.initialize",bse="layer.update",Tse="layer.finalize",wse="layer.matched",GC=2**24-1,Ese=Object.freeze([]),xse=Md(({oldViewport:n,viewport:e})=>n.equals(e));let si=new Uint8ClampedArray(0);const Ase={data:{type:"data",value:Ese,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:n=>n&&n.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(n,{propName:e,layer:t,loaders:r,loadOptions:i,signal:s})=>{const{resourceManager:o}=t.context;i=i||t.getLoadOptions(),r=r||t.props.loaders,s&&(i={...i,fetch:{...i?.fetch,signal:s}});let l=o.contains(n);return!l&&!i&&(o.add({resourceId:n,data:Wm(n,r),persistent:!1}),l=!0),l?o.subscribe({resourceId:n,onChange:u=>t.internalState?.reloadAsyncProp(e,u),consumerId:t.id,requestId:e}):Wm(n,r,i)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:st.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:n})=>[0,-n*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class es extends Y_{constructor(){super(...arguments),this.internalState=null,this.lifecycle=Vc.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){On(this.internalState);const t=this.internalState.viewport||this.context.viewport,r=iD(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,s,o]=eD(r,t.pixelProjectionMatrix);return e.length===2?[i,s]:[i,s,o]}unproject(e){return On(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){On(this.internalState);const r=this.internalState.viewport||this.context.viewport;return tte(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===st.DEFAULT||e===st.LNGLAT||e===st.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){On(e instanceof Uint8Array);const[t,r,i]=e;return t+r*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:Zie(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(e){e=KC(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=KC(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&t)if(Array.isArray(r))for(const i of r)t.invalidateAll(i);else t.invalidateAll();if(t){const{props:i}=e,s=this.internalState.hasPickingBuffer,o=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(l=>l.getNeedsPickingBuffer.call(this,l));if(s!==o){this.internalState.hasPickingBuffer=o;const{pickingColors:l,instancePickingColors:u}=t.attributes,h=l||u;h&&(o&&h.constant&&(h.constant=!1,t.invalidate(h.id)),!h.value&&!o&&(h.constant=!0,h.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e.renderPass)}getPickingInfo({info:e,mode:t,sourceLayer:r}){const{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,t){t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),this.props.onError?.(e)||this.context?.onError?.(e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!xse({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const r in e)e[r].layoutChanged()&&(t=!0);for(const r of this.getModels())this._setModelAttributes(r,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,r=this.getNumInstances(),i=this.getStartIndices();e.update({data:t.data,numInstances:r,startIndices:i,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),r=Object.create(this.props);for(const i in t)Object.defineProperty(r,i,{value:t[i]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const r=Math.floor(si.length/4);if(this.internalState.usesPickingColorCache=!0,r<t){t>GC&&ot.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),si=xu.allocate(si,t,{size:4,copy:!0,maxCount:Math.max(t,GC)});const i=Math.floor(si.length/4),s=[0,0,0];for(let o=r;o<i;o++)this.encodePickingColor(o,s),si[o*4+0]=s[0],si[o*4+1]=s[1],si[o*4+2]=s[2],si[o*4+3]=0}e.value=si.subarray(0,t*4)}_setModelAttributes(e,t,r=!1){if(!Object.keys(t).length)return;if(r){const l=this.getAttributeManager();e.setBufferLayout(l.getBufferLayouts(e)),t=l.getAttributes()}const i=e.userData?.excludeAttributes||{},s={},o={};for(const l in t){if(i[l])continue;const u=t[l].getValue();for(const h in u){const d=u[h];d instanceof Ft?t[l].settings.isIndexed?e.setIndexBuffer(d):s[h]=d:d&&(o[h]=d)}}e.setAttributes(s),e.setConstantAttributes(o)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:i}=this.getAttributeManager().attributes,s=r||i,o=s&&t.attributes&&t.attributes[s.id];if(o&&o.value){const l=o.value,u=this.encodePickingColor(e);for(let h=0;h<t.length;h++){const d=s.getVertexOffset(h);l[d]===u[0]&&l[d+1]===u[1]&&l[d+2]===u[2]&&this._disablePickingIndex(h)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:r}=this.getAttributeManager().attributes,i=t||r;if(!i)return;const s=i.getVertexOffset(e),o=i.getVertexOffset(e+1);i.buffer.write(new Uint8Array(o-s),s)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,r=e||t;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==si.buffer&&(r.value=si.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){On(!this.internalState),On(Number.isFinite(this.props.coordinateSystem)),qn(vse,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new _se({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(ot.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new jie(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){qn(wse,this,this===e);const{state:t,internalState:r}=e;this!==e&&(this.internalState=r,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(qn(bse,this,e),!e)return;const t=this.props,r=this.context,i=this.internalState,s=r.viewport,o=this._updateUniformTransition();i.propsInTransition=o,r.viewport=i.viewport||s,this.props=o;try{const l=this._getUpdateParams(),u=this.getModels();if(r.device)this.updateState(l);else try{this.updateState(l)}catch{}for(const d of this.props.extensions)d.updateState.call(this,l,d);this.setNeedsRedraw(),this._updateAttributes();const h=this.getModels()[0]!==u[0];this._postUpdate(l,h)}finally{r.viewport=s,this.props=t,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){qn(Tse,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:t=null,uniforms:r={},parameters:i={}}){this._updateAttributeTransition();const s=this.props,o=this.context;this.props=this.internalState.propsInTransition||s;try{t&&this.setShaderModuleProps(t);const{getPolygonOffset:l}=this.props,u=l&&l(r)||[0,0];o.device instanceof Kc&&o.device.setParametersWebGL({polygonOffset:u});for(const h of this.getModels())h.device.type==="webgpu"?h.setParameters({...h.parameters,...i}):h.setParameters(i);if(o.device instanceof Kc)o.device.withParametersWebGL(i,()=>{const h={renderPass:e,shaderModuleProps:t,uniforms:r,parameters:i,context:o};for(const d of this.props.extensions)d.draw.call(this,h,d);this.draw(h)});else{const h={renderPass:e,shaderModuleProps:t,uniforms:r,parameters:i,context:o};for(const d of this.props.extensions)d.draw.call(this,h,d);this.draw(h)}}finally{this.props=s}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const i in e)if(e[i]){let s=!1;switch(i){case"dataChanged":const o=e[i],l=t[i];o&&Array.isArray(l)&&(t.dataChanged=Array.isArray(o)?l.concat(o):o,s=!0);default:t[i]||(t[i]=e[i],s=!0)}s&&qn(yse,this,i,e)}const r=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=r,t.somethingChanged=r||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){const r=$ie(e,t);if(r.updateTriggersChanged)for(const i in r.updateTriggersChanged)r.updateTriggersChanged[i]&&this.invalidateAttribute(i);if(r.transitionsChanged)for(const i in r.transitionsChanged)this.internalState.uniformTransitions.add(i,t[i],e[i],e.transitions?.[i]);return this.setChangeFlags(r)}validateProps(){Hie(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(t.highlightColor=r(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new Uie(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:r,oldProps:i}=e,s=this.state.model;s?.isInstanced&&s.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:l,highlightColor:u}=r;if(t||i.autoHighlight!==o||i.highlightedObjectIndex!==l||i.highlightColor!==u){const h={};Array.isArray(u)&&(h.highlightColor=u),(t||i.autoHighlight!==o||l!==i.highlightedObjectIndex)&&(h.highlightedObjectColor=Number.isFinite(l)&&l>=0?this.encodePickingColor(l):null),this.setShaderModuleProps({picking:h})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),i=r?r.getNeedsRedraw(e):!1;if(t=t||i,t)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}es.defaultProps=Ase;es.layerName="Layer";const Sse="compositeLayer.renderLayers";class K_ extends es{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id&&(e.object=t.__source.object,e.index=t.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:r}=this.props;return r&&r[e]&&r[e].type||t}getSubLayerRow(e,t,r){return e.__source={parent:this,object:t,index:r},e}getSubLayerAccessor(e){if(typeof e=="function"){const t={index:-1,data:this.props.data,target:[]};return(r,i)=>r&&r.__source?(t.index=r.__source.index,e(r.__source.object,t)):e(r,i)}return e}getSubLayerProps(e={}){const{opacity:t,pickable:r,visible:i,parameters:s,getPolygonOffset:o,highlightedObjectIndex:l,autoHighlight:u,highlightColor:h,coordinateSystem:d,coordinateOrigin:g,wrapLongitude:y,positionFormat:b,modelMatrix:w,extensions:E,fetch:x,operation:C,_subLayerProps:M}=this.props,O={id:"",updateTriggers:{},opacity:t,pickable:r,visible:i,parameters:s,getPolygonOffset:o,highlightedObjectIndex:l,autoHighlight:u,highlightColor:h,coordinateSystem:d,coordinateOrigin:g,wrapLongitude:y,positionFormat:b,modelMatrix:w,extensions:E,fetch:x,operation:C},V=M&&e.id&&M[e.id],H=V&&V.updateTriggers,G=e.id||"sublayer";if(V){const D=this.props[oa],I=e.type?e.type._propTypes:{};for(const N in V){const j=I[N]||D[N];j&&j.type==="accessor"&&(V[N]=this.getSubLayerAccessor(V[N]))}}Object.assign(O,e,V),O.id=`${this.props.id}-${G}`,O.updateTriggers={all:this.props.updateTriggers?.all,...e.updateTriggers,...H};for(const D of E){const I=D.getSubLayerProps.call(this,D);I&&Object.assign(O,I,{updateTriggers:Object.assign(O.updateTriggers,I.updateTriggers)})}return O}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let r=this.internalState.subLayers;const i=!r||this.needsUpdate();if(i){const s=this.renderLayers();r=W_(s,Boolean),this.internalState.subLayers=r}qn(Sse,this,i,r);for(const s of r)s.parent=this}}K_.layerName="CompositeLayer";const Cg=Math.PI/180,ZC=180/Math.PI,cm=6370972,Gc=256;function Rse(){const n=Gc/cm,e=Math.PI/180*Gc;return{unitsPerMeter:[n,n,n],unitsPerMeter2:[0,0,0],metersPerUnit:[1/n,1/n,1/n],unitsPerDegree:[e,e,n],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/n]}}class Cse extends Xu{constructor(e={}){const{longitude:t=0,zoom:r=0,nearZMultiplier:i=.5,farZMultiplier:s=1,resolution:o=10}=e;let{latitude:l=0,height:u,altitude:h=1.5,fovy:d}=e;l=Math.max(Math.min(l,$c),-$c),u=u||1,d?h=FE(d):d=id(h);const g=1/Math.PI/Math.cos(l*Math.PI/180),y=Math.pow(2,r)*g,b=e.nearZ??i,w=e.farZ??(h+Gc*2*y/u)*s,E=new rr().lookAt({eye:[0,-h,0],up:[0,0,1]});E.rotateX(l*Cg),E.rotateZ(-t*Cg),E.scale(y/u),super({...e,height:u,viewMatrix:E,longitude:t,latitude:l,zoom:r,distanceScales:Rse(),fovy:d,focalDistance:h,near:b,far:w}),this.scale=y,this.latitude=l,this.longitude=t,this.resolution=o}get projectionMode(){return Sr.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const t={targetZ:e.z||0},r=this.unproject([0,this.height/2],t),i=this.unproject([this.width/2,0],t),s=this.unproject([this.width,this.height/2],t),o=this.unproject([this.width/2,this.height],t);return s[0]<this.longitude&&(s[0]+=360),r[0]>this.longitude&&(r[0]-=360),[Math.min(r[0],s[0],i[0],o[0]),Math.min(r[1],s[1],i[1],o[1]),Math.max(r[0],s[0],i[0],o[0]),Math.max(r[1],s[1],i[1],o[1])]}unproject(e,{topLeft:t=!0,targetZ:r}={}){const[i,s,o]=e,l=t?s:this.height-s,{pixelUnprojectionMatrix:u}=this;let h;if(Number.isFinite(o))h=u0(u,[i,l,o,1]);else{const b=u0(u,[i,l,-1,1]),w=u0(u,[i,l,1,1]),E=((r||0)/cm+1)*Gc,x=Wb(P4([],b,w)),C=Wb(b),M=Wb(w),V=4*((4*C*M-(x-C-M)**2)/16)/x,H=Math.sqrt(C-V),G=Math.sqrt(Math.max(0,E*E-V)),D=(H-G)/Math.sqrt(x);h=_Z([],b,w,D)}const[d,g,y]=this.unprojectPosition(h);return Number.isFinite(o)?[d,g,y]:Number.isFinite(r)?[d,g,r]:[d,g]}projectPosition(e){const[t,r,i=0]=e,s=t*Cg,o=r*Cg,l=Math.cos(o),u=(i/cm+1)*Gc;return[Math.sin(s)*l*u,-Math.cos(s)*l*u,Math.sin(o)*u]}unprojectPosition(e){const[t,r,i]=e,s=M4(e),o=Math.asin(i/s),u=Math.atan2(t,-r)*ZC,h=o*ZC,d=(s/Gc-1)*cm;return[u,h,d]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,t){const r=this.unproject(t);return{longitude:e[0]-r[0]+this.longitude,latitude:e[1]-r[1]+this.latitude}}}function u0(n,e){const t=$u([],e,n);return DE(t,t,1/t[3]),t}class zD{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:t={}}=e;this.typedArrayManager=xu,this.attributes={},this._attributeDefs=t,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:t,buffers:r={},getGeometry:i,geometryBuffer:s,positionFormat:o,dataChanged:l,normalize:u=!0}=this.opts;if(this.data=t,this.getGeometry=i,this.positionSize=s&&s.size||(o==="XY"?2:3),this.buffers=r,this.normalize=u,s&&(On(t.startIndices),this.getGeometry=this.getGeometryFromBuffer(s),u||(r.vertexPositions=s)),this.geometryBuffer=r.vertexPositions,Array.isArray(l))for(const h of l)this._rebuildGeometry(h);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:t}){this._rebuildGeometry({startRow:e,endRow:t})}getGeometryFromBuffer(e){const t=e.value||e;return ArrayBuffer.isView(t)?ID(t,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,t){const{attributes:r,buffers:i,_attributeDefs:s,typedArrayManager:o}=this;for(const l in s)if(l in i)o.release(r[l]),r[l]=null;else{const u=s[l];u.copy=t,r[l]=o.allocate(r[l],e,u)}}_forEachGeometry(e,t,r){const{data:i,getGeometry:s}=this,{iterable:o,objectInfo:l}=X_(i,t,r);for(const u of o){l.index++;const h=s?s(u,l):null;e(h,l.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:t,vertexStarts:r,instanceCount:i}=this;const{data:s,geometryBuffer:o}=this,{startRow:l=0,endRow:u=1/0}=e||{},h={};if(e||(t=[0],r=[0]),this.normalize||!o)this._forEachGeometry((g,y)=>{const b=g&&this.normalizeGeometry(g);h[y]=b,r[y+1]=r[y]+(b?this.getGeometrySize(b):0)},l,u),i=r[r.length-1];else if(r=s.startIndices,i=r[s.length]||0,ArrayBuffer.isView(o))i=i||o.length/this.positionSize;else if(o instanceof Ft){const g=this.positionSize*4;i=i||o.byteLength/g}else if(o.buffer){const g=o.stride||this.positionSize*4;i=i||o.buffer.byteLength/g}else if(o.value){const g=o.value,y=o.stride/g.BYTES_PER_ELEMENT||this.positionSize;i=i||g.length/y}this._allocate(i,!!e),this.indexStarts=t,this.vertexStarts=r,this.instanceCount=i;const d={};this._forEachGeometry((g,y)=>{const b=h[y]||g;d.vertexStart=r[y],d.indexStart=t[y];const w=y<r.length-1?r[y+1]:i;d.geometrySize=w-r[y],d.geometryIndex=y,this.updateGeometryAttributes(b,d)},l,u),this.vertexCount=t[t.length-1]}}const Ise=typeof window<"u"?R.useLayoutEffect:R.useEffect;function a_(n,e){for(;n;){if(n===e)return!0;n=Object.getPrototypeOf(n)}return!1}const Pse={position:"absolute",zIndex:-1};function jD(n,e){if(typeof n=="function")return n(e);if(Array.isArray(n))return n.map(t=>jD(t,e));if(G_(n)){if(Mse(n))return e.style=Pse,R.cloneElement(n,e);if(Ose(n))return R.cloneElement(n,e)}return n}function G_(n){return n&&typeof n=="object"&&"type"in n||!1}function Mse(n){return n.props?.mapStyle}function Ose(n){const e=n.type;return e&&e.deckGLViewProps}function kT(n){if(typeof n=="function")return R.createElement(Ru,{},n);if(Array.isArray(n))return n.map(kT);if(G_(n)){if(n.type===R.Fragment)return kT(n.props.children);if(a_(n.type,Ru))return n}return n}function kse({children:n,layers:e=[],views:t=null}){const r=[],i=[],s={};return R.Children.forEach(kT(n),o=>{if(G_(o)){const l=o.type;if(a_(l,es)){const u=Nse(l,o.props);i.push(u)}else r.push(o);if(a_(l,Ru)&&l!==Ru&&o.props.id){const u=new l(o.props);s[u.id]=u}}else o&&r.push(o)}),Object.keys(s).length>0&&(Array.isArray(t)?t.forEach(o=>{s[o.id]=o}):t&&(s[t.id]=t),t=Object.values(s)),e=i.length>0?[...i,...e]:e,{layers:e,children:r,views:t}}function Nse(n,e){const t={},r=n.defaultProps||{};for(const i in e)r[i]!==e[i]&&(t[i]=e[i]);return new n(t)}const Dse=R.createContext();function Lse({children:n,deck:e,ContextProvider:t=Dse.Provider}){const{viewManager:r}=e||{};if(!r||!r.views.length)return[];const i={},s=r.views[0].id;for(const o of n){let l=s,u=o;G_(o)&&a_(o.type,Ru)&&(l=o.props.id||s,u=o.props.children);const h=r.getViewport(l),d=r.getViewState(l);if(h){d.padding=h.padding;const{x:g,y,width:b,height:w}=h;u=jD(u,{x:g,y,width:b,height:w,viewport:h,viewState:d}),i[l]||(i[l]={viewport:h,children:[]}),i[l].children.push(u)}}return Object.keys(i).map(o=>{const{viewport:l,children:u}=i[o],{x:h,y:d,width:g,height:y}=l,b={position:"absolute",left:h,top:d,width:g,height:y},w=`view-${o}`,E=R.createElement("div",{key:w,id:w,style:b},...u),x={deck:e,viewport:l,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:M=>{M.viewId=o,e._onViewStateChange(M)},widgets:[]},C=`view-${o}-context`;return R.createElement(t,{key:C,value:x},E)})}const Use={mixBlendMode:null};function Fse({width:n,height:e,style:t}){const r={position:"absolute",zIndex:0,left:0,top:0,width:n,height:e},i={left:0,top:0};if(t)for(const s in t)s in Use?i[s]=t[s]:r[s]=t[s];return{containerStyle:r,canvasStyle:i}}function Bse(n){return{get deck(){return n.deck},pickObject:e=>n.deck.pickObject(e),pickMultipleObjects:e=>n.deck.pickMultipleObjects(e),pickObjects:e=>n.deck.pickObjects(e)}}function HD(n){n.redrawReason&&(n.deck._drawLayers(n.redrawReason),n.redrawReason=null)}function Vse(n,e,t){const r=new e({...t,_customRender:t.deviceProps?.adapters?.[0]?.type==="webgpu"?void 0:i=>{n.redrawReason=i;const s=r.getViewports();n.lastRenderedViewports!==s?n.forceUpdate():HD(n)}});return r}function zse(n,e){const[t,r]=R.useState(0),s=R.useRef({control:null,version:t,forceUpdate:()=>r(H=>H+1)}).current,o=R.useRef(null),l=R.useRef(null),u=R.useMemo(()=>kse(n),[n.layers,n.views,n.children]);let h=!0;const d=H=>h&&n.viewState?(s.viewStateUpdateRequested=H,null):(s.viewStateUpdateRequested=null,n.onViewStateChange?.(H)),g=H=>{h?s.interactionStateUpdateRequested=H:(s.interactionStateUpdateRequested=null,n.onInteractionStateChange?.(H))},y=R.useMemo(()=>{const H={widgets:[],...n,style:null,width:"100%",height:"100%",parent:o.current,canvas:l.current,layers:u.layers,views:u.views,onViewStateChange:d,onInteractionStateChange:g};return delete H._customRender,s.deck&&s.deck.setProps(H),H},[n]);R.useEffect(()=>{const H=n.Deck||KE;return s.deck=Vse(s,H,{...y,parent:o.current,canvas:l.current}),()=>s.deck?.finalize()},[]),Ise(()=>{HD(s);const{viewStateUpdateRequested:H,interactionStateUpdateRequested:G}=s;H&&d(H),G&&g(G)}),R.useImperativeHandle(e,()=>Bse(s),[]);const b=s.deck&&s.deck.isInitialized?s.deck.getViewports():void 0,{ContextProvider:w,width:E="100%",height:x="100%",id:C,style:M}=n,{containerStyle:O,canvasStyle:V}=R.useMemo(()=>Fse({width:E,height:x,style:M}),[E,x,M]);if(!s.viewStateUpdateRequested&&s.lastRenderedViewports===b||s.version!==t){s.lastRenderedViewports=b,s.version=t;const H=Lse({children:u.children,deck:s.deck,ContextProvider:w}),G=R.createElement("canvas",{key:"canvas",id:C||"deckgl-overlay",ref:l,style:V});s.control=R.createElement("div",{id:`${C||"deckgl"}-wrapper`,ref:o,style:O},[G,H])}return h=!1,s.control}const jse=R.forwardRef(zse),Hse=new Uint32Array([0,2,1,0,3,2]),$se=new Float32Array([0,1,0,0,1,0,1,1]);function Wse(n,e){if(!e)return qse(n);const t=Math.max(Math.abs(n[0][0]-n[3][0]),Math.abs(n[1][0]-n[2][0])),r=Math.max(Math.abs(n[1][1]-n[0][1]),Math.abs(n[2][1]-n[3][1])),i=Math.ceil(t/e)+1,s=Math.ceil(r/e)+1,o=(i-1)*(s-1)*6,l=new Uint32Array(o),u=new Float32Array(i*s*2),h=new Float64Array(i*s*3);let d=0,g=0;for(let y=0;y<i;y++){const b=y/(i-1);for(let w=0;w<s;w++){const E=w/(s-1),x=Xse(n,b,E);h[d*3+0]=x[0],h[d*3+1]=x[1],h[d*3+2]=x[2]||0,u[d*2+0]=b,u[d*2+1]=1-E,y>0&&w>0&&(l[g++]=d-s,l[g++]=d-s-1,l[g++]=d-1,l[g++]=d-s,l[g++]=d-1,l[g++]=d),d++}}return{vertexCount:o,positions:h,indices:l,texCoords:u}}function qse(n){const e=new Float64Array(12);for(let t=0;t<n.length;t++)e[t*3+0]=n[t][0],e[t*3+1]=n[t][1],e[t*3+2]=n[t][2]||0;return{vertexCount:6,positions:e,indices:Hse,texCoords:$se}}function Xse(n,e,t){return fl(fl(n[0],n[1],t),fl(n[3],n[2],t),e)}const QC=`uniform bitmapUniforms {
  vec4 bounds;
  float coordinateConversion;
  float desaturate;
  vec3 tintColor;
  vec4 transparentColor;
} bitmap;
`,Yse={name:"bitmap",vs:QC,fs:QC,uniformTypes:{bounds:"vec4<f32>",coordinateConversion:"f32",desaturate:"f32",tintColor:"vec3<f32>",transparentColor:"vec4<f32>"}},Kse=`#version 300 es
#define SHADER_NAME bitmap-layer-vertex-shader

in vec2 texCoords;
in vec3 positions;
in vec3 positions64Low;

out vec2 vTexCoord;
out vec2 vTexPos;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (bitmap.coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project.commonOrigin.xy;
  } else if (bitmap.coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`,Gse=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`,Zse=`#version 300 es
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

in vec2 vTexCoord;
in vec2 vTexPos;

out vec4 fragColor;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), bitmap.desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * bitmap.tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  if (bitmap.transparentColor.a == 0.0) {
    return vec4(color, alpha);
  }
  float blendedAlpha = alpha + bitmap.transparentColor.a * (1.0 - alpha);
  float highLightRatio = alpha / blendedAlpha;
  vec3 blendedRGB = mix(bitmap.transparentColor.rgb, color, highLightRatio);
  return vec4(blendedRGB, blendedAlpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bitmap.bounds[0]) / (bitmap.bounds[2] - bitmap.bounds[0]),
    (pos.y - bitmap.bounds[3]) / (bitmap.bounds[1] - bitmap.bounds[3])
  );
}

${Gse}

void main(void) {
  vec2 uv = vTexCoord;
  if (bitmap.coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (bitmap.coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture(bitmapTexture, uv);

  fragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * layer.opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(fragColor, geometry);

  if (bool(picking.isActive) && !bool(picking.isAttribute)) {
    // Since instance information is not used, we can use picking color for pixel index
    fragColor.rgb = packUVsIntoRGB(uv);
  }
}
`,Qse={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:st.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0,value:null}};class ZE extends es{getShaders(){return super.getShaders({vs:Kse,fs:Zse,modules:[Wu,qu,Yse]})}initializeState(){const e=this.getAttributeManager();e.remove(["instancePickingColors"]);const t=!0;e.add({indices:{size:1,isIndexed:!0,update:r=>r.value=this.state.mesh.indices,noAlloc:t},positions:{size:3,type:"float64",fp64:this.use64bitPositions(),update:r=>r.value=this.state.mesh.positions,noAlloc:t},texCoords:{size:2,update:r=>r.value=this.state.mesh.texCoords,noAlloc:t}})}updateState({props:e,oldProps:t,changeFlags:r}){const i=this.getAttributeManager();if(r.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),i.invalidateAll()),e.bounds!==t.bounds){const s=this.state.mesh,o=this._createMesh();this.state.model.setVertexCount(o.vertexCount);for(const l in o)s&&s[l]!==o[l]&&i.invalidate(l);this.setState({mesh:o,...this._getCoordinateUniforms()})}else e._imageCoordinateSystem!==t._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(e){const{image:t}=this.props,r=e.info;if(!r.color||!t)return r.bitmap=null,r;const{width:i,height:s}=t;r.index=0;const o=Jse(r.color);return r.bitmap={size:{width:i,height:s},uv:o,pixel:[Math.floor(o[0]*i),Math.floor(o[1]*s)]},r}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(e){super._updateAutoHighlight({...e,color:this.encodePickingColor(0)})}_createMesh(){const{bounds:e}=this.props;let t=e;return JC(e)&&(t=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),Wse(t,this.context.viewport.resolution)}_getModel(){return new qr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-list",isInstanced:!1})}draw(e){const{shaderModuleProps:t}=e,{model:r,coordinateConversion:i,bounds:s,disablePicking:o}=this.state,{image:l,desaturate:u,transparentColor:h,tintColor:d}=this.props;if(!(t.picking.isActive&&o)&&l&&r){const g={bitmapTexture:l,bounds:s,coordinateConversion:i,desaturate:u,tintColor:d.slice(0,3).map(y=>y/255),transparentColor:h.map(y=>y/255)};r.shaderInputs.setProps({bitmap:g}),r.draw(this.context.renderPass)}}_getCoordinateUniforms(){const{LNGLAT:e,CARTESIAN:t,DEFAULT:r}=st;let{_imageCoordinateSystem:i}=this.props;if(i!==r){const{bounds:s}=this.props;if(!JC(s))throw new Error("_imageCoordinateSystem only supports rectangular bounds");const o=this.context.viewport.resolution?e:t;if(i=i===e?e:t,i===e&&o===t)return{coordinateConversion:-1,bounds:s};if(i===t&&o===e){const l=ma([s[0],s[1]]),u=ma([s[2],s[3]]);return{coordinateConversion:1,bounds:[l[0],l[1],u[0],u[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}ZE.layerName="BitmapLayer";ZE.defaultProps=Qse;function Jse(n){const[e,t,r]=n,i=(r&240)/256,s=(r&15)/16;return[(e+s)/256,(t+i)/256]}function JC(n){return Number.isFinite(n[0])}const eI=`uniform iconUniforms {
  float sizeScale;
  vec2 iconsTextureDim;
  float sizeMinPixels;
  float sizeMaxPixels;
  bool billboard;
  highp int sizeUnits;
  float alphaCutoff;
} icon;
`,eoe={name:"icon",vs:eI,fs:eI,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}},toe=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
icon.sizeMinPixels, icon.sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (icon.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / icon.iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,noe=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * layer.opacity * vColor.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,roe=1024,ioe=4,tI=()=>{},nI={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},soe={x:0,y:0,width:0,height:0};function ooe(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function aoe(n,e,t,r){const i=Math.min(t/e.width,r/e.height),s=Math.floor(e.width*i),o=Math.floor(e.height*i);return i===1?{image:e,width:s,height:o}:(n.canvas.height=o,n.canvas.width=s,n.clearRect(0,0,s,o),n.drawImage(e,0,0,e.width,e.height,0,0,s,o),{image:n.canvas,width:s,height:o})}function sd(n){return n&&(n.id||n.url)}function loe(n,e,t,r){const{width:i,height:s,device:o}=n,l=o.createTexture({format:"rgba8unorm",width:e,height:t,sampler:r,mipmaps:!0}),u=o.createCommandEncoder();return u.copyTextureToTexture({sourceTexture:n,destinationTexture:l,width:i,height:s}),u.finish(),n.destroy(),l}function rI(n,e,t){for(let r=0;r<e.length;r++){const{icon:i,xOffset:s}=e[r],o=sd(i);n[o]={...i,x:s,y:t}}}function coe({icons:n,buffer:e,mapping:t={},xOffset:r=0,yOffset:i=0,rowHeight:s=0,canvasWidth:o}){let l=[];for(let u=0;u<n.length;u++){const h=n[u],d=sd(h);if(!t[d]){const{height:g,width:y}=h;r+y+e>o&&(rI(t,l,i),r=0,i=s+i+e,s=0,l=[]),l.push({icon:h,xOffset:r}),r=r+y+e,s=Math.max(s,g)}}return l.length>0&&rI(t,l,i),{mapping:t,rowHeight:s,xOffset:r,yOffset:i,canvasWidth:o,canvasHeight:ooe(s+i+e)}}function uoe(n,e,t){if(!n||!e)return null;t=t||{};const r={},{iterable:i,objectInfo:s}=X_(n);for(const o of i){s.index++;const l=e(o,s),u=sd(l);if(!l)throw new Error("Icon is missing.");if(!l.url)throw new Error("Icon url is missing.");!r[u]&&(!t[u]||l.url!==t[u].url)&&(r[u]={...l,source:o,sourceIndex:s.index})}return r}class hoe{constructor(e,{onUpdate:t=tI,onError:r=tI}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=ioe,this._canvasWidth=roe,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=t,this.onError=r}finalize(){this._texture?.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const t=this._autoPacking?sd(e):e;return this._mapping[t]||soe}setProps({loadOptions:e,autoPacking:t,iconAtlas:r,iconMapping:i,textureParameters:s}){e&&(this._loadOptions=e),t!==void 0&&(this._autoPacking=t),i&&(this._mapping=i),r&&(this._texture?.delete(),this._texture=null,this._externalTexture=r),s&&(this._samplerParameters=s)}get isLoaded(){return this._pendingCount===0}packIcons(e,t){if(!this._autoPacking||typeof document>"u")return;const r=Object.values(uoe(e,t,this._mapping)||{});if(r.length>0){const{mapping:i,xOffset:s,yOffset:o,rowHeight:l,canvasHeight:u}=coe({icons:r,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=l,this._mapping=i,this._xOffset=s,this._yOffset=o,this._canvasHeight=u,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||nI,mipmaps:!0})),this._texture.height!==this._canvasHeight&&(this._texture=loe(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||nI)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(r)}}_loadIcons(e){const t=this._canvas.getContext("2d",{willReadFrequently:!0});for(const r of e)this._pendingCount++,Wm(r.url,this._loadOptions).then(i=>{const s=sd(r),o=this._mapping[s],{x:l,y:u,width:h,height:d}=o,{image:g,width:y,height:b}=aoe(t,i,h,d);this._texture?.copyExternalImage({image:g,x:l+(h-y)/2,y:u+(d-b)/2,width:y,height:b}),o.width=y,o.height=b,this._texture.generateMipmap(),this.onUpdate()}).catch(i=>{this.onError({url:r.url,source:r.source,sourceIndex:r.sourceIndex,loadOptions:this._loadOptions,error:i})}).finally(()=>{this._pendingCount--})}}const $D=[0,0,0,255],foe={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:n=>n.position},getIcon:{type:"accessor",value:n=>n.icon},getColor:{type:"accessor",value:$D},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class An extends es{getShaders(){return super.getShaders({vs:toe,fs:noe,modules:[Wu,qu,eoe]})}initializeState(){this.state={iconManager:new hoe(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:$D},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:t,oldProps:r,changeFlags:i}=e,s=this.getAttributeManager(),{iconAtlas:o,iconMapping:l,data:u,getIcon:h,textureParameters:d}=t,{iconManager:g}=this.state;if(typeof o=="string")return;const y=o||this.internalState.isAsyncPropLoading("iconAtlas");g.setProps({loadOptions:t.loadOptions,autoPacking:!y,iconAtlas:o,iconMapping:y?l:null,textureParameters:d}),y?r.iconMapping!==t.iconMapping&&s.invalidate("getIcon"):(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getIcon))&&g.packIcons(u,h),i.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),s.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:t,sizeMinPixels:r,sizeMaxPixels:i,sizeUnits:s,billboard:o,alphaCutoff:l}=this.props,{iconManager:u}=this.state,h=u.getTexture();if(h){const d=this.state.model,g={iconsTexture:h,iconsTextureDim:[h.width,h.height],sizeUnits:Hs[s],sizeScale:t,sizeMinPixels:r,sizeMaxPixels:i,billboard:o,alphaCutoff:l};d.shaderInputs.setProps({icon:g}),d.draw(this.context.renderPass)}}_getModel(){const e=[-1,-1,1,-1,-1,1,1,1];return new qr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Su({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){const t=this.getCurrentLayer()?.props.onIconError;t?t(e):ot.error(e.error.message)()}getInstanceOffset(e){const{width:t,height:r,anchorX:i=t/2,anchorY:s=r/2}=this.state.iconManager.getIconMapping(e);return[t/2-i,r/2-s]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:t,y:r,width:i,height:s}=this.state.iconManager.getIconMapping(e);return[t,r,i,s]}}An.defaultProps=foe;An.layerName="IconLayer";const iI=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,doe={name:"scatterplot",vs:iI,fs:iI,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},poe=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,goe=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,moe=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)

struct LayerUniforms {
  opacity: f32,
};

var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    // discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        // discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    // discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,sI=[0,0,0,255],_oe={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:n=>n.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:sI},getLineColor:{type:"accessor",value:sI},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class QE extends es{getShaders(){return super.getShaders({vs:poe,fs:goe,source:moe,modules:[Wu,qu,doe]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:t,radiusScale:r,radiusMinPixels:i,radiusMaxPixels:s,stroked:o,filled:l,billboard:u,antialiasing:h,lineWidthUnits:d,lineWidthScale:g,lineWidthMinPixels:y,lineWidthMaxPixels:b}=this.props,w={stroked:o,filled:l,billboard:u,antialiasing:h,radiusUnits:Hs[t],radiusScale:r,radiusMinPixels:i,radiusMaxPixels:s,lineWidthUnits:Hs[d],lineWidthScale:g,lineWidthMinPixels:y,lineWidthMaxPixels:b},E=this.state.model;E.shaderInputs.setProps({scatterplot:w}),E.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new qr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Su({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}QE.defaultProps=_oe;QE.layerName="ScatterplotLayer";const WD={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function qD(n,e,t={}){return yoe(n,t)!==e?(boe(n,t),!0):!1}function yoe(n,e={}){return Math.sign(voe(n,e))}const oI={x:0,y:1,z:2};function voe(n,e={}){const{start:t=0,end:r=n.length,plane:i="xy"}=e,s=e.size||2;let o=0;const l=oI[i[0]],u=oI[i[1]];for(let h=t,d=r-s;h<r;h+=s)o+=(n[h+l]-n[d+l])*(n[h+u]+n[d+u]),d=h;return o/2}function boe(n,e){const{start:t=0,end:r=n.length,size:i=2}=e,s=(r-t)/i,o=Math.floor(s/2);for(let l=0;l<o;++l){const u=t+l*i,h=t+(s-1-l)*i;for(let d=0;d<i;++d){const g=n[u+d];n[u+d]=n[h+d],n[h+d]=g}}}function hi(n,e){const t=e.length,r=n.length;if(r>0){let i=!0;for(let s=0;s<t;s++)if(n[r-t+s]!==e[s]){i=!1;break}if(i)return!1}for(let i=0;i<t;i++)n[r+i]=e[i];return!0}function NT(n,e){const t=e.length;for(let r=0;r<t;r++)n[r]=e[r]}function od(n,e,t,r,i=[]){const s=r+e*t;for(let o=0;o<t;o++)i[o]=n[s+o];return i}function DT(n,e,t,r,i=[]){let s,o;if(t&8)s=(r[3]-n[1])/(e[1]-n[1]),o=3;else if(t&4)s=(r[1]-n[1])/(e[1]-n[1]),o=1;else if(t&2)s=(r[2]-n[0])/(e[0]-n[0]),o=2;else if(t&1)s=(r[0]-n[0])/(e[0]-n[0]),o=0;else return null;for(let l=0;l<n.length;l++)i[l]=(o&1)===l?r[o]:s*(e[l]-n[l])+n[l];return i}function um(n,e){let t=0;return n[0]<e[0]?t|=1:n[0]>e[2]&&(t|=2),n[1]<e[1]?t|=4:n[1]>e[3]&&(t|=8),t}function XD(n,e){const{size:t=2,broken:r=!1,gridResolution:i=10,gridOffset:s=[0,0],startIndex:o=0,endIndex:l=n.length}=e||{},u=(l-o)/t;let h=[];const d=[h],g=od(n,0,t,o);let y,b;const w=KD(g,i,s,[]),E=[];hi(h,g);for(let x=1;x<u;x++){for(y=od(n,x,t,o,y),b=um(y,w);b;){DT(g,y,b,w,E);const C=um(E,w);C&&(DT(g,E,C,w,E),b=C),hi(h,E),NT(g,E),woe(w,i,b),r&&h.length>t&&(h=[],d.push(h),hi(h,g)),b=um(y,w)}hi(h,y),NT(g,y)}return r?d:d[0]}const aI=0,Toe=1;function YD(n,e=null,t){if(!n.length)return[];const{size:r=2,gridResolution:i=10,gridOffset:s=[0,0],edgeTypes:o=!1}=t||{},l=[],u=[{pos:n,types:o?new Array(n.length/r).fill(Toe):null,holes:e||[]}],h=[[],[]];let d=[];for(;u.length;){const{pos:g,types:y,holes:b}=u.shift();Eoe(g,r,b[0]||g.length,h),d=KD(h[0],i,s,d);const w=um(h[1],d);if(w){let E=lI(g,y,r,0,b[0]||g.length,d,w);const x={pos:E[0].pos,types:E[0].types,holes:[]},C={pos:E[1].pos,types:E[1].types,holes:[]};u.push(x,C);for(let M=0;M<b.length;M++)E=lI(g,y,r,b[M],b[M+1]||g.length,d,w),E[0]&&(x.holes.push(x.pos.length),x.pos=Ig(x.pos,E[0].pos),o&&(x.types=Ig(x.types,E[0].types))),E[1]&&(C.holes.push(C.pos.length),C.pos=Ig(C.pos,E[1].pos),o&&(C.types=Ig(C.types,E[1].types)))}else{const E={positions:g};o&&(E.edgeTypes=y),b.length&&(E.holeIndices=b),l.push(E)}}return l}function lI(n,e,t,r,i,s,o){const l=(i-r)/t,u=[],h=[],d=[],g=[],y=[];let b,w,E;const x=od(n,l-1,t,r);let C=Math.sign(o&8?x[1]-s[3]:x[0]-s[2]),M=e&&e[l-1],O=0,V=0;for(let H=0;H<l;H++)b=od(n,H,t,r,b),w=Math.sign(o&8?b[1]-s[3]:b[0]-s[2]),E=e&&e[r/t+H],w&&C&&C!==w&&(DT(x,b,o,s,y),hi(u,y)&&d.push(M),hi(h,y)&&g.push(M)),w<=0?(hi(u,b)&&d.push(E),O-=w):d.length&&(d[d.length-1]=aI),w>=0?(hi(h,b)&&g.push(E),V+=w):g.length&&(g[g.length-1]=aI),NT(x,b),C=w,M=E;return[O?{pos:u,types:e&&d}:null,V?{pos:h,types:e&&g}:null]}function KD(n,e,t,r){const i=Math.floor((n[0]-t[0])/e)*e+t[0],s=Math.floor((n[1]-t[1])/e)*e+t[1];return r[0]=i,r[1]=s,r[2]=i+e,r[3]=s+e,r}function woe(n,e,t){t&8?(n[1]+=e,n[3]+=e):t&4?(n[1]-=e,n[3]-=e):t&2?(n[0]+=e,n[2]+=e):t&1&&(n[0]-=e,n[2]-=e)}function Eoe(n,e,t,r){let i=1/0,s=-1/0,o=1/0,l=-1/0;for(let u=0;u<t;u+=e){const h=n[u],d=n[u+1];i=h<i?h:i,s=h>s?h:s,o=d<o?d:o,l=d>l?d:l}return r[0][0]=i,r[0][1]=o,r[1][0]=s,r[1][1]=l,r}function Ig(n,e){for(let t=0;t<e.length;t++)n.push(e[t]);return n}const xoe=85.051129;function Aoe(n,e){const{size:t=2,startIndex:r=0,endIndex:i=n.length,normalize:s=!0}=e||{},o=n.slice(r,i);GD(o,t,0,i-r);const l=XD(o,{size:t,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(s)for(const u of l)ZD(u,t);return l}function Soe(n,e=null,t){const{size:r=2,normalize:i=!0,edgeTypes:s=!1}=t||{};e=e||[];const o=[],l=[];let u=0,h=0;for(let g=0;g<=e.length;g++){const y=e[g]||n.length,b=h,w=Roe(n,r,u,y);for(let E=w;E<y;E++)o[h++]=n[E];for(let E=u;E<w;E++)o[h++]=n[E];GD(o,r,b,h),Coe(o,r,b,h,t?.maxLatitude),u=y,l[g]=h}l.pop();const d=YD(o,l,{size:r,gridResolution:360,gridOffset:[-180,-180],edgeTypes:s});if(i)for(const g of d)ZD(g.positions,r);return d}function Roe(n,e,t,r){let i=-1,s=-1;for(let o=t+1;o<r;o+=e){const l=Math.abs(n[o]);l>i&&(i=l,s=o-1)}return s}function Coe(n,e,t,r,i=xoe){const s=n[t],o=n[r-e];if(Math.abs(s-o)>180){const l=od(n,0,e,t);l[0]+=Math.round((o-s)/360)*360,hi(n,l),l[1]=Math.sign(l[1])*i,hi(n,l),l[0]=s,hi(n,l)}}function GD(n,e,t,r){let i=n[0],s;for(let o=t;o<r;o+=e){s=n[o];const l=s-i;(l>180||l<-180)&&(s-=Math.round(l/360)*360),n[o]=i=s}}function ZD(n,e){let t;const r=n.length/e;for(let s=0;s<r&&(t=n[s*e],(t+180)%360===0);s++);const i=-Math.round(t/360)*360;if(i!==0)for(let s=0;s<r;s++)n[s*e]+=i}function Ioe(n,e,t,r){let i;if(Array.isArray(n[0])){const s=n.length*e;i=new Array(s);for(let o=0;o<n.length;o++)for(let l=0;l<e;l++)i[o*e+l]=n[o][l]||0}else i=n;return t?XD(i,{size:e,gridResolution:t}):r?Aoe(i,{size:e}):i}const Poe=1,Moe=2,h0=4;class Ooe extends zD{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?Ioe(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(cI(e)){let r=0;for(const i of e)r+=this.getGeometrySize(i);return r}const t=this.getPathLength(e);return t<2?0:this.isClosed(e)?t<3?0:t+2:t}updateGeometryAttributes(e,t){if(t.geometrySize!==0)if(e&&cI(e))for(const r of e){const i=this.getGeometrySize(r);t.geometrySize=i,this.updateGeometryAttributes(r,t),t.vertexStart+=i}else this._updateSegmentTypes(e,t),this._updatePositions(e,t)}_updateSegmentTypes(e,t){const r=this.attributes.segmentTypes,i=e?this.isClosed(e):!1,{vertexStart:s,geometrySize:o}=t;r.fill(0,s,s+o),i?(r[s]=h0,r[s+o-2]=h0):(r[s]+=Poe,r[s+o-2]+=Moe),r[s+o-1]=h0}_updatePositions(e,t){const{positions:r}=this.attributes;if(!r||!e)return;const{vertexStart:i,geometrySize:s}=t,o=new Array(3);for(let l=i,u=0;u<s;l++,u++)this.getPointOnPath(e,u,o),r[l*3]=o[0],r[l*3+1]=o[1],r[l*3+2]=o[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,t,r=[]){const{positionSize:i}=this;t*i>=e.length&&(t+=1-e.length/i);const s=t*i;return r[0]=e[s],r[1]=e[s+1],r[2]=i===3&&e[s+2]||0,r}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:t}=this,r=e.length-t;return e[0]===e[r]&&e[1]===e[r+1]&&(t===2||e[2]===e[r+2])}}function cI(n){return Array.isArray(n[0])}const uI=`uniform pathUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float jointType;
  float capType;
  float miterLimit;
  bool billboard;
  highp int widthUnits;
} path;
`,koe={name:"path",vs:uI,fs:uI,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}},Noe=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = path.capType;
} else {
vJointType = path.jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),
path.widthMinPixels, path.widthMaxPixels) / 2.0);
vec3 width;
if (path.billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Doe=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,QD=[0,0,0,255],Loe={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:n=>n.path},getColor:{type:"accessor",value:QD},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},f0={enter:(n,e)=>e.length?e.subarray(e.length-n.length):n};class JE extends es{getShaders(){return super.getShaders({vs:Noe,fs:Doe,modules:[Wu,qu,koe]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:f0,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:f0,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:f0,defaultValue:QD},instancePickingColors:{size:4,type:"uint8",accessor:(r,{index:i,target:s})=>this.encodePickingColor(r&&r.__source?r.__source.index:i,s)}}),this.setState({pathTesselator:new Ooe({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);const{props:t,changeFlags:r}=e,i=this.getAttributeManager();if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPath)){const{pathTesselator:o}=this.state,l=t.data.attributes||{};o.updateGeometry({data:t.data,geometryBuffer:l.getPath,buffers:l,normalize:!t._pathType,loop:t._pathType==="loop",getGeometry:t.getPath,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:r.dataChanged}),this.setState({numInstances:o.instanceCount,startIndices:o.vertexStarts}),r.dataChanged||i.invalidateAll()}r.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),i.invalidateAll())}getPickingInfo(e){const t=super.getPickingInfo(e),{index:r}=t,i=this.props.data;return i[0]&&i[0].__source&&(t.object=i.find(s=>s.__source.index===r)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let r=0;r<t.length;r++)t[r].__source.index===e&&this._disablePickingIndex(r);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:t,capRounded:r,billboard:i,miterLimit:s,widthUnits:o,widthScale:l,widthMinPixels:u,widthMaxPixels:h}=this.props,d=this.state.model,g={jointType:Number(t),capType:Number(r),billboard:i,widthUnits:Hs[o],widthScale:l,miterLimit:s,widthMinPixels:u,widthMaxPixels:h};d.shaderInputs.setProps({path:g}),d.draw(this.context.renderPass)}_getModel(){const e=[0,1,2,1,4,2,1,3,4,3,5,4],t=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new qr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Su({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(t),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateSegmentTypes(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("segmentTypes")}}JE.defaultProps=Loe;JE.layerName="PathLayer";var Pg={exports:{}},hI;function Uoe(){if(hI)return Pg.exports;hI=1,Pg.exports=n,Pg.exports.default=n;function n(P,q,U){U=U||2;var oe=q&&q.length,L=oe?q[0]*U:P.length,Z=e(P,0,L,U,!0),ie=[];if(!Z||Z.next===Z.prev)return ie;var ae,me,Ee,Se,Ce,Me,at;if(oe&&(Z=u(P,q,Z,U)),P.length>80*U){ae=Ee=P[0],me=Se=P[1];for(var Ke=U;Ke<L;Ke+=U)Ce=P[Ke],Me=P[Ke+1],Ce<ae&&(ae=Ce),Me<me&&(me=Me),Ce>Ee&&(Ee=Ce),Me>Se&&(Se=Me);at=Math.max(Ee-ae,Se-me),at=at!==0?32767/at:0}return r(Z,ie,U,ae,me,at,0),ie}function e(P,q,U,oe,L){var Z,ie;if(L===xe(P,q,U,oe)>0)for(Z=q;Z<U;Z+=oe)ie=Y(Z,P[Z],P[Z+1],ie);else for(Z=U-oe;Z>=q;Z-=oe)ie=Y(Z,P[Z],P[Z+1],ie);return ie&&V(ie,ie.next)&&(z(ie),ie=ie.next),ie}function t(P,q){if(!P)return P;q||(q=P);var U=P,oe;do if(oe=!1,!U.steiner&&(V(U,U.next)||O(U.prev,U,U.next)===0)){if(z(U),U=q=U.prev,U===U.next)break;oe=!0}else U=U.next;while(oe||U!==q);return q}function r(P,q,U,oe,L,Z,ie){if(P){!ie&&Z&&b(P,oe,L,Z);for(var ae=P,me,Ee;P.prev!==P.next;){if(me=P.prev,Ee=P.next,Z?s(P,oe,L,Z):i(P)){q.push(me.i/U|0),q.push(P.i/U|0),q.push(Ee.i/U|0),z(P),P=Ee.next,ae=Ee.next;continue}if(P=Ee,P===ae){ie?ie===1?(P=o(t(P),q,U),r(P,q,U,oe,L,Z,2)):ie===2&&l(P,q,U,oe,L,Z):r(t(P),q,U,oe,L,Z,1);break}}}}function i(P){var q=P.prev,U=P,oe=P.next;if(O(q,U,oe)>=0)return!1;for(var L=q.x,Z=U.x,ie=oe.x,ae=q.y,me=U.y,Ee=oe.y,Se=L<Z?L<ie?L:ie:Z<ie?Z:ie,Ce=ae<me?ae<Ee?ae:Ee:me<Ee?me:Ee,Me=L>Z?L>ie?L:ie:Z>ie?Z:ie,at=ae>me?ae>Ee?ae:Ee:me>Ee?me:Ee,Ke=oe.next;Ke!==q;){if(Ke.x>=Se&&Ke.x<=Me&&Ke.y>=Ce&&Ke.y<=at&&C(L,ae,Z,me,ie,Ee,Ke.x,Ke.y)&&O(Ke.prev,Ke,Ke.next)>=0)return!1;Ke=Ke.next}return!0}function s(P,q,U,oe){var L=P.prev,Z=P,ie=P.next;if(O(L,Z,ie)>=0)return!1;for(var ae=L.x,me=Z.x,Ee=ie.x,Se=L.y,Ce=Z.y,Me=ie.y,at=ae<me?ae<Ee?ae:Ee:me<Ee?me:Ee,Ke=Se<Ce?Se<Me?Se:Me:Ce<Me?Ce:Me,mn=ae>me?ae>Ee?ae:Ee:me>Ee?me:Ee,on=Se>Ce?Se>Me?Se:Me:Ce>Me?Ce:Me,Gn=E(at,Ke,q,U,oe),ts=E(mn,on,q,U,oe),lt=P.prevZ,tt=P.nextZ;lt&&lt.z>=Gn&&tt&&tt.z<=ts;){if(lt.x>=at&&lt.x<=mn&&lt.y>=Ke&&lt.y<=on&&lt!==L&&lt!==ie&&C(ae,Se,me,Ce,Ee,Me,lt.x,lt.y)&&O(lt.prev,lt,lt.next)>=0||(lt=lt.prevZ,tt.x>=at&&tt.x<=mn&&tt.y>=Ke&&tt.y<=on&&tt!==L&&tt!==ie&&C(ae,Se,me,Ce,Ee,Me,tt.x,tt.y)&&O(tt.prev,tt,tt.next)>=0))return!1;tt=tt.nextZ}for(;lt&&lt.z>=Gn;){if(lt.x>=at&&lt.x<=mn&&lt.y>=Ke&&lt.y<=on&&lt!==L&&lt!==ie&&C(ae,Se,me,Ce,Ee,Me,lt.x,lt.y)&&O(lt.prev,lt,lt.next)>=0)return!1;lt=lt.prevZ}for(;tt&&tt.z<=ts;){if(tt.x>=at&&tt.x<=mn&&tt.y>=Ke&&tt.y<=on&&tt!==L&&tt!==ie&&C(ae,Se,me,Ce,Ee,Me,tt.x,tt.y)&&O(tt.prev,tt,tt.next)>=0)return!1;tt=tt.nextZ}return!0}function o(P,q,U){var oe=P;do{var L=oe.prev,Z=oe.next.next;!V(L,Z)&&H(L,oe,oe.next,Z)&&N(L,Z)&&N(Z,L)&&(q.push(L.i/U|0),q.push(oe.i/U|0),q.push(Z.i/U|0),z(oe),z(oe.next),oe=P=Z),oe=oe.next}while(oe!==P);return t(oe)}function l(P,q,U,oe,L,Z){var ie=P;do{for(var ae=ie.next.next;ae!==ie.prev;){if(ie.i!==ae.i&&M(ie,ae)){var me=W(ie,ae);ie=t(ie,ie.next),me=t(me,me.next),r(ie,q,U,oe,L,Z,0),r(me,q,U,oe,L,Z,0);return}ae=ae.next}ie=ie.next}while(ie!==P)}function u(P,q,U,oe){var L=[],Z,ie,ae,me,Ee;for(Z=0,ie=q.length;Z<ie;Z++)ae=q[Z]*oe,me=Z<ie-1?q[Z+1]*oe:P.length,Ee=e(P,ae,me,oe,!1),Ee===Ee.next&&(Ee.steiner=!0),L.push(x(Ee));for(L.sort(h),Z=0;Z<L.length;Z++)U=d(L[Z],U);return U}function h(P,q){return P.x-q.x}function d(P,q){var U=g(P,q);if(!U)return q;var oe=W(U,P);return t(oe,oe.next),t(U,U.next)}function g(P,q){var U=q,oe=P.x,L=P.y,Z=-1/0,ie;do{if(L<=U.y&&L>=U.next.y&&U.next.y!==U.y){var ae=U.x+(L-U.y)*(U.next.x-U.x)/(U.next.y-U.y);if(ae<=oe&&ae>Z&&(Z=ae,ie=U.x<U.next.x?U:U.next,ae===oe))return ie}U=U.next}while(U!==q);if(!ie)return null;var me=ie,Ee=ie.x,Se=ie.y,Ce=1/0,Me;U=ie;do oe>=U.x&&U.x>=Ee&&oe!==U.x&&C(L<Se?oe:Z,L,Ee,Se,L<Se?Z:oe,L,U.x,U.y)&&(Me=Math.abs(L-U.y)/(oe-U.x),N(U,P)&&(Me<Ce||Me===Ce&&(U.x>ie.x||U.x===ie.x&&y(ie,U)))&&(ie=U,Ce=Me)),U=U.next;while(U!==me);return ie}function y(P,q){return O(P.prev,P,q.prev)<0&&O(q.next,P,P.next)<0}function b(P,q,U,oe){var L=P;do L.z===0&&(L.z=E(L.x,L.y,q,U,oe)),L.prevZ=L.prev,L.nextZ=L.next,L=L.next;while(L!==P);L.prevZ.nextZ=null,L.prevZ=null,w(L)}function w(P){var q,U,oe,L,Z,ie,ae,me,Ee=1;do{for(U=P,P=null,Z=null,ie=0;U;){for(ie++,oe=U,ae=0,q=0;q<Ee&&(ae++,oe=oe.nextZ,!!oe);q++);for(me=Ee;ae>0||me>0&&oe;)ae!==0&&(me===0||!oe||U.z<=oe.z)?(L=U,U=U.nextZ,ae--):(L=oe,oe=oe.nextZ,me--),Z?Z.nextZ=L:P=L,L.prevZ=Z,Z=L;U=oe}Z.nextZ=null,Ee*=2}while(ie>1);return P}function E(P,q,U,oe,L){return P=(P-U)*L|0,q=(q-oe)*L|0,P=(P|P<<8)&16711935,P=(P|P<<4)&252645135,P=(P|P<<2)&858993459,P=(P|P<<1)&1431655765,q=(q|q<<8)&16711935,q=(q|q<<4)&252645135,q=(q|q<<2)&858993459,q=(q|q<<1)&1431655765,P|q<<1}function x(P){var q=P,U=P;do(q.x<U.x||q.x===U.x&&q.y<U.y)&&(U=q),q=q.next;while(q!==P);return U}function C(P,q,U,oe,L,Z,ie,ae){return(L-ie)*(q-ae)>=(P-ie)*(Z-ae)&&(P-ie)*(oe-ae)>=(U-ie)*(q-ae)&&(U-ie)*(Z-ae)>=(L-ie)*(oe-ae)}function M(P,q){return P.next.i!==q.i&&P.prev.i!==q.i&&!I(P,q)&&(N(P,q)&&N(q,P)&&j(P,q)&&(O(P.prev,P,q.prev)||O(P,q.prev,q))||V(P,q)&&O(P.prev,P,P.next)>0&&O(q.prev,q,q.next)>0)}function O(P,q,U){return(q.y-P.y)*(U.x-q.x)-(q.x-P.x)*(U.y-q.y)}function V(P,q){return P.x===q.x&&P.y===q.y}function H(P,q,U,oe){var L=D(O(P,q,U)),Z=D(O(P,q,oe)),ie=D(O(U,oe,P)),ae=D(O(U,oe,q));return!!(L!==Z&&ie!==ae||L===0&&G(P,U,q)||Z===0&&G(P,oe,q)||ie===0&&G(U,P,oe)||ae===0&&G(U,q,oe))}function G(P,q,U){return q.x<=Math.max(P.x,U.x)&&q.x>=Math.min(P.x,U.x)&&q.y<=Math.max(P.y,U.y)&&q.y>=Math.min(P.y,U.y)}function D(P){return P>0?1:P<0?-1:0}function I(P,q){var U=P;do{if(U.i!==P.i&&U.next.i!==P.i&&U.i!==q.i&&U.next.i!==q.i&&H(U,U.next,P,q))return!0;U=U.next}while(U!==P);return!1}function N(P,q){return O(P.prev,P,P.next)<0?O(P,q,P.next)>=0&&O(P,P.prev,q)>=0:O(P,q,P.prev)<0||O(P,P.next,q)<0}function j(P,q){var U=P,oe=!1,L=(P.x+q.x)/2,Z=(P.y+q.y)/2;do U.y>Z!=U.next.y>Z&&U.next.y!==U.y&&L<(U.next.x-U.x)*(Z-U.y)/(U.next.y-U.y)+U.x&&(oe=!oe),U=U.next;while(U!==P);return oe}function W(P,q){var U=new de(P.i,P.x,P.y),oe=new de(q.i,q.x,q.y),L=P.next,Z=q.prev;return P.next=q,q.prev=P,U.next=L,L.prev=U,oe.next=U,U.prev=oe,Z.next=oe,oe.prev=Z,oe}function Y(P,q,U,oe){var L=new de(P,q,U);return oe?(L.next=oe.next,L.prev=oe,oe.next.prev=L,oe.next=L):(L.prev=L,L.next=L),L}function z(P){P.next.prev=P.prev,P.prev.next=P.next,P.prevZ&&(P.prevZ.nextZ=P.nextZ),P.nextZ&&(P.nextZ.prevZ=P.prevZ)}function de(P,q,U){this.i=P,this.x=q,this.y=U,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}n.deviation=function(P,q,U,oe){var L=q&&q.length,Z=L?q[0]*U:P.length,ie=Math.abs(xe(P,0,Z,U));if(L)for(var ae=0,me=q.length;ae<me;ae++){var Ee=q[ae]*U,Se=ae<me-1?q[ae+1]*U:P.length;ie-=Math.abs(xe(P,Ee,Se,U))}var Ce=0;for(ae=0;ae<oe.length;ae+=3){var Me=oe[ae]*U,at=oe[ae+1]*U,Ke=oe[ae+2]*U;Ce+=Math.abs((P[Me]-P[Ke])*(P[at+1]-P[Me+1])-(P[Me]-P[at])*(P[Ke+1]-P[Me+1]))}return ie===0&&Ce===0?0:Math.abs((Ce-ie)/ie)};function xe(P,q,U,oe){for(var L=0,Z=q,ie=U-oe;Z<U;Z+=oe)L+=(P[ie]-P[Z])*(P[Z+1]+P[ie+1]),ie=Z;return L}return n.flatten=function(P){for(var q=P[0][0].length,U={vertices:[],holes:[],dimensions:q},oe=0,L=0;L<P.length;L++){for(var Z=0;Z<P[L].length;Z++)for(var ie=0;ie<q;ie++)U.vertices.push(P[L][Z][ie]);L>0&&(oe+=P[L-1].length,U.holes.push(oe))}return U},Pg.exports}var Foe=Uoe();const Boe=zT(Foe),Mg=WD.CLOCKWISE,fI=WD.COUNTER_CLOCKWISE,Zo={};function Voe(n){if(n=n&&n.positions||n,!Array.isArray(n)&&!ArrayBuffer.isView(n))throw new Error("invalid polygon")}function Tf(n){return"positions"in n?n.positions:n}function hm(n){return"holeIndices"in n?n.holeIndices:null}function zoe(n){return Array.isArray(n[0])}function joe(n){return n.length>=1&&n[0].length>=2&&Number.isFinite(n[0][0])}function Hoe(n){const e=n[0],t=n[n.length-1];return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function $oe(n,e,t,r){for(let i=0;i<e;i++)if(n[t+i]!==n[r-e+i])return!1;return!0}function dI(n,e,t,r,i){let s=e;const o=t.length;for(let l=0;l<o;l++)for(let u=0;u<r;u++)n[s++]=t[l][u]||0;if(!Hoe(t))for(let l=0;l<r;l++)n[s++]=t[0][l]||0;return Zo.start=e,Zo.end=s,Zo.size=r,qD(n,i,Zo),s}function pI(n,e,t,r,i=0,s,o){s=s||t.length;const l=s-i;if(l<=0)return e;let u=e;for(let h=0;h<l;h++)n[u++]=t[i+h];if(!$oe(t,r,i,s))for(let h=0;h<r;h++)n[u++]=t[i+h];return Zo.start=e,Zo.end=u,Zo.size=r,qD(n,o,Zo),u}function Woe(n,e){Voe(n);const t=[],r=[];if("positions"in n){const{positions:i,holeIndices:s}=n;if(s){let o=0;for(let l=0;l<=s.length;l++)o=pI(t,o,i,e,s[l-1],s[l],l===0?Mg:fI),r.push(o);return r.pop(),{positions:t,holeIndices:r}}n=i}if(!zoe(n))return pI(t,0,n,e,0,t.length,Mg),t;if(!joe(n)){let i=0;for(const[s,o]of n.entries())i=dI(t,i,o,e,s===0?Mg:fI),r.push(i);return r.pop(),{positions:t,holeIndices:r}}return dI(t,0,n,e,Mg),t}function d0(n,e,t){const r=n.length/3;let i=0;for(let s=0;s<r;s++){const o=(s+1)%r;i+=n[s*3+e]*n[o*3+t],i-=n[o*3+e]*n[s*3+t]}return Math.abs(i/2)}function gI(n,e,t,r){const i=n.length/3;for(let s=0;s<i;s++){const o=s*3,l=n[o+0],u=n[o+1],h=n[o+2];n[o+e]=l,n[o+t]=u,n[o+r]=h}}function qoe(n,e,t,r){let i=hm(n);i&&(i=i.map(l=>l/e));let s=Tf(n);const o=r&&e===3;if(t){const l=s.length;s=s.slice();const u=[];for(let h=0;h<l;h+=e){u[0]=s[h],u[1]=s[h+1],o&&(u[2]=s[h+2]);const d=t(u);s[h]=d[0],s[h+1]=d[1],o&&(s[h+2]=d[2])}}if(o){const l=d0(s,0,1),u=d0(s,0,2),h=d0(s,1,2);if(!l&&!u&&!h)return[];l>u&&l>h||(u>h?(t||(s=s.slice()),gI(s,0,2,1)):(t||(s=s.slice()),gI(s,2,0,1)))}return Boe(s,i,e)}class Xoe extends zD{constructor(e){const{fp64:t,IndexType:r=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:t?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:r,size:1}}})}get(e){const{attributes:t}=this;return e==="indices"?t.indices&&t.indices.subarray(0,this.vertexCount):t[e]}updateGeometry(e){super.updateGeometry(e);const t=this.buffers.indices;if(t)this.vertexCount=(t.value||t).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const t=Woe(e,this.positionSize);return this.opts.resolution?YD(Tf(t),hm(t),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?Soe(Tf(t),hm(t),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):t}return e}getGeometrySize(e){if(mI(e)){let t=0;for(const r of e)t+=this.getGeometrySize(r);return t}return Tf(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,t){if(e&&mI(e))for(const r of e){const i=this.getGeometrySize(r);t.geometrySize=i,this.updateGeometryAttributes(r,t),t.vertexStart+=i,t.indexStart=this.indexStarts[t.geometryIndex+1]}else{const r=e;this._updateIndices(r,t),this._updatePositions(r,t),this._updateVertexValid(r,t)}}_updateIndices(e,{geometryIndex:t,vertexStart:r,indexStart:i}){const{attributes:s,indexStarts:o,typedArrayManager:l}=this;let u=s.indices;if(!u||!e)return;let h=i;const d=qoe(e,this.positionSize,this.opts.preproject,this.opts.full3d);u=l.allocate(u,i+d.length,{copy:!0});for(let g=0;g<d.length;g++)u[h++]=d[g]+r;o[t+1]=i+d.length,s.indices=u}_updatePositions(e,{vertexStart:t,geometrySize:r}){const{attributes:{positions:i},positionSize:s}=this;if(!i||!e)return;const o=Tf(e);for(let l=t,u=0;u<r;l++,u++){const h=o[u*s],d=o[u*s+1],g=s>2?o[u*s+2]:0;i[l*3]=h,i[l*3+1]=d,i[l*3+2]=g}}_updateVertexValid(e,{vertexStart:t,geometrySize:r}){const{positionSize:i}=this,s=this.attributes.vertexValid,o=e&&hm(e);if(e&&e.edgeTypes?s.set(e.edgeTypes,t):s.fill(1,t,t+r),o)for(let l=0;l<o.length;l++)s[t+o[l]/i-1]=0;s[t+r-1]=0}}function mI(n){return Array.isArray(n)&&n.length>0&&!Number.isFinite(n[0])}const _I=`uniform solidPolygonUniforms {
  bool extruded;
  bool isWireframe;
  float elevationScale;
} solidPolygon;
`,Yoe={name:"solidPolygon",vs:_I,fs:_I,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}},JD=`in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project.commonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (solidPolygon.extruded) {
pos.z += props.elevations * solidPolygon.elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (solidPolygon.extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * layer.opacity);
} else {
vColor = vec4(colors.rgb, colors.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Koe=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${JD}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,Goe=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${JD}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`,Zoe=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,l_=[0,0,0,255],Qoe={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:n=>n.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:l_},getLineColor:{type:"accessor",value:l_},material:!0},Og={enter:(n,e)=>e.length?e.subarray(e.length-n.length):n};class ex extends es{getShaders(e){return super.getShaders({vs:e==="top"?Koe:Goe,fs:Zoe,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[Wu,V4,qu,Yoe]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:t}=this.props;const{_full3d:r}=this.props;e.isGeospatial&&t===st.DEFAULT&&(t=st.LNGLAT);let i;t===st.LNGLAT&&(r?i=e.projectPosition.bind(e):i=e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new Xoe({preproject:i,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const s=this.getAttributeManager(),o=!0;s.remove(["instancePickingColors"]),s.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:o},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:Og,accessor:"getPolygon",update:this.calculatePositions,noAlloc:o,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:o},elevations:{size:1,stepMode:"dynamic",transition:Og,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:Og,accessor:"getFillColor",defaultValue:l_},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:Og,accessor:"getLineColor",defaultValue:l_},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(l,{index:u,target:h})=>this.encodePickingColor(l&&l.__source?l.__source.index:u,h)}})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:r}=t,i=this.props.data;return i[0]&&i[0].__source&&(t.object=i.find(s=>s.__source.index===r)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let r=0;r<t.length;r++)t[r].__source.index===e&&this._disablePickingIndex(r);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:t,filled:r,wireframe:i,elevationScale:s}=this.props,{topModel:o,sideModel:l,wireframeModel:u,polygonTesselator:h}=this.state,d={extruded:!!t,elevationScale:s,isWireframe:!1};u&&i&&(u.setInstanceCount(h.instanceCount-1),u.shaderInputs.setProps({solidPolygon:{...d,isWireframe:!0}}),u.draw(this.context.renderPass)),l&&r&&(l.setInstanceCount(h.instanceCount-1),l.shaderInputs.setProps({solidPolygon:d}),l.draw(this.context.renderPass)),o&&r&&(o.setVertexCount(h.vertexCount),o.shaderInputs.setProps({solidPolygon:d}),o.draw(this.context.renderPass))}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:t,oldProps:r,changeFlags:i}=e,s=this.getAttributeManager();(i.extensionsChanged||t.filled!==r.filled||t.extruded!==r.extruded)&&(this.state.models?.forEach(l=>l.destroy()),this.setState(this._getModels()),s.invalidateAll())}updateGeometry({props:e,oldProps:t,changeFlags:r}){if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPolygon)){const{polygonTesselator:s}=this.state,o=e.data.attributes||{};s.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:o.getPolygon,buffers:o,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:r.dataChanged,full3d:e._full3d}),this.setState({numInstances:s.instanceCount,startIndices:s.vertexStarts}),r.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:t,extruded:r}=this.props;let i,s,o;if(t){const l=this.getShaders("top");l.defines.NON_INSTANCED_MODEL=1;const u=this.getAttributeManager().getBufferLayouts({isInstanced:!1});i=new qr(this.context.device,{...l,id:`${e}-top`,topology:"triangle-list",bufferLayout:u,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(r){const l=this.getAttributeManager().getBufferLayouts({isInstanced:!0});s=new qr(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:l,geometry:new Su({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),o=new qr(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:l,geometry:new Su({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[s,o,i].filter(Boolean),topModel:i,sideModel:s,wireframeModel:o}}calculateIndices(e){const{polygonTesselator:t}=this.state;e.startIndices=t.indexStarts,e.value=t.get("indices")}calculatePositions(e){const{polygonTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}ex.defaultProps=Qoe;ex.layerName="SolidPolygonLayer";function Joe({data:n,getIndex:e,dataRange:t,replace:r}){const{startRow:i=0,endRow:s=1/0}=t,o=n.length;let l=o,u=o;for(let y=0;y<o;y++){const b=e(n[y]);if(l>y&&b>=i&&(l=y),b>=s){u=y;break}}let h=l;const g=u-l!==r.length?n.slice(u):void 0;for(let y=0;y<r.length;y++)n[h++]=r[y];if(g){for(let y=0;y<g.length;y++)n[h++]=g[y];n.length=h}return{startRow:l,endRow:l+r.length}}function eae(n,e){if(!n)return null;const t="startIndices"in n?n.startIndices[e]:e,r=n.featureIds.value[t];return t!==-1?tae(n,r,t):null}function tae(n,e,t){const r={properties:{...n.properties[e]}};for(const i in n.numericProps)r.properties[i]=n.numericProps[i].value[t];return r}function nae(n,e){const t={points:null,lines:null,polygons:null};for(const r in t){const i=n[r].globalFeatureIds.value;t[r]=new Uint8ClampedArray(i.length*4);const s=[];for(let o=0;o<i.length;o++)e(i[o],s),t[r][o*4+0]=s[0],t[r][o*4+1]=s[1],t[r][o*4+2]=s[2],t[r][o*4+3]=255}return t}const yI=`uniform sdfUniforms {
  float gamma;
  bool enabled;
  float buffer;
  float outlineBuffer;
  vec4 outlineColor;
} sdf;
`,rae={name:"sdf",vs:yI,fs:yI,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}},iae=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf.enabled) {
float distance = alpha;
alpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);
if (sdf.outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);
color = mix(sdf.outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * layer.opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,p0=192/256,vI=[],sae={getIconOffsets:{type:"accessor",value:n=>n.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class tx extends An{getShaders(){const e=super.getShaders();return{...e,modules:[...e.modules,rae],fs:iae}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(t,{index:r,target:i})=>this.encodePickingColor(r,i)}})}updateState(e){super.updateState(e);const{props:t,oldProps:r}=e;let{outlineColor:i}=t;i!==r.outlineColor&&(i=i.map(s=>s/255),i[3]=Number.isFinite(i[3])?i[3]:1,this.setState({outlineColor:i})),!t.sdf&&t.outlineWidth&&ot.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){const{sdf:t,smoothing:r,outlineWidth:i}=this.props,{outlineColor:s}=this.state,o=i?Math.max(r,p0*(1-i)):-1,l=this.state.model,u={buffer:p0,outlineBuffer:o,gamma:r,enabled:!!t,outlineColor:s};if(l.shaderInputs.setProps({sdf:u}),super.draw(e),t&&i){const{iconManager:h}=this.state;h.getTexture()&&(l.shaderInputs.setProps({sdf:{...u,outlineBuffer:p0}}),l.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(t=>super.getInstanceOffset(t)):vI}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(t=>super.getInstanceIconFrame(t)):vI}}tx.defaultProps=sae;tx.layerName="MultiIconLayer";const Ff=1e20;class oae{constructor({fontSize:e=24,buffer:t=3,radius:r=8,cutoff:i=.25,fontFamily:s="sans-serif",fontWeight:o="normal",fontStyle:l="normal",lang:u=null}={}){this.buffer=t,this.cutoff=i,this.radius=r,this.lang=u;const h=this.size=e+t*4,d=this._createCanvas(h),g=this.ctx=d.getContext("2d",{willReadFrequently:!0});g.font=`${l} ${o} ${e}px ${s}`,g.textBaseline="alphabetic",g.textAlign="left",g.fillStyle="black",this.gridOuter=new Float64Array(h*h),this.gridInner=new Float64Array(h*h),this.f=new Float64Array(h),this.z=new Float64Array(h+1),this.v=new Uint16Array(h)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:i,actualBoundingBoxLeft:s,actualBoundingBoxRight:o}=this.ctx.measureText(e),l=Math.ceil(r),u=0,h=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-s))),d=Math.min(this.size-this.buffer,l+Math.ceil(i)),g=h+2*this.buffer,y=d+2*this.buffer,b=Math.max(g*y,0),w=new Uint8ClampedArray(b),E={data:w,width:g,height:y,glyphWidth:h,glyphHeight:d,glyphTop:l,glyphLeft:u,glyphAdvance:t};if(h===0||d===0)return E;const{ctx:x,buffer:C,gridInner:M,gridOuter:O}=this;this.lang&&(x.lang=this.lang),x.clearRect(C,C,h,d),x.fillText(e,C,C+l);const V=x.getImageData(C,C,h,d);O.fill(Ff,0,b),M.fill(0,0,b);for(let H=0;H<d;H++)for(let G=0;G<h;G++){const D=V.data[4*(H*h+G)+3]/255;if(D===0)continue;const I=(H+C)*g+G+C;if(D===1)O[I]=0,M[I]=Ff;else{const N=.5-D;O[I]=N>0?N*N:0,M[I]=N<0?N*N:0}}bI(O,0,0,g,y,g,this.f,this.v,this.z),bI(M,C,C,h,d,g,this.f,this.v,this.z);for(let H=0;H<b;H++){const G=Math.sqrt(O[H])-Math.sqrt(M[H]);w[H]=Math.round(255-255*(G/this.radius+this.cutoff))}return E}}function bI(n,e,t,r,i,s,o,l,u){for(let h=e;h<e+r;h++)TI(n,t*s+h,s,i,o,l,u);for(let h=t;h<t+i;h++)TI(n,h*s+e,1,r,o,l,u)}function TI(n,e,t,r,i,s,o){s[0]=0,o[0]=-Ff,o[1]=Ff,i[0]=n[e];for(let l=1,u=0,h=0;l<r;l++){i[l]=n[e+l*t];const d=l*l;do{const g=s[u];h=(i[l]-i[g]+d-g*g)/(l-g)/2}while(h<=o[u]&&--u>-1);u++,s[u]=l,o[u]=h,o[u+1]=Ff}for(let l=0,u=0;l<r;l++){for(;o[u+1]<l;)u++;const h=s[u],d=l-h;n[e+l*t]=i[h]+d*d}}const aae=32,lae=[];function cae(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function uae({characterSet:n,getFontWidth:e,fontHeight:t,buffer:r,maxCanvasWidth:i,mapping:s={},xOffset:o=0,yOffset:l=0}){let u=0,h=o;const d=t+r*2;for(const g of n)if(!s[g]){const y=e(g);h+y+r*2>i&&(h=0,u++),s[g]={x:h+r,y:l+u*d+r,width:y,height:d,layoutWidth:y,layoutHeight:t},h+=y+r*2}return{mapping:s,xOffset:h,yOffset:l+u*d,canvasHeight:cae(l+(u+1)*d)}}function eL(n,e,t,r){let i=0;for(let s=e;s<t;s++){const o=n[s];i+=r[o]?.layoutWidth||0}return i}function tL(n,e,t,r,i,s){let o=e,l=0;for(let u=e;u<t;u++){const h=eL(n,u,u+1,i);l+h>r&&(o<u&&s.push(u),o=u,l=0),l+=h}return l}function hae(n,e,t,r,i,s){let o=e,l=e,u=e,h=0;for(let d=e;d<t;d++)if((n[d]===" "||n[d+1]===" "||d+1===t)&&(u=d+1),u>l){let g=eL(n,l,u,i);h+g>r&&(o<l&&(s.push(l),o=l,h=0),g>r&&(g=tL(n,l,u,r,i,s),o=s[s.length-1])),l=u,h+=g}return h}function fae(n,e,t,r,i=0,s){s===void 0&&(s=n.length);const o=[];return e==="break-all"?tL(n,i,s,t,r,o):hae(n,i,s,t,r,o),o}function dae(n,e,t,r,i,s){let o=0,l=0;for(let u=e;u<t;u++){const h=n[u],d=r[h];d?(l||(l=d.layoutHeight),i[u]=o+d.layoutWidth/2,o+=d.layoutWidth):(ot.warn(`Missing character: ${h} (${h.codePointAt(0)})`)(),i[u]=o,o+=aae)}s[0]=o,s[1]=l}function pae(n,e,t,r,i){const s=Array.from(n),o=s.length,l=new Array(o),u=new Array(o),h=new Array(o),d=(t==="break-word"||t==="break-all")&&isFinite(r)&&r>0,g=[0,0],y=[0,0];let b=0,w=0,E=0;for(let x=0;x<=o;x++){const C=s[x];if((C===`
`||x===o)&&(E=x),E>w){const M=d?fae(s,t,r,i,w,E):lae;for(let O=0;O<=M.length;O++){const V=O===0?w:M[O-1],H=O<M.length?M[O]:E;dae(s,V,H,i,l,y);for(let G=V;G<H;G++){l[G]-y[0]/2;const D=s[G],I=i[D]?.layoutOffsetY||0;u[G]=b+y[1]/2+I,h[G]=y[0]}b=b+y[1]*e,g[0]=Math.max(g[0],y[0])}w=E}C===`
`&&(l[w]=0,u[w]=0,h[w]=0,w++)}return g[1]=b,{x:l,y:u,rowWidth:h,size:g}}function gae({value:n,length:e,stride:t,offset:r,startIndices:i,characterSet:s}){const o=n.BYTES_PER_ELEMENT,l=t?t/o:1,u=r?r/o:0,h=i[e]||Math.ceil((n.length-u)/l),d=s&&new Set,g=new Array(e);let y=n;if(l>1||u>0){const b=n.constructor;y=new b(h);for(let w=0;w<h;w++)y[w]=n[w*l+u]}for(let b=0;b<e;b++){const w=i[b],E=i[b+1]||h,x=y.subarray(w,E);g[b]=String.fromCodePoint.apply(null,x),d&&x.forEach(d.add,d)}if(d)for(const b of d)s.add(String.fromCodePoint(b));return{texts:g,characterCount:h}}class nL{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){const t=this._cache[e];return t&&(this._deleteOrder(e),this._appendOrder(e)),t}set(e,t){this._cache[e]?(this.delete(e),this._cache[e]=t,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=t,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const t=this._order.indexOf(e);t>=0&&this._order.splice(t,1)}_appendOrder(e){this._order.push(e)}}function mae(){const n=[];for(let e=32;e<128;e++)n.push(String.fromCharCode(e));return n}const au={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:mae(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},wI=1024,EI=.9,xI=1.2,rL=3;let c_=new nL(rL);function _ae(n,e){let t;typeof e=="string"?t=new Set(Array.from(e)):t=new Set(e);const r=c_.get(n);if(!r)return t;for(const i in r.mapping)t.has(i)&&t.delete(i);return t}function yae(n,e){for(let t=0;t<n.length;t++)e.data[4*t+3]=n[t]}function AI(n,e,t,r){n.font=`${r} ${t}px ${e}`,n.fillStyle="#000",n.textBaseline="alphabetic",n.textAlign="left"}function vae(n){ot.assert(Number.isFinite(n)&&n>=rL,"Invalid cache limit"),c_=new nL(n)}class bae{constructor(){this.props={...au}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:t}=this.props;return(e*xI+t*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const t=_ae(this._key,this.props.characterSet),r=c_.get(this._key);if(r&&t.size===0){this._atlas!==r&&(this._atlas=r);return}const i=this._generateFontAtlas(t,r);this._atlas=i,c_.set(this._key,i)}_generateFontAtlas(e,t){const{fontFamily:r,fontWeight:i,fontSize:s,buffer:o,sdf:l,radius:u,cutoff:h}=this.props;let d=t&&t.data;d||(d=document.createElement("canvas"),d.width=wI);const g=d.getContext("2d",{willReadFrequently:!0});AI(g,r,s,i);const{mapping:y,canvasHeight:b,xOffset:w,yOffset:E}=uae({getFontWidth:x=>g.measureText(x).width,fontHeight:s*xI,buffer:o,characterSet:e,maxCanvasWidth:wI,...t&&{mapping:t.mapping,xOffset:t.xOffset,yOffset:t.yOffset}});if(d.height!==b){const x=g.getImageData(0,0,d.width,d.height);d.height=b,g.putImageData(x,0,0)}if(AI(g,r,s,i),l){const x=new oae({fontSize:s,buffer:o,radius:u,cutoff:h,fontFamily:r,fontWeight:`${i}`});for(const C of e){const{data:M,width:O,height:V,glyphTop:H}=x.draw(C);y[C].width=O,y[C].layoutOffsetY=s*EI-H;const G=g.createImageData(O,V);yae(M,G),g.putImageData(G,y[C].x,y[C].y)}}else for(const x of e)g.fillText(x,y[x].x,y[x].y+o+s*EI);return{xOffset:w,yOffset:E,mapping:y,data:d,width:d.width,height:d.height}}_getKey(){const{fontFamily:e,fontWeight:t,fontSize:r,buffer:i,sdf:s,radius:o,cutoff:l}=this.props;return s?`${e} ${t} ${r} ${i} ${o} ${l}`:`${e} ${t} ${r} ${i}`}}const SI=`uniform textBackgroundUniforms {
  bool billboard;
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  vec4 borderRadius;
  vec4 padding;
  highp int sizeUnits;
  bool stroked;
} textBackground;
`,Tae={name:"textBackground",vs:SI,fs:SI,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",borderRadius:"vec4<f32>",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}},wae=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),
textBackground.sizeMinPixels, textBackground.sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (textBackground.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,Eae=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
float round_rect(vec2 p, vec2 size, vec4 radii) {
vec2 pixelPositionCB = (p - 0.5) * size;
vec2 sizeCB = size * 0.5;
float maxBorderRadius = min(size.x, size.y) * 0.5;
vec4 borderRadius = vec4(min(radii, maxBorderRadius));
borderRadius.xy =
(pixelPositionCB.x > 0.0) ? borderRadius.xy : borderRadius.zw;
borderRadius.x = (pixelPositionCB.y > 0.0) ? borderRadius.x : borderRadius.y;
vec2 q = abs(pixelPositionCB) - sizeCB + borderRadius.x;
return -(min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - borderRadius.x);
}
float rect(vec2 p, vec2 size) {
vec2 pixelPosition = p * size;
return min(min(pixelPosition.x, size.x - pixelPosition.x),
min(pixelPosition.y, size.y - pixelPosition.y));
}
vec4 get_stroked_fragColor(float dist) {
float isBorder = smoothedge(dist, vLineWidth);
return mix(vFillColor, vLineColor, isBorder);
}
void main(void) {
geometry.uv = uv;
if (textBackground.borderRadius != vec4(0.0)) {
float distToEdge = round_rect(uv, dimensions, textBackground.borderRadius);
if (textBackground.stroked) {
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
float shapeAlpha = smoothedge(-distToEdge, 0.0);
fragColor.a *= shapeAlpha;
} else {
if (textBackground.stroked) {
float distToEdge = rect(uv, dimensions);
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,xae={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,borderRadius:{type:"object",value:0},padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:n=>n.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class nx extends es{getShaders(){return super.getShaders({vs:wae,fs:Eae,modules:[Wu,qu,Tae]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);const{changeFlags:t}=e;t.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{billboard:t,sizeScale:r,sizeUnits:i,sizeMinPixels:s,sizeMaxPixels:o,getLineWidth:l}=this.props;let{padding:u,borderRadius:h}=this.props;u.length<4&&(u=[u[0],u[1],u[0],u[1]]),Array.isArray(h)||(h=[h,h,h,h]);const d=this.state.model,g={billboard:t,stroked:!!l,borderRadius:h,padding:u,sizeUnits:Hs[i],sizeScale:r,sizeMinPixels:s,sizeMaxPixels:o};d.shaderInputs.setProps({textBackground:g}),d.draw(this.context.renderPass)}_getModel(){const e=[0,0,1,0,0,1,1,1];return new qr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Su({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}}nx.defaultProps=xae;nx.layerName="TextBackgroundLayer";const RI={start:1,middle:0,end:-1},CI={top:1,center:0,bottom:-1},g0=[0,0,0,255],Aae=1,Sae={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:g0},getBorderWidth:{type:"accessor",value:0},backgroundBorderRadius:{type:"object",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:au.characterSet},fontFamily:au.fontFamily,fontWeight:au.fontWeight,lineHeight:Aae,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:g0},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:n=>n.text},getPosition:{type:"accessor",value:n=>n.position},getColor:{type:"accessor",value:g0},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class rx extends K_{constructor(){super(...arguments),this.getBoundingRect=(e,t)=>{let{size:[r,i]}=this.transformParagraph(e,t);const{fontSize:s}=this.state.fontAtlasManager.props;r/=s,i/=s;const{getTextAnchor:o,getAlignmentBaseline:l}=this.props,u=RI[typeof o=="function"?o(e,t):o],h=CI[typeof l=="function"?l(e,t):l];return[(u-1)*r/2,(h-1)*i/2,r,i]},this.getIconOffsets=(e,t)=>{const{getTextAnchor:r,getAlignmentBaseline:i}=this.props,{x:s,y:o,rowWidth:l,size:[u,h]}=this.transformParagraph(e,t),d=RI[typeof r=="function"?r(e,t):r],g=CI[typeof i=="function"?i(e,t):i],y=s.length,b=new Array(y*2);let w=0;for(let E=0;E<y;E++){const x=(1-d)*(u-l[E])/2;b[w++]=(d-1)*u/2+x+s[E],b[w++]=(g-1)*h/2+o[E]}return b}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new bae},this.props.maxWidth>0&&ot.once(1,"v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:t,oldProps:r,changeFlags:i}=e;(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||t.lineHeight!==r.lineHeight||t.wordBreak!==r.wordBreak||t.maxWidth!==r.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:t,fontWeight:r}=this.props,{fontAtlasManager:i,characterSet:s}=this.state,o={...e,characterSet:s,fontFamily:t,fontWeight:r};if(!i.mapping)return i.setProps(o),!0;for(const l in o)if(o[l]!==i.props[l])return i.setProps(o),!0;return!1}_updateText(){const{data:e,characterSet:t}=this.props,r=e.attributes?.getText;let{getText:i}=this.props,s=e.startIndices,o;const l=t==="auto"&&new Set;if(r&&s){const{texts:u,characterCount:h}=gae({...ArrayBuffer.isView(r)?{value:r}:r,length:e.length,startIndices:s,characterSet:l});o=h,i=(d,{index:g})=>u[g]}else{const{iterable:u,objectInfo:h}=X_(e);s=[0],o=0;for(const d of u){h.index++;const g=Array.from(i(d,h)||"");l&&g.forEach(l.add,l),o+=g.length,s.push(o)}}this.setState({getText:i,startIndices:s,numInstances:o,characterSet:l||t})}transformParagraph(e,t){const{fontAtlasManager:r}=this.state,i=r.mapping,s=this.state.getText,{wordBreak:o,lineHeight:l,maxWidth:u}=this.props,h=s(e,t)||"";return pae(h,l,o,u*r.props.fontSize,i)}renderLayers(){const{startIndices:e,numInstances:t,getText:r,fontAtlasManager:{scale:i,atlas:s,mapping:o},styleVersion:l}=this.state,{data:u,_dataDiff:h,getPosition:d,getColor:g,getSize:y,getAngle:b,getPixelOffset:w,getBackgroundColor:E,getBorderColor:x,getBorderWidth:C,backgroundBorderRadius:M,backgroundPadding:O,background:V,billboard:H,fontSettings:G,outlineWidth:D,outlineColor:I,sizeScale:N,sizeUnits:j,sizeMinPixels:W,sizeMaxPixels:Y,transitions:z,updateTriggers:de}=this.props,xe=this.getSubLayerClass("characters",tx),P=this.getSubLayerClass("background",nx);return[V&&new P({getFillColor:E,getLineColor:x,getLineWidth:C,borderRadius:M,padding:O,getPosition:d,getSize:y,getAngle:b,getPixelOffset:w,billboard:H,sizeScale:N,sizeUnits:j,sizeMinPixels:W,sizeMaxPixels:Y,transitions:z&&{getPosition:z.getPosition,getAngle:z.getAngle,getSize:z.getSize,getFillColor:z.getBackgroundColor,getLineColor:z.getBorderColor,getLineWidth:z.getBorderWidth,getPixelOffset:z.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:de.getPosition,getAngle:de.getAngle,getSize:de.getSize,getFillColor:de.getBackgroundColor,getLineColor:de.getBorderColor,getLineWidth:de.getBorderWidth,getPixelOffset:de.getPixelOffset,getBoundingRect:{getText:de.getText,getTextAnchor:de.getTextAnchor,getAlignmentBaseline:de.getAlignmentBaseline,styleVersion:l}}}),{data:u.attributes&&u.attributes.background?{length:u.length,attributes:u.attributes.background}:u,_dataDiff:h,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new xe({sdf:G.sdf,smoothing:Number.isFinite(G.smoothing)?G.smoothing:au.smoothing,outlineWidth:D/(G.radius||au.radius),outlineColor:I,iconAtlas:s,iconMapping:o,getPosition:d,getColor:g,getSize:y,getAngle:b,getPixelOffset:w,billboard:H,sizeScale:N*i,sizeUnits:j,sizeMinPixels:W*i,sizeMaxPixels:Y*i,transitions:z&&{getPosition:z.getPosition,getAngle:z.getAngle,getColor:z.getColor,getSize:z.getSize,getPixelOffset:z.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:de.getText,getPosition:de.getPosition,getAngle:de.getAngle,getColor:de.getColor,getSize:de.getSize,getPixelOffset:de.getPixelOffset,getIconOffsets:{getTextAnchor:de.getTextAnchor,getAlignmentBaseline:de.getAlignmentBaseline,styleVersion:l}}}),{data:u,_dataDiff:h,startIndices:e,numInstances:t,getIconOffsets:this.getIconOffsets,getIcon:r})]}static set fontAtlasCacheLimit(e){vae(e)}}rx.defaultProps=Sae;rx.layerName="TextLayer";const fm={circle:{type:QE,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:An,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:rx,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},dm={type:JE,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},LT={type:ex,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function lf({type:n,props:e}){const t={};for(const r in e)t[r]=n.defaultProps[e[r]];return t}function m0(n,e){const{transitions:t,updateTriggers:r}=n.props,i={updateTriggers:{},transitions:t&&{getPosition:t.geometry}};for(const s in e){const o=e[s];let l=n.props[s];s.startsWith("get")&&(l=n.getSubLayerAccessor(l),i.updateTriggers[o]=r[s],t&&(i.transitions[o]=t[s])),i[o]=l}return i}function Rae(n){if(Array.isArray(n))return n;switch(ot.assert(n.type,"GeoJSON does not have type"),n.type){case"Feature":return[n];case"FeatureCollection":return ot.assert(Array.isArray(n.features),"GeoJSON does not have features array"),n.features;default:return[{geometry:n}]}}function II(n,e,t={}){const r={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:i=0,endRow:s=n.length}=t;for(let o=i;o<s;o++){const l=n[o],{geometry:u}=l;if(u)if(u.type==="GeometryCollection"){ot.assert(Array.isArray(u.geometries),"GeoJSON does not have geometries array");const{geometries:h}=u;for(let d=0;d<h.length;d++){const g=h[d];PI(g,r,e,l,o)}}else PI(u,r,e,l,o)}return r}function PI(n,e,t,r,i){const{type:s,coordinates:o}=n,{pointFeatures:l,lineFeatures:u,polygonFeatures:h,polygonOutlineFeatures:d}=e;if(!Iae(s,o)){ot.warn(`${s} coordinates are malformed`)();return}switch(s){case"Point":l.push(t({geometry:n},r,i));break;case"MultiPoint":o.forEach(g=>{l.push(t({geometry:{type:"Point",coordinates:g}},r,i))});break;case"LineString":u.push(t({geometry:n},r,i));break;case"MultiLineString":o.forEach(g=>{u.push(t({geometry:{type:"LineString",coordinates:g}},r,i))});break;case"Polygon":h.push(t({geometry:n},r,i)),o.forEach(g=>{d.push(t({geometry:{type:"LineString",coordinates:g}},r,i))});break;case"MultiPolygon":o.forEach(g=>{h.push(t({geometry:{type:"Polygon",coordinates:g}},r,i)),g.forEach(y=>{d.push(t({geometry:{type:"LineString",coordinates:y}},r,i))})});break}}const Cae={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function Iae(n,e){let t=Cae[n];for(ot.assert(t,`Unknown GeoJSON type ${n}`);e&&--t>0;)e=e[0];return e&&Number.isFinite(e[0])}function iL(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function kg(n){return n.geometry.coordinates}function Pae(n,e){const t=iL(),{pointFeatures:r,lineFeatures:i,polygonFeatures:s,polygonOutlineFeatures:o}=n;return t.points.data=r,t.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),t.points.getPosition=kg,t.lines.data=i,t.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),t.lines.getPath=kg,t.polygons.data=s,t.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),t.polygons.getPolygon=kg,t.polygonsOutline.data=o,t.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),t.polygonsOutline.getPath=kg,t}function Mae(n,e){const t=iL(),{points:r,lines:i,polygons:s}=n,o=nae(n,e);return t.points.data={length:r.positions.value.length/r.positions.size,attributes:{...r.attributes,getPosition:r.positions,instancePickingColors:{size:4,value:o.points}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},t.lines.data={length:i.pathIndices.value.length-1,startIndices:i.pathIndices.value,attributes:{...i.attributes,getPath:i.positions,instancePickingColors:{size:4,value:o.lines}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},t.lines._pathType="open",t.polygons.data={length:s.polygonIndices.value.length-1,startIndices:s.polygonIndices.value,attributes:{...s.attributes,getPolygon:s.positions,pickingColors:{size:4,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},t.polygons._normalize=!1,s.triangles&&(t.polygons.data.attributes.indices=s.triangles.value),t.polygonsOutline.data={length:s.primitivePolygonIndices.value.length-1,startIndices:s.primitivePolygonIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:4,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},t.polygonsOutline._pathType="open",t}const Oae=["points","linestrings","polygons"],kae={...lf(fm.circle),...lf(fm.icon),...lf(fm.text),...lf(dm),...lf(LT),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:n=>n.properties.icon},getText:{type:"accessor",value:n=>n.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class ix extends K_{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:t}){if(!t.dataChanged)return;const{data:r}=this.props,i=r&&"points"in r&&"polygons"in r&&"lines"in r;this.setState({binary:i}),i?this._updateStateBinary({props:e,changeFlags:t}):this._updateStateJSON({props:e,changeFlags:t})}_updateStateBinary({props:e,changeFlags:t}){const r=Mae(e.data,this.encodePickingColor);this.setState({layerProps:r})}_updateStateJSON({props:e,changeFlags:t}){const r=Rae(e.data),i=this.getSubLayerRow.bind(this);let s={};const o={};if(Array.isArray(t.dataChanged)){const u=this.state.features;for(const h in u)s[h]=u[h].slice(),o[h]=[];for(const h of t.dataChanged){const d=II(r,i,h);for(const g in u)o[g].push(Joe({data:s[g],getIndex:y=>y.__source.index,dataRange:h,replace:d[g]}))}}else s=II(r,i);const l=Pae(s,o);this.setState({features:s,featuresDiff:o,layerProps:l})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:r,sourceLayer:i}=t;return t.featureType=Oae.find(s=>i.id.startsWith(`${this.id}-${s}-`)),r>=0&&i.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(t.index=this.props.data.points.globalFeatureIds.value[r]),t}_updateAutoHighlight(e){const t=`${this.id}-points-`,r=e.featureType==="points";for(const i of this.getSubLayers())i.id.startsWith(t)===r&&i.updateAutoHighlight(e)}_renderPolygonLayer(){const{extruded:e,wireframe:t}=this.props,{layerProps:r}=this.state,i="polygons-fill",s=this.shouldRenderSubLayer(i,r.polygons?.data)&&this.getSubLayerClass(i,LT.type);if(s){const o=m0(this,LT.props),l=e&&t;return l||delete o.getLineColor,o.updateTriggers.lineColors=l,new s(o,this.getSubLayerProps({id:i,updateTriggers:o.updateTriggers}),r.polygons)}return null}_renderLineLayers(){const{extruded:e,stroked:t}=this.props,{layerProps:r}=this.state,i="polygons-stroke",s="linestrings",o=!e&&t&&this.shouldRenderSubLayer(i,r.polygonsOutline?.data)&&this.getSubLayerClass(i,dm.type),l=this.shouldRenderSubLayer(s,r.lines?.data)&&this.getSubLayerClass(s,dm.type);if(o||l){const u=m0(this,dm.props);return[o&&new o(u,this.getSubLayerProps({id:i,updateTriggers:u.updateTriggers}),r.polygonsOutline),l&&new l(u,this.getSubLayerProps({id:s,updateTriggers:u.updateTriggers}),r.lines)]}return null}_renderPointLayers(){const{pointType:e}=this.props,{layerProps:t,binary:r}=this.state;let{highlightedObjectIndex:i}=this.props;!r&&Number.isFinite(i)&&(i=t.points.data.findIndex(l=>l.__source.index===i));const s=new Set(e.split("+")),o=[];for(const l of s){const u=`points-${l}`,h=fm[l],d=h&&this.shouldRenderSubLayer(u,t.points?.data)&&this.getSubLayerClass(u,h.type);if(d){const g=m0(this,h.props);let y=t.points;if(l==="text"&&r){const{instancePickingColors:b,...w}=y.data.attributes;y={...y,data:{...y.data,attributes:w}}}o.push(new d(g,this.getSubLayerProps({id:u,updateTriggers:g.updateTriggers,highlightedObjectIndex:i}),y))}}return o}renderLayers(){const{extruded:e}=this.props,t=this._renderPolygonLayer(),r=this._renderLineLayers(),i=this._renderPointLayers();return[!e&&t,r,i,e&&t]}getSubLayerAccessor(e){const{binary:t}=this.state;return!t||typeof e!="function"?super.getSubLayerAccessor(e):(r,i)=>{const{data:s,index:o}=i,l=eae(s,o);return e(l,i)}}}ix.layerName="GeoJsonLayer";ix.defaultProps=kae;class Nae{constructor(e){this.index=e,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(e){this._bbox||(this._bbox=e,"west"in e?this.boundingBox=[[e.west,e.south],[e.east,e.north]]:this.boundingBox=[[e.left,e.top],[e.right,e.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return!!this._loader&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const e=this.content?this.content.byteLength:0;return Number.isFinite(e)||console.error("byteLength not defined in tile data"),e}async _loadData({getData:e,requestScheduler:t,onLoad:r,onError:i}){const{index:s,id:o,bbox:l,userData:u,zoom:h}=this,d=this._loaderId;this._abortController=new AbortController;const{signal:g}=this._abortController,y=await t.scheduleRequest(this,E=>E.isSelected?1:-1);if(!y){this._isCancelled=!0;return}if(this._isCancelled){y.done();return}let b=null,w;try{b=await e({index:s,id:o,bbox:l,userData:u,zoom:h,signal:g})}catch(E){w=E||!0}finally{y.done()}if(d===this._loaderId){if(this._loader=void 0,this.content=b,this._isCancelled&&!b){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,w?i(w,this):r(this)}}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){this.isLoaded||(this._isCancelled=!0,this._abortController?.abort())}}const Xn={OUTSIDE:-1,INTERSECTING:0,INSIDE:1},MI=new Pe,Dae=new Pe;class sx{constructor(e=[0,0,0],t=[0,0,0],r){r=r||MI.copy(e).add(t).scale(.5),this.center=new Pe(r),this.halfDiagonal=new Pe(t).subtract(this.center),this.minimum=new Pe(e),this.maximum=new Pe(t)}clone(){return new sx(this.minimum,this.maximum,this.center)}equals(e){return this===e||!!e&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){const{halfDiagonal:t}=this,r=Dae.from(e.normal),i=t.x*Math.abs(r.x)+t.y*Math.abs(r.y)+t.z*Math.abs(r.z),s=this.center.dot(r)+e.distance;return s-i>0?Xn.INSIDE:s+i<0?Xn.OUTSIDE:Xn.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=MI.from(e).subtract(this.center),{halfDiagonal:r}=this;let i=0,s;return s=Math.abs(t.x)-r.x,s>0&&(i+=s*s),s=Math.abs(t.y)-r.y,s>0&&(i+=s*s),s=Math.abs(t.z)-r.z,s>0&&(i+=s*s),i}}const cf=new Pe,OI=new Pe;class ox{constructor(e=[0,0,0],t=0){this.radius=-0,this.center=new Pe,this.fromCenterRadius(e,t)}fromCenterRadius(e,t){return this.center.from(e),this.radius=t,this}fromCornerPoints(e,t){return t=cf.from(t),this.center=new Pe().from(e).add(t).scale(.5),this.radius=this.center.distance(t),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new ox(this.center,this.radius)}union(e){const t=this.center,r=this.radius,i=e.center,s=e.radius,o=cf.copy(i).subtract(t),l=o.magnitude();if(r>=l+s)return this.clone();if(s>=l+r)return e.clone();const u=(r+l+s)*.5;return OI.copy(o).scale((-r+u)/l).add(t),this.center.copy(OI),this.radius=u,this}expand(e){const r=cf.from(e).subtract(this.center).magnitude();return r>this.radius&&(this.radius=r),this}transform(e){this.center.transform(e);const t=UZ(cf,e);return this.radius=Math.max(t[0],Math.max(t[1],t[2]))*this.radius,this}distanceSquaredTo(e){const t=this.distanceTo(e);return t*t}distanceTo(e){const r=cf.from(e).subtract(this.center);return Math.max(0,r.len()-this.radius)}intersectPlane(e){const t=this.center,r=this.radius,s=e.normal.dot(t)+e.distance;return s<-r?Xn.OUTSIDE:s<r?Xn.INTERSECTING:Xn.INSIDE}}const Lae=new Pe,Uae=new Pe,Ng=new Pe,Dg=new Pe,Lg=new Pe,Fae=new Pe,Bae=new Pe,xs={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class ax{constructor(e=[0,0,0],t=[0,0,0,0,0,0,0,0,0]){this.center=new Pe().from(e),this.halfAxes=new Nn(t)}get halfSize(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2);return[new Pe(e).len(),new Pe(t).len(),new Pe(r).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2),i=new Pe(e).normalize(),s=new Pe(t).normalize(),o=new Pe(r).normalize();return new HR().fromMatrix3(new Nn([...i,...s,...o]))}fromCenterHalfSizeQuaternion(e,t,r){const i=new HR(r),s=new Nn().fromQuaternion(i);return s[0]=s[0]*t[0],s[1]=s[1]*t[0],s[2]=s[2]*t[0],s[3]=s[3]*t[1],s[4]=s[4]*t[1],s[5]=s[5]*t[1],s[6]=s[6]*t[2],s[7]=s[7]*t[2],s[8]=s[8]*t[2],this.center=new Pe().from(e),this.halfAxes=s,this}clone(){return new ax(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new ox){const t=this.halfAxes,r=t.getColumn(0,Ng),i=t.getColumn(1,Dg),s=t.getColumn(2,Lg),o=Lae.copy(r).add(i).add(s);return e.center.copy(this.center),e.radius=o.magnitude(),e}intersectPlane(e){const t=this.center,r=e.normal,i=this.halfAxes,s=r.x,o=r.y,l=r.z,u=Math.abs(s*i[xs.COLUMN0ROW0]+o*i[xs.COLUMN0ROW1]+l*i[xs.COLUMN0ROW2])+Math.abs(s*i[xs.COLUMN1ROW0]+o*i[xs.COLUMN1ROW1]+l*i[xs.COLUMN1ROW2])+Math.abs(s*i[xs.COLUMN2ROW0]+o*i[xs.COLUMN2ROW1]+l*i[xs.COLUMN2ROW2]),h=r.dot(t)+e.distance;return h<=-u?Xn.OUTSIDE:h>=u?Xn.INSIDE:Xn.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=Uae.from(e).subtract(this.center),r=this.halfAxes,i=r.getColumn(0,Ng),s=r.getColumn(1,Dg),o=r.getColumn(2,Lg),l=i.magnitude(),u=s.magnitude(),h=o.magnitude();i.normalize(),s.normalize(),o.normalize();let d=0,g;return g=Math.abs(t.dot(i))-l,g>0&&(d+=g*g),g=Math.abs(t.dot(s))-u,g>0&&(d+=g*g),g=Math.abs(t.dot(o))-h,g>0&&(d+=g*g),d}computePlaneDistances(e,t,r=[-0,-0]){let i=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;const o=this.center,l=this.halfAxes,u=l.getColumn(0,Ng),h=l.getColumn(1,Dg),d=l.getColumn(2,Lg),g=Fae.copy(u).add(h).add(d).add(o),y=Bae.copy(g).subtract(e);let b=t.dot(y);return i=Math.min(b,i),s=Math.max(b,s),g.copy(o).add(u).add(h).subtract(d),y.copy(g).subtract(e),b=t.dot(y),i=Math.min(b,i),s=Math.max(b,s),g.copy(o).add(u).subtract(h).add(d),y.copy(g).subtract(e),b=t.dot(y),i=Math.min(b,i),s=Math.max(b,s),g.copy(o).add(u).subtract(h).subtract(d),y.copy(g).subtract(e),b=t.dot(y),i=Math.min(b,i),s=Math.max(b,s),o.copy(g).subtract(u).add(h).add(d),y.copy(g).subtract(e),b=t.dot(y),i=Math.min(b,i),s=Math.max(b,s),o.copy(g).subtract(u).add(h).subtract(d),y.copy(g).subtract(e),b=t.dot(y),i=Math.min(b,i),s=Math.max(b,s),o.copy(g).subtract(u).subtract(h).add(d),y.copy(g).subtract(e),b=t.dot(y),i=Math.min(b,i),s=Math.max(b,s),o.copy(g).subtract(u).subtract(h).subtract(d),y.copy(g).subtract(e),b=t.dot(y),i=Math.min(b,i),s=Math.max(b,s),r[0]=i,r[1]=s,r}transform(e){this.center.transformAsPoint(e);const t=this.halfAxes.getColumn(0,Ng);t.transformAsPoint(e);const r=this.halfAxes.getColumn(1,Dg);r.transformAsPoint(e);const i=this.halfAxes.getColumn(2,Lg);return i.transformAsPoint(e),this.halfAxes=new Nn([...t,...r,...i]),this}getTransform(){throw new Error("not implemented")}}const kI=new Pe,NI=new Pe;class ad{constructor(e=[0,0,1],t=0){this.normal=new Pe,this.distance=-0,this.fromNormalDistance(e,t)}fromNormalDistance(e,t){return nd(Number.isFinite(t)),this.normal.from(e).normalize(),this.distance=t,this}fromPointNormal(e,t){e=kI.from(e),this.normal.from(t).normalize();const r=-this.normal.dot(e);return this.distance=r,this}fromCoefficients(e,t,r,i){return this.normal.set(e,t,r),nd(Ns(this.normal.len(),1)),this.distance=i,this}clone(){return new ad(this.normal,this.distance)}equals(e){return Ns(this.distance,e.distance)&&Ns(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const t=NI.copy(this.normal).transformAsVector(e).normalize(),r=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(r,t)}projectPointOntoPlane(e,t=[0,0,0]){const r=kI.from(e),i=this.getPointDistance(r),s=NI.copy(this.normal).scale(i);return r.subtract(s).to(t)}}const DI=[new Pe([1,0,0]),new Pe([0,1,0]),new Pe([0,0,1])],LI=new Pe,Vae=new Pe;class Ps{constructor(e=[]){this.planes=e}fromBoundingSphere(e){this.planes.length=2*DI.length;const t=e.center,r=e.radius;let i=0;for(const s of DI){let o=this.planes[i],l=this.planes[i+1];o||(o=this.planes[i]=new ad),l||(l=this.planes[i+1]=new ad);const u=LI.copy(s).scale(-r).add(t);o.fromPointNormal(u,s);const h=LI.copy(s).scale(r).add(t),d=Vae.copy(s).negate();l.fromPointNormal(h,d),i+=2}return this}computeVisibility(e){let t=Xn.INSIDE;for(const r of this.planes)switch(e.intersectPlane(r)){case Xn.OUTSIDE:return Xn.OUTSIDE;case Xn.INTERSECTING:t=Xn.INTERSECTING;break}return t}computeVisibilityWithPlaneMask(e,t){if(nd(Number.isFinite(t),"parentPlaneMask is required."),t===Ps.MASK_OUTSIDE||t===Ps.MASK_INSIDE)return t;let r=Ps.MASK_INSIDE;const i=this.planes;for(let s=0;s<this.planes.length;++s){const o=s<31?1<<s:0;if(s<31&&(t&o)===0)continue;const l=i[s],u=e.intersectPlane(l);if(u===Xn.OUTSIDE)return Ps.MASK_OUTSIDE;u===Xn.INTERSECTING&&(r|=o)}return r}}Ps.MASK_OUTSIDE=4294967295;Ps.MASK_INSIDE=0;Ps.MASK_INDETERMINATE=2147483647;new Pe;new Pe;new Pe;new Pe;new Pe;new Pe;new Pe;new Pe;new Pe;new Pe;new Pe;new Pe;new Pe;new Pe;new Pe;new Pe;new Pe;const Ni=new Nn,zae=new Nn,jae=new Nn,Ug=new Nn,UI=new Nn;function Hae(n,e={}){const t=TQ,r=10;let i=0,s=0;const o=zae,l=jae;o.identity(),l.copy(n);const u=t*$ae(l);for(;s<r&&Wae(l)>u;)qae(l,Ug),UI.copy(Ug).transpose(),l.multiplyRight(Ug),l.multiplyLeft(UI),o.multiplyRight(Ug),++i>2&&(++s,i=0);return e.unitary=o.toTarget(e.unitary),e.diagonal=l.toTarget(e.diagonal),e}function $ae(n){let e=0;for(let t=0;t<9;++t){const r=n[t];e+=r*r}return Math.sqrt(e)}const UT=[1,0,0],FT=[2,2,1];function Wae(n){let e=0;for(let t=0;t<3;++t){const r=n[Ni.getElementIndex(FT[t],UT[t])];e+=2*r*r}return Math.sqrt(e)}function qae(n,e){const t=bQ;let r=0,i=1;for(let h=0;h<3;++h){const d=Math.abs(n[Ni.getElementIndex(FT[h],UT[h])]);d>r&&(i=h,r=d)}const s=UT[i],o=FT[i];let l=1,u=0;if(Math.abs(n[Ni.getElementIndex(o,s)])>t){const h=n[Ni.getElementIndex(o,o)],d=n[Ni.getElementIndex(s,s)],g=n[Ni.getElementIndex(o,s)],y=(h-d)/2/g;let b;y<0?b=-1/(-y+Math.sqrt(1+y*y)):b=1/(y+Math.sqrt(1+y*y)),l=1/Math.sqrt(1+b*b),u=b*l}return Nn.IDENTITY.to(e),e[Ni.getElementIndex(s,s)]=e[Ni.getElementIndex(o,o)]=l,e[Ni.getElementIndex(o,s)]=u,e[Ni.getElementIndex(s,o)]=-u,e}const Bo=new Pe,Xae=new Pe,Yae=new Pe,Kae=new Pe,Gae=new Pe,Zae=new Nn,Qae={diagonal:new Nn,unitary:new Nn};function Jae(n,e=new ax){if(!n||n.length===0)return e.halfAxes=new Nn([0,0,0,0,0,0,0,0,0]),e.center=new Pe,e;const t=n.length,r=new Pe(0,0,0);for(const N of n)r.add(N);const i=1/t;r.multiplyByScalar(i);let s=0,o=0,l=0,u=0,h=0,d=0;for(const N of n){const j=Bo.copy(N).subtract(r);s+=j.x*j.x,o+=j.x*j.y,l+=j.x*j.z,u+=j.y*j.y,h+=j.y*j.z,d+=j.z*j.z}s*=i,o*=i,l*=i,u*=i,h*=i,d*=i;const g=Zae;g[0]=s,g[1]=o,g[2]=l,g[3]=o,g[4]=u,g[5]=h,g[6]=l,g[7]=h,g[8]=d;const{unitary:y}=Hae(g,Qae),b=e.halfAxes.copy(y);let w=b.getColumn(0,Yae),E=b.getColumn(1,Kae),x=b.getColumn(2,Gae),C=-Number.MAX_VALUE,M=-Number.MAX_VALUE,O=-Number.MAX_VALUE,V=Number.MAX_VALUE,H=Number.MAX_VALUE,G=Number.MAX_VALUE;for(const N of n)Bo.copy(N),C=Math.max(Bo.dot(w),C),M=Math.max(Bo.dot(E),M),O=Math.max(Bo.dot(x),O),V=Math.min(Bo.dot(w),V),H=Math.min(Bo.dot(E),H),G=Math.min(Bo.dot(x),G);w=w.multiplyByScalar(.5*(V+C)),E=E.multiplyByScalar(.5*(H+M)),x=x.multiplyByScalar(.5*(G+O)),e.center.copy(w).add(E).add(x);const D=Xae.set(C-V,M-H,O-G).multiplyByScalar(.5),I=new Nn([D[0],0,0,0,D[1],0,0,0,D[2]]);return e.halfAxes.multiplyRight(I),e}const Zc=512,FI=3,sL=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],oL=sL.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),ele=oL.concat([[.25,.5],[.75,.5]]);class Qc{constructor(e,t,r){this.x=e,this.y=t,this.z=r}get children(){if(!this._children){const e=this.x*2,t=this.y*2,r=this.z+1;this._children=[new Qc(e,t,r),new Qc(e,t+1,r),new Qc(e+1,t,r),new Qc(e+1,t+1,r)]}return this._children}update(e){const{viewport:t,cullingVolume:r,elevationBounds:i,minZ:s,maxZ:o,bounds:l,offset:u,project:h}=e,d=this.getBoundingVolume(i,u,h);if(l&&!this.insideBounds(l)||r.computeVisibility(d)<0)return!1;if(!this.childVisible){let{z:y}=this;if(y<o&&y>=s){const b=d.distanceTo(t.cameraPosition)*t.scale/t.height;y+=Math.floor(Math.log2(b))}if(y>=o)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const y of this.children)y.update(e);return!0}getSelected(e=[]){if(this.selected&&e.push(this),this._children)for(const t of this._children)t.getSelected(e);return e}insideBounds([e,t,r,i]){const s=Math.pow(2,this.z),o=Zc/s;return this.x*o<r&&this.y*o<i&&(this.x+1)*o>e&&(this.y+1)*o>t}getBoundingVolume(e,t,r){if(r){const u=this.z<1?ele:this.z<2?oL:sL,h=[];for(const d of u){const g=VT(this.x+d[0],this.y+d[1],this.z);g[2]=e[0],h.push(r(g)),e[0]!==e[1]&&(g[2]=e[1],h.push(r(g)))}return Jae(h)}const i=Math.pow(2,this.z),s=Zc/i,o=this.x*s+t*Zc,l=Zc-(this.y+1)*s;return new sx([o,l,e[0]],[o+s,l+s,e[1]])}}function tle(n,e,t,r){const i=n instanceof Cse&&n.resolution?n.projectPosition:null,s=Object.values(n.getFrustumPlanes()).map(({normal:b,distance:w})=>new ad(b.clone().negate(),w)),o=new Ps(s),l=n.distanceScales.unitsPerMeter[2],u=t&&t[0]*l||0,h=t&&t[1]*l||0,d=n instanceof Ws&&n.pitch<=60?e:0;if(r){const[b,w,E,x]=r,C=ma([b,x]),M=ma([E,w]);r=[C[0],Zc-C[1],M[0],Zc-M[1]]}const g=new Qc(0,0,0),y={viewport:n,project:i,cullingVolume:o,elevationBounds:[u,h],minZ:d,maxZ:e,bounds:r,offset:0};if(g.update(y),n instanceof Ws&&n.subViewports&&n.subViewports.length>1){for(y.offset=-1;g.update(y)&&!(--y.offset<-FI););for(y.offset=1;g.update(y)&&!(++y.offset>FI););}return g.getSelected()}const qs=512,nle=[-1/0,-1/0,1/0,1/0],rle={equal:(n,e)=>{if(n===e)return!0;if(!Array.isArray(n)||!Array.isArray(e))return!1;const t=n.length;if(t!==e.length)return!1;for(let r=0;r<t;r++)if(n[r]!==e[r])return!1;return!0}};function aL(n,e){const t=[e.transformAsPoint([n[0],n[1]]),e.transformAsPoint([n[2],n[1]]),e.transformAsPoint([n[0],n[3]]),e.transformAsPoint([n[2],n[3]])];return[Math.min(...t.map(i=>i[0])),Math.min(...t.map(i=>i[1])),Math.max(...t.map(i=>i[0])),Math.max(...t.map(i=>i[1]))]}function ile(n){return Math.abs(n.split("").reduce((e,t)=>(e<<5)-e+t.charCodeAt(0)|0,0))}function sle(n,e){if(!n||!n.length)return null;const{index:t,id:r}=e;if(Array.isArray(n)){const s=ile(r)%n.length;n=n[s]}let i=n;for(const s of Object.keys(t)){const o=new RegExp(`{${s}}`,"g");i=i.replace(o,String(t[s]))}return Number.isInteger(t.y)&&Number.isInteger(t.z)&&(i=i.replace(/\{-y\}/g,String(Math.pow(2,t.z)-t.y-1))),i}function ole(n,e,t){let r;return r=n.getBounds(),n.isGeospatial?[Math.max(r[0],t[0]),Math.max(r[1],t[1]),Math.min(r[2],t[2]),Math.min(r[3],t[3])]:[Math.max(Math.min(r[0],t[2]),t[0]),Math.max(Math.min(r[1],t[3]),t[1]),Math.min(Math.max(r[2],t[0]),t[2]),Math.min(Math.max(r[3],t[1]),t[3])]}function ale({viewport:n,z:e,cullRect:t}){return(n.subViewports||[n]).map(i=>BT(i,e||0,t))}function BT(n,e,t){if(!Array.isArray(e)){const s=t.x-n.x,o=t.y-n.y,{width:l,height:u}=t,h={targetZ:e},d=n.unproject([s,o],h),g=n.unproject([s+l,o],h),y=n.unproject([s,o+u],h),b=n.unproject([s+l,o+u],h);return[Math.min(d[0],g[0],y[0],b[0]),Math.min(d[1],g[1],y[1],b[1]),Math.max(d[0],g[0],y[0],b[0]),Math.max(d[1],g[1],y[1],b[1])]}const r=BT(n,e[0],t),i=BT(n,e[1],t);return[Math.min(r[0],i[0]),Math.min(r[1],i[1]),Math.max(r[2],i[2]),Math.max(r[3],i[3])]}function lle(n,e,t){return t?aL(n,t).map(i=>i*e/qs):n.map(r=>r*e/qs)}function lx(n,e){return Math.pow(2,n)*qs/e}function VT(n,e,t){const r=lx(t,qs),i=n/r*360-180,s=Math.PI-2*Math.PI*e/r,o=180/Math.PI*Math.atan(.5*(Math.exp(s)-Math.exp(-s)));return[i,o]}function BI(n,e,t,r){const i=lx(t,r);return[n/i*qs,e/i*qs]}function cle(n,e,t,r,i=qs){if(n.isGeospatial){const[h,d]=VT(e,t,r),[g,y]=VT(e+1,t+1,r);return{west:h,north:d,east:g,south:y}}const[s,o]=BI(e,t,r,i),[l,u]=BI(e+1,t+1,r,i);return{left:s,top:o,right:l,bottom:u}}function ule(n,e,t,r,i){const s=ole(n,null,r),o=lx(e,t),[l,u,h,d]=lle(s,o,i),g=[];for(let y=Math.floor(l);y<h;y++)for(let b=Math.floor(u);b<d;b++)g.push({x:y,y:b,z:e});return g}function hle({viewport:n,maxZoom:e,minZoom:t,zRange:r,extent:i,tileSize:s=qs,modelMatrix:o,modelMatrixInverse:l,zoomOffset:u=0}){let h=n.isGeospatial?Math.round(n.zoom+Math.log2(qs/s))+u:Math.ceil(n.zoom)+u;if(typeof t=="number"&&Number.isFinite(t)&&h<t){if(!i)return[];h=t}typeof e=="number"&&Number.isFinite(e)&&h>e&&(h=e);let d=i;return o&&l&&i&&!n.isGeospatial&&(d=aL(i,o)),n.isGeospatial?tle(n,h,r,i):ule(n,h,s,d||nle,l)}function fle(n){let e={},t;return r=>{for(const i in r)if(!dle(r[i],e[i])){t=n(r),e=r;break}return t}}function dle(n,e){if(n===e)return!0;if(Array.isArray(n)){const t=n.length;if(!e||e.length!==t)return!1;for(let r=0;r<t;r++)if(n[r]!==e[r])return!1;return!0}return!1}const VI=1,Z_=2,ple="never",gle="no-overlap",cx="best-available",mle=5,_le={[cx]:ble,[gle]:Tle,[ple]:()=>{}},yle={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}};class vle{constructor(e){this._getCullBounds=fle(ale),this.opts={...yle,...e},this.setOptions(this.opts),this.onTileLoad=t=>{this.opts.onTileLoad?.(t),this.opts.maxCacheByteSize!==null&&(this._cacheByteSize+=t.byteLength,this._resizeCache())},this._requestScheduler=new oX({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new rr,this._modelMatrixInverse=new rr}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(e=>e.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(e=>e.needsReload)}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(const e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const e of this._cache.keys()){const t=this._cache.get(e);!this._selectedTiles||!this._selectedTiles.includes(t)?this._cache.delete(e):t.setNeedsReload()}}update(e,{zRange:t,modelMatrix:r}={zRange:null,modelMatrix:null}){const i=r?new rr(r):new rr,s=!i.equals(this._modelMatrix);if(!this._viewport||!e.equals(this._viewport)||!Ns(this._zRange,t)||s){s&&(this._modelMatrixInverse=i.clone().invert(),this._modelMatrix=i),this._viewport=e,this._zRange=t;const l=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:t,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=l.map(u=>this._getTile(u,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(l=>this._getTile(l.index,!0)));const o=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),o&&this._frameNumber++,this._frameNumber}isTileVisible(e,t){if(!e.isVisible)return!1;if(t&&this._viewport){const r=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:t}),{bbox:i}=e;for(const[s,o,l,u]of r){let h;if("west"in i)h=i.west<l&&i.east>s&&i.south<u&&i.north>o;else{const d=Math.min(i.top,i.bottom),g=Math.max(i.top,i.bottom);h=i.left<l&&i.right>s&&d<u&&g>o}if(h)return!0}return!1}return!0}getTileIndices({viewport:e,maxZoom:t,minZoom:r,zRange:i,modelMatrix:s,modelMatrixInverse:o}){const{tileSize:l,extent:u,zoomOffset:h}=this.opts;return hle({viewport:e,maxZoom:t,minZoom:r,zRange:i,tileSize:l,extent:u,modelMatrix:s,modelMatrixInverse:o,zoomOffset:h})}getTileId(e){return`${e.x}-${e.y}-${e.z}`}getTileZoom(e){return e.z}getTileMetadata(e){const{tileSize:t}=this.opts;return{bbox:cle(this._viewport,e.x,e.y,e.z,t)}}getParentIndex(e){const t=Math.floor(e.x/2),r=Math.floor(e.y/2),i=e.z-1;return{x:t,y:r,z:i}}updateTileStates(){const e=this.opts.refinementStrategy||cx,t=new Array(this._cache.size);let r=0;for(const i of this._cache.values())t[r++]=i.isVisible,i.isSelected=!1,i.isVisible=!1;for(const i of this._selectedTiles)i.isSelected=!0,i.isVisible=!0;(typeof e=="function"?e:_le[e])(Array.from(this._cache.values())),r=0;for(const i of this._cache.values())if(t[r++]!==i.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:e=0}=this.opts,t=[];let r=0;for(const i of this._cache.values())i.isLoading&&(r++,!i.isSelected&&!i.isVisible&&t.push(i));for(;e>0&&r>e&&t.length>0;)t.shift().abort(),r--}_rebuildTree(){const{_cache:e}=this;for(const t of e.values())t.parent=null,t.children&&(t.children.length=0);for(const t of e.values()){const r=this._getNearestAncestor(t);t.parent=r,r?.children&&r.children.push(t)}}_resizeCache(){const{_cache:e,opts:t}=this,r=t.maxCacheSize??(t.maxCacheByteSize!==null?1/0:mle*this.selectedTiles.length),i=t.maxCacheByteSize??1/0;if(e.size>r||this._cacheByteSize>i){for(const[o,l]of e)if(!l.isVisible&&!l.isSelected&&(this._cacheByteSize-=t.maxCacheByteSize!==null?l.byteLength:0,e.delete(o),this.opts.onTileUnload?.(l)),e.size<=r&&this._cacheByteSize<=i)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((o,l)=>o.zoom-l.zoom),this._dirty=!1)}_getTile(e,t){const r=this.getTileId(e);let i=this._cache.get(r),s=!1;return!i&&t?(i=new Nae(e),Object.assign(i,this.getTileMetadata(i.index)),Object.assign(i,{id:r,zoom:this.getTileZoom(i.index)}),s=!0,this._cache.set(r,i),this._dirty=!0):i&&i.needsReload&&(s=!0),i&&s&&i.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),i}_getNearestAncestor(e){const{_minZoom:t=0}=this;let r=e.index;for(;this.getTileZoom(r)>t;){r=this.getParentIndex(r);const i=this._getTile(r);if(i)return i}return null}}function ble(n){for(const e of n)e.state=0;for(const e of n)e.isSelected&&!lL(e)&&ux(e);for(const e of n)e.isVisible=!!(e.state&Z_)}function Tle(n){for(const t of n)t.state=0;for(const t of n)t.isSelected&&lL(t);const e=Array.from(n).sort((t,r)=>t.zoom-r.zoom);for(const t of e)if(t.isVisible=!!(t.state&Z_),t.children&&(t.isVisible||t.state&VI))for(const r of t.children)r.state=VI;else t.isSelected&&ux(t)}function lL(n){let e=n;for(;e;){if(e.isLoaded||e.content)return e.state|=Z_,!0;e=e.parent}return!1}function ux(n){for(const e of n.children)e.isLoaded||e.content?e.state|=Z_:ux(e)}const wle={TilesetClass:vle,data:{type:"data",value:[]},dataComparator:rle.equal,renderSubLayers:{type:"function",value:n=>new ix(n)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:n=>{}},onTileUnload:{type:"function",value:n=>{}},onTileError:{type:"function",value:n=>console.error(n)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:cx,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0};class hx extends K_{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){this.state?.tileset?.finalize()}get isLoaded(){return!!this.state?.tileset?.selectedTiles?.every(e=>e.isLoaded&&e.layers&&e.layers.every(t=>t.isLoaded))}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({changeFlags:e}){let{tileset:t}=this.state;const r=e.propsOrDataChanged||e.updateTriggersChanged,i=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getTileData);t?r&&(t.setOptions(this._getTilesetOptions()),i?t.reloadAll():t.tiles.forEach(s=>{s.layers=null})):(t=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:t})),this._updateTileset()}_getTilesetOptions(){const{tileSize:e,maxCacheSize:t,maxCacheByteSize:r,refinementStrategy:i,extent:s,maxZoom:o,minZoom:l,maxRequests:u,debounceTime:h,zoomOffset:d}=this.props;return{maxCacheSize:t,maxCacheByteSize:r,maxZoom:o,minZoom:l,tileSize:e,refinementStrategy:i,extent:s,maxRequests:u,debounceTime:h,zoomOffset:d,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const e=this.state.tileset,{zRange:t,modelMatrix:r}=this.props,i=e.update(this.context.viewport,{zRange:t,modelMatrix:r}),{isLoaded:s}=e,o=this.state.isLoaded!==s,l=this.state.frameNumber!==i;s&&(o||l)&&this._onViewportLoad(),l&&this.setState({frameNumber:i}),this.state.isLoaded=s}_onViewportLoad(){const{tileset:e}=this.state,{onViewportLoad:t}=this.props;t&&t(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,this.setNeedsUpdate()}_onTileError(e,t){this.props.onTileError(e),t.layers=null,this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){const{data:t,getTileData:r,fetch:i}=this.props,{signal:s}=e;return e.url=typeof t=="string"||Array.isArray(t)?sle(t,e):null,r?r(e):i&&e.url?i(e.url,{propName:"data",layer:this,signal:s}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo(e){const t=e.sourceLayer,r=t.props.tile,i=e.info;return i.picked&&(i.tile=r),i.sourceTile=r,i.sourceTileSubLayer=t,i}_updateAutoHighlight(e){e.sourceTileSubLayer.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map(e=>{const t=this.getSubLayerPropsByTile(e);if(!(!e.isLoaded&&!e.content))if(e.layers)t&&e.layers[0]&&Object.keys(t).some(r=>e.layers[0].props[r]!==t[r])&&(e.layers=e.layers.map(r=>r.clone(t)));else{const r=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:e.id,updateTriggers:this.props.updateTriggers}),data:e.content,_offset:0,tile:e});e.layers=W_(r,Boolean).map(i=>i.clone({tile:e,...t}))}return e.layers})}filterSubLayer({layer:e,cullRect:t}){const{tile:r}=e.props;return this.state.tileset.isTileVisible(r,t)}}hx.defaultProps=wle;hx.layerName="TileLayer";const Ele=({visible:n=!0}={})=>new hx({id:"osm-layer",data:["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],maxRequests:20,pickable:!1,minZoom:0,maxZoom:19,tileSize:256,zoomOffset:devicePixelRatio===1?-1:0,visible:n,renderSubLayers:e=>{const[[t,r],[i,s]]=e.tile.boundingBox,{data:o,...l}=e;return new ZE({...l,image:o,bounds:[t,r,i,s]})}});localStorage.getItem("api_url")||localStorage.setItem("api_url","http://192.168.0.137:5000");const fr=localStorage.getItem("api_url")||"http://192.168.0.137:5000";function xle({visible:n=!0,viewportBounds:e}={}){const[t,r]=R.useState([]),i=R.useRef(null),s=R.useRef(e),o=R.useCallback(l=>{const u=new URLSearchParams({minLat:l.minLat.toString(),maxLat:l.maxLat.toString(),minLon:l.minLon.toString(),maxLon:l.maxLon.toString(),vesselTypes:"20,21,22,23,24,25,26,27,28,29"});fetch(`${fr}/v1/vessels/position/all?${u}`).then(h=>{if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);return h.json()}).then(h=>r(h)).catch(h=>console.error("Error fetching WIGVessels:",h))},[]);return s.current=e,R.useEffect(()=>{if(!(!n||!e))return i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{s.current&&o(s.current)},500),()=>{i.current&&clearTimeout(i.current)}},[n,e,o]),R.useEffect(()=>{if(!n||!e)return;const l=setInterval(()=>{s.current&&o(s.current)},3e4);return()=>clearInterval(l)},[n,o]),new An({id:"wig-vessel-layer",data:t,visible:n,pickable:!0,getPosition:l=>[l.longitude,l.latitude],getIcon:()=>({url:"/Ship-Icon.png",height:1024,width:720}),getAngle:l=>l.TrueHeading==511?0:360-(l.TrueHeading||0),getSize:40})}function Ale({visible:n=!0,viewportBounds:e}={}){const[t,r]=R.useState([]),i=R.useRef(null),s=R.useRef(e),o=R.useCallback(l=>{const u=new URLSearchParams({minLat:l.minLat.toString(),maxLat:l.maxLat.toString(),minLon:l.minLon.toString(),maxLon:l.maxLon.toString(),vesselTypes:"30"});fetch(`${fr}/v1/vessels/position/all?${u}`).then(h=>{if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);return h.json()}).then(h=>r(h)).catch(h=>console.error("Error fetching Fishing Vessels:",h))},[]);return s.current=e,R.useEffect(()=>{if(!(!n||!e))return i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{s.current&&o(s.current)},250),()=>{i.current&&clearTimeout(i.current)}},[n,e,o]),R.useEffect(()=>{if(!n||!e)return;const l=setInterval(()=>{s.current&&o(s.current)},3e4);return()=>clearInterval(l)},[n,o]),new An({id:"fishing-vessel-layer",data:t,visible:n,pickable:!0,getPosition:l=>[l.Longitude,l.Latitude],getIcon:()=>({url:"/Ship-Icon.png",height:512,width:360}),getAngle:l=>l.TrueHeading==511?0:360-(l.TrueHeading||0),getSize:40})}function Sle({visible:n=!0,viewportBounds:e}={}){const[t,r]=R.useState([]),i=R.useRef(null),s=R.useRef(e),o=R.useCallback(l=>{const u=new URLSearchParams({minLat:l.minLat.toString(),maxLat:l.maxLat.toString(),minLon:l.minLon.toString(),maxLon:l.maxLon.toString(),vesselTypes:"31,32"});fetch(`${fr}/v1/vessels/position/all?${u}`).then(h=>{if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);return h.json()}).then(h=>r(h)).catch(h=>console.error("Error fetching Towing Vessels:",h))},[]);return s.current=e,R.useEffect(()=>{if(!(!n||!e))return i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{s.current&&o(s.current)},250),()=>{i.current&&clearTimeout(i.current)}},[n,e,o]),R.useEffect(()=>{if(!n||!e)return;const l=setInterval(()=>{s.current&&o(s.current)},3e4);return()=>clearInterval(l)},[n,o]),new An({id:"towing-vessel-layer",data:t,visible:n,pickable:!0,getPosition:l=>[l.Longitude,l.Latitude],getIcon:()=>({url:"/Ship-Icon.png",height:512,width:360}),getAngle:l=>l.TrueHeading==511?0:360-(l.TrueHeading||0),getSize:40})}function Rle({visible:n=!0,viewportBounds:e}={}){const[t,r]=R.useState([]),i=R.useRef(null),s=R.useRef(e),o=R.useCallback(l=>{const u=new URLSearchParams({minLat:l.minLat.toString(),maxLat:l.maxLat.toString(),minLon:l.minLon.toString(),maxLon:l.maxLon.toString(),vesselTypes:"35"});fetch(`${fr}/v1/vessels/position/all?${u}`).then(h=>{if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);return h.json()}).then(h=>r(h)).catch(h=>console.error("Error fetching Military Vessels:",h))},[]);return s.current=e,R.useEffect(()=>{if(!(!n||!e))return i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{s.current&&o(s.current)},250),()=>{i.current&&clearTimeout(i.current)}},[n,e,o]),R.useEffect(()=>{if(!n||!e)return;const l=setInterval(()=>{s.current&&o(s.current)},3e4);return()=>clearInterval(l)},[n,o]),new An({id:"military-vessel-layer",data:t,visible:n,pickable:!0,getPosition:l=>[l.Longitude,l.Latitude],getIcon:()=>({url:"/Ship-Icon.png",height:512,width:360}),getAngle:l=>l.TrueHeading==511?0:360-(l.TrueHeading||0),getSize:40})}function Cle({visible:n=!0,viewportBounds:e}={}){const[t,r]=R.useState([]),i=R.useRef(null),s=R.useRef(e),o=R.useCallback(l=>{const u=new URLSearchParams({minLat:l.minLat.toString(),maxLat:l.maxLat.toString(),minLon:l.minLon.toString(),maxLon:l.maxLon.toString(),vesselTypes:"37"});fetch(`${fr}/v1/vessels/position/all?${u}`).then(h=>{if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);return h.json()}).then(h=>r(h)).catch(h=>console.error("Error fetching Pleasure Crafts:",h))},[]);return s.current=e,R.useEffect(()=>{if(!(!n||!e))return i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{s.current&&o(s.current)},250),()=>{i.current&&clearTimeout(i.current)}},[n,e,o]),R.useEffect(()=>{if(!n||!e)return;const l=setInterval(()=>{s.current&&o(s.current)},3e4);return()=>clearInterval(l)},[n,o]),new An({id:"pleasure-craft-layer",data:t,visible:n,pickable:!0,getPosition:l=>[l.Longitude,l.Latitude],getIcon:()=>({url:"/Ship-Icon.png",height:512,width:360}),getAngle:l=>l.TrueHeading==511?0:360-(l.TrueHeading||0),getSize:40})}function Ile({visible:n=!0,viewportBounds:e}={}){const[t,r]=R.useState([]),i=R.useRef(null),s=R.useRef(e),o=R.useCallback(l=>{const u=new URLSearchParams({minLat:l.minLat.toString(),maxLat:l.maxLat.toString(),minLon:l.minLon.toString(),maxLon:l.maxLon.toString(),vesselTypes:"40,41,42,43,44,45,46,47,48,49"});fetch(`${fr}/v1/vessels/position/all?${u}`).then(h=>{if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);return h.json()}).then(h=>r(h)).catch(h=>console.error("Error fetching High Speed Crafts:",h))},[]);return s.current=e,R.useEffect(()=>{if(!(!n||!e))return i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{s.current&&o(s.current)},250),()=>{i.current&&clearTimeout(i.current)}},[n,e,o]),R.useEffect(()=>{if(!n||!e)return;const l=setInterval(()=>{s.current&&o(s.current)},3e4);return()=>clearInterval(l)},[n,o]),new An({id:"hsc-layer",data:t,visible:n,pickable:!0,getPosition:l=>[l.Longitude,l.Latitude],getIcon:()=>({url:"/Ship-Icon.png",height:512,width:360}),getAngle:l=>l.TrueHeading==511?0:360-(l.TrueHeading||0),getSize:40})}function Ple({visible:n=!0,viewportBounds:e}={}){const[t,r]=R.useState([]),i=R.useRef(null),s=R.useRef(e),o=R.useCallback(l=>{const u=new URLSearchParams({minLat:l.minLat.toString(),maxLat:l.maxLat.toString(),minLon:l.minLon.toString(),maxLon:l.maxLon.toString(),vesselTypes:"52"});fetch(`${fr}/v1/vessels/position/all?${u}`).then(h=>{if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);return h.json()}).then(h=>r(h)).catch(h=>console.error("Error fetching Tugs:",h))},[]);return s.current=e,R.useEffect(()=>{if(!(!n||!e))return i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{s.current&&o(s.current)},250),()=>{i.current&&clearTimeout(i.current)}},[n,e,o]),R.useEffect(()=>{if(!n||!e)return;const l=setInterval(()=>{s.current&&o(s.current)},3e4);return()=>clearInterval(l)},[n,o]),new An({id:"tug-layer",data:t,visible:n,pickable:!0,getPosition:l=>[l.Longitude,l.Latitude],getIcon:()=>({url:"/Ship-Icon.png",height:512,width:360}),getAngle:l=>l.TrueHeading==511?0:360-(l.TrueHeading||0),getSize:40})}function Mle({visible:n=!0,viewportBounds:e}={}){const[t,r]=R.useState([]),i=R.useRef(null),s=R.useRef(e),o=R.useCallback(l=>{const u=new URLSearchParams({minLat:l.minLat.toString(),maxLat:l.maxLat.toString(),minLon:l.minLon.toString(),maxLon:l.maxLon.toString(),vesselTypes:"55"});fetch(`${fr}/v1/vessels/position/all?${u}`).then(h=>{if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);return h.json()}).then(h=>r(h)).catch(h=>console.error("Error fetching Tugs:",h))},[]);return s.current=e,R.useEffect(()=>{if(!(!n||!e))return i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{s.current&&o(s.current)},250),()=>{i.current&&clearTimeout(i.current)}},[n,e,o]),R.useEffect(()=>{if(!n||!e)return;const l=setInterval(()=>{s.current&&o(s.current)},3e4);return()=>clearInterval(l)},[n,o]),new An({id:"law-enforcement-layer",data:t,visible:n,pickable:!0,getPosition:l=>[l.Longitude,l.Latitude],getIcon:()=>({url:"/Ship-Icon.png",height:512,width:360}),getAngle:l=>l.TrueHeading==511?0:360-(l.TrueHeading||0),getSize:40})}function Ole({visible:n=!0,viewportBounds:e}={}){const[t,r]=R.useState([]),i=R.useRef(null),s=R.useRef(e),o=R.useCallback(l=>{const u=new URLSearchParams({minLat:l.minLat.toString(),maxLat:l.maxLat.toString(),minLon:l.minLon.toString(),maxLon:l.maxLon.toString(),vesselTypes:"58"});fetch(`${fr}/v1/vessels/position/all?${u}`).then(h=>{if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);return h.json()}).then(h=>r(h)).catch(h=>console.error("Error fetching Medical Transport Vessels:",h))},[]);return s.current=e,R.useEffect(()=>{if(!(!n||!e))return i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{s.current&&o(s.current)},250),()=>{i.current&&clearTimeout(i.current)}},[n,e,o]),R.useEffect(()=>{if(!n||!e)return;const l=setInterval(()=>{s.current&&o(s.current)},3e4);return()=>clearInterval(l)},[n,o]),new An({id:"medical-transport-layer",data:t,visible:n,pickable:!0,getPosition:l=>[l.Longitude,l.Latitude],getIcon:()=>({url:"/Ship-Icon.png",height:512,width:360}),getAngle:l=>l.TrueHeading==511?0:360-(l.TrueHeading||0),getSize:40})}function kle({visible:n=!0,viewportBounds:e}={}){const[t,r]=R.useState([]),i=R.useRef(null),s=R.useRef(e),o=R.useCallback(l=>{const u=new URLSearchParams({minLat:l.minLat.toString(),maxLat:l.maxLat.toString(),minLon:l.minLon.toString(),maxLon:l.maxLon.toString(),vesselTypes:"60,61,62,63,64,65,66,67,68,69"});fetch(`${fr}/v1/vessels/position/all?${u}`).then(h=>{if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);return h.json()}).then(h=>r(h)).catch(h=>console.error("Error fetching Passenger Vessels:",h))},[]);return s.current=e,R.useEffect(()=>{if(!(!n||!e))return i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{s.current&&o(s.current)},250),()=>{i.current&&clearTimeout(i.current)}},[n,e,o]),R.useEffect(()=>{if(!n||!e)return;const l=setInterval(()=>{s.current&&o(s.current)},3e4);return()=>clearInterval(l)},[n,o]),new An({id:"passenger-vessel-layer",data:t,visible:n,pickable:!0,getPosition:l=>[l.Longitude,l.Latitude],getIcon:()=>({url:"/Ship-Icon.png",height:512,width:360}),getAngle:l=>l.TrueHeading==511?0:360-(l.TrueHeading||0),getSize:40})}function Nle({visible:n=!0,viewportBounds:e}={}){const[t,r]=R.useState([]),i=R.useRef(null),s=R.useRef(e),o=R.useCallback(l=>{const u=new URLSearchParams({minLat:l.minLat.toString(),maxLat:l.maxLat.toString(),minLon:l.minLon.toString(),maxLon:l.maxLon.toString(),vesselTypes:"70,71,72,73,74,75,76,77,78,79"});fetch(`${fr}/v1/vessels/position/all?${u}`).then(h=>{if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);return h.json()}).then(h=>r(h)).catch(h=>console.error("Error fetching Cargo Vessels:",h))},[]);return s.current=e,R.useEffect(()=>{if(!(!n||!e))return i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{s.current&&o(s.current)},250),()=>{i.current&&clearTimeout(i.current)}},[n,e,o]),R.useEffect(()=>{if(!n||!e)return;const l=setInterval(()=>{s.current&&o(s.current)},3e4);return()=>clearInterval(l)},[n,o]),new An({id:"cargo-vessel-layer",data:t,visible:n,pickable:!0,getPosition:l=>[l.Longitude,l.Latitude],getIcon:()=>({url:"/Ship-Icon.png",height:512,width:360}),getAngle:l=>l.TrueHeading==511?0:360-(l.TrueHeading||0),getSize:40})}function Dle({visible:n=!0,viewportBounds:e}={}){const[t,r]=R.useState([]),i=R.useRef(null),s=R.useRef(e),o=R.useCallback(l=>{const u=new URLSearchParams({minLat:l.minLat.toString(),maxLat:l.maxLat.toString(),minLon:l.minLon.toString(),maxLon:l.maxLon.toString(),vesselTypes:"80,81,82,83,84,85,86,87,88,89"});fetch(`${fr}/v1/vessels/position/all?${u}`).then(h=>{if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);return h.json()}).then(h=>r(h)).catch(h=>console.error("Error fetching Tanker Vessels:",h))},[]);return s.current=e,R.useEffect(()=>{if(!(!n||!e))return i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{s.current&&o(s.current)},250),()=>{i.current&&clearTimeout(i.current)}},[n,e,o]),R.useEffect(()=>{if(!n||!e)return;const l=setInterval(()=>{s.current&&o(s.current)},3e4);return()=>clearInterval(l)},[n,o]),new An({id:"tanker-vessel-layer",data:t,visible:n,pickable:!0,getPosition:l=>[l.Longitude,l.Latitude],getIcon:()=>({url:"/Ship-Icon.png",height:512,width:360}),getAngle:l=>l.TrueHeading==511?0:360-(l.TrueHeading||0),getSize:40})}function Lle({visible:n=!0,viewportBounds:e}={}){const[t,r]=R.useState([]),i=R.useRef(null),s=R.useRef(e),o=R.useCallback(l=>{const u=new URLSearchParams({minLat:l.minLat.toString(),maxLat:l.maxLat.toString(),minLon:l.minLon.toString(),maxLon:l.maxLon.toString(),vesselTypes:"36"});fetch(`${fr}/v1/vessels/position/all?${u}`).then(h=>{if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);return h.json()}).then(h=>r(h)).catch(h=>console.error("Error fetching Sailing Vessels:",h))},[]);return s.current=e,R.useEffect(()=>{if(!(!n||!e))return i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{s.current&&o(s.current)},250),()=>{i.current&&clearTimeout(i.current)}},[n,e,o]),R.useEffect(()=>{if(!n||!e)return;const l=setInterval(()=>{s.current&&o(s.current)},3e4);return()=>clearInterval(l)},[n,o]),new An({id:"sailing-vessel-layer",data:t,visible:n,pickable:!0,getPosition:l=>[l.Longitude,l.Latitude],getIcon:()=>({url:"/Ship-Icon.png",height:512,width:360}),getAngle:l=>l.TrueHeading==511?0:360-(l.TrueHeading||0),getSize:40})}function Ule({visible:n=!0,viewportBounds:e}={}){const[t,r]=R.useState([]),i=R.useRef(null),s=R.useRef(e),o=R.useCallback(l=>{const u=new URLSearchParams({minLat:l.minLat.toString(),maxLat:l.maxLat.toString(),minLon:l.minLon.toString(),maxLon:l.maxLon.toString(),vesselTypes:"0,33,34,50,51,53,54,59,90,91,92,93,94,95,96,97,98,99"});fetch(`${fr}/v1/vessels/position/all?${u}`).then(h=>{if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);return h.json()}).then(h=>r(h)).catch(h=>console.error("Error fetching Other Vessels:",h))},[]);return s.current=e,R.useEffect(()=>{if(!(!n||!e))return i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{s.current&&o(s.current)},250),()=>{i.current&&clearTimeout(i.current)}},[n,e,o]),R.useEffect(()=>{if(!n||!e)return;const l=setInterval(()=>{s.current&&o(s.current)},3e4);return()=>clearInterval(l)},[n,o]),new An({id:"other-vessel-layer",data:t,visible:n,pickable:!0,getPosition:l=>[l.Longitude,l.Latitude],getIcon:()=>({url:"/Ship-Icon.png",height:512,width:360}),getAngle:l=>l.TrueHeading==511?0:360-(l.TrueHeading||0),getSize:40})}const zI=(n,e)=>{let t;return(...r)=>{t&&window.clearTimeout(t),t=window.setTimeout(()=>n(...r),e)}},Fle=vt.memo(({})=>{const[n,e]=R.useState(null);R.useEffect(()=>{const de=iw(Fu,xe=>{e(xe?xe.uid:null)});return()=>de()},[]);const[t,r]=R.useState({latitude:20,longitude:0,zoom:2,pitch:0,bearing:0});R.useEffect(()=>{let de=!0;return(async()=>{try{if(n)try{const P=await CO(n);if(de&&P?.mapPosition){const{latitude:q,longitude:U,zoom:oe}=P.mapPosition;r({latitude:q,longitude:U,zoom:oe,pitch:0,bearing:0});return}}catch(P){console.error("Failed to load user map position:",P)}const xe=localStorage.getItem("mapPosition");if(de&&xe)try{const{latitude:P,longitude:q,zoom:U}=JSON.parse(xe);r({latitude:P,longitude:q,zoom:U,pitch:0,bearing:0})}catch(P){console.error("Failed to parse saved map position:",P)}}catch(xe){console.error("Error while loading map position:",xe)}})(),()=>{de=!1}},[n]);const[i,s]=R.useState({osm:!0,wigVessels:!0,fishingVessels:!0,towingVessels:!0,militaryVessels:!0,pleasureCrafts:!0,highSpeedCrafts:!0,tugs:!0,lawEnforcement:!0,medicalTransport:!0,passengerVessels:!0,cargoVessels:!0,tankerVessels:!0,sailingVessels:!0,otherVessels:!0,lighthouse:!1}),[o,l]=R.useState(),u=R.useCallback(zI(de=>{const xe={longitude:de.longitude,latitude:de.latitude,zoom:de.zoom};localStorage.setItem("mapPosition",JSON.stringify(xe))},300),[]),h=R.useCallback(zI(async(de,xe)=>{try{await IO(de,{mapPosition:{longitude:xe.longitude,latitude:xe.latitude,zoom:xe.zoom}})}catch(P){console.error("Failed to save map position to Firestore:",P)}},1e3),[]);R.useEffect(()=>{if(!n)return;const de=localStorage.getItem("mapPosition");if(de)try{const xe=JSON.parse(de);h(n,xe)}catch(xe){console.error("Failed to parse saved map position for upload:",xe)}},[n,h]);const d=R.useCallback(de=>{if(de)try{const P=new Ws({...de,width:window.innerWidth,height:window.innerHeight}).getBounds();l({minLon:P[0],minLat:P[1],maxLon:P[2],maxLat:P[3]})}catch(xe){console.error("Failed to update viewport bounds:",xe)}},[]);R.useEffect(()=>{d(t)},[t,d]);const g=R.useCallback(({viewState:de})=>{r(de),u(de),d(de),n&&h(n,de)},[u,d,n,h]),y=xle({visible:i.wigVessels,viewportBounds:o}),b=Ale({visible:i.fishingVessels,viewportBounds:o}),w=Sle({visible:i.towingVessels,viewportBounds:o}),E=Rle({visible:i.militaryVessels,viewportBounds:o}),x=Cle({visible:i.pleasureCrafts,viewportBounds:o}),C=Ile({visible:i.highSpeedCrafts,viewportBounds:o}),M=Ple({visible:i.tugs,viewportBounds:o}),O=Mle({visible:i.lawEnforcement,viewportBounds:o}),V=Ole({visible:i.medicalTransport,viewportBounds:o}),H=kle({visible:i.passengerVessels,viewportBounds:o}),G=Nle({visible:i.cargoVessels,viewportBounds:o}),D=Dle({visible:i.tankerVessels,viewportBounds:o}),I=Lle({visible:i.sailingVessels,viewportBounds:o}),N=Ule({visible:i.otherVessels,viewportBounds:o}),j=R.useMemo(()=>{const de=[];return i.osm&&de.push(Ele()),i.lighthouse,i.wigVessels&&de.push(y),i.fishingVessels&&de.push(b),i.towingVessels&&de.push(w),i.militaryVessels&&de.push(E),i.pleasureCrafts&&de.push(x),i.highSpeedCrafts&&de.push(C),i.tugs&&de.push(M),i.lawEnforcement&&de.push(O),i.medicalTransport&&de.push(V),i.passengerVessels&&de.push(H),i.cargoVessels&&de.push(G),i.tankerVessels&&de.push(D),i.sailingVessels&&de.push(I),i.otherVessels&&de.push(N),de},[i,y,b,w,E,x,C,M,O,V,H,G,D,I,N]),W=R.useMemo(()=>({scrollZoom:{smooth:!0,speed:.1},dragRotate:!1,keyboard:!0,touchRotate:!1}),[]),Y=R.useCallback(de=>{s(xe=>({...xe,[de]:!xe[de]}))},[]),z=zw();return X.jsx(X.Fragment,{children:X.jsx(jse,{layers:j,views:new HE({repeat:!0}),viewState:t,onViewStateChange:g,controller:W,getTooltip:()=>null,getCursor:()=>"grab",style:{position:"absolute",width:"100vw",height:"100vh"},children:X.jsx("div",{className:`absolute ${z?"top-6 right-6":"top-20 right-4"} z-50`,children:X.jsxs(OW,{children:[X.jsx(kW,{asChild:!0,children:X.jsx("div",{className:"bg-white/70 p-2.5 rounded-full cursor-pointer text-xl hover:bg-white/90 transition-colors",children:X.jsx(Xj,{})})}),X.jsx(NW,{className:"w-55 mr-3 mt-1",children:X.jsxs(yq,{type:"single",collapsible:!0,className:"w-full",children:[X.jsxs(Rb,{value:"layers",children:[X.jsx(Cb,{className:"cursor-pointer",children:"Maps"}),X.jsx(Ib,{children:X.jsx("div",{className:"flex flex-col space-y-2 mt-2",children:X.jsxs("div",{className:"flex items-center space-x-2",children:[X.jsx(Pn,{id:"osm-layer",checked:i.osm,onCheckedChange:()=>Y("osm"),className:"cursor-pointer"}),X.jsx("label",{htmlFor:"osm-layer",className:"text-sm",children:"OpenStreetMap"})]})})})]}),X.jsxs(Rb,{value:"buildings",children:[X.jsx(Cb,{className:"cursor-pointer",children:"Buildings"}),X.jsx(Ib,{children:X.jsxs("div",{className:"flex flex-col space-y-2 mt-2",children:[X.jsxs("div",{className:"flex items-center space-x-2",children:[X.jsx(Pn,{id:"ports-layer",checked:!1,onCheckedChange:()=>{},className:"cursor-pointer"}),X.jsx("label",{htmlFor:"ports-layer",className:"text-sm",children:"Ports"})]}),X.jsxs("div",{className:"flex items-center space-x-2",children:[X.jsx(Pn,{id:"lighthouse-layer",checked:i.lighthouse,onCheckedChange:()=>Y("lighthouse"),className:"cursor-pointer"}),X.jsx("label",{htmlFor:"lighthouse-layer",className:"text-sm",children:"Lighthouses"})]})]})})]}),X.jsxs(Rb,{value:"vessels",children:[X.jsx(Cb,{className:"cursor-pointer",children:"Vessels"}),X.jsx(Ib,{children:X.jsxs("div",{className:"flex flex-col space-y-2 mt-2",children:[X.jsxs("div",{className:"flex items-center space-x-2",children:[X.jsx(Pn,{id:"wig-vessel-layer",checked:i.wigVessels,onCheckedChange:()=>Y("wigVessels"),className:"cursor-pointer"}),X.jsx("label",{htmlFor:"wig-vessel-layer",className:"text-sm",children:"Wing in Ground Vessels"})]}),X.jsxs("div",{className:"flex items-center space-x-2",children:[X.jsx(Pn,{id:"fishing-vessel-layer",checked:i.fishingVessels,onCheckedChange:()=>Y("fishingVessels"),className:"cursor-pointer"}),X.jsx("label",{htmlFor:"fishing-vessel-layer",className:"text-sm",children:"Fishing Vessels"})]}),"                                      ",X.jsxs("div",{className:"flex items-center space-x-2",children:[X.jsx(Pn,{id:"towing-vessel-layer",checked:i.towingVessels,onCheckedChange:()=>Y("towingVessels"),className:"cursor-pointer"}),X.jsx("label",{htmlFor:"towing-vessel-layer",className:"text-sm",children:"Towing Vessels"})]}),X.jsxs("div",{className:"flex items-center space-x-2",children:[X.jsx(Pn,{id:"military-vessel-layer",checked:i.militaryVessels,onCheckedChange:()=>Y("militaryVessels"),className:"cursor-pointer"}),X.jsx("label",{htmlFor:"military-vessel-layer",className:"text-sm",children:"Military Vessels"})]}),X.jsxs("div",{className:"flex items-center space-x-2",children:[X.jsx(Pn,{id:"sailing-vessel-layer",checked:i.sailingVessels,onCheckedChange:()=>Y("sailingVessels"),className:"cursor-pointer"}),X.jsx("label",{htmlFor:"sailing-vessel-layer",className:"text-sm",children:"Sailing Vessels"})]}),X.jsxs("div",{className:"flex items-center space-x-2",children:[X.jsx(Pn,{id:"pleasure-craft-layer",checked:i.pleasureCrafts,onCheckedChange:()=>Y("pleasureCrafts"),className:"cursor-pointer"}),X.jsx("label",{htmlFor:"pleasure-craft-layer",className:"text-sm",children:"Pleasure Crafts"})]}),X.jsxs("div",{className:"flex items-center space-x-2",children:[X.jsx(Pn,{id:"hsc-layer",checked:i.highSpeedCrafts,onCheckedChange:()=>Y("highSpeedCrafts"),className:"cursor-pointer"}),X.jsx("label",{htmlFor:"hsc-layer",className:"text-sm",children:"High Speed Crafts"})]}),X.jsxs("div",{className:"flex items-center space-x-2",children:[X.jsx(Pn,{id:"tug-layer",checked:i.tugs,onCheckedChange:()=>Y("tugs"),className:"cursor-pointer"}),X.jsx("label",{htmlFor:"tug-layer",className:"text-sm",children:"Tugs"})]}),X.jsxs("div",{className:"flex items-center space-x-2",children:[X.jsx(Pn,{id:"law-enforcement-layer",checked:i.lawEnforcement,onCheckedChange:()=>Y("lawEnforcement"),className:"cursor-pointer"}),X.jsx("label",{htmlFor:"law-enforcement-layer",className:"text-sm",children:"Law Enforcement"})]}),X.jsxs("div",{className:"flex items-center space-x-2",children:[X.jsx(Pn,{id:"medical-transport-layer",checked:i.medicalTransport,onCheckedChange:()=>Y("medicalTransport"),className:"cursor-pointer"}),X.jsx("label",{htmlFor:"medical-transport-layer",className:"text-sm",children:"Medical Transport"})]}),X.jsxs("div",{className:"flex items-center space-x-2",children:[X.jsx(Pn,{id:"passenger-vessel-layer",checked:i.passengerVessels,onCheckedChange:()=>Y("passengerVessels"),className:"cursor-pointer"}),X.jsx("label",{htmlFor:"passenger-vessel-layer",className:"text-sm",children:"Passenger Vessels"})]}),X.jsxs("div",{className:"flex items-center space-x-2",children:[X.jsx(Pn,{id:"cargo-vessel-layer",checked:i.cargoVessels,onCheckedChange:()=>Y("cargoVessels"),className:"cursor-pointer"}),X.jsx("label",{htmlFor:"cargo-vessel-layer",className:"text-sm",children:"Cargo Vessels"})]}),X.jsxs("div",{className:"flex items-center space-x-2",children:[X.jsx(Pn,{id:"tanker-vessel-layer",checked:i.tankerVessels,onCheckedChange:()=>Y("tankerVessels"),className:"cursor-pointer"}),X.jsx("label",{htmlFor:"tanker-vessel-layer",className:"text-sm",children:"Tankers"})]}),X.jsxs("div",{className:"flex items-center space-x-2",children:[X.jsx(Pn,{id:"other-vessel-layer",checked:i.otherVessels,onCheckedChange:()=>Y("otherVessels"),className:"cursor-pointer"}),X.jsx("label",{htmlFor:"other-vessel-layer",className:"text-sm",children:"Other Vessels"})]})]})})]})]})})]})})})})});async function Ble(n){const e=gu(mu,"usernames",n);return(await Vw(e)).exists()}async function Vle(n,e,t){await $0(gu(mu,"users",e),{username:n,email:t,createdAt:SO()},{merge:!0}),await $0(gu(mu,"usernames",n),{uid:e})}async function zle(n,e,t){if(!n||!e||!t)throw new Error("Email, password and username are required");if(await Ble(t))throw new Error("Username is already taken");let r;try{r=(await GV(Fu,n,e)).user}catch(i){throw console.error("createUserWithEmailAndPassword failed:",i?.code??i?.message??i),new Error(`Registration failed: ${i?.code??i?.message??"unknown error"}`)}try{await Vle(t,r.uid,n)}catch(i){console.error("saveUsername failed:",i?.code??i?.message??i);try{r&&(await t5(r),console.info("Rolled back newly created auth user due to username save failure."))}catch(s){console.error("Failed to delete user during rollback:",s?.code??s?.message??s)}throw new Error(`Failed to save username: ${i?.code??i?.message??"unknown error"}`)}return r}async function jle(n,e){const{user:t}=await ZV(Fu,n,e);return t}async function Hle(){await e5(Fu)}async function $le(n){const e=gu(mu,"users",n),t=await Vw(e);return t.exists()&&t.data().username||null}function Wle(){const[n,e]=R.useState(""),[t,r]=R.useState(""),[i,s]=R.useState(""),[o,l]=R.useState(""),[u,h]=R.useState(null),[d,g]=R.useState(!1),y=async b=>{if(b.preventDefault(),h(null),!t||!n||!i||!o){h("All fields are required");return}if(!(E=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(E))(t)){h("Please enter a valid email address");return}if(i!==o){h("Passwords do not match");return}if(i.length<6){h("Password must be at least 6 characters");return}try{g(!0),await zle(t,i,n)}catch(E){const x=E?.message??"Registration failed";x.includes("auth/invalid-email")?h("Invalid email address"):x.includes("EMAIL_EXISTS")||x.includes("auth/email-already-in-use")?h("An account with this email already exists"):h(x)}finally{g(!1)}};return X.jsxs("div",{className:"backdrop-blur-sm p-3 rounded-lg shadow-lg max-w-md mx-auto mt-5 bg-white/30",children:[X.jsx("h2",{className:"text-2xl font-bold mb-4 text-center",children:"Register"}),u&&X.jsx("div",{className:"text-red-500 mb-4 text-center",children:u}),X.jsxs("form",{onSubmit:y,className:"space-y-4",children:[X.jsxs("div",{children:[X.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"username",children:"Username"}),X.jsx("input",{type:"text",id:"username",value:n,onChange:b=>e(b.target.value),className:"w-full p-2 border border-gray-900 rounded",required:!0})]}),X.jsxs("div",{children:[X.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"email",children:"Email"}),X.jsx("input",{type:"email",id:"email",value:t,onChange:b=>r(b.target.value),className:"w-full p-2 border border-gray-900 rounded",required:!0})]}),X.jsxs("div",{children:[X.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"password",children:"Password"}),X.jsx("input",{type:"password",id:"password",value:i,onChange:b=>s(b.target.value),className:"w-full p-2 border border-gray-900 rounded",required:!0,minLength:6})]}),X.jsxs("div",{children:[X.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"confirmPassword",children:"Confirm Password"}),X.jsx("input",{type:"password",id:"confirmPassword",value:o,onChange:b=>l(b.target.value),className:"w-full p-2 border border-gray-900 rounded",required:!0,minLength:6})]}),X.jsx("button",{type:"submit",className:"w-full bg-blue-600 text-white p-2 rounded hover:bg-blue-700 transition",disabled:d,children:d?"Registering":"Register"})]})]})}function qle(){const[n,e]=R.useState(""),[t,r]=R.useState(""),[i,s]=R.useState(null),[o,l]=R.useState(!1),u=async h=>{if(h.preventDefault(),s(null),!n||!t){s("Email and password are required");return}try{l(!0),await jle(n,t)}catch(d){const g=d?.message??"Login failed";g.includes("auth/invalid-email")?s("Invalid email address"):g.includes("auth/user-not-found")||g.includes("auth/wrong-password")?s("Incorrect email or password"):s(g)}finally{l(!1)}};return X.jsxs("div",{className:"backdrop-blur-sm p-3 rounded-lg shadow-lg max-w-md mx-auto mt-5 bg-white/30",children:[X.jsx("h2",{className:"text-2xl font-bold mb-4 text-center",children:"Login"}),i&&X.jsx("div",{className:"text-red-500 mb-4 text-center",children:i}),X.jsxs("form",{onSubmit:u,children:[X.jsxs("div",{className:"mb-4",children:[X.jsx("label",{className:"block text-gray-700 mb-2",htmlFor:"email",children:"Email"}),X.jsx("input",{type:"email",id:"email",value:n,onChange:h=>e(h.target.value),className:"w-full p-2 border border-gray-900 rounded",required:!0,disabled:o})]}),X.jsxs("div",{className:"mb-4",children:[X.jsx("label",{className:"block text-gray-700 mb-2",htmlFor:"password",children:"Password"}),X.jsx("input",{type:"password",id:"password",value:t,onChange:h=>r(h.target.value),className:"w-full p-2 border border-gray-900 rounded",required:!0,disabled:o})]}),X.jsx("button",{type:"submit",className:"w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600 disabled:opacity-50",disabled:o,children:o?"Logging in...":"Login"})]})]})}const Xle=()=>R.useContext(MO),Yle=()=>{const{user:n}=Xle(),[e,t]=R.useState(null),r=zw();return R.useEffect(()=>{let i=!0;if(!n){t(null);return}return(async()=>{try{const s=await $le(n.uid);i&&t(s)}catch(s){console.error("Failed to load username:",s),i&&t(null)}})(),()=>{i=!1}},[n]),X.jsx("div",{className:"flex justify-center items-center min-h-screen",children:X.jsxs("div",{className:`bg-gray-400/40 h-fit ${r?"mt-0 mb-15":"mt-30 mb-10"} w-240 border-2 border-gray-300 p-5 rounded-lg shadow-lg backdrop-blur-md`,children:[X.jsx("h1",{className:"text-3xl font-bold text-center",children:"Account"}),n?X.jsxs("div",{className:"mt-5 text-center",children:["Welcome, ",e??n.email??"user",X.jsx("button",{onClick:async()=>{try{await Hle()}catch(i){console.error("Logout failed:",i)}},className:"mt-5 w-full bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded",children:"Logout"})]}):X.jsxs(X.Fragment,{children:[X.jsx("div",{className:"mt-5",children:X.jsx(qle,{})}),X.jsx("div",{className:"mt-10",children:X.jsx(Wle,{})})]})]})})};function Kle(){return X.jsx(Fj,{children:X.jsx(Bj,{children:X.jsxs(sF,{children:[X.jsx(Kj,{}),X.jsx(Gj,{}),X.jsxs(LU,{children:[X.jsx(Dc,{path:"/",element:X.jsx(Fle,{})}),X.jsx(Dc,{path:"/vessels",element:X.jsx("div",{className:"mt-30 text-center",children:"Vessels"})}),X.jsx(Dc,{path:"/gallery",element:X.jsx("div",{className:"mt-30 text-center",children:"Vessel Gallery"})}),X.jsx(Dc,{path:"/account",element:X.jsx(Yle,{})}),X.jsx(Dc,{path:"/settings",element:X.jsx("div",{className:"mt-30 text-center",children:"Settings"})})]})]})})})}W6.createRoot(document.getElementById("root")).render(X.jsx(R.StrictMode,{children:X.jsx(Kle,{})}));
