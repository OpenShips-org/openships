function y8(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in n)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(n,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();function qx(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var _0={exports:{}},jf={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cC;function _8(){if(cC)return jf;cC=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(r,i,s){var o=null;if(s!==void 0&&(o=""+s),i.key!==void 0&&(o=""+i.key),"key"in i){s={};for(var a in i)a!=="key"&&(s[a]=i[a])}else s=i;return i=s.ref,{$$typeof:n,type:r,key:o,ref:i!==void 0?i:null,props:s}}return jf.Fragment=e,jf.jsx=t,jf.jsxs=t,jf}var uC;function v8(){return uC||(uC=1,_0.exports=_8()),_0.exports}var $=v8(),v0={exports:{}},Ke={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hC;function b8(){if(hC)return Ke;hC=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),g=Symbol.iterator;function y(V){return V===null||typeof V!="object"?null:(V=g&&V[g]||V["@@iterator"],typeof V=="function"?V:null)}var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},T=Object.assign,w={};function E(V,Z,se){this.props=V,this.context=Z,this.refs=w,this.updater=se||v}E.prototype.isReactComponent={},E.prototype.setState=function(V,Z){if(typeof V!="object"&&typeof V!="function"&&V!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,V,Z,"setState")},E.prototype.forceUpdate=function(V){this.updater.enqueueForceUpdate(this,V,"forceUpdate")};function S(){}S.prototype=E.prototype;function P(V,Z,se){this.props=V,this.context=Z,this.refs=w,this.updater=se||v}var I=P.prototype=new S;I.constructor=P,T(I,E.prototype),I.isPureReactComponent=!0;var L=Array.isArray,F={H:null,A:null,T:null,S:null,V:null},Y=Object.prototype.hasOwnProperty;function k(V,Z,se,ae,me,xe){return se=xe.ref,{$$typeof:n,type:V,key:Z,ref:se!==void 0?se:null,props:xe}}function M(V,Z){return k(V.type,Z,void 0,void 0,void 0,V.props)}function N(V){return typeof V=="object"&&V!==null&&V.$$typeof===n}function H(V){var Z={"=":"=0",":":"=2"};return"$"+V.replace(/[=:]/g,function(se){return Z[se]})}var q=/\/+/g;function K(V,Z){return typeof V=="object"&&V!==null&&V.key!=null?H(""+V.key):Z.toString(36)}function j(){}function de(V){switch(V.status){case"fulfilled":return V.value;case"rejected":throw V.reason;default:switch(typeof V.status=="string"?V.then(j,j):(V.status="pending",V.then(function(Z){V.status==="pending"&&(V.status="fulfilled",V.value=Z)},function(Z){V.status==="pending"&&(V.status="rejected",V.reason=Z)})),V.status){case"fulfilled":return V.value;case"rejected":throw V.reason}}throw V}function Ee(V,Z,se,ae,me){var xe=typeof V;(xe==="undefined"||xe==="boolean")&&(V=null);var Se=!1;if(V===null)Se=!0;else switch(xe){case"bigint":case"string":case"number":Se=!0;break;case"object":switch(V.$$typeof){case n:case e:Se=!0;break;case d:return Se=V._init,Ee(Se(V._payload),Z,se,ae,me)}}if(Se)return me=me(V),Se=ae===""?"."+K(V,0):ae,L(me)?(se="",Se!=null&&(se=Se.replace(q,"$&/")+"/"),Ee(me,Z,se,"",function(lt){return lt})):me!=null&&(N(me)&&(me=M(me,se+(me.key==null||V&&V.key===me.key?"":(""+me.key).replace(q,"$&/")+"/")+Se)),Z.push(me)),1;Se=0;var Ce=ae===""?".":ae+":";if(L(V))for(var Me=0;Me<V.length;Me++)ae=V[Me],xe=Ce+K(ae,Me),Se+=Ee(ae,Z,se,xe,me);else if(Me=y(V),typeof Me=="function")for(V=Me.call(V),Me=0;!(ae=V.next()).done;)ae=ae.value,xe=Ce+K(ae,Me++),Se+=Ee(ae,Z,se,xe,me);else if(xe==="object"){if(typeof V.then=="function")return Ee(de(V),Z,se,ae,me);throw Z=String(V),Error("Objects are not valid as a React child (found: "+(Z==="[object Object]"?"object with keys {"+Object.keys(V).join(", ")+"}":Z)+"). If you meant to render a collection of children, use an array instead.")}return Se}function O(V,Z,se){if(V==null)return V;var ae=[],me=0;return Ee(V,ae,"","",function(xe){return Z.call(se,xe,me++)}),ae}function W(V){if(V._status===-1){var Z=V._result;Z=Z(),Z.then(function(se){(V._status===0||V._status===-1)&&(V._status=1,V._result=se)},function(se){(V._status===0||V._status===-1)&&(V._status=2,V._result=se)}),V._status===-1&&(V._status=0,V._result=Z)}if(V._status===1)return V._result.default;throw V._result}var U=typeof reportError=="function"?reportError:function(V){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Z=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof V=="object"&&V!==null&&typeof V.message=="string"?String(V.message):String(V),error:V});if(!window.dispatchEvent(Z))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",V);return}console.error(V)};function ie(){}return Ke.Children={map:O,forEach:function(V,Z,se){O(V,function(){Z.apply(this,arguments)},se)},count:function(V){var Z=0;return O(V,function(){Z++}),Z},toArray:function(V){return O(V,function(Z){return Z})||[]},only:function(V){if(!N(V))throw Error("React.Children.only expected to receive a single React element child.");return V}},Ke.Component=E,Ke.Fragment=t,Ke.Profiler=i,Ke.PureComponent=P,Ke.StrictMode=r,Ke.Suspense=u,Ke.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=F,Ke.__COMPILER_RUNTIME={__proto__:null,c:function(V){return F.H.useMemoCache(V)}},Ke.cache=function(V){return function(){return V.apply(null,arguments)}},Ke.cloneElement=function(V,Z,se){if(V==null)throw Error("The argument must be a React element, but you passed "+V+".");var ae=T({},V.props),me=V.key,xe=void 0;if(Z!=null)for(Se in Z.ref!==void 0&&(xe=void 0),Z.key!==void 0&&(me=""+Z.key),Z)!Y.call(Z,Se)||Se==="key"||Se==="__self"||Se==="__source"||Se==="ref"&&Z.ref===void 0||(ae[Se]=Z[Se]);var Se=arguments.length-2;if(Se===1)ae.children=se;else if(1<Se){for(var Ce=Array(Se),Me=0;Me<Se;Me++)Ce[Me]=arguments[Me+2];ae.children=Ce}return k(V.type,me,void 0,void 0,xe,ae)},Ke.createContext=function(V){return V={$$typeof:o,_currentValue:V,_currentValue2:V,_threadCount:0,Provider:null,Consumer:null},V.Provider=V,V.Consumer={$$typeof:s,_context:V},V},Ke.createElement=function(V,Z,se){var ae,me={},xe=null;if(Z!=null)for(ae in Z.key!==void 0&&(xe=""+Z.key),Z)Y.call(Z,ae)&&ae!=="key"&&ae!=="__self"&&ae!=="__source"&&(me[ae]=Z[ae]);var Se=arguments.length-2;if(Se===1)me.children=se;else if(1<Se){for(var Ce=Array(Se),Me=0;Me<Se;Me++)Ce[Me]=arguments[Me+2];me.children=Ce}if(V&&V.defaultProps)for(ae in Se=V.defaultProps,Se)me[ae]===void 0&&(me[ae]=Se[ae]);return k(V,xe,void 0,void 0,null,me)},Ke.createRef=function(){return{current:null}},Ke.forwardRef=function(V){return{$$typeof:a,render:V}},Ke.isValidElement=N,Ke.lazy=function(V){return{$$typeof:d,_payload:{_status:-1,_result:V},_init:W}},Ke.memo=function(V,Z){return{$$typeof:h,type:V,compare:Z===void 0?null:Z}},Ke.startTransition=function(V){var Z=F.T,se={};F.T=se;try{var ae=V(),me=F.S;me!==null&&me(se,ae),typeof ae=="object"&&ae!==null&&typeof ae.then=="function"&&ae.then(ie,U)}catch(xe){U(xe)}finally{F.T=Z}},Ke.unstable_useCacheRefresh=function(){return F.H.useCacheRefresh()},Ke.use=function(V){return F.H.use(V)},Ke.useActionState=function(V,Z,se){return F.H.useActionState(V,Z,se)},Ke.useCallback=function(V,Z){return F.H.useCallback(V,Z)},Ke.useContext=function(V){return F.H.useContext(V)},Ke.useDebugValue=function(){},Ke.useDeferredValue=function(V,Z){return F.H.useDeferredValue(V,Z)},Ke.useEffect=function(V,Z,se){var ae=F.H;if(typeof se=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return ae.useEffect(V,Z)},Ke.useId=function(){return F.H.useId()},Ke.useImperativeHandle=function(V,Z,se){return F.H.useImperativeHandle(V,Z,se)},Ke.useInsertionEffect=function(V,Z){return F.H.useInsertionEffect(V,Z)},Ke.useLayoutEffect=function(V,Z){return F.H.useLayoutEffect(V,Z)},Ke.useMemo=function(V,Z){return F.H.useMemo(V,Z)},Ke.useOptimistic=function(V,Z){return F.H.useOptimistic(V,Z)},Ke.useReducer=function(V,Z,se){return F.H.useReducer(V,Z,se)},Ke.useRef=function(V){return F.H.useRef(V)},Ke.useState=function(V){return F.H.useState(V)},Ke.useSyncExternalStore=function(V,Z,se){return F.H.useSyncExternalStore(V,Z,se)},Ke.useTransition=function(){return F.H.useTransition()},Ke.version="19.1.1",Ke}var fC;function Xx(){return fC||(fC=1,v0.exports=b8()),v0.exports}var A=Xx();const bt=qx(A),Fk=y8({__proto__:null,default:bt},[A]);var b0={exports:{}},Hf={},T0={exports:{}},w0={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dC;function T8(){return dC||(dC=1,(function(n){function e(O,W){var U=O.length;O.push(W);e:for(;0<U;){var ie=U-1>>>1,V=O[ie];if(0<i(V,W))O[ie]=W,O[U]=V,U=ie;else break e}}function t(O){return O.length===0?null:O[0]}function r(O){if(O.length===0)return null;var W=O[0],U=O.pop();if(U!==W){O[0]=U;e:for(var ie=0,V=O.length,Z=V>>>1;ie<Z;){var se=2*(ie+1)-1,ae=O[se],me=se+1,xe=O[me];if(0>i(ae,U))me<V&&0>i(xe,ae)?(O[ie]=xe,O[me]=U,ie=me):(O[ie]=ae,O[se]=U,ie=se);else if(me<V&&0>i(xe,U))O[ie]=xe,O[me]=U,ie=me;else break e}}return W}function i(O,W){var U=O.sortIndex-W.sortIndex;return U!==0?U:O.id-W.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var u=[],h=[],d=1,g=null,y=3,v=!1,T=!1,w=!1,E=!1,S=typeof setTimeout=="function"?setTimeout:null,P=typeof clearTimeout=="function"?clearTimeout:null,I=typeof setImmediate<"u"?setImmediate:null;function L(O){for(var W=t(h);W!==null;){if(W.callback===null)r(h);else if(W.startTime<=O)r(h),W.sortIndex=W.expirationTime,e(u,W);else break;W=t(h)}}function F(O){if(w=!1,L(O),!T)if(t(u)!==null)T=!0,Y||(Y=!0,K());else{var W=t(h);W!==null&&Ee(F,W.startTime-O)}}var Y=!1,k=-1,M=5,N=-1;function H(){return E?!0:!(n.unstable_now()-N<M)}function q(){if(E=!1,Y){var O=n.unstable_now();N=O;var W=!0;try{e:{T=!1,w&&(w=!1,P(k),k=-1),v=!0;var U=y;try{t:{for(L(O),g=t(u);g!==null&&!(g.expirationTime>O&&H());){var ie=g.callback;if(typeof ie=="function"){g.callback=null,y=g.priorityLevel;var V=ie(g.expirationTime<=O);if(O=n.unstable_now(),typeof V=="function"){g.callback=V,L(O),W=!0;break t}g===t(u)&&r(u),L(O)}else r(u);g=t(u)}if(g!==null)W=!0;else{var Z=t(h);Z!==null&&Ee(F,Z.startTime-O),W=!1}}break e}finally{g=null,y=U,v=!1}W=void 0}}finally{W?K():Y=!1}}}var K;if(typeof I=="function")K=function(){I(q)};else if(typeof MessageChannel<"u"){var j=new MessageChannel,de=j.port2;j.port1.onmessage=q,K=function(){de.postMessage(null)}}else K=function(){S(q,0)};function Ee(O,W){k=S(function(){O(n.unstable_now())},W)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(O){O.callback=null},n.unstable_forceFrameRate=function(O){0>O||125<O?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<O?Math.floor(1e3/O):5},n.unstable_getCurrentPriorityLevel=function(){return y},n.unstable_next=function(O){switch(y){case 1:case 2:case 3:var W=3;break;default:W=y}var U=y;y=W;try{return O()}finally{y=U}},n.unstable_requestPaint=function(){E=!0},n.unstable_runWithPriority=function(O,W){switch(O){case 1:case 2:case 3:case 4:case 5:break;default:O=3}var U=y;y=O;try{return W()}finally{y=U}},n.unstable_scheduleCallback=function(O,W,U){var ie=n.unstable_now();switch(typeof U=="object"&&U!==null?(U=U.delay,U=typeof U=="number"&&0<U?ie+U:ie):U=ie,O){case 1:var V=-1;break;case 2:V=250;break;case 5:V=1073741823;break;case 4:V=1e4;break;default:V=5e3}return V=U+V,O={id:d++,callback:W,priorityLevel:O,startTime:U,expirationTime:V,sortIndex:-1},U>ie?(O.sortIndex=U,e(h,O),t(u)===null&&O===t(h)&&(w?(P(k),k=-1):w=!0,Ee(F,U-ie))):(O.sortIndex=V,e(u,O),T||v||(T=!0,Y||(Y=!0,K()))),O},n.unstable_shouldYield=H,n.unstable_wrapCallback=function(O){var W=y;return function(){var U=y;y=W;try{return O.apply(this,arguments)}finally{y=U}}}})(w0)),w0}var pC;function w8(){return pC||(pC=1,T0.exports=T8()),T0.exports}var x0={exports:{}},Xn={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gC;function x8(){if(gC)return Xn;gC=1;var n=Xx();function e(u){var h="https://react.dev/errors/"+u;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)h+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+u+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var r={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},i=Symbol.for("react.portal");function s(u,h,d){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:g==null?null:""+g,children:u,containerInfo:h,implementation:d}}var o=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function a(u,h){if(u==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return Xn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Xn.createPortal=function(u,h){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(e(299));return s(u,h,null,d)},Xn.flushSync=function(u){var h=o.T,d=r.p;try{if(o.T=null,r.p=2,u)return u()}finally{o.T=h,r.p=d,r.d.f()}},Xn.preconnect=function(u,h){typeof u=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,r.d.C(u,h))},Xn.prefetchDNS=function(u){typeof u=="string"&&r.d.D(u)},Xn.preinit=function(u,h){if(typeof u=="string"&&h&&typeof h.as=="string"){var d=h.as,g=a(d,h.crossOrigin),y=typeof h.integrity=="string"?h.integrity:void 0,v=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;d==="style"?r.d.S(u,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:g,integrity:y,fetchPriority:v}):d==="script"&&r.d.X(u,{crossOrigin:g,integrity:y,fetchPriority:v,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},Xn.preinitModule=function(u,h){if(typeof u=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var d=a(h.as,h.crossOrigin);r.d.M(u,{crossOrigin:d,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&r.d.M(u)},Xn.preload=function(u,h){if(typeof u=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var d=h.as,g=a(d,h.crossOrigin);r.d.L(u,d,{crossOrigin:g,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},Xn.preloadModule=function(u,h){if(typeof u=="string")if(h){var d=a(h.as,h.crossOrigin);r.d.m(u,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:d,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else r.d.m(u)},Xn.requestFormReset=function(u){r.d.r(u)},Xn.unstable_batchedUpdates=function(u,h){return u(h)},Xn.useFormState=function(u,h,d){return o.H.useFormState(u,h,d)},Xn.useFormStatus=function(){return o.H.useHostTransitionStatus()},Xn.version="19.1.1",Xn}var mC;function Bk(){if(mC)return x0.exports;mC=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),x0.exports=x8(),x0.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yC;function E8(){if(yC)return Hf;yC=1;var n=w8(),e=Xx(),t=Bk();function r(l){var c="https://react.dev/errors/"+l;if(1<arguments.length){c+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)c+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+l+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(l){return!(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11)}function s(l){var c=l,f=l;if(l.alternate)for(;c.return;)c=c.return;else{l=c;do c=l,(c.flags&4098)!==0&&(f=c.return),l=c.return;while(l)}return c.tag===3?f:null}function o(l){if(l.tag===13){var c=l.memoizedState;if(c===null&&(l=l.alternate,l!==null&&(c=l.memoizedState)),c!==null)return c.dehydrated}return null}function a(l){if(s(l)!==l)throw Error(r(188))}function u(l){var c=l.alternate;if(!c){if(c=s(l),c===null)throw Error(r(188));return c!==l?null:l}for(var f=l,p=c;;){var _=f.return;if(_===null)break;var b=_.alternate;if(b===null){if(p=_.return,p!==null){f=p;continue}break}if(_.child===b.child){for(b=_.child;b;){if(b===f)return a(_),l;if(b===p)return a(_),c;b=b.sibling}throw Error(r(188))}if(f.return!==p.return)f=_,p=b;else{for(var C=!1,D=_.child;D;){if(D===f){C=!0,f=_,p=b;break}if(D===p){C=!0,p=_,f=b;break}D=D.sibling}if(!C){for(D=b.child;D;){if(D===f){C=!0,f=b,p=_;break}if(D===p){C=!0,p=b,f=_;break}D=D.sibling}if(!C)throw Error(r(189))}}if(f.alternate!==p)throw Error(r(190))}if(f.tag!==3)throw Error(r(188));return f.stateNode.current===f?l:c}function h(l){var c=l.tag;if(c===5||c===26||c===27||c===6)return l;for(l=l.child;l!==null;){if(c=h(l),c!==null)return c;l=l.sibling}return null}var d=Object.assign,g=Symbol.for("react.element"),y=Symbol.for("react.transitional.element"),v=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),w=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),S=Symbol.for("react.provider"),P=Symbol.for("react.consumer"),I=Symbol.for("react.context"),L=Symbol.for("react.forward_ref"),F=Symbol.for("react.suspense"),Y=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),M=Symbol.for("react.lazy"),N=Symbol.for("react.activity"),H=Symbol.for("react.memo_cache_sentinel"),q=Symbol.iterator;function K(l){return l===null||typeof l!="object"?null:(l=q&&l[q]||l["@@iterator"],typeof l=="function"?l:null)}var j=Symbol.for("react.client.reference");function de(l){if(l==null)return null;if(typeof l=="function")return l.$$typeof===j?null:l.displayName||l.name||null;if(typeof l=="string")return l;switch(l){case T:return"Fragment";case E:return"Profiler";case w:return"StrictMode";case F:return"Suspense";case Y:return"SuspenseList";case N:return"Activity"}if(typeof l=="object")switch(l.$$typeof){case v:return"Portal";case I:return(l.displayName||"Context")+".Provider";case P:return(l._context.displayName||"Context")+".Consumer";case L:var c=l.render;return l=l.displayName,l||(l=c.displayName||c.name||"",l=l!==""?"ForwardRef("+l+")":"ForwardRef"),l;case k:return c=l.displayName||null,c!==null?c:de(l.type)||"Memo";case M:c=l._payload,l=l._init;try{return de(l(c))}catch{}}return null}var Ee=Array.isArray,O=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,W=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,U={pending:!1,data:null,method:null,action:null},ie=[],V=-1;function Z(l){return{current:l}}function se(l){0>V||(l.current=ie[V],ie[V]=null,V--)}function ae(l,c){V++,ie[V]=l.current,l.current=c}var me=Z(null),xe=Z(null),Se=Z(null),Ce=Z(null);function Me(l,c){switch(ae(Se,c),ae(xe,l),ae(me,null),c.nodeType){case 9:case 11:l=(l=c.documentElement)&&(l=l.namespaceURI)?UR(l):0;break;default:if(l=c.tagName,c=c.namespaceURI)c=UR(c),l=VR(c,l);else switch(l){case"svg":l=1;break;case"math":l=2;break;default:l=0}}se(me),ae(me,l)}function lt(){se(me),se(xe),se(Se)}function Ge(l){l.memoizedState!==null&&ae(Ce,l);var c=me.current,f=VR(c,l.type);c!==f&&(ae(xe,l),ae(me,f))}function xn(l){xe.current===l&&(se(me),se(xe)),Ce.current===l&&(se(Ce),Uf._currentValue=U)}var fn=Object.prototype.hasOwnProperty,sr=n.unstable_scheduleCallback,_s=n.unstable_cancelCallback,ct=n.unstable_shouldYield,nt=n.unstable_requestPaint,pr=n.unstable_now,Dp=n.unstable_getCurrentPriorityLevel,dn=n.unstable_ImmediatePriority,En=n.unstable_UserBlockingPriority,vs=n.unstable_NormalPriority,bv=n.unstable_LowPriority,Uh=n.unstable_IdlePriority,Tv=n.log,Ha=n.unstable_setDisableYieldValue,go=null,$n=null;function Fr(l){if(typeof Tv=="function"&&Ha(l),$n&&typeof $n.setStrictMode=="function")try{$n.setStrictMode(go,l)}catch{}}var or=Math.clz32?Math.clz32:Up,wv=Math.log,Lp=Math.LN2;function Up(l){return l>>>=0,l===0?32:31-(wv(l)/Lp|0)|0}var ki=256,mo=4194304;function ci(l){var c=l&42;if(c!==0)return c;switch(l&-l){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return l&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return l}}function Br(l,c,f){var p=l.pendingLanes;if(p===0)return 0;var _=0,b=l.suspendedLanes,C=l.pingedLanes;l=l.warmLanes;var D=p&134217727;return D!==0?(p=D&~b,p!==0?_=ci(p):(C&=D,C!==0?_=ci(C):f||(f=D&~l,f!==0&&(_=ci(f))))):(D=p&~b,D!==0?_=ci(D):C!==0?_=ci(C):f||(f=p&~l,f!==0&&(_=ci(f)))),_===0?0:c!==0&&c!==_&&(c&b)===0&&(b=_&-_,f=c&-c,b>=f||b===32&&(f&4194048)!==0)?c:_}function yo(l,c){return(l.pendingLanes&~(l.suspendedLanes&~l.pingedLanes)&c)===0}function pc(l,c){switch(l){case 1:case 2:case 4:case 8:case 64:return c+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Vh(){var l=ki;return ki<<=1,(ki&4194048)===0&&(ki=256),l}function _o(){var l=mo;return mo<<=1,(mo&62914560)===0&&(mo=4194304),l}function gc(l){for(var c=[],f=0;31>f;f++)c.push(l);return c}function Kt(l,c){l.pendingLanes|=c,c!==268435456&&(l.suspendedLanes=0,l.pingedLanes=0,l.warmLanes=0)}function Vp(l,c,f,p,_,b){var C=l.pendingLanes;l.pendingLanes=f,l.suspendedLanes=0,l.pingedLanes=0,l.warmLanes=0,l.expiredLanes&=f,l.entangledLanes&=f,l.errorRecoveryDisabledLanes&=f,l.shellSuspendCounter=0;var D=l.entanglements,G=l.expirationTimes,ue=l.hiddenUpdates;for(f=C&~f;0<f;){var ge=31-or(f),ve=1<<ge;D[ge]=0,G[ge]=-1;var he=ue[ge];if(he!==null)for(ue[ge]=null,ge=0;ge<he.length;ge++){var fe=he[ge];fe!==null&&(fe.lane&=-536870913)}f&=~ve}p!==0&&vo(l,p,0),b!==0&&_===0&&l.tag!==0&&(l.suspendedLanes|=b&~(C&~c))}function vo(l,c,f){l.pendingLanes|=c,l.suspendedLanes&=~c;var p=31-or(c);l.entangledLanes|=c,l.entanglements[p]=l.entanglements[p]|1073741824|f&4194090}function bo(l,c){var f=l.entangledLanes|=c;for(l=l.entanglements;f;){var p=31-or(f),_=1<<p;_&c|l[p]&c&&(l[p]|=c),f&=~_}}function Fh(l){switch(l){case 2:l=1;break;case 8:l=4;break;case 32:l=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:l=128;break;case 268435456:l=134217728;break;default:l=0}return l}function Bh(l){return l&=-l,2<l?8<l?(l&134217727)!==0?32:268435456:8:2}function bs(){var l=W.p;return l!==0?l:(l=window.event,l===void 0?32:rC(l.type))}function xv(l,c){var f=W.p;try{return W.p=l,c()}finally{W.p=f}}var Ni=Math.random().toString(36).slice(2),Gt="__reactFiber$"+Ni,kn="__reactProps$"+Ni,Ts="__reactContainer$"+Ni,$a="__reactEvents$"+Ni,Wa="__reactListeners$"+Ni,Ev="__reactHandles$"+Ni,ui="__reactResources$"+Ni,To="__reactMarker$"+Ni;function mc(l){delete l[Gt],delete l[kn],delete l[$a],delete l[Wa],delete l[Ev]}function Di(l){var c=l[Gt];if(c)return c;for(var f=l.parentNode;f;){if(c=f[Ts]||f[Gt]){if(f=c.alternate,c.child!==null||f!==null&&f.child!==null)for(l=jR(l);l!==null;){if(f=l[Gt])return f;l=jR(l)}return c}l=f,f=l.parentNode}return null}function Li(l){if(l=l[Gt]||l[Ts]){var c=l.tag;if(c===5||c===6||c===13||c===26||c===27||c===3)return l}return null}function wo(l){var c=l.tag;if(c===5||c===26||c===27||c===6)return l.stateNode;throw Error(r(33))}function xo(l){var c=l[ui];return c||(c=l[ui]={hoistableStyles:new Map,hoistableScripts:new Map}),c}function Zt(l){l[To]=!0}var Fp=new Set,qa={};function Ui(l,c){Vi(l,c),Vi(l+"Capture",c)}function Vi(l,c){for(qa[l]=c,l=0;l<c.length;l++)Fp.add(c[l])}var Xa=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Fi={},yc={};function Av(l){return fn.call(yc,l)?!0:fn.call(Fi,l)?!1:Xa.test(l)?yc[l]=!0:(Fi[l]=!0,!1)}function Ya(l,c,f){if(Av(c))if(f===null)l.removeAttribute(c);else{switch(typeof f){case"undefined":case"function":case"symbol":l.removeAttribute(c);return;case"boolean":var p=c.toLowerCase().slice(0,5);if(p!=="data-"&&p!=="aria-"){l.removeAttribute(c);return}}l.setAttribute(c,""+f)}}function Ka(l,c,f){if(f===null)l.removeAttribute(c);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":l.removeAttribute(c);return}l.setAttribute(c,""+f)}}function zr(l,c,f,p){if(p===null)l.removeAttribute(f);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":l.removeAttribute(f);return}l.setAttributeNS(c,f,""+p)}}var Ga,_c;function ws(l){if(Ga===void 0)try{throw Error()}catch(f){var c=f.stack.trim().match(/\n( *(at )?)/);Ga=c&&c[1]||"",_c=-1<f.stack.indexOf(`
    at`)?" (<anonymous>)":-1<f.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ga+l+_c}var vc=!1;function bc(l,c){if(!l||vc)return"";vc=!0;var f=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var p={DetermineComponentFrameRoot:function(){try{if(c){var ve=function(){throw Error()};if(Object.defineProperty(ve.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ve,[])}catch(fe){var he=fe}Reflect.construct(l,[],ve)}else{try{ve.call()}catch(fe){he=fe}l.call(ve.prototype)}}else{try{throw Error()}catch(fe){he=fe}(ve=l())&&typeof ve.catch=="function"&&ve.catch(function(){})}}catch(fe){if(fe&&he&&typeof fe.stack=="string")return[fe.stack,he.stack]}return[null,null]}};p.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var _=Object.getOwnPropertyDescriptor(p.DetermineComponentFrameRoot,"name");_&&_.configurable&&Object.defineProperty(p.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var b=p.DetermineComponentFrameRoot(),C=b[0],D=b[1];if(C&&D){var G=C.split(`
`),ue=D.split(`
`);for(_=p=0;p<G.length&&!G[p].includes("DetermineComponentFrameRoot");)p++;for(;_<ue.length&&!ue[_].includes("DetermineComponentFrameRoot");)_++;if(p===G.length||_===ue.length)for(p=G.length-1,_=ue.length-1;1<=p&&0<=_&&G[p]!==ue[_];)_--;for(;1<=p&&0<=_;p--,_--)if(G[p]!==ue[_]){if(p!==1||_!==1)do if(p--,_--,0>_||G[p]!==ue[_]){var ge=`
`+G[p].replace(" at new "," at ");return l.displayName&&ge.includes("<anonymous>")&&(ge=ge.replace("<anonymous>",l.displayName)),ge}while(1<=p&&0<=_);break}}}finally{vc=!1,Error.prepareStackTrace=f}return(f=l?l.displayName||l.name:"")?ws(f):""}function Sv(l){switch(l.tag){case 26:case 27:case 5:return ws(l.type);case 16:return ws("Lazy");case 13:return ws("Suspense");case 19:return ws("SuspenseList");case 0:case 15:return bc(l.type,!1);case 11:return bc(l.type.render,!1);case 1:return bc(l.type,!0);case 31:return ws("Activity");default:return""}}function hi(l){try{var c="";do c+=Sv(l),l=l.return;while(l);return c}catch(f){return`
Error generating stack: `+f.message+`
`+f.stack}}function Ut(l){switch(typeof l){case"bigint":case"boolean":case"number":case"string":case"undefined":return l;case"object":return l;default:return""}}function Eo(l){var c=l.type;return(l=l.nodeName)&&l.toLowerCase()==="input"&&(c==="checkbox"||c==="radio")}function Za(l){var c=Eo(l)?"checked":"value",f=Object.getOwnPropertyDescriptor(l.constructor.prototype,c),p=""+l[c];if(!l.hasOwnProperty(c)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var _=f.get,b=f.set;return Object.defineProperty(l,c,{configurable:!0,get:function(){return _.call(this)},set:function(C){p=""+C,b.call(this,C)}}),Object.defineProperty(l,c,{enumerable:f.enumerable}),{getValue:function(){return p},setValue:function(C){p=""+C},stopTracking:function(){l._valueTracker=null,delete l[c]}}}}function Ao(l){l._valueTracker||(l._valueTracker=Za(l))}function Tt(l){if(!l)return!1;var c=l._valueTracker;if(!c)return!0;var f=c.getValue(),p="";return l&&(p=Eo(l)?l.checked?"true":"false":l.value),l=p,l!==f?(c.setValue(l),!0):!1}function xs(l){if(l=l||(typeof document<"u"?document:void 0),typeof l>"u")return null;try{return l.activeElement||l.body}catch{return l.body}}var Qa=/[\n"\\]/g;function An(l){return l.replace(Qa,function(c){return"\\"+c.charCodeAt(0).toString(16)+" "})}function zh(l,c,f,p,_,b,C,D){l.name="",C!=null&&typeof C!="function"&&typeof C!="symbol"&&typeof C!="boolean"?l.type=C:l.removeAttribute("type"),c!=null?C==="number"?(c===0&&l.value===""||l.value!=c)&&(l.value=""+Ut(c)):l.value!==""+Ut(c)&&(l.value=""+Ut(c)):C!=="submit"&&C!=="reset"||l.removeAttribute("value"),c!=null?Hh(l,C,Ut(c)):f!=null?Hh(l,C,Ut(f)):p!=null&&l.removeAttribute("value"),_==null&&b!=null&&(l.defaultChecked=!!b),_!=null&&(l.checked=_&&typeof _!="function"&&typeof _!="symbol"),D!=null&&typeof D!="function"&&typeof D!="symbol"&&typeof D!="boolean"?l.name=""+Ut(D):l.removeAttribute("name")}function jh(l,c,f,p,_,b,C,D){if(b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"&&(l.type=b),c!=null||f!=null){if(!(b!=="submit"&&b!=="reset"||c!=null))return;f=f!=null?""+Ut(f):"",c=c!=null?""+Ut(c):f,D||c===l.value||(l.value=c),l.defaultValue=c}p=p??_,p=typeof p!="function"&&typeof p!="symbol"&&!!p,l.checked=D?l.checked:!!p,l.defaultChecked=!!p,C!=null&&typeof C!="function"&&typeof C!="symbol"&&typeof C!="boolean"&&(l.name=C)}function Hh(l,c,f){c==="number"&&xs(l.ownerDocument)===l||l.defaultValue===""+f||(l.defaultValue=""+f)}function So(l,c,f,p){if(l=l.options,c){c={};for(var _=0;_<f.length;_++)c["$"+f[_]]=!0;for(f=0;f<l.length;f++)_=c.hasOwnProperty("$"+l[f].value),l[f].selected!==_&&(l[f].selected=_),_&&p&&(l[f].defaultSelected=!0)}else{for(f=""+Ut(f),c=null,_=0;_<l.length;_++){if(l[_].value===f){l[_].selected=!0,p&&(l[_].defaultSelected=!0);return}c!==null||l[_].disabled||(c=l[_])}c!==null&&(c.selected=!0)}}function Bp(l,c,f){if(c!=null&&(c=""+Ut(c),c!==l.value&&(l.value=c),f==null)){l.defaultValue!==c&&(l.defaultValue=c);return}l.defaultValue=f!=null?""+Ut(f):""}function zp(l,c,f,p){if(c==null){if(p!=null){if(f!=null)throw Error(r(92));if(Ee(p)){if(1<p.length)throw Error(r(93));p=p[0]}f=p}f==null&&(f=""),c=f}f=Ut(c),l.defaultValue=f,p=l.textContent,p===f&&p!==""&&p!==null&&(l.value=p)}function jr(l,c){if(c){var f=l.firstChild;if(f&&f===l.lastChild&&f.nodeType===3){f.nodeValue=c;return}}l.textContent=c}var Es=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function $h(l,c,f){var p=c.indexOf("--")===0;f==null||typeof f=="boolean"||f===""?p?l.setProperty(c,""):c==="float"?l.cssFloat="":l[c]="":p?l.setProperty(c,f):typeof f!="number"||f===0||Es.has(c)?c==="float"?l.cssFloat=f:l[c]=(""+f).trim():l[c]=f+"px"}function Wh(l,c,f){if(c!=null&&typeof c!="object")throw Error(r(62));if(l=l.style,f!=null){for(var p in f)!f.hasOwnProperty(p)||c!=null&&c.hasOwnProperty(p)||(p.indexOf("--")===0?l.setProperty(p,""):p==="float"?l.cssFloat="":l[p]="");for(var _ in c)p=c[_],c.hasOwnProperty(_)&&f[_]!==p&&$h(l,_,p)}else for(var b in c)c.hasOwnProperty(b)&&$h(l,b,c[b])}function Tc(l){if(l.indexOf("-")===-1)return!1;switch(l){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var jp=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Hp=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function fi(l){return Hp.test(""+l)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":l}var qh=null;function Xh(l){return l=l.target||l.srcElement||window,l.correspondingUseElement&&(l=l.correspondingUseElement),l.nodeType===3?l.parentNode:l}var Ro=null,ar=null;function $p(l){var c=Li(l);if(c&&(l=c.stateNode)){var f=l[kn]||null;e:switch(l=c.stateNode,c.type){case"input":if(zh(l,f.value,f.defaultValue,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name),c=f.name,f.type==="radio"&&c!=null){for(f=l;f.parentNode;)f=f.parentNode;for(f=f.querySelectorAll('input[name="'+An(""+c)+'"][type="radio"]'),c=0;c<f.length;c++){var p=f[c];if(p!==l&&p.form===l.form){var _=p[kn]||null;if(!_)throw Error(r(90));zh(p,_.value,_.defaultValue,_.defaultValue,_.checked,_.defaultChecked,_.type,_.name)}}for(c=0;c<f.length;c++)p=f[c],p.form===l.form&&Tt(p)}break e;case"textarea":Bp(l,f.value,f.defaultValue);break e;case"select":c=f.value,c!=null&&So(l,!!f.multiple,c,!1)}}}var Ja=!1;function el(l,c,f){if(Ja)return l(c,f);Ja=!0;try{var p=l(c);return p}finally{if(Ja=!1,(Ro!==null||ar!==null)&&(kg(),Ro&&(c=Ro,l=ar,ar=Ro=null,$p(c),l)))for(c=0;c<l.length;c++)$p(l[c])}}function Co(l,c){var f=l.stateNode;if(f===null)return null;var p=f[kn]||null;if(p===null)return null;f=p[c];e:switch(c){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(l=l.type,p=!(l==="button"||l==="input"||l==="select"||l==="textarea")),l=!p;break e;default:l=!1}if(l)return null;if(f&&typeof f!="function")throw Error(r(231,c,typeof f));return f}var lr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),As=!1;if(lr)try{var Io={};Object.defineProperty(Io,"passive",{get:function(){As=!0}}),window.addEventListener("test",Io,Io),window.removeEventListener("test",Io,Io)}catch{As=!1}var Hr=null,Pt=null,wc=null;function Wp(){if(wc)return wc;var l,c=Pt,f=c.length,p,_="value"in Hr?Hr.value:Hr.textContent,b=_.length;for(l=0;l<f&&c[l]===_[l];l++);var C=f-l;for(p=1;p<=C&&c[f-p]===_[b-p];p++);return wc=_.slice(l,1<p?1-p:void 0)}function tl(l){var c=l.keyCode;return"charCode"in l?(l=l.charCode,l===0&&c===13&&(l=13)):l=c,l===10&&(l=13),32<=l||l===13?l:0}function nl(){return!0}function Yh(){return!1}function pn(l){function c(f,p,_,b,C){this._reactName=f,this._targetInst=_,this.type=p,this.nativeEvent=b,this.target=C,this.currentTarget=null;for(var D in l)l.hasOwnProperty(D)&&(f=l[D],this[D]=f?f(b):b[D]);return this.isDefaultPrevented=(b.defaultPrevented!=null?b.defaultPrevented:b.returnValue===!1)?nl:Yh,this.isPropagationStopped=Yh,this}return d(c.prototype,{preventDefault:function(){this.defaultPrevented=!0;var f=this.nativeEvent;f&&(f.preventDefault?f.preventDefault():typeof f.returnValue!="unknown"&&(f.returnValue=!1),this.isDefaultPrevented=nl)},stopPropagation:function(){var f=this.nativeEvent;f&&(f.stopPropagation?f.stopPropagation():typeof f.cancelBubble!="unknown"&&(f.cancelBubble=!0),this.isPropagationStopped=nl)},persist:function(){},isPersistent:nl}),c}var Wn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(l){return l.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},rl=pn(Wn),il=d({},Wn,{view:0,detail:0}),sl=pn(il),xc,ol,Bi,al=d({},il,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Sc,button:0,buttons:0,relatedTarget:function(l){return l.relatedTarget===void 0?l.fromElement===l.srcElement?l.toElement:l.fromElement:l.relatedTarget},movementX:function(l){return"movementX"in l?l.movementX:(l!==Bi&&(Bi&&l.type==="mousemove"?(xc=l.screenX-Bi.screenX,ol=l.screenY-Bi.screenY):ol=xc=0,Bi=l),xc)},movementY:function(l){return"movementY"in l?l.movementY:ol}}),ll=pn(al),Rv=d({},al,{dataTransfer:0}),qp=pn(Rv),cl=d({},il,{relatedTarget:0}),Ec=pn(cl),Xp=d({},Wn,{animationName:0,elapsedTime:0,pseudoElement:0}),Kh=pn(Xp),Gh=d({},Wn,{clipboardData:function(l){return"clipboardData"in l?l.clipboardData:window.clipboardData}}),Yp=pn(Gh),Ac=d({},Wn,{data:0}),Zh=pn(Ac),Kp={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ss={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Gp={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Zp(l){var c=this.nativeEvent;return c.getModifierState?c.getModifierState(l):(l=Gp[l])?!!c[l]:!1}function Sc(){return Zp}var Qp=d({},il,{key:function(l){if(l.key){var c=Kp[l.key]||l.key;if(c!=="Unidentified")return c}return l.type==="keypress"?(l=tl(l),l===13?"Enter":String.fromCharCode(l)):l.type==="keydown"||l.type==="keyup"?Ss[l.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Sc,charCode:function(l){return l.type==="keypress"?tl(l):0},keyCode:function(l){return l.type==="keydown"||l.type==="keyup"?l.keyCode:0},which:function(l){return l.type==="keypress"?tl(l):l.type==="keydown"||l.type==="keyup"?l.keyCode:0}}),Rc=pn(Qp),cr=d({},al,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Qh=pn(cr),Jp=d({},il,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Sc}),Po=pn(Jp),m=d({},Wn,{propertyName:0,elapsedTime:0,pseudoElement:0}),x=pn(m),R=d({},al,{deltaX:function(l){return"deltaX"in l?l.deltaX:"wheelDeltaX"in l?-l.wheelDeltaX:0},deltaY:function(l){return"deltaY"in l?l.deltaY:"wheelDeltaY"in l?-l.wheelDeltaY:"wheelDelta"in l?-l.wheelDelta:0},deltaZ:0,deltaMode:0}),B=pn(R),ce=d({},Wn,{newState:0,oldState:0}),pe=pn(ce),Ae=[9,13,27,32],qe=lr&&"CompositionEvent"in window,Ot=null;lr&&"documentMode"in document&&(Ot=document.documentMode);var yt=lr&&"TextEvent"in window&&!Ot,Qt=lr&&(!qe||Ot&&8<Ot&&11>=Ot),Er=" ",zi=!1;function di(l,c){switch(l){case"keyup":return Ae.indexOf(c.keyCode)!==-1;case"keydown":return c.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function pi(l){return l=l.detail,typeof l=="object"&&"data"in l?l.data:null}var gi=!1;function Jh(l,c){switch(l){case"compositionend":return pi(c);case"keypress":return c.which!==32?null:(zi=!0,Er);case"textInput":return l=c.data,l===Er&&zi?null:l;default:return null}}function $B(l,c){if(gi)return l==="compositionend"||!qe&&di(l,c)?(l=Wp(),wc=Pt=Hr=null,gi=!1,l):null;switch(l){case"paste":return null;case"keypress":if(!(c.ctrlKey||c.altKey||c.metaKey)||c.ctrlKey&&c.altKey){if(c.char&&1<c.char.length)return c.char;if(c.which)return String.fromCharCode(c.which)}return null;case"compositionend":return Qt&&c.locale!=="ko"?null:c.data;default:return null}}var WB={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ZA(l){var c=l&&l.nodeName&&l.nodeName.toLowerCase();return c==="input"?!!WB[l.type]:c==="textarea"}function QA(l,c,f,p){Ro?ar?ar.push(p):ar=[p]:Ro=p,c=Fg(c,"onChange"),0<c.length&&(f=new rl("onChange","change",null,f,p),l.push({event:f,listeners:c}))}var ef=null,tf=null;function qB(l){OR(l,0)}function eg(l){var c=wo(l);if(Tt(c))return l}function JA(l,c){if(l==="change")return c}var eS=!1;if(lr){var Cv;if(lr){var Iv="oninput"in document;if(!Iv){var tS=document.createElement("div");tS.setAttribute("oninput","return;"),Iv=typeof tS.oninput=="function"}Cv=Iv}else Cv=!1;eS=Cv&&(!document.documentMode||9<document.documentMode)}function nS(){ef&&(ef.detachEvent("onpropertychange",rS),tf=ef=null)}function rS(l){if(l.propertyName==="value"&&eg(tf)){var c=[];QA(c,tf,l,Xh(l)),el(qB,c)}}function XB(l,c,f){l==="focusin"?(nS(),ef=c,tf=f,ef.attachEvent("onpropertychange",rS)):l==="focusout"&&nS()}function YB(l){if(l==="selectionchange"||l==="keyup"||l==="keydown")return eg(tf)}function KB(l,c){if(l==="click")return eg(c)}function GB(l,c){if(l==="input"||l==="change")return eg(c)}function ZB(l,c){return l===c&&(l!==0||1/l===1/c)||l!==l&&c!==c}var Ar=typeof Object.is=="function"?Object.is:ZB;function nf(l,c){if(Ar(l,c))return!0;if(typeof l!="object"||l===null||typeof c!="object"||c===null)return!1;var f=Object.keys(l),p=Object.keys(c);if(f.length!==p.length)return!1;for(p=0;p<f.length;p++){var _=f[p];if(!fn.call(c,_)||!Ar(l[_],c[_]))return!1}return!0}function iS(l){for(;l&&l.firstChild;)l=l.firstChild;return l}function sS(l,c){var f=iS(l);l=0;for(var p;f;){if(f.nodeType===3){if(p=l+f.textContent.length,l<=c&&p>=c)return{node:f,offset:c-l};l=p}e:{for(;f;){if(f.nextSibling){f=f.nextSibling;break e}f=f.parentNode}f=void 0}f=iS(f)}}function oS(l,c){return l&&c?l===c?!0:l&&l.nodeType===3?!1:c&&c.nodeType===3?oS(l,c.parentNode):"contains"in l?l.contains(c):l.compareDocumentPosition?!!(l.compareDocumentPosition(c)&16):!1:!1}function aS(l){l=l!=null&&l.ownerDocument!=null&&l.ownerDocument.defaultView!=null?l.ownerDocument.defaultView:window;for(var c=xs(l.document);c instanceof l.HTMLIFrameElement;){try{var f=typeof c.contentWindow.location.href=="string"}catch{f=!1}if(f)l=c.contentWindow;else break;c=xs(l.document)}return c}function Pv(l){var c=l&&l.nodeName&&l.nodeName.toLowerCase();return c&&(c==="input"&&(l.type==="text"||l.type==="search"||l.type==="tel"||l.type==="url"||l.type==="password")||c==="textarea"||l.contentEditable==="true")}var QB=lr&&"documentMode"in document&&11>=document.documentMode,Cc=null,Mv=null,rf=null,Ov=!1;function lS(l,c,f){var p=f.window===f?f.document:f.nodeType===9?f:f.ownerDocument;Ov||Cc==null||Cc!==xs(p)||(p=Cc,"selectionStart"in p&&Pv(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),rf&&nf(rf,p)||(rf=p,p=Fg(Mv,"onSelect"),0<p.length&&(c=new rl("onSelect","select",null,c,f),l.push({event:c,listeners:p}),c.target=Cc)))}function ul(l,c){var f={};return f[l.toLowerCase()]=c.toLowerCase(),f["Webkit"+l]="webkit"+c,f["Moz"+l]="moz"+c,f}var Ic={animationend:ul("Animation","AnimationEnd"),animationiteration:ul("Animation","AnimationIteration"),animationstart:ul("Animation","AnimationStart"),transitionrun:ul("Transition","TransitionRun"),transitionstart:ul("Transition","TransitionStart"),transitioncancel:ul("Transition","TransitionCancel"),transitionend:ul("Transition","TransitionEnd")},kv={},cS={};lr&&(cS=document.createElement("div").style,"AnimationEvent"in window||(delete Ic.animationend.animation,delete Ic.animationiteration.animation,delete Ic.animationstart.animation),"TransitionEvent"in window||delete Ic.transitionend.transition);function hl(l){if(kv[l])return kv[l];if(!Ic[l])return l;var c=Ic[l],f;for(f in c)if(c.hasOwnProperty(f)&&f in cS)return kv[l]=c[f];return l}var uS=hl("animationend"),hS=hl("animationiteration"),fS=hl("animationstart"),JB=hl("transitionrun"),e5=hl("transitionstart"),t5=hl("transitioncancel"),dS=hl("transitionend"),pS=new Map,Nv="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Nv.push("scrollEnd");function mi(l,c){pS.set(l,c),Ui(c,[l])}var gS=new WeakMap;function $r(l,c){if(typeof l=="object"&&l!==null){var f=gS.get(l);return f!==void 0?f:(c={value:l,source:c,stack:hi(c)},gS.set(l,c),c)}return{value:l,source:c,stack:hi(c)}}var Wr=[],Pc=0,Dv=0;function tg(){for(var l=Pc,c=Dv=Pc=0;c<l;){var f=Wr[c];Wr[c++]=null;var p=Wr[c];Wr[c++]=null;var _=Wr[c];Wr[c++]=null;var b=Wr[c];if(Wr[c++]=null,p!==null&&_!==null){var C=p.pending;C===null?_.next=_:(_.next=C.next,C.next=_),p.pending=_}b!==0&&mS(f,_,b)}}function ng(l,c,f,p){Wr[Pc++]=l,Wr[Pc++]=c,Wr[Pc++]=f,Wr[Pc++]=p,Dv|=p,l.lanes|=p,l=l.alternate,l!==null&&(l.lanes|=p)}function Lv(l,c,f,p){return ng(l,c,f,p),rg(l)}function Mc(l,c){return ng(l,null,null,c),rg(l)}function mS(l,c,f){l.lanes|=f;var p=l.alternate;p!==null&&(p.lanes|=f);for(var _=!1,b=l.return;b!==null;)b.childLanes|=f,p=b.alternate,p!==null&&(p.childLanes|=f),b.tag===22&&(l=b.stateNode,l===null||l._visibility&1||(_=!0)),l=b,b=b.return;return l.tag===3?(b=l.stateNode,_&&c!==null&&(_=31-or(f),l=b.hiddenUpdates,p=l[_],p===null?l[_]=[c]:p.push(c),c.lane=f|536870912),b):null}function rg(l){if(50<If)throw If=0,jb=null,Error(r(185));for(var c=l.return;c!==null;)l=c,c=l.return;return l.tag===3?l.stateNode:null}var Oc={};function n5(l,c,f,p){this.tag=l,this.key=f,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=c,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Sr(l,c,f,p){return new n5(l,c,f,p)}function Uv(l){return l=l.prototype,!(!l||!l.isReactComponent)}function Rs(l,c){var f=l.alternate;return f===null?(f=Sr(l.tag,c,l.key,l.mode),f.elementType=l.elementType,f.type=l.type,f.stateNode=l.stateNode,f.alternate=l,l.alternate=f):(f.pendingProps=c,f.type=l.type,f.flags=0,f.subtreeFlags=0,f.deletions=null),f.flags=l.flags&65011712,f.childLanes=l.childLanes,f.lanes=l.lanes,f.child=l.child,f.memoizedProps=l.memoizedProps,f.memoizedState=l.memoizedState,f.updateQueue=l.updateQueue,c=l.dependencies,f.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext},f.sibling=l.sibling,f.index=l.index,f.ref=l.ref,f.refCleanup=l.refCleanup,f}function yS(l,c){l.flags&=65011714;var f=l.alternate;return f===null?(l.childLanes=0,l.lanes=c,l.child=null,l.subtreeFlags=0,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null):(l.childLanes=f.childLanes,l.lanes=f.lanes,l.child=f.child,l.subtreeFlags=0,l.deletions=null,l.memoizedProps=f.memoizedProps,l.memoizedState=f.memoizedState,l.updateQueue=f.updateQueue,l.type=f.type,c=f.dependencies,l.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext}),l}function ig(l,c,f,p,_,b){var C=0;if(p=l,typeof l=="function")Uv(l)&&(C=1);else if(typeof l=="string")C=i8(l,f,me.current)?26:l==="html"||l==="head"||l==="body"?27:5;else e:switch(l){case N:return l=Sr(31,f,c,_),l.elementType=N,l.lanes=b,l;case T:return fl(f.children,_,b,c);case w:C=8,_|=24;break;case E:return l=Sr(12,f,c,_|2),l.elementType=E,l.lanes=b,l;case F:return l=Sr(13,f,c,_),l.elementType=F,l.lanes=b,l;case Y:return l=Sr(19,f,c,_),l.elementType=Y,l.lanes=b,l;default:if(typeof l=="object"&&l!==null)switch(l.$$typeof){case S:case I:C=10;break e;case P:C=9;break e;case L:C=11;break e;case k:C=14;break e;case M:C=16,p=null;break e}C=29,f=Error(r(130,l===null?"null":typeof l,"")),p=null}return c=Sr(C,f,c,_),c.elementType=l,c.type=p,c.lanes=b,c}function fl(l,c,f,p){return l=Sr(7,l,p,c),l.lanes=f,l}function Vv(l,c,f){return l=Sr(6,l,null,c),l.lanes=f,l}function Fv(l,c,f){return c=Sr(4,l.children!==null?l.children:[],l.key,c),c.lanes=f,c.stateNode={containerInfo:l.containerInfo,pendingChildren:null,implementation:l.implementation},c}var kc=[],Nc=0,sg=null,og=0,qr=[],Xr=0,dl=null,Cs=1,Is="";function pl(l,c){kc[Nc++]=og,kc[Nc++]=sg,sg=l,og=c}function _S(l,c,f){qr[Xr++]=Cs,qr[Xr++]=Is,qr[Xr++]=dl,dl=l;var p=Cs;l=Is;var _=32-or(p)-1;p&=~(1<<_),f+=1;var b=32-or(c)+_;if(30<b){var C=_-_%5;b=(p&(1<<C)-1).toString(32),p>>=C,_-=C,Cs=1<<32-or(c)+_|f<<_|p,Is=b+l}else Cs=1<<b|f<<_|p,Is=l}function Bv(l){l.return!==null&&(pl(l,1),_S(l,1,0))}function zv(l){for(;l===sg;)sg=kc[--Nc],kc[Nc]=null,og=kc[--Nc],kc[Nc]=null;for(;l===dl;)dl=qr[--Xr],qr[Xr]=null,Is=qr[--Xr],qr[Xr]=null,Cs=qr[--Xr],qr[Xr]=null}var ur=null,$t=null,dt=!1,gl=null,ji=!1,jv=Error(r(519));function ml(l){var c=Error(r(418,""));throw af($r(c,l)),jv}function vS(l){var c=l.stateNode,f=l.type,p=l.memoizedProps;switch(c[Gt]=l,c[kn]=p,f){case"dialog":tt("cancel",c),tt("close",c);break;case"iframe":case"object":case"embed":tt("load",c);break;case"video":case"audio":for(f=0;f<Mf.length;f++)tt(Mf[f],c);break;case"source":tt("error",c);break;case"img":case"image":case"link":tt("error",c),tt("load",c);break;case"details":tt("toggle",c);break;case"input":tt("invalid",c),jh(c,p.value,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name,!0),Ao(c);break;case"select":tt("invalid",c);break;case"textarea":tt("invalid",c),zp(c,p.value,p.defaultValue,p.children),Ao(c)}f=p.children,typeof f!="string"&&typeof f!="number"&&typeof f!="bigint"||c.textContent===""+f||p.suppressHydrationWarning===!0||LR(c.textContent,f)?(p.popover!=null&&(tt("beforetoggle",c),tt("toggle",c)),p.onScroll!=null&&tt("scroll",c),p.onScrollEnd!=null&&tt("scrollend",c),p.onClick!=null&&(c.onclick=Bg),c=!0):c=!1,c||ml(l)}function bS(l){for(ur=l.return;ur;)switch(ur.tag){case 5:case 13:ji=!1;return;case 27:case 3:ji=!0;return;default:ur=ur.return}}function sf(l){if(l!==ur)return!1;if(!dt)return bS(l),dt=!0,!1;var c=l.tag,f;if((f=c!==3&&c!==27)&&((f=c===5)&&(f=l.type,f=!(f!=="form"&&f!=="button")||i0(l.type,l.memoizedProps)),f=!f),f&&$t&&ml(l),bS(l),c===13){if(l=l.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(r(317));e:{for(l=l.nextSibling,c=0;l;){if(l.nodeType===8)if(f=l.data,f==="/$"){if(c===0){$t=_i(l.nextSibling);break e}c--}else f!=="$"&&f!=="$!"&&f!=="$?"||c++;l=l.nextSibling}$t=null}}else c===27?(c=$t,qo(l.type)?(l=l0,l0=null,$t=l):$t=c):$t=ur?_i(l.stateNode.nextSibling):null;return!0}function of(){$t=ur=null,dt=!1}function TS(){var l=gl;return l!==null&&(yr===null?yr=l:yr.push.apply(yr,l),gl=null),l}function af(l){gl===null?gl=[l]:gl.push(l)}var Hv=Z(null),yl=null,Ps=null;function Mo(l,c,f){ae(Hv,c._currentValue),c._currentValue=f}function Ms(l){l._currentValue=Hv.current,se(Hv)}function $v(l,c,f){for(;l!==null;){var p=l.alternate;if((l.childLanes&c)!==c?(l.childLanes|=c,p!==null&&(p.childLanes|=c)):p!==null&&(p.childLanes&c)!==c&&(p.childLanes|=c),l===f)break;l=l.return}}function Wv(l,c,f,p){var _=l.child;for(_!==null&&(_.return=l);_!==null;){var b=_.dependencies;if(b!==null){var C=_.child;b=b.firstContext;e:for(;b!==null;){var D=b;b=_;for(var G=0;G<c.length;G++)if(D.context===c[G]){b.lanes|=f,D=b.alternate,D!==null&&(D.lanes|=f),$v(b.return,f,l),p||(C=null);break e}b=D.next}}else if(_.tag===18){if(C=_.return,C===null)throw Error(r(341));C.lanes|=f,b=C.alternate,b!==null&&(b.lanes|=f),$v(C,f,l),C=null}else C=_.child;if(C!==null)C.return=_;else for(C=_;C!==null;){if(C===l){C=null;break}if(_=C.sibling,_!==null){_.return=C.return,C=_;break}C=C.return}_=C}}function lf(l,c,f,p){l=null;for(var _=c,b=!1;_!==null;){if(!b){if((_.flags&524288)!==0)b=!0;else if((_.flags&262144)!==0)break}if(_.tag===10){var C=_.alternate;if(C===null)throw Error(r(387));if(C=C.memoizedProps,C!==null){var D=_.type;Ar(_.pendingProps.value,C.value)||(l!==null?l.push(D):l=[D])}}else if(_===Ce.current){if(C=_.alternate,C===null)throw Error(r(387));C.memoizedState.memoizedState!==_.memoizedState.memoizedState&&(l!==null?l.push(Uf):l=[Uf])}_=_.return}l!==null&&Wv(c,l,f,p),c.flags|=262144}function ag(l){for(l=l.firstContext;l!==null;){if(!Ar(l.context._currentValue,l.memoizedValue))return!0;l=l.next}return!1}function _l(l){yl=l,Ps=null,l=l.dependencies,l!==null&&(l.firstContext=null)}function qn(l){return wS(yl,l)}function lg(l,c){return yl===null&&_l(l),wS(l,c)}function wS(l,c){var f=c._currentValue;if(c={context:c,memoizedValue:f,next:null},Ps===null){if(l===null)throw Error(r(308));Ps=c,l.dependencies={lanes:0,firstContext:c},l.flags|=524288}else Ps=Ps.next=c;return f}var r5=typeof AbortController<"u"?AbortController:function(){var l=[],c=this.signal={aborted:!1,addEventListener:function(f,p){l.push(p)}};this.abort=function(){c.aborted=!0,l.forEach(function(f){return f()})}},i5=n.unstable_scheduleCallback,s5=n.unstable_NormalPriority,gn={$$typeof:I,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function qv(){return{controller:new r5,data:new Map,refCount:0}}function cf(l){l.refCount--,l.refCount===0&&i5(s5,function(){l.controller.abort()})}var uf=null,Xv=0,Dc=0,Lc=null;function o5(l,c){if(uf===null){var f=uf=[];Xv=0,Dc=Kb(),Lc={status:"pending",value:void 0,then:function(p){f.push(p)}}}return Xv++,c.then(xS,xS),c}function xS(){if(--Xv===0&&uf!==null){Lc!==null&&(Lc.status="fulfilled");var l=uf;uf=null,Dc=0,Lc=null;for(var c=0;c<l.length;c++)(0,l[c])()}}function a5(l,c){var f=[],p={status:"pending",value:null,reason:null,then:function(_){f.push(_)}};return l.then(function(){p.status="fulfilled",p.value=c;for(var _=0;_<f.length;_++)(0,f[_])(c)},function(_){for(p.status="rejected",p.reason=_,_=0;_<f.length;_++)(0,f[_])(void 0)}),p}var ES=O.S;O.S=function(l,c){typeof c=="object"&&c!==null&&typeof c.then=="function"&&o5(l,c),ES!==null&&ES(l,c)};var vl=Z(null);function Yv(){var l=vl.current;return l!==null?l:Mt.pooledCache}function cg(l,c){c===null?ae(vl,vl.current):ae(vl,c.pool)}function AS(){var l=Yv();return l===null?null:{parent:gn._currentValue,pool:l}}var hf=Error(r(460)),SS=Error(r(474)),ug=Error(r(542)),Kv={then:function(){}};function RS(l){return l=l.status,l==="fulfilled"||l==="rejected"}function hg(){}function CS(l,c,f){switch(f=l[f],f===void 0?l.push(c):f!==c&&(c.then(hg,hg),c=f),c.status){case"fulfilled":return c.value;case"rejected":throw l=c.reason,PS(l),l;default:if(typeof c.status=="string")c.then(hg,hg);else{if(l=Mt,l!==null&&100<l.shellSuspendCounter)throw Error(r(482));l=c,l.status="pending",l.then(function(p){if(c.status==="pending"){var _=c;_.status="fulfilled",_.value=p}},function(p){if(c.status==="pending"){var _=c;_.status="rejected",_.reason=p}})}switch(c.status){case"fulfilled":return c.value;case"rejected":throw l=c.reason,PS(l),l}throw ff=c,hf}}var ff=null;function IS(){if(ff===null)throw Error(r(459));var l=ff;return ff=null,l}function PS(l){if(l===hf||l===ug)throw Error(r(483))}var Oo=!1;function Gv(l){l.updateQueue={baseState:l.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Zv(l,c){l=l.updateQueue,c.updateQueue===l&&(c.updateQueue={baseState:l.baseState,firstBaseUpdate:l.firstBaseUpdate,lastBaseUpdate:l.lastBaseUpdate,shared:l.shared,callbacks:null})}function ko(l){return{lane:l,tag:0,payload:null,callback:null,next:null}}function No(l,c,f){var p=l.updateQueue;if(p===null)return null;if(p=p.shared,(_t&2)!==0){var _=p.pending;return _===null?c.next=c:(c.next=_.next,_.next=c),p.pending=c,c=rg(l),mS(l,null,f),c}return ng(l,p,c,f),rg(l)}function df(l,c,f){if(c=c.updateQueue,c!==null&&(c=c.shared,(f&4194048)!==0)){var p=c.lanes;p&=l.pendingLanes,f|=p,c.lanes=f,bo(l,f)}}function Qv(l,c){var f=l.updateQueue,p=l.alternate;if(p!==null&&(p=p.updateQueue,f===p)){var _=null,b=null;if(f=f.firstBaseUpdate,f!==null){do{var C={lane:f.lane,tag:f.tag,payload:f.payload,callback:null,next:null};b===null?_=b=C:b=b.next=C,f=f.next}while(f!==null);b===null?_=b=c:b=b.next=c}else _=b=c;f={baseState:p.baseState,firstBaseUpdate:_,lastBaseUpdate:b,shared:p.shared,callbacks:p.callbacks},l.updateQueue=f;return}l=f.lastBaseUpdate,l===null?f.firstBaseUpdate=c:l.next=c,f.lastBaseUpdate=c}var Jv=!1;function pf(){if(Jv){var l=Lc;if(l!==null)throw l}}function gf(l,c,f,p){Jv=!1;var _=l.updateQueue;Oo=!1;var b=_.firstBaseUpdate,C=_.lastBaseUpdate,D=_.shared.pending;if(D!==null){_.shared.pending=null;var G=D,ue=G.next;G.next=null,C===null?b=ue:C.next=ue,C=G;var ge=l.alternate;ge!==null&&(ge=ge.updateQueue,D=ge.lastBaseUpdate,D!==C&&(D===null?ge.firstBaseUpdate=ue:D.next=ue,ge.lastBaseUpdate=G))}if(b!==null){var ve=_.baseState;C=0,ge=ue=G=null,D=b;do{var he=D.lane&-536870913,fe=he!==D.lane;if(fe?(ut&he)===he:(p&he)===he){he!==0&&he===Dc&&(Jv=!0),ge!==null&&(ge=ge.next={lane:0,tag:D.tag,payload:D.payload,callback:null,next:null});e:{var He=l,Ve=D;he=c;var Et=f;switch(Ve.tag){case 1:if(He=Ve.payload,typeof He=="function"){ve=He.call(Et,ve,he);break e}ve=He;break e;case 3:He.flags=He.flags&-65537|128;case 0:if(He=Ve.payload,he=typeof He=="function"?He.call(Et,ve,he):He,he==null)break e;ve=d({},ve,he);break e;case 2:Oo=!0}}he=D.callback,he!==null&&(l.flags|=64,fe&&(l.flags|=8192),fe=_.callbacks,fe===null?_.callbacks=[he]:fe.push(he))}else fe={lane:he,tag:D.tag,payload:D.payload,callback:D.callback,next:null},ge===null?(ue=ge=fe,G=ve):ge=ge.next=fe,C|=he;if(D=D.next,D===null){if(D=_.shared.pending,D===null)break;fe=D,D=fe.next,fe.next=null,_.lastBaseUpdate=fe,_.shared.pending=null}}while(!0);ge===null&&(G=ve),_.baseState=G,_.firstBaseUpdate=ue,_.lastBaseUpdate=ge,b===null&&(_.shared.lanes=0),jo|=C,l.lanes=C,l.memoizedState=ve}}function MS(l,c){if(typeof l!="function")throw Error(r(191,l));l.call(c)}function OS(l,c){var f=l.callbacks;if(f!==null)for(l.callbacks=null,l=0;l<f.length;l++)MS(f[l],c)}var Uc=Z(null),fg=Z(0);function kS(l,c){l=Vs,ae(fg,l),ae(Uc,c),Vs=l|c.baseLanes}function eb(){ae(fg,Vs),ae(Uc,Uc.current)}function tb(){Vs=fg.current,se(Uc),se(fg)}var Do=0,Ze=null,wt=null,rn=null,dg=!1,Vc=!1,bl=!1,pg=0,mf=0,Fc=null,l5=0;function Jt(){throw Error(r(321))}function nb(l,c){if(c===null)return!1;for(var f=0;f<c.length&&f<l.length;f++)if(!Ar(l[f],c[f]))return!1;return!0}function rb(l,c,f,p,_,b){return Do=b,Ze=c,c.memoizedState=null,c.updateQueue=null,c.lanes=0,O.H=l===null||l.memoizedState===null?m2:y2,bl=!1,b=f(p,_),bl=!1,Vc&&(b=DS(c,f,p,_)),NS(l),b}function NS(l){O.H=bg;var c=wt!==null&&wt.next!==null;if(Do=0,rn=wt=Ze=null,dg=!1,mf=0,Fc=null,c)throw Error(r(300));l===null||Sn||(l=l.dependencies,l!==null&&ag(l)&&(Sn=!0))}function DS(l,c,f,p){Ze=l;var _=0;do{if(Vc&&(Fc=null),mf=0,Vc=!1,25<=_)throw Error(r(301));if(_+=1,rn=wt=null,l.updateQueue!=null){var b=l.updateQueue;b.lastEffect=null,b.events=null,b.stores=null,b.memoCache!=null&&(b.memoCache.index=0)}O.H=g5,b=c(f,p)}while(Vc);return b}function c5(){var l=O.H,c=l.useState()[0];return c=typeof c.then=="function"?yf(c):c,l=l.useState()[0],(wt!==null?wt.memoizedState:null)!==l&&(Ze.flags|=1024),c}function ib(){var l=pg!==0;return pg=0,l}function sb(l,c,f){c.updateQueue=l.updateQueue,c.flags&=-2053,l.lanes&=~f}function ob(l){if(dg){for(l=l.memoizedState;l!==null;){var c=l.queue;c!==null&&(c.pending=null),l=l.next}dg=!1}Do=0,rn=wt=Ze=null,Vc=!1,mf=pg=0,Fc=null}function gr(){var l={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return rn===null?Ze.memoizedState=rn=l:rn=rn.next=l,rn}function sn(){if(wt===null){var l=Ze.alternate;l=l!==null?l.memoizedState:null}else l=wt.next;var c=rn===null?Ze.memoizedState:rn.next;if(c!==null)rn=c,wt=l;else{if(l===null)throw Ze.alternate===null?Error(r(467)):Error(r(310));wt=l,l={memoizedState:wt.memoizedState,baseState:wt.baseState,baseQueue:wt.baseQueue,queue:wt.queue,next:null},rn===null?Ze.memoizedState=rn=l:rn=rn.next=l}return rn}function ab(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function yf(l){var c=mf;return mf+=1,Fc===null&&(Fc=[]),l=CS(Fc,l,c),c=Ze,(rn===null?c.memoizedState:rn.next)===null&&(c=c.alternate,O.H=c===null||c.memoizedState===null?m2:y2),l}function gg(l){if(l!==null&&typeof l=="object"){if(typeof l.then=="function")return yf(l);if(l.$$typeof===I)return qn(l)}throw Error(r(438,String(l)))}function lb(l){var c=null,f=Ze.updateQueue;if(f!==null&&(c=f.memoCache),c==null){var p=Ze.alternate;p!==null&&(p=p.updateQueue,p!==null&&(p=p.memoCache,p!=null&&(c={data:p.data.map(function(_){return _.slice()}),index:0})))}if(c==null&&(c={data:[],index:0}),f===null&&(f=ab(),Ze.updateQueue=f),f.memoCache=c,f=c.data[c.index],f===void 0)for(f=c.data[c.index]=Array(l),p=0;p<l;p++)f[p]=H;return c.index++,f}function Os(l,c){return typeof c=="function"?c(l):c}function mg(l){var c=sn();return cb(c,wt,l)}function cb(l,c,f){var p=l.queue;if(p===null)throw Error(r(311));p.lastRenderedReducer=f;var _=l.baseQueue,b=p.pending;if(b!==null){if(_!==null){var C=_.next;_.next=b.next,b.next=C}c.baseQueue=_=b,p.pending=null}if(b=l.baseState,_===null)l.memoizedState=b;else{c=_.next;var D=C=null,G=null,ue=c,ge=!1;do{var ve=ue.lane&-536870913;if(ve!==ue.lane?(ut&ve)===ve:(Do&ve)===ve){var he=ue.revertLane;if(he===0)G!==null&&(G=G.next={lane:0,revertLane:0,action:ue.action,hasEagerState:ue.hasEagerState,eagerState:ue.eagerState,next:null}),ve===Dc&&(ge=!0);else if((Do&he)===he){ue=ue.next,he===Dc&&(ge=!0);continue}else ve={lane:0,revertLane:ue.revertLane,action:ue.action,hasEagerState:ue.hasEagerState,eagerState:ue.eagerState,next:null},G===null?(D=G=ve,C=b):G=G.next=ve,Ze.lanes|=he,jo|=he;ve=ue.action,bl&&f(b,ve),b=ue.hasEagerState?ue.eagerState:f(b,ve)}else he={lane:ve,revertLane:ue.revertLane,action:ue.action,hasEagerState:ue.hasEagerState,eagerState:ue.eagerState,next:null},G===null?(D=G=he,C=b):G=G.next=he,Ze.lanes|=ve,jo|=ve;ue=ue.next}while(ue!==null&&ue!==c);if(G===null?C=b:G.next=D,!Ar(b,l.memoizedState)&&(Sn=!0,ge&&(f=Lc,f!==null)))throw f;l.memoizedState=b,l.baseState=C,l.baseQueue=G,p.lastRenderedState=b}return _===null&&(p.lanes=0),[l.memoizedState,p.dispatch]}function ub(l){var c=sn(),f=c.queue;if(f===null)throw Error(r(311));f.lastRenderedReducer=l;var p=f.dispatch,_=f.pending,b=c.memoizedState;if(_!==null){f.pending=null;var C=_=_.next;do b=l(b,C.action),C=C.next;while(C!==_);Ar(b,c.memoizedState)||(Sn=!0),c.memoizedState=b,c.baseQueue===null&&(c.baseState=b),f.lastRenderedState=b}return[b,p]}function LS(l,c,f){var p=Ze,_=sn(),b=dt;if(b){if(f===void 0)throw Error(r(407));f=f()}else f=c();var C=!Ar((wt||_).memoizedState,f);C&&(_.memoizedState=f,Sn=!0),_=_.queue;var D=FS.bind(null,p,_,l);if(_f(2048,8,D,[l]),_.getSnapshot!==c||C||rn!==null&&rn.memoizedState.tag&1){if(p.flags|=2048,Bc(9,yg(),VS.bind(null,p,_,f,c),null),Mt===null)throw Error(r(349));b||(Do&124)!==0||US(p,c,f)}return f}function US(l,c,f){l.flags|=16384,l={getSnapshot:c,value:f},c=Ze.updateQueue,c===null?(c=ab(),Ze.updateQueue=c,c.stores=[l]):(f=c.stores,f===null?c.stores=[l]:f.push(l))}function VS(l,c,f,p){c.value=f,c.getSnapshot=p,BS(c)&&zS(l)}function FS(l,c,f){return f(function(){BS(c)&&zS(l)})}function BS(l){var c=l.getSnapshot;l=l.value;try{var f=c();return!Ar(l,f)}catch{return!0}}function zS(l){var c=Mc(l,2);c!==null&&Mr(c,l,2)}function hb(l){var c=gr();if(typeof l=="function"){var f=l;if(l=f(),bl){Fr(!0);try{f()}finally{Fr(!1)}}}return c.memoizedState=c.baseState=l,c.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Os,lastRenderedState:l},c}function jS(l,c,f,p){return l.baseState=f,cb(l,wt,typeof p=="function"?p:Os)}function u5(l,c,f,p,_){if(vg(l))throw Error(r(485));if(l=c.action,l!==null){var b={payload:_,action:l,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(C){b.listeners.push(C)}};O.T!==null?f(!0):b.isTransition=!1,p(b),f=c.pending,f===null?(b.next=c.pending=b,HS(c,b)):(b.next=f.next,c.pending=f.next=b)}}function HS(l,c){var f=c.action,p=c.payload,_=l.state;if(c.isTransition){var b=O.T,C={};O.T=C;try{var D=f(_,p),G=O.S;G!==null&&G(C,D),$S(l,c,D)}catch(ue){fb(l,c,ue)}finally{O.T=b}}else try{b=f(_,p),$S(l,c,b)}catch(ue){fb(l,c,ue)}}function $S(l,c,f){f!==null&&typeof f=="object"&&typeof f.then=="function"?f.then(function(p){WS(l,c,p)},function(p){return fb(l,c,p)}):WS(l,c,f)}function WS(l,c,f){c.status="fulfilled",c.value=f,qS(c),l.state=f,c=l.pending,c!==null&&(f=c.next,f===c?l.pending=null:(f=f.next,c.next=f,HS(l,f)))}function fb(l,c,f){var p=l.pending;if(l.pending=null,p!==null){p=p.next;do c.status="rejected",c.reason=f,qS(c),c=c.next;while(c!==p)}l.action=null}function qS(l){l=l.listeners;for(var c=0;c<l.length;c++)(0,l[c])()}function XS(l,c){return c}function YS(l,c){if(dt){var f=Mt.formState;if(f!==null){e:{var p=Ze;if(dt){if($t){t:{for(var _=$t,b=ji;_.nodeType!==8;){if(!b){_=null;break t}if(_=_i(_.nextSibling),_===null){_=null;break t}}b=_.data,_=b==="F!"||b==="F"?_:null}if(_){$t=_i(_.nextSibling),p=_.data==="F!";break e}}ml(p)}p=!1}p&&(c=f[0])}}return f=gr(),f.memoizedState=f.baseState=c,p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:XS,lastRenderedState:c},f.queue=p,f=d2.bind(null,Ze,p),p.dispatch=f,p=hb(!1),b=yb.bind(null,Ze,!1,p.queue),p=gr(),_={state:c,dispatch:null,action:l,pending:null},p.queue=_,f=u5.bind(null,Ze,_,b,f),_.dispatch=f,p.memoizedState=l,[c,f,!1]}function KS(l){var c=sn();return GS(c,wt,l)}function GS(l,c,f){if(c=cb(l,c,XS)[0],l=mg(Os)[0],typeof c=="object"&&c!==null&&typeof c.then=="function")try{var p=yf(c)}catch(C){throw C===hf?ug:C}else p=c;c=sn();var _=c.queue,b=_.dispatch;return f!==c.memoizedState&&(Ze.flags|=2048,Bc(9,yg(),h5.bind(null,_,f),null)),[p,b,l]}function h5(l,c){l.action=c}function ZS(l){var c=sn(),f=wt;if(f!==null)return GS(c,f,l);sn(),c=c.memoizedState,f=sn();var p=f.queue.dispatch;return f.memoizedState=l,[c,p,!1]}function Bc(l,c,f,p){return l={tag:l,create:f,deps:p,inst:c,next:null},c=Ze.updateQueue,c===null&&(c=ab(),Ze.updateQueue=c),f=c.lastEffect,f===null?c.lastEffect=l.next=l:(p=f.next,f.next=l,l.next=p,c.lastEffect=l),l}function yg(){return{destroy:void 0,resource:void 0}}function QS(){return sn().memoizedState}function _g(l,c,f,p){var _=gr();p=p===void 0?null:p,Ze.flags|=l,_.memoizedState=Bc(1|c,yg(),f,p)}function _f(l,c,f,p){var _=sn();p=p===void 0?null:p;var b=_.memoizedState.inst;wt!==null&&p!==null&&nb(p,wt.memoizedState.deps)?_.memoizedState=Bc(c,b,f,p):(Ze.flags|=l,_.memoizedState=Bc(1|c,b,f,p))}function JS(l,c){_g(8390656,8,l,c)}function e2(l,c){_f(2048,8,l,c)}function t2(l,c){return _f(4,2,l,c)}function n2(l,c){return _f(4,4,l,c)}function r2(l,c){if(typeof c=="function"){l=l();var f=c(l);return function(){typeof f=="function"?f():c(null)}}if(c!=null)return l=l(),c.current=l,function(){c.current=null}}function i2(l,c,f){f=f!=null?f.concat([l]):null,_f(4,4,r2.bind(null,c,l),f)}function db(){}function s2(l,c){var f=sn();c=c===void 0?null:c;var p=f.memoizedState;return c!==null&&nb(c,p[1])?p[0]:(f.memoizedState=[l,c],l)}function o2(l,c){var f=sn();c=c===void 0?null:c;var p=f.memoizedState;if(c!==null&&nb(c,p[1]))return p[0];if(p=l(),bl){Fr(!0);try{l()}finally{Fr(!1)}}return f.memoizedState=[p,c],p}function pb(l,c,f){return f===void 0||(Do&1073741824)!==0?l.memoizedState=c:(l.memoizedState=f,l=cR(),Ze.lanes|=l,jo|=l,f)}function a2(l,c,f,p){return Ar(f,c)?f:Uc.current!==null?(l=pb(l,f,p),Ar(l,c)||(Sn=!0),l):(Do&42)===0?(Sn=!0,l.memoizedState=f):(l=cR(),Ze.lanes|=l,jo|=l,c)}function l2(l,c,f,p,_){var b=W.p;W.p=b!==0&&8>b?b:8;var C=O.T,D={};O.T=D,yb(l,!1,c,f);try{var G=_(),ue=O.S;if(ue!==null&&ue(D,G),G!==null&&typeof G=="object"&&typeof G.then=="function"){var ge=a5(G,p);vf(l,c,ge,Pr(l))}else vf(l,c,p,Pr(l))}catch(ve){vf(l,c,{then:function(){},status:"rejected",reason:ve},Pr())}finally{W.p=b,O.T=C}}function f5(){}function gb(l,c,f,p){if(l.tag!==5)throw Error(r(476));var _=c2(l).queue;l2(l,_,c,U,f===null?f5:function(){return u2(l),f(p)})}function c2(l){var c=l.memoizedState;if(c!==null)return c;c={memoizedState:U,baseState:U,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Os,lastRenderedState:U},next:null};var f={};return c.next={memoizedState:f,baseState:f,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Os,lastRenderedState:f},next:null},l.memoizedState=c,l=l.alternate,l!==null&&(l.memoizedState=c),c}function u2(l){var c=c2(l).next.queue;vf(l,c,{},Pr())}function mb(){return qn(Uf)}function h2(){return sn().memoizedState}function f2(){return sn().memoizedState}function d5(l){for(var c=l.return;c!==null;){switch(c.tag){case 24:case 3:var f=Pr();l=ko(f);var p=No(c,l,f);p!==null&&(Mr(p,c,f),df(p,c,f)),c={cache:qv()},l.payload=c;return}c=c.return}}function p5(l,c,f){var p=Pr();f={lane:p,revertLane:0,action:f,hasEagerState:!1,eagerState:null,next:null},vg(l)?p2(c,f):(f=Lv(l,c,f,p),f!==null&&(Mr(f,l,p),g2(f,c,p)))}function d2(l,c,f){var p=Pr();vf(l,c,f,p)}function vf(l,c,f,p){var _={lane:p,revertLane:0,action:f,hasEagerState:!1,eagerState:null,next:null};if(vg(l))p2(c,_);else{var b=l.alternate;if(l.lanes===0&&(b===null||b.lanes===0)&&(b=c.lastRenderedReducer,b!==null))try{var C=c.lastRenderedState,D=b(C,f);if(_.hasEagerState=!0,_.eagerState=D,Ar(D,C))return ng(l,c,_,0),Mt===null&&tg(),!1}catch{}finally{}if(f=Lv(l,c,_,p),f!==null)return Mr(f,l,p),g2(f,c,p),!0}return!1}function yb(l,c,f,p){if(p={lane:2,revertLane:Kb(),action:p,hasEagerState:!1,eagerState:null,next:null},vg(l)){if(c)throw Error(r(479))}else c=Lv(l,f,p,2),c!==null&&Mr(c,l,2)}function vg(l){var c=l.alternate;return l===Ze||c!==null&&c===Ze}function p2(l,c){Vc=dg=!0;var f=l.pending;f===null?c.next=c:(c.next=f.next,f.next=c),l.pending=c}function g2(l,c,f){if((f&4194048)!==0){var p=c.lanes;p&=l.pendingLanes,f|=p,c.lanes=f,bo(l,f)}}var bg={readContext:qn,use:gg,useCallback:Jt,useContext:Jt,useEffect:Jt,useImperativeHandle:Jt,useLayoutEffect:Jt,useInsertionEffect:Jt,useMemo:Jt,useReducer:Jt,useRef:Jt,useState:Jt,useDebugValue:Jt,useDeferredValue:Jt,useTransition:Jt,useSyncExternalStore:Jt,useId:Jt,useHostTransitionStatus:Jt,useFormState:Jt,useActionState:Jt,useOptimistic:Jt,useMemoCache:Jt,useCacheRefresh:Jt},m2={readContext:qn,use:gg,useCallback:function(l,c){return gr().memoizedState=[l,c===void 0?null:c],l},useContext:qn,useEffect:JS,useImperativeHandle:function(l,c,f){f=f!=null?f.concat([l]):null,_g(4194308,4,r2.bind(null,c,l),f)},useLayoutEffect:function(l,c){return _g(4194308,4,l,c)},useInsertionEffect:function(l,c){_g(4,2,l,c)},useMemo:function(l,c){var f=gr();c=c===void 0?null:c;var p=l();if(bl){Fr(!0);try{l()}finally{Fr(!1)}}return f.memoizedState=[p,c],p},useReducer:function(l,c,f){var p=gr();if(f!==void 0){var _=f(c);if(bl){Fr(!0);try{f(c)}finally{Fr(!1)}}}else _=c;return p.memoizedState=p.baseState=_,l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:l,lastRenderedState:_},p.queue=l,l=l.dispatch=p5.bind(null,Ze,l),[p.memoizedState,l]},useRef:function(l){var c=gr();return l={current:l},c.memoizedState=l},useState:function(l){l=hb(l);var c=l.queue,f=d2.bind(null,Ze,c);return c.dispatch=f,[l.memoizedState,f]},useDebugValue:db,useDeferredValue:function(l,c){var f=gr();return pb(f,l,c)},useTransition:function(){var l=hb(!1);return l=l2.bind(null,Ze,l.queue,!0,!1),gr().memoizedState=l,[!1,l]},useSyncExternalStore:function(l,c,f){var p=Ze,_=gr();if(dt){if(f===void 0)throw Error(r(407));f=f()}else{if(f=c(),Mt===null)throw Error(r(349));(ut&124)!==0||US(p,c,f)}_.memoizedState=f;var b={value:f,getSnapshot:c};return _.queue=b,JS(FS.bind(null,p,b,l),[l]),p.flags|=2048,Bc(9,yg(),VS.bind(null,p,b,f,c),null),f},useId:function(){var l=gr(),c=Mt.identifierPrefix;if(dt){var f=Is,p=Cs;f=(p&~(1<<32-or(p)-1)).toString(32)+f,c=""+c+"R"+f,f=pg++,0<f&&(c+="H"+f.toString(32)),c+=""}else f=l5++,c=""+c+"r"+f.toString(32)+"";return l.memoizedState=c},useHostTransitionStatus:mb,useFormState:YS,useActionState:YS,useOptimistic:function(l){var c=gr();c.memoizedState=c.baseState=l;var f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return c.queue=f,c=yb.bind(null,Ze,!0,f),f.dispatch=c,[l,c]},useMemoCache:lb,useCacheRefresh:function(){return gr().memoizedState=d5.bind(null,Ze)}},y2={readContext:qn,use:gg,useCallback:s2,useContext:qn,useEffect:e2,useImperativeHandle:i2,useInsertionEffect:t2,useLayoutEffect:n2,useMemo:o2,useReducer:mg,useRef:QS,useState:function(){return mg(Os)},useDebugValue:db,useDeferredValue:function(l,c){var f=sn();return a2(f,wt.memoizedState,l,c)},useTransition:function(){var l=mg(Os)[0],c=sn().memoizedState;return[typeof l=="boolean"?l:yf(l),c]},useSyncExternalStore:LS,useId:h2,useHostTransitionStatus:mb,useFormState:KS,useActionState:KS,useOptimistic:function(l,c){var f=sn();return jS(f,wt,l,c)},useMemoCache:lb,useCacheRefresh:f2},g5={readContext:qn,use:gg,useCallback:s2,useContext:qn,useEffect:e2,useImperativeHandle:i2,useInsertionEffect:t2,useLayoutEffect:n2,useMemo:o2,useReducer:ub,useRef:QS,useState:function(){return ub(Os)},useDebugValue:db,useDeferredValue:function(l,c){var f=sn();return wt===null?pb(f,l,c):a2(f,wt.memoizedState,l,c)},useTransition:function(){var l=ub(Os)[0],c=sn().memoizedState;return[typeof l=="boolean"?l:yf(l),c]},useSyncExternalStore:LS,useId:h2,useHostTransitionStatus:mb,useFormState:ZS,useActionState:ZS,useOptimistic:function(l,c){var f=sn();return wt!==null?jS(f,wt,l,c):(f.baseState=l,[l,f.queue.dispatch])},useMemoCache:lb,useCacheRefresh:f2},zc=null,bf=0;function Tg(l){var c=bf;return bf+=1,zc===null&&(zc=[]),CS(zc,l,c)}function Tf(l,c){c=c.props.ref,l.ref=c!==void 0?c:null}function wg(l,c){throw c.$$typeof===g?Error(r(525)):(l=Object.prototype.toString.call(c),Error(r(31,l==="[object Object]"?"object with keys {"+Object.keys(c).join(", ")+"}":l)))}function _2(l){var c=l._init;return c(l._payload)}function v2(l){function c(ne,Q){if(l){var le=ne.deletions;le===null?(ne.deletions=[Q],ne.flags|=16):le.push(Q)}}function f(ne,Q){if(!l)return null;for(;Q!==null;)c(ne,Q),Q=Q.sibling;return null}function p(ne){for(var Q=new Map;ne!==null;)ne.key!==null?Q.set(ne.key,ne):Q.set(ne.index,ne),ne=ne.sibling;return Q}function _(ne,Q){return ne=Rs(ne,Q),ne.index=0,ne.sibling=null,ne}function b(ne,Q,le){return ne.index=le,l?(le=ne.alternate,le!==null?(le=le.index,le<Q?(ne.flags|=67108866,Q):le):(ne.flags|=67108866,Q)):(ne.flags|=1048576,Q)}function C(ne){return l&&ne.alternate===null&&(ne.flags|=67108866),ne}function D(ne,Q,le,ye){return Q===null||Q.tag!==6?(Q=Vv(le,ne.mode,ye),Q.return=ne,Q):(Q=_(Q,le),Q.return=ne,Q)}function G(ne,Q,le,ye){var Oe=le.type;return Oe===T?ge(ne,Q,le.props.children,ye,le.key):Q!==null&&(Q.elementType===Oe||typeof Oe=="object"&&Oe!==null&&Oe.$$typeof===M&&_2(Oe)===Q.type)?(Q=_(Q,le.props),Tf(Q,le),Q.return=ne,Q):(Q=ig(le.type,le.key,le.props,null,ne.mode,ye),Tf(Q,le),Q.return=ne,Q)}function ue(ne,Q,le,ye){return Q===null||Q.tag!==4||Q.stateNode.containerInfo!==le.containerInfo||Q.stateNode.implementation!==le.implementation?(Q=Fv(le,ne.mode,ye),Q.return=ne,Q):(Q=_(Q,le.children||[]),Q.return=ne,Q)}function ge(ne,Q,le,ye,Oe){return Q===null||Q.tag!==7?(Q=fl(le,ne.mode,ye,Oe),Q.return=ne,Q):(Q=_(Q,le),Q.return=ne,Q)}function ve(ne,Q,le){if(typeof Q=="string"&&Q!==""||typeof Q=="number"||typeof Q=="bigint")return Q=Vv(""+Q,ne.mode,le),Q.return=ne,Q;if(typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case y:return le=ig(Q.type,Q.key,Q.props,null,ne.mode,le),Tf(le,Q),le.return=ne,le;case v:return Q=Fv(Q,ne.mode,le),Q.return=ne,Q;case M:var ye=Q._init;return Q=ye(Q._payload),ve(ne,Q,le)}if(Ee(Q)||K(Q))return Q=fl(Q,ne.mode,le,null),Q.return=ne,Q;if(typeof Q.then=="function")return ve(ne,Tg(Q),le);if(Q.$$typeof===I)return ve(ne,lg(ne,Q),le);wg(ne,Q)}return null}function he(ne,Q,le,ye){var Oe=Q!==null?Q.key:null;if(typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint")return Oe!==null?null:D(ne,Q,""+le,ye);if(typeof le=="object"&&le!==null){switch(le.$$typeof){case y:return le.key===Oe?G(ne,Q,le,ye):null;case v:return le.key===Oe?ue(ne,Q,le,ye):null;case M:return Oe=le._init,le=Oe(le._payload),he(ne,Q,le,ye)}if(Ee(le)||K(le))return Oe!==null?null:ge(ne,Q,le,ye,null);if(typeof le.then=="function")return he(ne,Q,Tg(le),ye);if(le.$$typeof===I)return he(ne,Q,lg(ne,le),ye);wg(ne,le)}return null}function fe(ne,Q,le,ye,Oe){if(typeof ye=="string"&&ye!==""||typeof ye=="number"||typeof ye=="bigint")return ne=ne.get(le)||null,D(Q,ne,""+ye,Oe);if(typeof ye=="object"&&ye!==null){switch(ye.$$typeof){case y:return ne=ne.get(ye.key===null?le:ye.key)||null,G(Q,ne,ye,Oe);case v:return ne=ne.get(ye.key===null?le:ye.key)||null,ue(Q,ne,ye,Oe);case M:var Je=ye._init;return ye=Je(ye._payload),fe(ne,Q,le,ye,Oe)}if(Ee(ye)||K(ye))return ne=ne.get(le)||null,ge(Q,ne,ye,Oe,null);if(typeof ye.then=="function")return fe(ne,Q,le,Tg(ye),Oe);if(ye.$$typeof===I)return fe(ne,Q,le,lg(Q,ye),Oe);wg(Q,ye)}return null}function He(ne,Q,le,ye){for(var Oe=null,Je=null,De=Q,Fe=Q=0,Cn=null;De!==null&&Fe<le.length;Fe++){De.index>Fe?(Cn=De,De=null):Cn=De.sibling;var ft=he(ne,De,le[Fe],ye);if(ft===null){De===null&&(De=Cn);break}l&&De&&ft.alternate===null&&c(ne,De),Q=b(ft,Q,Fe),Je===null?Oe=ft:Je.sibling=ft,Je=ft,De=Cn}if(Fe===le.length)return f(ne,De),dt&&pl(ne,Fe),Oe;if(De===null){for(;Fe<le.length;Fe++)De=ve(ne,le[Fe],ye),De!==null&&(Q=b(De,Q,Fe),Je===null?Oe=De:Je.sibling=De,Je=De);return dt&&pl(ne,Fe),Oe}for(De=p(De);Fe<le.length;Fe++)Cn=fe(De,ne,Fe,le[Fe],ye),Cn!==null&&(l&&Cn.alternate!==null&&De.delete(Cn.key===null?Fe:Cn.key),Q=b(Cn,Q,Fe),Je===null?Oe=Cn:Je.sibling=Cn,Je=Cn);return l&&De.forEach(function(Zo){return c(ne,Zo)}),dt&&pl(ne,Fe),Oe}function Ve(ne,Q,le,ye){if(le==null)throw Error(r(151));for(var Oe=null,Je=null,De=Q,Fe=Q=0,Cn=null,ft=le.next();De!==null&&!ft.done;Fe++,ft=le.next()){De.index>Fe?(Cn=De,De=null):Cn=De.sibling;var Zo=he(ne,De,ft.value,ye);if(Zo===null){De===null&&(De=Cn);break}l&&De&&Zo.alternate===null&&c(ne,De),Q=b(Zo,Q,Fe),Je===null?Oe=Zo:Je.sibling=Zo,Je=Zo,De=Cn}if(ft.done)return f(ne,De),dt&&pl(ne,Fe),Oe;if(De===null){for(;!ft.done;Fe++,ft=le.next())ft=ve(ne,ft.value,ye),ft!==null&&(Q=b(ft,Q,Fe),Je===null?Oe=ft:Je.sibling=ft,Je=ft);return dt&&pl(ne,Fe),Oe}for(De=p(De);!ft.done;Fe++,ft=le.next())ft=fe(De,ne,Fe,ft.value,ye),ft!==null&&(l&&ft.alternate!==null&&De.delete(ft.key===null?Fe:ft.key),Q=b(ft,Q,Fe),Je===null?Oe=ft:Je.sibling=ft,Je=ft);return l&&De.forEach(function(m8){return c(ne,m8)}),dt&&pl(ne,Fe),Oe}function Et(ne,Q,le,ye){if(typeof le=="object"&&le!==null&&le.type===T&&le.key===null&&(le=le.props.children),typeof le=="object"&&le!==null){switch(le.$$typeof){case y:e:{for(var Oe=le.key;Q!==null;){if(Q.key===Oe){if(Oe=le.type,Oe===T){if(Q.tag===7){f(ne,Q.sibling),ye=_(Q,le.props.children),ye.return=ne,ne=ye;break e}}else if(Q.elementType===Oe||typeof Oe=="object"&&Oe!==null&&Oe.$$typeof===M&&_2(Oe)===Q.type){f(ne,Q.sibling),ye=_(Q,le.props),Tf(ye,le),ye.return=ne,ne=ye;break e}f(ne,Q);break}else c(ne,Q);Q=Q.sibling}le.type===T?(ye=fl(le.props.children,ne.mode,ye,le.key),ye.return=ne,ne=ye):(ye=ig(le.type,le.key,le.props,null,ne.mode,ye),Tf(ye,le),ye.return=ne,ne=ye)}return C(ne);case v:e:{for(Oe=le.key;Q!==null;){if(Q.key===Oe)if(Q.tag===4&&Q.stateNode.containerInfo===le.containerInfo&&Q.stateNode.implementation===le.implementation){f(ne,Q.sibling),ye=_(Q,le.children||[]),ye.return=ne,ne=ye;break e}else{f(ne,Q);break}else c(ne,Q);Q=Q.sibling}ye=Fv(le,ne.mode,ye),ye.return=ne,ne=ye}return C(ne);case M:return Oe=le._init,le=Oe(le._payload),Et(ne,Q,le,ye)}if(Ee(le))return He(ne,Q,le,ye);if(K(le)){if(Oe=K(le),typeof Oe!="function")throw Error(r(150));return le=Oe.call(le),Ve(ne,Q,le,ye)}if(typeof le.then=="function")return Et(ne,Q,Tg(le),ye);if(le.$$typeof===I)return Et(ne,Q,lg(ne,le),ye);wg(ne,le)}return typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint"?(le=""+le,Q!==null&&Q.tag===6?(f(ne,Q.sibling),ye=_(Q,le),ye.return=ne,ne=ye):(f(ne,Q),ye=Vv(le,ne.mode,ye),ye.return=ne,ne=ye),C(ne)):f(ne,Q)}return function(ne,Q,le,ye){try{bf=0;var Oe=Et(ne,Q,le,ye);return zc=null,Oe}catch(De){if(De===hf||De===ug)throw De;var Je=Sr(29,De,null,ne.mode);return Je.lanes=ye,Je.return=ne,Je}finally{}}}var jc=v2(!0),b2=v2(!1),Yr=Z(null),Hi=null;function Lo(l){var c=l.alternate;ae(mn,mn.current&1),ae(Yr,l),Hi===null&&(c===null||Uc.current!==null||c.memoizedState!==null)&&(Hi=l)}function T2(l){if(l.tag===22){if(ae(mn,mn.current),ae(Yr,l),Hi===null){var c=l.alternate;c!==null&&c.memoizedState!==null&&(Hi=l)}}else Uo()}function Uo(){ae(mn,mn.current),ae(Yr,Yr.current)}function ks(l){se(Yr),Hi===l&&(Hi=null),se(mn)}var mn=Z(0);function xg(l){for(var c=l;c!==null;){if(c.tag===13){var f=c.memoizedState;if(f!==null&&(f=f.dehydrated,f===null||f.data==="$?"||a0(f)))return c}else if(c.tag===19&&c.memoizedProps.revealOrder!==void 0){if((c.flags&128)!==0)return c}else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===l)break;for(;c.sibling===null;){if(c.return===null||c.return===l)return null;c=c.return}c.sibling.return=c.return,c=c.sibling}return null}function _b(l,c,f,p){c=l.memoizedState,f=f(p,c),f=f==null?c:d({},c,f),l.memoizedState=f,l.lanes===0&&(l.updateQueue.baseState=f)}var vb={enqueueSetState:function(l,c,f){l=l._reactInternals;var p=Pr(),_=ko(p);_.payload=c,f!=null&&(_.callback=f),c=No(l,_,p),c!==null&&(Mr(c,l,p),df(c,l,p))},enqueueReplaceState:function(l,c,f){l=l._reactInternals;var p=Pr(),_=ko(p);_.tag=1,_.payload=c,f!=null&&(_.callback=f),c=No(l,_,p),c!==null&&(Mr(c,l,p),df(c,l,p))},enqueueForceUpdate:function(l,c){l=l._reactInternals;var f=Pr(),p=ko(f);p.tag=2,c!=null&&(p.callback=c),c=No(l,p,f),c!==null&&(Mr(c,l,f),df(c,l,f))}};function w2(l,c,f,p,_,b,C){return l=l.stateNode,typeof l.shouldComponentUpdate=="function"?l.shouldComponentUpdate(p,b,C):c.prototype&&c.prototype.isPureReactComponent?!nf(f,p)||!nf(_,b):!0}function x2(l,c,f,p){l=c.state,typeof c.componentWillReceiveProps=="function"&&c.componentWillReceiveProps(f,p),typeof c.UNSAFE_componentWillReceiveProps=="function"&&c.UNSAFE_componentWillReceiveProps(f,p),c.state!==l&&vb.enqueueReplaceState(c,c.state,null)}function Tl(l,c){var f=c;if("ref"in c){f={};for(var p in c)p!=="ref"&&(f[p]=c[p])}if(l=l.defaultProps){f===c&&(f=d({},f));for(var _ in l)f[_]===void 0&&(f[_]=l[_])}return f}var Eg=typeof reportError=="function"?reportError:function(l){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var c=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof l=="object"&&l!==null&&typeof l.message=="string"?String(l.message):String(l),error:l});if(!window.dispatchEvent(c))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",l);return}console.error(l)};function E2(l){Eg(l)}function A2(l){console.error(l)}function S2(l){Eg(l)}function Ag(l,c){try{var f=l.onUncaughtError;f(c.value,{componentStack:c.stack})}catch(p){setTimeout(function(){throw p})}}function R2(l,c,f){try{var p=l.onCaughtError;p(f.value,{componentStack:f.stack,errorBoundary:c.tag===1?c.stateNode:null})}catch(_){setTimeout(function(){throw _})}}function bb(l,c,f){return f=ko(f),f.tag=3,f.payload={element:null},f.callback=function(){Ag(l,c)},f}function C2(l){return l=ko(l),l.tag=3,l}function I2(l,c,f,p){var _=f.type.getDerivedStateFromError;if(typeof _=="function"){var b=p.value;l.payload=function(){return _(b)},l.callback=function(){R2(c,f,p)}}var C=f.stateNode;C!==null&&typeof C.componentDidCatch=="function"&&(l.callback=function(){R2(c,f,p),typeof _!="function"&&(Ho===null?Ho=new Set([this]):Ho.add(this));var D=p.stack;this.componentDidCatch(p.value,{componentStack:D!==null?D:""})})}function m5(l,c,f,p,_){if(f.flags|=32768,p!==null&&typeof p=="object"&&typeof p.then=="function"){if(c=f.alternate,c!==null&&lf(c,f,_,!0),f=Yr.current,f!==null){switch(f.tag){case 13:return Hi===null?$b():f.alternate===null&&Wt===0&&(Wt=3),f.flags&=-257,f.flags|=65536,f.lanes=_,p===Kv?f.flags|=16384:(c=f.updateQueue,c===null?f.updateQueue=new Set([p]):c.add(p),qb(l,p,_)),!1;case 22:return f.flags|=65536,p===Kv?f.flags|=16384:(c=f.updateQueue,c===null?(c={transitions:null,markerInstances:null,retryQueue:new Set([p])},f.updateQueue=c):(f=c.retryQueue,f===null?c.retryQueue=new Set([p]):f.add(p)),qb(l,p,_)),!1}throw Error(r(435,f.tag))}return qb(l,p,_),$b(),!1}if(dt)return c=Yr.current,c!==null?((c.flags&65536)===0&&(c.flags|=256),c.flags|=65536,c.lanes=_,p!==jv&&(l=Error(r(422),{cause:p}),af($r(l,f)))):(p!==jv&&(c=Error(r(423),{cause:p}),af($r(c,f))),l=l.current.alternate,l.flags|=65536,_&=-_,l.lanes|=_,p=$r(p,f),_=bb(l.stateNode,p,_),Qv(l,_),Wt!==4&&(Wt=2)),!1;var b=Error(r(520),{cause:p});if(b=$r(b,f),Cf===null?Cf=[b]:Cf.push(b),Wt!==4&&(Wt=2),c===null)return!0;p=$r(p,f),f=c;do{switch(f.tag){case 3:return f.flags|=65536,l=_&-_,f.lanes|=l,l=bb(f.stateNode,p,l),Qv(f,l),!1;case 1:if(c=f.type,b=f.stateNode,(f.flags&128)===0&&(typeof c.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(Ho===null||!Ho.has(b))))return f.flags|=65536,_&=-_,f.lanes|=_,_=C2(_),I2(_,l,f,p),Qv(f,_),!1}f=f.return}while(f!==null);return!1}var P2=Error(r(461)),Sn=!1;function Nn(l,c,f,p){c.child=l===null?b2(c,null,f,p):jc(c,l.child,f,p)}function M2(l,c,f,p,_){f=f.render;var b=c.ref;if("ref"in p){var C={};for(var D in p)D!=="ref"&&(C[D]=p[D])}else C=p;return _l(c),p=rb(l,c,f,C,b,_),D=ib(),l!==null&&!Sn?(sb(l,c,_),Ns(l,c,_)):(dt&&D&&Bv(c),c.flags|=1,Nn(l,c,p,_),c.child)}function O2(l,c,f,p,_){if(l===null){var b=f.type;return typeof b=="function"&&!Uv(b)&&b.defaultProps===void 0&&f.compare===null?(c.tag=15,c.type=b,k2(l,c,b,p,_)):(l=ig(f.type,null,p,c,c.mode,_),l.ref=c.ref,l.return=c,c.child=l)}if(b=l.child,!Cb(l,_)){var C=b.memoizedProps;if(f=f.compare,f=f!==null?f:nf,f(C,p)&&l.ref===c.ref)return Ns(l,c,_)}return c.flags|=1,l=Rs(b,p),l.ref=c.ref,l.return=c,c.child=l}function k2(l,c,f,p,_){if(l!==null){var b=l.memoizedProps;if(nf(b,p)&&l.ref===c.ref)if(Sn=!1,c.pendingProps=p=b,Cb(l,_))(l.flags&131072)!==0&&(Sn=!0);else return c.lanes=l.lanes,Ns(l,c,_)}return Tb(l,c,f,p,_)}function N2(l,c,f){var p=c.pendingProps,_=p.children,b=l!==null?l.memoizedState:null;if(p.mode==="hidden"){if((c.flags&128)!==0){if(p=b!==null?b.baseLanes|f:f,l!==null){for(_=c.child=l.child,b=0;_!==null;)b=b|_.lanes|_.childLanes,_=_.sibling;c.childLanes=b&~p}else c.childLanes=0,c.child=null;return D2(l,c,p,f)}if((f&536870912)!==0)c.memoizedState={baseLanes:0,cachePool:null},l!==null&&cg(c,b!==null?b.cachePool:null),b!==null?kS(c,b):eb(),T2(c);else return c.lanes=c.childLanes=536870912,D2(l,c,b!==null?b.baseLanes|f:f,f)}else b!==null?(cg(c,b.cachePool),kS(c,b),Uo(),c.memoizedState=null):(l!==null&&cg(c,null),eb(),Uo());return Nn(l,c,_,f),c.child}function D2(l,c,f,p){var _=Yv();return _=_===null?null:{parent:gn._currentValue,pool:_},c.memoizedState={baseLanes:f,cachePool:_},l!==null&&cg(c,null),eb(),T2(c),l!==null&&lf(l,c,p,!0),null}function Sg(l,c){var f=c.ref;if(f===null)l!==null&&l.ref!==null&&(c.flags|=4194816);else{if(typeof f!="function"&&typeof f!="object")throw Error(r(284));(l===null||l.ref!==f)&&(c.flags|=4194816)}}function Tb(l,c,f,p,_){return _l(c),f=rb(l,c,f,p,void 0,_),p=ib(),l!==null&&!Sn?(sb(l,c,_),Ns(l,c,_)):(dt&&p&&Bv(c),c.flags|=1,Nn(l,c,f,_),c.child)}function L2(l,c,f,p,_,b){return _l(c),c.updateQueue=null,f=DS(c,p,f,_),NS(l),p=ib(),l!==null&&!Sn?(sb(l,c,b),Ns(l,c,b)):(dt&&p&&Bv(c),c.flags|=1,Nn(l,c,f,b),c.child)}function U2(l,c,f,p,_){if(_l(c),c.stateNode===null){var b=Oc,C=f.contextType;typeof C=="object"&&C!==null&&(b=qn(C)),b=new f(p,b),c.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,b.updater=vb,c.stateNode=b,b._reactInternals=c,b=c.stateNode,b.props=p,b.state=c.memoizedState,b.refs={},Gv(c),C=f.contextType,b.context=typeof C=="object"&&C!==null?qn(C):Oc,b.state=c.memoizedState,C=f.getDerivedStateFromProps,typeof C=="function"&&(_b(c,f,C,p),b.state=c.memoizedState),typeof f.getDerivedStateFromProps=="function"||typeof b.getSnapshotBeforeUpdate=="function"||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(C=b.state,typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount(),C!==b.state&&vb.enqueueReplaceState(b,b.state,null),gf(c,p,b,_),pf(),b.state=c.memoizedState),typeof b.componentDidMount=="function"&&(c.flags|=4194308),p=!0}else if(l===null){b=c.stateNode;var D=c.memoizedProps,G=Tl(f,D);b.props=G;var ue=b.context,ge=f.contextType;C=Oc,typeof ge=="object"&&ge!==null&&(C=qn(ge));var ve=f.getDerivedStateFromProps;ge=typeof ve=="function"||typeof b.getSnapshotBeforeUpdate=="function",D=c.pendingProps!==D,ge||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(D||ue!==C)&&x2(c,b,p,C),Oo=!1;var he=c.memoizedState;b.state=he,gf(c,p,b,_),pf(),ue=c.memoizedState,D||he!==ue||Oo?(typeof ve=="function"&&(_b(c,f,ve,p),ue=c.memoizedState),(G=Oo||w2(c,f,G,p,he,ue,C))?(ge||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount()),typeof b.componentDidMount=="function"&&(c.flags|=4194308)):(typeof b.componentDidMount=="function"&&(c.flags|=4194308),c.memoizedProps=p,c.memoizedState=ue),b.props=p,b.state=ue,b.context=C,p=G):(typeof b.componentDidMount=="function"&&(c.flags|=4194308),p=!1)}else{b=c.stateNode,Zv(l,c),C=c.memoizedProps,ge=Tl(f,C),b.props=ge,ve=c.pendingProps,he=b.context,ue=f.contextType,G=Oc,typeof ue=="object"&&ue!==null&&(G=qn(ue)),D=f.getDerivedStateFromProps,(ue=typeof D=="function"||typeof b.getSnapshotBeforeUpdate=="function")||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(C!==ve||he!==G)&&x2(c,b,p,G),Oo=!1,he=c.memoizedState,b.state=he,gf(c,p,b,_),pf();var fe=c.memoizedState;C!==ve||he!==fe||Oo||l!==null&&l.dependencies!==null&&ag(l.dependencies)?(typeof D=="function"&&(_b(c,f,D,p),fe=c.memoizedState),(ge=Oo||w2(c,f,ge,p,he,fe,G)||l!==null&&l.dependencies!==null&&ag(l.dependencies))?(ue||typeof b.UNSAFE_componentWillUpdate!="function"&&typeof b.componentWillUpdate!="function"||(typeof b.componentWillUpdate=="function"&&b.componentWillUpdate(p,fe,G),typeof b.UNSAFE_componentWillUpdate=="function"&&b.UNSAFE_componentWillUpdate(p,fe,G)),typeof b.componentDidUpdate=="function"&&(c.flags|=4),typeof b.getSnapshotBeforeUpdate=="function"&&(c.flags|=1024)):(typeof b.componentDidUpdate!="function"||C===l.memoizedProps&&he===l.memoizedState||(c.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||C===l.memoizedProps&&he===l.memoizedState||(c.flags|=1024),c.memoizedProps=p,c.memoizedState=fe),b.props=p,b.state=fe,b.context=G,p=ge):(typeof b.componentDidUpdate!="function"||C===l.memoizedProps&&he===l.memoizedState||(c.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||C===l.memoizedProps&&he===l.memoizedState||(c.flags|=1024),p=!1)}return b=p,Sg(l,c),p=(c.flags&128)!==0,b||p?(b=c.stateNode,f=p&&typeof f.getDerivedStateFromError!="function"?null:b.render(),c.flags|=1,l!==null&&p?(c.child=jc(c,l.child,null,_),c.child=jc(c,null,f,_)):Nn(l,c,f,_),c.memoizedState=b.state,l=c.child):l=Ns(l,c,_),l}function V2(l,c,f,p){return of(),c.flags|=256,Nn(l,c,f,p),c.child}var wb={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function xb(l){return{baseLanes:l,cachePool:AS()}}function Eb(l,c,f){return l=l!==null?l.childLanes&~f:0,c&&(l|=Kr),l}function F2(l,c,f){var p=c.pendingProps,_=!1,b=(c.flags&128)!==0,C;if((C=b)||(C=l!==null&&l.memoizedState===null?!1:(mn.current&2)!==0),C&&(_=!0,c.flags&=-129),C=(c.flags&32)!==0,c.flags&=-33,l===null){if(dt){if(_?Lo(c):Uo(),dt){var D=$t,G;if(G=D){e:{for(G=D,D=ji;G.nodeType!==8;){if(!D){D=null;break e}if(G=_i(G.nextSibling),G===null){D=null;break e}}D=G}D!==null?(c.memoizedState={dehydrated:D,treeContext:dl!==null?{id:Cs,overflow:Is}:null,retryLane:536870912,hydrationErrors:null},G=Sr(18,null,null,0),G.stateNode=D,G.return=c,c.child=G,ur=c,$t=null,G=!0):G=!1}G||ml(c)}if(D=c.memoizedState,D!==null&&(D=D.dehydrated,D!==null))return a0(D)?c.lanes=32:c.lanes=536870912,null;ks(c)}return D=p.children,p=p.fallback,_?(Uo(),_=c.mode,D=Rg({mode:"hidden",children:D},_),p=fl(p,_,f,null),D.return=c,p.return=c,D.sibling=p,c.child=D,_=c.child,_.memoizedState=xb(f),_.childLanes=Eb(l,C,f),c.memoizedState=wb,p):(Lo(c),Ab(c,D))}if(G=l.memoizedState,G!==null&&(D=G.dehydrated,D!==null)){if(b)c.flags&256?(Lo(c),c.flags&=-257,c=Sb(l,c,f)):c.memoizedState!==null?(Uo(),c.child=l.child,c.flags|=128,c=null):(Uo(),_=p.fallback,D=c.mode,p=Rg({mode:"visible",children:p.children},D),_=fl(_,D,f,null),_.flags|=2,p.return=c,_.return=c,p.sibling=_,c.child=p,jc(c,l.child,null,f),p=c.child,p.memoizedState=xb(f),p.childLanes=Eb(l,C,f),c.memoizedState=wb,c=_);else if(Lo(c),a0(D)){if(C=D.nextSibling&&D.nextSibling.dataset,C)var ue=C.dgst;C=ue,p=Error(r(419)),p.stack="",p.digest=C,af({value:p,source:null,stack:null}),c=Sb(l,c,f)}else if(Sn||lf(l,c,f,!1),C=(f&l.childLanes)!==0,Sn||C){if(C=Mt,C!==null&&(p=f&-f,p=(p&42)!==0?1:Fh(p),p=(p&(C.suspendedLanes|f))!==0?0:p,p!==0&&p!==G.retryLane))throw G.retryLane=p,Mc(l,p),Mr(C,l,p),P2;D.data==="$?"||$b(),c=Sb(l,c,f)}else D.data==="$?"?(c.flags|=192,c.child=l.child,c=null):(l=G.treeContext,$t=_i(D.nextSibling),ur=c,dt=!0,gl=null,ji=!1,l!==null&&(qr[Xr++]=Cs,qr[Xr++]=Is,qr[Xr++]=dl,Cs=l.id,Is=l.overflow,dl=c),c=Ab(c,p.children),c.flags|=4096);return c}return _?(Uo(),_=p.fallback,D=c.mode,G=l.child,ue=G.sibling,p=Rs(G,{mode:"hidden",children:p.children}),p.subtreeFlags=G.subtreeFlags&65011712,ue!==null?_=Rs(ue,_):(_=fl(_,D,f,null),_.flags|=2),_.return=c,p.return=c,p.sibling=_,c.child=p,p=_,_=c.child,D=l.child.memoizedState,D===null?D=xb(f):(G=D.cachePool,G!==null?(ue=gn._currentValue,G=G.parent!==ue?{parent:ue,pool:ue}:G):G=AS(),D={baseLanes:D.baseLanes|f,cachePool:G}),_.memoizedState=D,_.childLanes=Eb(l,C,f),c.memoizedState=wb,p):(Lo(c),f=l.child,l=f.sibling,f=Rs(f,{mode:"visible",children:p.children}),f.return=c,f.sibling=null,l!==null&&(C=c.deletions,C===null?(c.deletions=[l],c.flags|=16):C.push(l)),c.child=f,c.memoizedState=null,f)}function Ab(l,c){return c=Rg({mode:"visible",children:c},l.mode),c.return=l,l.child=c}function Rg(l,c){return l=Sr(22,l,null,c),l.lanes=0,l.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},l}function Sb(l,c,f){return jc(c,l.child,null,f),l=Ab(c,c.pendingProps.children),l.flags|=2,c.memoizedState=null,l}function B2(l,c,f){l.lanes|=c;var p=l.alternate;p!==null&&(p.lanes|=c),$v(l.return,c,f)}function Rb(l,c,f,p,_){var b=l.memoizedState;b===null?l.memoizedState={isBackwards:c,rendering:null,renderingStartTime:0,last:p,tail:f,tailMode:_}:(b.isBackwards=c,b.rendering=null,b.renderingStartTime=0,b.last=p,b.tail=f,b.tailMode=_)}function z2(l,c,f){var p=c.pendingProps,_=p.revealOrder,b=p.tail;if(Nn(l,c,p.children,f),p=mn.current,(p&2)!==0)p=p&1|2,c.flags|=128;else{if(l!==null&&(l.flags&128)!==0)e:for(l=c.child;l!==null;){if(l.tag===13)l.memoizedState!==null&&B2(l,f,c);else if(l.tag===19)B2(l,f,c);else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===c)break e;for(;l.sibling===null;){if(l.return===null||l.return===c)break e;l=l.return}l.sibling.return=l.return,l=l.sibling}p&=1}switch(ae(mn,p),_){case"forwards":for(f=c.child,_=null;f!==null;)l=f.alternate,l!==null&&xg(l)===null&&(_=f),f=f.sibling;f=_,f===null?(_=c.child,c.child=null):(_=f.sibling,f.sibling=null),Rb(c,!1,_,f,b);break;case"backwards":for(f=null,_=c.child,c.child=null;_!==null;){if(l=_.alternate,l!==null&&xg(l)===null){c.child=_;break}l=_.sibling,_.sibling=f,f=_,_=l}Rb(c,!0,f,null,b);break;case"together":Rb(c,!1,null,null,void 0);break;default:c.memoizedState=null}return c.child}function Ns(l,c,f){if(l!==null&&(c.dependencies=l.dependencies),jo|=c.lanes,(f&c.childLanes)===0)if(l!==null){if(lf(l,c,f,!1),(f&c.childLanes)===0)return null}else return null;if(l!==null&&c.child!==l.child)throw Error(r(153));if(c.child!==null){for(l=c.child,f=Rs(l,l.pendingProps),c.child=f,f.return=c;l.sibling!==null;)l=l.sibling,f=f.sibling=Rs(l,l.pendingProps),f.return=c;f.sibling=null}return c.child}function Cb(l,c){return(l.lanes&c)!==0?!0:(l=l.dependencies,!!(l!==null&&ag(l)))}function y5(l,c,f){switch(c.tag){case 3:Me(c,c.stateNode.containerInfo),Mo(c,gn,l.memoizedState.cache),of();break;case 27:case 5:Ge(c);break;case 4:Me(c,c.stateNode.containerInfo);break;case 10:Mo(c,c.type,c.memoizedProps.value);break;case 13:var p=c.memoizedState;if(p!==null)return p.dehydrated!==null?(Lo(c),c.flags|=128,null):(f&c.child.childLanes)!==0?F2(l,c,f):(Lo(c),l=Ns(l,c,f),l!==null?l.sibling:null);Lo(c);break;case 19:var _=(l.flags&128)!==0;if(p=(f&c.childLanes)!==0,p||(lf(l,c,f,!1),p=(f&c.childLanes)!==0),_){if(p)return z2(l,c,f);c.flags|=128}if(_=c.memoizedState,_!==null&&(_.rendering=null,_.tail=null,_.lastEffect=null),ae(mn,mn.current),p)break;return null;case 22:case 23:return c.lanes=0,N2(l,c,f);case 24:Mo(c,gn,l.memoizedState.cache)}return Ns(l,c,f)}function j2(l,c,f){if(l!==null)if(l.memoizedProps!==c.pendingProps)Sn=!0;else{if(!Cb(l,f)&&(c.flags&128)===0)return Sn=!1,y5(l,c,f);Sn=(l.flags&131072)!==0}else Sn=!1,dt&&(c.flags&1048576)!==0&&_S(c,og,c.index);switch(c.lanes=0,c.tag){case 16:e:{l=c.pendingProps;var p=c.elementType,_=p._init;if(p=_(p._payload),c.type=p,typeof p=="function")Uv(p)?(l=Tl(p,l),c.tag=1,c=U2(null,c,p,l,f)):(c.tag=0,c=Tb(null,c,p,l,f));else{if(p!=null){if(_=p.$$typeof,_===L){c.tag=11,c=M2(null,c,p,l,f);break e}else if(_===k){c.tag=14,c=O2(null,c,p,l,f);break e}}throw c=de(p)||p,Error(r(306,c,""))}}return c;case 0:return Tb(l,c,c.type,c.pendingProps,f);case 1:return p=c.type,_=Tl(p,c.pendingProps),U2(l,c,p,_,f);case 3:e:{if(Me(c,c.stateNode.containerInfo),l===null)throw Error(r(387));p=c.pendingProps;var b=c.memoizedState;_=b.element,Zv(l,c),gf(c,p,null,f);var C=c.memoizedState;if(p=C.cache,Mo(c,gn,p),p!==b.cache&&Wv(c,[gn],f,!0),pf(),p=C.element,b.isDehydrated)if(b={element:p,isDehydrated:!1,cache:C.cache},c.updateQueue.baseState=b,c.memoizedState=b,c.flags&256){c=V2(l,c,p,f);break e}else if(p!==_){_=$r(Error(r(424)),c),af(_),c=V2(l,c,p,f);break e}else{switch(l=c.stateNode.containerInfo,l.nodeType){case 9:l=l.body;break;default:l=l.nodeName==="HTML"?l.ownerDocument.body:l}for($t=_i(l.firstChild),ur=c,dt=!0,gl=null,ji=!0,f=b2(c,null,p,f),c.child=f;f;)f.flags=f.flags&-3|4096,f=f.sibling}else{if(of(),p===_){c=Ns(l,c,f);break e}Nn(l,c,p,f)}c=c.child}return c;case 26:return Sg(l,c),l===null?(f=qR(c.type,null,c.pendingProps,null))?c.memoizedState=f:dt||(f=c.type,l=c.pendingProps,p=zg(Se.current).createElement(f),p[Gt]=c,p[kn]=l,Ln(p,f,l),Zt(p),c.stateNode=p):c.memoizedState=qR(c.type,l.memoizedProps,c.pendingProps,l.memoizedState),null;case 27:return Ge(c),l===null&&dt&&(p=c.stateNode=HR(c.type,c.pendingProps,Se.current),ur=c,ji=!0,_=$t,qo(c.type)?(l0=_,$t=_i(p.firstChild)):$t=_),Nn(l,c,c.pendingProps.children,f),Sg(l,c),l===null&&(c.flags|=4194304),c.child;case 5:return l===null&&dt&&((_=p=$t)&&(p=W5(p,c.type,c.pendingProps,ji),p!==null?(c.stateNode=p,ur=c,$t=_i(p.firstChild),ji=!1,_=!0):_=!1),_||ml(c)),Ge(c),_=c.type,b=c.pendingProps,C=l!==null?l.memoizedProps:null,p=b.children,i0(_,b)?p=null:C!==null&&i0(_,C)&&(c.flags|=32),c.memoizedState!==null&&(_=rb(l,c,c5,null,null,f),Uf._currentValue=_),Sg(l,c),Nn(l,c,p,f),c.child;case 6:return l===null&&dt&&((l=f=$t)&&(f=q5(f,c.pendingProps,ji),f!==null?(c.stateNode=f,ur=c,$t=null,l=!0):l=!1),l||ml(c)),null;case 13:return F2(l,c,f);case 4:return Me(c,c.stateNode.containerInfo),p=c.pendingProps,l===null?c.child=jc(c,null,p,f):Nn(l,c,p,f),c.child;case 11:return M2(l,c,c.type,c.pendingProps,f);case 7:return Nn(l,c,c.pendingProps,f),c.child;case 8:return Nn(l,c,c.pendingProps.children,f),c.child;case 12:return Nn(l,c,c.pendingProps.children,f),c.child;case 10:return p=c.pendingProps,Mo(c,c.type,p.value),Nn(l,c,p.children,f),c.child;case 9:return _=c.type._context,p=c.pendingProps.children,_l(c),_=qn(_),p=p(_),c.flags|=1,Nn(l,c,p,f),c.child;case 14:return O2(l,c,c.type,c.pendingProps,f);case 15:return k2(l,c,c.type,c.pendingProps,f);case 19:return z2(l,c,f);case 31:return p=c.pendingProps,f=c.mode,p={mode:p.mode,children:p.children},l===null?(f=Rg(p,f),f.ref=c.ref,c.child=f,f.return=c,c=f):(f=Rs(l.child,p),f.ref=c.ref,c.child=f,f.return=c,c=f),c;case 22:return N2(l,c,f);case 24:return _l(c),p=qn(gn),l===null?(_=Yv(),_===null&&(_=Mt,b=qv(),_.pooledCache=b,b.refCount++,b!==null&&(_.pooledCacheLanes|=f),_=b),c.memoizedState={parent:p,cache:_},Gv(c),Mo(c,gn,_)):((l.lanes&f)!==0&&(Zv(l,c),gf(c,null,null,f),pf()),_=l.memoizedState,b=c.memoizedState,_.parent!==p?(_={parent:p,cache:p},c.memoizedState=_,c.lanes===0&&(c.memoizedState=c.updateQueue.baseState=_),Mo(c,gn,p)):(p=b.cache,Mo(c,gn,p),p!==_.cache&&Wv(c,[gn],f,!0))),Nn(l,c,c.pendingProps.children,f),c.child;case 29:throw c.pendingProps}throw Error(r(156,c.tag))}function Ds(l){l.flags|=4}function H2(l,c){if(c.type!=="stylesheet"||(c.state.loading&4)!==0)l.flags&=-16777217;else if(l.flags|=16777216,!ZR(c)){if(c=Yr.current,c!==null&&((ut&4194048)===ut?Hi!==null:(ut&62914560)!==ut&&(ut&536870912)===0||c!==Hi))throw ff=Kv,SS;l.flags|=8192}}function Cg(l,c){c!==null&&(l.flags|=4),l.flags&16384&&(c=l.tag!==22?_o():536870912,l.lanes|=c,qc|=c)}function wf(l,c){if(!dt)switch(l.tailMode){case"hidden":c=l.tail;for(var f=null;c!==null;)c.alternate!==null&&(f=c),c=c.sibling;f===null?l.tail=null:f.sibling=null;break;case"collapsed":f=l.tail;for(var p=null;f!==null;)f.alternate!==null&&(p=f),f=f.sibling;p===null?c||l.tail===null?l.tail=null:l.tail.sibling=null:p.sibling=null}}function Vt(l){var c=l.alternate!==null&&l.alternate.child===l.child,f=0,p=0;if(c)for(var _=l.child;_!==null;)f|=_.lanes|_.childLanes,p|=_.subtreeFlags&65011712,p|=_.flags&65011712,_.return=l,_=_.sibling;else for(_=l.child;_!==null;)f|=_.lanes|_.childLanes,p|=_.subtreeFlags,p|=_.flags,_.return=l,_=_.sibling;return l.subtreeFlags|=p,l.childLanes=f,c}function _5(l,c,f){var p=c.pendingProps;switch(zv(c),c.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Vt(c),null;case 1:return Vt(c),null;case 3:return f=c.stateNode,p=null,l!==null&&(p=l.memoizedState.cache),c.memoizedState.cache!==p&&(c.flags|=2048),Ms(gn),lt(),f.pendingContext&&(f.context=f.pendingContext,f.pendingContext=null),(l===null||l.child===null)&&(sf(c)?Ds(c):l===null||l.memoizedState.isDehydrated&&(c.flags&256)===0||(c.flags|=1024,TS())),Vt(c),null;case 26:return f=c.memoizedState,l===null?(Ds(c),f!==null?(Vt(c),H2(c,f)):(Vt(c),c.flags&=-16777217)):f?f!==l.memoizedState?(Ds(c),Vt(c),H2(c,f)):(Vt(c),c.flags&=-16777217):(l.memoizedProps!==p&&Ds(c),Vt(c),c.flags&=-16777217),null;case 27:xn(c),f=Se.current;var _=c.type;if(l!==null&&c.stateNode!=null)l.memoizedProps!==p&&Ds(c);else{if(!p){if(c.stateNode===null)throw Error(r(166));return Vt(c),null}l=me.current,sf(c)?vS(c):(l=HR(_,p,f),c.stateNode=l,Ds(c))}return Vt(c),null;case 5:if(xn(c),f=c.type,l!==null&&c.stateNode!=null)l.memoizedProps!==p&&Ds(c);else{if(!p){if(c.stateNode===null)throw Error(r(166));return Vt(c),null}if(l=me.current,sf(c))vS(c);else{switch(_=zg(Se.current),l){case 1:l=_.createElementNS("http://www.w3.org/2000/svg",f);break;case 2:l=_.createElementNS("http://www.w3.org/1998/Math/MathML",f);break;default:switch(f){case"svg":l=_.createElementNS("http://www.w3.org/2000/svg",f);break;case"math":l=_.createElementNS("http://www.w3.org/1998/Math/MathML",f);break;case"script":l=_.createElement("div"),l.innerHTML="<script><\/script>",l=l.removeChild(l.firstChild);break;case"select":l=typeof p.is=="string"?_.createElement("select",{is:p.is}):_.createElement("select"),p.multiple?l.multiple=!0:p.size&&(l.size=p.size);break;default:l=typeof p.is=="string"?_.createElement(f,{is:p.is}):_.createElement(f)}}l[Gt]=c,l[kn]=p;e:for(_=c.child;_!==null;){if(_.tag===5||_.tag===6)l.appendChild(_.stateNode);else if(_.tag!==4&&_.tag!==27&&_.child!==null){_.child.return=_,_=_.child;continue}if(_===c)break e;for(;_.sibling===null;){if(_.return===null||_.return===c)break e;_=_.return}_.sibling.return=_.return,_=_.sibling}c.stateNode=l;e:switch(Ln(l,f,p),f){case"button":case"input":case"select":case"textarea":l=!!p.autoFocus;break e;case"img":l=!0;break e;default:l=!1}l&&Ds(c)}}return Vt(c),c.flags&=-16777217,null;case 6:if(l&&c.stateNode!=null)l.memoizedProps!==p&&Ds(c);else{if(typeof p!="string"&&c.stateNode===null)throw Error(r(166));if(l=Se.current,sf(c)){if(l=c.stateNode,f=c.memoizedProps,p=null,_=ur,_!==null)switch(_.tag){case 27:case 5:p=_.memoizedProps}l[Gt]=c,l=!!(l.nodeValue===f||p!==null&&p.suppressHydrationWarning===!0||LR(l.nodeValue,f)),l||ml(c)}else l=zg(l).createTextNode(p),l[Gt]=c,c.stateNode=l}return Vt(c),null;case 13:if(p=c.memoizedState,l===null||l.memoizedState!==null&&l.memoizedState.dehydrated!==null){if(_=sf(c),p!==null&&p.dehydrated!==null){if(l===null){if(!_)throw Error(r(318));if(_=c.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(r(317));_[Gt]=c}else of(),(c.flags&128)===0&&(c.memoizedState=null),c.flags|=4;Vt(c),_=!1}else _=TS(),l!==null&&l.memoizedState!==null&&(l.memoizedState.hydrationErrors=_),_=!0;if(!_)return c.flags&256?(ks(c),c):(ks(c),null)}if(ks(c),(c.flags&128)!==0)return c.lanes=f,c;if(f=p!==null,l=l!==null&&l.memoizedState!==null,f){p=c.child,_=null,p.alternate!==null&&p.alternate.memoizedState!==null&&p.alternate.memoizedState.cachePool!==null&&(_=p.alternate.memoizedState.cachePool.pool);var b=null;p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(b=p.memoizedState.cachePool.pool),b!==_&&(p.flags|=2048)}return f!==l&&f&&(c.child.flags|=8192),Cg(c,c.updateQueue),Vt(c),null;case 4:return lt(),l===null&&Jb(c.stateNode.containerInfo),Vt(c),null;case 10:return Ms(c.type),Vt(c),null;case 19:if(se(mn),_=c.memoizedState,_===null)return Vt(c),null;if(p=(c.flags&128)!==0,b=_.rendering,b===null)if(p)wf(_,!1);else{if(Wt!==0||l!==null&&(l.flags&128)!==0)for(l=c.child;l!==null;){if(b=xg(l),b!==null){for(c.flags|=128,wf(_,!1),l=b.updateQueue,c.updateQueue=l,Cg(c,l),c.subtreeFlags=0,l=f,f=c.child;f!==null;)yS(f,l),f=f.sibling;return ae(mn,mn.current&1|2),c.child}l=l.sibling}_.tail!==null&&pr()>Mg&&(c.flags|=128,p=!0,wf(_,!1),c.lanes=4194304)}else{if(!p)if(l=xg(b),l!==null){if(c.flags|=128,p=!0,l=l.updateQueue,c.updateQueue=l,Cg(c,l),wf(_,!0),_.tail===null&&_.tailMode==="hidden"&&!b.alternate&&!dt)return Vt(c),null}else 2*pr()-_.renderingStartTime>Mg&&f!==536870912&&(c.flags|=128,p=!0,wf(_,!1),c.lanes=4194304);_.isBackwards?(b.sibling=c.child,c.child=b):(l=_.last,l!==null?l.sibling=b:c.child=b,_.last=b)}return _.tail!==null?(c=_.tail,_.rendering=c,_.tail=c.sibling,_.renderingStartTime=pr(),c.sibling=null,l=mn.current,ae(mn,p?l&1|2:l&1),c):(Vt(c),null);case 22:case 23:return ks(c),tb(),p=c.memoizedState!==null,l!==null?l.memoizedState!==null!==p&&(c.flags|=8192):p&&(c.flags|=8192),p?(f&536870912)!==0&&(c.flags&128)===0&&(Vt(c),c.subtreeFlags&6&&(c.flags|=8192)):Vt(c),f=c.updateQueue,f!==null&&Cg(c,f.retryQueue),f=null,l!==null&&l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(f=l.memoizedState.cachePool.pool),p=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(p=c.memoizedState.cachePool.pool),p!==f&&(c.flags|=2048),l!==null&&se(vl),null;case 24:return f=null,l!==null&&(f=l.memoizedState.cache),c.memoizedState.cache!==f&&(c.flags|=2048),Ms(gn),Vt(c),null;case 25:return null;case 30:return null}throw Error(r(156,c.tag))}function v5(l,c){switch(zv(c),c.tag){case 1:return l=c.flags,l&65536?(c.flags=l&-65537|128,c):null;case 3:return Ms(gn),lt(),l=c.flags,(l&65536)!==0&&(l&128)===0?(c.flags=l&-65537|128,c):null;case 26:case 27:case 5:return xn(c),null;case 13:if(ks(c),l=c.memoizedState,l!==null&&l.dehydrated!==null){if(c.alternate===null)throw Error(r(340));of()}return l=c.flags,l&65536?(c.flags=l&-65537|128,c):null;case 19:return se(mn),null;case 4:return lt(),null;case 10:return Ms(c.type),null;case 22:case 23:return ks(c),tb(),l!==null&&se(vl),l=c.flags,l&65536?(c.flags=l&-65537|128,c):null;case 24:return Ms(gn),null;case 25:return null;default:return null}}function $2(l,c){switch(zv(c),c.tag){case 3:Ms(gn),lt();break;case 26:case 27:case 5:xn(c);break;case 4:lt();break;case 13:ks(c);break;case 19:se(mn);break;case 10:Ms(c.type);break;case 22:case 23:ks(c),tb(),l!==null&&se(vl);break;case 24:Ms(gn)}}function xf(l,c){try{var f=c.updateQueue,p=f!==null?f.lastEffect:null;if(p!==null){var _=p.next;f=_;do{if((f.tag&l)===l){p=void 0;var b=f.create,C=f.inst;p=b(),C.destroy=p}f=f.next}while(f!==_)}}catch(D){Ct(c,c.return,D)}}function Vo(l,c,f){try{var p=c.updateQueue,_=p!==null?p.lastEffect:null;if(_!==null){var b=_.next;p=b;do{if((p.tag&l)===l){var C=p.inst,D=C.destroy;if(D!==void 0){C.destroy=void 0,_=c;var G=f,ue=D;try{ue()}catch(ge){Ct(_,G,ge)}}}p=p.next}while(p!==b)}}catch(ge){Ct(c,c.return,ge)}}function W2(l){var c=l.updateQueue;if(c!==null){var f=l.stateNode;try{OS(c,f)}catch(p){Ct(l,l.return,p)}}}function q2(l,c,f){f.props=Tl(l.type,l.memoizedProps),f.state=l.memoizedState;try{f.componentWillUnmount()}catch(p){Ct(l,c,p)}}function Ef(l,c){try{var f=l.ref;if(f!==null){switch(l.tag){case 26:case 27:case 5:var p=l.stateNode;break;case 30:p=l.stateNode;break;default:p=l.stateNode}typeof f=="function"?l.refCleanup=f(p):f.current=p}}catch(_){Ct(l,c,_)}}function $i(l,c){var f=l.ref,p=l.refCleanup;if(f!==null)if(typeof p=="function")try{p()}catch(_){Ct(l,c,_)}finally{l.refCleanup=null,l=l.alternate,l!=null&&(l.refCleanup=null)}else if(typeof f=="function")try{f(null)}catch(_){Ct(l,c,_)}else f.current=null}function X2(l){var c=l.type,f=l.memoizedProps,p=l.stateNode;try{e:switch(c){case"button":case"input":case"select":case"textarea":f.autoFocus&&p.focus();break e;case"img":f.src?p.src=f.src:f.srcSet&&(p.srcset=f.srcSet)}}catch(_){Ct(l,l.return,_)}}function Ib(l,c,f){try{var p=l.stateNode;B5(p,l.type,f,c),p[kn]=c}catch(_){Ct(l,l.return,_)}}function Y2(l){return l.tag===5||l.tag===3||l.tag===26||l.tag===27&&qo(l.type)||l.tag===4}function Pb(l){e:for(;;){for(;l.sibling===null;){if(l.return===null||Y2(l.return))return null;l=l.return}for(l.sibling.return=l.return,l=l.sibling;l.tag!==5&&l.tag!==6&&l.tag!==18;){if(l.tag===27&&qo(l.type)||l.flags&2||l.child===null||l.tag===4)continue e;l.child.return=l,l=l.child}if(!(l.flags&2))return l.stateNode}}function Mb(l,c,f){var p=l.tag;if(p===5||p===6)l=l.stateNode,c?(f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f).insertBefore(l,c):(c=f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f,c.appendChild(l),f=f._reactRootContainer,f!=null||c.onclick!==null||(c.onclick=Bg));else if(p!==4&&(p===27&&qo(l.type)&&(f=l.stateNode,c=null),l=l.child,l!==null))for(Mb(l,c,f),l=l.sibling;l!==null;)Mb(l,c,f),l=l.sibling}function Ig(l,c,f){var p=l.tag;if(p===5||p===6)l=l.stateNode,c?f.insertBefore(l,c):f.appendChild(l);else if(p!==4&&(p===27&&qo(l.type)&&(f=l.stateNode),l=l.child,l!==null))for(Ig(l,c,f),l=l.sibling;l!==null;)Ig(l,c,f),l=l.sibling}function K2(l){var c=l.stateNode,f=l.memoizedProps;try{for(var p=l.type,_=c.attributes;_.length;)c.removeAttributeNode(_[0]);Ln(c,p,f),c[Gt]=l,c[kn]=f}catch(b){Ct(l,l.return,b)}}var Ls=!1,en=!1,Ob=!1,G2=typeof WeakSet=="function"?WeakSet:Set,Rn=null;function b5(l,c){if(l=l.containerInfo,n0=Xg,l=aS(l),Pv(l)){if("selectionStart"in l)var f={start:l.selectionStart,end:l.selectionEnd};else e:{f=(f=l.ownerDocument)&&f.defaultView||window;var p=f.getSelection&&f.getSelection();if(p&&p.rangeCount!==0){f=p.anchorNode;var _=p.anchorOffset,b=p.focusNode;p=p.focusOffset;try{f.nodeType,b.nodeType}catch{f=null;break e}var C=0,D=-1,G=-1,ue=0,ge=0,ve=l,he=null;t:for(;;){for(var fe;ve!==f||_!==0&&ve.nodeType!==3||(D=C+_),ve!==b||p!==0&&ve.nodeType!==3||(G=C+p),ve.nodeType===3&&(C+=ve.nodeValue.length),(fe=ve.firstChild)!==null;)he=ve,ve=fe;for(;;){if(ve===l)break t;if(he===f&&++ue===_&&(D=C),he===b&&++ge===p&&(G=C),(fe=ve.nextSibling)!==null)break;ve=he,he=ve.parentNode}ve=fe}f=D===-1||G===-1?null:{start:D,end:G}}else f=null}f=f||{start:0,end:0}}else f=null;for(r0={focusedElem:l,selectionRange:f},Xg=!1,Rn=c;Rn!==null;)if(c=Rn,l=c.child,(c.subtreeFlags&1024)!==0&&l!==null)l.return=c,Rn=l;else for(;Rn!==null;){switch(c=Rn,b=c.alternate,l=c.flags,c.tag){case 0:break;case 11:case 15:break;case 1:if((l&1024)!==0&&b!==null){l=void 0,f=c,_=b.memoizedProps,b=b.memoizedState,p=f.stateNode;try{var He=Tl(f.type,_,f.elementType===f.type);l=p.getSnapshotBeforeUpdate(He,b),p.__reactInternalSnapshotBeforeUpdate=l}catch(Ve){Ct(f,f.return,Ve)}}break;case 3:if((l&1024)!==0){if(l=c.stateNode.containerInfo,f=l.nodeType,f===9)o0(l);else if(f===1)switch(l.nodeName){case"HEAD":case"HTML":case"BODY":o0(l);break;default:l.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((l&1024)!==0)throw Error(r(163))}if(l=c.sibling,l!==null){l.return=c.return,Rn=l;break}Rn=c.return}}function Z2(l,c,f){var p=f.flags;switch(f.tag){case 0:case 11:case 15:Fo(l,f),p&4&&xf(5,f);break;case 1:if(Fo(l,f),p&4)if(l=f.stateNode,c===null)try{l.componentDidMount()}catch(C){Ct(f,f.return,C)}else{var _=Tl(f.type,c.memoizedProps);c=c.memoizedState;try{l.componentDidUpdate(_,c,l.__reactInternalSnapshotBeforeUpdate)}catch(C){Ct(f,f.return,C)}}p&64&&W2(f),p&512&&Ef(f,f.return);break;case 3:if(Fo(l,f),p&64&&(l=f.updateQueue,l!==null)){if(c=null,f.child!==null)switch(f.child.tag){case 27:case 5:c=f.child.stateNode;break;case 1:c=f.child.stateNode}try{OS(l,c)}catch(C){Ct(f,f.return,C)}}break;case 27:c===null&&p&4&&K2(f);case 26:case 5:Fo(l,f),c===null&&p&4&&X2(f),p&512&&Ef(f,f.return);break;case 12:Fo(l,f);break;case 13:Fo(l,f),p&4&&eR(l,f),p&64&&(l=f.memoizedState,l!==null&&(l=l.dehydrated,l!==null&&(f=I5.bind(null,f),X5(l,f))));break;case 22:if(p=f.memoizedState!==null||Ls,!p){c=c!==null&&c.memoizedState!==null||en,_=Ls;var b=en;Ls=p,(en=c)&&!b?Bo(l,f,(f.subtreeFlags&8772)!==0):Fo(l,f),Ls=_,en=b}break;case 30:break;default:Fo(l,f)}}function Q2(l){var c=l.alternate;c!==null&&(l.alternate=null,Q2(c)),l.child=null,l.deletions=null,l.sibling=null,l.tag===5&&(c=l.stateNode,c!==null&&mc(c)),l.stateNode=null,l.return=null,l.dependencies=null,l.memoizedProps=null,l.memoizedState=null,l.pendingProps=null,l.stateNode=null,l.updateQueue=null}var Nt=null,mr=!1;function Us(l,c,f){for(f=f.child;f!==null;)J2(l,c,f),f=f.sibling}function J2(l,c,f){if($n&&typeof $n.onCommitFiberUnmount=="function")try{$n.onCommitFiberUnmount(go,f)}catch{}switch(f.tag){case 26:en||$i(f,c),Us(l,c,f),f.memoizedState?f.memoizedState.count--:f.stateNode&&(f=f.stateNode,f.parentNode.removeChild(f));break;case 27:en||$i(f,c);var p=Nt,_=mr;qo(f.type)&&(Nt=f.stateNode,mr=!1),Us(l,c,f),kf(f.stateNode),Nt=p,mr=_;break;case 5:en||$i(f,c);case 6:if(p=Nt,_=mr,Nt=null,Us(l,c,f),Nt=p,mr=_,Nt!==null)if(mr)try{(Nt.nodeType===9?Nt.body:Nt.nodeName==="HTML"?Nt.ownerDocument.body:Nt).removeChild(f.stateNode)}catch(b){Ct(f,c,b)}else try{Nt.removeChild(f.stateNode)}catch(b){Ct(f,c,b)}break;case 18:Nt!==null&&(mr?(l=Nt,zR(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,f.stateNode),zf(l)):zR(Nt,f.stateNode));break;case 4:p=Nt,_=mr,Nt=f.stateNode.containerInfo,mr=!0,Us(l,c,f),Nt=p,mr=_;break;case 0:case 11:case 14:case 15:en||Vo(2,f,c),en||Vo(4,f,c),Us(l,c,f);break;case 1:en||($i(f,c),p=f.stateNode,typeof p.componentWillUnmount=="function"&&q2(f,c,p)),Us(l,c,f);break;case 21:Us(l,c,f);break;case 22:en=(p=en)||f.memoizedState!==null,Us(l,c,f),en=p;break;default:Us(l,c,f)}}function eR(l,c){if(c.memoizedState===null&&(l=c.alternate,l!==null&&(l=l.memoizedState,l!==null&&(l=l.dehydrated,l!==null))))try{zf(l)}catch(f){Ct(c,c.return,f)}}function T5(l){switch(l.tag){case 13:case 19:var c=l.stateNode;return c===null&&(c=l.stateNode=new G2),c;case 22:return l=l.stateNode,c=l._retryCache,c===null&&(c=l._retryCache=new G2),c;default:throw Error(r(435,l.tag))}}function kb(l,c){var f=T5(l);c.forEach(function(p){var _=P5.bind(null,l,p);f.has(p)||(f.add(p),p.then(_,_))})}function Rr(l,c){var f=c.deletions;if(f!==null)for(var p=0;p<f.length;p++){var _=f[p],b=l,C=c,D=C;e:for(;D!==null;){switch(D.tag){case 27:if(qo(D.type)){Nt=D.stateNode,mr=!1;break e}break;case 5:Nt=D.stateNode,mr=!1;break e;case 3:case 4:Nt=D.stateNode.containerInfo,mr=!0;break e}D=D.return}if(Nt===null)throw Error(r(160));J2(b,C,_),Nt=null,mr=!1,b=_.alternate,b!==null&&(b.return=null),_.return=null}if(c.subtreeFlags&13878)for(c=c.child;c!==null;)tR(c,l),c=c.sibling}var yi=null;function tR(l,c){var f=l.alternate,p=l.flags;switch(l.tag){case 0:case 11:case 14:case 15:Rr(c,l),Cr(l),p&4&&(Vo(3,l,l.return),xf(3,l),Vo(5,l,l.return));break;case 1:Rr(c,l),Cr(l),p&512&&(en||f===null||$i(f,f.return)),p&64&&Ls&&(l=l.updateQueue,l!==null&&(p=l.callbacks,p!==null&&(f=l.shared.hiddenCallbacks,l.shared.hiddenCallbacks=f===null?p:f.concat(p))));break;case 26:var _=yi;if(Rr(c,l),Cr(l),p&512&&(en||f===null||$i(f,f.return)),p&4){var b=f!==null?f.memoizedState:null;if(p=l.memoizedState,f===null)if(p===null)if(l.stateNode===null){e:{p=l.type,f=l.memoizedProps,_=_.ownerDocument||_;t:switch(p){case"title":b=_.getElementsByTagName("title")[0],(!b||b[To]||b[Gt]||b.namespaceURI==="http://www.w3.org/2000/svg"||b.hasAttribute("itemprop"))&&(b=_.createElement(p),_.head.insertBefore(b,_.querySelector("head > title"))),Ln(b,p,f),b[Gt]=l,Zt(b),p=b;break e;case"link":var C=KR("link","href",_).get(p+(f.href||""));if(C){for(var D=0;D<C.length;D++)if(b=C[D],b.getAttribute("href")===(f.href==null||f.href===""?null:f.href)&&b.getAttribute("rel")===(f.rel==null?null:f.rel)&&b.getAttribute("title")===(f.title==null?null:f.title)&&b.getAttribute("crossorigin")===(f.crossOrigin==null?null:f.crossOrigin)){C.splice(D,1);break t}}b=_.createElement(p),Ln(b,p,f),_.head.appendChild(b);break;case"meta":if(C=KR("meta","content",_).get(p+(f.content||""))){for(D=0;D<C.length;D++)if(b=C[D],b.getAttribute("content")===(f.content==null?null:""+f.content)&&b.getAttribute("name")===(f.name==null?null:f.name)&&b.getAttribute("property")===(f.property==null?null:f.property)&&b.getAttribute("http-equiv")===(f.httpEquiv==null?null:f.httpEquiv)&&b.getAttribute("charset")===(f.charSet==null?null:f.charSet)){C.splice(D,1);break t}}b=_.createElement(p),Ln(b,p,f),_.head.appendChild(b);break;default:throw Error(r(468,p))}b[Gt]=l,Zt(b),p=b}l.stateNode=p}else GR(_,l.type,l.stateNode);else l.stateNode=YR(_,p,l.memoizedProps);else b!==p?(b===null?f.stateNode!==null&&(f=f.stateNode,f.parentNode.removeChild(f)):b.count--,p===null?GR(_,l.type,l.stateNode):YR(_,p,l.memoizedProps)):p===null&&l.stateNode!==null&&Ib(l,l.memoizedProps,f.memoizedProps)}break;case 27:Rr(c,l),Cr(l),p&512&&(en||f===null||$i(f,f.return)),f!==null&&p&4&&Ib(l,l.memoizedProps,f.memoizedProps);break;case 5:if(Rr(c,l),Cr(l),p&512&&(en||f===null||$i(f,f.return)),l.flags&32){_=l.stateNode;try{jr(_,"")}catch(fe){Ct(l,l.return,fe)}}p&4&&l.stateNode!=null&&(_=l.memoizedProps,Ib(l,_,f!==null?f.memoizedProps:_)),p&1024&&(Ob=!0);break;case 6:if(Rr(c,l),Cr(l),p&4){if(l.stateNode===null)throw Error(r(162));p=l.memoizedProps,f=l.stateNode;try{f.nodeValue=p}catch(fe){Ct(l,l.return,fe)}}break;case 3:if($g=null,_=yi,yi=jg(c.containerInfo),Rr(c,l),yi=_,Cr(l),p&4&&f!==null&&f.memoizedState.isDehydrated)try{zf(c.containerInfo)}catch(fe){Ct(l,l.return,fe)}Ob&&(Ob=!1,nR(l));break;case 4:p=yi,yi=jg(l.stateNode.containerInfo),Rr(c,l),Cr(l),yi=p;break;case 12:Rr(c,l),Cr(l);break;case 13:Rr(c,l),Cr(l),l.child.flags&8192&&l.memoizedState!==null!=(f!==null&&f.memoizedState!==null)&&(Fb=pr()),p&4&&(p=l.updateQueue,p!==null&&(l.updateQueue=null,kb(l,p)));break;case 22:_=l.memoizedState!==null;var G=f!==null&&f.memoizedState!==null,ue=Ls,ge=en;if(Ls=ue||_,en=ge||G,Rr(c,l),en=ge,Ls=ue,Cr(l),p&8192)e:for(c=l.stateNode,c._visibility=_?c._visibility&-2:c._visibility|1,_&&(f===null||G||Ls||en||wl(l)),f=null,c=l;;){if(c.tag===5||c.tag===26){if(f===null){G=f=c;try{if(b=G.stateNode,_)C=b.style,typeof C.setProperty=="function"?C.setProperty("display","none","important"):C.display="none";else{D=G.stateNode;var ve=G.memoizedProps.style,he=ve!=null&&ve.hasOwnProperty("display")?ve.display:null;D.style.display=he==null||typeof he=="boolean"?"":(""+he).trim()}}catch(fe){Ct(G,G.return,fe)}}}else if(c.tag===6){if(f===null){G=c;try{G.stateNode.nodeValue=_?"":G.memoizedProps}catch(fe){Ct(G,G.return,fe)}}}else if((c.tag!==22&&c.tag!==23||c.memoizedState===null||c===l)&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===l)break e;for(;c.sibling===null;){if(c.return===null||c.return===l)break e;f===c&&(f=null),c=c.return}f===c&&(f=null),c.sibling.return=c.return,c=c.sibling}p&4&&(p=l.updateQueue,p!==null&&(f=p.retryQueue,f!==null&&(p.retryQueue=null,kb(l,f))));break;case 19:Rr(c,l),Cr(l),p&4&&(p=l.updateQueue,p!==null&&(l.updateQueue=null,kb(l,p)));break;case 30:break;case 21:break;default:Rr(c,l),Cr(l)}}function Cr(l){var c=l.flags;if(c&2){try{for(var f,p=l.return;p!==null;){if(Y2(p)){f=p;break}p=p.return}if(f==null)throw Error(r(160));switch(f.tag){case 27:var _=f.stateNode,b=Pb(l);Ig(l,b,_);break;case 5:var C=f.stateNode;f.flags&32&&(jr(C,""),f.flags&=-33);var D=Pb(l);Ig(l,D,C);break;case 3:case 4:var G=f.stateNode.containerInfo,ue=Pb(l);Mb(l,ue,G);break;default:throw Error(r(161))}}catch(ge){Ct(l,l.return,ge)}l.flags&=-3}c&4096&&(l.flags&=-4097)}function nR(l){if(l.subtreeFlags&1024)for(l=l.child;l!==null;){var c=l;nR(c),c.tag===5&&c.flags&1024&&c.stateNode.reset(),l=l.sibling}}function Fo(l,c){if(c.subtreeFlags&8772)for(c=c.child;c!==null;)Z2(l,c.alternate,c),c=c.sibling}function wl(l){for(l=l.child;l!==null;){var c=l;switch(c.tag){case 0:case 11:case 14:case 15:Vo(4,c,c.return),wl(c);break;case 1:$i(c,c.return);var f=c.stateNode;typeof f.componentWillUnmount=="function"&&q2(c,c.return,f),wl(c);break;case 27:kf(c.stateNode);case 26:case 5:$i(c,c.return),wl(c);break;case 22:c.memoizedState===null&&wl(c);break;case 30:wl(c);break;default:wl(c)}l=l.sibling}}function Bo(l,c,f){for(f=f&&(c.subtreeFlags&8772)!==0,c=c.child;c!==null;){var p=c.alternate,_=l,b=c,C=b.flags;switch(b.tag){case 0:case 11:case 15:Bo(_,b,f),xf(4,b);break;case 1:if(Bo(_,b,f),p=b,_=p.stateNode,typeof _.componentDidMount=="function")try{_.componentDidMount()}catch(ue){Ct(p,p.return,ue)}if(p=b,_=p.updateQueue,_!==null){var D=p.stateNode;try{var G=_.shared.hiddenCallbacks;if(G!==null)for(_.shared.hiddenCallbacks=null,_=0;_<G.length;_++)MS(G[_],D)}catch(ue){Ct(p,p.return,ue)}}f&&C&64&&W2(b),Ef(b,b.return);break;case 27:K2(b);case 26:case 5:Bo(_,b,f),f&&p===null&&C&4&&X2(b),Ef(b,b.return);break;case 12:Bo(_,b,f);break;case 13:Bo(_,b,f),f&&C&4&&eR(_,b);break;case 22:b.memoizedState===null&&Bo(_,b,f),Ef(b,b.return);break;case 30:break;default:Bo(_,b,f)}c=c.sibling}}function Nb(l,c){var f=null;l!==null&&l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(f=l.memoizedState.cachePool.pool),l=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(l=c.memoizedState.cachePool.pool),l!==f&&(l!=null&&l.refCount++,f!=null&&cf(f))}function Db(l,c){l=null,c.alternate!==null&&(l=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==l&&(c.refCount++,l!=null&&cf(l))}function Wi(l,c,f,p){if(c.subtreeFlags&10256)for(c=c.child;c!==null;)rR(l,c,f,p),c=c.sibling}function rR(l,c,f,p){var _=c.flags;switch(c.tag){case 0:case 11:case 15:Wi(l,c,f,p),_&2048&&xf(9,c);break;case 1:Wi(l,c,f,p);break;case 3:Wi(l,c,f,p),_&2048&&(l=null,c.alternate!==null&&(l=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==l&&(c.refCount++,l!=null&&cf(l)));break;case 12:if(_&2048){Wi(l,c,f,p),l=c.stateNode;try{var b=c.memoizedProps,C=b.id,D=b.onPostCommit;typeof D=="function"&&D(C,c.alternate===null?"mount":"update",l.passiveEffectDuration,-0)}catch(G){Ct(c,c.return,G)}}else Wi(l,c,f,p);break;case 13:Wi(l,c,f,p);break;case 23:break;case 22:b=c.stateNode,C=c.alternate,c.memoizedState!==null?b._visibility&2?Wi(l,c,f,p):Af(l,c):b._visibility&2?Wi(l,c,f,p):(b._visibility|=2,Hc(l,c,f,p,(c.subtreeFlags&10256)!==0)),_&2048&&Nb(C,c);break;case 24:Wi(l,c,f,p),_&2048&&Db(c.alternate,c);break;default:Wi(l,c,f,p)}}function Hc(l,c,f,p,_){for(_=_&&(c.subtreeFlags&10256)!==0,c=c.child;c!==null;){var b=l,C=c,D=f,G=p,ue=C.flags;switch(C.tag){case 0:case 11:case 15:Hc(b,C,D,G,_),xf(8,C);break;case 23:break;case 22:var ge=C.stateNode;C.memoizedState!==null?ge._visibility&2?Hc(b,C,D,G,_):Af(b,C):(ge._visibility|=2,Hc(b,C,D,G,_)),_&&ue&2048&&Nb(C.alternate,C);break;case 24:Hc(b,C,D,G,_),_&&ue&2048&&Db(C.alternate,C);break;default:Hc(b,C,D,G,_)}c=c.sibling}}function Af(l,c){if(c.subtreeFlags&10256)for(c=c.child;c!==null;){var f=l,p=c,_=p.flags;switch(p.tag){case 22:Af(f,p),_&2048&&Nb(p.alternate,p);break;case 24:Af(f,p),_&2048&&Db(p.alternate,p);break;default:Af(f,p)}c=c.sibling}}var Sf=8192;function $c(l){if(l.subtreeFlags&Sf)for(l=l.child;l!==null;)iR(l),l=l.sibling}function iR(l){switch(l.tag){case 26:$c(l),l.flags&Sf&&l.memoizedState!==null&&o8(yi,l.memoizedState,l.memoizedProps);break;case 5:$c(l);break;case 3:case 4:var c=yi;yi=jg(l.stateNode.containerInfo),$c(l),yi=c;break;case 22:l.memoizedState===null&&(c=l.alternate,c!==null&&c.memoizedState!==null?(c=Sf,Sf=16777216,$c(l),Sf=c):$c(l));break;default:$c(l)}}function sR(l){var c=l.alternate;if(c!==null&&(l=c.child,l!==null)){c.child=null;do c=l.sibling,l.sibling=null,l=c;while(l!==null)}}function Rf(l){var c=l.deletions;if((l.flags&16)!==0){if(c!==null)for(var f=0;f<c.length;f++){var p=c[f];Rn=p,aR(p,l)}sR(l)}if(l.subtreeFlags&10256)for(l=l.child;l!==null;)oR(l),l=l.sibling}function oR(l){switch(l.tag){case 0:case 11:case 15:Rf(l),l.flags&2048&&Vo(9,l,l.return);break;case 3:Rf(l);break;case 12:Rf(l);break;case 22:var c=l.stateNode;l.memoizedState!==null&&c._visibility&2&&(l.return===null||l.return.tag!==13)?(c._visibility&=-3,Pg(l)):Rf(l);break;default:Rf(l)}}function Pg(l){var c=l.deletions;if((l.flags&16)!==0){if(c!==null)for(var f=0;f<c.length;f++){var p=c[f];Rn=p,aR(p,l)}sR(l)}for(l=l.child;l!==null;){switch(c=l,c.tag){case 0:case 11:case 15:Vo(8,c,c.return),Pg(c);break;case 22:f=c.stateNode,f._visibility&2&&(f._visibility&=-3,Pg(c));break;default:Pg(c)}l=l.sibling}}function aR(l,c){for(;Rn!==null;){var f=Rn;switch(f.tag){case 0:case 11:case 15:Vo(8,f,c);break;case 23:case 22:if(f.memoizedState!==null&&f.memoizedState.cachePool!==null){var p=f.memoizedState.cachePool.pool;p!=null&&p.refCount++}break;case 24:cf(f.memoizedState.cache)}if(p=f.child,p!==null)p.return=f,Rn=p;else e:for(f=l;Rn!==null;){p=Rn;var _=p.sibling,b=p.return;if(Q2(p),p===f){Rn=null;break e}if(_!==null){_.return=b,Rn=_;break e}Rn=b}}}var w5={getCacheForType:function(l){var c=qn(gn),f=c.data.get(l);return f===void 0&&(f=l(),c.data.set(l,f)),f}},x5=typeof WeakMap=="function"?WeakMap:Map,_t=0,Mt=null,et=null,ut=0,vt=0,Ir=null,zo=!1,Wc=!1,Lb=!1,Vs=0,Wt=0,jo=0,xl=0,Ub=0,Kr=0,qc=0,Cf=null,yr=null,Vb=!1,Fb=0,Mg=1/0,Og=null,Ho=null,Dn=0,$o=null,Xc=null,Yc=0,Bb=0,zb=null,lR=null,If=0,jb=null;function Pr(){if((_t&2)!==0&&ut!==0)return ut&-ut;if(O.T!==null){var l=Dc;return l!==0?l:Kb()}return bs()}function cR(){Kr===0&&(Kr=(ut&536870912)===0||dt?Vh():536870912);var l=Yr.current;return l!==null&&(l.flags|=32),Kr}function Mr(l,c,f){(l===Mt&&(vt===2||vt===9)||l.cancelPendingCommit!==null)&&(Kc(l,0),Wo(l,ut,Kr,!1)),Kt(l,f),((_t&2)===0||l!==Mt)&&(l===Mt&&((_t&2)===0&&(xl|=f),Wt===4&&Wo(l,ut,Kr,!1)),qi(l))}function uR(l,c,f){if((_t&6)!==0)throw Error(r(327));var p=!f&&(c&124)===0&&(c&l.expiredLanes)===0||yo(l,c),_=p?S5(l,c):Wb(l,c,!0),b=p;do{if(_===0){Wc&&!p&&Wo(l,c,0,!1);break}else{if(f=l.current.alternate,b&&!E5(f)){_=Wb(l,c,!1),b=!1;continue}if(_===2){if(b=c,l.errorRecoveryDisabledLanes&b)var C=0;else C=l.pendingLanes&-536870913,C=C!==0?C:C&536870912?536870912:0;if(C!==0){c=C;e:{var D=l;_=Cf;var G=D.current.memoizedState.isDehydrated;if(G&&(Kc(D,C).flags|=256),C=Wb(D,C,!1),C!==2){if(Lb&&!G){D.errorRecoveryDisabledLanes|=b,xl|=b,_=4;break e}b=yr,yr=_,b!==null&&(yr===null?yr=b:yr.push.apply(yr,b))}_=C}if(b=!1,_!==2)continue}}if(_===1){Kc(l,0),Wo(l,c,0,!0);break}e:{switch(p=l,b=_,b){case 0:case 1:throw Error(r(345));case 4:if((c&4194048)!==c)break;case 6:Wo(p,c,Kr,!zo);break e;case 2:yr=null;break;case 3:case 5:break;default:throw Error(r(329))}if((c&62914560)===c&&(_=Fb+300-pr(),10<_)){if(Wo(p,c,Kr,!zo),Br(p,0,!0)!==0)break e;p.timeoutHandle=FR(hR.bind(null,p,f,yr,Og,Vb,c,Kr,xl,qc,zo,b,2,-0,0),_);break e}hR(p,f,yr,Og,Vb,c,Kr,xl,qc,zo,b,0,-0,0)}}break}while(!0);qi(l)}function hR(l,c,f,p,_,b,C,D,G,ue,ge,ve,he,fe){if(l.timeoutHandle=-1,ve=c.subtreeFlags,(ve&8192||(ve&16785408)===16785408)&&(Lf={stylesheets:null,count:0,unsuspend:s8},iR(c),ve=a8(),ve!==null)){l.cancelPendingCommit=ve(_R.bind(null,l,c,b,f,p,_,C,D,G,ge,1,he,fe)),Wo(l,b,C,!ue);return}_R(l,c,b,f,p,_,C,D,G)}function E5(l){for(var c=l;;){var f=c.tag;if((f===0||f===11||f===15)&&c.flags&16384&&(f=c.updateQueue,f!==null&&(f=f.stores,f!==null)))for(var p=0;p<f.length;p++){var _=f[p],b=_.getSnapshot;_=_.value;try{if(!Ar(b(),_))return!1}catch{return!1}}if(f=c.child,c.subtreeFlags&16384&&f!==null)f.return=c,c=f;else{if(c===l)break;for(;c.sibling===null;){if(c.return===null||c.return===l)return!0;c=c.return}c.sibling.return=c.return,c=c.sibling}}return!0}function Wo(l,c,f,p){c&=~Ub,c&=~xl,l.suspendedLanes|=c,l.pingedLanes&=~c,p&&(l.warmLanes|=c),p=l.expirationTimes;for(var _=c;0<_;){var b=31-or(_),C=1<<b;p[b]=-1,_&=~C}f!==0&&vo(l,f,c)}function kg(){return(_t&6)===0?(Pf(0),!1):!0}function Hb(){if(et!==null){if(vt===0)var l=et.return;else l=et,Ps=yl=null,ob(l),zc=null,bf=0,l=et;for(;l!==null;)$2(l.alternate,l),l=l.return;et=null}}function Kc(l,c){var f=l.timeoutHandle;f!==-1&&(l.timeoutHandle=-1,j5(f)),f=l.cancelPendingCommit,f!==null&&(l.cancelPendingCommit=null,f()),Hb(),Mt=l,et=f=Rs(l.current,null),ut=c,vt=0,Ir=null,zo=!1,Wc=yo(l,c),Lb=!1,qc=Kr=Ub=xl=jo=Wt=0,yr=Cf=null,Vb=!1,(c&8)!==0&&(c|=c&32);var p=l.entangledLanes;if(p!==0)for(l=l.entanglements,p&=c;0<p;){var _=31-or(p),b=1<<_;c|=l[_],p&=~b}return Vs=c,tg(),f}function fR(l,c){Ze=null,O.H=bg,c===hf||c===ug?(c=IS(),vt=3):c===SS?(c=IS(),vt=4):vt=c===P2?8:c!==null&&typeof c=="object"&&typeof c.then=="function"?6:1,Ir=c,et===null&&(Wt=1,Ag(l,$r(c,l.current)))}function dR(){var l=O.H;return O.H=bg,l===null?bg:l}function pR(){var l=O.A;return O.A=w5,l}function $b(){Wt=4,zo||(ut&4194048)!==ut&&Yr.current!==null||(Wc=!0),(jo&134217727)===0&&(xl&134217727)===0||Mt===null||Wo(Mt,ut,Kr,!1)}function Wb(l,c,f){var p=_t;_t|=2;var _=dR(),b=pR();(Mt!==l||ut!==c)&&(Og=null,Kc(l,c)),c=!1;var C=Wt;e:do try{if(vt!==0&&et!==null){var D=et,G=Ir;switch(vt){case 8:Hb(),C=6;break e;case 3:case 2:case 9:case 6:Yr.current===null&&(c=!0);var ue=vt;if(vt=0,Ir=null,Gc(l,D,G,ue),f&&Wc){C=0;break e}break;default:ue=vt,vt=0,Ir=null,Gc(l,D,G,ue)}}A5(),C=Wt;break}catch(ge){fR(l,ge)}while(!0);return c&&l.shellSuspendCounter++,Ps=yl=null,_t=p,O.H=_,O.A=b,et===null&&(Mt=null,ut=0,tg()),C}function A5(){for(;et!==null;)gR(et)}function S5(l,c){var f=_t;_t|=2;var p=dR(),_=pR();Mt!==l||ut!==c?(Og=null,Mg=pr()+500,Kc(l,c)):Wc=yo(l,c);e:do try{if(vt!==0&&et!==null){c=et;var b=Ir;t:switch(vt){case 1:vt=0,Ir=null,Gc(l,c,b,1);break;case 2:case 9:if(RS(b)){vt=0,Ir=null,mR(c);break}c=function(){vt!==2&&vt!==9||Mt!==l||(vt=7),qi(l)},b.then(c,c);break e;case 3:vt=7;break e;case 4:vt=5;break e;case 7:RS(b)?(vt=0,Ir=null,mR(c)):(vt=0,Ir=null,Gc(l,c,b,7));break;case 5:var C=null;switch(et.tag){case 26:C=et.memoizedState;case 5:case 27:var D=et;if(!C||ZR(C)){vt=0,Ir=null;var G=D.sibling;if(G!==null)et=G;else{var ue=D.return;ue!==null?(et=ue,Ng(ue)):et=null}break t}}vt=0,Ir=null,Gc(l,c,b,5);break;case 6:vt=0,Ir=null,Gc(l,c,b,6);break;case 8:Hb(),Wt=6;break e;default:throw Error(r(462))}}R5();break}catch(ge){fR(l,ge)}while(!0);return Ps=yl=null,O.H=p,O.A=_,_t=f,et!==null?0:(Mt=null,ut=0,tg(),Wt)}function R5(){for(;et!==null&&!ct();)gR(et)}function gR(l){var c=j2(l.alternate,l,Vs);l.memoizedProps=l.pendingProps,c===null?Ng(l):et=c}function mR(l){var c=l,f=c.alternate;switch(c.tag){case 15:case 0:c=L2(f,c,c.pendingProps,c.type,void 0,ut);break;case 11:c=L2(f,c,c.pendingProps,c.type.render,c.ref,ut);break;case 5:ob(c);default:$2(f,c),c=et=yS(c,Vs),c=j2(f,c,Vs)}l.memoizedProps=l.pendingProps,c===null?Ng(l):et=c}function Gc(l,c,f,p){Ps=yl=null,ob(c),zc=null,bf=0;var _=c.return;try{if(m5(l,_,c,f,ut)){Wt=1,Ag(l,$r(f,l.current)),et=null;return}}catch(b){if(_!==null)throw et=_,b;Wt=1,Ag(l,$r(f,l.current)),et=null;return}c.flags&32768?(dt||p===1?l=!0:Wc||(ut&536870912)!==0?l=!1:(zo=l=!0,(p===2||p===9||p===3||p===6)&&(p=Yr.current,p!==null&&p.tag===13&&(p.flags|=16384))),yR(c,l)):Ng(c)}function Ng(l){var c=l;do{if((c.flags&32768)!==0){yR(c,zo);return}l=c.return;var f=_5(c.alternate,c,Vs);if(f!==null){et=f;return}if(c=c.sibling,c!==null){et=c;return}et=c=l}while(c!==null);Wt===0&&(Wt=5)}function yR(l,c){do{var f=v5(l.alternate,l);if(f!==null){f.flags&=32767,et=f;return}if(f=l.return,f!==null&&(f.flags|=32768,f.subtreeFlags=0,f.deletions=null),!c&&(l=l.sibling,l!==null)){et=l;return}et=l=f}while(l!==null);Wt=6,et=null}function _R(l,c,f,p,_,b,C,D,G){l.cancelPendingCommit=null;do Dg();while(Dn!==0);if((_t&6)!==0)throw Error(r(327));if(c!==null){if(c===l.current)throw Error(r(177));if(b=c.lanes|c.childLanes,b|=Dv,Vp(l,f,b,C,D,G),l===Mt&&(et=Mt=null,ut=0),Xc=c,$o=l,Yc=f,Bb=b,zb=_,lR=p,(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?(l.callbackNode=null,l.callbackPriority=0,M5(vs,function(){return xR(),null})):(l.callbackNode=null,l.callbackPriority=0),p=(c.flags&13878)!==0,(c.subtreeFlags&13878)!==0||p){p=O.T,O.T=null,_=W.p,W.p=2,C=_t,_t|=4;try{b5(l,c,f)}finally{_t=C,W.p=_,O.T=p}}Dn=1,vR(),bR(),TR()}}function vR(){if(Dn===1){Dn=0;var l=$o,c=Xc,f=(c.flags&13878)!==0;if((c.subtreeFlags&13878)!==0||f){f=O.T,O.T=null;var p=W.p;W.p=2;var _=_t;_t|=4;try{tR(c,l);var b=r0,C=aS(l.containerInfo),D=b.focusedElem,G=b.selectionRange;if(C!==D&&D&&D.ownerDocument&&oS(D.ownerDocument.documentElement,D)){if(G!==null&&Pv(D)){var ue=G.start,ge=G.end;if(ge===void 0&&(ge=ue),"selectionStart"in D)D.selectionStart=ue,D.selectionEnd=Math.min(ge,D.value.length);else{var ve=D.ownerDocument||document,he=ve&&ve.defaultView||window;if(he.getSelection){var fe=he.getSelection(),He=D.textContent.length,Ve=Math.min(G.start,He),Et=G.end===void 0?Ve:Math.min(G.end,He);!fe.extend&&Ve>Et&&(C=Et,Et=Ve,Ve=C);var ne=sS(D,Ve),Q=sS(D,Et);if(ne&&Q&&(fe.rangeCount!==1||fe.anchorNode!==ne.node||fe.anchorOffset!==ne.offset||fe.focusNode!==Q.node||fe.focusOffset!==Q.offset)){var le=ve.createRange();le.setStart(ne.node,ne.offset),fe.removeAllRanges(),Ve>Et?(fe.addRange(le),fe.extend(Q.node,Q.offset)):(le.setEnd(Q.node,Q.offset),fe.addRange(le))}}}}for(ve=[],fe=D;fe=fe.parentNode;)fe.nodeType===1&&ve.push({element:fe,left:fe.scrollLeft,top:fe.scrollTop});for(typeof D.focus=="function"&&D.focus(),D=0;D<ve.length;D++){var ye=ve[D];ye.element.scrollLeft=ye.left,ye.element.scrollTop=ye.top}}Xg=!!n0,r0=n0=null}finally{_t=_,W.p=p,O.T=f}}l.current=c,Dn=2}}function bR(){if(Dn===2){Dn=0;var l=$o,c=Xc,f=(c.flags&8772)!==0;if((c.subtreeFlags&8772)!==0||f){f=O.T,O.T=null;var p=W.p;W.p=2;var _=_t;_t|=4;try{Z2(l,c.alternate,c)}finally{_t=_,W.p=p,O.T=f}}Dn=3}}function TR(){if(Dn===4||Dn===3){Dn=0,nt();var l=$o,c=Xc,f=Yc,p=lR;(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?Dn=5:(Dn=0,Xc=$o=null,wR(l,l.pendingLanes));var _=l.pendingLanes;if(_===0&&(Ho=null),Bh(f),c=c.stateNode,$n&&typeof $n.onCommitFiberRoot=="function")try{$n.onCommitFiberRoot(go,c,void 0,(c.current.flags&128)===128)}catch{}if(p!==null){c=O.T,_=W.p,W.p=2,O.T=null;try{for(var b=l.onRecoverableError,C=0;C<p.length;C++){var D=p[C];b(D.value,{componentStack:D.stack})}}finally{O.T=c,W.p=_}}(Yc&3)!==0&&Dg(),qi(l),_=l.pendingLanes,(f&4194090)!==0&&(_&42)!==0?l===jb?If++:(If=0,jb=l):If=0,Pf(0)}}function wR(l,c){(l.pooledCacheLanes&=c)===0&&(c=l.pooledCache,c!=null&&(l.pooledCache=null,cf(c)))}function Dg(l){return vR(),bR(),TR(),xR()}function xR(){if(Dn!==5)return!1;var l=$o,c=Bb;Bb=0;var f=Bh(Yc),p=O.T,_=W.p;try{W.p=32>f?32:f,O.T=null,f=zb,zb=null;var b=$o,C=Yc;if(Dn=0,Xc=$o=null,Yc=0,(_t&6)!==0)throw Error(r(331));var D=_t;if(_t|=4,oR(b.current),rR(b,b.current,C,f),_t=D,Pf(0,!1),$n&&typeof $n.onPostCommitFiberRoot=="function")try{$n.onPostCommitFiberRoot(go,b)}catch{}return!0}finally{W.p=_,O.T=p,wR(l,c)}}function ER(l,c,f){c=$r(f,c),c=bb(l.stateNode,c,2),l=No(l,c,2),l!==null&&(Kt(l,2),qi(l))}function Ct(l,c,f){if(l.tag===3)ER(l,l,f);else for(;c!==null;){if(c.tag===3){ER(c,l,f);break}else if(c.tag===1){var p=c.stateNode;if(typeof c.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(Ho===null||!Ho.has(p))){l=$r(f,l),f=C2(2),p=No(c,f,2),p!==null&&(I2(f,p,c,l),Kt(p,2),qi(p));break}}c=c.return}}function qb(l,c,f){var p=l.pingCache;if(p===null){p=l.pingCache=new x5;var _=new Set;p.set(c,_)}else _=p.get(c),_===void 0&&(_=new Set,p.set(c,_));_.has(f)||(Lb=!0,_.add(f),l=C5.bind(null,l,c,f),c.then(l,l))}function C5(l,c,f){var p=l.pingCache;p!==null&&p.delete(c),l.pingedLanes|=l.suspendedLanes&f,l.warmLanes&=~f,Mt===l&&(ut&f)===f&&(Wt===4||Wt===3&&(ut&62914560)===ut&&300>pr()-Fb?(_t&2)===0&&Kc(l,0):Ub|=f,qc===ut&&(qc=0)),qi(l)}function AR(l,c){c===0&&(c=_o()),l=Mc(l,c),l!==null&&(Kt(l,c),qi(l))}function I5(l){var c=l.memoizedState,f=0;c!==null&&(f=c.retryLane),AR(l,f)}function P5(l,c){var f=0;switch(l.tag){case 13:var p=l.stateNode,_=l.memoizedState;_!==null&&(f=_.retryLane);break;case 19:p=l.stateNode;break;case 22:p=l.stateNode._retryCache;break;default:throw Error(r(314))}p!==null&&p.delete(c),AR(l,f)}function M5(l,c){return sr(l,c)}var Lg=null,Zc=null,Xb=!1,Ug=!1,Yb=!1,El=0;function qi(l){l!==Zc&&l.next===null&&(Zc===null?Lg=Zc=l:Zc=Zc.next=l),Ug=!0,Xb||(Xb=!0,k5())}function Pf(l,c){if(!Yb&&Ug){Yb=!0;do for(var f=!1,p=Lg;p!==null;){if(l!==0){var _=p.pendingLanes;if(_===0)var b=0;else{var C=p.suspendedLanes,D=p.pingedLanes;b=(1<<31-or(42|l)+1)-1,b&=_&~(C&~D),b=b&201326741?b&201326741|1:b?b|2:0}b!==0&&(f=!0,IR(p,b))}else b=ut,b=Br(p,p===Mt?b:0,p.cancelPendingCommit!==null||p.timeoutHandle!==-1),(b&3)===0||yo(p,b)||(f=!0,IR(p,b));p=p.next}while(f);Yb=!1}}function O5(){SR()}function SR(){Ug=Xb=!1;var l=0;El!==0&&(z5()&&(l=El),El=0);for(var c=pr(),f=null,p=Lg;p!==null;){var _=p.next,b=RR(p,c);b===0?(p.next=null,f===null?Lg=_:f.next=_,_===null&&(Zc=f)):(f=p,(l!==0||(b&3)!==0)&&(Ug=!0)),p=_}Pf(l)}function RR(l,c){for(var f=l.suspendedLanes,p=l.pingedLanes,_=l.expirationTimes,b=l.pendingLanes&-62914561;0<b;){var C=31-or(b),D=1<<C,G=_[C];G===-1?((D&f)===0||(D&p)!==0)&&(_[C]=pc(D,c)):G<=c&&(l.expiredLanes|=D),b&=~D}if(c=Mt,f=ut,f=Br(l,l===c?f:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),p=l.callbackNode,f===0||l===c&&(vt===2||vt===9)||l.cancelPendingCommit!==null)return p!==null&&p!==null&&_s(p),l.callbackNode=null,l.callbackPriority=0;if((f&3)===0||yo(l,f)){if(c=f&-f,c===l.callbackPriority)return c;switch(p!==null&&_s(p),Bh(f)){case 2:case 8:f=En;break;case 32:f=vs;break;case 268435456:f=Uh;break;default:f=vs}return p=CR.bind(null,l),f=sr(f,p),l.callbackPriority=c,l.callbackNode=f,c}return p!==null&&p!==null&&_s(p),l.callbackPriority=2,l.callbackNode=null,2}function CR(l,c){if(Dn!==0&&Dn!==5)return l.callbackNode=null,l.callbackPriority=0,null;var f=l.callbackNode;if(Dg()&&l.callbackNode!==f)return null;var p=ut;return p=Br(l,l===Mt?p:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),p===0?null:(uR(l,p,c),RR(l,pr()),l.callbackNode!=null&&l.callbackNode===f?CR.bind(null,l):null)}function IR(l,c){if(Dg())return null;uR(l,c,!0)}function k5(){H5(function(){(_t&6)!==0?sr(dn,O5):SR()})}function Kb(){return El===0&&(El=Vh()),El}function PR(l){return l==null||typeof l=="symbol"||typeof l=="boolean"?null:typeof l=="function"?l:fi(""+l)}function MR(l,c){var f=c.ownerDocument.createElement("input");return f.name=c.name,f.value=c.value,l.id&&f.setAttribute("form",l.id),c.parentNode.insertBefore(f,c),l=new FormData(l),f.parentNode.removeChild(f),l}function N5(l,c,f,p,_){if(c==="submit"&&f&&f.stateNode===_){var b=PR((_[kn]||null).action),C=p.submitter;C&&(c=(c=C[kn]||null)?PR(c.formAction):C.getAttribute("formAction"),c!==null&&(b=c,C=null));var D=new rl("action","action",null,p,_);l.push({event:D,listeners:[{instance:null,listener:function(){if(p.defaultPrevented){if(El!==0){var G=C?MR(_,C):new FormData(_);gb(f,{pending:!0,data:G,method:_.method,action:b},null,G)}}else typeof b=="function"&&(D.preventDefault(),G=C?MR(_,C):new FormData(_),gb(f,{pending:!0,data:G,method:_.method,action:b},b,G))},currentTarget:_}]})}}for(var Gb=0;Gb<Nv.length;Gb++){var Zb=Nv[Gb],D5=Zb.toLowerCase(),L5=Zb[0].toUpperCase()+Zb.slice(1);mi(D5,"on"+L5)}mi(uS,"onAnimationEnd"),mi(hS,"onAnimationIteration"),mi(fS,"onAnimationStart"),mi("dblclick","onDoubleClick"),mi("focusin","onFocus"),mi("focusout","onBlur"),mi(JB,"onTransitionRun"),mi(e5,"onTransitionStart"),mi(t5,"onTransitionCancel"),mi(dS,"onTransitionEnd"),Vi("onMouseEnter",["mouseout","mouseover"]),Vi("onMouseLeave",["mouseout","mouseover"]),Vi("onPointerEnter",["pointerout","pointerover"]),Vi("onPointerLeave",["pointerout","pointerover"]),Ui("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ui("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ui("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ui("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ui("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ui("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Mf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),U5=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Mf));function OR(l,c){c=(c&4)!==0;for(var f=0;f<l.length;f++){var p=l[f],_=p.event;p=p.listeners;e:{var b=void 0;if(c)for(var C=p.length-1;0<=C;C--){var D=p[C],G=D.instance,ue=D.currentTarget;if(D=D.listener,G!==b&&_.isPropagationStopped())break e;b=D,_.currentTarget=ue;try{b(_)}catch(ge){Eg(ge)}_.currentTarget=null,b=G}else for(C=0;C<p.length;C++){if(D=p[C],G=D.instance,ue=D.currentTarget,D=D.listener,G!==b&&_.isPropagationStopped())break e;b=D,_.currentTarget=ue;try{b(_)}catch(ge){Eg(ge)}_.currentTarget=null,b=G}}}}function tt(l,c){var f=c[$a];f===void 0&&(f=c[$a]=new Set);var p=l+"__bubble";f.has(p)||(kR(c,l,2,!1),f.add(p))}function Qb(l,c,f){var p=0;c&&(p|=4),kR(f,l,p,c)}var Vg="_reactListening"+Math.random().toString(36).slice(2);function Jb(l){if(!l[Vg]){l[Vg]=!0,Fp.forEach(function(f){f!=="selectionchange"&&(U5.has(f)||Qb(f,!1,l),Qb(f,!0,l))});var c=l.nodeType===9?l:l.ownerDocument;c===null||c[Vg]||(c[Vg]=!0,Qb("selectionchange",!1,c))}}function kR(l,c,f,p){switch(rC(c)){case 2:var _=u8;break;case 8:_=h8;break;default:_=d0}f=_.bind(null,c,f,l),_=void 0,!As||c!=="touchstart"&&c!=="touchmove"&&c!=="wheel"||(_=!0),p?_!==void 0?l.addEventListener(c,f,{capture:!0,passive:_}):l.addEventListener(c,f,!0):_!==void 0?l.addEventListener(c,f,{passive:_}):l.addEventListener(c,f,!1)}function e0(l,c,f,p,_){var b=p;if((c&1)===0&&(c&2)===0&&p!==null)e:for(;;){if(p===null)return;var C=p.tag;if(C===3||C===4){var D=p.stateNode.containerInfo;if(D===_)break;if(C===4)for(C=p.return;C!==null;){var G=C.tag;if((G===3||G===4)&&C.stateNode.containerInfo===_)return;C=C.return}for(;D!==null;){if(C=Di(D),C===null)return;if(G=C.tag,G===5||G===6||G===26||G===27){p=b=C;continue e}D=D.parentNode}}p=p.return}el(function(){var ue=b,ge=Xh(f),ve=[];e:{var he=pS.get(l);if(he!==void 0){var fe=rl,He=l;switch(l){case"keypress":if(tl(f)===0)break e;case"keydown":case"keyup":fe=Rc;break;case"focusin":He="focus",fe=Ec;break;case"focusout":He="blur",fe=Ec;break;case"beforeblur":case"afterblur":fe=Ec;break;case"click":if(f.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":fe=ll;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":fe=qp;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":fe=Po;break;case uS:case hS:case fS:fe=Kh;break;case dS:fe=x;break;case"scroll":case"scrollend":fe=sl;break;case"wheel":fe=B;break;case"copy":case"cut":case"paste":fe=Yp;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":fe=Qh;break;case"toggle":case"beforetoggle":fe=pe}var Ve=(c&4)!==0,Et=!Ve&&(l==="scroll"||l==="scrollend"),ne=Ve?he!==null?he+"Capture":null:he;Ve=[];for(var Q=ue,le;Q!==null;){var ye=Q;if(le=ye.stateNode,ye=ye.tag,ye!==5&&ye!==26&&ye!==27||le===null||ne===null||(ye=Co(Q,ne),ye!=null&&Ve.push(Of(Q,ye,le))),Et)break;Q=Q.return}0<Ve.length&&(he=new fe(he,He,null,f,ge),ve.push({event:he,listeners:Ve}))}}if((c&7)===0){e:{if(he=l==="mouseover"||l==="pointerover",fe=l==="mouseout"||l==="pointerout",he&&f!==qh&&(He=f.relatedTarget||f.fromElement)&&(Di(He)||He[Ts]))break e;if((fe||he)&&(he=ge.window===ge?ge:(he=ge.ownerDocument)?he.defaultView||he.parentWindow:window,fe?(He=f.relatedTarget||f.toElement,fe=ue,He=He?Di(He):null,He!==null&&(Et=s(He),Ve=He.tag,He!==Et||Ve!==5&&Ve!==27&&Ve!==6)&&(He=null)):(fe=null,He=ue),fe!==He)){if(Ve=ll,ye="onMouseLeave",ne="onMouseEnter",Q="mouse",(l==="pointerout"||l==="pointerover")&&(Ve=Qh,ye="onPointerLeave",ne="onPointerEnter",Q="pointer"),Et=fe==null?he:wo(fe),le=He==null?he:wo(He),he=new Ve(ye,Q+"leave",fe,f,ge),he.target=Et,he.relatedTarget=le,ye=null,Di(ge)===ue&&(Ve=new Ve(ne,Q+"enter",He,f,ge),Ve.target=le,Ve.relatedTarget=Et,ye=Ve),Et=ye,fe&&He)t:{for(Ve=fe,ne=He,Q=0,le=Ve;le;le=Qc(le))Q++;for(le=0,ye=ne;ye;ye=Qc(ye))le++;for(;0<Q-le;)Ve=Qc(Ve),Q--;for(;0<le-Q;)ne=Qc(ne),le--;for(;Q--;){if(Ve===ne||ne!==null&&Ve===ne.alternate)break t;Ve=Qc(Ve),ne=Qc(ne)}Ve=null}else Ve=null;fe!==null&&NR(ve,he,fe,Ve,!1),He!==null&&Et!==null&&NR(ve,Et,He,Ve,!0)}}e:{if(he=ue?wo(ue):window,fe=he.nodeName&&he.nodeName.toLowerCase(),fe==="select"||fe==="input"&&he.type==="file")var Oe=JA;else if(ZA(he))if(eS)Oe=GB;else{Oe=YB;var Je=XB}else fe=he.nodeName,!fe||fe.toLowerCase()!=="input"||he.type!=="checkbox"&&he.type!=="radio"?ue&&Tc(ue.elementType)&&(Oe=JA):Oe=KB;if(Oe&&(Oe=Oe(l,ue))){QA(ve,Oe,f,ge);break e}Je&&Je(l,he,ue),l==="focusout"&&ue&&he.type==="number"&&ue.memoizedProps.value!=null&&Hh(he,"number",he.value)}switch(Je=ue?wo(ue):window,l){case"focusin":(ZA(Je)||Je.contentEditable==="true")&&(Cc=Je,Mv=ue,rf=null);break;case"focusout":rf=Mv=Cc=null;break;case"mousedown":Ov=!0;break;case"contextmenu":case"mouseup":case"dragend":Ov=!1,lS(ve,f,ge);break;case"selectionchange":if(QB)break;case"keydown":case"keyup":lS(ve,f,ge)}var De;if(qe)e:{switch(l){case"compositionstart":var Fe="onCompositionStart";break e;case"compositionend":Fe="onCompositionEnd";break e;case"compositionupdate":Fe="onCompositionUpdate";break e}Fe=void 0}else gi?di(l,f)&&(Fe="onCompositionEnd"):l==="keydown"&&f.keyCode===229&&(Fe="onCompositionStart");Fe&&(Qt&&f.locale!=="ko"&&(gi||Fe!=="onCompositionStart"?Fe==="onCompositionEnd"&&gi&&(De=Wp()):(Hr=ge,Pt="value"in Hr?Hr.value:Hr.textContent,gi=!0)),Je=Fg(ue,Fe),0<Je.length&&(Fe=new Zh(Fe,l,null,f,ge),ve.push({event:Fe,listeners:Je}),De?Fe.data=De:(De=pi(f),De!==null&&(Fe.data=De)))),(De=yt?Jh(l,f):$B(l,f))&&(Fe=Fg(ue,"onBeforeInput"),0<Fe.length&&(Je=new Zh("onBeforeInput","beforeinput",null,f,ge),ve.push({event:Je,listeners:Fe}),Je.data=De)),N5(ve,l,ue,f,ge)}OR(ve,c)})}function Of(l,c,f){return{instance:l,listener:c,currentTarget:f}}function Fg(l,c){for(var f=c+"Capture",p=[];l!==null;){var _=l,b=_.stateNode;if(_=_.tag,_!==5&&_!==26&&_!==27||b===null||(_=Co(l,f),_!=null&&p.unshift(Of(l,_,b)),_=Co(l,c),_!=null&&p.push(Of(l,_,b))),l.tag===3)return p;l=l.return}return[]}function Qc(l){if(l===null)return null;do l=l.return;while(l&&l.tag!==5&&l.tag!==27);return l||null}function NR(l,c,f,p,_){for(var b=c._reactName,C=[];f!==null&&f!==p;){var D=f,G=D.alternate,ue=D.stateNode;if(D=D.tag,G!==null&&G===p)break;D!==5&&D!==26&&D!==27||ue===null||(G=ue,_?(ue=Co(f,b),ue!=null&&C.unshift(Of(f,ue,G))):_||(ue=Co(f,b),ue!=null&&C.push(Of(f,ue,G)))),f=f.return}C.length!==0&&l.push({event:c,listeners:C})}var V5=/\r\n?/g,F5=/\u0000|\uFFFD/g;function DR(l){return(typeof l=="string"?l:""+l).replace(V5,`
`).replace(F5,"")}function LR(l,c){return c=DR(c),DR(l)===c}function Bg(){}function xt(l,c,f,p,_,b){switch(f){case"children":typeof p=="string"?c==="body"||c==="textarea"&&p===""||jr(l,p):(typeof p=="number"||typeof p=="bigint")&&c!=="body"&&jr(l,""+p);break;case"className":Ka(l,"class",p);break;case"tabIndex":Ka(l,"tabindex",p);break;case"dir":case"role":case"viewBox":case"width":case"height":Ka(l,f,p);break;case"style":Wh(l,p,b);break;case"data":if(c!=="object"){Ka(l,"data",p);break}case"src":case"href":if(p===""&&(c!=="a"||f!=="href")){l.removeAttribute(f);break}if(p==null||typeof p=="function"||typeof p=="symbol"||typeof p=="boolean"){l.removeAttribute(f);break}p=fi(""+p),l.setAttribute(f,p);break;case"action":case"formAction":if(typeof p=="function"){l.setAttribute(f,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof b=="function"&&(f==="formAction"?(c!=="input"&&xt(l,c,"name",_.name,_,null),xt(l,c,"formEncType",_.formEncType,_,null),xt(l,c,"formMethod",_.formMethod,_,null),xt(l,c,"formTarget",_.formTarget,_,null)):(xt(l,c,"encType",_.encType,_,null),xt(l,c,"method",_.method,_,null),xt(l,c,"target",_.target,_,null)));if(p==null||typeof p=="symbol"||typeof p=="boolean"){l.removeAttribute(f);break}p=fi(""+p),l.setAttribute(f,p);break;case"onClick":p!=null&&(l.onclick=Bg);break;case"onScroll":p!=null&&tt("scroll",l);break;case"onScrollEnd":p!=null&&tt("scrollend",l);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(r(61));if(f=p.__html,f!=null){if(_.children!=null)throw Error(r(60));l.innerHTML=f}}break;case"multiple":l.multiple=p&&typeof p!="function"&&typeof p!="symbol";break;case"muted":l.muted=p&&typeof p!="function"&&typeof p!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(p==null||typeof p=="function"||typeof p=="boolean"||typeof p=="symbol"){l.removeAttribute("xlink:href");break}f=fi(""+p),l.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",f);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":p!=null&&typeof p!="function"&&typeof p!="symbol"?l.setAttribute(f,""+p):l.removeAttribute(f);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":p&&typeof p!="function"&&typeof p!="symbol"?l.setAttribute(f,""):l.removeAttribute(f);break;case"capture":case"download":p===!0?l.setAttribute(f,""):p!==!1&&p!=null&&typeof p!="function"&&typeof p!="symbol"?l.setAttribute(f,p):l.removeAttribute(f);break;case"cols":case"rows":case"size":case"span":p!=null&&typeof p!="function"&&typeof p!="symbol"&&!isNaN(p)&&1<=p?l.setAttribute(f,p):l.removeAttribute(f);break;case"rowSpan":case"start":p==null||typeof p=="function"||typeof p=="symbol"||isNaN(p)?l.removeAttribute(f):l.setAttribute(f,p);break;case"popover":tt("beforetoggle",l),tt("toggle",l),Ya(l,"popover",p);break;case"xlinkActuate":zr(l,"http://www.w3.org/1999/xlink","xlink:actuate",p);break;case"xlinkArcrole":zr(l,"http://www.w3.org/1999/xlink","xlink:arcrole",p);break;case"xlinkRole":zr(l,"http://www.w3.org/1999/xlink","xlink:role",p);break;case"xlinkShow":zr(l,"http://www.w3.org/1999/xlink","xlink:show",p);break;case"xlinkTitle":zr(l,"http://www.w3.org/1999/xlink","xlink:title",p);break;case"xlinkType":zr(l,"http://www.w3.org/1999/xlink","xlink:type",p);break;case"xmlBase":zr(l,"http://www.w3.org/XML/1998/namespace","xml:base",p);break;case"xmlLang":zr(l,"http://www.w3.org/XML/1998/namespace","xml:lang",p);break;case"xmlSpace":zr(l,"http://www.w3.org/XML/1998/namespace","xml:space",p);break;case"is":Ya(l,"is",p);break;case"innerText":case"textContent":break;default:(!(2<f.length)||f[0]!=="o"&&f[0]!=="O"||f[1]!=="n"&&f[1]!=="N")&&(f=jp.get(f)||f,Ya(l,f,p))}}function t0(l,c,f,p,_,b){switch(f){case"style":Wh(l,p,b);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(r(61));if(f=p.__html,f!=null){if(_.children!=null)throw Error(r(60));l.innerHTML=f}}break;case"children":typeof p=="string"?jr(l,p):(typeof p=="number"||typeof p=="bigint")&&jr(l,""+p);break;case"onScroll":p!=null&&tt("scroll",l);break;case"onScrollEnd":p!=null&&tt("scrollend",l);break;case"onClick":p!=null&&(l.onclick=Bg);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!qa.hasOwnProperty(f))e:{if(f[0]==="o"&&f[1]==="n"&&(_=f.endsWith("Capture"),c=f.slice(2,_?f.length-7:void 0),b=l[kn]||null,b=b!=null?b[f]:null,typeof b=="function"&&l.removeEventListener(c,b,_),typeof p=="function")){typeof b!="function"&&b!==null&&(f in l?l[f]=null:l.hasAttribute(f)&&l.removeAttribute(f)),l.addEventListener(c,p,_);break e}f in l?l[f]=p:p===!0?l.setAttribute(f,""):Ya(l,f,p)}}}function Ln(l,c,f){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":tt("error",l),tt("load",l);var p=!1,_=!1,b;for(b in f)if(f.hasOwnProperty(b)){var C=f[b];if(C!=null)switch(b){case"src":p=!0;break;case"srcSet":_=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,c));default:xt(l,c,b,C,f,null)}}_&&xt(l,c,"srcSet",f.srcSet,f,null),p&&xt(l,c,"src",f.src,f,null);return;case"input":tt("invalid",l);var D=b=C=_=null,G=null,ue=null;for(p in f)if(f.hasOwnProperty(p)){var ge=f[p];if(ge!=null)switch(p){case"name":_=ge;break;case"type":C=ge;break;case"checked":G=ge;break;case"defaultChecked":ue=ge;break;case"value":b=ge;break;case"defaultValue":D=ge;break;case"children":case"dangerouslySetInnerHTML":if(ge!=null)throw Error(r(137,c));break;default:xt(l,c,p,ge,f,null)}}jh(l,b,D,G,ue,C,_,!1),Ao(l);return;case"select":tt("invalid",l),p=C=b=null;for(_ in f)if(f.hasOwnProperty(_)&&(D=f[_],D!=null))switch(_){case"value":b=D;break;case"defaultValue":C=D;break;case"multiple":p=D;default:xt(l,c,_,D,f,null)}c=b,f=C,l.multiple=!!p,c!=null?So(l,!!p,c,!1):f!=null&&So(l,!!p,f,!0);return;case"textarea":tt("invalid",l),b=_=p=null;for(C in f)if(f.hasOwnProperty(C)&&(D=f[C],D!=null))switch(C){case"value":p=D;break;case"defaultValue":_=D;break;case"children":b=D;break;case"dangerouslySetInnerHTML":if(D!=null)throw Error(r(91));break;default:xt(l,c,C,D,f,null)}zp(l,p,_,b),Ao(l);return;case"option":for(G in f)if(f.hasOwnProperty(G)&&(p=f[G],p!=null))switch(G){case"selected":l.selected=p&&typeof p!="function"&&typeof p!="symbol";break;default:xt(l,c,G,p,f,null)}return;case"dialog":tt("beforetoggle",l),tt("toggle",l),tt("cancel",l),tt("close",l);break;case"iframe":case"object":tt("load",l);break;case"video":case"audio":for(p=0;p<Mf.length;p++)tt(Mf[p],l);break;case"image":tt("error",l),tt("load",l);break;case"details":tt("toggle",l);break;case"embed":case"source":case"link":tt("error",l),tt("load",l);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ue in f)if(f.hasOwnProperty(ue)&&(p=f[ue],p!=null))switch(ue){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,c));default:xt(l,c,ue,p,f,null)}return;default:if(Tc(c)){for(ge in f)f.hasOwnProperty(ge)&&(p=f[ge],p!==void 0&&t0(l,c,ge,p,f,void 0));return}}for(D in f)f.hasOwnProperty(D)&&(p=f[D],p!=null&&xt(l,c,D,p,f,null))}function B5(l,c,f,p){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var _=null,b=null,C=null,D=null,G=null,ue=null,ge=null;for(fe in f){var ve=f[fe];if(f.hasOwnProperty(fe)&&ve!=null)switch(fe){case"checked":break;case"value":break;case"defaultValue":G=ve;default:p.hasOwnProperty(fe)||xt(l,c,fe,null,p,ve)}}for(var he in p){var fe=p[he];if(ve=f[he],p.hasOwnProperty(he)&&(fe!=null||ve!=null))switch(he){case"type":b=fe;break;case"name":_=fe;break;case"checked":ue=fe;break;case"defaultChecked":ge=fe;break;case"value":C=fe;break;case"defaultValue":D=fe;break;case"children":case"dangerouslySetInnerHTML":if(fe!=null)throw Error(r(137,c));break;default:fe!==ve&&xt(l,c,he,fe,p,ve)}}zh(l,C,D,G,ue,ge,b,_);return;case"select":fe=C=D=he=null;for(b in f)if(G=f[b],f.hasOwnProperty(b)&&G!=null)switch(b){case"value":break;case"multiple":fe=G;default:p.hasOwnProperty(b)||xt(l,c,b,null,p,G)}for(_ in p)if(b=p[_],G=f[_],p.hasOwnProperty(_)&&(b!=null||G!=null))switch(_){case"value":he=b;break;case"defaultValue":D=b;break;case"multiple":C=b;default:b!==G&&xt(l,c,_,b,p,G)}c=D,f=C,p=fe,he!=null?So(l,!!f,he,!1):!!p!=!!f&&(c!=null?So(l,!!f,c,!0):So(l,!!f,f?[]:"",!1));return;case"textarea":fe=he=null;for(D in f)if(_=f[D],f.hasOwnProperty(D)&&_!=null&&!p.hasOwnProperty(D))switch(D){case"value":break;case"children":break;default:xt(l,c,D,null,p,_)}for(C in p)if(_=p[C],b=f[C],p.hasOwnProperty(C)&&(_!=null||b!=null))switch(C){case"value":he=_;break;case"defaultValue":fe=_;break;case"children":break;case"dangerouslySetInnerHTML":if(_!=null)throw Error(r(91));break;default:_!==b&&xt(l,c,C,_,p,b)}Bp(l,he,fe);return;case"option":for(var He in f)if(he=f[He],f.hasOwnProperty(He)&&he!=null&&!p.hasOwnProperty(He))switch(He){case"selected":l.selected=!1;break;default:xt(l,c,He,null,p,he)}for(G in p)if(he=p[G],fe=f[G],p.hasOwnProperty(G)&&he!==fe&&(he!=null||fe!=null))switch(G){case"selected":l.selected=he&&typeof he!="function"&&typeof he!="symbol";break;default:xt(l,c,G,he,p,fe)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ve in f)he=f[Ve],f.hasOwnProperty(Ve)&&he!=null&&!p.hasOwnProperty(Ve)&&xt(l,c,Ve,null,p,he);for(ue in p)if(he=p[ue],fe=f[ue],p.hasOwnProperty(ue)&&he!==fe&&(he!=null||fe!=null))switch(ue){case"children":case"dangerouslySetInnerHTML":if(he!=null)throw Error(r(137,c));break;default:xt(l,c,ue,he,p,fe)}return;default:if(Tc(c)){for(var Et in f)he=f[Et],f.hasOwnProperty(Et)&&he!==void 0&&!p.hasOwnProperty(Et)&&t0(l,c,Et,void 0,p,he);for(ge in p)he=p[ge],fe=f[ge],!p.hasOwnProperty(ge)||he===fe||he===void 0&&fe===void 0||t0(l,c,ge,he,p,fe);return}}for(var ne in f)he=f[ne],f.hasOwnProperty(ne)&&he!=null&&!p.hasOwnProperty(ne)&&xt(l,c,ne,null,p,he);for(ve in p)he=p[ve],fe=f[ve],!p.hasOwnProperty(ve)||he===fe||he==null&&fe==null||xt(l,c,ve,he,p,fe)}var n0=null,r0=null;function zg(l){return l.nodeType===9?l:l.ownerDocument}function UR(l){switch(l){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function VR(l,c){if(l===0)switch(c){case"svg":return 1;case"math":return 2;default:return 0}return l===1&&c==="foreignObject"?0:l}function i0(l,c){return l==="textarea"||l==="noscript"||typeof c.children=="string"||typeof c.children=="number"||typeof c.children=="bigint"||typeof c.dangerouslySetInnerHTML=="object"&&c.dangerouslySetInnerHTML!==null&&c.dangerouslySetInnerHTML.__html!=null}var s0=null;function z5(){var l=window.event;return l&&l.type==="popstate"?l===s0?!1:(s0=l,!0):(s0=null,!1)}var FR=typeof setTimeout=="function"?setTimeout:void 0,j5=typeof clearTimeout=="function"?clearTimeout:void 0,BR=typeof Promise=="function"?Promise:void 0,H5=typeof queueMicrotask=="function"?queueMicrotask:typeof BR<"u"?function(l){return BR.resolve(null).then(l).catch($5)}:FR;function $5(l){setTimeout(function(){throw l})}function qo(l){return l==="head"}function zR(l,c){var f=c,p=0,_=0;do{var b=f.nextSibling;if(l.removeChild(f),b&&b.nodeType===8)if(f=b.data,f==="/$"){if(0<p&&8>p){f=p;var C=l.ownerDocument;if(f&1&&kf(C.documentElement),f&2&&kf(C.body),f&4)for(f=C.head,kf(f),C=f.firstChild;C;){var D=C.nextSibling,G=C.nodeName;C[To]||G==="SCRIPT"||G==="STYLE"||G==="LINK"&&C.rel.toLowerCase()==="stylesheet"||f.removeChild(C),C=D}}if(_===0){l.removeChild(b),zf(c);return}_--}else f==="$"||f==="$?"||f==="$!"?_++:p=f.charCodeAt(0)-48;else p=0;f=b}while(f);zf(c)}function o0(l){var c=l.firstChild;for(c&&c.nodeType===10&&(c=c.nextSibling);c;){var f=c;switch(c=c.nextSibling,f.nodeName){case"HTML":case"HEAD":case"BODY":o0(f),mc(f);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(f.rel.toLowerCase()==="stylesheet")continue}l.removeChild(f)}}function W5(l,c,f,p){for(;l.nodeType===1;){var _=f;if(l.nodeName.toLowerCase()!==c.toLowerCase()){if(!p&&(l.nodeName!=="INPUT"||l.type!=="hidden"))break}else if(p){if(!l[To])switch(c){case"meta":if(!l.hasAttribute("itemprop"))break;return l;case"link":if(b=l.getAttribute("rel"),b==="stylesheet"&&l.hasAttribute("data-precedence"))break;if(b!==_.rel||l.getAttribute("href")!==(_.href==null||_.href===""?null:_.href)||l.getAttribute("crossorigin")!==(_.crossOrigin==null?null:_.crossOrigin)||l.getAttribute("title")!==(_.title==null?null:_.title))break;return l;case"style":if(l.hasAttribute("data-precedence"))break;return l;case"script":if(b=l.getAttribute("src"),(b!==(_.src==null?null:_.src)||l.getAttribute("type")!==(_.type==null?null:_.type)||l.getAttribute("crossorigin")!==(_.crossOrigin==null?null:_.crossOrigin))&&b&&l.hasAttribute("async")&&!l.hasAttribute("itemprop"))break;return l;default:return l}}else if(c==="input"&&l.type==="hidden"){var b=_.name==null?null:""+_.name;if(_.type==="hidden"&&l.getAttribute("name")===b)return l}else return l;if(l=_i(l.nextSibling),l===null)break}return null}function q5(l,c,f){if(c==="")return null;for(;l.nodeType!==3;)if((l.nodeType!==1||l.nodeName!=="INPUT"||l.type!=="hidden")&&!f||(l=_i(l.nextSibling),l===null))return null;return l}function a0(l){return l.data==="$!"||l.data==="$?"&&l.ownerDocument.readyState==="complete"}function X5(l,c){var f=l.ownerDocument;if(l.data!=="$?"||f.readyState==="complete")c();else{var p=function(){c(),f.removeEventListener("DOMContentLoaded",p)};f.addEventListener("DOMContentLoaded",p),l._reactRetry=p}}function _i(l){for(;l!=null;l=l.nextSibling){var c=l.nodeType;if(c===1||c===3)break;if(c===8){if(c=l.data,c==="$"||c==="$!"||c==="$?"||c==="F!"||c==="F")break;if(c==="/$")return null}}return l}var l0=null;function jR(l){l=l.previousSibling;for(var c=0;l;){if(l.nodeType===8){var f=l.data;if(f==="$"||f==="$!"||f==="$?"){if(c===0)return l;c--}else f==="/$"&&c++}l=l.previousSibling}return null}function HR(l,c,f){switch(c=zg(f),l){case"html":if(l=c.documentElement,!l)throw Error(r(452));return l;case"head":if(l=c.head,!l)throw Error(r(453));return l;case"body":if(l=c.body,!l)throw Error(r(454));return l;default:throw Error(r(451))}}function kf(l){for(var c=l.attributes;c.length;)l.removeAttributeNode(c[0]);mc(l)}var Gr=new Map,$R=new Set;function jg(l){return typeof l.getRootNode=="function"?l.getRootNode():l.nodeType===9?l:l.ownerDocument}var Fs=W.d;W.d={f:Y5,r:K5,D:G5,C:Z5,L:Q5,m:J5,X:t8,S:e8,M:n8};function Y5(){var l=Fs.f(),c=kg();return l||c}function K5(l){var c=Li(l);c!==null&&c.tag===5&&c.type==="form"?u2(c):Fs.r(l)}var Jc=typeof document>"u"?null:document;function WR(l,c,f){var p=Jc;if(p&&typeof c=="string"&&c){var _=An(c);_='link[rel="'+l+'"][href="'+_+'"]',typeof f=="string"&&(_+='[crossorigin="'+f+'"]'),$R.has(_)||($R.add(_),l={rel:l,crossOrigin:f,href:c},p.querySelector(_)===null&&(c=p.createElement("link"),Ln(c,"link",l),Zt(c),p.head.appendChild(c)))}}function G5(l){Fs.D(l),WR("dns-prefetch",l,null)}function Z5(l,c){Fs.C(l,c),WR("preconnect",l,c)}function Q5(l,c,f){Fs.L(l,c,f);var p=Jc;if(p&&l&&c){var _='link[rel="preload"][as="'+An(c)+'"]';c==="image"&&f&&f.imageSrcSet?(_+='[imagesrcset="'+An(f.imageSrcSet)+'"]',typeof f.imageSizes=="string"&&(_+='[imagesizes="'+An(f.imageSizes)+'"]')):_+='[href="'+An(l)+'"]';var b=_;switch(c){case"style":b=eu(l);break;case"script":b=tu(l)}Gr.has(b)||(l=d({rel:"preload",href:c==="image"&&f&&f.imageSrcSet?void 0:l,as:c},f),Gr.set(b,l),p.querySelector(_)!==null||c==="style"&&p.querySelector(Nf(b))||c==="script"&&p.querySelector(Df(b))||(c=p.createElement("link"),Ln(c,"link",l),Zt(c),p.head.appendChild(c)))}}function J5(l,c){Fs.m(l,c);var f=Jc;if(f&&l){var p=c&&typeof c.as=="string"?c.as:"script",_='link[rel="modulepreload"][as="'+An(p)+'"][href="'+An(l)+'"]',b=_;switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":b=tu(l)}if(!Gr.has(b)&&(l=d({rel:"modulepreload",href:l},c),Gr.set(b,l),f.querySelector(_)===null)){switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(f.querySelector(Df(b)))return}p=f.createElement("link"),Ln(p,"link",l),Zt(p),f.head.appendChild(p)}}}function e8(l,c,f){Fs.S(l,c,f);var p=Jc;if(p&&l){var _=xo(p).hoistableStyles,b=eu(l);c=c||"default";var C=_.get(b);if(!C){var D={loading:0,preload:null};if(C=p.querySelector(Nf(b)))D.loading=5;else{l=d({rel:"stylesheet",href:l,"data-precedence":c},f),(f=Gr.get(b))&&c0(l,f);var G=C=p.createElement("link");Zt(G),Ln(G,"link",l),G._p=new Promise(function(ue,ge){G.onload=ue,G.onerror=ge}),G.addEventListener("load",function(){D.loading|=1}),G.addEventListener("error",function(){D.loading|=2}),D.loading|=4,Hg(C,c,p)}C={type:"stylesheet",instance:C,count:1,state:D},_.set(b,C)}}}function t8(l,c){Fs.X(l,c);var f=Jc;if(f&&l){var p=xo(f).hoistableScripts,_=tu(l),b=p.get(_);b||(b=f.querySelector(Df(_)),b||(l=d({src:l,async:!0},c),(c=Gr.get(_))&&u0(l,c),b=f.createElement("script"),Zt(b),Ln(b,"link",l),f.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},p.set(_,b))}}function n8(l,c){Fs.M(l,c);var f=Jc;if(f&&l){var p=xo(f).hoistableScripts,_=tu(l),b=p.get(_);b||(b=f.querySelector(Df(_)),b||(l=d({src:l,async:!0,type:"module"},c),(c=Gr.get(_))&&u0(l,c),b=f.createElement("script"),Zt(b),Ln(b,"link",l),f.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},p.set(_,b))}}function qR(l,c,f,p){var _=(_=Se.current)?jg(_):null;if(!_)throw Error(r(446));switch(l){case"meta":case"title":return null;case"style":return typeof f.precedence=="string"&&typeof f.href=="string"?(c=eu(f.href),f=xo(_).hoistableStyles,p=f.get(c),p||(p={type:"style",instance:null,count:0,state:null},f.set(c,p)),p):{type:"void",instance:null,count:0,state:null};case"link":if(f.rel==="stylesheet"&&typeof f.href=="string"&&typeof f.precedence=="string"){l=eu(f.href);var b=xo(_).hoistableStyles,C=b.get(l);if(C||(_=_.ownerDocument||_,C={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},b.set(l,C),(b=_.querySelector(Nf(l)))&&!b._p&&(C.instance=b,C.state.loading=5),Gr.has(l)||(f={rel:"preload",as:"style",href:f.href,crossOrigin:f.crossOrigin,integrity:f.integrity,media:f.media,hrefLang:f.hrefLang,referrerPolicy:f.referrerPolicy},Gr.set(l,f),b||r8(_,l,f,C.state))),c&&p===null)throw Error(r(528,""));return C}if(c&&p!==null)throw Error(r(529,""));return null;case"script":return c=f.async,f=f.src,typeof f=="string"&&c&&typeof c!="function"&&typeof c!="symbol"?(c=tu(f),f=xo(_).hoistableScripts,p=f.get(c),p||(p={type:"script",instance:null,count:0,state:null},f.set(c,p)),p):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,l))}}function eu(l){return'href="'+An(l)+'"'}function Nf(l){return'link[rel="stylesheet"]['+l+"]"}function XR(l){return d({},l,{"data-precedence":l.precedence,precedence:null})}function r8(l,c,f,p){l.querySelector('link[rel="preload"][as="style"]['+c+"]")?p.loading=1:(c=l.createElement("link"),p.preload=c,c.addEventListener("load",function(){return p.loading|=1}),c.addEventListener("error",function(){return p.loading|=2}),Ln(c,"link",f),Zt(c),l.head.appendChild(c))}function tu(l){return'[src="'+An(l)+'"]'}function Df(l){return"script[async]"+l}function YR(l,c,f){if(c.count++,c.instance===null)switch(c.type){case"style":var p=l.querySelector('style[data-href~="'+An(f.href)+'"]');if(p)return c.instance=p,Zt(p),p;var _=d({},f,{"data-href":f.href,"data-precedence":f.precedence,href:null,precedence:null});return p=(l.ownerDocument||l).createElement("style"),Zt(p),Ln(p,"style",_),Hg(p,f.precedence,l),c.instance=p;case"stylesheet":_=eu(f.href);var b=l.querySelector(Nf(_));if(b)return c.state.loading|=4,c.instance=b,Zt(b),b;p=XR(f),(_=Gr.get(_))&&c0(p,_),b=(l.ownerDocument||l).createElement("link"),Zt(b);var C=b;return C._p=new Promise(function(D,G){C.onload=D,C.onerror=G}),Ln(b,"link",p),c.state.loading|=4,Hg(b,f.precedence,l),c.instance=b;case"script":return b=tu(f.src),(_=l.querySelector(Df(b)))?(c.instance=_,Zt(_),_):(p=f,(_=Gr.get(b))&&(p=d({},f),u0(p,_)),l=l.ownerDocument||l,_=l.createElement("script"),Zt(_),Ln(_,"link",p),l.head.appendChild(_),c.instance=_);case"void":return null;default:throw Error(r(443,c.type))}else c.type==="stylesheet"&&(c.state.loading&4)===0&&(p=c.instance,c.state.loading|=4,Hg(p,f.precedence,l));return c.instance}function Hg(l,c,f){for(var p=f.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),_=p.length?p[p.length-1]:null,b=_,C=0;C<p.length;C++){var D=p[C];if(D.dataset.precedence===c)b=D;else if(b!==_)break}b?b.parentNode.insertBefore(l,b.nextSibling):(c=f.nodeType===9?f.head:f,c.insertBefore(l,c.firstChild))}function c0(l,c){l.crossOrigin==null&&(l.crossOrigin=c.crossOrigin),l.referrerPolicy==null&&(l.referrerPolicy=c.referrerPolicy),l.title==null&&(l.title=c.title)}function u0(l,c){l.crossOrigin==null&&(l.crossOrigin=c.crossOrigin),l.referrerPolicy==null&&(l.referrerPolicy=c.referrerPolicy),l.integrity==null&&(l.integrity=c.integrity)}var $g=null;function KR(l,c,f){if($g===null){var p=new Map,_=$g=new Map;_.set(f,p)}else _=$g,p=_.get(f),p||(p=new Map,_.set(f,p));if(p.has(l))return p;for(p.set(l,null),f=f.getElementsByTagName(l),_=0;_<f.length;_++){var b=f[_];if(!(b[To]||b[Gt]||l==="link"&&b.getAttribute("rel")==="stylesheet")&&b.namespaceURI!=="http://www.w3.org/2000/svg"){var C=b.getAttribute(c)||"";C=l+C;var D=p.get(C);D?D.push(b):p.set(C,[b])}}return p}function GR(l,c,f){l=l.ownerDocument||l,l.head.insertBefore(f,c==="title"?l.querySelector("head > title"):null)}function i8(l,c,f){if(f===1||c.itemProp!=null)return!1;switch(l){case"meta":case"title":return!0;case"style":if(typeof c.precedence!="string"||typeof c.href!="string"||c.href==="")break;return!0;case"link":if(typeof c.rel!="string"||typeof c.href!="string"||c.href===""||c.onLoad||c.onError)break;switch(c.rel){case"stylesheet":return l=c.disabled,typeof c.precedence=="string"&&l==null;default:return!0}case"script":if(c.async&&typeof c.async!="function"&&typeof c.async!="symbol"&&!c.onLoad&&!c.onError&&c.src&&typeof c.src=="string")return!0}return!1}function ZR(l){return!(l.type==="stylesheet"&&(l.state.loading&3)===0)}var Lf=null;function s8(){}function o8(l,c,f){if(Lf===null)throw Error(r(475));var p=Lf;if(c.type==="stylesheet"&&(typeof f.media!="string"||matchMedia(f.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var _=eu(f.href),b=l.querySelector(Nf(_));if(b){l=b._p,l!==null&&typeof l=="object"&&typeof l.then=="function"&&(p.count++,p=Wg.bind(p),l.then(p,p)),c.state.loading|=4,c.instance=b,Zt(b);return}b=l.ownerDocument||l,f=XR(f),(_=Gr.get(_))&&c0(f,_),b=b.createElement("link"),Zt(b);var C=b;C._p=new Promise(function(D,G){C.onload=D,C.onerror=G}),Ln(b,"link",f),c.instance=b}p.stylesheets===null&&(p.stylesheets=new Map),p.stylesheets.set(c,l),(l=c.state.preload)&&(c.state.loading&3)===0&&(p.count++,c=Wg.bind(p),l.addEventListener("load",c),l.addEventListener("error",c))}}function a8(){if(Lf===null)throw Error(r(475));var l=Lf;return l.stylesheets&&l.count===0&&h0(l,l.stylesheets),0<l.count?function(c){var f=setTimeout(function(){if(l.stylesheets&&h0(l,l.stylesheets),l.unsuspend){var p=l.unsuspend;l.unsuspend=null,p()}},6e4);return l.unsuspend=c,function(){l.unsuspend=null,clearTimeout(f)}}:null}function Wg(){if(this.count--,this.count===0){if(this.stylesheets)h0(this,this.stylesheets);else if(this.unsuspend){var l=this.unsuspend;this.unsuspend=null,l()}}}var qg=null;function h0(l,c){l.stylesheets=null,l.unsuspend!==null&&(l.count++,qg=new Map,c.forEach(l8,l),qg=null,Wg.call(l))}function l8(l,c){if(!(c.state.loading&4)){var f=qg.get(l);if(f)var p=f.get(null);else{f=new Map,qg.set(l,f);for(var _=l.querySelectorAll("link[data-precedence],style[data-precedence]"),b=0;b<_.length;b++){var C=_[b];(C.nodeName==="LINK"||C.getAttribute("media")!=="not all")&&(f.set(C.dataset.precedence,C),p=C)}p&&f.set(null,p)}_=c.instance,C=_.getAttribute("data-precedence"),b=f.get(C)||p,b===p&&f.set(null,_),f.set(C,_),this.count++,p=Wg.bind(this),_.addEventListener("load",p),_.addEventListener("error",p),b?b.parentNode.insertBefore(_,b.nextSibling):(l=l.nodeType===9?l.head:l,l.insertBefore(_,l.firstChild)),c.state.loading|=4}}var Uf={$$typeof:I,Provider:null,Consumer:null,_currentValue:U,_currentValue2:U,_threadCount:0};function c8(l,c,f,p,_,b,C,D){this.tag=1,this.containerInfo=l,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=gc(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gc(0),this.hiddenUpdates=gc(null),this.identifierPrefix=p,this.onUncaughtError=_,this.onCaughtError=b,this.onRecoverableError=C,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=D,this.incompleteTransitions=new Map}function QR(l,c,f,p,_,b,C,D,G,ue,ge,ve){return l=new c8(l,c,f,C,D,G,ue,ve),c=1,b===!0&&(c|=24),b=Sr(3,null,null,c),l.current=b,b.stateNode=l,c=qv(),c.refCount++,l.pooledCache=c,c.refCount++,b.memoizedState={element:p,isDehydrated:f,cache:c},Gv(b),l}function JR(l){return l?(l=Oc,l):Oc}function eC(l,c,f,p,_,b){_=JR(_),p.context===null?p.context=_:p.pendingContext=_,p=ko(c),p.payload={element:f},b=b===void 0?null:b,b!==null&&(p.callback=b),f=No(l,p,c),f!==null&&(Mr(f,l,c),df(f,l,c))}function tC(l,c){if(l=l.memoizedState,l!==null&&l.dehydrated!==null){var f=l.retryLane;l.retryLane=f!==0&&f<c?f:c}}function f0(l,c){tC(l,c),(l=l.alternate)&&tC(l,c)}function nC(l){if(l.tag===13){var c=Mc(l,67108864);c!==null&&Mr(c,l,67108864),f0(l,67108864)}}var Xg=!0;function u8(l,c,f,p){var _=O.T;O.T=null;var b=W.p;try{W.p=2,d0(l,c,f,p)}finally{W.p=b,O.T=_}}function h8(l,c,f,p){var _=O.T;O.T=null;var b=W.p;try{W.p=8,d0(l,c,f,p)}finally{W.p=b,O.T=_}}function d0(l,c,f,p){if(Xg){var _=p0(p);if(_===null)e0(l,c,p,Yg,f),iC(l,p);else if(d8(_,l,c,f,p))p.stopPropagation();else if(iC(l,p),c&4&&-1<f8.indexOf(l)){for(;_!==null;){var b=Li(_);if(b!==null)switch(b.tag){case 3:if(b=b.stateNode,b.current.memoizedState.isDehydrated){var C=ci(b.pendingLanes);if(C!==0){var D=b;for(D.pendingLanes|=2,D.entangledLanes|=2;C;){var G=1<<31-or(C);D.entanglements[1]|=G,C&=~G}qi(b),(_t&6)===0&&(Mg=pr()+500,Pf(0))}}break;case 13:D=Mc(b,2),D!==null&&Mr(D,b,2),kg(),f0(b,2)}if(b=p0(p),b===null&&e0(l,c,p,Yg,f),b===_)break;_=b}_!==null&&p.stopPropagation()}else e0(l,c,p,null,f)}}function p0(l){return l=Xh(l),g0(l)}var Yg=null;function g0(l){if(Yg=null,l=Di(l),l!==null){var c=s(l);if(c===null)l=null;else{var f=c.tag;if(f===13){if(l=o(c),l!==null)return l;l=null}else if(f===3){if(c.stateNode.current.memoizedState.isDehydrated)return c.tag===3?c.stateNode.containerInfo:null;l=null}else c!==l&&(l=null)}}return Yg=l,null}function rC(l){switch(l){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Dp()){case dn:return 2;case En:return 8;case vs:case bv:return 32;case Uh:return 268435456;default:return 32}default:return 32}}var m0=!1,Xo=null,Yo=null,Ko=null,Vf=new Map,Ff=new Map,Go=[],f8="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function iC(l,c){switch(l){case"focusin":case"focusout":Xo=null;break;case"dragenter":case"dragleave":Yo=null;break;case"mouseover":case"mouseout":Ko=null;break;case"pointerover":case"pointerout":Vf.delete(c.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ff.delete(c.pointerId)}}function Bf(l,c,f,p,_,b){return l===null||l.nativeEvent!==b?(l={blockedOn:c,domEventName:f,eventSystemFlags:p,nativeEvent:b,targetContainers:[_]},c!==null&&(c=Li(c),c!==null&&nC(c)),l):(l.eventSystemFlags|=p,c=l.targetContainers,_!==null&&c.indexOf(_)===-1&&c.push(_),l)}function d8(l,c,f,p,_){switch(c){case"focusin":return Xo=Bf(Xo,l,c,f,p,_),!0;case"dragenter":return Yo=Bf(Yo,l,c,f,p,_),!0;case"mouseover":return Ko=Bf(Ko,l,c,f,p,_),!0;case"pointerover":var b=_.pointerId;return Vf.set(b,Bf(Vf.get(b)||null,l,c,f,p,_)),!0;case"gotpointercapture":return b=_.pointerId,Ff.set(b,Bf(Ff.get(b)||null,l,c,f,p,_)),!0}return!1}function sC(l){var c=Di(l.target);if(c!==null){var f=s(c);if(f!==null){if(c=f.tag,c===13){if(c=o(f),c!==null){l.blockedOn=c,xv(l.priority,function(){if(f.tag===13){var p=Pr();p=Fh(p);var _=Mc(f,p);_!==null&&Mr(_,f,p),f0(f,p)}});return}}else if(c===3&&f.stateNode.current.memoizedState.isDehydrated){l.blockedOn=f.tag===3?f.stateNode.containerInfo:null;return}}}l.blockedOn=null}function Kg(l){if(l.blockedOn!==null)return!1;for(var c=l.targetContainers;0<c.length;){var f=p0(l.nativeEvent);if(f===null){f=l.nativeEvent;var p=new f.constructor(f.type,f);qh=p,f.target.dispatchEvent(p),qh=null}else return c=Li(f),c!==null&&nC(c),l.blockedOn=f,!1;c.shift()}return!0}function oC(l,c,f){Kg(l)&&f.delete(c)}function p8(){m0=!1,Xo!==null&&Kg(Xo)&&(Xo=null),Yo!==null&&Kg(Yo)&&(Yo=null),Ko!==null&&Kg(Ko)&&(Ko=null),Vf.forEach(oC),Ff.forEach(oC)}function Gg(l,c){l.blockedOn===c&&(l.blockedOn=null,m0||(m0=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,p8)))}var Zg=null;function aC(l){Zg!==l&&(Zg=l,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){Zg===l&&(Zg=null);for(var c=0;c<l.length;c+=3){var f=l[c],p=l[c+1],_=l[c+2];if(typeof p!="function"){if(g0(p||f)===null)continue;break}var b=Li(f);b!==null&&(l.splice(c,3),c-=3,gb(b,{pending:!0,data:_,method:f.method,action:p},p,_))}}))}function zf(l){function c(G){return Gg(G,l)}Xo!==null&&Gg(Xo,l),Yo!==null&&Gg(Yo,l),Ko!==null&&Gg(Ko,l),Vf.forEach(c),Ff.forEach(c);for(var f=0;f<Go.length;f++){var p=Go[f];p.blockedOn===l&&(p.blockedOn=null)}for(;0<Go.length&&(f=Go[0],f.blockedOn===null);)sC(f),f.blockedOn===null&&Go.shift();if(f=(l.ownerDocument||l).$$reactFormReplay,f!=null)for(p=0;p<f.length;p+=3){var _=f[p],b=f[p+1],C=_[kn]||null;if(typeof b=="function")C||aC(f);else if(C){var D=null;if(b&&b.hasAttribute("formAction")){if(_=b,C=b[kn]||null)D=C.formAction;else if(g0(_)!==null)continue}else D=C.action;typeof D=="function"?f[p+1]=D:(f.splice(p,3),p-=3),aC(f)}}}function y0(l){this._internalRoot=l}Qg.prototype.render=y0.prototype.render=function(l){var c=this._internalRoot;if(c===null)throw Error(r(409));var f=c.current,p=Pr();eC(f,p,l,c,null,null)},Qg.prototype.unmount=y0.prototype.unmount=function(){var l=this._internalRoot;if(l!==null){this._internalRoot=null;var c=l.containerInfo;eC(l.current,2,null,l,null,null),kg(),c[Ts]=null}};function Qg(l){this._internalRoot=l}Qg.prototype.unstable_scheduleHydration=function(l){if(l){var c=bs();l={blockedOn:null,target:l,priority:c};for(var f=0;f<Go.length&&c!==0&&c<Go[f].priority;f++);Go.splice(f,0,l),f===0&&sC(l)}};var lC=e.version;if(lC!=="19.1.1")throw Error(r(527,lC,"19.1.1"));W.findDOMNode=function(l){var c=l._reactInternals;if(c===void 0)throw typeof l.render=="function"?Error(r(188)):(l=Object.keys(l).join(","),Error(r(268,l)));return l=u(c),l=l!==null?h(l):null,l=l===null?null:l.stateNode,l};var g8={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:O,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Jg=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Jg.isDisabled&&Jg.supportsFiber)try{go=Jg.inject(g8),$n=Jg}catch{}}return Hf.createRoot=function(l,c){if(!i(l))throw Error(r(299));var f=!1,p="",_=E2,b=A2,C=S2,D=null;return c!=null&&(c.unstable_strictMode===!0&&(f=!0),c.identifierPrefix!==void 0&&(p=c.identifierPrefix),c.onUncaughtError!==void 0&&(_=c.onUncaughtError),c.onCaughtError!==void 0&&(b=c.onCaughtError),c.onRecoverableError!==void 0&&(C=c.onRecoverableError),c.unstable_transitionCallbacks!==void 0&&(D=c.unstable_transitionCallbacks)),c=QR(l,1,!1,null,null,f,p,_,b,C,D,null),l[Ts]=c.current,Jb(l),new y0(c)},Hf.hydrateRoot=function(l,c,f){if(!i(l))throw Error(r(299));var p=!1,_="",b=E2,C=A2,D=S2,G=null,ue=null;return f!=null&&(f.unstable_strictMode===!0&&(p=!0),f.identifierPrefix!==void 0&&(_=f.identifierPrefix),f.onUncaughtError!==void 0&&(b=f.onUncaughtError),f.onCaughtError!==void 0&&(C=f.onCaughtError),f.onRecoverableError!==void 0&&(D=f.onRecoverableError),f.unstable_transitionCallbacks!==void 0&&(G=f.unstable_transitionCallbacks),f.formState!==void 0&&(ue=f.formState)),c=QR(l,1,!0,c,f??null,p,_,b,C,D,G,ue),c.context=JR(null),f=c.current,p=Pr(),p=Fh(p),_=ko(p),_.callback=null,No(f,_,p),f=p,c.current.lanes=f,Kt(c,f),qi(c),l[Ts]=c.current,Jb(l),new Qg(c)},Hf.version="19.1.1",Hf}var _C;function A8(){if(_C)return b0.exports;_C=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),b0.exports=E8(),b0.exports}var S8=A8();/**
 * react-router v7.8.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var vC="popstate";function R8(n={}){function e(r,i){let{pathname:s,search:o,hash:a}=r.location;return tw("",{pathname:s,search:o,hash:a},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function t(r,i){return typeof i=="string"?i:Nd(i)}return I8(e,t,null,n)}function jt(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function hs(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function C8(){return Math.random().toString(36).substring(2,10)}function bC(n,e){return{usr:n.state,key:n.key,idx:e}}function tw(n,e,t=null,r){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof e=="string"?ph(e):e,state:t,key:e&&e.key||r||C8()}}function Nd({pathname:n="/",search:e="",hash:t=""}){return e&&e!=="?"&&(n+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(n+=t.charAt(0)==="#"?t:"#"+t),n}function ph(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substring(t),n=n.substring(0,t));let r=n.indexOf("?");r>=0&&(e.search=n.substring(r),n=n.substring(0,r)),n&&(e.pathname=n)}return e}function I8(n,e,t,r={}){let{window:i=document.defaultView,v5Compat:s=!1}=r,o=i.history,a="POP",u=null,h=d();h==null&&(h=0,o.replaceState({...o.state,idx:h},""));function d(){return(o.state||{idx:null}).idx}function g(){a="POP";let E=d(),S=E==null?null:E-h;h=E,u&&u({action:a,location:w.location,delta:S})}function y(E,S){a="PUSH";let P=tw(w.location,E,S);h=d()+1;let I=bC(P,h),L=w.createHref(P);try{o.pushState(I,"",L)}catch(F){if(F instanceof DOMException&&F.name==="DataCloneError")throw F;i.location.assign(L)}s&&u&&u({action:a,location:w.location,delta:1})}function v(E,S){a="REPLACE";let P=tw(w.location,E,S);h=d();let I=bC(P,h),L=w.createHref(P);o.replaceState(I,"",L),s&&u&&u({action:a,location:w.location,delta:0})}function T(E){return P8(E)}let w={get action(){return a},get location(){return n(i,o)},listen(E){if(u)throw new Error("A history only accepts one active listener");return i.addEventListener(vC,g),u=E,()=>{i.removeEventListener(vC,g),u=null}},createHref(E){return e(i,E)},createURL:T,encodeLocation(E){let S=T(E);return{pathname:S.pathname,search:S.search,hash:S.hash}},push:y,replace:v,go(E){return o.go(E)}};return w}function P8(n,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),jt(t,"No window.location.(origin|href) available to create URL");let r=typeof n=="string"?n:Nd(n);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=t+r),new URL(r,t)}function zk(n,e,t="/"){return M8(n,e,t,!1)}function M8(n,e,t,r){let i=typeof e=="string"?ph(e):e,s=Qs(i.pathname||"/",t);if(s==null)return null;let o=jk(n);O8(o);let a=null;for(let u=0;a==null&&u<o.length;++u){let h=H8(s);a=z8(o[u],h,r)}return a}function jk(n,e=[],t=[],r="",i=!1){let s=(o,a,u=i,h)=>{let d={relativePath:h===void 0?o.path||"":h,caseSensitive:o.caseSensitive===!0,childrenIndex:a,route:o};if(d.relativePath.startsWith("/")){if(!d.relativePath.startsWith(r)&&u)return;jt(d.relativePath.startsWith(r),`Absolute route path "${d.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),d.relativePath=d.relativePath.slice(r.length)}let g=Ys([r,d.relativePath]),y=t.concat(d);o.children&&o.children.length>0&&(jt(o.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${g}".`),jk(o.children,e,y,g,u)),!(o.path==null&&!o.index)&&e.push({path:g,score:F8(g,o.index),routesMeta:y})};return n.forEach((o,a)=>{if(o.path===""||!o.path?.includes("?"))s(o,a);else for(let u of Hk(o.path))s(o,a,!0,u)}),e}function Hk(n){let e=n.split("/");if(e.length===0)return[];let[t,...r]=e,i=t.endsWith("?"),s=t.replace(/\?$/,"");if(r.length===0)return i?[s,""]:[s];let o=Hk(r.join("/")),a=[];return a.push(...o.map(u=>u===""?s:[s,u].join("/"))),i&&a.push(...o),a.map(u=>n.startsWith("/")&&u===""?"/":u)}function O8(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:B8(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}var k8=/^:[\w-]+$/,N8=3,D8=2,L8=1,U8=10,V8=-2,TC=n=>n==="*";function F8(n,e){let t=n.split("/"),r=t.length;return t.some(TC)&&(r+=V8),e&&(r+=D8),t.filter(i=>!TC(i)).reduce((i,s)=>i+(k8.test(s)?N8:s===""?L8:U8),r)}function B8(n,e){return n.length===e.length&&n.slice(0,-1).every((r,i)=>r===e[i])?n[n.length-1]-e[e.length-1]:0}function z8(n,e,t=!1){let{routesMeta:r}=n,i={},s="/",o=[];for(let a=0;a<r.length;++a){let u=r[a],h=a===r.length-1,d=s==="/"?e:e.slice(s.length)||"/",g=Ay({path:u.relativePath,caseSensitive:u.caseSensitive,end:h},d),y=u.route;if(!g&&h&&t&&!r[r.length-1].route.index&&(g=Ay({path:u.relativePath,caseSensitive:u.caseSensitive,end:!1},d)),!g)return null;Object.assign(i,g.params),o.push({params:i,pathname:Ys([s,g.pathname]),pathnameBase:X8(Ys([s,g.pathnameBase])),route:y}),g.pathnameBase!=="/"&&(s=Ys([s,g.pathnameBase]))}return o}function Ay(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,r]=j8(n.path,n.caseSensitive,n.end),i=e.match(t);if(!i)return null;let s=i[0],o=s.replace(/(.)\/+$/,"$1"),a=i.slice(1);return{params:r.reduce((h,{paramName:d,isOptional:g},y)=>{if(d==="*"){let T=a[y]||"";o=s.slice(0,s.length-T.length).replace(/(.)\/+$/,"$1")}const v=a[y];return g&&!v?h[d]=void 0:h[d]=(v||"").replace(/%2F/g,"/"),h},{}),pathname:s,pathnameBase:o,pattern:n}}function j8(n,e=!1,t=!0){hs(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let r=[],i="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,u)=>(r.push({paramName:a,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return n.endsWith("*")?(r.push({paramName:"*"}),i+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?i+="\\/*$":n!==""&&n!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function H8(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return hs(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),n}}function Qs(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=n.charAt(t);return r&&r!=="/"?null:n.slice(t)||"/"}function $8(n,e="/"){let{pathname:t,search:r="",hash:i=""}=typeof n=="string"?ph(n):n;return{pathname:t?t.startsWith("/")?t:W8(t,e):e,search:Y8(r),hash:K8(i)}}function W8(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(i=>{i===".."?t.length>1&&t.pop():i!=="."&&t.push(i)}),t.length>1?t.join("/"):"/"}function E0(n,e,t,r){return`Cannot include a '${n}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function q8(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function $k(n){let e=q8(n);return e.map((t,r)=>r===e.length-1?t.pathname:t.pathnameBase)}function Wk(n,e,t,r=!1){let i;typeof n=="string"?i=ph(n):(i={...n},jt(!i.pathname||!i.pathname.includes("?"),E0("?","pathname","search",i)),jt(!i.pathname||!i.pathname.includes("#"),E0("#","pathname","hash",i)),jt(!i.search||!i.search.includes("#"),E0("#","search","hash",i)));let s=n===""||i.pathname==="",o=s?"/":i.pathname,a;if(o==null)a=t;else{let g=e.length-1;if(!r&&o.startsWith("..")){let y=o.split("/");for(;y[0]==="..";)y.shift(),g-=1;i.pathname=y.join("/")}a=g>=0?e[g]:"/"}let u=$8(i,a),h=o&&o!=="/"&&o.endsWith("/"),d=(s||o===".")&&t.endsWith("/");return!u.pathname.endsWith("/")&&(h||d)&&(u.pathname+="/"),u}var Ys=n=>n.join("/").replace(/\/\/+/g,"/"),X8=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),Y8=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,K8=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function G8(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}var qk=["POST","PUT","PATCH","DELETE"];new Set(qk);var Z8=["GET",...qk];new Set(Z8);var gh=A.createContext(null);gh.displayName="DataRouter";var S_=A.createContext(null);S_.displayName="DataRouterState";A.createContext(!1);var Xk=A.createContext({isTransitioning:!1});Xk.displayName="ViewTransition";var Q8=A.createContext(new Map);Q8.displayName="Fetchers";var J8=A.createContext(null);J8.displayName="Await";var gs=A.createContext(null);gs.displayName="Navigation";var cp=A.createContext(null);cp.displayName="Location";var fo=A.createContext({outlet:null,matches:[],isDataRoute:!1});fo.displayName="Route";var Yx=A.createContext(null);Yx.displayName="RouteError";function ez(n,{relative:e}={}){jt(up(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:r}=A.useContext(gs),{hash:i,pathname:s,search:o}=hp(n,{relative:e}),a=s;return t!=="/"&&(a=s==="/"?t:Ys([t,s])),r.createHref({pathname:a,search:o,hash:i})}function up(){return A.useContext(cp)!=null}function rc(){return jt(up(),"useLocation() may be used only in the context of a <Router> component."),A.useContext(cp).location}var Yk="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Kk(n){A.useContext(gs).static||A.useLayoutEffect(n)}function tz(){let{isDataRoute:n}=A.useContext(fo);return n?pz():nz()}function nz(){jt(up(),"useNavigate() may be used only in the context of a <Router> component.");let n=A.useContext(gh),{basename:e,navigator:t}=A.useContext(gs),{matches:r}=A.useContext(fo),{pathname:i}=rc(),s=JSON.stringify($k(r)),o=A.useRef(!1);return Kk(()=>{o.current=!0}),A.useCallback((u,h={})=>{if(hs(o.current,Yk),!o.current)return;if(typeof u=="number"){t.go(u);return}let d=Wk(u,JSON.parse(s),i,h.relative==="path");n==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:Ys([e,d.pathname])),(h.replace?t.replace:t.push)(d,h.state,h)},[e,t,s,i,n])}A.createContext(null);function hp(n,{relative:e}={}){let{matches:t}=A.useContext(fo),{pathname:r}=rc(),i=JSON.stringify($k(t));return A.useMemo(()=>Wk(n,JSON.parse(i),r,e==="path"),[n,i,r,e])}function rz(n,e){return Gk(n,e)}function Gk(n,e,t,r,i){jt(up(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:s}=A.useContext(gs),{matches:o}=A.useContext(fo),a=o[o.length-1],u=a?a.params:{},h=a?a.pathname:"/",d=a?a.pathnameBase:"/",g=a&&a.route;{let P=g&&g.path||"";Zk(h,!g||P.endsWith("*")||P.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${h}" (under <Route path="${P}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${P}"> to <Route path="${P==="/"?"*":`${P}/*`}">.`)}let y=rc(),v;if(e){let P=typeof e=="string"?ph(e):e;jt(d==="/"||P.pathname?.startsWith(d),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${d}" but pathname "${P.pathname}" was given in the \`location\` prop.`),v=P}else v=y;let T=v.pathname||"/",w=T;if(d!=="/"){let P=d.replace(/^\//,"").split("/");w="/"+T.replace(/^\//,"").split("/").slice(P.length).join("/")}let E=zk(n,{pathname:w});hs(g||E!=null,`No routes matched location "${v.pathname}${v.search}${v.hash}" `),hs(E==null||E[E.length-1].route.element!==void 0||E[E.length-1].route.Component!==void 0||E[E.length-1].route.lazy!==void 0,`Matched leaf route at location "${v.pathname}${v.search}${v.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let S=lz(E&&E.map(P=>Object.assign({},P,{params:Object.assign({},u,P.params),pathname:Ys([d,s.encodeLocation?s.encodeLocation(P.pathname).pathname:P.pathname]),pathnameBase:P.pathnameBase==="/"?d:Ys([d,s.encodeLocation?s.encodeLocation(P.pathnameBase).pathname:P.pathnameBase])})),o,t,r,i);return e&&S?A.createElement(cp.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...v},navigationType:"POP"}},S):S}function iz(){let n=dz(),e=G8(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,r="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:r},s={padding:"2px 4px",backgroundColor:r},o=null;return console.error("Error handled by React Router default ErrorBoundary:",n),o=A.createElement(A.Fragment,null,A.createElement("p",null," Hey developer "),A.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",A.createElement("code",{style:s},"ErrorBoundary")," or"," ",A.createElement("code",{style:s},"errorElement")," prop on your route.")),A.createElement(A.Fragment,null,A.createElement("h2",null,"Unexpected Application Error!"),A.createElement("h3",{style:{fontStyle:"italic"}},e),t?A.createElement("pre",{style:i},t):null,o)}var sz=A.createElement(iz,null),oz=class extends A.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,e){return e.location!==n.location||e.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:e.error,location:e.location,revalidation:n.revalidation||e.revalidation}}componentDidCatch(n,e){this.props.unstable_onError?this.props.unstable_onError(n,e):console.error("React Router caught the following error during render",n)}render(){return this.state.error!==void 0?A.createElement(fo.Provider,{value:this.props.routeContext},A.createElement(Yx.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function az({routeContext:n,match:e,children:t}){let r=A.useContext(gh);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),A.createElement(fo.Provider,{value:n},t)}function lz(n,e=[],t=null,r=null,i=null){if(n==null){if(!t)return null;if(t.errors)n=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let s=n,o=t?.errors;if(o!=null){let h=s.findIndex(d=>d.route.id&&o?.[d.route.id]!==void 0);jt(h>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(o).join(",")}`),s=s.slice(0,Math.min(s.length,h+1))}let a=!1,u=-1;if(t)for(let h=0;h<s.length;h++){let d=s[h];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(u=h),d.route.id){let{loaderData:g,errors:y}=t,v=d.route.loader&&!g.hasOwnProperty(d.route.id)&&(!y||y[d.route.id]===void 0);if(d.route.lazy||v){a=!0,u>=0?s=s.slice(0,u+1):s=[s[0]];break}}}return s.reduceRight((h,d,g)=>{let y,v=!1,T=null,w=null;t&&(y=o&&d.route.id?o[d.route.id]:void 0,T=d.route.errorElement||sz,a&&(u<0&&g===0?(Zk("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),v=!0,w=null):u===g&&(v=!0,w=d.route.hydrateFallbackElement||null)));let E=e.concat(s.slice(0,g+1)),S=()=>{let P;return y?P=T:v?P=w:d.route.Component?P=A.createElement(d.route.Component,null):d.route.element?P=d.route.element:P=h,A.createElement(az,{match:d,routeContext:{outlet:h,matches:E,isDataRoute:t!=null},children:P})};return t&&(d.route.ErrorBoundary||d.route.errorElement||g===0)?A.createElement(oz,{location:t.location,revalidation:t.revalidation,component:T,error:y,children:S(),routeContext:{outlet:null,matches:E,isDataRoute:!0},unstable_onError:r}):S()},null)}function Kx(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function cz(n){let e=A.useContext(gh);return jt(e,Kx(n)),e}function uz(n){let e=A.useContext(S_);return jt(e,Kx(n)),e}function hz(n){let e=A.useContext(fo);return jt(e,Kx(n)),e}function Gx(n){let e=hz(n),t=e.matches[e.matches.length-1];return jt(t.route.id,`${n} can only be used on routes that contain a unique "id"`),t.route.id}function fz(){return Gx("useRouteId")}function dz(){let n=A.useContext(Yx),e=uz("useRouteError"),t=Gx("useRouteError");return n!==void 0?n:e.errors?.[t]}function pz(){let{router:n}=cz("useNavigate"),e=Gx("useNavigate"),t=A.useRef(!1);return Kk(()=>{t.current=!0}),A.useCallback(async(i,s={})=>{hs(t.current,Yk),t.current&&(typeof i=="number"?n.navigate(i):await n.navigate(i,{fromRouteId:e,...s}))},[n,e])}var wC={};function Zk(n,e,t){!e&&!wC[n]&&(wC[n]=!0,hs(!1,t))}A.memo(gz);function gz({routes:n,future:e,state:t,unstable_onError:r}){return Gk(n,void 0,t,r,e)}function fu(n){jt(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function mz({basename:n="/",children:e=null,location:t,navigationType:r="POP",navigator:i,static:s=!1}){jt(!up(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let o=n.replace(/^\/*/,"/"),a=A.useMemo(()=>({basename:o,navigator:i,static:s,future:{}}),[o,i,s]);typeof t=="string"&&(t=ph(t));let{pathname:u="/",search:h="",hash:d="",state:g=null,key:y="default"}=t,v=A.useMemo(()=>{let T=Qs(u,o);return T==null?null:{location:{pathname:T,search:h,hash:d,state:g,key:y},navigationType:r}},[o,u,h,d,g,y,r]);return hs(v!=null,`<Router basename="${o}"> is not able to match the URL "${u}${h}${d}" because it does not start with the basename, so the <Router> won't render anything.`),v==null?null:A.createElement(gs.Provider,{value:a},A.createElement(cp.Provider,{children:e,value:v}))}function yz({children:n,location:e}){return rz(nw(n),e)}function nw(n,e=[]){let t=[];return A.Children.forEach(n,(r,i)=>{if(!A.isValidElement(r))return;let s=[...e,i];if(r.type===A.Fragment){t.push.apply(t,nw(r.props.children,s));return}jt(r.type===fu,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),jt(!r.props.index||!r.props.children,"An index route cannot have child routes.");let o={id:r.props.id||s.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=nw(r.props.children,s)),t.push(o)}),t}var Wm="get",qm="application/x-www-form-urlencoded";function R_(n){return n!=null&&typeof n.tagName=="string"}function _z(n){return R_(n)&&n.tagName.toLowerCase()==="button"}function vz(n){return R_(n)&&n.tagName.toLowerCase()==="form"}function bz(n){return R_(n)&&n.tagName.toLowerCase()==="input"}function Tz(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function wz(n,e){return n.button===0&&(!e||e==="_self")&&!Tz(n)}var em=null;function xz(){if(em===null)try{new FormData(document.createElement("form"),0),em=!1}catch{em=!0}return em}var Ez=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function A0(n){return n!=null&&!Ez.has(n)?(hs(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${qm}"`),null):n}function Az(n,e){let t,r,i,s,o;if(vz(n)){let a=n.getAttribute("action");r=a?Qs(a,e):null,t=n.getAttribute("method")||Wm,i=A0(n.getAttribute("enctype"))||qm,s=new FormData(n)}else if(_z(n)||bz(n)&&(n.type==="submit"||n.type==="image")){let a=n.form;if(a==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let u=n.getAttribute("formaction")||a.getAttribute("action");if(r=u?Qs(u,e):null,t=n.getAttribute("formmethod")||a.getAttribute("method")||Wm,i=A0(n.getAttribute("formenctype"))||A0(a.getAttribute("enctype"))||qm,s=new FormData(a,n),!xz()){let{name:h,type:d,value:g}=n;if(d==="image"){let y=h?`${h}.`:"";s.append(`${y}x`,"0"),s.append(`${y}y`,"0")}else h&&s.append(h,g)}}else{if(R_(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=Wm,r=null,i=qm,o=n}return s&&i==="text/plain"&&(o=s,s=void 0),{action:r,method:t.toLowerCase(),encType:i,formData:s,body:o}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Zx(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function Sz(n,e,t){let r=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return r.pathname==="/"?r.pathname=`_root.${t}`:e&&Qs(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${t}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${t}`,r}async function Rz(n,e){if(n.id in e)return e[n.id];try{let t=await import(n.module);return e[n.id]=t,t}catch(t){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function Cz(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function Iz(n,e,t){let r=await Promise.all(n.map(async i=>{let s=e.routes[i.route.id];if(s){let o=await Rz(s,t);return o.links?o.links():[]}return[]}));return kz(r.flat(1).filter(Cz).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function xC(n,e,t,r,i,s){let o=(u,h)=>t[h]?u.route.id!==t[h].route.id:!0,a=(u,h)=>t[h].pathname!==u.pathname||t[h].route.path?.endsWith("*")&&t[h].params["*"]!==u.params["*"];return s==="assets"?e.filter((u,h)=>o(u,h)||a(u,h)):s==="data"?e.filter((u,h)=>{let d=r.routes[u.route.id];if(!d||!d.hasLoader)return!1;if(o(u,h)||a(u,h))return!0;if(u.route.shouldRevalidate){let g=u.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(n,window.origin),nextParams:u.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function Pz(n,e,{includeHydrateFallback:t}={}){return Mz(n.map(r=>{let i=e.routes[r.route.id];if(!i)return[];let s=[i.module];return i.clientActionModule&&(s=s.concat(i.clientActionModule)),i.clientLoaderModule&&(s=s.concat(i.clientLoaderModule)),t&&i.hydrateFallbackModule&&(s=s.concat(i.hydrateFallbackModule)),i.imports&&(s=s.concat(i.imports)),s}).flat(1))}function Mz(n){return[...new Set(n)]}function Oz(n){let e={},t=Object.keys(n).sort();for(let r of t)e[r]=n[r];return e}function kz(n,e){let t=new Set;return new Set(e),n.reduce((r,i)=>{let s=JSON.stringify(Oz(i));return t.has(s)||(t.add(s),r.push({key:s,link:i})),r},[])}function Qk(){let n=A.useContext(gh);return Zx(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function Nz(){let n=A.useContext(S_);return Zx(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var Qx=A.createContext(void 0);Qx.displayName="FrameworkContext";function Jk(){let n=A.useContext(Qx);return Zx(n,"You must render this element inside a <HydratedRouter> element"),n}function Dz(n,e){let t=A.useContext(Qx),[r,i]=A.useState(!1),[s,o]=A.useState(!1),{onFocus:a,onBlur:u,onMouseEnter:h,onMouseLeave:d,onTouchStart:g}=e,y=A.useRef(null);A.useEffect(()=>{if(n==="render"&&o(!0),n==="viewport"){let w=S=>{S.forEach(P=>{o(P.isIntersecting)})},E=new IntersectionObserver(w,{threshold:.5});return y.current&&E.observe(y.current),()=>{E.disconnect()}}},[n]),A.useEffect(()=>{if(r){let w=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(w)}}},[r]);let v=()=>{i(!0)},T=()=>{i(!1),o(!1)};return t?n!=="intent"?[s,y,{}]:[s,y,{onFocus:$f(a,v),onBlur:$f(u,T),onMouseEnter:$f(h,v),onMouseLeave:$f(d,T),onTouchStart:$f(g,v)}]:[!1,y,{}]}function $f(n,e){return t=>{n&&n(t),t.defaultPrevented||e(t)}}function Lz({page:n,...e}){let{router:t}=Qk(),r=A.useMemo(()=>zk(t.routes,n,t.basename),[t.routes,n,t.basename]);return r?A.createElement(Vz,{page:n,matches:r,...e}):null}function Uz(n){let{manifest:e,routeModules:t}=Jk(),[r,i]=A.useState([]);return A.useEffect(()=>{let s=!1;return Iz(n,e,t).then(o=>{s||i(o)}),()=>{s=!0}},[n,e,t]),r}function Vz({page:n,matches:e,...t}){let r=rc(),{manifest:i,routeModules:s}=Jk(),{basename:o}=Qk(),{loaderData:a,matches:u}=Nz(),h=A.useMemo(()=>xC(n,e,u,i,r,"data"),[n,e,u,i,r]),d=A.useMemo(()=>xC(n,e,u,i,r,"assets"),[n,e,u,i,r]),g=A.useMemo(()=>{if(n===r.pathname+r.search+r.hash)return[];let T=new Set,w=!1;if(e.forEach(S=>{let P=i.routes[S.route.id];!P||!P.hasLoader||(!h.some(I=>I.route.id===S.route.id)&&S.route.id in a&&s[S.route.id]?.shouldRevalidate||P.hasClientLoader?w=!0:T.add(S.route.id))}),T.size===0)return[];let E=Sz(n,o,"data");return w&&T.size>0&&E.searchParams.set("_routes",e.filter(S=>T.has(S.route.id)).map(S=>S.route.id).join(",")),[E.pathname+E.search]},[o,a,r,i,h,e,n,s]),y=A.useMemo(()=>Pz(d,i),[d,i]),v=Uz(d);return A.createElement(A.Fragment,null,g.map(T=>A.createElement("link",{key:T,rel:"prefetch",as:"fetch",href:T,...t})),y.map(T=>A.createElement("link",{key:T,rel:"modulepreload",href:T,...t})),v.map(({key:T,link:w})=>A.createElement("link",{key:T,nonce:t.nonce,...w})))}function Fz(...n){return e=>{n.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var eN=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{eN&&(window.__reactRouterVersion="7.8.2")}catch{}function Bz({basename:n,children:e,window:t}){let r=A.useRef();r.current==null&&(r.current=R8({window:t,v5Compat:!0}));let i=r.current,[s,o]=A.useState({action:i.action,location:i.location}),a=A.useCallback(u=>{A.startTransition(()=>o(u))},[o]);return A.useLayoutEffect(()=>i.listen(a),[i,a]),A.createElement(mz,{basename:n,children:e,location:s.location,navigationType:s.action,navigator:i})}var tN=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,_r=A.forwardRef(function({onClick:e,discover:t="render",prefetch:r="none",relative:i,reloadDocument:s,replace:o,state:a,target:u,to:h,preventScrollReset:d,viewTransition:g,...y},v){let{basename:T}=A.useContext(gs),w=typeof h=="string"&&tN.test(h),E,S=!1;if(typeof h=="string"&&w&&(E=h,eN))try{let N=new URL(window.location.href),H=h.startsWith("//")?new URL(N.protocol+h):new URL(h),q=Qs(H.pathname,T);H.origin===N.origin&&q!=null?h=q+H.search+H.hash:S=!0}catch{hs(!1,`<Link to="${h}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let P=ez(h,{relative:i}),[I,L,F]=Dz(r,y),Y=$z(h,{replace:o,state:a,target:u,preventScrollReset:d,relative:i,viewTransition:g});function k(N){e&&e(N),N.defaultPrevented||Y(N)}let M=A.createElement("a",{...y,...F,href:E||P,onClick:S||s?e:k,ref:Fz(v,L),target:u,"data-discover":!w&&t==="render"?"true":void 0});return I&&!w?A.createElement(A.Fragment,null,M,A.createElement(Lz,{page:P})):M});_r.displayName="Link";var zz=A.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:r="",end:i=!1,style:s,to:o,viewTransition:a,children:u,...h},d){let g=hp(o,{relative:h.relative}),y=rc(),v=A.useContext(S_),{navigator:T,basename:w}=A.useContext(gs),E=v!=null&&Kz(g)&&a===!0,S=T.encodeLocation?T.encodeLocation(g).pathname:g.pathname,P=y.pathname,I=v&&v.navigation&&v.navigation.location?v.navigation.location.pathname:null;t||(P=P.toLowerCase(),I=I?I.toLowerCase():null,S=S.toLowerCase()),I&&w&&(I=Qs(I,w)||I);const L=S!=="/"&&S.endsWith("/")?S.length-1:S.length;let F=P===S||!i&&P.startsWith(S)&&P.charAt(L)==="/",Y=I!=null&&(I===S||!i&&I.startsWith(S)&&I.charAt(S.length)==="/"),k={isActive:F,isPending:Y,isTransitioning:E},M=F?e:void 0,N;typeof r=="function"?N=r(k):N=[r,F?"active":null,Y?"pending":null,E?"transitioning":null].filter(Boolean).join(" ");let H=typeof s=="function"?s(k):s;return A.createElement(_r,{...h,"aria-current":M,className:N,ref:d,style:H,to:o,viewTransition:a},typeof u=="function"?u(k):u)});zz.displayName="NavLink";var jz=A.forwardRef(({discover:n="render",fetcherKey:e,navigate:t,reloadDocument:r,replace:i,state:s,method:o=Wm,action:a,onSubmit:u,relative:h,preventScrollReset:d,viewTransition:g,...y},v)=>{let T=Xz(),w=Yz(a,{relative:h}),E=o.toLowerCase()==="get"?"get":"post",S=typeof a=="string"&&tN.test(a),P=I=>{if(u&&u(I),I.defaultPrevented)return;I.preventDefault();let L=I.nativeEvent.submitter,F=L?.getAttribute("formmethod")||o;T(L||I.currentTarget,{fetcherKey:e,method:F,navigate:t,replace:i,state:s,relative:h,preventScrollReset:d,viewTransition:g})};return A.createElement("form",{ref:v,method:E,action:w,onSubmit:r?u:P,...y,"data-discover":!S&&n==="render"?"true":void 0})});jz.displayName="Form";function Hz(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function nN(n){let e=A.useContext(gh);return jt(e,Hz(n)),e}function $z(n,{target:e,replace:t,state:r,preventScrollReset:i,relative:s,viewTransition:o}={}){let a=tz(),u=rc(),h=hp(n,{relative:s});return A.useCallback(d=>{if(wz(d,e)){d.preventDefault();let g=t!==void 0?t:Nd(u)===Nd(h);a(n,{replace:g,state:r,preventScrollReset:i,relative:s,viewTransition:o})}},[u,a,h,t,r,e,n,i,s,o])}var Wz=0,qz=()=>`__${String(++Wz)}__`;function Xz(){let{router:n}=nN("useSubmit"),{basename:e}=A.useContext(gs),t=fz();return A.useCallback(async(r,i={})=>{let{action:s,method:o,encType:a,formData:u,body:h}=Az(r,e);if(i.navigate===!1){let d=i.fetcherKey||qz();await n.fetch(d,t,i.action||s,{preventScrollReset:i.preventScrollReset,formData:u,body:h,formMethod:i.method||o,formEncType:i.encType||a,flushSync:i.flushSync})}else await n.navigate(i.action||s,{preventScrollReset:i.preventScrollReset,formData:u,body:h,formMethod:i.method||o,formEncType:i.encType||a,replace:i.replace,state:i.state,fromRouteId:t,flushSync:i.flushSync,viewTransition:i.viewTransition})},[n,e,t])}function Yz(n,{relative:e}={}){let{basename:t}=A.useContext(gs),r=A.useContext(fo);jt(r,"useFormAction must be used inside a RouteContext");let[i]=r.matches.slice(-1),s={...hp(n||".",{relative:e})},o=rc();if(n==null){s.search=o.search;let a=new URLSearchParams(s.search),u=a.getAll("index");if(u.some(d=>d==="")){a.delete("index"),u.filter(g=>g).forEach(g=>a.append("index",g));let d=a.toString();s.search=d?`?${d}`:""}}return(!n||n===".")&&i.route.index&&(s.search=s.search?s.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(s.pathname=s.pathname==="/"?t:Ys([t,s.pathname])),Nd(s)}function Kz(n,{relative:e}={}){let t=A.useContext(Xk);jt(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=nN("useViewTransitionState"),i=hp(n,{relative:e});if(!t.isTransitioning)return!1;let s=Qs(t.currentLocation.pathname,r)||t.currentLocation.pathname,o=Qs(t.nextLocation.pathname,r)||t.nextLocation.pathname;return Ay(i.pathname,o)!=null||Ay(i.pathname,s)!=null}var Jx=Bk();const Gz=qx(Jx),Zz=()=>{};var EC={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rN=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},Qz=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=n[t++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){const s=n[t++],o=n[t++],a=n[t++],u=((i&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(u>>10)),e[r++]=String.fromCharCode(56320+(u&1023))}else{const s=n[t++],o=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|o&63)}}return e.join("")},iN={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){const s=n[i],o=i+1<n.length,a=o?n[i+1]:0,u=i+2<n.length,h=u?n[i+2]:0,d=s>>2,g=(s&3)<<4|a>>4;let y=(a&15)<<2|h>>6,v=h&63;u||(v=64,o||(y=64)),r.push(t[d],t[g],t[y],t[v])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(rN(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Qz(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){const s=t[n.charAt(i++)],a=i<n.length?t[n.charAt(i)]:0;++i;const h=i<n.length?t[n.charAt(i)]:64;++i;const g=i<n.length?t[n.charAt(i)]:64;if(++i,s==null||a==null||h==null||g==null)throw new Jz;const y=s<<2|a>>4;if(r.push(y),h!==64){const v=a<<4&240|h>>2;if(r.push(v),g!==64){const T=h<<6&192|g;r.push(T)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Jz extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const e9=function(n){const e=rN(n);return iN.encodeByteArray(e,!0)},Sy=function(n){return e9(n).replace(/\./g,"")},sN=function(n){try{return iN.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t9(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n9=()=>t9().__FIREBASE_DEFAULTS__,r9=()=>{if(typeof process>"u"||typeof EC>"u")return;const n=EC.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},i9=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&sN(n[1]);return e&&JSON.parse(e)},C_=()=>{try{return Zz()||n9()||r9()||i9()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},oN=n=>C_()?.emulatorHosts?.[n],s9=n=>{const e=oN(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},aN=()=>C_()?.config,lN=n=>C_()?.[`_${n}`];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o9{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mh(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function cN(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a9(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Sy(JSON.stringify(t)),Sy(JSON.stringify(o)),""].join(".")}const fd={};function l9(){const n={prod:[],emulator:[]};for(const e of Object.keys(fd))fd[e]?n.emulator.push(e):n.prod.push(e);return n}function c9(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let AC=!1;function uN(n,e){if(typeof window>"u"||typeof document>"u"||!mh(window.location.host)||fd[n]===e||fd[n]||AC)return;fd[n]=e;function t(y){return`__firebase__banner__${y}`}const r="__firebase__banner",s=l9().prod.length>0;function o(){const y=document.getElementById(r);y&&y.remove()}function a(y){y.style.display="flex",y.style.background="#7faaf0",y.style.position="fixed",y.style.bottom="5px",y.style.left="5px",y.style.padding=".5em",y.style.borderRadius="5px",y.style.alignItems="center"}function u(y,v){y.setAttribute("width","24"),y.setAttribute("id",v),y.setAttribute("height","24"),y.setAttribute("viewBox","0 0 24 24"),y.setAttribute("fill","none"),y.style.marginLeft="-6px"}function h(){const y=document.createElement("span");return y.style.cursor="pointer",y.style.marginLeft="16px",y.style.fontSize="24px",y.innerHTML=" &times;",y.onclick=()=>{AC=!0,o()},y}function d(y,v){y.setAttribute("id",v),y.innerText="Learn more",y.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",y.setAttribute("target","__blank"),y.style.paddingLeft="5px",y.style.textDecoration="underline"}function g(){const y=c9(r),v=t("text"),T=document.getElementById(v)||document.createElement("span"),w=t("learnmore"),E=document.getElementById(w)||document.createElement("a"),S=t("preprendIcon"),P=document.getElementById(S)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(y.created){const I=y.element;a(I),d(E,w);const L=h();u(P,S),I.append(P,T,E,L),document.body.appendChild(I)}s?(T.innerText="Preview backend disconnected.",P.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(P.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,T.innerText="Preview backend running in this workspace."),T.setAttribute("id",v)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",g):g()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rr(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function u9(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(rr())}function h9(){const n=C_()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function f9(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function d9(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function p9(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function g9(){const n=rr();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function m9(){return!h9()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function y9(){try{return typeof indexedDB=="object"}catch{return!1}}function _9(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{e(i.error?.message||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v9="FirebaseError";class po extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=v9,Object.setPrototypeOf(this,po.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,fp.prototype.create)}}class fp{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],o=s?b9(s,r):"Error",a=`${this.serviceName}: ${o} (${i}).`;return new po(i,a,r)}}function b9(n,e){return n.replace(T9,(t,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const T9=/\{\$([^}]+)}/g;function w9(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Wl(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const i of t){if(!r.includes(i))return!1;const s=n[i],o=e[i];if(SC(s)&&SC(o)){if(!Wl(s,o))return!1}else if(s!==o)return!1}for(const i of r)if(!t.includes(i))return!1;return!0}function SC(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dp(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Jf(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[i,s]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(s)}}),e}function ed(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function x9(n,e){const t=new E9(n,e);return t.subscribe.bind(t)}class E9{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");A9(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=S0),i.error===void 0&&(i.error=S0),i.complete===void 0&&(i.complete=S0);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function A9(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function S0(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wr(n){return n&&n._delegate?n._delegate:n}let ql=class{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Il="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S9{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new o9;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(C9(e))try{this.getOrInitializeService({instanceIdentifier:Il})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=Il){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Il){return this.instances.has(e)}getOptions(e=Il){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[s,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(s);r===a&&o.resolve(i)}return i}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),i=this.onInitCallbacks.get(r)??new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:R9(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Il){return this.component?this.component.multipleInstances?e:Il:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function R9(n){return n===Il?void 0:n}function C9(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I9{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new S9(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var rt;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(rt||(rt={}));const P9={debug:rt.DEBUG,verbose:rt.VERBOSE,info:rt.INFO,warn:rt.WARN,error:rt.ERROR,silent:rt.SILENT},M9=rt.INFO,O9={[rt.DEBUG]:"log",[rt.VERBOSE]:"log",[rt.INFO]:"info",[rt.WARN]:"warn",[rt.ERROR]:"error"},k9=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),i=O9[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class eE{constructor(e){this.name=e,this._logLevel=M9,this._logHandler=k9,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in rt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?P9[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,rt.DEBUG,...e),this._logHandler(this,rt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,rt.VERBOSE,...e),this._logHandler(this,rt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,rt.INFO,...e),this._logHandler(this,rt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,rt.WARN,...e),this._logHandler(this,rt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,rt.ERROR,...e),this._logHandler(this,rt.ERROR,...e)}}const N9=(n,e)=>e.some(t=>n instanceof t);let RC,CC;function D9(){return RC||(RC=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function L9(){return CC||(CC=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const hN=new WeakMap,rw=new WeakMap,fN=new WeakMap,R0=new WeakMap,tE=new WeakMap;function U9(n){const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",o)},s=()=>{t(_a(n.result)),i()},o=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&hN.set(t,n)}).catch(()=>{}),tE.set(e,n),e}function V9(n){if(rw.has(n))return;const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",o),n.removeEventListener("abort",o)},s=()=>{t(),i()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",o),n.addEventListener("abort",o)});rw.set(n,e)}let iw={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return rw.get(n);if(e==="objectStoreNames")return n.objectStoreNames||fN.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return _a(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function F9(n){iw=n(iw)}function B9(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(C0(this),e,...t);return fN.set(r,e.sort?e.sort():[e]),_a(r)}:L9().includes(n)?function(...e){return n.apply(C0(this),e),_a(hN.get(this))}:function(...e){return _a(n.apply(C0(this),e))}}function z9(n){return typeof n=="function"?B9(n):(n instanceof IDBTransaction&&V9(n),N9(n,D9())?new Proxy(n,iw):n)}function _a(n){if(n instanceof IDBRequest)return U9(n);if(R0.has(n))return R0.get(n);const e=z9(n);return e!==n&&(R0.set(n,e),tE.set(e,n)),e}const C0=n=>tE.get(n);function j9(n,e,{blocked:t,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(n,e),a=_a(o);return r&&o.addEventListener("upgradeneeded",u=>{r(_a(o.result),u.oldVersion,u.newVersion,_a(o.transaction),u)}),t&&o.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),a.then(u=>{s&&u.addEventListener("close",()=>s()),i&&u.addEventListener("versionchange",h=>i(h.oldVersion,h.newVersion,h))}).catch(()=>{}),a}const H9=["get","getKey","getAll","getAllKeys","count"],$9=["put","add","delete","clear"],I0=new Map;function IC(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(I0.get(e))return I0.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,i=$9.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||H9.includes(t)))return;const s=async function(o,...a){const u=this.transaction(o,i?"readwrite":"readonly");let h=u.store;return r&&(h=h.index(a.shift())),(await Promise.all([h[t](...a),i&&u.done]))[0]};return I0.set(e,s),s}F9(n=>({...n,get:(e,t,r)=>IC(e,t)||n.get(e,t,r),has:(e,t)=>!!IC(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W9{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(q9(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function q9(n){return n.getComponent()?.type==="VERSION"}const sw="@firebase/app",PC="0.14.3";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Js=new eE("@firebase/app"),X9="@firebase/app-compat",Y9="@firebase/analytics-compat",K9="@firebase/analytics",G9="@firebase/app-check-compat",Z9="@firebase/app-check",Q9="@firebase/auth",J9="@firebase/auth-compat",ej="@firebase/database",tj="@firebase/data-connect",nj="@firebase/database-compat",rj="@firebase/functions",ij="@firebase/functions-compat",sj="@firebase/installations",oj="@firebase/installations-compat",aj="@firebase/messaging",lj="@firebase/messaging-compat",cj="@firebase/performance",uj="@firebase/performance-compat",hj="@firebase/remote-config",fj="@firebase/remote-config-compat",dj="@firebase/storage",pj="@firebase/storage-compat",gj="@firebase/firestore",mj="@firebase/ai",yj="@firebase/firestore-compat",_j="firebase",vj="12.3.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ow="[DEFAULT]",bj={[sw]:"fire-core",[X9]:"fire-core-compat",[K9]:"fire-analytics",[Y9]:"fire-analytics-compat",[Z9]:"fire-app-check",[G9]:"fire-app-check-compat",[Q9]:"fire-auth",[J9]:"fire-auth-compat",[ej]:"fire-rtdb",[tj]:"fire-data-connect",[nj]:"fire-rtdb-compat",[rj]:"fire-fn",[ij]:"fire-fn-compat",[sj]:"fire-iid",[oj]:"fire-iid-compat",[aj]:"fire-fcm",[lj]:"fire-fcm-compat",[cj]:"fire-perf",[uj]:"fire-perf-compat",[hj]:"fire-rc",[fj]:"fire-rc-compat",[dj]:"fire-gcs",[pj]:"fire-gcs-compat",[gj]:"fire-fst",[yj]:"fire-fst-compat",[mj]:"fire-vertex","fire-js":"fire-js",[_j]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ry=new Map,Tj=new Map,aw=new Map;function MC(n,e){try{n.container.addComponent(e)}catch(t){Js.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Wu(n){const e=n.name;if(aw.has(e))return Js.debug(`There were multiple attempts to register component ${e}.`),!1;aw.set(e,n);for(const t of Ry.values())MC(t,n);for(const t of Tj.values())MC(t,n);return!0}function nE(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Jr(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wj={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},va=new fp("app","Firebase",wj);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xj{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new ql("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw va.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yh=vj;function dN(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:ow,automaticDataCollectionEnabled:!0,...e},i=r.name;if(typeof i!="string"||!i)throw va.create("bad-app-name",{appName:String(i)});if(t||(t=aN()),!t)throw va.create("no-options");const s=Ry.get(i);if(s){if(Wl(t,s.options)&&Wl(r,s.config))return s;throw va.create("duplicate-app",{appName:i})}const o=new I9(i);for(const u of aw.values())o.addComponent(u);const a=new xj(t,r,o);return Ry.set(i,a),a}function pN(n=ow){const e=Ry.get(n);if(!e&&n===ow&&aN())return dN();if(!e)throw va.create("no-app",{appName:n});return e}function ba(n,e,t){let r=bj[n]??n;t&&(r+=`-${t}`);const i=r.match(/\s|\//),s=e.match(/\s|\//);if(i||s){const o=[`Unable to register library "${r}" with version "${e}":`];i&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&s&&o.push("and"),s&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Js.warn(o.join(" "));return}Wu(new ql(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ej="firebase-heartbeat-database",Aj=1,Dd="firebase-heartbeat-store";let P0=null;function gN(){return P0||(P0=j9(Ej,Aj,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Dd)}catch(t){console.warn(t)}}}}).catch(n=>{throw va.create("idb-open",{originalErrorMessage:n.message})})),P0}async function Sj(n){try{const t=(await gN()).transaction(Dd),r=await t.objectStore(Dd).get(mN(n));return await t.done,r}catch(e){if(e instanceof po)Js.warn(e.message);else{const t=va.create("idb-get",{originalErrorMessage:e?.message});Js.warn(t.message)}}}async function OC(n,e){try{const r=(await gN()).transaction(Dd,"readwrite");await r.objectStore(Dd).put(e,mN(n)),await r.done}catch(t){if(t instanceof po)Js.warn(t.message);else{const r=va.create("idb-set",{originalErrorMessage:t?.message});Js.warn(r.message)}}}function mN(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rj=1024,Cj=30;class Ij{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Mj(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=kC();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(i=>i.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats.length>Cj){const i=Oj(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(i,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Js.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=kC(),{heartbeatsToSend:t,unsentEntries:r}=Pj(this._heartbeatsCache.heartbeats),i=Sy(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return Js.warn(e),""}}}function kC(){return new Date().toISOString().substring(0,10)}function Pj(n,e=Rj){const t=[];let r=n.slice();for(const i of n){const s=t.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),NC(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),NC(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class Mj{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return y9()?_9().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Sj(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return OC(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return OC(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function NC(n){return Sy(JSON.stringify({version:2,heartbeats:n})).length}function Oj(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kj(n){Wu(new ql("platform-logger",e=>new W9(e),"PRIVATE")),Wu(new ql("heartbeat",e=>new Ij(e),"PRIVATE")),ba(sw,PC,n),ba(sw,PC,"esm2020"),ba("fire-js","")}kj("");function yN(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Nj=yN,_N=new fp("auth","Firebase",yN());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cy=new eE("@firebase/auth");function Dj(n,...e){Cy.logLevel<=rt.WARN&&Cy.warn(`Auth (${yh}): ${n}`,...e)}function Xm(n,...e){Cy.logLevel<=rt.ERROR&&Cy.error(`Auth (${yh}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ri(n,...e){throw rE(n,...e)}function ns(n,...e){return rE(n,...e)}function vN(n,e,t){const r={...Nj(),[e]:t};return new fp("auth","Firebase",r).create(e,{appName:n.name})}function Ks(n){return vN(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function rE(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return _N.create(n,...e)}function ze(n,e,...t){if(!n)throw rE(e,...t)}function Ws(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Xm(e),new Error(e)}function eo(n,e){n||Ws(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lw(){return typeof self<"u"&&self.location?.href||""}function Lj(){return DC()==="http:"||DC()==="https:"}function DC(){return typeof self<"u"&&self.location?.protocol||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uj(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Lj()||d9()||"connection"in navigator)?navigator.onLine:!0}function Vj(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pp{constructor(e,t){this.shortDelay=e,this.longDelay=t,eo(t>e,"Short delay should be less than long delay!"),this.isMobile=u9()||p9()}get(){return Uj()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iE(n,e){eo(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bN{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Ws("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Ws("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Ws("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fj={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bj=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],zj=new pp(3e4,6e4);function Fa(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function Ba(n,e,t,r,i={}){return TN(n,i,async()=>{let s={},o={};r&&(e==="GET"?o=r:s={body:JSON.stringify(r)});const a=dp({key:n.config.apiKey,...o}).slice(1),u=await n._getAdditionalHeaders();u["Content-Type"]="application/json",n.languageCode&&(u["X-Firebase-Locale"]=n.languageCode);const h={method:e,headers:u,...s};return f9()||(h.referrerPolicy="no-referrer"),n.emulatorConfig&&mh(n.emulatorConfig.host)&&(h.credentials="include"),bN.fetch()(await wN(n,n.config.apiHost,t,a),h)})}async function TN(n,e,t){n._canInitEmulator=!1;const r={...Fj,...e};try{const i=new Hj(n),s=await Promise.race([t(),i.promise]);i.clearNetworkTimeout();const o=await s.json();if("needConfirmation"in o)throw tm(n,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{const a=s.ok?o.errorMessage:o.error.message,[u,h]=a.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw tm(n,"credential-already-in-use",o);if(u==="EMAIL_EXISTS")throw tm(n,"email-already-in-use",o);if(u==="USER_DISABLED")throw tm(n,"user-disabled",o);const d=r[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw vN(n,d,h);Ri(n,d)}}catch(i){if(i instanceof po)throw i;Ri(n,"network-request-failed",{message:String(i)})}}async function gp(n,e,t,r,i={}){const s=await Ba(n,e,t,r,i);return"mfaPendingCredential"in s&&Ri(n,"multi-factor-auth-required",{_serverResponse:s}),s}async function wN(n,e,t,r){const i=`${e}${t}?${r}`,s=n,o=s.config.emulator?iE(n.config,i):`${n.config.apiScheme}://${i}`;return Bj.includes(t)&&(await s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(o).toString():o}function jj(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Hj{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(ns(this.auth,"network-request-failed")),zj.get())})}}function tm(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const i=ns(n,e,r);return i.customData._tokenResponse=t,i}function LC(n){return n!==void 0&&n.enterprise!==void 0}class $j{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return jj(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function Wj(n,e){return Ba(n,"GET","/v2/recaptchaConfig",Fa(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qj(n,e){return Ba(n,"POST","/v1/accounts:delete",e)}async function Iy(n,e){return Ba(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dd(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Xj(n,e=!1){const t=wr(n),r=await t.getIdToken(e),i=sE(r);ze(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");const s=typeof i.firebase=="object"?i.firebase:void 0,o=s?.sign_in_provider;return{claims:i,token:r,authTime:dd(M0(i.auth_time)),issuedAtTime:dd(M0(i.iat)),expirationTime:dd(M0(i.exp)),signInProvider:o||null,signInSecondFactor:s?.sign_in_second_factor||null}}function M0(n){return Number(n)*1e3}function sE(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Xm("JWT malformed, contained fewer than 3 sections"),null;try{const i=sN(t);return i?JSON.parse(i):(Xm("Failed to decode base64 JWT payload"),null)}catch(i){return Xm("Caught error parsing JWT payload as JSON",i?.toString()),null}}function UC(n){const e=sE(n);return ze(e,"internal-error"),ze(typeof e.exp<"u","internal-error"),ze(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ld(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof po&&Yj(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function Yj({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kj{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cw{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=dd(this.lastLoginAt),this.creationTime=dd(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Py(n){const e=n.auth,t=await n.getIdToken(),r=await Ld(n,Iy(e,{idToken:t}));ze(r?.users.length,e,"internal-error");const i=r.users[0];n._notifyReloadListener(i);const s=i.providerUserInfo?.length?xN(i.providerUserInfo):[],o=Zj(n.providerData,s),a=n.isAnonymous,u=!(n.email&&i.passwordHash)&&!o?.length,h=a?u:!1,d={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new cw(i.createdAt,i.lastLoginAt),isAnonymous:h};Object.assign(n,d)}async function Gj(n){const e=wr(n);await Py(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Zj(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function xN(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Qj(n,e){const t=await TN(n,{},async()=>{const r=dp({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=n.config,o=await wN(n,i,"/v1/token",`key=${s}`),a=await n._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const u={method:"POST",headers:a,body:r};return n.emulatorConfig&&mh(n.emulatorConfig.host)&&(u.credentials="include"),bN.fetch()(o,u)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function Jj(n,e){return Ba(n,"POST","/v2/accounts:revokeToken",Fa(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Du{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ze(e.idToken,"internal-error"),ze(typeof e.idToken<"u","internal-error"),ze(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):UC(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){ze(e.length!==0,"internal-error");const t=UC(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(ze(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:i,expiresIn:s}=await Qj(e,t);this.updateTokensAndExpiration(r,i,Number(s))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:i,expirationTime:s}=t,o=new Du;return r&&(ze(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),i&&(ze(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),s&&(ze(typeof s=="number","internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Du,this.toJSON())}_performRefresh(){return Ws("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qo(n,e){ze(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class wi{constructor({uid:e,auth:t,stsTokenManager:r,...i}){this.providerId="firebase",this.proactiveRefresh=new Kj(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new cw(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await Ld(this,this.stsTokenManager.getToken(this.auth,e));return ze(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return Xj(this,e)}reload(){return Gj(this)}_assign(e){this!==e&&(ze(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new wi({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){ze(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Py(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Jr(this.auth.app))return Promise.reject(Ks(this.auth));const e=await this.getIdToken();return await Ld(this,qj(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,i=t.email??void 0,s=t.phoneNumber??void 0,o=t.photoURL??void 0,a=t.tenantId??void 0,u=t._redirectEventId??void 0,h=t.createdAt??void 0,d=t.lastLoginAt??void 0,{uid:g,emailVerified:y,isAnonymous:v,providerData:T,stsTokenManager:w}=t;ze(g&&w,e,"internal-error");const E=Du.fromJSON(this.name,w);ze(typeof g=="string",e,"internal-error"),Qo(r,e.name),Qo(i,e.name),ze(typeof y=="boolean",e,"internal-error"),ze(typeof v=="boolean",e,"internal-error"),Qo(s,e.name),Qo(o,e.name),Qo(a,e.name),Qo(u,e.name),Qo(h,e.name),Qo(d,e.name);const S=new wi({uid:g,auth:e,email:i,emailVerified:y,displayName:r,isAnonymous:v,photoURL:o,phoneNumber:s,tenantId:a,stsTokenManager:E,createdAt:h,lastLoginAt:d});return T&&Array.isArray(T)&&(S.providerData=T.map(P=>({...P}))),u&&(S._redirectEventId=u),S}static async _fromIdTokenResponse(e,t,r=!1){const i=new Du;i.updateFromServerResponse(t);const s=new wi({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await Py(s),s}static async _fromGetAccountInfoResponse(e,t,r){const i=t.users[0];ze(i.localId!==void 0,"internal-error");const s=i.providerUserInfo!==void 0?xN(i.providerUserInfo):[],o=!(i.email&&i.passwordHash)&&!s?.length,a=new Du;a.updateFromIdToken(r);const u=new wi({uid:i.localId,auth:e,stsTokenManager:a,isAnonymous:o}),h={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new cw(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!s?.length};return Object.assign(u,h),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VC=new Map;function qs(n){eo(n instanceof Function,"Expected a class definition");let e=VC.get(n);return e?(eo(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,VC.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EN{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}EN.type="NONE";const FC=EN;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ym(n,e,t){return`firebase:${n}:${e}:${t}`}class Lu{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:i,name:s}=this.auth;this.fullUserKey=Ym(this.userKey,i.apiKey,s),this.fullPersistenceKey=Ym("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await Iy(this.auth,{idToken:e}).catch(()=>{});return t?wi._fromGetAccountInfoResponse(this.auth,t,e):null}return wi._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new Lu(qs(FC),e,r);const i=(await Promise.all(t.map(async h=>{if(await h._isAvailable())return h}))).filter(h=>h);let s=i[0]||qs(FC);const o=Ym(r,e.config.apiKey,e.name);let a=null;for(const h of t)try{const d=await h._get(o);if(d){let g;if(typeof d=="string"){const y=await Iy(e,{idToken:d}).catch(()=>{});if(!y)break;g=await wi._fromGetAccountInfoResponse(e,y,d)}else g=wi._fromJSON(e,d);h!==s&&(a=g),s=h;break}}catch{}const u=i.filter(h=>h._shouldAllowMigration);return!s._shouldAllowMigration||!u.length?new Lu(s,e,r):(s=u[0],a&&await s._set(o,a.toJSON()),await Promise.all(t.map(async h=>{if(h!==s)try{await h._remove(o)}catch{}})),new Lu(s,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BC(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(CN(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(AN(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(PN(e))return"Blackberry";if(MN(e))return"Webos";if(SN(e))return"Safari";if((e.includes("chrome/")||RN(e))&&!e.includes("edge/"))return"Chrome";if(IN(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function AN(n=rr()){return/firefox\//i.test(n)}function SN(n=rr()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function RN(n=rr()){return/crios\//i.test(n)}function CN(n=rr()){return/iemobile/i.test(n)}function IN(n=rr()){return/android/i.test(n)}function PN(n=rr()){return/blackberry/i.test(n)}function MN(n=rr()){return/webos/i.test(n)}function oE(n=rr()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function e7(n=rr()){return oE(n)&&!!window.navigator?.standalone}function t7(){return g9()&&document.documentMode===10}function ON(n=rr()){return oE(n)||IN(n)||MN(n)||PN(n)||/windows phone/i.test(n)||CN(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kN(n,e=[]){let t;switch(n){case"Browser":t=BC(rr());break;case"Worker":t=`${BC(rr())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${yh}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n7{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=s=>new Promise((o,a)=>{try{const u=e(s);o(u)}catch(u){a(u)}});r.onAbort=t,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function r7(n,e={}){return Ba(n,"GET","/v2/passwordPolicy",Fa(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i7=6;class s7{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??i7,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o7{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new zC(this),this.idTokenSubscription=new zC(this),this.beforeStateQueue=new n7(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=_N,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=qs(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Lu.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Iy(this,{idToken:e}),r=await wi._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Jr(this.app)){const s=this.app.settings.authIdToken;return s?new Promise(o=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(s).then(o,o))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const s=this.redirectUser?._redirectEventId,o=r?._redirectEventId,a=await this.tryRedirectSignIn(e);(!s||s===o)&&a?.user&&(r=a.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(s){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(s))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return ze(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Py(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Vj()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Jr(this.app))return Promise.reject(Ks(this));const t=e?wr(e):null;return t&&ze(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&ze(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Jr(this.app)?Promise.reject(Ks(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Jr(this.app)?Promise.reject(Ks(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(qs(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await r7(this),t=new s7(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new fp("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await Jj(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&qs(e)||this._popupRedirectResolver;ze(t,this,"argument-error"),this.redirectPersistenceManager=await Lu.create(this,[qs(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};const s=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(ze(a,this,"internal-error"),a.then(()=>{o||s(this.currentUser)}),typeof t=="function"){const u=e.addObserver(t,r,i);return()=>{o=!0,u()}}else{const u=e.addObserver(t);return()=>{o=!0,u()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ze(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=kN(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(Jr(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&Dj(`Error while retrieving App Check token: ${e.error}`),e?.token}}function ic(n){return wr(n)}class zC{constructor(e){this.auth=e,this.observer=null,this.addObserver=x9(t=>this.observer=t)}get next(){return ze(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let I_={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function a7(n){I_=n}function NN(n){return I_.loadJS(n)}function l7(){return I_.recaptchaEnterpriseScript}function c7(){return I_.gapiScript}function u7(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class h7{constructor(){this.enterprise=new f7}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class f7{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const d7="recaptcha-enterprise",DN="NO_RECAPTCHA";class p7{constructor(e){this.type=d7,this.auth=ic(e)}async verify(e="verify",t=!1){async function r(s){if(!t){if(s.tenantId==null&&s._agentRecaptchaConfig!=null)return s._agentRecaptchaConfig.siteKey;if(s.tenantId!=null&&s._tenantRecaptchaConfigs[s.tenantId]!==void 0)return s._tenantRecaptchaConfigs[s.tenantId].siteKey}return new Promise(async(o,a)=>{Wj(s,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(u=>{if(u.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const h=new $j(u);return s.tenantId==null?s._agentRecaptchaConfig=h:s._tenantRecaptchaConfigs[s.tenantId]=h,o(h.siteKey)}}).catch(u=>{a(u)})})}function i(s,o,a){const u=window.grecaptcha;LC(u)?u.enterprise.ready(()=>{u.enterprise.execute(s,{action:e}).then(h=>{o(h)}).catch(()=>{o(DN)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new h7().execute("siteKey",{action:"verify"}):new Promise((s,o)=>{r(this.auth).then(a=>{if(!t&&LC(window.grecaptcha))i(a,s,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let u=l7();u.length!==0&&(u+=a),NN(u).then(()=>{i(a,s,o)}).catch(h=>{o(h)})}}).catch(a=>{o(a)})})}}async function jC(n,e,t,r=!1,i=!1){const s=new p7(n);let o;if(i)o=DN;else try{o=await s.verify(t)}catch{o=await s.verify(t,!0)}const a={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in a){const u=a.phoneEnrollmentInfo.phoneNumber,h=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:u,recaptchaToken:h,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const u=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:u,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return r?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function uw(n,e,t,r,i){if(n._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const s=await jC(n,e,t,t==="getOobCode");return r(n,s)}else return r(n,e).catch(async s=>{if(s.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await jC(n,e,t,t==="getOobCode");return r(n,o)}else return Promise.reject(s)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g7(n,e){const t=nE(n,"auth");if(t.isInitialized()){const i=t.getImmediate(),s=t.getOptions();if(Wl(s,e??{}))return i;Ri(i,"already-initialized")}return t.initialize({options:e})}function m7(n,e){const t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(qs);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function y7(n,e,t){const r=ic(n);ze(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!1,s=LN(e),{host:o,port:a}=_7(e),u=a===null?"":`:${a}`,h={url:`${s}//${o}${u}/`},d=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){ze(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),ze(Wl(h,r.config.emulator)&&Wl(d,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=h,r.emulatorConfig=d,r.settings.appVerificationDisabledForTesting=!0,mh(o)?(cN(`${s}//${o}${u}`),uN("Auth",!0)):v7()}function LN(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function _7(n){const e=LN(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const s=i[1];return{host:s,port:HC(r.substr(s.length+1))}}else{const[s,o]=r.split(":");return{host:s,port:HC(o)}}}function HC(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function v7(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aE{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Ws("not implemented")}_getIdTokenResponse(e){return Ws("not implemented")}_linkToIdToken(e,t){return Ws("not implemented")}_getReauthenticationResolver(e){return Ws("not implemented")}}async function b7(n,e){return Ba(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function T7(n,e){return gp(n,"POST","/v1/accounts:signInWithPassword",Fa(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function w7(n,e){return gp(n,"POST","/v1/accounts:signInWithEmailLink",Fa(n,e))}async function x7(n,e){return gp(n,"POST","/v1/accounts:signInWithEmailLink",Fa(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ud extends aE{constructor(e,t,r,i=null){super("password",r),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new Ud(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new Ud(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return uw(e,t,"signInWithPassword",T7);case"emailLink":return w7(e,{email:this._email,oobCode:this._password});default:Ri(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return uw(e,r,"signUpPassword",b7);case"emailLink":return x7(e,{idToken:t,email:this._email,oobCode:this._password});default:Ri(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Uu(n,e){return gp(n,"POST","/v1/accounts:signInWithIdp",Fa(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E7="http://localhost";class Xl extends aE{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Xl(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Ri("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i,...s}=t;if(!r||!i)return null;const o=new Xl(r,i);return o.idToken=s.idToken||void 0,o.accessToken=s.accessToken||void 0,o.secret=s.secret,o.nonce=s.nonce,o.pendingToken=s.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Uu(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Uu(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Uu(e,t)}buildRequest(){const e={requestUri:E7,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=dp(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A7(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function S7(n){const e=Jf(ed(n)).link,t=e?Jf(ed(e)).deep_link_id:null,r=Jf(ed(n)).deep_link_id;return(r?Jf(ed(r)).link:null)||r||t||e||n}class lE{constructor(e){const t=Jf(ed(e)),r=t.apiKey??null,i=t.oobCode??null,s=A7(t.mode??null);ze(r&&i&&s,"argument-error"),this.apiKey=r,this.operation=s,this.code=i,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=S7(e);try{return new lE(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _h{constructor(){this.providerId=_h.PROVIDER_ID}static credential(e,t){return Ud._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=lE.parseLink(t);return ze(r,"argument-error"),Ud._fromEmailAndCode(e,r.code,r.tenantId)}}_h.PROVIDER_ID="password";_h.EMAIL_PASSWORD_SIGN_IN_METHOD="password";_h.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UN{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mp extends UN{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class la extends mp{constructor(){super("facebook.com")}static credential(e){return Xl._fromParams({providerId:la.PROVIDER_ID,signInMethod:la.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return la.credentialFromTaggedObject(e)}static credentialFromError(e){return la.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return la.credential(e.oauthAccessToken)}catch{return null}}}la.FACEBOOK_SIGN_IN_METHOD="facebook.com";la.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ca extends mp{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Xl._fromParams({providerId:ca.PROVIDER_ID,signInMethod:ca.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return ca.credentialFromTaggedObject(e)}static credentialFromError(e){return ca.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return ca.credential(t,r)}catch{return null}}}ca.GOOGLE_SIGN_IN_METHOD="google.com";ca.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ua extends mp{constructor(){super("github.com")}static credential(e){return Xl._fromParams({providerId:ua.PROVIDER_ID,signInMethod:ua.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ua.credentialFromTaggedObject(e)}static credentialFromError(e){return ua.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ua.credential(e.oauthAccessToken)}catch{return null}}}ua.GITHUB_SIGN_IN_METHOD="github.com";ua.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ha extends mp{constructor(){super("twitter.com")}static credential(e,t){return Xl._fromParams({providerId:ha.PROVIDER_ID,signInMethod:ha.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return ha.credentialFromTaggedObject(e)}static credentialFromError(e){return ha.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return ha.credential(t,r)}catch{return null}}}ha.TWITTER_SIGN_IN_METHOD="twitter.com";ha.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function R7(n,e){return gp(n,"POST","/v1/accounts:signUp",Fa(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yl{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,i=!1){const s=await wi._fromIdTokenResponse(e,r,i),o=$C(r);return new Yl({user:s,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const i=$C(r);return new Yl({user:e,providerId:i,_tokenResponse:r,operationType:t})}}function $C(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class My extends po{constructor(e,t,r,i){super(t.code,t.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,My.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,i){return new My(e,t,r,i)}}function VN(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?My._fromErrorAndOperation(n,s,e,r):s})}async function C7(n,e,t=!1){const r=await Ld(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Yl._forOperation(n,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function I7(n,e,t=!1){const{auth:r}=n;if(Jr(r.app))return Promise.reject(Ks(r));const i="reauthenticate";try{const s=await Ld(n,VN(r,i,e,n),t);ze(s.idToken,r,"internal-error");const o=sE(s.idToken);ze(o,r,"internal-error");const{sub:a}=o;return ze(n.uid===a,r,"user-mismatch"),Yl._forOperation(n,i,s)}catch(s){throw s?.code==="auth/user-not-found"&&Ri(r,"user-mismatch"),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function FN(n,e,t=!1){if(Jr(n.app))return Promise.reject(Ks(n));const r="signIn",i=await VN(n,r,e),s=await Yl._fromIdTokenResponse(n,r,i);return t||await n._updateCurrentUser(s.user),s}async function P7(n,e){return FN(ic(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BN(n){const e=ic(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function M7(n,e,t){if(Jr(n.app))return Promise.reject(Ks(n));const r=ic(n),o=await uw(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",R7).catch(u=>{throw u.code==="auth/password-does-not-meet-requirements"&&BN(n),u}),a=await Yl._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function O7(n,e,t){return Jr(n.app)?Promise.reject(Ks(n)):P7(wr(n),_h.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&BN(n),r})}function k7(n,e,t,r){return wr(n).onIdTokenChanged(e,t,r)}function N7(n,e,t){return wr(n).beforeAuthStateChanged(e,t)}function cE(n,e,t,r){return wr(n).onAuthStateChanged(e,t,r)}function D7(n){return wr(n).signOut()}async function L7(n){return wr(n).delete()}const Oy="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zN{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Oy,"1"),this.storage.removeItem(Oy),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U7=1e3,V7=10;class jN extends zN{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=ON(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),i=this.localCache[t];r!==i&&e(t,i,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,u)=>{this.notifyListeners(o,u)});return}const r=e.key;t?this.detachListener():this.stopPolling();const i=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},s=this.storage.getItem(r);t7()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,V7):i()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},U7)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}jN.type="LOCAL";const F7=jN;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HN extends zN{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}HN.type="SESSION";const $N=HN;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B7(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P_{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(i=>i.isListeningto(e));if(t)return t;const r=new P_(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:i,data:s}=t.data,o=this.handlersMap[i];if(!o?.size)return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const a=Array.from(o).map(async h=>h(t.origin,s)),u=await B7(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:u})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}P_.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uE(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z7{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,o;return new Promise((a,u)=>{const h=uE("",20);i.port1.start();const d=setTimeout(()=>{u(new Error("unsupported_event"))},r);o={messageChannel:i,onMessage(g){const y=g;if(y.data.eventId===h)switch(y.data.status){case"ack":clearTimeout(d),s=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),a(y.data.response);break;default:clearTimeout(d),clearTimeout(s),u(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:h,data:t},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rs(){return window}function j7(n){rs().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WN(){return typeof rs().WorkerGlobalScope<"u"&&typeof rs().importScripts=="function"}async function H7(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function $7(){return navigator?.serviceWorker?.controller||null}function W7(){return WN()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qN="firebaseLocalStorageDb",q7=1,ky="firebaseLocalStorage",XN="fbase_key";class yp{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function M_(n,e){return n.transaction([ky],e?"readwrite":"readonly").objectStore(ky)}function X7(){const n=indexedDB.deleteDatabase(qN);return new yp(n).toPromise()}function hw(){const n=indexedDB.open(qN,q7);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(ky,{keyPath:XN})}catch(i){t(i)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(ky)?e(r):(r.close(),await X7(),e(await hw()))})})}async function WC(n,e,t){const r=M_(n,!0).put({[XN]:e,value:t});return new yp(r).toPromise()}async function Y7(n,e){const t=M_(n,!1).get(e),r=await new yp(t).toPromise();return r===void 0?null:r.value}function qC(n,e){const t=M_(n,!0).delete(e);return new yp(t).toPromise()}const K7=800,G7=3;class YN{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await hw(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>G7)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return WN()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=P_._getInstance(W7()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await H7(),!this.activeServiceWorker)return;this.sender=new z7(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||$7()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await hw();return await WC(e,Oy,"1"),await qC(e,Oy),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>WC(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>Y7(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>qC(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const s=M_(i,!1).getAll();return new yp(s).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:i,value:s}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(s)&&(this.notifyListeners(i,s),t.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),t.push(i));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),K7)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}YN.type="LOCAL";const Z7=YN;new pp(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Q7(n,e){return e?qs(e):(ze(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hE extends aE{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Uu(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Uu(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Uu(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function J7(n){return FN(n.auth,new hE(n),n.bypassAuthState)}function eH(n){const{auth:e,user:t}=n;return ze(t,e,"internal-error"),I7(t,new hE(n),n.bypassAuthState)}async function tH(n){const{auth:e,user:t}=n;return ze(t,e,"internal-error"),C7(t,new hE(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KN{constructor(e,t,r,i,s=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:i,tenantId:s,error:o,type:a}=e;if(o){this.reject(o);return}const u={auth:this.auth,requestUri:t,sessionId:r,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(u))}catch(h){this.reject(h)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return J7;case"linkViaPopup":case"linkViaRedirect":return tH;case"reauthViaPopup":case"reauthViaRedirect":return eH;default:Ri(this.auth,"internal-error")}}resolve(e){eo(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){eo(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nH=new pp(2e3,1e4);class _u extends KN{constructor(e,t,r,i,s){super(e,t,i,s),this.provider=r,this.authWindow=null,this.pollId=null,_u.currentPopupAction&&_u.currentPopupAction.cancel(),_u.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ze(e,this.auth,"internal-error"),e}async onExecution(){eo(this.filter.length===1,"Popup operations only handle one event");const e=uE();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(ns(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(ns(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,_u.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(ns(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,nH.get())};e()}}_u.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rH="pendingRedirect",Km=new Map;class iH extends KN{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=Km.get(this.auth._key());if(!e){try{const r=await sH(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Km.set(this.auth._key(),e)}return this.bypassAuthState||Km.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function sH(n,e){const t=lH(e),r=aH(n);if(!await r._isAvailable())return!1;const i=await r._get(t)==="true";return await r._remove(t),i}function oH(n,e){Km.set(n._key(),e)}function aH(n){return qs(n._redirectPersistence)}function lH(n){return Ym(rH,n.config.apiKey,n.name)}async function cH(n,e,t=!1){if(Jr(n.app))return Promise.reject(Ks(n));const r=ic(n),i=Q7(r,e),o=await new iH(r,i,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uH=600*1e3;class hH{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!fH(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!GN(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";t.onError(ns(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=uH&&this.cachedEventUids.clear(),this.cachedEventUids.has(XC(e))}saveEventToCache(e){this.cachedEventUids.add(XC(e)),this.lastProcessedEventTime=Date.now()}}function XC(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function GN({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function fH(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return GN(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dH(n,e={}){return Ba(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pH=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,gH=/^https?/;async function mH(n){if(n.config.emulator)return;const{authorizedDomains:e}=await dH(n);for(const t of e)try{if(yH(t))return}catch{}Ri(n,"unauthorized-domain")}function yH(n){const e=lw(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!gH.test(t))return!1;if(pH.test(n))return r===n;const i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _H=new pp(3e4,6e4);function YC(){const n=rs().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function vH(n){return new Promise((e,t)=>{function r(){YC(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{YC(),t(ns(n,"network-request-failed"))},timeout:_H.get()})}if(rs().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(rs().gapi?.load)r();else{const i=u7("iframefcb");return rs()[i]=()=>{gapi.load?r():t(ns(n,"network-request-failed"))},NN(`${c7()}?onload=${i}`).catch(s=>t(s))}}).catch(e=>{throw Gm=null,e})}let Gm=null;function bH(n){return Gm=Gm||vH(n),Gm}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TH=new pp(5e3,15e3),wH="__/auth/iframe",xH="emulator/auth/iframe",EH={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},AH=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function SH(n){const e=n.config;ze(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?iE(e,xH):`https://${n.config.authDomain}/${wH}`,r={apiKey:e.apiKey,appName:n.name,v:yh},i=AH.get(n.config.apiHost);i&&(r.eid=i);const s=n._getFrameworks();return s.length&&(r.fw=s.join(",")),`${t}?${dp(r).slice(1)}`}async function RH(n){const e=await bH(n),t=rs().gapi;return ze(t,n,"internal-error"),e.open({where:document.body,url:SH(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:EH,dontclear:!0},r=>new Promise(async(i,s)=>{await r.restyle({setHideOnLeave:!1});const o=ns(n,"network-request-failed"),a=rs().setTimeout(()=>{s(o)},TH.get());function u(){rs().clearTimeout(a),i(r)}r.ping(u).then(u,()=>{s(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CH={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},IH=500,PH=600,MH="_blank",OH="http://localhost";class KC{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function kH(n,e,t,r=IH,i=PH){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const u={...CH,width:r.toString(),height:i.toString(),top:s,left:o},h=rr().toLowerCase();t&&(a=RN(h)?MH:t),AN(h)&&(e=e||OH,u.scrollbars="yes");const d=Object.entries(u).reduce((y,[v,T])=>`${y}${v}=${T},`,"");if(e7(h)&&a!=="_self")return NH(e||"",a),new KC(null);const g=window.open(e||"",a,d);ze(g,n,"popup-blocked");try{g.focus()}catch{}return new KC(g)}function NH(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DH="__/auth/handler",LH="emulator/auth/handler",UH=encodeURIComponent("fac");async function GC(n,e,t,r,i,s){ze(n.config.authDomain,n,"auth-domain-config-required"),ze(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:yh,eventId:i};if(e instanceof UN){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",w9(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[d,g]of Object.entries({}))o[d]=g}if(e instanceof mp){const d=e.getScopes().filter(g=>g!=="");d.length>0&&(o.scopes=d.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const d of Object.keys(a))a[d]===void 0&&delete a[d];const u=await n._getAppCheckToken(),h=u?`#${UH}=${encodeURIComponent(u)}`:"";return`${VH(n)}?${dp(a).slice(1)}${h}`}function VH({config:n}){return n.emulator?iE(n,LH):`https://${n.authDomain}/${DH}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O0="webStorageSupport";class FH{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=$N,this._completeRedirectFn=cH,this._overrideRedirectResult=oH}async _openPopup(e,t,r,i){eo(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const s=await GC(e,t,r,lw(),i);return kH(e,s,uE())}async _openRedirect(e,t,r,i){await this._originValidation(e);const s=await GC(e,t,r,lw(),i);return j7(s),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:i,promise:s}=this.eventManagers[t];return i?Promise.resolve(i):(eo(s,"If manager is not set, promise should be"),s)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await RH(e),r=new hH(e);return t.register("authEvent",i=>(ze(i?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(O0,{type:O0},i=>{const s=i?.[0]?.[O0];s!==void 0&&t(!!s),Ri(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=mH(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return ON()||SN()||oE()}}const BH=FH;var ZC="@firebase/auth",QC="1.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zH{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){ze(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jH(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function HH(n){Wu(new ql("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;ze(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const u={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:kN(n)},h=new o7(r,i,s,u);return m7(h,t),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Wu(new ql("auth-internal",e=>{const t=ic(e.getProvider("auth").getImmediate());return(r=>new zH(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),ba(ZC,QC,jH(n)),ba(ZC,QC,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $H=300,WH=lN("authIdTokenMaxAge")||$H;let JC=null;const qH=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>WH)return;const i=t?.token;JC!==i&&(JC=i,await fetch(n,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function XH(n=pN()){const e=nE(n,"auth");if(e.isInitialized())return e.getImmediate();const t=g7(n,{popupRedirectResolver:BH,persistence:[Z7,F7,$N]}),r=lN("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const s=new URL(r,location.origin);if(location.origin===s.origin){const o=qH(s.toString());N7(t,o,()=>o(t.currentUser)),k7(t,a=>o(a))}}const i=oN("auth");return i&&y7(t,`http://${i}`),t}function YH(){return document.getElementsByTagName("head")?.[0]??document}a7({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{const s=ns("internal-error");s.customData=i,t(s)},r.type="text/javascript",r.charset="UTF-8",YH().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});HH("Browser");var KH="firebase",GH="12.3.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ba(KH,GH,"app");var e3=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Ta,ZN;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(k,M){function N(){}N.prototype=M.prototype,k.F=M.prototype,k.prototype=new N,k.prototype.constructor=k,k.D=function(H,q,K){for(var j=Array(arguments.length-2),de=2;de<arguments.length;de++)j[de-2]=arguments[de];return M.prototype[q].apply(H,j)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(k,M,N){N||(N=0);const H=Array(16);if(typeof M=="string")for(var q=0;q<16;++q)H[q]=M.charCodeAt(N++)|M.charCodeAt(N++)<<8|M.charCodeAt(N++)<<16|M.charCodeAt(N++)<<24;else for(q=0;q<16;++q)H[q]=M[N++]|M[N++]<<8|M[N++]<<16|M[N++]<<24;M=k.g[0],N=k.g[1],q=k.g[2];let K=k.g[3],j;j=M+(K^N&(q^K))+H[0]+3614090360&4294967295,M=N+(j<<7&4294967295|j>>>25),j=K+(q^M&(N^q))+H[1]+3905402710&4294967295,K=M+(j<<12&4294967295|j>>>20),j=q+(N^K&(M^N))+H[2]+606105819&4294967295,q=K+(j<<17&4294967295|j>>>15),j=N+(M^q&(K^M))+H[3]+3250441966&4294967295,N=q+(j<<22&4294967295|j>>>10),j=M+(K^N&(q^K))+H[4]+4118548399&4294967295,M=N+(j<<7&4294967295|j>>>25),j=K+(q^M&(N^q))+H[5]+1200080426&4294967295,K=M+(j<<12&4294967295|j>>>20),j=q+(N^K&(M^N))+H[6]+2821735955&4294967295,q=K+(j<<17&4294967295|j>>>15),j=N+(M^q&(K^M))+H[7]+4249261313&4294967295,N=q+(j<<22&4294967295|j>>>10),j=M+(K^N&(q^K))+H[8]+1770035416&4294967295,M=N+(j<<7&4294967295|j>>>25),j=K+(q^M&(N^q))+H[9]+2336552879&4294967295,K=M+(j<<12&4294967295|j>>>20),j=q+(N^K&(M^N))+H[10]+4294925233&4294967295,q=K+(j<<17&4294967295|j>>>15),j=N+(M^q&(K^M))+H[11]+2304563134&4294967295,N=q+(j<<22&4294967295|j>>>10),j=M+(K^N&(q^K))+H[12]+1804603682&4294967295,M=N+(j<<7&4294967295|j>>>25),j=K+(q^M&(N^q))+H[13]+4254626195&4294967295,K=M+(j<<12&4294967295|j>>>20),j=q+(N^K&(M^N))+H[14]+2792965006&4294967295,q=K+(j<<17&4294967295|j>>>15),j=N+(M^q&(K^M))+H[15]+1236535329&4294967295,N=q+(j<<22&4294967295|j>>>10),j=M+(q^K&(N^q))+H[1]+4129170786&4294967295,M=N+(j<<5&4294967295|j>>>27),j=K+(N^q&(M^N))+H[6]+3225465664&4294967295,K=M+(j<<9&4294967295|j>>>23),j=q+(M^N&(K^M))+H[11]+643717713&4294967295,q=K+(j<<14&4294967295|j>>>18),j=N+(K^M&(q^K))+H[0]+3921069994&4294967295,N=q+(j<<20&4294967295|j>>>12),j=M+(q^K&(N^q))+H[5]+3593408605&4294967295,M=N+(j<<5&4294967295|j>>>27),j=K+(N^q&(M^N))+H[10]+38016083&4294967295,K=M+(j<<9&4294967295|j>>>23),j=q+(M^N&(K^M))+H[15]+3634488961&4294967295,q=K+(j<<14&4294967295|j>>>18),j=N+(K^M&(q^K))+H[4]+3889429448&4294967295,N=q+(j<<20&4294967295|j>>>12),j=M+(q^K&(N^q))+H[9]+568446438&4294967295,M=N+(j<<5&4294967295|j>>>27),j=K+(N^q&(M^N))+H[14]+3275163606&4294967295,K=M+(j<<9&4294967295|j>>>23),j=q+(M^N&(K^M))+H[3]+4107603335&4294967295,q=K+(j<<14&4294967295|j>>>18),j=N+(K^M&(q^K))+H[8]+1163531501&4294967295,N=q+(j<<20&4294967295|j>>>12),j=M+(q^K&(N^q))+H[13]+2850285829&4294967295,M=N+(j<<5&4294967295|j>>>27),j=K+(N^q&(M^N))+H[2]+4243563512&4294967295,K=M+(j<<9&4294967295|j>>>23),j=q+(M^N&(K^M))+H[7]+1735328473&4294967295,q=K+(j<<14&4294967295|j>>>18),j=N+(K^M&(q^K))+H[12]+2368359562&4294967295,N=q+(j<<20&4294967295|j>>>12),j=M+(N^q^K)+H[5]+4294588738&4294967295,M=N+(j<<4&4294967295|j>>>28),j=K+(M^N^q)+H[8]+2272392833&4294967295,K=M+(j<<11&4294967295|j>>>21),j=q+(K^M^N)+H[11]+1839030562&4294967295,q=K+(j<<16&4294967295|j>>>16),j=N+(q^K^M)+H[14]+4259657740&4294967295,N=q+(j<<23&4294967295|j>>>9),j=M+(N^q^K)+H[1]+2763975236&4294967295,M=N+(j<<4&4294967295|j>>>28),j=K+(M^N^q)+H[4]+1272893353&4294967295,K=M+(j<<11&4294967295|j>>>21),j=q+(K^M^N)+H[7]+4139469664&4294967295,q=K+(j<<16&4294967295|j>>>16),j=N+(q^K^M)+H[10]+3200236656&4294967295,N=q+(j<<23&4294967295|j>>>9),j=M+(N^q^K)+H[13]+681279174&4294967295,M=N+(j<<4&4294967295|j>>>28),j=K+(M^N^q)+H[0]+3936430074&4294967295,K=M+(j<<11&4294967295|j>>>21),j=q+(K^M^N)+H[3]+3572445317&4294967295,q=K+(j<<16&4294967295|j>>>16),j=N+(q^K^M)+H[6]+76029189&4294967295,N=q+(j<<23&4294967295|j>>>9),j=M+(N^q^K)+H[9]+3654602809&4294967295,M=N+(j<<4&4294967295|j>>>28),j=K+(M^N^q)+H[12]+3873151461&4294967295,K=M+(j<<11&4294967295|j>>>21),j=q+(K^M^N)+H[15]+530742520&4294967295,q=K+(j<<16&4294967295|j>>>16),j=N+(q^K^M)+H[2]+3299628645&4294967295,N=q+(j<<23&4294967295|j>>>9),j=M+(q^(N|~K))+H[0]+4096336452&4294967295,M=N+(j<<6&4294967295|j>>>26),j=K+(N^(M|~q))+H[7]+1126891415&4294967295,K=M+(j<<10&4294967295|j>>>22),j=q+(M^(K|~N))+H[14]+2878612391&4294967295,q=K+(j<<15&4294967295|j>>>17),j=N+(K^(q|~M))+H[5]+4237533241&4294967295,N=q+(j<<21&4294967295|j>>>11),j=M+(q^(N|~K))+H[12]+1700485571&4294967295,M=N+(j<<6&4294967295|j>>>26),j=K+(N^(M|~q))+H[3]+2399980690&4294967295,K=M+(j<<10&4294967295|j>>>22),j=q+(M^(K|~N))+H[10]+4293915773&4294967295,q=K+(j<<15&4294967295|j>>>17),j=N+(K^(q|~M))+H[1]+2240044497&4294967295,N=q+(j<<21&4294967295|j>>>11),j=M+(q^(N|~K))+H[8]+1873313359&4294967295,M=N+(j<<6&4294967295|j>>>26),j=K+(N^(M|~q))+H[15]+4264355552&4294967295,K=M+(j<<10&4294967295|j>>>22),j=q+(M^(K|~N))+H[6]+2734768916&4294967295,q=K+(j<<15&4294967295|j>>>17),j=N+(K^(q|~M))+H[13]+1309151649&4294967295,N=q+(j<<21&4294967295|j>>>11),j=M+(q^(N|~K))+H[4]+4149444226&4294967295,M=N+(j<<6&4294967295|j>>>26),j=K+(N^(M|~q))+H[11]+3174756917&4294967295,K=M+(j<<10&4294967295|j>>>22),j=q+(M^(K|~N))+H[2]+718787259&4294967295,q=K+(j<<15&4294967295|j>>>17),j=N+(K^(q|~M))+H[9]+3951481745&4294967295,k.g[0]=k.g[0]+M&4294967295,k.g[1]=k.g[1]+(q+(j<<21&4294967295|j>>>11))&4294967295,k.g[2]=k.g[2]+q&4294967295,k.g[3]=k.g[3]+K&4294967295}r.prototype.v=function(k,M){M===void 0&&(M=k.length);const N=M-this.blockSize,H=this.C;let q=this.h,K=0;for(;K<M;){if(q==0)for(;K<=N;)i(this,k,K),K+=this.blockSize;if(typeof k=="string"){for(;K<M;)if(H[q++]=k.charCodeAt(K++),q==this.blockSize){i(this,H),q=0;break}}else for(;K<M;)if(H[q++]=k[K++],q==this.blockSize){i(this,H),q=0;break}}this.h=q,this.o+=M},r.prototype.A=function(){var k=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);k[0]=128;for(var M=1;M<k.length-8;++M)k[M]=0;M=this.o*8;for(var N=k.length-8;N<k.length;++N)k[N]=M&255,M/=256;for(this.v(k),k=Array(16),M=0,N=0;N<4;++N)for(let H=0;H<32;H+=8)k[M++]=this.g[N]>>>H&255;return k};function s(k,M){var N=a;return Object.prototype.hasOwnProperty.call(N,k)?N[k]:N[k]=M(k)}function o(k,M){this.h=M;const N=[];let H=!0;for(let q=k.length-1;q>=0;q--){const K=k[q]|0;H&&K==M||(N[q]=K,H=!1)}this.g=N}var a={};function u(k){return-128<=k&&k<128?s(k,function(M){return new o([M|0],M<0?-1:0)}):new o([k|0],k<0?-1:0)}function h(k){if(isNaN(k)||!isFinite(k))return g;if(k<0)return E(h(-k));const M=[];let N=1;for(let H=0;k>=N;H++)M[H]=k/N|0,N*=4294967296;return new o(M,0)}function d(k,M){if(k.length==0)throw Error("number format error: empty string");if(M=M||10,M<2||36<M)throw Error("radix out of range: "+M);if(k.charAt(0)=="-")return E(d(k.substring(1),M));if(k.indexOf("-")>=0)throw Error('number format error: interior "-" character');const N=h(Math.pow(M,8));let H=g;for(let K=0;K<k.length;K+=8){var q=Math.min(8,k.length-K);const j=parseInt(k.substring(K,K+q),M);q<8?(q=h(Math.pow(M,q)),H=H.j(q).add(h(j))):(H=H.j(N),H=H.add(h(j)))}return H}var g=u(0),y=u(1),v=u(16777216);n=o.prototype,n.m=function(){if(w(this))return-E(this).m();let k=0,M=1;for(let N=0;N<this.g.length;N++){const H=this.i(N);k+=(H>=0?H:4294967296+H)*M,M*=4294967296}return k},n.toString=function(k){if(k=k||10,k<2||36<k)throw Error("radix out of range: "+k);if(T(this))return"0";if(w(this))return"-"+E(this).toString(k);const M=h(Math.pow(k,6));var N=this;let H="";for(;;){const q=L(N,M).g;N=S(N,q.j(M));let K=((N.g.length>0?N.g[0]:N.h)>>>0).toString(k);if(N=q,T(N))return K+H;for(;K.length<6;)K="0"+K;H=K+H}},n.i=function(k){return k<0?0:k<this.g.length?this.g[k]:this.h};function T(k){if(k.h!=0)return!1;for(let M=0;M<k.g.length;M++)if(k.g[M]!=0)return!1;return!0}function w(k){return k.h==-1}n.l=function(k){return k=S(this,k),w(k)?-1:T(k)?0:1};function E(k){const M=k.g.length,N=[];for(let H=0;H<M;H++)N[H]=~k.g[H];return new o(N,~k.h).add(y)}n.abs=function(){return w(this)?E(this):this},n.add=function(k){const M=Math.max(this.g.length,k.g.length),N=[];let H=0;for(let q=0;q<=M;q++){let K=H+(this.i(q)&65535)+(k.i(q)&65535),j=(K>>>16)+(this.i(q)>>>16)+(k.i(q)>>>16);H=j>>>16,K&=65535,j&=65535,N[q]=j<<16|K}return new o(N,N[N.length-1]&-2147483648?-1:0)};function S(k,M){return k.add(E(M))}n.j=function(k){if(T(this)||T(k))return g;if(w(this))return w(k)?E(this).j(E(k)):E(E(this).j(k));if(w(k))return E(this.j(E(k)));if(this.l(v)<0&&k.l(v)<0)return h(this.m()*k.m());const M=this.g.length+k.g.length,N=[];for(var H=0;H<2*M;H++)N[H]=0;for(H=0;H<this.g.length;H++)for(let q=0;q<k.g.length;q++){const K=this.i(H)>>>16,j=this.i(H)&65535,de=k.i(q)>>>16,Ee=k.i(q)&65535;N[2*H+2*q]+=j*Ee,P(N,2*H+2*q),N[2*H+2*q+1]+=K*Ee,P(N,2*H+2*q+1),N[2*H+2*q+1]+=j*de,P(N,2*H+2*q+1),N[2*H+2*q+2]+=K*de,P(N,2*H+2*q+2)}for(k=0;k<M;k++)N[k]=N[2*k+1]<<16|N[2*k];for(k=M;k<2*M;k++)N[k]=0;return new o(N,0)};function P(k,M){for(;(k[M]&65535)!=k[M];)k[M+1]+=k[M]>>>16,k[M]&=65535,M++}function I(k,M){this.g=k,this.h=M}function L(k,M){if(T(M))throw Error("division by zero");if(T(k))return new I(g,g);if(w(k))return M=L(E(k),M),new I(E(M.g),E(M.h));if(w(M))return M=L(k,E(M)),new I(E(M.g),M.h);if(k.g.length>30){if(w(k)||w(M))throw Error("slowDivide_ only works with positive integers.");for(var N=y,H=M;H.l(k)<=0;)N=F(N),H=F(H);var q=Y(N,1),K=Y(H,1);for(H=Y(H,2),N=Y(N,2);!T(H);){var j=K.add(H);j.l(k)<=0&&(q=q.add(N),K=j),H=Y(H,1),N=Y(N,1)}return M=S(k,q.j(M)),new I(q,M)}for(q=g;k.l(M)>=0;){for(N=Math.max(1,Math.floor(k.m()/M.m())),H=Math.ceil(Math.log(N)/Math.LN2),H=H<=48?1:Math.pow(2,H-48),K=h(N),j=K.j(M);w(j)||j.l(k)>0;)N-=H,K=h(N),j=K.j(M);T(K)&&(K=y),q=q.add(K),k=S(k,j)}return new I(q,k)}n.B=function(k){return L(this,k).h},n.and=function(k){const M=Math.max(this.g.length,k.g.length),N=[];for(let H=0;H<M;H++)N[H]=this.i(H)&k.i(H);return new o(N,this.h&k.h)},n.or=function(k){const M=Math.max(this.g.length,k.g.length),N=[];for(let H=0;H<M;H++)N[H]=this.i(H)|k.i(H);return new o(N,this.h|k.h)},n.xor=function(k){const M=Math.max(this.g.length,k.g.length),N=[];for(let H=0;H<M;H++)N[H]=this.i(H)^k.i(H);return new o(N,this.h^k.h)};function F(k){const M=k.g.length+1,N=[];for(let H=0;H<M;H++)N[H]=k.i(H)<<1|k.i(H-1)>>>31;return new o(N,k.h)}function Y(k,M){const N=M>>5;M%=32;const H=k.g.length-N,q=[];for(let K=0;K<H;K++)q[K]=M>0?k.i(K+N)>>>M|k.i(K+N+1)<<32-M:k.i(K+N);return new o(q,k.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,ZN=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.B,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=h,o.fromString=d,Ta=o}).apply(typeof e3<"u"?e3:typeof self<"u"?self:typeof window<"u"?window:{});var nm=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var QN,td,JN,Zm,fw,eD,tD,nD;(function(){var n,e=Object.defineProperty;function t(m){m=[typeof globalThis=="object"&&globalThis,m,typeof window=="object"&&window,typeof self=="object"&&self,typeof nm=="object"&&nm];for(var x=0;x<m.length;++x){var R=m[x];if(R&&R.Math==Math)return R}throw Error("Cannot find global object")}var r=t(this);function i(m,x){if(x)e:{var R=r;m=m.split(".");for(var B=0;B<m.length-1;B++){var ce=m[B];if(!(ce in R))break e;R=R[ce]}m=m[m.length-1],B=R[m],x=x(B),x!=B&&x!=null&&e(R,m,{configurable:!0,writable:!0,value:x})}}i("Symbol.dispose",function(m){return m||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(m){return m||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(m){return m||function(x){var R=[],B;for(B in x)Object.prototype.hasOwnProperty.call(x,B)&&R.push([B,x[B]]);return R}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var s=s||{},o=this||self;function a(m){var x=typeof m;return x=="object"&&m!=null||x=="function"}function u(m,x,R){return m.call.apply(m.bind,arguments)}function h(m,x,R){return h=u,h.apply(null,arguments)}function d(m,x){var R=Array.prototype.slice.call(arguments,1);return function(){var B=R.slice();return B.push.apply(B,arguments),m.apply(this,B)}}function g(m,x){function R(){}R.prototype=x.prototype,m.Z=x.prototype,m.prototype=new R,m.prototype.constructor=m,m.Ob=function(B,ce,pe){for(var Ae=Array(arguments.length-2),qe=2;qe<arguments.length;qe++)Ae[qe-2]=arguments[qe];return x.prototype[ce].apply(B,Ae)}}var y=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?m=>m&&AsyncContext.Snapshot.wrap(m):m=>m;function v(m){const x=m.length;if(x>0){const R=Array(x);for(let B=0;B<x;B++)R[B]=m[B];return R}return[]}function T(m,x){for(let B=1;B<arguments.length;B++){const ce=arguments[B];var R=typeof ce;if(R=R!="object"?R:ce?Array.isArray(ce)?"array":R:"null",R=="array"||R=="object"&&typeof ce.length=="number"){R=m.length||0;const pe=ce.length||0;m.length=R+pe;for(let Ae=0;Ae<pe;Ae++)m[R+Ae]=ce[Ae]}else m.push(ce)}}class w{constructor(x,R){this.i=x,this.j=R,this.h=0,this.g=null}get(){let x;return this.h>0?(this.h--,x=this.g,this.g=x.next,x.next=null):x=this.i(),x}}function E(m){o.setTimeout(()=>{throw m},0)}function S(){var m=k;let x=null;return m.g&&(x=m.g,m.g=m.g.next,m.g||(m.h=null),x.next=null),x}class P{constructor(){this.h=this.g=null}add(x,R){const B=I.get();B.set(x,R),this.h?this.h.next=B:this.g=B,this.h=B}}var I=new w(()=>new L,m=>m.reset());class L{constructor(){this.next=this.g=this.h=null}set(x,R){this.h=x,this.g=R,this.next=null}reset(){this.next=this.g=this.h=null}}let F,Y=!1,k=new P,M=()=>{const m=Promise.resolve(void 0);F=()=>{m.then(N)}};function N(){for(var m;m=S();){try{m.h.call(m.g)}catch(R){E(R)}var x=I;x.j(m),x.h<100&&(x.h++,m.next=x.g,x.g=m)}Y=!1}function H(){this.u=this.u,this.C=this.C}H.prototype.u=!1,H.prototype.dispose=function(){this.u||(this.u=!0,this.N())},H.prototype[Symbol.dispose]=function(){this.dispose()},H.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function q(m,x){this.type=m,this.g=this.target=x,this.defaultPrevented=!1}q.prototype.h=function(){this.defaultPrevented=!0};var K=(function(){if(!o.addEventListener||!Object.defineProperty)return!1;var m=!1,x=Object.defineProperty({},"passive",{get:function(){m=!0}});try{const R=()=>{};o.addEventListener("test",R,x),o.removeEventListener("test",R,x)}catch{}return m})();function j(m){return/^[\s\xa0]*$/.test(m)}function de(m,x){q.call(this,m?m.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,m&&this.init(m,x)}g(de,q),de.prototype.init=function(m,x){const R=this.type=m.type,B=m.changedTouches&&m.changedTouches.length?m.changedTouches[0]:null;this.target=m.target||m.srcElement,this.g=x,x=m.relatedTarget,x||(R=="mouseover"?x=m.fromElement:R=="mouseout"&&(x=m.toElement)),this.relatedTarget=x,B?(this.clientX=B.clientX!==void 0?B.clientX:B.pageX,this.clientY=B.clientY!==void 0?B.clientY:B.pageY,this.screenX=B.screenX||0,this.screenY=B.screenY||0):(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0),this.button=m.button,this.key=m.key||"",this.ctrlKey=m.ctrlKey,this.altKey=m.altKey,this.shiftKey=m.shiftKey,this.metaKey=m.metaKey,this.pointerId=m.pointerId||0,this.pointerType=m.pointerType,this.state=m.state,this.i=m,m.defaultPrevented&&de.Z.h.call(this)},de.prototype.h=function(){de.Z.h.call(this);const m=this.i;m.preventDefault?m.preventDefault():m.returnValue=!1};var Ee="closure_listenable_"+(Math.random()*1e6|0),O=0;function W(m,x,R,B,ce){this.listener=m,this.proxy=null,this.src=x,this.type=R,this.capture=!!B,this.ha=ce,this.key=++O,this.da=this.fa=!1}function U(m){m.da=!0,m.listener=null,m.proxy=null,m.src=null,m.ha=null}function ie(m,x,R){for(const B in m)x.call(R,m[B],B,m)}function V(m,x){for(const R in m)x.call(void 0,m[R],R,m)}function Z(m){const x={};for(const R in m)x[R]=m[R];return x}const se="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ae(m,x){let R,B;for(let ce=1;ce<arguments.length;ce++){B=arguments[ce];for(R in B)m[R]=B[R];for(let pe=0;pe<se.length;pe++)R=se[pe],Object.prototype.hasOwnProperty.call(B,R)&&(m[R]=B[R])}}function me(m){this.src=m,this.g={},this.h=0}me.prototype.add=function(m,x,R,B,ce){const pe=m.toString();m=this.g[pe],m||(m=this.g[pe]=[],this.h++);const Ae=Se(m,x,B,ce);return Ae>-1?(x=m[Ae],R||(x.fa=!1)):(x=new W(x,this.src,pe,!!B,ce),x.fa=R,m.push(x)),x};function xe(m,x){const R=x.type;if(R in m.g){var B=m.g[R],ce=Array.prototype.indexOf.call(B,x,void 0),pe;(pe=ce>=0)&&Array.prototype.splice.call(B,ce,1),pe&&(U(x),m.g[R].length==0&&(delete m.g[R],m.h--))}}function Se(m,x,R,B){for(let ce=0;ce<m.length;++ce){const pe=m[ce];if(!pe.da&&pe.listener==x&&pe.capture==!!R&&pe.ha==B)return ce}return-1}var Ce="closure_lm_"+(Math.random()*1e6|0),Me={};function lt(m,x,R,B,ce){if(Array.isArray(x)){for(let pe=0;pe<x.length;pe++)lt(m,x[pe],R,B,ce);return null}return R=Dp(R),m&&m[Ee]?m.J(x,R,a(B)?!!B.capture:!1,ce):Ge(m,x,R,!1,B,ce)}function Ge(m,x,R,B,ce,pe){if(!x)throw Error("Invalid event type");const Ae=a(ce)?!!ce.capture:!!ce;let qe=nt(m);if(qe||(m[Ce]=qe=new me(m)),R=qe.add(x,R,B,Ae,pe),R.proxy)return R;if(B=xn(),R.proxy=B,B.src=m,B.listener=R,m.addEventListener)K||(ce=Ae),ce===void 0&&(ce=!1),m.addEventListener(x.toString(),B,ce);else if(m.attachEvent)m.attachEvent(_s(x.toString()),B);else if(m.addListener&&m.removeListener)m.addListener(B);else throw Error("addEventListener and attachEvent are unavailable.");return R}function xn(){function m(R){return x.call(m.src,m.listener,R)}const x=ct;return m}function fn(m,x,R,B,ce){if(Array.isArray(x))for(var pe=0;pe<x.length;pe++)fn(m,x[pe],R,B,ce);else B=a(B)?!!B.capture:!!B,R=Dp(R),m&&m[Ee]?(m=m.i,pe=String(x).toString(),pe in m.g&&(x=m.g[pe],R=Se(x,R,B,ce),R>-1&&(U(x[R]),Array.prototype.splice.call(x,R,1),x.length==0&&(delete m.g[pe],m.h--)))):m&&(m=nt(m))&&(x=m.g[x.toString()],m=-1,x&&(m=Se(x,R,B,ce)),(R=m>-1?x[m]:null)&&sr(R))}function sr(m){if(typeof m!="number"&&m&&!m.da){var x=m.src;if(x&&x[Ee])xe(x.i,m);else{var R=m.type,B=m.proxy;x.removeEventListener?x.removeEventListener(R,B,m.capture):x.detachEvent?x.detachEvent(_s(R),B):x.addListener&&x.removeListener&&x.removeListener(B),(R=nt(x))?(xe(R,m),R.h==0&&(R.src=null,x[Ce]=null)):U(m)}}}function _s(m){return m in Me?Me[m]:Me[m]="on"+m}function ct(m,x){if(m.da)m=!0;else{x=new de(x,this);const R=m.listener,B=m.ha||m.src;m.fa&&sr(m),m=R.call(B,x)}return m}function nt(m){return m=m[Ce],m instanceof me?m:null}var pr="__closure_events_fn_"+(Math.random()*1e9>>>0);function Dp(m){return typeof m=="function"?m:(m[pr]||(m[pr]=function(x){return m.handleEvent(x)}),m[pr])}function dn(){H.call(this),this.i=new me(this),this.M=this,this.G=null}g(dn,H),dn.prototype[Ee]=!0,dn.prototype.removeEventListener=function(m,x,R,B){fn(this,m,x,R,B)};function En(m,x){var R,B=m.G;if(B)for(R=[];B;B=B.G)R.push(B);if(m=m.M,B=x.type||x,typeof x=="string")x=new q(x,m);else if(x instanceof q)x.target=x.target||m;else{var ce=x;x=new q(B,m),ae(x,ce)}ce=!0;let pe,Ae;if(R)for(Ae=R.length-1;Ae>=0;Ae--)pe=x.g=R[Ae],ce=vs(pe,B,!0,x)&&ce;if(pe=x.g=m,ce=vs(pe,B,!0,x)&&ce,ce=vs(pe,B,!1,x)&&ce,R)for(Ae=0;Ae<R.length;Ae++)pe=x.g=R[Ae],ce=vs(pe,B,!1,x)&&ce}dn.prototype.N=function(){if(dn.Z.N.call(this),this.i){var m=this.i;for(const x in m.g){const R=m.g[x];for(let B=0;B<R.length;B++)U(R[B]);delete m.g[x],m.h--}}this.G=null},dn.prototype.J=function(m,x,R,B){return this.i.add(String(m),x,!1,R,B)},dn.prototype.K=function(m,x,R,B){return this.i.add(String(m),x,!0,R,B)};function vs(m,x,R,B){if(x=m.i.g[String(x)],!x)return!0;x=x.concat();let ce=!0;for(let pe=0;pe<x.length;++pe){const Ae=x[pe];if(Ae&&!Ae.da&&Ae.capture==R){const qe=Ae.listener,Ot=Ae.ha||Ae.src;Ae.fa&&xe(m.i,Ae),ce=qe.call(Ot,B)!==!1&&ce}}return ce&&!B.defaultPrevented}function bv(m,x){if(typeof m!="function")if(m&&typeof m.handleEvent=="function")m=h(m.handleEvent,m);else throw Error("Invalid listener argument");return Number(x)>2147483647?-1:o.setTimeout(m,x||0)}function Uh(m){m.g=bv(()=>{m.g=null,m.i&&(m.i=!1,Uh(m))},m.l);const x=m.h;m.h=null,m.m.apply(null,x)}class Tv extends H{constructor(x,R){super(),this.m=x,this.l=R,this.h=null,this.i=!1,this.g=null}j(x){this.h=arguments,this.g?this.i=!0:Uh(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ha(m){H.call(this),this.h=m,this.g={}}g(Ha,H);var go=[];function $n(m){ie(m.g,function(x,R){this.g.hasOwnProperty(R)&&sr(x)},m),m.g={}}Ha.prototype.N=function(){Ha.Z.N.call(this),$n(this)},Ha.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Fr=o.JSON.stringify,or=o.JSON.parse,wv=class{stringify(m){return o.JSON.stringify(m,void 0)}parse(m){return o.JSON.parse(m,void 0)}};function Lp(){}function Up(){}var ki={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function mo(){q.call(this,"d")}g(mo,q);function ci(){q.call(this,"c")}g(ci,q);var Br={},yo=null;function pc(){return yo=yo||new dn}Br.Ia="serverreachability";function Vh(m){q.call(this,Br.Ia,m)}g(Vh,q);function _o(m){const x=pc();En(x,new Vh(x))}Br.STAT_EVENT="statevent";function gc(m,x){q.call(this,Br.STAT_EVENT,m),this.stat=x}g(gc,q);function Kt(m){const x=pc();En(x,new gc(x,m))}Br.Ja="timingevent";function Vp(m,x){q.call(this,Br.Ja,m),this.size=x}g(Vp,q);function vo(m,x){if(typeof m!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){m()},x)}function bo(){this.g=!0}bo.prototype.ua=function(){this.g=!1};function Fh(m,x,R,B,ce,pe){m.info(function(){if(m.g)if(pe){var Ae="",qe=pe.split("&");for(let yt=0;yt<qe.length;yt++){var Ot=qe[yt].split("=");if(Ot.length>1){const Qt=Ot[0];Ot=Ot[1];const Er=Qt.split("_");Ae=Er.length>=2&&Er[1]=="type"?Ae+(Qt+"="+Ot+"&"):Ae+(Qt+"=redacted&")}}}else Ae=null;else Ae=pe;return"XMLHTTP REQ ("+B+") [attempt "+ce+"]: "+x+`
`+R+`
`+Ae})}function Bh(m,x,R,B,ce,pe,Ae){m.info(function(){return"XMLHTTP RESP ("+B+") [ attempt "+ce+"]: "+x+`
`+R+`
`+pe+" "+Ae})}function bs(m,x,R,B){m.info(function(){return"XMLHTTP TEXT ("+x+"): "+Ni(m,R)+(B?" "+B:"")})}function xv(m,x){m.info(function(){return"TIMEOUT: "+x})}bo.prototype.info=function(){};function Ni(m,x){if(!m.g)return x;if(!x)return null;try{const pe=JSON.parse(x);if(pe){for(m=0;m<pe.length;m++)if(Array.isArray(pe[m])){var R=pe[m];if(!(R.length<2)){var B=R[1];if(Array.isArray(B)&&!(B.length<1)){var ce=B[0];if(ce!="noop"&&ce!="stop"&&ce!="close")for(let Ae=1;Ae<B.length;Ae++)B[Ae]=""}}}}return Fr(pe)}catch{return x}}var Gt={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},kn={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Ts;function $a(){}g($a,Lp),$a.prototype.g=function(){return new XMLHttpRequest},Ts=new $a;function Wa(m){return encodeURIComponent(String(m))}function Ev(m){var x=1;m=m.split(":");const R=[];for(;x>0&&m.length;)R.push(m.shift()),x--;return m.length&&R.push(m.join(":")),R}function ui(m,x,R,B){this.j=m,this.i=x,this.l=R,this.S=B||1,this.V=new Ha(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new To}function To(){this.i=null,this.g="",this.h=!1}var mc={},Di={};function Li(m,x,R){m.M=1,m.A=xs(Ut(x)),m.u=R,m.R=!0,wo(m,null)}function wo(m,x){m.F=Date.now(),qa(m),m.B=Ut(m.A);var R=m.B,B=m.S;Array.isArray(B)||(B=[String(B)]),jp(R.i,"t",B),m.C=0,R=m.j.L,m.h=new To,m.g=Sc(m.j,R?x:null,!m.u),m.P>0&&(m.O=new Tv(h(m.Y,m,m.g),m.P)),x=m.V,R=m.g,B=m.ba;var ce="readystatechange";Array.isArray(ce)||(ce&&(go[0]=ce.toString()),ce=go);for(let pe=0;pe<ce.length;pe++){const Ae=lt(R,ce[pe],B||x.handleEvent,!1,x.h||x);if(!Ae)break;x.g[Ae.key]=Ae}x=m.J?Z(m.J):{},m.u?(m.v||(m.v="POST"),x["Content-Type"]="application/x-www-form-urlencoded",m.g.ea(m.B,m.v,m.u,x)):(m.v="GET",m.g.ea(m.B,m.v,null,x)),_o(),Fh(m.i,m.v,m.B,m.l,m.S,m.u)}ui.prototype.ba=function(m){m=m.target;const x=this.O;x&&Wn(m)==3?x.j():this.Y(m)},ui.prototype.Y=function(m){try{if(m==this.g)e:{const qe=Wn(this.g),Ot=this.g.ya(),yt=this.g.ca();if(!(qe<3)&&(qe!=3||this.g&&(this.h.h||this.g.la()||rl(this.g)))){this.K||qe!=4||Ot==7||(Ot==8||yt<=0?_o(3):_o(2)),Vi(this);var x=this.g.ca();this.X=x;var R=xo(this);if(this.o=x==200,Bh(this.i,this.v,this.B,this.l,this.S,qe,x),this.o){if(this.U&&!this.L){t:{if(this.g){var B,ce=this.g;if((B=ce.g?ce.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!j(B)){var pe=B;break t}}pe=null}if(m=pe)bs(this.i,this.l,m,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,yc(this,m);else{this.o=!1,this.m=3,Kt(12),Fi(this),Xa(this);break e}}if(this.R){m=!0;let Qt;for(;!this.K&&this.C<R.length;)if(Qt=Fp(this,R),Qt==Di){qe==4&&(this.m=4,Kt(14),m=!1),bs(this.i,this.l,null,"[Incomplete Response]");break}else if(Qt==mc){this.m=4,Kt(15),bs(this.i,this.l,R,"[Invalid Chunk]"),m=!1;break}else bs(this.i,this.l,Qt,null),yc(this,Qt);if(Zt(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),qe!=4||R.length!=0||this.h.h||(this.m=1,Kt(16),m=!1),this.o=this.o&&m,!m)bs(this.i,this.l,R,"[Invalid Chunked Response]"),Fi(this),Xa(this);else if(R.length>0&&!this.W){this.W=!0;var Ae=this.j;Ae.g==this&&Ae.aa&&!Ae.P&&(Ae.j.info("Great, no buffering proxy detected. Bytes received: "+R.length),Gh(Ae),Ae.P=!0,Kt(11))}}else bs(this.i,this.l,R,null),yc(this,R);qe==4&&Fi(this),this.o&&!this.K&&(qe==4?Zh(this.j,this):(this.o=!1,qa(this)))}else il(this.g),x==400&&R.indexOf("Unknown SID")>0?(this.m=3,Kt(12)):(this.m=0,Kt(13)),Fi(this),Xa(this)}}}catch{}finally{}};function xo(m){if(!Zt(m))return m.g.la();const x=rl(m.g);if(x==="")return"";let R="";const B=x.length,ce=Wn(m.g)==4;if(!m.h.i){if(typeof TextDecoder>"u")return Fi(m),Xa(m),"";m.h.i=new o.TextDecoder}for(let pe=0;pe<B;pe++)m.h.h=!0,R+=m.h.i.decode(x[pe],{stream:!(ce&&pe==B-1)});return x.length=0,m.h.g+=R,m.C=0,m.h.g}function Zt(m){return m.g?m.v=="GET"&&m.M!=2&&m.j.Aa:!1}function Fp(m,x){var R=m.C,B=x.indexOf(`
`,R);return B==-1?Di:(R=Number(x.substring(R,B)),isNaN(R)?mc:(B+=1,B+R>x.length?Di:(x=x.slice(B,B+R),m.C=B+R,x)))}ui.prototype.cancel=function(){this.K=!0,Fi(this)};function qa(m){m.T=Date.now()+m.H,Ui(m,m.H)}function Ui(m,x){if(m.D!=null)throw Error("WatchDog timer not null");m.D=vo(h(m.aa,m),x)}function Vi(m){m.D&&(o.clearTimeout(m.D),m.D=null)}ui.prototype.aa=function(){this.D=null;const m=Date.now();m-this.T>=0?(xv(this.i,this.B),this.M!=2&&(_o(),Kt(17)),Fi(this),this.m=2,Xa(this)):Ui(this,this.T-m)};function Xa(m){m.j.I==0||m.K||Zh(m.j,m)}function Fi(m){Vi(m);var x=m.O;x&&typeof x.dispose=="function"&&x.dispose(),m.O=null,$n(m.V),m.g&&(x=m.g,m.g=null,x.abort(),x.dispose())}function yc(m,x){try{var R=m.j;if(R.I!=0&&(R.g==m||Ga(R.h,m))){if(!m.L&&Ga(R.h,m)&&R.I==3){try{var B=R.Ba.g.parse(x)}catch{B=null}if(Array.isArray(B)&&B.length==3){var ce=B;if(ce[0]==0){e:if(!R.v){if(R.g)if(R.g.F+3e3<m.F)Ac(R),Bi(R);else break e;Kh(R),Kt(18)}}else R.xa=ce[1],0<R.xa-R.K&&ce[2]<37500&&R.F&&R.A==0&&!R.C&&(R.C=vo(h(R.Va,R),6e3));zr(R.h)<=1&&R.ta&&(R.ta=void 0)}else Ss(R,11)}else if((m.L||R.g==m)&&Ac(R),!j(x))for(ce=R.Ba.g.parse(x),x=0;x<ce.length;x++){let yt=ce[x];const Qt=yt[0];if(!(Qt<=R.K))if(R.K=Qt,yt=yt[1],R.I==2)if(yt[0]=="c"){R.M=yt[1],R.ba=yt[2];const Er=yt[3];Er!=null&&(R.ka=Er,R.j.info("VER="+R.ka));const zi=yt[4];zi!=null&&(R.za=zi,R.j.info("SVER="+R.za));const di=yt[5];di!=null&&typeof di=="number"&&di>0&&(B=1.5*di,R.O=B,R.j.info("backChannelRequestTimeoutMs_="+B)),B=R;const pi=m.g;if(pi){const gi=pi.g?pi.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(gi){var pe=B.h;pe.g||gi.indexOf("spdy")==-1&&gi.indexOf("quic")==-1&&gi.indexOf("h2")==-1||(pe.j=pe.l,pe.g=new Set,pe.h&&(_c(pe,pe.h),pe.h=null))}if(B.G){const Jh=pi.g?pi.g.getResponseHeader("X-HTTP-Session-Id"):null;Jh&&(B.wa=Jh,Tt(B.J,B.G,Jh))}}R.I=3,R.l&&R.l.ra(),R.aa&&(R.T=Date.now()-m.F,R.j.info("Handshake RTT: "+R.T+"ms")),B=R;var Ae=m;if(B.na=Zp(B,B.L?B.ba:null,B.W),Ae.L){ws(B.h,Ae);var qe=Ae,Ot=B.O;Ot&&(qe.H=Ot),qe.D&&(Vi(qe),qa(qe)),B.g=Ae}else Xp(B);R.i.length>0&&ll(R)}else yt[0]!="stop"&&yt[0]!="close"||Ss(R,7);else R.I==3&&(yt[0]=="stop"||yt[0]=="close"?yt[0]=="stop"?Ss(R,7):ol(R):yt[0]!="noop"&&R.l&&R.l.qa(yt),R.A=0)}}_o(4)}catch{}}var Av=class{constructor(m,x){this.g=m,this.map=x}};function Ya(m){this.l=m||10,o.PerformanceNavigationTiming?(m=o.performance.getEntriesByType("navigation"),m=m.length>0&&(m[0].nextHopProtocol=="hq"||m[0].nextHopProtocol=="h2")):m=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=m?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Ka(m){return m.h?!0:m.g?m.g.size>=m.j:!1}function zr(m){return m.h?1:m.g?m.g.size:0}function Ga(m,x){return m.h?m.h==x:m.g?m.g.has(x):!1}function _c(m,x){m.g?m.g.add(x):m.h=x}function ws(m,x){m.h&&m.h==x?m.h=null:m.g&&m.g.has(x)&&m.g.delete(x)}Ya.prototype.cancel=function(){if(this.i=vc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const m of this.g.values())m.cancel();this.g.clear()}};function vc(m){if(m.h!=null)return m.i.concat(m.h.G);if(m.g!=null&&m.g.size!==0){let x=m.i;for(const R of m.g.values())x=x.concat(R.G);return x}return v(m.i)}var bc=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Sv(m,x){if(m){m=m.split("&");for(let R=0;R<m.length;R++){const B=m[R].indexOf("=");let ce,pe=null;B>=0?(ce=m[R].substring(0,B),pe=m[R].substring(B+1)):ce=m[R],x(ce,pe?decodeURIComponent(pe.replace(/\+/g," ")):"")}}}function hi(m){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let x;m instanceof hi?(this.l=m.l,Eo(this,m.j),this.o=m.o,this.g=m.g,Za(this,m.u),this.h=m.h,Ao(this,Hp(m.i)),this.m=m.m):m&&(x=String(m).match(bc))?(this.l=!1,Eo(this,x[1]||"",!0),this.o=Qa(x[2]||""),this.g=Qa(x[3]||"",!0),Za(this,x[4]),this.h=Qa(x[5]||"",!0),Ao(this,x[6]||"",!0),this.m=Qa(x[7]||"")):(this.l=!1,this.i=new jr(null,this.l))}hi.prototype.toString=function(){const m=[];var x=this.j;x&&m.push(An(x,jh,!0),":");var R=this.g;return(R||x=="file")&&(m.push("//"),(x=this.o)&&m.push(An(x,jh,!0),"@"),m.push(Wa(R).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),R=this.u,R!=null&&m.push(":",String(R))),(R=this.h)&&(this.g&&R.charAt(0)!="/"&&m.push("/"),m.push(An(R,R.charAt(0)=="/"?So:Hh,!0))),(R=this.i.toString())&&m.push("?",R),(R=this.m)&&m.push("#",An(R,zp)),m.join("")},hi.prototype.resolve=function(m){const x=Ut(this);let R=!!m.j;R?Eo(x,m.j):R=!!m.o,R?x.o=m.o:R=!!m.g,R?x.g=m.g:R=m.u!=null;var B=m.h;if(R)Za(x,m.u);else if(R=!!m.h){if(B.charAt(0)!="/")if(this.g&&!this.h)B="/"+B;else{var ce=x.h.lastIndexOf("/");ce!=-1&&(B=x.h.slice(0,ce+1)+B)}if(ce=B,ce==".."||ce==".")B="";else if(ce.indexOf("./")!=-1||ce.indexOf("/.")!=-1){B=ce.lastIndexOf("/",0)==0,ce=ce.split("/");const pe=[];for(let Ae=0;Ae<ce.length;){const qe=ce[Ae++];qe=="."?B&&Ae==ce.length&&pe.push(""):qe==".."?((pe.length>1||pe.length==1&&pe[0]!="")&&pe.pop(),B&&Ae==ce.length&&pe.push("")):(pe.push(qe),B=!0)}B=pe.join("/")}else B=ce}return R?x.h=B:R=m.i.toString()!=="",R?Ao(x,Hp(m.i)):R=!!m.m,R&&(x.m=m.m),x};function Ut(m){return new hi(m)}function Eo(m,x,R){m.j=R?Qa(x,!0):x,m.j&&(m.j=m.j.replace(/:$/,""))}function Za(m,x){if(x){if(x=Number(x),isNaN(x)||x<0)throw Error("Bad port number "+x);m.u=x}else m.u=null}function Ao(m,x,R){x instanceof jr?(m.i=x,qh(m.i,m.l)):(R||(x=An(x,Bp)),m.i=new jr(x,m.l))}function Tt(m,x,R){m.i.set(x,R)}function xs(m){return Tt(m,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),m}function Qa(m,x){return m?x?decodeURI(m.replace(/%25/g,"%2525")):decodeURIComponent(m):""}function An(m,x,R){return typeof m=="string"?(m=encodeURI(m).replace(x,zh),R&&(m=m.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),m):null}function zh(m){return m=m.charCodeAt(0),"%"+(m>>4&15).toString(16)+(m&15).toString(16)}var jh=/[#\/\?@]/g,Hh=/[#\?:]/g,So=/[#\?]/g,Bp=/[#\?@]/g,zp=/#/g;function jr(m,x){this.h=this.g=null,this.i=m||null,this.j=!!x}function Es(m){m.g||(m.g=new Map,m.h=0,m.i&&Sv(m.i,function(x,R){m.add(decodeURIComponent(x.replace(/\+/g," ")),R)}))}n=jr.prototype,n.add=function(m,x){Es(this),this.i=null,m=fi(this,m);let R=this.g.get(m);return R||this.g.set(m,R=[]),R.push(x),this.h+=1,this};function $h(m,x){Es(m),x=fi(m,x),m.g.has(x)&&(m.i=null,m.h-=m.g.get(x).length,m.g.delete(x))}function Wh(m,x){return Es(m),x=fi(m,x),m.g.has(x)}n.forEach=function(m,x){Es(this),this.g.forEach(function(R,B){R.forEach(function(ce){m.call(x,ce,B,this)},this)},this)};function Tc(m,x){Es(m);let R=[];if(typeof x=="string")Wh(m,x)&&(R=R.concat(m.g.get(fi(m,x))));else for(m=Array.from(m.g.values()),x=0;x<m.length;x++)R=R.concat(m[x]);return R}n.set=function(m,x){return Es(this),this.i=null,m=fi(this,m),Wh(this,m)&&(this.h-=this.g.get(m).length),this.g.set(m,[x]),this.h+=1,this},n.get=function(m,x){return m?(m=Tc(this,m),m.length>0?String(m[0]):x):x};function jp(m,x,R){$h(m,x),R.length>0&&(m.i=null,m.g.set(fi(m,x),v(R)),m.h+=R.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const m=[],x=Array.from(this.g.keys());for(let B=0;B<x.length;B++){var R=x[B];const ce=Wa(R);R=Tc(this,R);for(let pe=0;pe<R.length;pe++){let Ae=ce;R[pe]!==""&&(Ae+="="+Wa(R[pe])),m.push(Ae)}}return this.i=m.join("&")};function Hp(m){const x=new jr;return x.i=m.i,m.g&&(x.g=new Map(m.g),x.h=m.h),x}function fi(m,x){return x=String(x),m.j&&(x=x.toLowerCase()),x}function qh(m,x){x&&!m.j&&(Es(m),m.i=null,m.g.forEach(function(R,B){const ce=B.toLowerCase();B!=ce&&($h(this,B),jp(this,ce,R))},m)),m.j=x}function Xh(m,x){const R=new bo;if(o.Image){const B=new Image;B.onload=d(ar,R,"TestLoadImage: loaded",!0,x,B),B.onerror=d(ar,R,"TestLoadImage: error",!1,x,B),B.onabort=d(ar,R,"TestLoadImage: abort",!1,x,B),B.ontimeout=d(ar,R,"TestLoadImage: timeout",!1,x,B),o.setTimeout(function(){B.ontimeout&&B.ontimeout()},1e4),B.src=m}else x(!1)}function Ro(m,x){const R=new bo,B=new AbortController,ce=setTimeout(()=>{B.abort(),ar(R,"TestPingServer: timeout",!1,x)},1e4);fetch(m,{signal:B.signal}).then(pe=>{clearTimeout(ce),pe.ok?ar(R,"TestPingServer: ok",!0,x):ar(R,"TestPingServer: server error",!1,x)}).catch(()=>{clearTimeout(ce),ar(R,"TestPingServer: error",!1,x)})}function ar(m,x,R,B,ce){try{ce&&(ce.onload=null,ce.onerror=null,ce.onabort=null,ce.ontimeout=null),B(R)}catch{}}function $p(){this.g=new wv}function Ja(m){this.i=m.Sb||null,this.h=m.ab||!1}g(Ja,Lp),Ja.prototype.g=function(){return new el(this.i,this.h)};function el(m,x){dn.call(this),this.H=m,this.o=x,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}g(el,dn),n=el.prototype,n.open=function(m,x){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=m,this.D=x,this.readyState=1,As(this)},n.send=function(m){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const x={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};m&&(x.body=m),(this.H||o).fetch(new Request(this.D,x)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,lr(this)),this.readyState=0},n.Pa=function(m){if(this.g&&(this.l=m,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=m.headers,this.readyState=2,As(this)),this.g&&(this.readyState=3,As(this),this.g)))if(this.responseType==="arraybuffer")m.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in m){if(this.j=m.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Co(this)}else m.text().then(this.Oa.bind(this),this.ga.bind(this))};function Co(m){m.j.read().then(m.Ma.bind(m)).catch(m.ga.bind(m))}n.Ma=function(m){if(this.g){if(this.o&&m.value)this.response.push(m.value);else if(!this.o){var x=m.value?m.value:new Uint8Array(0);(x=this.B.decode(x,{stream:!m.done}))&&(this.response=this.responseText+=x)}m.done?lr(this):As(this),this.readyState==3&&Co(this)}},n.Oa=function(m){this.g&&(this.response=this.responseText=m,lr(this))},n.Na=function(m){this.g&&(this.response=m,lr(this))},n.ga=function(){this.g&&lr(this)};function lr(m){m.readyState=4,m.l=null,m.j=null,m.B=null,As(m)}n.setRequestHeader=function(m,x){this.A.append(m,x)},n.getResponseHeader=function(m){return this.h&&this.h.get(m.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const m=[],x=this.h.entries();for(var R=x.next();!R.done;)R=R.value,m.push(R[0]+": "+R[1]),R=x.next();return m.join(`\r
`)};function As(m){m.onreadystatechange&&m.onreadystatechange.call(m)}Object.defineProperty(el.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(m){this.m=m?"include":"same-origin"}});function Io(m){let x="";return ie(m,function(R,B){x+=B,x+=":",x+=R,x+=`\r
`}),x}function Hr(m,x,R){e:{for(B in R){var B=!1;break e}B=!0}B||(R=Io(R),typeof m=="string"?R!=null&&Wa(R):Tt(m,x,R))}function Pt(m){dn.call(this),this.headers=new Map,this.L=m||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}g(Pt,dn);var wc=/^https?$/i,Wp=["POST","PUT"];n=Pt.prototype,n.Fa=function(m){this.H=m},n.ea=function(m,x,R,B){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+m);x=x?x.toUpperCase():"GET",this.D=m,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Ts.g(),this.g.onreadystatechange=y(h(this.Ca,this));try{this.B=!0,this.g.open(x,String(m),!0),this.B=!1}catch(pe){tl(this,pe);return}if(m=R||"",R=new Map(this.headers),B)if(Object.getPrototypeOf(B)===Object.prototype)for(var ce in B)R.set(ce,B[ce]);else if(typeof B.keys=="function"&&typeof B.get=="function")for(const pe of B.keys())R.set(pe,B.get(pe));else throw Error("Unknown input type for opt_headers: "+String(B));B=Array.from(R.keys()).find(pe=>pe.toLowerCase()=="content-type"),ce=o.FormData&&m instanceof o.FormData,!(Array.prototype.indexOf.call(Wp,x,void 0)>=0)||B||ce||R.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[pe,Ae]of R)this.g.setRequestHeader(pe,Ae);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(m),this.v=!1}catch(pe){tl(this,pe)}};function tl(m,x){m.h=!1,m.g&&(m.j=!0,m.g.abort(),m.j=!1),m.l=x,m.o=5,nl(m),pn(m)}function nl(m){m.A||(m.A=!0,En(m,"complete"),En(m,"error"))}n.abort=function(m){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=m||7,En(this,"complete"),En(this,"abort"),pn(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),pn(this,!0)),Pt.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?Yh(this):this.Xa())},n.Xa=function(){Yh(this)};function Yh(m){if(m.h&&typeof s<"u"){if(m.v&&Wn(m)==4)setTimeout(m.Ca.bind(m),0);else if(En(m,"readystatechange"),Wn(m)==4){m.h=!1;try{const pe=m.ca();e:switch(pe){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var x=!0;break e;default:x=!1}var R;if(!(R=x)){var B;if(B=pe===0){let Ae=String(m.D).match(bc)[1]||null;!Ae&&o.self&&o.self.location&&(Ae=o.self.location.protocol.slice(0,-1)),B=!wc.test(Ae?Ae.toLowerCase():"")}R=B}if(R)En(m,"complete"),En(m,"success");else{m.o=6;try{var ce=Wn(m)>2?m.g.statusText:""}catch{ce=""}m.l=ce+" ["+m.ca()+"]",nl(m)}}finally{pn(m)}}}}function pn(m,x){if(m.g){m.m&&(clearTimeout(m.m),m.m=null);const R=m.g;m.g=null,x||En(m,"ready");try{R.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function Wn(m){return m.g?m.g.readyState:0}n.ca=function(){try{return Wn(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(m){if(this.g){var x=this.g.responseText;return m&&x.indexOf(m)==0&&(x=x.substring(m.length)),or(x)}};function rl(m){try{if(!m.g)return null;if("response"in m.g)return m.g.response;switch(m.F){case"":case"text":return m.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in m.g)return m.g.mozResponseArrayBuffer}return null}catch{return null}}function il(m){const x={};m=(m.g&&Wn(m)>=2&&m.g.getAllResponseHeaders()||"").split(`\r
`);for(let B=0;B<m.length;B++){if(j(m[B]))continue;var R=Ev(m[B]);const ce=R[0];if(R=R[1],typeof R!="string")continue;R=R.trim();const pe=x[ce]||[];x[ce]=pe,pe.push(R)}V(x,function(B){return B.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function sl(m,x,R){return R&&R.internalChannelParams&&R.internalChannelParams[m]||x}function xc(m){this.za=0,this.i=[],this.j=new bo,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=sl("failFast",!1,m),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=sl("baseRetryDelayMs",5e3,m),this.Za=sl("retryDelaySeedMs",1e4,m),this.Ta=sl("forwardChannelMaxRetries",2,m),this.va=sl("forwardChannelRequestTimeoutMs",2e4,m),this.ma=m&&m.xmlHttpFactory||void 0,this.Ua=m&&m.Rb||void 0,this.Aa=m&&m.useFetchStreams||!1,this.O=void 0,this.L=m&&m.supportsCrossDomainXhr||!1,this.M="",this.h=new Ya(m&&m.concurrentRequestLimit),this.Ba=new $p,this.S=m&&m.fastHandshake||!1,this.R=m&&m.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=m&&m.Pb||!1,m&&m.ua&&this.j.ua(),m&&m.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&m&&m.detectBufferingProxy||!1,this.ia=void 0,m&&m.longPollingTimeout&&m.longPollingTimeout>0&&(this.ia=m.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=xc.prototype,n.ka=8,n.I=1,n.connect=function(m,x,R,B){Kt(0),this.W=m,this.H=x||{},R&&B!==void 0&&(this.H.OSID=R,this.H.OAID=B),this.F=this.X,this.J=Zp(this,null,this.W),ll(this)};function ol(m){if(al(m),m.I==3){var x=m.V++,R=Ut(m.J);if(Tt(R,"SID",m.M),Tt(R,"RID",x),Tt(R,"TYPE","terminate"),cl(m,R),x=new ui(m,m.j,x),x.M=2,x.A=xs(Ut(R)),R=!1,o.navigator&&o.navigator.sendBeacon)try{R=o.navigator.sendBeacon(x.A.toString(),"")}catch{}!R&&o.Image&&(new Image().src=x.A,R=!0),R||(x.g=Sc(x.j,null),x.g.ea(x.A)),x.F=Date.now(),qa(x)}Gp(m)}function Bi(m){m.g&&(Gh(m),m.g.cancel(),m.g=null)}function al(m){Bi(m),m.v&&(o.clearTimeout(m.v),m.v=null),Ac(m),m.h.cancel(),m.m&&(typeof m.m=="number"&&o.clearTimeout(m.m),m.m=null)}function ll(m){if(!Ka(m.h)&&!m.m){m.m=!0;var x=m.Ea;F||M(),Y||(F(),Y=!0),k.add(x,m),m.D=0}}function Rv(m,x){return zr(m.h)>=m.h.j-(m.m?1:0)?!1:m.m?(m.i=x.G.concat(m.i),!0):m.I==1||m.I==2||m.D>=(m.Sa?0:m.Ta)?!1:(m.m=vo(h(m.Ea,m,x),Kp(m,m.D)),m.D++,!0)}n.Ea=function(m){if(this.m)if(this.m=null,this.I==1){if(!m){this.V=Math.floor(Math.random()*1e5),m=this.V++;const ce=new ui(this,this.j,m);let pe=this.o;if(this.U&&(pe?(pe=Z(pe),ae(pe,this.U)):pe=this.U),this.u!==null||this.R||(ce.J=pe,pe=null),this.S)e:{for(var x=0,R=0;R<this.i.length;R++){t:{var B=this.i[R];if("__data__"in B.map&&(B=B.map.__data__,typeof B=="string")){B=B.length;break t}B=void 0}if(B===void 0)break;if(x+=B,x>4096){x=R;break e}if(x===4096||R===this.i.length-1){x=R+1;break e}}x=1e3}else x=1e3;x=Ec(this,ce,x),R=Ut(this.J),Tt(R,"RID",m),Tt(R,"CVER",22),this.G&&Tt(R,"X-HTTP-Session-Id",this.G),cl(this,R),pe&&(this.R?x="headers="+Wa(Io(pe))+"&"+x:this.u&&Hr(R,this.u,pe)),_c(this.h,ce),this.Ra&&Tt(R,"TYPE","init"),this.S?(Tt(R,"$req",x),Tt(R,"SID","null"),ce.U=!0,Li(ce,R,null)):Li(ce,R,x),this.I=2}}else this.I==3&&(m?qp(this,m):this.i.length==0||Ka(this.h)||qp(this))};function qp(m,x){var R;x?R=x.l:R=m.V++;const B=Ut(m.J);Tt(B,"SID",m.M),Tt(B,"RID",R),Tt(B,"AID",m.K),cl(m,B),m.u&&m.o&&Hr(B,m.u,m.o),R=new ui(m,m.j,R,m.D+1),m.u===null&&(R.J=m.o),x&&(m.i=x.G.concat(m.i)),x=Ec(m,R,1e3),R.H=Math.round(m.va*.5)+Math.round(m.va*.5*Math.random()),_c(m.h,R),Li(R,B,x)}function cl(m,x){m.H&&ie(m.H,function(R,B){Tt(x,B,R)}),m.l&&ie({},function(R,B){Tt(x,B,R)})}function Ec(m,x,R){R=Math.min(m.i.length,R);const B=m.l?h(m.l.Ka,m.l,m):null;e:{var ce=m.i;let qe=-1;for(;;){const Ot=["count="+R];qe==-1?R>0?(qe=ce[0].g,Ot.push("ofs="+qe)):qe=0:Ot.push("ofs="+qe);let yt=!0;for(let Qt=0;Qt<R;Qt++){var pe=ce[Qt].g;const Er=ce[Qt].map;if(pe-=qe,pe<0)qe=Math.max(0,ce[Qt].g-100),yt=!1;else try{pe="req"+pe+"_"||"";try{var Ae=Er instanceof Map?Er:Object.entries(Er);for(const[zi,di]of Ae){let pi=di;a(di)&&(pi=Fr(di)),Ot.push(pe+zi+"="+encodeURIComponent(pi))}}catch(zi){throw Ot.push(pe+"type="+encodeURIComponent("_badmap")),zi}}catch{B&&B(Er)}}if(yt){Ae=Ot.join("&");break e}}Ae=void 0}return m=m.i.splice(0,R),x.G=m,Ae}function Xp(m){if(!m.g&&!m.v){m.Y=1;var x=m.Da;F||M(),Y||(F(),Y=!0),k.add(x,m),m.A=0}}function Kh(m){return m.g||m.v||m.A>=3?!1:(m.Y++,m.v=vo(h(m.Da,m),Kp(m,m.A)),m.A++,!0)}n.Da=function(){if(this.v=null,Yp(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var m=4*this.T;this.j.info("BP detection timer enabled: "+m),this.B=vo(h(this.Wa,this),m)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Kt(10),Bi(this),Yp(this))};function Gh(m){m.B!=null&&(o.clearTimeout(m.B),m.B=null)}function Yp(m){m.g=new ui(m,m.j,"rpc",m.Y),m.u===null&&(m.g.J=m.o),m.g.P=0;var x=Ut(m.na);Tt(x,"RID","rpc"),Tt(x,"SID",m.M),Tt(x,"AID",m.K),Tt(x,"CI",m.F?"0":"1"),!m.F&&m.ia&&Tt(x,"TO",m.ia),Tt(x,"TYPE","xmlhttp"),cl(m,x),m.u&&m.o&&Hr(x,m.u,m.o),m.O&&(m.g.H=m.O);var R=m.g;m=m.ba,R.M=1,R.A=xs(Ut(x)),R.u=null,R.R=!0,wo(R,m)}n.Va=function(){this.C!=null&&(this.C=null,Bi(this),Kh(this),Kt(19))};function Ac(m){m.C!=null&&(o.clearTimeout(m.C),m.C=null)}function Zh(m,x){var R=null;if(m.g==x){Ac(m),Gh(m),m.g=null;var B=2}else if(Ga(m.h,x))R=x.G,ws(m.h,x),B=1;else return;if(m.I!=0){if(x.o)if(B==1){R=x.u?x.u.length:0,x=Date.now()-x.F;var ce=m.D;B=pc(),En(B,new Vp(B,R)),ll(m)}else Xp(m);else if(ce=x.m,ce==3||ce==0&&x.X>0||!(B==1&&Rv(m,x)||B==2&&Kh(m)))switch(R&&R.length>0&&(x=m.h,x.i=x.i.concat(R)),ce){case 1:Ss(m,5);break;case 4:Ss(m,10);break;case 3:Ss(m,6);break;default:Ss(m,2)}}}function Kp(m,x){let R=m.Qa+Math.floor(Math.random()*m.Za);return m.isActive()||(R*=2),R*x}function Ss(m,x){if(m.j.info("Error code "+x),x==2){var R=h(m.bb,m),B=m.Ua;const ce=!B;B=new hi(B||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||Eo(B,"https"),xs(B),ce?Xh(B.toString(),R):Ro(B.toString(),R)}else Kt(2);m.I=0,m.l&&m.l.pa(x),Gp(m),al(m)}n.bb=function(m){m?(this.j.info("Successfully pinged google.com"),Kt(2)):(this.j.info("Failed to ping google.com"),Kt(1))};function Gp(m){if(m.I=0,m.ja=[],m.l){const x=vc(m.h);(x.length!=0||m.i.length!=0)&&(T(m.ja,x),T(m.ja,m.i),m.h.i.length=0,v(m.i),m.i.length=0),m.l.oa()}}function Zp(m,x,R){var B=R instanceof hi?Ut(R):new hi(R);if(B.g!="")x&&(B.g=x+"."+B.g),Za(B,B.u);else{var ce=o.location;B=ce.protocol,x=x?x+"."+ce.hostname:ce.hostname,ce=+ce.port;const pe=new hi(null);B&&Eo(pe,B),x&&(pe.g=x),ce&&Za(pe,ce),R&&(pe.h=R),B=pe}return R=m.G,x=m.wa,R&&x&&Tt(B,R,x),Tt(B,"VER",m.ka),cl(m,B),B}function Sc(m,x,R){if(x&&!m.L)throw Error("Can't create secondary domain capable XhrIo object.");return x=m.Aa&&!m.ma?new Pt(new Ja({ab:R})):new Pt(m.ma),x.Fa(m.L),x}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Qp(){}n=Qp.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function Rc(){}Rc.prototype.g=function(m,x){return new cr(m,x)};function cr(m,x){dn.call(this),this.g=new xc(x),this.l=m,this.h=x&&x.messageUrlParams||null,m=x&&x.messageHeaders||null,x&&x.clientProtocolHeaderRequired&&(m?m["X-Client-Protocol"]="webchannel":m={"X-Client-Protocol":"webchannel"}),this.g.o=m,m=x&&x.initMessageHeaders||null,x&&x.messageContentType&&(m?m["X-WebChannel-Content-Type"]=x.messageContentType:m={"X-WebChannel-Content-Type":x.messageContentType}),x&&x.sa&&(m?m["X-WebChannel-Client-Profile"]=x.sa:m={"X-WebChannel-Client-Profile":x.sa}),this.g.U=m,(m=x&&x.Qb)&&!j(m)&&(this.g.u=m),this.A=x&&x.supportsCrossDomainXhr||!1,this.v=x&&x.sendRawJson||!1,(x=x&&x.httpSessionIdParam)&&!j(x)&&(this.g.G=x,m=this.h,m!==null&&x in m&&(m=this.h,x in m&&delete m[x])),this.j=new Po(this)}g(cr,dn),cr.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},cr.prototype.close=function(){ol(this.g)},cr.prototype.o=function(m){var x=this.g;if(typeof m=="string"){var R={};R.__data__=m,m=R}else this.v&&(R={},R.__data__=Fr(m),m=R);x.i.push(new Av(x.Ya++,m)),x.I==3&&ll(x)},cr.prototype.N=function(){this.g.l=null,delete this.j,ol(this.g),delete this.g,cr.Z.N.call(this)};function Qh(m){mo.call(this),m.__headers__&&(this.headers=m.__headers__,this.statusCode=m.__status__,delete m.__headers__,delete m.__status__);var x=m.__sm__;if(x){e:{for(const R in x){m=R;break e}m=void 0}(this.i=m)&&(m=this.i,x=x!==null&&m in x?x[m]:void 0),this.data=x}else this.data=m}g(Qh,mo);function Jp(){ci.call(this),this.status=1}g(Jp,ci);function Po(m){this.g=m}g(Po,Qp),Po.prototype.ra=function(){En(this.g,"a")},Po.prototype.qa=function(m){En(this.g,new Qh(m))},Po.prototype.pa=function(m){En(this.g,new Jp)},Po.prototype.oa=function(){En(this.g,"b")},Rc.prototype.createWebChannel=Rc.prototype.g,cr.prototype.send=cr.prototype.o,cr.prototype.open=cr.prototype.m,cr.prototype.close=cr.prototype.close,nD=function(){return new Rc},tD=function(){return pc()},eD=Br,fw={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Gt.NO_ERROR=0,Gt.TIMEOUT=8,Gt.HTTP_ERROR=6,Zm=Gt,kn.COMPLETE="complete",JN=kn,Up.EventType=ki,ki.OPEN="a",ki.CLOSE="b",ki.ERROR="c",ki.MESSAGE="d",dn.prototype.listen=dn.prototype.J,td=Up,Pt.prototype.listenOnce=Pt.prototype.K,Pt.prototype.getLastError=Pt.prototype.Ha,Pt.prototype.getLastErrorCode=Pt.prototype.ya,Pt.prototype.getStatus=Pt.prototype.ca,Pt.prototype.getResponseJson=Pt.prototype.La,Pt.prototype.getResponseText=Pt.prototype.la,Pt.prototype.send=Pt.prototype.ea,Pt.prototype.setWithCredentials=Pt.prototype.Fa,QN=Pt}).apply(typeof nm<"u"?nm:typeof self<"u"?self:typeof window<"u"?window:{});const t3="@firebase/firestore",n3="4.9.2";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Qn.UNAUTHENTICATED=new Qn(null),Qn.GOOGLE_CREDENTIALS=new Qn("google-credentials-uid"),Qn.FIRST_PARTY=new Qn("first-party-uid"),Qn.MOCK_USER=new Qn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vh="12.3.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kl=new eE("@firebase/firestore");function du(){return Kl.logLevel}function Ie(n,...e){if(Kl.logLevel<=rt.DEBUG){const t=e.map(fE);Kl.debug(`Firestore (${vh}): ${n}`,...t)}}function to(n,...e){if(Kl.logLevel<=rt.ERROR){const t=e.map(fE);Kl.error(`Firestore (${vh}): ${n}`,...t)}}function qu(n,...e){if(Kl.logLevel<=rt.WARN){const t=e.map(fE);Kl.warn(`Firestore (${vh}): ${n}`,...t)}}function fE(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return(function(t){return JSON.stringify(t)})(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function je(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,rD(n,r,t)}function rD(n,e,t){let r=`FIRESTORE (${vh}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw to(r),new Error(r)}function mt(n,e,t,r){let i="Unexpected state";typeof t=="string"?i=t:r=t,n||rD(e,i,r)}function Xe(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Te={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Le extends po{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wa{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iD{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class ZH{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Qn.UNAUTHENTICATED)))}shutdown(){}}class QH{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class JH{constructor(e){this.t=e,this.currentUser=Qn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){mt(this.o===void 0,42304);let r=this.i;const i=u=>this.i!==r?(r=this.i,t(u)):Promise.resolve();let s=new wa;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new wa,e.enqueueRetryable((()=>i(this.currentUser)))};const o=()=>{const u=s;e.enqueueRetryable((async()=>{await u.promise,await i(this.currentUser)}))},a=u=>{Ie("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit((u=>a(u))),setTimeout((()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?a(u):(Ie("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new wa)}}),0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((r=>this.i!==e?(Ie("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(mt(typeof r.accessToken=="string",31837,{l:r}),new iD(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return mt(e===null||typeof e=="string",2055,{h:e}),new Qn(e)}}class e${constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=Qn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class t${constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new e$(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(Qn.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class r3{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class n${constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Jr(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){mt(this.o===void 0,3512);const r=s=>{s.error!=null&&Ie("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const o=s.token!==this.m;return this.m=s.token,Ie("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable((()=>r(s)))};const i=s=>{Ie("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((s=>i(s))),setTimeout((()=>{if(!this.appCheck){const s=this.V.getImmediate({optional:!0});s?i(s):Ie("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new r3(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(mt(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new r3(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r$(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dE{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const i=r$(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%62))}return r}}function it(n,e){return n<e?-1:n>e?1:0}function dw(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const i=n.charAt(r),s=e.charAt(r);if(i!==s)return k0(i)===k0(s)?it(i,s):k0(i)?1:-1}return it(n.length,e.length)}const i$=55296,s$=57343;function k0(n){const e=n.charCodeAt(0);return e>=i$&&e<=s$}function Xu(n,e,t){return n.length===e.length&&n.every(((r,i)=>t(r,e[i])))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i3="__name__";class Gi{constructor(e,t,r){t===void 0?t=0:t>e.length&&je(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&je(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Gi.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Gi?e.forEach((r=>{t.push(r)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const s=Gi.compareSegments(e.get(i),t.get(i));if(s!==0)return s}return it(e.length,t.length)}static compareSegments(e,t){const r=Gi.isNumericId(e),i=Gi.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?Gi.extractNumericId(e).compare(Gi.extractNumericId(t)):dw(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Ta.fromString(e.substring(4,e.length-2))}}class Ft extends Gi{construct(e,t,r){return new Ft(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new Le(Te.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter((i=>i.length>0)))}return new Ft(t)}static emptyPath(){return new Ft([])}}const o$=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class zn extends Gi{construct(e,t,r){return new zn(e,t,r)}static isValidIdentifier(e){return o$.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),zn.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===i3}static keyField(){return new zn([i3])}static fromServerFormat(e){const t=[];let r="",i=0;const s=()=>{if(r.length===0)throw new Le(Te.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;i<e.length;){const a=e[i];if(a==="\\"){if(i+1===e.length)throw new Le(Te.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new Le(Te.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new Le(Te.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new zn(t)}static emptyPath(){return new zn([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ue{constructor(e){this.path=e}static fromPath(e){return new Ue(Ft.fromString(e))}static fromName(e){return new Ue(Ft.fromString(e).popFirst(5))}static empty(){return new Ue(Ft.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ft.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Ft.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Ue(new Ft(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a$(n,e,t){if(!t)throw new Le(Te.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function l$(n,e,t,r){if(e===!0&&r===!0)throw new Le(Te.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function s3(n){if(!Ue.isDocumentKey(n))throw new Le(Te.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function sD(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function pE(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":je(12329,{type:typeof n})}function Vd(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new Le(Te.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=pE(n);throw new Le(Te.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hn(n,e){const t={typeString:n};return e&&(t.value=e),t}function _p(n,e){if(!sD(n))throw new Le(Te.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const i=e[r].typeString,s="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const o=n[r];if(i&&typeof o!==i){t=`JSON field '${r}' must be a ${i}.`;break}if(s!==void 0&&o!==s.value){t=`Expected '${r}' field to equal '${s.value}'`;break}}if(t)throw new Le(Te.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o3=-62135596800,a3=1e6;class kt{static now(){return kt.fromMillis(Date.now())}static fromDate(e){return kt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*a3);return new kt(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Le(Te.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Le(Te.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<o3)throw new Le(Te.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Le(Te.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/a3}_compareTo(e){return this.seconds===e.seconds?it(this.nanoseconds,e.nanoseconds):it(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:kt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(_p(e,kt._jsonSchema))return new kt(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-o3;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}kt._jsonSchemaVersion="firestore/timestamp/1.0",kt._jsonSchema={type:hn("string",kt._jsonSchemaVersion),seconds:hn("number"),nanoseconds:hn("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class We{static fromTimestamp(e){return new We(e)}static min(){return new We(new kt(0,0))}static max(){return new We(new kt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fd=-1;function c$(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=We.fromTimestamp(r===1e9?new kt(t+1,0):new kt(t,r));return new Ra(i,Ue.empty(),e)}function u$(n){return new Ra(n.readTime,n.key,Fd)}class Ra{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Ra(We.min(),Ue.empty(),Fd)}static max(){return new Ra(We.max(),Ue.empty(),Fd)}}function h$(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=Ue.comparator(n.documentKey,e.documentKey),t!==0?t:it(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f$="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class d${constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bh(n){if(n.code!==Te.FAILED_PRECONDITION||n.message!==f$)throw n;Ie("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class be{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&je(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new be(((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof be?t:be.resolve(t)}catch(t){return be.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):be.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):be.reject(t)}static resolve(e){return new be(((t,r)=>{t(e)}))}static reject(e){return new be(((t,r)=>{r(e)}))}static waitFor(e){return new be(((t,r)=>{let i=0,s=0,o=!1;e.forEach((a=>{++i,a.next((()=>{++s,o&&s===i&&t()}),(u=>r(u)))})),o=!0,s===i&&t()}))}static or(e){let t=be.resolve(!1);for(const r of e)t=t.next((i=>i?be.resolve(i):r()));return t}static forEach(e,t){const r=[];return e.forEach(((i,s)=>{r.push(t.call(this,i,s))})),this.waitFor(r)}static mapArray(e,t){return new be(((r,i)=>{const s=e.length,o=new Array(s);let a=0;for(let u=0;u<s;u++){const h=u;t(e[h]).next((d=>{o[h]=d,++a,a===s&&r(o)}),(d=>i(d)))}}))}static doWhile(e,t){return new be(((r,i)=>{const s=()=>{e()===!0?t().next((()=>{s()}),i):r()};s()}))}}function p$(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Th(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O_{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}O_.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gE=-1;function k_(n){return n==null}function Ny(n){return n===0&&1/n==-1/0}function g$(n){return typeof n=="number"&&Number.isInteger(n)&&!Ny(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oD="";function m$(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=l3(e)),e=y$(n.get(t),e);return l3(e)}function y$(n,e){let t=e;const r=n.length;for(let i=0;i<r;i++){const s=n.charAt(i);switch(s){case"\0":t+="";break;case oD:t+="";break;default:t+=s}}return t}function l3(n){return n+oD+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c3(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function sc(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function aD(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ht{constructor(e,t){this.comparator=e,this.root=t||Fn.EMPTY}insert(e,t){return new Ht(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Fn.BLACK,null,null))}remove(e){return new Ht(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Fn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,r)=>(e(t,r),!1)))}toString(){const e=[];return this.inorderTraversal(((t,r)=>(e.push(`${t}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new rm(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new rm(this.root,e,this.comparator,!1)}getReverseIterator(){return new rm(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new rm(this.root,e,this.comparator,!0)}}class rm{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Fn{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??Fn.RED,this.left=i??Fn.EMPTY,this.right=s??Fn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new Fn(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Fn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return Fn.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Fn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Fn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw je(43730,{key:this.key,value:this.value});if(this.right.isRed())throw je(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw je(27949);return e+(this.isRed()?0:1)}}Fn.EMPTY=null,Fn.RED=!0,Fn.BLACK=!1;Fn.EMPTY=new class{constructor(){this.size=0}get key(){throw je(57766)}get value(){throw je(16141)}get color(){throw je(16727)}get left(){throw je(29726)}get right(){throw je(36894)}copy(e,t,r,i,s){return this}insert(e,t,r){return new Fn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tn{constructor(e){this.comparator=e,this.data=new Ht(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,r)=>(e(t),!1)))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new u3(this.data.getIterator())}getIteratorFrom(e){return new u3(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((r=>{t=t.add(r)})),t}isEqual(e){if(!(e instanceof Tn)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Tn(this.comparator);return t.data=e,t}}class u3{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xi{constructor(e){this.fields=e,e.sort(zn.comparator)}static empty(){return new xi([])}unionWith(e){let t=new Tn(zn.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new xi(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Xu(this.fields,e.fields,((t,r)=>t.isEqual(r)))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lD extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hn{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new lD("Invalid base64 string: "+s):s}})(e);return new Hn(t)}static fromUint8Array(e){const t=(function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s})(e);return new Hn(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return it(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Hn.EMPTY_BYTE_STRING=new Hn("");const _$=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ca(n){if(mt(!!n,39018),typeof n=="string"){let e=0;const t=_$.exec(n);if(mt(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:nn(n.seconds),nanos:nn(n.nanos)}}function nn(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ia(n){return typeof n=="string"?Hn.fromBase64String(n):Hn.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cD="server_timestamp",uD="__type__",hD="__previous_value__",fD="__local_write_time__";function mE(n){return(n?.mapValue?.fields||{})[uD]?.stringValue===cD}function N_(n){const e=n.mapValue.fields[hD];return mE(e)?N_(e):e}function Bd(n){const e=Ca(n.mapValue.fields[fD].timestampValue);return new kt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v${constructor(e,t,r,i,s,o,a,u,h,d){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=h,this.isUsingEmulator=d}}const Dy="(default)";class zd{constructor(e,t){this.projectId=e,this.database=t||Dy}static empty(){return new zd("","")}get isDefaultDatabase(){return this.database===Dy}isEqual(e){return e instanceof zd&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dD="__type__",b$="__max__",im={mapValue:{}},pD="__vector__",Ly="value";function Pa(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?mE(n)?4:w$(n)?9007199254740991:T$(n)?10:11:je(28295,{value:n})}function fs(n,e){if(n===e)return!0;const t=Pa(n);if(t!==Pa(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Bd(n).isEqual(Bd(e));case 3:return(function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const o=Ca(i.timestampValue),a=Ca(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(i,s){return Ia(i.bytesValue).isEqual(Ia(s.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(i,s){return nn(i.geoPointValue.latitude)===nn(s.geoPointValue.latitude)&&nn(i.geoPointValue.longitude)===nn(s.geoPointValue.longitude)})(n,e);case 2:return(function(i,s){if("integerValue"in i&&"integerValue"in s)return nn(i.integerValue)===nn(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const o=nn(i.doubleValue),a=nn(s.doubleValue);return o===a?Ny(o)===Ny(a):isNaN(o)&&isNaN(a)}return!1})(n,e);case 9:return Xu(n.arrayValue.values||[],e.arrayValue.values||[],fs);case 10:case 11:return(function(i,s){const o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(c3(o)!==c3(a))return!1;for(const u in o)if(o.hasOwnProperty(u)&&(a[u]===void 0||!fs(o[u],a[u])))return!1;return!0})(n,e);default:return je(52216,{left:n})}}function jd(n,e){return(n.values||[]).find((t=>fs(t,e)))!==void 0}function Yu(n,e){if(n===e)return 0;const t=Pa(n),r=Pa(e);if(t!==r)return it(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return it(n.booleanValue,e.booleanValue);case 2:return(function(s,o){const a=nn(s.integerValue||s.doubleValue),u=nn(o.integerValue||o.doubleValue);return a<u?-1:a>u?1:a===u?0:isNaN(a)?isNaN(u)?0:-1:1})(n,e);case 3:return h3(n.timestampValue,e.timestampValue);case 4:return h3(Bd(n),Bd(e));case 5:return dw(n.stringValue,e.stringValue);case 6:return(function(s,o){const a=Ia(s),u=Ia(o);return a.compareTo(u)})(n.bytesValue,e.bytesValue);case 7:return(function(s,o){const a=s.split("/"),u=o.split("/");for(let h=0;h<a.length&&h<u.length;h++){const d=it(a[h],u[h]);if(d!==0)return d}return it(a.length,u.length)})(n.referenceValue,e.referenceValue);case 8:return(function(s,o){const a=it(nn(s.latitude),nn(o.latitude));return a!==0?a:it(nn(s.longitude),nn(o.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return f3(n.arrayValue,e.arrayValue);case 10:return(function(s,o){const a=s.fields||{},u=o.fields||{},h=a[Ly]?.arrayValue,d=u[Ly]?.arrayValue,g=it(h?.values?.length||0,d?.values?.length||0);return g!==0?g:f3(h,d)})(n.mapValue,e.mapValue);case 11:return(function(s,o){if(s===im.mapValue&&o===im.mapValue)return 0;if(s===im.mapValue)return 1;if(o===im.mapValue)return-1;const a=s.fields||{},u=Object.keys(a),h=o.fields||{},d=Object.keys(h);u.sort(),d.sort();for(let g=0;g<u.length&&g<d.length;++g){const y=dw(u[g],d[g]);if(y!==0)return y;const v=Yu(a[u[g]],h[d[g]]);if(v!==0)return v}return it(u.length,d.length)})(n.mapValue,e.mapValue);default:throw je(23264,{he:t})}}function h3(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return it(n,e);const t=Ca(n),r=Ca(e),i=it(t.seconds,r.seconds);return i!==0?i:it(t.nanos,r.nanos)}function f3(n,e){const t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){const s=Yu(t[i],r[i]);if(s)return s}return it(t.length,r.length)}function Ku(n){return pw(n)}function pw(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const r=Ca(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return Ia(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return Ue.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",i=!0;for(const s of t.values||[])i?i=!1:r+=",",r+=pw(s);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){const r=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const o of r)s?s=!1:i+=",",i+=`${o}:${pw(t.fields[o])}`;return i+"}"})(n.mapValue):je(61005,{value:n})}function Qm(n){switch(Pa(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=N_(n);return e?16+Qm(e):16;case 5:return 2*n.stringValue.length;case 6:return Ia(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((i,s)=>i+Qm(s)),0)})(n.arrayValue);case 10:case 11:return(function(r){let i=0;return sc(r.fields,((s,o)=>{i+=s.length+Qm(o)})),i})(n.mapValue);default:throw je(13486,{value:n})}}function gw(n){return!!n&&"integerValue"in n}function yE(n){return!!n&&"arrayValue"in n}function d3(n){return!!n&&"nullValue"in n}function p3(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Jm(n){return!!n&&"mapValue"in n}function T$(n){return(n?.mapValue?.fields||{})[dD]?.stringValue===pD}function pd(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return sc(n.mapValue.fields,((t,r)=>e.mapValue.fields[t]=pd(r))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=pd(n.arrayValue.values[t]);return e}return{...n}}function w$(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===b$}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ei{constructor(e){this.value=e}static empty(){return new ei({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Jm(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=pd(t)}setAll(e){let t=zn.emptyPath(),r={},i=[];e.forEach(((o,a)=>{if(!t.isImmediateParentOf(a)){const u=this.getFieldsMap(t);this.applyChanges(u,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=pd(o):i.push(a.lastSegment())}));const s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){const t=this.field(e.popLast());Jm(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return fs(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Jm(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){sc(t,((i,s)=>e[i]=s));for(const i of r)delete e[i]}clone(){return new ei(pd(this.value))}}function gD(n){const e=[];return sc(n.fields,((t,r)=>{const i=new zn([t]);if(Jm(r)){const s=gD(r.mapValue).fields;if(s.length===0)e.push(i);else for(const o of s)e.push(i.child(o))}else e.push(i)})),new xi(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tr{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new tr(e,0,We.min(),We.min(),We.min(),ei.empty(),0)}static newFoundDocument(e,t,r,i){return new tr(e,1,t,We.min(),r,i,0)}static newNoDocument(e,t){return new tr(e,2,t,We.min(),We.min(),ei.empty(),0)}static newUnknownDocument(e,t){return new tr(e,3,t,We.min(),We.min(),ei.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(We.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ei.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ei.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=We.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof tr&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new tr(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uy{constructor(e,t){this.position=e,this.inclusive=t}}function g3(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const s=e[i],o=n.position[i];if(s.field.isKeyField()?r=Ue.comparator(Ue.fromName(o.referenceValue),t.key):r=Yu(o,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function m3(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!fs(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vy{constructor(e,t="asc"){this.field=e,this.dir=t}}function x$(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mD{}class bn extends mD{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new A$(e,t,r):t==="array-contains"?new C$(e,r):t==="in"?new I$(e,r):t==="not-in"?new P$(e,r):t==="array-contains-any"?new M$(e,r):new bn(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new S$(e,r):new R$(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Yu(t,this.value)):t!==null&&Pa(this.value)===Pa(t)&&this.matchesComparison(Yu(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return je(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ds extends mD{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new ds(e,t)}matches(e){return yD(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function yD(n){return n.op==="and"}function _D(n){return E$(n)&&yD(n)}function E$(n){for(const e of n.filters)if(e instanceof ds)return!1;return!0}function mw(n){if(n instanceof bn)return n.field.canonicalString()+n.op.toString()+Ku(n.value);if(_D(n))return n.filters.map((e=>mw(e))).join(",");{const e=n.filters.map((t=>mw(t))).join(",");return`${n.op}(${e})`}}function vD(n,e){return n instanceof bn?(function(r,i){return i instanceof bn&&r.op===i.op&&r.field.isEqual(i.field)&&fs(r.value,i.value)})(n,e):n instanceof ds?(function(r,i){return i instanceof ds&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce(((s,o,a)=>s&&vD(o,i.filters[a])),!0):!1})(n,e):void je(19439)}function bD(n){return n instanceof bn?(function(t){return`${t.field.canonicalString()} ${t.op} ${Ku(t.value)}`})(n):n instanceof ds?(function(t){return t.op.toString()+" {"+t.getFilters().map(bD).join(" ,")+"}"})(n):"Filter"}class A$ extends bn{constructor(e,t,r){super(e,t,r),this.key=Ue.fromName(r.referenceValue)}matches(e){const t=Ue.comparator(e.key,this.key);return this.matchesComparison(t)}}class S$ extends bn{constructor(e,t){super(e,"in",t),this.keys=TD("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class R$ extends bn{constructor(e,t){super(e,"not-in",t),this.keys=TD("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function TD(n,e){return(e.arrayValue?.values||[]).map((t=>Ue.fromName(t.referenceValue)))}class C$ extends bn{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return yE(t)&&jd(t.arrayValue,this.value)}}class I$ extends bn{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&jd(this.value.arrayValue,t)}}class P$ extends bn{constructor(e,t){super(e,"not-in",t)}matches(e){if(jd(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!jd(this.value.arrayValue,t)}}class M$ extends bn{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!yE(t)||!t.arrayValue.values)&&t.arrayValue.values.some((r=>jd(this.value.arrayValue,r)))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O${constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.Te=null}}function y3(n,e=null,t=[],r=[],i=null,s=null,o=null){return new O$(n,e,t,r,i,s,o)}function _E(n){const e=Xe(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((r=>mw(r))).join(","),t+="|ob:",t+=e.orderBy.map((r=>(function(s){return s.field.canonicalString()+s.dir})(r))).join(","),k_(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((r=>Ku(r))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((r=>Ku(r))).join(",")),e.Te=t}return e.Te}function vE(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!x$(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!vD(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!m3(n.startAt,e.startAt)&&m3(n.endAt,e.endAt)}function yw(n){return Ue.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D_{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=u,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function k$(n,e,t,r,i,s,o,a){return new D_(n,e,t,r,i,s,o,a)}function bE(n){return new D_(n)}function _3(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function N$(n){return n.collectionGroup!==null}function gd(n){const e=Xe(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const s of e.explicitOrderBy)e.Ie.push(s),t.add(s.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Tn(zn.comparator);return o.filters.forEach((u=>{u.getFlattenedFilters().forEach((h=>{h.isInequality()&&(a=a.add(h.field))}))})),a})(e).forEach((s=>{t.has(s.canonicalString())||s.isKeyField()||e.Ie.push(new Vy(s,r))})),t.has(zn.keyField().canonicalString())||e.Ie.push(new Vy(zn.keyField(),r))}return e.Ie}function is(n){const e=Xe(n);return e.Ee||(e.Ee=D$(e,gd(n))),e.Ee}function D$(n,e){if(n.limitType==="F")return y3(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((i=>{const s=i.dir==="desc"?"asc":"desc";return new Vy(i.field,s)}));const t=n.endAt?new Uy(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Uy(n.startAt.position,n.startAt.inclusive):null;return y3(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function _w(n,e,t){return new D_(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function L_(n,e){return vE(is(n),is(e))&&n.limitType===e.limitType}function wD(n){return`${_E(is(n))}|lt:${n.limitType}`}function pu(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map((i=>bD(i))).join(", ")}]`),k_(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map((i=>(function(o){return`${o.field.canonicalString()} (${o.dir})`})(i))).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map((i=>Ku(i))).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map((i=>Ku(i))).join(",")),`Target(${r})`})(is(n))}; limitType=${n.limitType})`}function U_(n,e){return e.isFoundDocument()&&(function(r,i){const s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):Ue.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)})(n,e)&&(function(r,i){for(const s of gd(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0})(n,e)&&(function(r,i){for(const s of r.filters)if(!s.matches(i))return!1;return!0})(n,e)&&(function(r,i){return!(r.startAt&&!(function(o,a,u){const h=g3(o,a,u);return o.inclusive?h<=0:h<0})(r.startAt,gd(r),i)||r.endAt&&!(function(o,a,u){const h=g3(o,a,u);return o.inclusive?h>=0:h>0})(r.endAt,gd(r),i))})(n,e)}function L$(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function xD(n){return(e,t)=>{let r=!1;for(const i of gd(n)){const s=U$(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function U$(n,e,t){const r=n.field.isKeyField()?Ue.comparator(e.key,t.key):(function(s,o,a){const u=o.data.field(s),h=a.data.field(s);return u!==null&&h!==null?Yu(u,h):je(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return je(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oc{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){sc(this.inner,((t,r)=>{for(const[i,s]of r)e(i,s)}))}isEmpty(){return aD(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V$=new Ht(Ue.comparator);function no(){return V$}const ED=new Ht(Ue.comparator);function nd(...n){let e=ED;for(const t of n)e=e.insert(t.key,t);return e}function AD(n){let e=ED;return n.forEach(((t,r)=>e=e.insert(t,r.overlayedDocument))),e}function Ol(){return md()}function SD(){return md()}function md(){return new oc((n=>n.toString()),((n,e)=>n.isEqual(e)))}const F$=new Ht(Ue.comparator),B$=new Tn(Ue.comparator);function st(...n){let e=B$;for(const t of n)e=e.add(t);return e}const z$=new Tn(it);function j$(){return z$}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TE(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ny(e)?"-0":e}}function RD(n){return{integerValue:""+n}}function H$(n,e){return g$(e)?RD(e):TE(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V_{constructor(){this._=void 0}}function $$(n,e,t){return n instanceof Hd?(function(i,s){const o={fields:{[uD]:{stringValue:cD},[fD]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&mE(s)&&(s=N_(s)),s&&(o.fields[hD]=s),{mapValue:o}})(t,e):n instanceof $d?ID(n,e):n instanceof Wd?PD(n,e):(function(i,s){const o=CD(i,s),a=v3(o)+v3(i.Ae);return gw(o)&&gw(i.Ae)?RD(a):TE(i.serializer,a)})(n,e)}function W$(n,e,t){return n instanceof $d?ID(n,e):n instanceof Wd?PD(n,e):t}function CD(n,e){return n instanceof Fy?(function(r){return gw(r)||(function(s){return!!s&&"doubleValue"in s})(r)})(e)?e:{integerValue:0}:null}class Hd extends V_{}class $d extends V_{constructor(e){super(),this.elements=e}}function ID(n,e){const t=MD(e);for(const r of n.elements)t.some((i=>fs(i,r)))||t.push(r);return{arrayValue:{values:t}}}class Wd extends V_{constructor(e){super(),this.elements=e}}function PD(n,e){let t=MD(e);for(const r of n.elements)t=t.filter((i=>!fs(i,r)));return{arrayValue:{values:t}}}class Fy extends V_{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function v3(n){return nn(n.integerValue||n.doubleValue)}function MD(n){return yE(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q${constructor(e,t){this.field=e,this.transform=t}}function X$(n,e){return n.field.isEqual(e.field)&&(function(r,i){return r instanceof $d&&i instanceof $d||r instanceof Wd&&i instanceof Wd?Xu(r.elements,i.elements,fs):r instanceof Fy&&i instanceof Fy?fs(r.Ae,i.Ae):r instanceof Hd&&i instanceof Hd})(n.transform,e.transform)}class Y${constructor(e,t){this.version=e,this.transformResults=t}}class Gs{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Gs}static exists(e){return new Gs(void 0,e)}static updateTime(e){return new Gs(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ey(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class F_{}function OD(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new ND(n.key,Gs.none()):new vp(n.key,n.data,Gs.none());{const t=n.data,r=ei.empty();let i=new Tn(zn.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new ac(n.key,r,new xi(i.toArray()),Gs.none())}}function K$(n,e,t){n instanceof vp?(function(i,s,o){const a=i.value.clone(),u=T3(i.fieldTransforms,s,o.transformResults);a.setAll(u),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()})(n,e,t):n instanceof ac?(function(i,s,o){if(!ey(i.precondition,s))return void s.convertToUnknownDocument(o.version);const a=T3(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(kD(i)),u.setAll(a),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()})(n,e,t):(function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()})(0,e,t)}function yd(n,e,t,r){return n instanceof vp?(function(s,o,a,u){if(!ey(s.precondition,o))return a;const h=s.value.clone(),d=w3(s.fieldTransforms,u,o);return h.setAll(d),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),null})(n,e,t,r):n instanceof ac?(function(s,o,a,u){if(!ey(s.precondition,o))return a;const h=w3(s.fieldTransforms,u,o),d=o.data;return d.setAll(kD(s)),d.setAll(h),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map((g=>g.field)))})(n,e,t,r):(function(s,o,a){return ey(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a})(n,e,t)}function G$(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),s=CD(r.transform,i||null);s!=null&&(t===null&&(t=ei.empty()),t.set(r.field,s))}return t||null}function b3(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Xu(r,i,((s,o)=>X$(s,o)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class vp extends F_{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class ac extends F_{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function kD(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}})),e}function T3(n,e,t){const r=new Map;mt(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let i=0;i<t.length;i++){const s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,W$(o,a,t[i]))}return r}function w3(n,e,t){const r=new Map;for(const i of n){const s=i.transform,o=t.data.field(i.field);r.set(i.field,$$(s,o,e))}return r}class ND extends F_{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Z$ extends F_{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q${constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&K$(s,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=yd(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=yd(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=SD();return this.mutations.forEach((i=>{const s=e.get(i.key),o=s.overlayedDocument;let a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;const u=OD(o,a);u!==null&&r.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(We.min())})),r}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),st())}isEqual(e){return this.batchId===e.batchId&&Xu(this.mutations,e.mutations,((t,r)=>b3(t,r)))&&Xu(this.baseMutations,e.baseMutations,((t,r)=>b3(t,r)))}}class wE{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){mt(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let i=(function(){return F$})();const s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new wE(e,t,r,i)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J${constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eW{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var an,ht;function tW(n){switch(n){case Te.OK:return je(64938);case Te.CANCELLED:case Te.UNKNOWN:case Te.DEADLINE_EXCEEDED:case Te.RESOURCE_EXHAUSTED:case Te.INTERNAL:case Te.UNAVAILABLE:case Te.UNAUTHENTICATED:return!1;case Te.INVALID_ARGUMENT:case Te.NOT_FOUND:case Te.ALREADY_EXISTS:case Te.PERMISSION_DENIED:case Te.FAILED_PRECONDITION:case Te.ABORTED:case Te.OUT_OF_RANGE:case Te.UNIMPLEMENTED:case Te.DATA_LOSS:return!0;default:return je(15467,{code:n})}}function DD(n){if(n===void 0)return to("GRPC error has no .code"),Te.UNKNOWN;switch(n){case an.OK:return Te.OK;case an.CANCELLED:return Te.CANCELLED;case an.UNKNOWN:return Te.UNKNOWN;case an.DEADLINE_EXCEEDED:return Te.DEADLINE_EXCEEDED;case an.RESOURCE_EXHAUSTED:return Te.RESOURCE_EXHAUSTED;case an.INTERNAL:return Te.INTERNAL;case an.UNAVAILABLE:return Te.UNAVAILABLE;case an.UNAUTHENTICATED:return Te.UNAUTHENTICATED;case an.INVALID_ARGUMENT:return Te.INVALID_ARGUMENT;case an.NOT_FOUND:return Te.NOT_FOUND;case an.ALREADY_EXISTS:return Te.ALREADY_EXISTS;case an.PERMISSION_DENIED:return Te.PERMISSION_DENIED;case an.FAILED_PRECONDITION:return Te.FAILED_PRECONDITION;case an.ABORTED:return Te.ABORTED;case an.OUT_OF_RANGE:return Te.OUT_OF_RANGE;case an.UNIMPLEMENTED:return Te.UNIMPLEMENTED;case an.DATA_LOSS:return Te.DATA_LOSS;default:return je(39323,{code:n})}}(ht=an||(an={}))[ht.OK=0]="OK",ht[ht.CANCELLED=1]="CANCELLED",ht[ht.UNKNOWN=2]="UNKNOWN",ht[ht.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ht[ht.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ht[ht.NOT_FOUND=5]="NOT_FOUND",ht[ht.ALREADY_EXISTS=6]="ALREADY_EXISTS",ht[ht.PERMISSION_DENIED=7]="PERMISSION_DENIED",ht[ht.UNAUTHENTICATED=16]="UNAUTHENTICATED",ht[ht.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ht[ht.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ht[ht.ABORTED=10]="ABORTED",ht[ht.OUT_OF_RANGE=11]="OUT_OF_RANGE",ht[ht.UNIMPLEMENTED=12]="UNIMPLEMENTED",ht[ht.INTERNAL=13]="INTERNAL",ht[ht.UNAVAILABLE=14]="UNAVAILABLE",ht[ht.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nW(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rW=new Ta([4294967295,4294967295],0);function x3(n){const e=nW().encode(n),t=new ZN;return t.update(e),new Uint8Array(t.digest())}function E3(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Ta([t,r],0),new Ta([i,s],0)]}class xE{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new rd(`Invalid padding: ${t}`);if(r<0)throw new rd(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new rd(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new rd(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Ta.fromNumber(this.ge)}ye(e,t,r){let i=e.add(t.multiply(Ta.fromNumber(r)));return i.compare(rW)===1&&(i=new Ta([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=x3(e),[r,i]=E3(t);for(let s=0;s<this.hashCount;s++){const o=this.ye(r,i,s);if(!this.we(o))return!1}return!0}static create(e,t,r){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new xE(s,i,t);return r.forEach((a=>o.insert(a))),o}insert(e){if(this.ge===0)return;const t=x3(e),[r,i]=E3(t);for(let s=0;s<this.hashCount;s++){const o=this.ye(r,i,s);this.Se(o)}}Se(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class rd extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B_{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,bp.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new B_(We.min(),i,new Ht(it),no(),st())}}class bp{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new bp(r,t,st(),st(),st())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ty{constructor(e,t,r,i){this.be=e,this.removedTargetIds=t,this.key=r,this.De=i}}class LD{constructor(e,t){this.targetId=e,this.Ce=t}}class UD{constructor(e,t,r=Hn.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class A3{constructor(){this.ve=0,this.Fe=S3(),this.Me=Hn.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=st(),t=st(),r=st();return this.Fe.forEach(((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:je(38017,{changeType:s})}})),new bp(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=S3()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,mt(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class iW{constructor(e){this.Ge=e,this.ze=new Map,this.je=no(),this.Je=sm(),this.He=sm(),this.Ye=new Ht(it)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:je(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((r,i)=>{this.rt(i)&&t(i)}))}st(e){const t=e.targetId,r=e.Ce.count,i=this.ot(t);if(i){const s=i.target;if(yw(s))if(r===0){const o=new Ue(s.path);this.et(t,o,tr.newNoDocument(o,We.min()))}else mt(r===1,20013,{expectedCount:r});else{const o=this._t(t);if(o!==r){const a=this.ut(e),u=a?this.ct(a,e,o):1;if(u!==0){this.it(t);const h=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,h)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t;let o,a;try{o=Ia(r).toUint8Array()}catch(u){if(u instanceof lD)return qu("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{a=new xE(o,i,s)}catch(u){return qu(u instanceof rd?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return a.ge===0?null:a}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let i=0;return r.forEach((s=>{const o=this.Ge.ht(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.et(t,s,null),i++)})),i}Tt(e){const t=new Map;this.ze.forEach(((s,o)=>{const a=this.ot(o);if(a){if(s.current&&yw(a.target)){const u=new Ue(a.target.path);this.It(u).has(o)||this.Et(o,u)||this.et(o,u,tr.newNoDocument(u,e))}s.Be&&(t.set(o,s.ke()),s.qe())}}));let r=st();this.He.forEach(((s,o)=>{let a=!0;o.forEachWhile((u=>{const h=this.ot(u);return!h||h.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)})),a&&(r=r.add(s))})),this.je.forEach(((s,o)=>o.setReadTime(e)));const i=new B_(e,t,this.Ye,this.je,r);return this.je=no(),this.Je=sm(),this.He=sm(),this.Ye=new Ht(it),i}Xe(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const i=this.nt(e);this.Et(e,t)?i.Qe(t,1):i.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new A3,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new Tn(it),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new Tn(it),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||Ie("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new A3),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function sm(){return new Ht(Ue.comparator)}function S3(){return new Ht(Ue.comparator)}const sW={asc:"ASCENDING",desc:"DESCENDING"},oW={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},aW={and:"AND",or:"OR"};class lW{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function vw(n,e){return n.useProto3Json||k_(e)?e:{value:e}}function By(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function VD(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function cW(n,e){return By(n,e.toTimestamp())}function ss(n){return mt(!!n,49232),We.fromTimestamp((function(t){const r=Ca(t);return new kt(r.seconds,r.nanos)})(n))}function EE(n,e){return bw(n,e).canonicalString()}function bw(n,e){const t=(function(i){return new Ft(["projects",i.projectId,"databases",i.database])})(n).child("documents");return e===void 0?t:t.child(e)}function FD(n){const e=Ft.fromString(n);return mt($D(e),10190,{key:e.toString()}),e}function Tw(n,e){return EE(n.databaseId,e.path)}function N0(n,e){const t=FD(e);if(t.get(1)!==n.databaseId.projectId)throw new Le(Te.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new Le(Te.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Ue(zD(t))}function BD(n,e){return EE(n.databaseId,e)}function uW(n){const e=FD(n);return e.length===4?Ft.emptyPath():zD(e)}function ww(n){return new Ft(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function zD(n){return mt(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function R3(n,e,t){return{name:Tw(n,e),fields:t.value.mapValue.fields}}function hW(n,e){let t;if("targetChange"in e){e.targetChange;const r=(function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:je(39313,{state:h})})(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=(function(h,d){return h.useProto3Json?(mt(d===void 0||typeof d=="string",58123),Hn.fromBase64String(d||"")):(mt(d===void 0||d instanceof Buffer||d instanceof Uint8Array,16193),Hn.fromUint8Array(d||new Uint8Array))})(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&(function(h){const d=h.code===void 0?Te.UNKNOWN:DD(h.code);return new Le(d,h.message||"")})(o);t=new UD(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=N0(n,r.document.name),s=ss(r.document.updateTime),o=r.document.createTime?ss(r.document.createTime):We.min(),a=new ei({mapValue:{fields:r.document.fields}}),u=tr.newFoundDocument(i,s,o,a),h=r.targetIds||[],d=r.removedTargetIds||[];t=new ty(h,d,u.key,u)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=N0(n,r.document),s=r.readTime?ss(r.readTime):We.min(),o=tr.newNoDocument(i,s),a=r.removedTargetIds||[];t=new ty([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=N0(n,r.document),s=r.removedTargetIds||[];t=new ty([],s,i,null)}else{if(!("filter"in e))return je(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:s}=r,o=new eW(i,s),a=r.targetId;t=new LD(a,o)}}return t}function fW(n,e){let t;if(e instanceof vp)t={update:R3(n,e.key,e.value)};else if(e instanceof ND)t={delete:Tw(n,e.key)};else if(e instanceof ac)t={update:R3(n,e.key,e.data),updateMask:TW(e.fieldMask)};else{if(!(e instanceof Z$))return je(16599,{Vt:e.type});t={verify:Tw(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((r=>(function(s,o){const a=o.transform;if(a instanceof Hd)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof $d)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Wd)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Fy)return{fieldPath:o.field.canonicalString(),increment:a.Ae};throw je(20930,{transform:o.transform})})(0,r)))),e.precondition.isNone||(t.currentDocument=(function(i,s){return s.updateTime!==void 0?{updateTime:cW(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:je(27497)})(n,e.precondition)),t}function dW(n,e){return n&&n.length>0?(mt(e!==void 0,14353),n.map((t=>(function(i,s){let o=i.updateTime?ss(i.updateTime):ss(s);return o.isEqual(We.min())&&(o=ss(s)),new Y$(o,i.transformResults||[])})(t,e)))):[]}function pW(n,e){return{documents:[BD(n,e.path)]}}function gW(n,e){const t={structuredQuery:{}},r=e.path;let i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=BD(n,i);const s=(function(h){if(h.length!==0)return HD(ds.create(h,"and"))})(e.filters);s&&(t.structuredQuery.where=s);const o=(function(h){if(h.length!==0)return h.map((d=>(function(y){return{field:gu(y.field),direction:_W(y.dir)}})(d)))})(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=vw(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=(function(h){return{before:h.inclusive,values:h.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(h){return{before:!h.inclusive,values:h.position}})(e.endAt)),{ft:t,parent:i}}function mW(n){let e=uW(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){mt(r===1,65062);const d=t.from[0];d.allDescendants?i=d.collectionId:e=e.child(d.collectionId)}let s=[];t.where&&(s=(function(g){const y=jD(g);return y instanceof ds&&_D(y)?y.getFilters():[y]})(t.where));let o=[];t.orderBy&&(o=(function(g){return g.map((y=>(function(T){return new Vy(mu(T.field),(function(E){switch(E){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(T.direction))})(y)))})(t.orderBy));let a=null;t.limit&&(a=(function(g){let y;return y=typeof g=="object"?g.value:g,k_(y)?null:y})(t.limit));let u=null;t.startAt&&(u=(function(g){const y=!!g.before,v=g.values||[];return new Uy(v,y)})(t.startAt));let h=null;return t.endAt&&(h=(function(g){const y=!g.before,v=g.values||[];return new Uy(v,y)})(t.endAt)),k$(e,i,o,s,a,"F",u,h)}function yW(n,e){const t=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return je(28987,{purpose:i})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function jD(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=mu(t.unaryFilter.field);return bn.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=mu(t.unaryFilter.field);return bn.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=mu(t.unaryFilter.field);return bn.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=mu(t.unaryFilter.field);return bn.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return je(61313);default:return je(60726)}})(n):n.fieldFilter!==void 0?(function(t){return bn.create(mu(t.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return je(58110);default:return je(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return ds.create(t.compositeFilter.filters.map((r=>jD(r))),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return je(1026)}})(t.compositeFilter.op))})(n):je(30097,{filter:n})}function _W(n){return sW[n]}function vW(n){return oW[n]}function bW(n){return aW[n]}function gu(n){return{fieldPath:n.canonicalString()}}function mu(n){return zn.fromServerFormat(n.fieldPath)}function HD(n){return n instanceof bn?(function(t){if(t.op==="=="){if(p3(t.value))return{unaryFilter:{field:gu(t.field),op:"IS_NAN"}};if(d3(t.value))return{unaryFilter:{field:gu(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(p3(t.value))return{unaryFilter:{field:gu(t.field),op:"IS_NOT_NAN"}};if(d3(t.value))return{unaryFilter:{field:gu(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:gu(t.field),op:vW(t.op),value:t.value}}})(n):n instanceof ds?(function(t){const r=t.getFilters().map((i=>HD(i)));return r.length===1?r[0]:{compositeFilter:{op:bW(t.op),filters:r}}})(n):je(54877,{filter:n})}function TW(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function $D(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class da{constructor(e,t,r,i,s=We.min(),o=We.min(),a=Hn.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=u}withSequenceNumber(e){return new da(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new da(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new da(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new da(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wW{constructor(e){this.yt=e}}function xW(n){const e=mW({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?_w(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EW{constructor(){this.Cn=new AW}addToCollectionParentIndex(e,t){return this.Cn.add(t),be.resolve()}getCollectionParents(e,t){return be.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return be.resolve()}deleteFieldIndex(e,t){return be.resolve()}deleteAllFieldIndexes(e){return be.resolve()}createTargetIndexes(e,t){return be.resolve()}getDocumentsMatchingTarget(e,t){return be.resolve(null)}getIndexType(e,t){return be.resolve(0)}getFieldIndexes(e,t){return be.resolve([])}getNextCollectionGroupToUpdate(e){return be.resolve(null)}getMinOffset(e,t){return be.resolve(Ra.min())}getMinOffsetFromCollectionGroup(e,t){return be.resolve(Ra.min())}updateCollectionGroup(e,t,r){return be.resolve()}updateIndexEntries(e,t){return be.resolve()}}class AW{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new Tn(Ft.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Tn(Ft.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C3={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},WD=41943040;class vr{static withCacheSize(e){return new vr(e,vr.DEFAULT_COLLECTION_PERCENTILE,vr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */vr.DEFAULT_COLLECTION_PERCENTILE=10,vr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,vr.DEFAULT=new vr(WD,vr.DEFAULT_COLLECTION_PERCENTILE,vr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),vr.DISABLED=new vr(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gu{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Gu(0)}static cr(){return new Gu(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I3="LruGarbageCollector",SW=1048576;function P3([n,e],[t,r]){const i=it(n,t);return i===0?it(e,r):i}class RW{constructor(e){this.Ir=e,this.buffer=new Tn(P3),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();P3(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class CW{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){Ie(I3,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Th(t)?Ie(I3,"Ignoring IndexedDB error during garbage collection: ",t):await bh(t)}await this.Vr(3e5)}))}}class IW{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((r=>Math.floor(t/100*r)))}nthSequenceNumber(e,t){if(t===0)return be.resolve(O_.ce);const r=new RW(t);return this.mr.forEachTarget(e,(i=>r.Ar(i.sequenceNumber))).next((()=>this.mr.pr(e,(i=>r.Ar(i))))).next((()=>r.maxValue))}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(Ie("LruGarbageCollector","Garbage collection skipped; disabled"),be.resolve(C3)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(Ie("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),C3):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,i,s,o,a,u,h;const d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((g=>(g>this.params.maximumSequenceNumbersToCollect?(Ie("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),i=this.params.maximumSequenceNumbersToCollect):i=g,o=Date.now(),this.nthSequenceNumber(e,i)))).next((g=>(r=g,a=Date.now(),this.removeTargets(e,r,t)))).next((g=>(s=g,u=Date.now(),this.removeOrphanedDocuments(e,r)))).next((g=>(h=Date.now(),du()<=rt.DEBUG&&Ie("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${i} in `+(a-o)+`ms
	Removed ${s} targets in `+(u-a)+`ms
	Removed ${g} documents in `+(h-u)+`ms
Total Duration: ${h-d}ms`),be.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:g}))))}}function PW(n,e){return new IW(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MW{constructor(){this.changes=new oc((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,tr.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?be.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OW{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kW{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next((i=>(r=i,this.remoteDocumentCache.getEntry(e,t)))).next((i=>(r!==null&&yd(r.mutation,i,xi.empty(),kt.now()),i)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.getLocalViewOfDocuments(e,r,st()).next((()=>r))))}getLocalViewOfDocuments(e,t,r=st()){const i=Ol();return this.populateOverlays(e,i,t).next((()=>this.computeViews(e,t,i,r).next((s=>{let o=nd();return s.forEach(((a,u)=>{o=o.insert(a,u.overlayedDocument)})),o}))))}getOverlayedDocuments(e,t){const r=Ol();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,st())))}populateOverlays(e,t,r){const i=[];return r.forEach((s=>{t.has(s)||i.push(s)})),this.documentOverlayCache.getOverlays(e,i).next((s=>{s.forEach(((o,a)=>{t.set(o,a)}))}))}computeViews(e,t,r,i){let s=no();const o=md(),a=(function(){return md()})();return t.forEach(((u,h)=>{const d=r.get(h.key);i.has(h.key)&&(d===void 0||d.mutation instanceof ac)?s=s.insert(h.key,h):d!==void 0?(o.set(h.key,d.mutation.getFieldMask()),yd(d.mutation,h,d.mutation.getFieldMask(),kt.now())):o.set(h.key,xi.empty())})),this.recalculateAndSaveOverlays(e,s).next((u=>(u.forEach(((h,d)=>o.set(h,d))),t.forEach(((h,d)=>a.set(h,new OW(d,o.get(h)??null)))),a)))}recalculateAndSaveOverlays(e,t){const r=md();let i=new Ht(((o,a)=>o-a)),s=st();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((o=>{for(const a of o)a.keys().forEach((u=>{const h=t.get(u);if(h===null)return;let d=r.get(u)||xi.empty();d=a.applyToLocalView(h,d),r.set(u,d);const g=(i.get(a.batchId)||st()).add(u);i=i.insert(a.batchId,g)}))})).next((()=>{const o=[],a=i.getReverseIterator();for(;a.hasNext();){const u=a.getNext(),h=u.key,d=u.value,g=SD();d.forEach((y=>{if(!s.has(y)){const v=OD(t.get(y),r.get(y));v!==null&&g.set(y,v),s=s.add(y)}})),o.push(this.documentOverlayCache.saveOverlays(e,h,g))}return be.waitFor(o)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,t,r,i){return(function(o){return Ue.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):N$(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next((s=>{const o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):be.resolve(Ol());let a=Fd,u=s;return o.next((h=>be.forEach(h,((d,g)=>(a<g.largestBatchId&&(a=g.largestBatchId),s.get(d)?be.resolve():this.remoteDocumentCache.getEntry(e,d).next((y=>{u=u.insert(d,y)}))))).next((()=>this.populateOverlays(e,h,s))).next((()=>this.computeViews(e,u,h,st()))).next((d=>({batchId:a,changes:AD(d)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Ue(t)).next((r=>{let i=nd();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i}))}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){const s=t.collectionGroup;let o=nd();return this.indexManager.getCollectionParents(e,s).next((a=>be.forEach(a,(u=>{const h=(function(g,y){return new D_(y,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)})(t,u.child(s));return this.getDocumentsMatchingCollectionQuery(e,h,r,i).next((d=>{d.forEach(((g,y)=>{o=o.insert(g,y)}))}))})).next((()=>o))))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next((o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i)))).next((o=>{s.forEach(((u,h)=>{const d=h.getKey();o.get(d)===null&&(o=o.insert(d,tr.newInvalidDocument(d)))}));let a=nd();return o.forEach(((u,h)=>{const d=s.get(u);d!==void 0&&yd(d.mutation,h,xi.empty(),kt.now()),U_(t,h)&&(a=a.insert(u,h))})),a}))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NW{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return be.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(i){return{id:i.id,version:i.version,createTime:ss(i.createTime)}})(t)),be.resolve()}getNamedQuery(e,t){return be.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(i){return{name:i.name,query:xW(i.bundledQuery),readTime:ss(i.readTime)}})(t)),be.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DW{constructor(){this.overlays=new Ht(Ue.comparator),this.qr=new Map}getOverlay(e,t){return be.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Ol();return be.forEach(t,(i=>this.getOverlay(e,i).next((s=>{s!==null&&r.set(i,s)})))).next((()=>r))}saveOverlays(e,t,r){return r.forEach(((i,s)=>{this.St(e,t,s)})),be.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.qr.get(r);return i!==void 0&&(i.forEach((s=>this.overlays=this.overlays.remove(s))),this.qr.delete(r)),be.resolve()}getOverlaysForCollection(e,t,r){const i=Ol(),s=t.length+1,o=new Ue(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const u=a.getNext().value,h=u.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===s&&u.largestBatchId>r&&i.set(u.getKey(),u)}return be.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new Ht(((h,d)=>h-d));const o=this.overlays.getIterator();for(;o.hasNext();){const h=o.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>r){let d=s.get(h.largestBatchId);d===null&&(d=Ol(),s=s.insert(h.largestBatchId,d)),d.set(h.getKey(),h)}}const a=Ol(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach(((h,d)=>a.set(h,d))),!(a.size()>=i)););return be.resolve(a)}St(e,t,r){const i=this.overlays.get(r.key);if(i!==null){const o=this.qr.get(i.largestBatchId).delete(r.key);this.qr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new J$(t,r));let s=this.qr.get(t);s===void 0&&(s=st(),this.qr.set(t,s)),this.qr.set(t,s.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LW{constructor(){this.sessionToken=Hn.EMPTY_BYTE_STRING}getSessionToken(e){return be.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,be.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AE{constructor(){this.Qr=new Tn(Pn.$r),this.Ur=new Tn(Pn.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const r=new Pn(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach((r=>this.addReference(r,t)))}removeReference(e,t){this.Gr(new Pn(e,t))}zr(e,t){e.forEach((r=>this.removeReference(r,t)))}jr(e){const t=new Ue(new Ft([])),r=new Pn(t,e),i=new Pn(t,e+1),s=[];return this.Ur.forEachInRange([r,i],(o=>{this.Gr(o),s.push(o.key)})),s}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new Ue(new Ft([])),r=new Pn(t,e),i=new Pn(t,e+1);let s=st();return this.Ur.forEachInRange([r,i],(o=>{s=s.add(o.key)})),s}containsKey(e){const t=new Pn(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class Pn{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return Ue.comparator(e.key,t.key)||it(e.Yr,t.Yr)}static Kr(e,t){return it(e.Yr,t.Yr)||Ue.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UW{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new Tn(Pn.$r)}checkEmpty(e){return be.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){const s=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Q$(s,t,r,i);this.mutationQueue.push(o);for(const a of i)this.Zr=this.Zr.add(new Pn(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return be.resolve(o)}lookupMutationBatch(e,t){return be.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=this.ei(r),s=i<0?0:i;return be.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return be.resolve(this.mutationQueue.length===0?gE:this.tr-1)}getAllMutationBatches(e){return be.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Pn(t,0),i=new Pn(t,Number.POSITIVE_INFINITY),s=[];return this.Zr.forEachInRange([r,i],(o=>{const a=this.Xr(o.Yr);s.push(a)})),be.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Tn(it);return t.forEach((i=>{const s=new Pn(i,0),o=new Pn(i,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([s,o],(a=>{r=r.add(a.Yr)}))})),be.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let s=r;Ue.isDocumentKey(s)||(s=s.child(""));const o=new Pn(new Ue(s),0);let a=new Tn(it);return this.Zr.forEachWhile((u=>{const h=u.key.path;return!!r.isPrefixOf(h)&&(h.length===i&&(a=a.add(u.Yr)),!0)}),o),be.resolve(this.ti(a))}ti(e){const t=[];return e.forEach((r=>{const i=this.Xr(r);i!==null&&t.push(i)})),t}removeMutationBatch(e,t){mt(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return be.forEach(t.mutations,(i=>{const s=new Pn(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,t){const r=new Pn(t,0),i=this.Zr.firstAfterOrEqual(r);return be.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,be.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VW{constructor(e){this.ri=e,this.docs=(function(){return new Ht(Ue.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return be.resolve(r?r.document.mutableCopy():tr.newInvalidDocument(t))}getEntries(e,t){let r=no();return t.forEach((i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():tr.newInvalidDocument(i))})),be.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=no();const o=t.path,a=new Ue(o.child("__id-9223372036854775808__")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){const{key:h,value:{document:d}}=u.getNext();if(!o.isPrefixOf(h.path))break;h.path.length>o.length+1||h$(u$(d),r)<=0||(i.has(d.key)||U_(t,d))&&(s=s.insert(d.key,d.mutableCopy()))}return be.resolve(s)}getAllFromCollectionGroup(e,t,r,i){je(9500)}ii(e,t){return be.forEach(this.docs,(r=>t(r)))}newChangeBuffer(e){return new FW(this)}getSize(e){return be.resolve(this.size)}}class FW extends MW{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((r,i)=>{i.isValidDocument()?t.push(this.Nr.addEntry(e,i)):this.Nr.removeEntry(r)})),be.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BW{constructor(e){this.persistence=e,this.si=new oc((t=>_E(t)),vE),this.lastRemoteSnapshotVersion=We.min(),this.highestTargetId=0,this.oi=0,this._i=new AE,this.targetCount=0,this.ai=Gu.ur()}forEachTarget(e,t){return this.si.forEach(((r,i)=>t(i))),be.resolve()}getLastRemoteSnapshotVersion(e){return be.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return be.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),be.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),be.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Gu(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,be.resolve()}updateTargetData(e,t){return this.Pr(t),be.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,be.resolve()}removeTargets(e,t,r){let i=0;const s=[];return this.si.forEach(((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.si.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)})),be.waitFor(s).next((()=>i))}getTargetCount(e){return be.resolve(this.targetCount)}getTargetData(e,t){const r=this.si.get(t)||null;return be.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),be.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach((o=>{s.push(i.markPotentiallyOrphaned(e,o))})),be.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),be.resolve()}getMatchingKeysForTargetId(e,t){const r=this._i.Hr(t);return be.resolve(r)}containsKey(e,t){return be.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qD{constructor(e,t){this.ui={},this.overlays={},this.ci=new O_(0),this.li=!1,this.li=!0,this.hi=new LW,this.referenceDelegate=e(this),this.Pi=new BW(this),this.indexManager=new EW,this.remoteDocumentCache=(function(i){return new VW(i)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new wW(t),this.Ii=new NW(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new DW,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new UW(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){Ie("MemoryPersistence","Starting transaction:",e);const i=new zW(this.ci.next());return this.referenceDelegate.Ei(),r(i).next((s=>this.referenceDelegate.di(i).next((()=>s)))).toPromise().then((s=>(i.raiseOnCommittedEvent(),s)))}Ai(e,t){return be.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,t))))}}class zW extends d${constructor(e){super(),this.currentSequenceNumber=e}}class SE{constructor(e){this.persistence=e,this.Ri=new AE,this.Vi=null}static mi(e){return new SE(e)}get fi(){if(this.Vi)return this.Vi;throw je(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),be.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),be.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),be.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((i=>this.fi.add(i.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((i=>{i.forEach((s=>this.fi.add(s.toString())))})).next((()=>r.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return be.forEach(this.fi,(r=>{const i=Ue.fromPath(r);return this.gi(e,i).next((s=>{s||t.removeEntry(i,We.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return be.or([()=>be.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class zy{constructor(e,t){this.persistence=e,this.pi=new oc((r=>m$(r.path)),((r,i)=>r.isEqual(i))),this.garbageCollector=PW(this,t)}static mi(e,t){return new zy(e,t)}Ei(){}di(e){return be.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>t.next((i=>r+i))))}wr(e){let t=0;return this.pr(e,(r=>{t++})).next((()=>t))}pr(e,t){return be.forEach(this.pi,((r,i)=>this.br(e,r,i).next((s=>s?be.resolve():t(i)))))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.ii(e,(o=>this.br(e,o,t).next((a=>{a||(r++,s.removeEntry(o,We.min()))})))).next((()=>s.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),be.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),be.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),be.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),be.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Qm(e.data.value)),t}br(e,t,r){return be.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const i=this.pi.get(t);return be.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RE{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=i}static As(e,t){let r=st(),i=st();for(const s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new RE(e,t.fromCache,r,i)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jW{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HW{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return m9()?8:p$(rr())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,i){const s={result:null};return this.ys(e,t).next((o=>{s.result=o})).next((()=>{if(!s.result)return this.ws(e,t,i,r).next((o=>{s.result=o}))})).next((()=>{if(s.result)return;const o=new jW;return this.Ss(e,t,o).next((a=>{if(s.result=a,this.Vs)return this.bs(e,t,o,a.size)}))})).next((()=>s.result))}bs(e,t,r,i){return r.documentReadCount<this.fs?(du()<=rt.DEBUG&&Ie("QueryEngine","SDK will not create cache indexes for query:",pu(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),be.resolve()):(du()<=rt.DEBUG&&Ie("QueryEngine","Query:",pu(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.gs*i?(du()<=rt.DEBUG&&Ie("QueryEngine","The SDK decides to create cache indexes for query:",pu(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,is(t))):be.resolve())}ys(e,t){if(_3(t))return be.resolve(null);let r=is(t);return this.indexManager.getIndexType(e,r).next((i=>i===0?null:(t.limit!==null&&i===1&&(t=_w(t,null,"F"),r=is(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next((s=>{const o=st(...s);return this.ps.getDocuments(e,o).next((a=>this.indexManager.getMinOffset(e,r).next((u=>{const h=this.Ds(t,a);return this.Cs(t,h,o,u.readTime)?this.ys(e,_w(t,null,"F")):this.vs(e,h,t,u)}))))})))))}ws(e,t,r,i){return _3(t)||i.isEqual(We.min())?be.resolve(null):this.ps.getDocuments(e,r).next((s=>{const o=this.Ds(t,s);return this.Cs(t,o,r,i)?be.resolve(null):(du()<=rt.DEBUG&&Ie("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),pu(t)),this.vs(e,o,t,c$(i,Fd)).next((a=>a)))}))}Ds(e,t){let r=new Tn(xD(e));return t.forEach(((i,s)=>{U_(e,s)&&(r=r.add(s))})),r}Cs(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ss(e,t,r){return du()<=rt.DEBUG&&Ie("QueryEngine","Using full collection scan to execute query:",pu(t)),this.ps.getDocumentsMatchingQuery(e,t,Ra.min(),r)}vs(e,t,r,i){return this.ps.getDocumentsMatchingQuery(e,r,i).next((s=>(t.forEach((o=>{s=s.insert(o.key,o)})),s)))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CE="LocalStore",$W=3e8;class WW{constructor(e,t,r,i){this.persistence=e,this.Fs=t,this.serializer=i,this.Ms=new Ht(it),this.xs=new oc((s=>_E(s)),vE),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new kW(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function qW(n,e,t,r){return new WW(n,e,t,r)}async function XD(n,e){const t=Xe(n);return await t.persistence.runTransaction("Handle user change","readonly",(r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next((s=>(i=s,t.Bs(e),t.mutationQueue.getAllMutationBatches(r)))).next((s=>{const o=[],a=[];let u=st();for(const h of i){o.push(h.batchId);for(const d of h.mutations)u=u.add(d.key)}for(const h of s){a.push(h.batchId);for(const d of h.mutations)u=u.add(d.key)}return t.localDocuments.getDocuments(r,u).next((h=>({Ls:h,removedBatchIds:o,addedBatchIds:a})))}))}))}function XW(n,e){const t=Xe(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const i=e.batch.keys(),s=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(a,u,h,d){const g=h.batch,y=g.keys();let v=be.resolve();return y.forEach((T=>{v=v.next((()=>d.getEntry(u,T))).next((w=>{const E=h.docVersions.get(T);mt(E!==null,48541),w.version.compareTo(E)<0&&(g.applyToRemoteDocument(w,h),w.isValidDocument()&&(w.setReadTime(h.commitVersion),d.addEntry(w)))}))})),v.next((()=>a.mutationQueue.removeMutationBatch(u,g)))})(t,r,e,s).next((()=>s.apply(r))).next((()=>t.mutationQueue.performConsistencyCheck(r))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(a){let u=st();for(let h=0;h<a.mutationResults.length;++h)a.mutationResults[h].transformResults.length>0&&(u=u.add(a.batch.mutations[h].key));return u})(e)))).next((()=>t.localDocuments.getDocuments(r,i)))}))}function YD(n){const e=Xe(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function YW(n,e){const t=Xe(n),r=e.snapshotVersion;let i=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(s=>{const o=t.Ns.newChangeBuffer({trackRemovals:!0});i=t.Ms;const a=[];e.targetChanges.forEach(((d,g)=>{const y=i.get(g);if(!y)return;a.push(t.Pi.removeMatchingKeys(s,d.removedDocuments,g).next((()=>t.Pi.addMatchingKeys(s,d.addedDocuments,g))));let v=y.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(g)!==null?v=v.withResumeToken(Hn.EMPTY_BYTE_STRING,We.min()).withLastLimboFreeSnapshotVersion(We.min()):d.resumeToken.approximateByteSize()>0&&(v=v.withResumeToken(d.resumeToken,r)),i=i.insert(g,v),(function(w,E,S){return w.resumeToken.approximateByteSize()===0||E.snapshotVersion.toMicroseconds()-w.snapshotVersion.toMicroseconds()>=$W?!0:S.addedDocuments.size+S.modifiedDocuments.size+S.removedDocuments.size>0})(y,v,d)&&a.push(t.Pi.updateTargetData(s,v))}));let u=no(),h=st();if(e.documentUpdates.forEach((d=>{e.resolvedLimboDocuments.has(d)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,d))})),a.push(KW(s,o,e.documentUpdates).next((d=>{u=d.ks,h=d.qs}))),!r.isEqual(We.min())){const d=t.Pi.getLastRemoteSnapshotVersion(s).next((g=>t.Pi.setTargetsMetadata(s,s.currentSequenceNumber,r)));a.push(d)}return be.waitFor(a).next((()=>o.apply(s))).next((()=>t.localDocuments.getLocalViewOfDocuments(s,u,h))).next((()=>u))})).then((s=>(t.Ms=i,s)))}function KW(n,e,t){let r=st(),i=st();return t.forEach((s=>r=r.add(s))),e.getEntries(n,r).next((s=>{let o=no();return t.forEach(((a,u)=>{const h=s.get(a);u.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(a)),u.isNoDocument()&&u.version.isEqual(We.min())?(e.removeEntry(a,u.readTime),o=o.insert(a,u)):!h.isValidDocument()||u.version.compareTo(h.version)>0||u.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(u),o=o.insert(a,u)):Ie(CE,"Ignoring outdated watch update for ",a,". Current version:",h.version," Watch version:",u.version)})),{ks:o,qs:i}}))}function GW(n,e){const t=Xe(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=gE),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function ZW(n,e){const t=Xe(n);return t.persistence.runTransaction("Allocate target","readwrite",(r=>{let i;return t.Pi.getTargetData(r,e).next((s=>s?(i=s,be.resolve(i)):t.Pi.allocateTargetId(r).next((o=>(i=new da(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,i).next((()=>i)))))))})).then((r=>{const i=t.Ms.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r}))}async function xw(n,e,t){const r=Xe(n),i=r.Ms.get(e),s=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",s,(o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!Th(o))throw o;Ie(CE,`Failed to update sequence numbers for target ${e}: ${o}`)}r.Ms=r.Ms.remove(e),r.xs.delete(i.target)}function M3(n,e,t){const r=Xe(n);let i=We.min(),s=st();return r.persistence.runTransaction("Execute query","readwrite",(o=>(function(u,h,d){const g=Xe(u),y=g.xs.get(d);return y!==void 0?be.resolve(g.Ms.get(y)):g.Pi.getTargetData(h,d)})(r,o,is(e)).next((a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(o,a.targetId).next((u=>{s=u}))})).next((()=>r.Fs.getDocumentsMatchingQuery(o,e,t?i:We.min(),t?s:st()))).next((a=>(QW(r,L$(e),a),{documents:a,Qs:s})))))}function QW(n,e,t){let r=n.Os.get(e)||We.min();t.forEach(((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)})),n.Os.set(e,r)}class O3{constructor(){this.activeTargetIds=j$()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class JW{constructor(){this.Mo=new O3,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new O3,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eq{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k3="ConnectivityMonitor";class N3{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Ie(k3,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){Ie(k3,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let om=null;function Ew(){return om===null?om=(function(){return 268435456+Math.round(2147483648*Math.random())})():om++,"0x"+om.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D0="RestConnection",tq={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class nq{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${i}`,this.Wo=this.databaseId.database===Dy?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Go(e,t,r,i,s){const o=Ew(),a=this.zo(e,t.toUriEncodedString());Ie(D0,`Sending RPC '${e}' ${o}:`,a,r);const u={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(u,i,s);const{host:h}=new URL(a),d=mh(h);return this.Jo(e,a,u,r,d).then((g=>(Ie(D0,`Received RPC '${e}' ${o}: `,g),g)),(g=>{throw qu(D0,`RPC '${e}' ${o} failed with error: `,g,"url: ",a,"request:",r),g}))}Ho(e,t,r,i,s,o){return this.Go(e,t,r,i,s)}jo(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+vh})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((i,s)=>e[s]=i)),r&&r.headers.forEach(((i,s)=>e[s]=i))}zo(e,t){const r=tq[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rq{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yn="WebChannelConnection";class iq extends nq{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,i,s){const o=Ew();return new Promise(((a,u)=>{const h=new QN;h.setWithCredentials(!0),h.listenOnce(JN.COMPLETE,(()=>{try{switch(h.getLastErrorCode()){case Zm.NO_ERROR:const g=h.getResponseJson();Ie(Yn,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(g)),a(g);break;case Zm.TIMEOUT:Ie(Yn,`RPC '${e}' ${o} timed out`),u(new Le(Te.DEADLINE_EXCEEDED,"Request time out"));break;case Zm.HTTP_ERROR:const y=h.getStatus();if(Ie(Yn,`RPC '${e}' ${o} failed with status:`,y,"response text:",h.getResponseText()),y>0){let v=h.getResponseJson();Array.isArray(v)&&(v=v[0]);const T=v?.error;if(T&&T.status&&T.message){const w=(function(S){const P=S.toLowerCase().replace(/_/g,"-");return Object.values(Te).indexOf(P)>=0?P:Te.UNKNOWN})(T.status);u(new Le(w,T.message))}else u(new Le(Te.UNKNOWN,"Server responded with status "+h.getStatus()))}else u(new Le(Te.UNAVAILABLE,"Connection failed."));break;default:je(9055,{l_:e,streamId:o,h_:h.getLastErrorCode(),P_:h.getLastError()})}}finally{Ie(Yn,`RPC '${e}' ${o} completed.`)}}));const d=JSON.stringify(i);Ie(Yn,`RPC '${e}' ${o} sending request:`,i),h.send(t,"POST",d,r,15)}))}T_(e,t,r){const i=Ew(),s=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=nD(),a=tD(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(u.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(u.useFetchStreams=!0),this.jo(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;const d=s.join("");Ie(Yn,`Creating RPC '${e}' stream ${i}: ${d}`,u);const g=o.createWebChannel(d,u);this.I_(g);let y=!1,v=!1;const T=new rq({Yo:E=>{v?Ie(Yn,`Not sending because RPC '${e}' stream ${i} is closed:`,E):(y||(Ie(Yn,`Opening RPC '${e}' stream ${i} transport.`),g.open(),y=!0),Ie(Yn,`RPC '${e}' stream ${i} sending:`,E),g.send(E))},Zo:()=>g.close()}),w=(E,S,P)=>{E.listen(S,(I=>{try{P(I)}catch(L){setTimeout((()=>{throw L}),0)}}))};return w(g,td.EventType.OPEN,(()=>{v||(Ie(Yn,`RPC '${e}' stream ${i} transport opened.`),T.o_())})),w(g,td.EventType.CLOSE,(()=>{v||(v=!0,Ie(Yn,`RPC '${e}' stream ${i} transport closed`),T.a_(),this.E_(g))})),w(g,td.EventType.ERROR,(E=>{v||(v=!0,qu(Yn,`RPC '${e}' stream ${i} transport errored. Name:`,E.name,"Message:",E.message),T.a_(new Le(Te.UNAVAILABLE,"The operation could not be completed")))})),w(g,td.EventType.MESSAGE,(E=>{if(!v){const S=E.data[0];mt(!!S,16349);const P=S,I=P?.error||P[0]?.error;if(I){Ie(Yn,`RPC '${e}' stream ${i} received error:`,I);const L=I.status;let F=(function(M){const N=an[M];if(N!==void 0)return DD(N)})(L),Y=I.message;F===void 0&&(F=Te.INTERNAL,Y="Unknown error status: "+L+" with message "+I.message),v=!0,T.a_(new Le(F,Y)),g.close()}else Ie(Yn,`RPC '${e}' stream ${i} received:`,S),T.u_(S)}})),w(a,eD.STAT_EVENT,(E=>{E.stat===fw.PROXY?Ie(Yn,`RPC '${e}' stream ${i} detected buffering proxy`):E.stat===fw.NOPROXY&&Ie(Yn,`RPC '${e}' stream ${i} detected no buffering proxy`)})),setTimeout((()=>{T.__()}),0),T}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}function L0(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function z_(n){return new lW(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KD{constructor(e,t,r=1e3,i=1.5,s=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=i,this.R_=s,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),i=Math.max(0,t-r);i>0&&Ie("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D3="PersistentStream";class GD{constructor(e,t,r,i,s,o,a,u){this.Mi=e,this.S_=r,this.b_=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new KD(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===Te.RESOURCE_EXHAUSTED?(to(t.toString()),to("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===Te.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,i])=>{this.D_===t&&this.G_(r,i)}),(r=>{e((()=>{const i=new Le(Te.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(i)}))}))}G_(e,t){const r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((i=>{r((()=>this.z_(i)))})),this.stream.onMessage((i=>{r((()=>++this.F_==1?this.J_(i):this.onNext(i)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return Ie(D3,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(Ie(D3,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class sq extends GD{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=hW(this.serializer,e),r=(function(s){if(!("targetChange"in s))return We.min();const o=s.targetChange;return o.targetIds&&o.targetIds.length?We.min():o.readTime?ss(o.readTime):We.min()})(e);return this.listener.H_(t,r)}Y_(e){const t={};t.database=ww(this.serializer),t.addTarget=(function(s,o){let a;const u=o.target;if(a=yw(u)?{documents:pW(s,u)}:{query:gW(s,u).ft},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=VD(s,o.resumeToken);const h=vw(s,o.expectedCount);h!==null&&(a.expectedCount=h)}else if(o.snapshotVersion.compareTo(We.min())>0){a.readTime=By(s,o.snapshotVersion.toTimestamp());const h=vw(s,o.expectedCount);h!==null&&(a.expectedCount=h)}return a})(this.serializer,e);const r=yW(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){const t={};t.database=ww(this.serializer),t.removeTarget=e,this.q_(t)}}class oq extends GD{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return mt(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,mt(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){mt(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=dW(e.writeResults,e.commitTime),r=ss(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=ww(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((r=>fW(this.serializer,r)))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aq{}class lq extends aq{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new Le(Te.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,o])=>this.connection.Go(e,bw(t,r),i,s,o))).catch((s=>{throw s.name==="FirebaseError"?(s.code===Te.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new Le(Te.UNKNOWN,s.toString())}))}Ho(e,t,r,i,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,a])=>this.connection.Ho(e,bw(t,r),i,o,a,s))).catch((o=>{throw o.name==="FirebaseError"?(o.code===Te.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Le(Te.UNKNOWN,o.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class cq{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(to(t),this.aa=!1):Ie("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gl="RemoteStore";class uq{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=s,this.Aa.Oo((o=>{r.enqueueAndForget((async()=>{lc(this)&&(Ie(Gl,"Restarting streams for network reachability change."),await(async function(u){const h=Xe(u);h.Ea.add(4),await Tp(h),h.Ra.set("Unknown"),h.Ea.delete(4),await j_(h)})(this))}))})),this.Ra=new cq(r,i)}}async function j_(n){if(lc(n))for(const e of n.da)await e(!0)}async function Tp(n){for(const e of n.da)await e(!1)}function ZD(n,e){const t=Xe(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),OE(t)?ME(t):wh(t).O_()&&PE(t,e))}function IE(n,e){const t=Xe(n),r=wh(t);t.Ia.delete(e),r.O_()&&QD(t,e),t.Ia.size===0&&(r.O_()?r.L_():lc(t)&&t.Ra.set("Unknown"))}function PE(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(We.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}wh(n).Y_(e)}function QD(n,e){n.Va.Ue(e),wh(n).Z_(e)}function ME(n){n.Va=new iW({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),wh(n).start(),n.Ra.ua()}function OE(n){return lc(n)&&!wh(n).x_()&&n.Ia.size>0}function lc(n){return Xe(n).Ea.size===0}function JD(n){n.Va=void 0}async function hq(n){n.Ra.set("Online")}async function fq(n){n.Ia.forEach(((e,t)=>{PE(n,e)}))}async function dq(n,e){JD(n),OE(n)?(n.Ra.ha(e),ME(n)):n.Ra.set("Unknown")}async function pq(n,e,t){if(n.Ra.set("Online"),e instanceof UD&&e.state===2&&e.cause)try{await(async function(i,s){const o=s.cause;for(const a of s.targetIds)i.Ia.has(a)&&(await i.remoteSyncer.rejectListen(a,o),i.Ia.delete(a),i.Va.removeTarget(a))})(n,e)}catch(r){Ie(Gl,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await jy(n,r)}else if(e instanceof ty?n.Va.Ze(e):e instanceof LD?n.Va.st(e):n.Va.tt(e),!t.isEqual(We.min()))try{const r=await YD(n.localStore);t.compareTo(r)>=0&&await(function(s,o){const a=s.Va.Tt(o);return a.targetChanges.forEach(((u,h)=>{if(u.resumeToken.approximateByteSize()>0){const d=s.Ia.get(h);d&&s.Ia.set(h,d.withResumeToken(u.resumeToken,o))}})),a.targetMismatches.forEach(((u,h)=>{const d=s.Ia.get(u);if(!d)return;s.Ia.set(u,d.withResumeToken(Hn.EMPTY_BYTE_STRING,d.snapshotVersion)),QD(s,u);const g=new da(d.target,u,h,d.sequenceNumber);PE(s,g)})),s.remoteSyncer.applyRemoteEvent(a)})(n,t)}catch(r){Ie(Gl,"Failed to raise snapshot:",r),await jy(n,r)}}async function jy(n,e,t){if(!Th(e))throw e;n.Ea.add(1),await Tp(n),n.Ra.set("Offline"),t||(t=()=>YD(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{Ie(Gl,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await j_(n)}))}function e4(n,e){return e().catch((t=>jy(n,t,e)))}async function H_(n){const e=Xe(n),t=Ma(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:gE;for(;gq(e);)try{const i=await GW(e.localStore,r);if(i===null){e.Ta.length===0&&t.L_();break}r=i.batchId,mq(e,i)}catch(i){await jy(e,i)}t4(e)&&n4(e)}function gq(n){return lc(n)&&n.Ta.length<10}function mq(n,e){n.Ta.push(e);const t=Ma(n);t.O_()&&t.X_&&t.ea(e.mutations)}function t4(n){return lc(n)&&!Ma(n).x_()&&n.Ta.length>0}function n4(n){Ma(n).start()}async function yq(n){Ma(n).ra()}async function _q(n){const e=Ma(n);for(const t of n.Ta)e.ea(t.mutations)}async function vq(n,e,t){const r=n.Ta.shift(),i=wE.from(r,e,t);await e4(n,(()=>n.remoteSyncer.applySuccessfulWrite(i))),await H_(n)}async function bq(n,e){e&&Ma(n).X_&&await(async function(r,i){if((function(o){return tW(o)&&o!==Te.ABORTED})(i.code)){const s=r.Ta.shift();Ma(r).B_(),await e4(r,(()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i))),await H_(r)}})(n,e),t4(n)&&n4(n)}async function L3(n,e){const t=Xe(n);t.asyncQueue.verifyOperationInProgress(),Ie(Gl,"RemoteStore received new credentials");const r=lc(t);t.Ea.add(3),await Tp(t),r&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await j_(t)}async function Tq(n,e){const t=Xe(n);e?(t.Ea.delete(2),await j_(t)):e||(t.Ea.add(2),await Tp(t),t.Ra.set("Unknown"))}function wh(n){return n.ma||(n.ma=(function(t,r,i){const s=Xe(t);return s.sa(),new sq(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)})(n.datastore,n.asyncQueue,{Xo:hq.bind(null,n),t_:fq.bind(null,n),r_:dq.bind(null,n),H_:pq.bind(null,n)}),n.da.push((async e=>{e?(n.ma.B_(),OE(n)?ME(n):n.Ra.set("Unknown")):(await n.ma.stop(),JD(n))}))),n.ma}function Ma(n){return n.fa||(n.fa=(function(t,r,i){const s=Xe(t);return s.sa(),new oq(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:yq.bind(null,n),r_:bq.bind(null,n),ta:_q.bind(null,n),na:vq.bind(null,n)}),n.da.push((async e=>{e?(n.fa.B_(),await H_(n)):(await n.fa.stop(),n.Ta.length>0&&(Ie(Gl,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kE{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new wa,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((o=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){const o=Date.now()+r,a=new kE(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Le(Te.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function NE(n,e){if(to("AsyncQueue",`${e}: ${n}`),Th(n))return new Le(Te.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vu{static emptySet(e){return new Vu(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||Ue.comparator(t.key,r.key):(t,r)=>Ue.comparator(t.key,r.key),this.keyedMap=nd(),this.sortedSet=new Ht(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,r)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Vu)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new Vu;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U3{constructor(){this.ga=new Ht(Ue.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):je(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,r)=>{e.push(r)})),e}}class Zu{constructor(e,t,r,i,s,o,a,u,h){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=h}static fromInitialDocuments(e,t,r,i,s){const o=[];return t.forEach((a=>{o.push({type:0,doc:a})})),new Zu(e,t,Vu.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&L_(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wq{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class xq{constructor(){this.queries=V3(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const i=Xe(t),s=i.queries;i.queries=V3(),s.forEach(((o,a)=>{for(const u of a.Sa)u.onError(r)}))})(this,new Le(Te.ABORTED,"Firestore shutting down"))}}function V3(){return new oc((n=>wD(n)),L_)}async function Eq(n,e){const t=Xe(n);let r=3;const i=e.query;let s=t.queries.get(i);s?!s.ba()&&e.Da()&&(r=2):(s=new wq,r=e.Da()?0:1);try{switch(r){case 0:s.wa=await t.onListen(i,!0);break;case 1:s.wa=await t.onListen(i,!1);break;case 2:await t.onFirstRemoteStoreListen(i)}}catch(o){const a=NE(o,`Initialization of query '${pu(e.query)}' failed`);return void e.onError(a)}t.queries.set(i,s),s.Sa.push(e),e.va(t.onlineState),s.wa&&e.Fa(s.wa)&&DE(t)}async function Aq(n,e){const t=Xe(n),r=e.query;let i=3;const s=t.queries.get(r);if(s){const o=s.Sa.indexOf(e);o>=0&&(s.Sa.splice(o,1),s.Sa.length===0?i=e.Da()?0:1:!s.ba()&&e.Da()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function Sq(n,e){const t=Xe(n);let r=!1;for(const i of e){const s=i.query,o=t.queries.get(s);if(o){for(const a of o.Sa)a.Fa(i)&&(r=!0);o.wa=i}}r&&DE(t)}function Rq(n,e,t){const r=Xe(n),i=r.queries.get(e);if(i)for(const s of i.Sa)s.onError(t);r.queries.delete(e)}function DE(n){n.Ca.forEach((e=>{e.next()}))}var Aw,F3;(F3=Aw||(Aw={})).Ma="default",F3.Cache="cache";class Cq{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new Zu(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Zu.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Aw.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r4{constructor(e){this.key=e}}class i4{constructor(e){this.key=e}}class Iq{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=st(),this.mutatedKeys=st(),this.eu=xD(e),this.tu=new Vu(this.eu)}get nu(){return this.Ya}ru(e,t){const r=t?t.iu:new U3,i=t?t.tu:this.tu;let s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1;const u=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,h=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(((d,g)=>{const y=i.get(d),v=U_(this.query,g)?g:null,T=!!y&&this.mutatedKeys.has(y.key),w=!!v&&(v.hasLocalMutations||this.mutatedKeys.has(v.key)&&v.hasCommittedMutations);let E=!1;y&&v?y.data.isEqual(v.data)?T!==w&&(r.track({type:3,doc:v}),E=!0):this.su(y,v)||(r.track({type:2,doc:v}),E=!0,(u&&this.eu(v,u)>0||h&&this.eu(v,h)<0)&&(a=!0)):!y&&v?(r.track({type:0,doc:v}),E=!0):y&&!v&&(r.track({type:1,doc:y}),E=!0,(u||h)&&(a=!0)),E&&(v?(o=o.add(v),s=w?s.add(d):s.delete(d)):(o=o.delete(d),s=s.delete(d)))})),this.query.limit!==null)for(;o.size>this.query.limit;){const d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),s=s.delete(d.key),r.track({type:1,doc:d})}return{tu:o,iu:r,Cs:a,mutatedKeys:s}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){const s=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort(((d,g)=>(function(v,T){const w=E=>{switch(E){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return je(20277,{Rt:E})}};return w(v)-w(T)})(d.type,g.type)||this.eu(d.doc,g.doc))),this.ou(r),i=i??!1;const a=t&&!i?this._u():[],u=this.Xa.size===0&&this.current&&!i?1:0,h=u!==this.Za;return this.Za=u,o.length!==0||h?{snapshot:new Zu(this.query,e.tu,s,o,e.mutatedKeys,u===0,h,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new U3,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=st(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const t=[];return e.forEach((r=>{this.Xa.has(r)||t.push(new i4(r))})),this.Xa.forEach((r=>{e.has(r)||t.push(new r4(r))})),t}cu(e){this.Ya=e.Qs,this.Xa=st();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Zu.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const LE="SyncEngine";class Pq{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class Mq{constructor(e){this.key=e,this.hu=!1}}class Oq{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new oc((a=>wD(a)),L_),this.Iu=new Map,this.Eu=new Set,this.du=new Ht(Ue.comparator),this.Au=new Map,this.Ru=new AE,this.Vu={},this.mu=new Map,this.fu=Gu.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function kq(n,e,t=!0){const r=u4(n);let i;const s=r.Tu.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.lu()):i=await s4(r,e,t,!0),i}async function Nq(n,e){const t=u4(n);await s4(t,e,!0,!1)}async function s4(n,e,t,r){const i=await ZW(n.localStore,is(e)),s=i.targetId,o=n.sharedClientState.addLocalQueryTarget(s,t);let a;return r&&(a=await Dq(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&ZD(n.remoteStore,i),a}async function Dq(n,e,t,r,i){n.pu=(g,y,v)=>(async function(w,E,S,P){let I=E.view.ru(S);I.Cs&&(I=await M3(w.localStore,E.query,!1).then((({documents:k})=>E.view.ru(k,I))));const L=P&&P.targetChanges.get(E.targetId),F=P&&P.targetMismatches.get(E.targetId)!=null,Y=E.view.applyChanges(I,w.isPrimaryClient,L,F);return z3(w,E.targetId,Y.au),Y.snapshot})(n,g,y,v);const s=await M3(n.localStore,e,!0),o=new Iq(e,s.Qs),a=o.ru(s.documents),u=bp.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),h=o.applyChanges(a,n.isPrimaryClient,u);z3(n,t,h.au);const d=new Pq(e,t,o);return n.Tu.set(e,d),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),h.snapshot}async function Lq(n,e,t){const r=Xe(n),i=r.Tu.get(e),s=r.Iu.get(i.targetId);if(s.length>1)return r.Iu.set(i.targetId,s.filter((o=>!L_(o,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await xw(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),t&&IE(r.remoteStore,i.targetId),Sw(r,i.targetId)})).catch(bh)):(Sw(r,i.targetId),await xw(r.localStore,i.targetId,!0))}async function Uq(n,e){const t=Xe(n),r=t.Tu.get(e),i=t.Iu.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),IE(t.remoteStore,r.targetId))}async function Vq(n,e,t){const r=Wq(n);try{const i=await(function(o,a){const u=Xe(o),h=kt.now(),d=a.reduce(((v,T)=>v.add(T.key)),st());let g,y;return u.persistence.runTransaction("Locally write mutations","readwrite",(v=>{let T=no(),w=st();return u.Ns.getEntries(v,d).next((E=>{T=E,T.forEach(((S,P)=>{P.isValidDocument()||(w=w.add(S))}))})).next((()=>u.localDocuments.getOverlayedDocuments(v,T))).next((E=>{g=E;const S=[];for(const P of a){const I=G$(P,g.get(P.key).overlayedDocument);I!=null&&S.push(new ac(P.key,I,gD(I.value.mapValue),Gs.exists(!0)))}return u.mutationQueue.addMutationBatch(v,h,S,a)})).next((E=>{y=E;const S=E.applyToLocalDocumentSet(g,w);return u.documentOverlayCache.saveOverlays(v,E.batchId,S)}))})).then((()=>({batchId:y.batchId,changes:AD(g)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),(function(o,a,u){let h=o.Vu[o.currentUser.toKey()];h||(h=new Ht(it)),h=h.insert(a,u),o.Vu[o.currentUser.toKey()]=h})(r,i.batchId,t),await wp(r,i.changes),await H_(r.remoteStore)}catch(i){const s=NE(i,"Failed to persist write");t.reject(s)}}async function o4(n,e){const t=Xe(n);try{const r=await YW(t.localStore,e);e.targetChanges.forEach(((i,s)=>{const o=t.Au.get(s);o&&(mt(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?o.hu=!0:i.modifiedDocuments.size>0?mt(o.hu,14607):i.removedDocuments.size>0&&(mt(o.hu,42227),o.hu=!1))})),await wp(t,r,e)}catch(r){await bh(r)}}function B3(n,e,t){const r=Xe(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const i=[];r.Tu.forEach(((s,o)=>{const a=o.view.va(e);a.snapshot&&i.push(a.snapshot)})),(function(o,a){const u=Xe(o);u.onlineState=a;let h=!1;u.queries.forEach(((d,g)=>{for(const y of g.Sa)y.va(a)&&(h=!0)})),h&&DE(u)})(r.eventManager,e),i.length&&r.Pu.H_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function Fq(n,e,t){const r=Xe(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.Au.get(e),s=i&&i.key;if(s){let o=new Ht(Ue.comparator);o=o.insert(s,tr.newNoDocument(s,We.min()));const a=st().add(s),u=new B_(We.min(),new Map,new Ht(it),o,a);await o4(r,u),r.du=r.du.remove(s),r.Au.delete(e),UE(r)}else await xw(r.localStore,e,!1).then((()=>Sw(r,e,t))).catch(bh)}async function Bq(n,e){const t=Xe(n),r=e.batch.batchId;try{const i=await XW(t.localStore,e);l4(t,r,null),a4(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await wp(t,i)}catch(i){await bh(i)}}async function zq(n,e,t){const r=Xe(n);try{const i=await(function(o,a){const u=Xe(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",(h=>{let d;return u.mutationQueue.lookupMutationBatch(h,a).next((g=>(mt(g!==null,37113),d=g.keys(),u.mutationQueue.removeMutationBatch(h,g)))).next((()=>u.mutationQueue.performConsistencyCheck(h))).next((()=>u.documentOverlayCache.removeOverlaysForBatchId(h,d,a))).next((()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,d))).next((()=>u.localDocuments.getDocuments(h,d)))}))})(r.localStore,e);l4(r,e,t),a4(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await wp(r,i)}catch(i){await bh(i)}}function a4(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function l4(n,e,t){const r=Xe(n);let i=r.Vu[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Vu[r.currentUser.toKey()]=i}}function Sw(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach((r=>{n.Ru.containsKey(r)||c4(n,r)}))}function c4(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(IE(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),UE(n))}function z3(n,e,t){for(const r of t)r instanceof r4?(n.Ru.addReference(r.key,e),jq(n,r)):r instanceof i4?(Ie(LE,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||c4(n,r.key)):je(19791,{wu:r})}function jq(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(Ie(LE,"New document in limbo: "+t),n.Eu.add(r),UE(n))}function UE(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new Ue(Ft.fromString(e)),r=n.fu.next();n.Au.set(r,new Mq(t)),n.du=n.du.insert(t,r),ZD(n.remoteStore,new da(is(bE(t.path)),r,"TargetPurposeLimboResolution",O_.ce))}}async function wp(n,e,t){const r=Xe(n),i=[],s=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach(((a,u)=>{o.push(r.pu(u,e,t).then((h=>{if((h||t)&&r.isPrimaryClient){const d=h?!h.fromCache:t?.targetChanges.get(u.targetId)?.current;r.sharedClientState.updateQueryState(u.targetId,d?"current":"not-current")}if(h){i.push(h);const d=RE.As(u.targetId,h);s.push(d)}})))})),await Promise.all(o),r.Pu.H_(i),await(async function(u,h){const d=Xe(u);try{await d.persistence.runTransaction("notifyLocalViewChanges","readwrite",(g=>be.forEach(h,(y=>be.forEach(y.Es,(v=>d.persistence.referenceDelegate.addReference(g,y.targetId,v))).next((()=>be.forEach(y.ds,(v=>d.persistence.referenceDelegate.removeReference(g,y.targetId,v)))))))))}catch(g){if(!Th(g))throw g;Ie(CE,"Failed to update sequence numbers: "+g)}for(const g of h){const y=g.targetId;if(!g.fromCache){const v=d.Ms.get(y),T=v.snapshotVersion,w=v.withLastLimboFreeSnapshotVersion(T);d.Ms=d.Ms.insert(y,w)}}})(r.localStore,s))}async function Hq(n,e){const t=Xe(n);if(!t.currentUser.isEqual(e)){Ie(LE,"User change. New user:",e.toKey());const r=await XD(t.localStore,e);t.currentUser=e,(function(s,o){s.mu.forEach((a=>{a.forEach((u=>{u.reject(new Le(Te.CANCELLED,o))}))})),s.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await wp(t,r.Ls)}}function $q(n,e){const t=Xe(n),r=t.Au.get(e);if(r&&r.hu)return st().add(r.key);{let i=st();const s=t.Iu.get(e);if(!s)return i;for(const o of s){const a=t.Tu.get(o);i=i.unionWith(a.view.nu)}return i}}function u4(n){const e=Xe(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=o4.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=$q.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Fq.bind(null,e),e.Pu.H_=Sq.bind(null,e.eventManager),e.Pu.yu=Rq.bind(null,e.eventManager),e}function Wq(n){const e=Xe(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Bq.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=zq.bind(null,e),e}class Hy{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=z_(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return qW(this.persistence,new HW,e.initialUser,this.serializer)}Cu(e){return new qD(SE.mi,this.serializer)}Du(e){return new JW}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Hy.provider={build:()=>new Hy};class qq extends Hy{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){mt(this.persistence.referenceDelegate instanceof zy,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new CW(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?vr.withCacheSize(this.cacheSizeBytes):vr.DEFAULT;return new qD((r=>zy.mi(r,t)),this.serializer)}}class Rw{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>B3(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=Hq.bind(null,this.syncEngine),await Tq(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new xq})()}createDatastore(e){const t=z_(e.databaseInfo.databaseId),r=(function(s){return new iq(s)})(e.databaseInfo);return(function(s,o,a,u){return new lq(s,o,a,u)})(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return(function(r,i,s,o,a){return new uq(r,i,s,o,a)})(this.localStore,this.datastore,e.asyncQueue,(t=>B3(this.syncEngine,t,0)),(function(){return N3.v()?new N3:new eq})())}createSyncEngine(e,t){return(function(i,s,o,a,u,h,d){const g=new Oq(i,s,o,a,u,h);return d&&(g.gu=!0),g})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const r=Xe(t);Ie(Gl,"RemoteStore shutting down."),r.Ea.add(5),await Tp(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Rw.provider={build:()=>new Rw};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xq{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):to("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oa="FirestoreClient";class Yq{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Qn.UNAUTHENTICATED,this.clientId=dE.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,(async o=>{Ie(Oa,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(r,(o=>(Ie(Oa,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new wa;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=NE(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function U0(n,e){n.asyncQueue.verifyOperationInProgress(),Ie(Oa,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener((async i=>{r.isEqual(i)||(await XD(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function j3(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Kq(n);Ie(Oa,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((r=>L3(e.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,i)=>L3(e.remoteStore,i))),n._onlineComponents=e}async function Kq(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){Ie(Oa,"Using user provided OfflineComponentProvider");try{await U0(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(i){return i.name==="FirebaseError"?i.code===Te.FAILED_PRECONDITION||i.code===Te.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(t))throw t;qu("Error using user provided cache. Falling back to memory cache: "+t),await U0(n,new Hy)}}else Ie(Oa,"Using default OfflineComponentProvider"),await U0(n,new qq(void 0));return n._offlineComponents}async function h4(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(Ie(Oa,"Using user provided OnlineComponentProvider"),await j3(n,n._uninitializedComponentsProvider._online)):(Ie(Oa,"Using default OnlineComponentProvider"),await j3(n,new Rw))),n._onlineComponents}function Gq(n){return h4(n).then((e=>e.syncEngine))}async function Zq(n){const e=await h4(n),t=e.eventManager;return t.onListen=kq.bind(null,e.syncEngine),t.onUnlisten=Lq.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Nq.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Uq.bind(null,e.syncEngine),t}function Qq(n,e,t={}){const r=new wa;return n.asyncQueue.enqueueAndForget((async()=>(function(s,o,a,u,h){const d=new Xq({next:y=>{d.Nu(),o.enqueueAndForget((()=>Aq(s,g)));const v=y.docs.has(a);!v&&y.fromCache?h.reject(new Le(Te.UNAVAILABLE,"Failed to get document because the client is offline.")):v&&y.fromCache&&u&&u.source==="server"?h.reject(new Le(Te.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(y)},error:y=>h.reject(y)}),g=new Cq(bE(a.path),d,{includeMetadataChanges:!0,qa:!0});return Eq(s,g)})(await Zq(n),n.asyncQueue,e,t,r))),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f4(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H3=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d4="firestore.googleapis.com",$3=!0;class W3{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new Le(Te.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=d4,this.ssl=$3}else this.host=e.host,this.ssl=e.ssl??$3;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=WD;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<SW)throw new Le(Te.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}l$("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=f4(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new Le(Te.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new Le(Te.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new Le(Te.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,i){return r.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class VE{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new W3({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Le(Te.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Le(Te.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new W3(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new ZH;switch(r.type){case"firstParty":return new t$(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Le(Te.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const r=H3.get(t);r&&(Ie("ComponentProvider","Removing Datastore"),H3.delete(t),r.terminate())})(this),Promise.resolve()}}function Jq(n,e,t,r={}){n=Vd(n,VE);const i=mh(e),s=n._getSettings(),o={...s,emulatorOptions:n._getEmulatorOptions()},a=`${e}:${t}`;i&&(cN(`https://${a}`),uN("Firestore",!0)),s.host!==d4&&s.host!==a&&qu("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const u={...s,host:a,ssl:i,emulatorOptions:r};if(!Wl(u,o)&&(n._setSettings(u),r.mockUserToken)){let h,d;if(typeof r.mockUserToken=="string")h=r.mockUserToken,d=Qn.MOCK_USER;else{h=a9(r.mockUserToken,n._app?.options.projectId);const g=r.mockUserToken.sub||r.mockUserToken.user_id;if(!g)throw new Le(Te.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");d=new Qn(g)}n._authCredentials=new QH(new iD(h,d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FE{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new FE(this.firestore,e,this._query)}}class Mn{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new qd(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Mn(this.firestore,e,this._key)}toJSON(){return{type:Mn._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(_p(t,Mn._jsonSchema))return new Mn(e,r||null,new Ue(Ft.fromString(t.referencePath)))}}Mn._jsonSchemaVersion="firestore/documentReference/1.0",Mn._jsonSchema={type:hn("string",Mn._jsonSchemaVersion),referencePath:hn("string")};class qd extends FE{constructor(e,t,r){super(e,t,bE(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Mn(this.firestore,null,new Ue(e))}withConverter(e){return new qd(this.firestore,e,this._path)}}function Qu(n,e,...t){if(n=wr(n),arguments.length===1&&(e=dE.newId()),a$("doc","path",e),n instanceof VE){const r=Ft.fromString(e,...t);return s3(r),new Mn(n,null,new Ue(r))}{if(!(n instanceof Mn||n instanceof qd))throw new Le(Te.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Ft.fromString(e,...t));return s3(r),new Mn(n.firestore,n instanceof qd?n.converter:null,new Ue(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q3="AsyncQueue";class X3{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new KD(this,"async_queue_retry"),this._c=()=>{const r=L0();r&&Ie(q3,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=L0();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=L0();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new wa;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Th(e))throw e;Ie(q3,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,to("INTERNAL UNHANDLED ERROR: ",Y3(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const i=kE.createAndSchedule(this,e,t,r,(s=>this.hc(s)));return this.tc.push(i),i}uc(){this.nc&&je(47125,{Pc:Y3(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,r)=>t.targetTimeMs-r.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function Y3(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class BE extends VE{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new X3,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new X3(e),this._firestoreClient=void 0,await e}}}function eX(n,e){const t=typeof n=="object"?n:pN(),r=typeof n=="string"?n:Dy,i=nE(t,"firestore").getImmediate({identifier:r});if(!i._initialized){const s=s9("firestore");s&&Jq(i,...s)}return i}function p4(n){if(n._terminated)throw new Le(Te.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||tX(n),n._firestoreClient}function tX(n){const e=n._freezeSettings(),t=(function(i,s,o,a){return new v$(i,s,o,a.host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,f4(a.experimentalLongPollingOptions),a.useFetchStreams,a.isUsingEmulator)})(n._databaseId,n._app?.options.appId||"",n._persistenceKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new Yq(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(i){const s=i?._online.build();return{_offline:i?._offline.build(s),_online:s}})(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ti{constructor(e){this._byteString=e}static fromBase64String(e){try{return new ti(Hn.fromBase64String(e))}catch(t){throw new Le(Te.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new ti(Hn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:ti._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(_p(e,ti._jsonSchema))return ti.fromBase64String(e.bytes)}}ti._jsonSchemaVersion="firestore/bytes/1.0",ti._jsonSchema={type:hn("string",ti._jsonSchemaVersion),bytes:hn("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zE{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new Le(Te.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new zn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jE{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class os{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Le(Te.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Le(Te.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return it(this._lat,e._lat)||it(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:os._jsonSchemaVersion}}static fromJSON(e){if(_p(e,os._jsonSchema))return new os(e.latitude,e.longitude)}}os._jsonSchemaVersion="firestore/geoPoint/1.0",os._jsonSchema={type:hn("string",os._jsonSchemaVersion),latitude:hn("number"),longitude:hn("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class as{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0})(this._values,e._values)}toJSON(){return{type:as._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(_p(e,as._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new as(e.vectorValues);throw new Le(Te.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}as._jsonSchemaVersion="firestore/vectorValue/1.0",as._jsonSchema={type:hn("string",as._jsonSchemaVersion),vectorValues:hn("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nX=/^__.*__$/;class rX{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new ac(e,this.data,this.fieldMask,t,this.fieldTransforms):new vp(e,this.data,t,this.fieldTransforms)}}function g4(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw je(40011,{Ac:n})}}class HE{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.Rc(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new HE({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return $y(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(g4(this.Ac)&&nX.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class iX{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||z_(e)}Cc(e,t,r,i=!1){return new HE({Ac:e,methodName:t,Dc:r,path:zn.emptyPath(),fc:!1,bc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function sX(n){const e=n._freezeSettings(),t=z_(n._databaseId);return new iX(n._databaseId,!!e.ignoreUndefinedProperties,t)}function oX(n,e,t,r,i,s={}){const o=n.Cc(s.merge||s.mergeFields?2:0,e,t,i);v4("Data must be an object, but it was:",o,r);const a=y4(r,o);let u,h;if(s.merge)u=new xi(o.fieldMask),h=o.fieldTransforms;else if(s.mergeFields){const d=[];for(const g of s.mergeFields){const y=aX(e,g,t);if(!o.contains(y))throw new Le(Te.INVALID_ARGUMENT,`Field '${y}' is specified in your field mask but missing from your input data.`);cX(d,y)||d.push(y)}u=new xi(d),h=o.fieldTransforms.filter((g=>u.covers(g.field)))}else u=null,h=o.fieldTransforms;return new rX(new ei(a),u,h)}class $E extends jE{_toFieldTransform(e){return new q$(e.path,new Hd)}isEqual(e){return e instanceof $E}}function m4(n,e){if(_4(n=wr(n)))return v4("Unsupported field value:",e,n),y4(n,e);if(n instanceof jE)return(function(r,i){if(!g4(i.Ac))throw i.Sc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Sc(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,i){const s=[];let o=0;for(const a of r){let u=m4(a,i.wc(o));u==null&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}})(n,e)}return(function(r,i){if((r=wr(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return H$(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const s=kt.fromDate(r);return{timestampValue:By(i.serializer,s)}}if(r instanceof kt){const s=new kt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:By(i.serializer,s)}}if(r instanceof os)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof ti)return{bytesValue:VD(i.serializer,r._byteString)};if(r instanceof Mn){const s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:EE(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof as)return(function(o,a){return{mapValue:{fields:{[dD]:{stringValue:pD},[Ly]:{arrayValue:{values:o.toArray().map((h=>{if(typeof h!="number")throw a.Sc("VectorValues must only contain numeric values.");return TE(a.serializer,h)}))}}}}}})(r,i);throw i.Sc(`Unsupported field value: ${pE(r)}`)})(n,e)}function y4(n,e){const t={};return aD(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):sc(n,((r,i)=>{const s=m4(i,e.mc(r));s!=null&&(t[r]=s)})),{mapValue:{fields:t}}}function _4(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof kt||n instanceof os||n instanceof ti||n instanceof Mn||n instanceof jE||n instanceof as)}function v4(n,e,t){if(!_4(t)||!sD(t)){const r=pE(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function aX(n,e,t){if((e=wr(e))instanceof zE)return e._internalPath;if(typeof e=="string")return b4(n,e);throw $y("Field path arguments must be of type string or ",n,!1,void 0,t)}const lX=new RegExp("[~\\*/\\[\\]]");function b4(n,e,t){if(e.search(lX)>=0)throw $y(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new zE(...e.split("."))._internalPath}catch{throw $y(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function $y(n,e,t,r,i){const s=r&&!r.isEmpty(),o=i!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new Le(Te.INVALID_ARGUMENT,a+n+u)}function cX(n,e){return n.some((t=>t.isEqual(e)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T4{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Mn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new uX(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(w4("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class uX extends T4{data(){return super.data()}}function w4(n,e){return typeof e=="string"?b4(n,e):e instanceof zE?e._internalPath:e._delegate._internalPath}class hX{convertValue(e,t="none"){switch(Pa(e)){case 0:return null;case 1:return e.booleanValue;case 2:return nn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ia(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw je(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return sc(e,((i,s)=>{r[i]=this.convertValue(s,t)})),r}convertVectorValue(e){const t=e.fields?.[Ly].arrayValue?.values?.map((r=>nn(r.doubleValue)));return new as(t)}convertGeoPoint(e){return new os(nn(e.latitude),nn(e.longitude))}convertArray(e,t){return(e.values||[]).map((r=>this.convertValue(r,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const r=N_(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Bd(e));default:return null}}convertTimestamp(e){const t=Ca(e);return new kt(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=Ft.fromString(e);mt($D(r),9688,{name:e});const i=new zd(r.get(1),r.get(3)),s=new Ue(r.popFirst(5));return i.isEqual(t)||to(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fX(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class id{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Ul extends T4{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new ny(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(w4("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Le(Te.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Ul._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}Ul._jsonSchemaVersion="firestore/documentSnapshot/1.0",Ul._jsonSchema={type:hn("string",Ul._jsonSchemaVersion),bundleSource:hn("string","DocumentSnapshot"),bundleName:hn("string"),bundle:hn("string")};class ny extends Ul{data(e={}){return super.data(e)}}class _d{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new id(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((r=>{e.call(t,new ny(this._firestore,this._userDataWriter,r.key,r,new id(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Le(Te.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map((a=>{const u=new ny(i._firestore,i._userDataWriter,a.doc.key,a.doc,new id(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}}))}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter((a=>s||a.type!==3)).map((a=>{const u=new ny(i._firestore,i._userDataWriter,a.doc.key,a.doc,new id(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);let h=-1,d=-1;return a.type!==0&&(h=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:dX(a.type),doc:u,oldIndex:h,newIndex:d}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Le(Te.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=_d._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=dE.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],i=[];return this.docs.forEach((s=>{s._document!==null&&(t.push(s._document),r.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),i.push(s.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function dX(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return je(61501,{type:n})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WE(n){n=Vd(n,Mn);const e=Vd(n.firestore,BE);return Qq(p4(e),n._key).then((t=>mX(e,n,t)))}_d._jsonSchemaVersion="firestore/querySnapshot/1.0",_d._jsonSchema={type:hn("string",_d._jsonSchemaVersion),bundleSource:hn("string","QuerySnapshot"),bundleName:hn("string"),bundle:hn("string")};class pX extends hX{constructor(e){super(),this.firestore=e}convertBytes(e){return new ti(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Mn(this.firestore,null,t)}}function Cw(n,e,t){n=Vd(n,Mn);const r=Vd(n.firestore,BE),i=fX(n.converter,e,t);return gX(r,[oX(sX(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,Gs.none())])}function gX(n,e){return(function(r,i){const s=new wa;return r.asyncQueue.enqueueAndForget((async()=>Vq(await Gq(r),i,s))),s.promise})(p4(n),e)}function mX(n,e,t){const r=t.docs.get(e._key),i=new pX(n);return new Ul(n,i,e._key,r,new id(t.hasPendingWrites,t.fromCache),e.converter)}function x4(){return new $E("serverTimestamp")}(function(e,t=!0){(function(i){vh=i})(yh),Wu(new ql("firestore",((r,{instanceIdentifier:i,options:s})=>{const o=r.getProvider("app").getImmediate(),a=new BE(new JH(r.getProvider("auth-internal")),new n$(o,r.getProvider("app-check-internal")),(function(h,d){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new Le(Te.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new zd(h.options.projectId,d)})(o,i),o);return s={useFetchStreams:t,...s},a._setSettings(s),a}),"PUBLIC").setMultipleInstances(!0)),ba(t3,n3,e),ba(t3,n3,"esm2020")})();const yX={apiKey:"AIzaSyAk2sPOZkdl-RvB9NA7AZIywwReEAFMdns",authDomain:"openships-500f9.firebaseapp.com",projectId:"openships-500f9",storageBucket:"openships-500f9.firebasestorage.app",messagingSenderId:"962794742649",appId:"1:962794742649:web:e62f8a07c94b8ecf8e45a8",measurementId:"G-5901XXREHT"},E4=dN(yX),xh=XH(E4),Ju=eX(E4);async function A4(n){try{const e=Qu(Ju,"userSettings",n),t=await WE(e);return t.exists()?t.data():null}catch(e){return console.error("Error fetching user settings:",e),null}}async function S4(n,e){try{const t=Qu(Ju,"userSettings",n);await Cw(t,{...e,updatedAt:x4()},{merge:!0})}catch(t){throw console.error("Error saving user settings:",t),t}}const R4=A.createContext({theme:"light",setTheme:()=>{}}),_X=()=>A.useContext(R4),vX=({children:n})=>{const[e,t]=A.useState(()=>localStorage.getItem("theme")||"light"),r=A.useRef(null),i=A.useRef(null);return A.useEffect(()=>{const s=cE(xh,async o=>{const a=o?.uid??null;if(r.current=a,a)try{const u=await A4(a);u&&(u.theme==="dark"||u.theme==="light")&&(t(u.theme),localStorage.setItem("theme",u.theme))}catch(u){console.error("Failed to load user settings:",u)}});return()=>{s()}},[]),A.useEffect(()=>{document.body.classList.toggle("dark",e==="dark"),localStorage.setItem("theme",e);const s=r.current;return s&&(i.current&&window.clearTimeout(i.current),i.current=window.setTimeout(()=>{S4(s,{theme:e}).catch(o=>console.error("Failed to save user settings:",o)),i.current=null},800)),()=>{i.current&&(window.clearTimeout(i.current),i.current=null)}},[e]),$.jsx(R4.Provider,{value:{theme:e,setTheme:t},children:n})},C4=A.createContext({user:null});function bX({children:n}){const[e,t]=A.useState(null),[r,i]=A.useState(!0);return A.useEffect(()=>{const s=cE(xh,o=>{t(o),i(!1)});return()=>s()},[]),$.jsx(C4.Provider,{value:{user:e},children:!r&&n})}function $_(n=768){const[e,t]=A.useState(window.innerWidth<=n);return A.useEffect(()=>{const r=()=>t(window.innerWidth<=n);return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[n]),e}var I4={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},K3=bt.createContext&&bt.createContext(I4),TX=["attr","size","title"];function wX(n,e){if(n==null)return{};var t=xX(n,e),r,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(i=0;i<s.length;i++)r=s[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(n,r)&&(t[r]=n[r])}return t}function xX(n,e){if(n==null)return{};var t={};for(var r in n)if(Object.prototype.hasOwnProperty.call(n,r)){if(e.indexOf(r)>=0)continue;t[r]=n[r]}return t}function Wy(){return Wy=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Wy.apply(this,arguments)}function G3(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function qy(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?G3(Object(t),!0).forEach(function(r){EX(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):G3(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function EX(n,e,t){return e=AX(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function AX(n){var e=SX(n,"string");return typeof e=="symbol"?e:e+""}function SX(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function P4(n){return n&&n.map((e,t)=>bt.createElement(e.tag,qy({key:t},e.attr),P4(e.child)))}function cc(n){return e=>bt.createElement(RX,Wy({attr:qy({},n.attr)},e),P4(n.child))}function RX(n){var e=t=>{var{attr:r,size:i,title:s}=n,o=wX(n,TX),a=i||t.size||"1em",u;return t.className&&(u=t.className),n.className&&(u=(u?u+" ":"")+n.className),bt.createElement("svg",Wy({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,r,o,{className:u,style:qy(qy({color:n.color||t.color},t.style),n.style),height:a,width:a,xmlns:"http://www.w3.org/2000/svg"}),s&&bt.createElement("title",null,s),n.children)};return K3!==void 0?bt.createElement(K3.Consumer,null,t=>e(t)):e(I4)}function M4(n){return cc({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"},child:[]}]})(n)}function CX(n){return cc({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M12.41 148.02l232.94 105.67c6.8 3.09 14.49 3.09 21.29 0l232.94-105.67c16.55-7.51 16.55-32.52 0-40.03L266.65 2.31a25.607 25.607 0 0 0-21.29 0L12.41 107.98c-16.55 7.51-16.55 32.53 0 40.04zm487.18 88.28l-58.09-26.33-161.64 73.27c-7.56 3.43-15.59 5.17-23.86 5.17s-16.29-1.74-23.86-5.17L70.51 209.97l-58.1 26.33c-16.55 7.5-16.55 32.5 0 40l232.94 105.59c6.8 3.08 14.49 3.08 21.29 0L499.59 276.3c16.55-7.5 16.55-32.5 0-40zm0 127.8l-57.87-26.23-161.86 73.37c-7.56 3.43-15.59 5.17-23.86 5.17s-16.29-1.74-23.86-5.17L70.29 337.87 12.41 364.1c-16.55 7.5-16.55 32.5 0 40l232.94 105.59c6.8 3.08 14.49 3.08 21.29 0L499.59 404.1c16.55-7.5 16.55-32.5 0-40z"},child:[]}]})(n)}function Z3(n){return cc({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M0 117.66v346.32c0 11.32 11.43 19.06 21.94 14.86L160 416V32L20.12 87.95A32.006 32.006 0 0 0 0 117.66zM192 416l192 64V96L192 32v384zM554.06 33.16L416 96v384l139.88-55.95A31.996 31.996 0 0 0 576 394.34V48.02c0-11.32-11.43-19.06-21.94-14.86z"},child:[]}]})(n)}function Q3(n){return cc({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M496.616 372.639l70.012-70.012c16.899-16.9 9.942-45.771-12.836-53.092L512 236.102V96c0-17.673-14.327-32-32-32h-64V24c0-13.255-10.745-24-24-24H248c-13.255 0-24 10.745-24 24v40h-64c-17.673 0-32 14.327-32 32v140.102l-41.792 13.433c-22.753 7.313-29.754 36.173-12.836 53.092l70.012 70.012C125.828 416.287 85.587 448 24 448c-13.255 0-24 10.745-24 24v16c0 13.255 10.745 24 24 24 61.023 0 107.499-20.61 143.258-59.396C181.677 487.432 216.021 512 256 512h128c39.979 0 74.323-24.568 88.742-59.396C508.495 491.384 554.968 512 616 512c13.255 0 24-10.745 24-24v-16c0-13.255-10.745-24-24-24-60.817 0-101.542-31.001-119.384-75.361zM192 128h256v87.531l-118.208-37.995a31.995 31.995 0 0 0-19.584 0L192 215.531V128z"},child:[]}]})(n)}function J3(n){return cc({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M480 416v16c0 26.51-21.49 48-48 48H48c-26.51 0-48-21.49-48-48V176c0-26.51 21.49-48 48-48h16v48H54a6 6 0 0 0-6 6v244a6 6 0 0 0 6 6h372a6 6 0 0 0 6-6v-10h48zm42-336H150a6 6 0 0 0-6 6v244a6 6 0 0 0 6 6h372a6 6 0 0 0 6-6V86a6 6 0 0 0-6-6zm6-48c26.51 0 48 21.49 48 48v256c0 26.51-21.49 48-48 48H144c-26.51 0-48-21.49-48-48V80c0-26.51 21.49-48 48-48h384zM264 144c0 22.091-17.909 40-40 40s-40-17.909-40-40 17.909-40 40-40 40 17.909 40 40zm-72 96l39.515-39.515c4.686-4.686 12.284-4.686 16.971 0L288 240l103.515-103.515c4.686-4.686 12.284-4.686 16.971 0L480 208v80H192v-48z"},child:[]}]})(n)}function eI(n){return cc({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 4c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm0 14c-2.03 0-4.43-.82-6.14-2.88a9.947 9.947 0 0 1 12.28 0C16.43 19.18 14.03 20 12 20z"},child:[]}]})(n)}function IX(n){return cc({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M12 10.189V14"},child:[]},{tag:"path",attr:{d:"M12 2v3"},child:[]},{tag:"path",attr:{d:"M19 13V7a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2v6"},child:[]},{tag:"path",attr:{d:"M19.38 20A11.6 11.6 0 0 0 21 14l-8.188-3.639a2 2 0 0 0-1.624 0L3 14a11.6 11.6 0 0 0 2.81 7.76"},child:[]},{tag:"path",attr:{d:"M2 21c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1s1.2 1 2.5 1c2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"},child:[]}]})(n)}function PX(){return $_()?$.jsxs("div",{className:"fixed w-full h-14 bg-gray-500 bottom-0 p-2 flex justify-between items-center z-50 dark:bg-gray-900",children:[$.jsx("div",{className:"relative flex-1 flex justify-start",children:$.jsx(_r,{to:"/ar","aria-label":"Augmented Reality",className:"absolute -top-15 left-1/2 -translate-x-1/2 bg-white rounded-full shadow-lg flex items-center justify-center w-16 h-16 border-4 border-gray-500 active:scale-95 cursor-pointer transition-transform duration-150 hover:bg-gray-100 active:bg-gray-300",children:$.jsx("span",{className:"text-gray-700 text-3xl p-2 font-bold",children:"AR"})})}),$.jsx("div",{className:"relative flex-1 flex justify-start",children:$.jsx(_r,{to:"/account","aria-label":"Account",className:"absolute -top-15 left-1/2 -translate-x-1/2 bg-white rounded-full shadow-lg flex items-center justify-center w-16 h-16 border-4 border-gray-500 active:scale-95 cursor-pointer transition-transform duration-150 hover:bg-gray-100 active:bg-gray-300",children:$.jsx(eI,{className:"text-gray-700 text-6xl p-1"})})}),$.jsx("div",{className:"relative flex-1 flex justify-center",children:$.jsx(_r,{to:"/","aria-label":"Map",className:"absolute -top-18 left-1/2 -translate-x-1/2 bg-white rounded-full shadow-lg flex items-center justify-center w-20 h-20 border-4 border-gray-500 active:scale-95 cursor-pointer transition-transform duration-150 hover:bg-gray-100 active:bg-gray-300",children:$.jsx(Z3,{className:"text-5xl text-gray-700"})})}),$.jsx("div",{className:"relative flex-1 flex justify-center",children:$.jsx(_r,{to:"/vessels","aria-label":"Vessel List",className:"absolute -top-15 left-1/2 -translate-x-1/2 bg-white rounded-full shadow-lg flex items-center justify-center w-16 h-16 border-4 border-gray-500 active:scale-95 cursor-pointer transition-transform duration-150 hover:bg-gray-100 active:bg-gray-300",children:$.jsx(Q3,{className:"text-gray-700 text-5xl p-1.5"})})}),$.jsx("div",{className:"relative flex-1 flex justify-center",children:$.jsx(_r,{to:"/gallery","aria-label":"Gallery",className:"absolute -top-15 left-1/2 -translate-x-1/2 bg-white rounded-full shadow-lg flex items-center justify-center w-16 h-16 border-4 border-gray-500 active:scale-95 cursor-pointer transition-transform duration-150 hover:bg-gray-100 active:bg-gray-300",children:$.jsx(J3,{className:"text-gray-700 text-5xl p-1.5"})})})]}):$.jsxs("div",{className:"fixed w-full h-16 bg-gray-500 top-0 p-2 shadow-lg z-50 dark:bg-gray-900",children:[$.jsx("div",{className:"max-w-7xl h-full flex justify-between items-center px-4",children:$.jsxs(_r,{to:"/",className:"text-gray-700 dark:text-white text-2xl font-bold flex items-center space-x-2",children:[$.jsx(IX,{className:"text-4xl text-gray-700 dark:text-white mr-2"})," OpenShips"]})}),$.jsxs("div",{className:"absolute left-1/2 top-5/6 -translate-x-1/2 -translate-y-1/2 flex space-x-16",children:[$.jsx(_r,{to:"/gallery",className:"relative","aria-label":"Gallery",tabIndex:0,children:$.jsx("button",{className:"bg-white rounded-full shadow-lg flex items-center justify-center w-16 h-16 border-4 border-gray-500 active:scale-95 hover:scale-105 cursor-pointer transition-transform duration-150 hover:bg-gray-100 active:bg-gray-300",role:"button",tabIndex:0,"aria-label":"Gallery",children:$.jsx(J3,{className:"text-gray-700 text-5xl p-1.5"})})}),$.jsx(_r,{to:"/",className:"relative","aria-label":"Map",tabIndex:0,children:$.jsx("button",{className:"bg-white rounded-full shadow-lg flex items-center justify-center w-20 h-20 border-4 border-gray-500 active:scale-95 hover:scale-105 cursor-pointer transition-transform duration-150 hover:bg-gray-100 active:bg-gray-300",role:"button",tabIndex:0,"aria-label":"Map",children:$.jsx(Z3,{className:"text-5xl text-gray-700"})})}),$.jsx(_r,{to:"/vessels",className:"relative","aria-label":"Vessel List",tabIndex:0,children:$.jsx("button",{className:"bg-white rounded-full shadow-lg flex items-center justify-center w-16 h-16 border-4 border-gray-500 active:scale-95 hover:scale-105 cursor-pointer transition-transform duration-150 hover:bg-gray-100 active:bg-gray-300",role:"button",tabIndex:0,"aria-label":"Vessel List",children:$.jsx(Q3,{className:"text-gray-700 text-5xl p-1.5"})})})]}),$.jsxs("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 flex space-x-6",children:[$.jsx(_r,{to:"/account",className:"relative","aria-label":"Account",tabIndex:0,children:$.jsx("button",{className:"bg-white rounded-full shadow-lg flex items-center justify-center w-14 h-14 border-4 border-gray-500 active:scale-95 hover:scale-105 cursor-pointer transition-transform duration-150 hover:bg-gray-100 active:bg-gray-300",role:"button",tabIndex:0,"aria-label":"Account",children:$.jsx(eI,{className:"text-gray-700 text-5xl p-1"})})}),$.jsx(_r,{to:"/settings",className:"relative","aria-label":"Settings",tabIndex:0,children:$.jsx("button",{className:"bg-white rounded-full shadow-lg flex items-center justify-center w-14 h-14 border-4 border-gray-500 active:scale-95 hover:scale-105 cursor-pointer transition-transform duration-150 hover:bg-gray-100 active:bg-gray-300",role:"button",tabIndex:0,"aria-label":"Settings",children:$.jsx(M4,{className:"text-gray-700 text-5xl p-2"})})})]})]})}function Ur(n,e,{checkForDefaultPrevented:t=!0}={}){return function(i){if(n?.(i),t===!1||!i.defaultPrevented)return e?.(i)}}function tI(n,e){if(typeof n=="function")return n(e);n!=null&&(n.current=e)}function O4(...n){return e=>{let t=!1;const r=n.map(i=>{const s=tI(i,e);return!t&&typeof s=="function"&&(t=!0),s});if(t)return()=>{for(let i=0;i<r.length;i++){const s=r[i];typeof s=="function"?s():tI(n[i],null)}}}}function ir(...n){return A.useCallback(O4(...n),n)}function uc(n,e=[]){let t=[];function r(s,o){const a=A.createContext(o),u=t.length;t=[...t,o];const h=g=>{const{scope:y,children:v,...T}=g,w=y?.[n]?.[u]||a,E=A.useMemo(()=>T,Object.values(T));return $.jsx(w.Provider,{value:E,children:v})};h.displayName=s+"Provider";function d(g,y){const v=y?.[n]?.[u]||a,T=A.useContext(v);if(T)return T;if(o!==void 0)return o;throw new Error(`\`${g}\` must be used within \`${s}\``)}return[h,d]}const i=()=>{const s=t.map(o=>A.createContext(o));return function(a){const u=a?.[n]||s;return A.useMemo(()=>({[`__scope${n}`]:{...a,[n]:u}}),[a,u])}};return i.scopeName=n,[r,MX(i,...e)]}function MX(...n){const e=n[0];if(n.length===1)return e;const t=()=>{const r=n.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(s){const o=r.reduce((a,{useScope:u,scopeName:h})=>{const g=u(s)[`__scope${h}`];return{...a,...g}},{});return A.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return t.scopeName=e.scopeName,t}function Xy(n){const e=OX(n),t=A.forwardRef((r,i)=>{const{children:s,...o}=r,a=A.Children.toArray(s),u=a.find(NX);if(u){const h=u.props.children,d=a.map(g=>g===u?A.Children.count(h)>1?A.Children.only(null):A.isValidElement(h)?h.props.children:null:g);return $.jsx(e,{...o,ref:i,children:A.isValidElement(h)?A.cloneElement(h,void 0,d):null})}return $.jsx(e,{...o,ref:i,children:s})});return t.displayName=`${n}.Slot`,t}function OX(n){const e=A.forwardRef((t,r)=>{const{children:i,...s}=t;if(A.isValidElement(i)){const o=LX(i),a=DX(s,i.props);return i.type!==A.Fragment&&(a.ref=r?O4(r,o):o),A.cloneElement(i,a)}return A.Children.count(i)>1?A.Children.only(null):null});return e.displayName=`${n}.SlotClone`,e}var kX=Symbol("radix.slottable");function NX(n){return A.isValidElement(n)&&typeof n.type=="function"&&"__radixId"in n.type&&n.type.__radixId===kX}function DX(n,e){const t={...e};for(const r in e){const i=n[r],s=e[r];/^on[A-Z]/.test(r)?i&&s?t[r]=(...a)=>{const u=s(...a);return i(...a),u}:i&&(t[r]=i):r==="style"?t[r]={...i,...s}:r==="className"&&(t[r]=[i,s].filter(Boolean).join(" "))}return{...n,...t}}function LX(n){let e=Object.getOwnPropertyDescriptor(n.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=Object.getOwnPropertyDescriptor(n,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}var UX=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],wn=UX.reduce((n,e)=>{const t=Xy(`Primitive.${e}`),r=A.forwardRef((i,s)=>{const{asChild:o,...a}=i,u=o?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),$.jsx(u,{...a,ref:s})});return r.displayName=`Primitive.${e}`,{...n,[e]:r}},{});function VX(n,e){n&&Jx.flushSync(()=>n.dispatchEvent(e))}function eh(n){const e=A.useRef(n);return A.useEffect(()=>{e.current=n}),A.useMemo(()=>(...t)=>e.current?.(...t),[])}function FX(n,e=globalThis?.document){const t=eh(n);A.useEffect(()=>{const r=i=>{i.key==="Escape"&&t(i)};return e.addEventListener("keydown",r,{capture:!0}),()=>e.removeEventListener("keydown",r,{capture:!0})},[t,e])}var BX="DismissableLayer",Iw="dismissableLayer.update",zX="dismissableLayer.pointerDownOutside",jX="dismissableLayer.focusOutside",nI,k4=A.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),N4=A.forwardRef((n,e)=>{const{disableOutsidePointerEvents:t=!1,onEscapeKeyDown:r,onPointerDownOutside:i,onFocusOutside:s,onInteractOutside:o,onDismiss:a,...u}=n,h=A.useContext(k4),[d,g]=A.useState(null),y=d?.ownerDocument??globalThis?.document,[,v]=A.useState({}),T=ir(e,k=>g(k)),w=Array.from(h.layers),[E]=[...h.layersWithOutsidePointerEventsDisabled].slice(-1),S=w.indexOf(E),P=d?w.indexOf(d):-1,I=h.layersWithOutsidePointerEventsDisabled.size>0,L=P>=S,F=WX(k=>{const M=k.target,N=[...h.branches].some(H=>H.contains(M));!L||N||(i?.(k),o?.(k),k.defaultPrevented||a?.())},y),Y=qX(k=>{const M=k.target;[...h.branches].some(H=>H.contains(M))||(s?.(k),o?.(k),k.defaultPrevented||a?.())},y);return FX(k=>{P===h.layers.size-1&&(r?.(k),!k.defaultPrevented&&a&&(k.preventDefault(),a()))},y),A.useEffect(()=>{if(d)return t&&(h.layersWithOutsidePointerEventsDisabled.size===0&&(nI=y.body.style.pointerEvents,y.body.style.pointerEvents="none"),h.layersWithOutsidePointerEventsDisabled.add(d)),h.layers.add(d),rI(),()=>{t&&h.layersWithOutsidePointerEventsDisabled.size===1&&(y.body.style.pointerEvents=nI)}},[d,y,t,h]),A.useEffect(()=>()=>{d&&(h.layers.delete(d),h.layersWithOutsidePointerEventsDisabled.delete(d),rI())},[d,h]),A.useEffect(()=>{const k=()=>v({});return document.addEventListener(Iw,k),()=>document.removeEventListener(Iw,k)},[]),$.jsx(wn.div,{...u,ref:T,style:{pointerEvents:I?L?"auto":"none":void 0,...n.style},onFocusCapture:Ur(n.onFocusCapture,Y.onFocusCapture),onBlurCapture:Ur(n.onBlurCapture,Y.onBlurCapture),onPointerDownCapture:Ur(n.onPointerDownCapture,F.onPointerDownCapture)})});N4.displayName=BX;var HX="DismissableLayerBranch",$X=A.forwardRef((n,e)=>{const t=A.useContext(k4),r=A.useRef(null),i=ir(e,r);return A.useEffect(()=>{const s=r.current;if(s)return t.branches.add(s),()=>{t.branches.delete(s)}},[t.branches]),$.jsx(wn.div,{...n,ref:i})});$X.displayName=HX;function WX(n,e=globalThis?.document){const t=eh(n),r=A.useRef(!1),i=A.useRef(()=>{});return A.useEffect(()=>{const s=a=>{if(a.target&&!r.current){let u=function(){D4(zX,t,h,{discrete:!0})};const h={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",i.current),i.current=u,e.addEventListener("click",i.current,{once:!0})):u()}else e.removeEventListener("click",i.current);r.current=!1},o=window.setTimeout(()=>{e.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(o),e.removeEventListener("pointerdown",s),e.removeEventListener("click",i.current)}},[e,t]),{onPointerDownCapture:()=>r.current=!0}}function qX(n,e=globalThis?.document){const t=eh(n),r=A.useRef(!1);return A.useEffect(()=>{const i=s=>{s.target&&!r.current&&D4(jX,t,{originalEvent:s},{discrete:!1})};return e.addEventListener("focusin",i),()=>e.removeEventListener("focusin",i)},[e,t]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function rI(){const n=new CustomEvent(Iw);document.dispatchEvent(n)}function D4(n,e,t,{discrete:r}){const i=t.originalEvent.target,s=new CustomEvent(n,{bubbles:!1,cancelable:!0,detail:t});e&&i.addEventListener(n,e,{once:!0}),r?VX(i,s):i.dispatchEvent(s)}var V0=0;function XX(){A.useEffect(()=>{const n=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",n[0]??iI()),document.body.insertAdjacentElement("beforeend",n[1]??iI()),V0++,()=>{V0===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),V0--}},[])}function iI(){const n=document.createElement("span");return n.setAttribute("data-radix-focus-guard",""),n.tabIndex=0,n.style.outline="none",n.style.opacity="0",n.style.position="fixed",n.style.pointerEvents="none",n}var F0="focusScope.autoFocusOnMount",B0="focusScope.autoFocusOnUnmount",sI={bubbles:!1,cancelable:!0},YX="FocusScope",L4=A.forwardRef((n,e)=>{const{loop:t=!1,trapped:r=!1,onMountAutoFocus:i,onUnmountAutoFocus:s,...o}=n,[a,u]=A.useState(null),h=eh(i),d=eh(s),g=A.useRef(null),y=ir(e,w=>u(w)),v=A.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;A.useEffect(()=>{if(r){let w=function(I){if(v.paused||!a)return;const L=I.target;a.contains(L)?g.current=L:sa(g.current,{select:!0})},E=function(I){if(v.paused||!a)return;const L=I.relatedTarget;L!==null&&(a.contains(L)||sa(g.current,{select:!0}))},S=function(I){if(document.activeElement===document.body)for(const F of I)F.removedNodes.length>0&&sa(a)};document.addEventListener("focusin",w),document.addEventListener("focusout",E);const P=new MutationObserver(S);return a&&P.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",w),document.removeEventListener("focusout",E),P.disconnect()}}},[r,a,v.paused]),A.useEffect(()=>{if(a){aI.add(v);const w=document.activeElement;if(!a.contains(w)){const S=new CustomEvent(F0,sI);a.addEventListener(F0,h),a.dispatchEvent(S),S.defaultPrevented||(KX(eY(U4(a)),{select:!0}),document.activeElement===w&&sa(a))}return()=>{a.removeEventListener(F0,h),setTimeout(()=>{const S=new CustomEvent(B0,sI);a.addEventListener(B0,d),a.dispatchEvent(S),S.defaultPrevented||sa(w??document.body,{select:!0}),a.removeEventListener(B0,d),aI.remove(v)},0)}}},[a,h,d,v]);const T=A.useCallback(w=>{if(!t&&!r||v.paused)return;const E=w.key==="Tab"&&!w.altKey&&!w.ctrlKey&&!w.metaKey,S=document.activeElement;if(E&&S){const P=w.currentTarget,[I,L]=GX(P);I&&L?!w.shiftKey&&S===L?(w.preventDefault(),t&&sa(I,{select:!0})):w.shiftKey&&S===I&&(w.preventDefault(),t&&sa(L,{select:!0})):S===P&&w.preventDefault()}},[t,r,v.paused]);return $.jsx(wn.div,{tabIndex:-1,...o,ref:y,onKeyDown:T})});L4.displayName=YX;function KX(n,{select:e=!1}={}){const t=document.activeElement;for(const r of n)if(sa(r,{select:e}),document.activeElement!==t)return}function GX(n){const e=U4(n),t=oI(e,n),r=oI(e.reverse(),n);return[t,r]}function U4(n){const e=[],t=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const i=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||i?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function oI(n,e){for(const t of n)if(!ZX(t,{upTo:e}))return t}function ZX(n,{upTo:e}){if(getComputedStyle(n).visibility==="hidden")return!0;for(;n;){if(e!==void 0&&n===e)return!1;if(getComputedStyle(n).display==="none")return!0;n=n.parentElement}return!1}function QX(n){return n instanceof HTMLInputElement&&"select"in n}function sa(n,{select:e=!1}={}){if(n&&n.focus){const t=document.activeElement;n.focus({preventScroll:!0}),n!==t&&QX(n)&&e&&n.select()}}var aI=JX();function JX(){let n=[];return{add(e){const t=n[0];e!==t&&t?.pause(),n=lI(n,e),n.unshift(e)},remove(e){n=lI(n,e),n[0]?.resume()}}}function lI(n,e){const t=[...n],r=t.indexOf(e);return r!==-1&&t.splice(r,1),t}function eY(n){return n.filter(e=>e.tagName!=="A")}var ro=globalThis?.document?A.useLayoutEffect:()=>{},tY=Fk[" useId ".trim().toString()]||(()=>{}),nY=0;function qE(n){const[e,t]=A.useState(tY());return ro(()=>{t(r=>r??String(nY++))},[n]),n||(e?`radix-${e}`:"")}const rY=["top","right","bottom","left"],ka=Math.min,Nr=Math.max,Yy=Math.round,am=Math.floor,ls=n=>({x:n,y:n}),iY={left:"right",right:"left",bottom:"top",top:"bottom"},sY={start:"end",end:"start"};function Pw(n,e,t){return Nr(n,ka(e,t))}function io(n,e){return typeof n=="function"?n(e):n}function so(n){return n.split("-")[0]}function Eh(n){return n.split("-")[1]}function XE(n){return n==="x"?"y":"x"}function YE(n){return n==="y"?"height":"width"}const oY=new Set(["top","bottom"]);function es(n){return oY.has(so(n))?"y":"x"}function KE(n){return XE(es(n))}function aY(n,e,t){t===void 0&&(t=!1);const r=Eh(n),i=KE(n),s=YE(i);let o=i==="x"?r===(t?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(o=Ky(o)),[o,Ky(o)]}function lY(n){const e=Ky(n);return[Mw(n),e,Mw(e)]}function Mw(n){return n.replace(/start|end/g,e=>sY[e])}const cI=["left","right"],uI=["right","left"],cY=["top","bottom"],uY=["bottom","top"];function hY(n,e,t){switch(n){case"top":case"bottom":return t?e?uI:cI:e?cI:uI;case"left":case"right":return e?cY:uY;default:return[]}}function fY(n,e,t,r){const i=Eh(n);let s=hY(so(n),t==="start",r);return i&&(s=s.map(o=>o+"-"+i),e&&(s=s.concat(s.map(Mw)))),s}function Ky(n){return n.replace(/left|right|bottom|top/g,e=>iY[e])}function dY(n){return{top:0,right:0,bottom:0,left:0,...n}}function V4(n){return typeof n!="number"?dY(n):{top:n,right:n,bottom:n,left:n}}function Gy(n){const{x:e,y:t,width:r,height:i}=n;return{width:r,height:i,top:t,left:e,right:e+r,bottom:t+i,x:e,y:t}}function hI(n,e,t){let{reference:r,floating:i}=n;const s=es(e),o=KE(e),a=YE(o),u=so(e),h=s==="y",d=r.x+r.width/2-i.width/2,g=r.y+r.height/2-i.height/2,y=r[a]/2-i[a]/2;let v;switch(u){case"top":v={x:d,y:r.y-i.height};break;case"bottom":v={x:d,y:r.y+r.height};break;case"right":v={x:r.x+r.width,y:g};break;case"left":v={x:r.x-i.width,y:g};break;default:v={x:r.x,y:r.y}}switch(Eh(e)){case"start":v[o]-=y*(t&&h?-1:1);break;case"end":v[o]+=y*(t&&h?-1:1);break}return v}const pY=async(n,e,t)=>{const{placement:r="bottom",strategy:i="absolute",middleware:s=[],platform:o}=t,a=s.filter(Boolean),u=await(o.isRTL==null?void 0:o.isRTL(e));let h=await o.getElementRects({reference:n,floating:e,strategy:i}),{x:d,y:g}=hI(h,r,u),y=r,v={},T=0;for(let w=0;w<a.length;w++){const{name:E,fn:S}=a[w],{x:P,y:I,data:L,reset:F}=await S({x:d,y:g,initialPlacement:r,placement:y,strategy:i,middlewareData:v,rects:h,platform:o,elements:{reference:n,floating:e}});d=P??d,g=I??g,v={...v,[E]:{...v[E],...L}},F&&T<=50&&(T++,typeof F=="object"&&(F.placement&&(y=F.placement),F.rects&&(h=F.rects===!0?await o.getElementRects({reference:n,floating:e,strategy:i}):F.rects),{x:d,y:g}=hI(h,y,u)),w=-1)}return{x:d,y:g,placement:y,strategy:i,middlewareData:v}};async function Xd(n,e){var t;e===void 0&&(e={});const{x:r,y:i,platform:s,rects:o,elements:a,strategy:u}=n,{boundary:h="clippingAncestors",rootBoundary:d="viewport",elementContext:g="floating",altBoundary:y=!1,padding:v=0}=io(e,n),T=V4(v),E=a[y?g==="floating"?"reference":"floating":g],S=Gy(await s.getClippingRect({element:(t=await(s.isElement==null?void 0:s.isElement(E)))==null||t?E:E.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(a.floating)),boundary:h,rootBoundary:d,strategy:u})),P=g==="floating"?{x:r,y:i,width:o.floating.width,height:o.floating.height}:o.reference,I=await(s.getOffsetParent==null?void 0:s.getOffsetParent(a.floating)),L=await(s.isElement==null?void 0:s.isElement(I))?await(s.getScale==null?void 0:s.getScale(I))||{x:1,y:1}:{x:1,y:1},F=Gy(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:P,offsetParent:I,strategy:u}):P);return{top:(S.top-F.top+T.top)/L.y,bottom:(F.bottom-S.bottom+T.bottom)/L.y,left:(S.left-F.left+T.left)/L.x,right:(F.right-S.right+T.right)/L.x}}const gY=n=>({name:"arrow",options:n,async fn(e){const{x:t,y:r,placement:i,rects:s,platform:o,elements:a,middlewareData:u}=e,{element:h,padding:d=0}=io(n,e)||{};if(h==null)return{};const g=V4(d),y={x:t,y:r},v=KE(i),T=YE(v),w=await o.getDimensions(h),E=v==="y",S=E?"top":"left",P=E?"bottom":"right",I=E?"clientHeight":"clientWidth",L=s.reference[T]+s.reference[v]-y[v]-s.floating[T],F=y[v]-s.reference[v],Y=await(o.getOffsetParent==null?void 0:o.getOffsetParent(h));let k=Y?Y[I]:0;(!k||!await(o.isElement==null?void 0:o.isElement(Y)))&&(k=a.floating[I]||s.floating[T]);const M=L/2-F/2,N=k/2-w[T]/2-1,H=ka(g[S],N),q=ka(g[P],N),K=H,j=k-w[T]-q,de=k/2-w[T]/2+M,Ee=Pw(K,de,j),O=!u.arrow&&Eh(i)!=null&&de!==Ee&&s.reference[T]/2-(de<K?H:q)-w[T]/2<0,W=O?de<K?de-K:de-j:0;return{[v]:y[v]+W,data:{[v]:Ee,centerOffset:de-Ee-W,...O&&{alignmentOffset:W}},reset:O}}}),mY=function(n){return n===void 0&&(n={}),{name:"flip",options:n,async fn(e){var t,r;const{placement:i,middlewareData:s,rects:o,initialPlacement:a,platform:u,elements:h}=e,{mainAxis:d=!0,crossAxis:g=!0,fallbackPlacements:y,fallbackStrategy:v="bestFit",fallbackAxisSideDirection:T="none",flipAlignment:w=!0,...E}=io(n,e);if((t=s.arrow)!=null&&t.alignmentOffset)return{};const S=so(i),P=es(a),I=so(a)===a,L=await(u.isRTL==null?void 0:u.isRTL(h.floating)),F=y||(I||!w?[Ky(a)]:lY(a)),Y=T!=="none";!y&&Y&&F.push(...fY(a,w,T,L));const k=[a,...F],M=await Xd(e,E),N=[];let H=((r=s.flip)==null?void 0:r.overflows)||[];if(d&&N.push(M[S]),g){const de=aY(i,o,L);N.push(M[de[0]],M[de[1]])}if(H=[...H,{placement:i,overflows:N}],!N.every(de=>de<=0)){var q,K;const de=(((q=s.flip)==null?void 0:q.index)||0)+1,Ee=k[de];if(Ee&&(!(g==="alignment"?P!==es(Ee):!1)||H.every(U=>es(U.placement)===P?U.overflows[0]>0:!0)))return{data:{index:de,overflows:H},reset:{placement:Ee}};let O=(K=H.filter(W=>W.overflows[0]<=0).sort((W,U)=>W.overflows[1]-U.overflows[1])[0])==null?void 0:K.placement;if(!O)switch(v){case"bestFit":{var j;const W=(j=H.filter(U=>{if(Y){const ie=es(U.placement);return ie===P||ie==="y"}return!0}).map(U=>[U.placement,U.overflows.filter(ie=>ie>0).reduce((ie,V)=>ie+V,0)]).sort((U,ie)=>U[1]-ie[1])[0])==null?void 0:j[0];W&&(O=W);break}case"initialPlacement":O=a;break}if(i!==O)return{reset:{placement:O}}}return{}}}};function fI(n,e){return{top:n.top-e.height,right:n.right-e.width,bottom:n.bottom-e.height,left:n.left-e.width}}function dI(n){return rY.some(e=>n[e]>=0)}const yY=function(n){return n===void 0&&(n={}),{name:"hide",options:n,async fn(e){const{rects:t}=e,{strategy:r="referenceHidden",...i}=io(n,e);switch(r){case"referenceHidden":{const s=await Xd(e,{...i,elementContext:"reference"}),o=fI(s,t.reference);return{data:{referenceHiddenOffsets:o,referenceHidden:dI(o)}}}case"escaped":{const s=await Xd(e,{...i,altBoundary:!0}),o=fI(s,t.floating);return{data:{escapedOffsets:o,escaped:dI(o)}}}default:return{}}}}},F4=new Set(["left","top"]);async function _Y(n,e){const{placement:t,platform:r,elements:i}=n,s=await(r.isRTL==null?void 0:r.isRTL(i.floating)),o=so(t),a=Eh(t),u=es(t)==="y",h=F4.has(o)?-1:1,d=s&&u?-1:1,g=io(e,n);let{mainAxis:y,crossAxis:v,alignmentAxis:T}=typeof g=="number"?{mainAxis:g,crossAxis:0,alignmentAxis:null}:{mainAxis:g.mainAxis||0,crossAxis:g.crossAxis||0,alignmentAxis:g.alignmentAxis};return a&&typeof T=="number"&&(v=a==="end"?T*-1:T),u?{x:v*d,y:y*h}:{x:y*h,y:v*d}}const vY=function(n){return n===void 0&&(n=0),{name:"offset",options:n,async fn(e){var t,r;const{x:i,y:s,placement:o,middlewareData:a}=e,u=await _Y(e,n);return o===((t=a.offset)==null?void 0:t.placement)&&(r=a.arrow)!=null&&r.alignmentOffset?{}:{x:i+u.x,y:s+u.y,data:{...u,placement:o}}}}},bY=function(n){return n===void 0&&(n={}),{name:"shift",options:n,async fn(e){const{x:t,y:r,placement:i}=e,{mainAxis:s=!0,crossAxis:o=!1,limiter:a={fn:E=>{let{x:S,y:P}=E;return{x:S,y:P}}},...u}=io(n,e),h={x:t,y:r},d=await Xd(e,u),g=es(so(i)),y=XE(g);let v=h[y],T=h[g];if(s){const E=y==="y"?"top":"left",S=y==="y"?"bottom":"right",P=v+d[E],I=v-d[S];v=Pw(P,v,I)}if(o){const E=g==="y"?"top":"left",S=g==="y"?"bottom":"right",P=T+d[E],I=T-d[S];T=Pw(P,T,I)}const w=a.fn({...e,[y]:v,[g]:T});return{...w,data:{x:w.x-t,y:w.y-r,enabled:{[y]:s,[g]:o}}}}}},TY=function(n){return n===void 0&&(n={}),{options:n,fn(e){const{x:t,y:r,placement:i,rects:s,middlewareData:o}=e,{offset:a=0,mainAxis:u=!0,crossAxis:h=!0}=io(n,e),d={x:t,y:r},g=es(i),y=XE(g);let v=d[y],T=d[g];const w=io(a,e),E=typeof w=="number"?{mainAxis:w,crossAxis:0}:{mainAxis:0,crossAxis:0,...w};if(u){const I=y==="y"?"height":"width",L=s.reference[y]-s.floating[I]+E.mainAxis,F=s.reference[y]+s.reference[I]-E.mainAxis;v<L?v=L:v>F&&(v=F)}if(h){var S,P;const I=y==="y"?"width":"height",L=F4.has(so(i)),F=s.reference[g]-s.floating[I]+(L&&((S=o.offset)==null?void 0:S[g])||0)+(L?0:E.crossAxis),Y=s.reference[g]+s.reference[I]+(L?0:((P=o.offset)==null?void 0:P[g])||0)-(L?E.crossAxis:0);T<F?T=F:T>Y&&(T=Y)}return{[y]:v,[g]:T}}}},wY=function(n){return n===void 0&&(n={}),{name:"size",options:n,async fn(e){var t,r;const{placement:i,rects:s,platform:o,elements:a}=e,{apply:u=()=>{},...h}=io(n,e),d=await Xd(e,h),g=so(i),y=Eh(i),v=es(i)==="y",{width:T,height:w}=s.floating;let E,S;g==="top"||g==="bottom"?(E=g,S=y===(await(o.isRTL==null?void 0:o.isRTL(a.floating))?"start":"end")?"left":"right"):(S=g,E=y==="end"?"top":"bottom");const P=w-d.top-d.bottom,I=T-d.left-d.right,L=ka(w-d[E],P),F=ka(T-d[S],I),Y=!e.middlewareData.shift;let k=L,M=F;if((t=e.middlewareData.shift)!=null&&t.enabled.x&&(M=I),(r=e.middlewareData.shift)!=null&&r.enabled.y&&(k=P),Y&&!y){const H=Nr(d.left,0),q=Nr(d.right,0),K=Nr(d.top,0),j=Nr(d.bottom,0);v?M=T-2*(H!==0||q!==0?H+q:Nr(d.left,d.right)):k=w-2*(K!==0||j!==0?K+j:Nr(d.top,d.bottom))}await u({...e,availableWidth:M,availableHeight:k});const N=await o.getDimensions(a.floating);return T!==N.width||w!==N.height?{reset:{rects:!0}}:{}}}};function W_(){return typeof window<"u"}function Ah(n){return B4(n)?(n.nodeName||"").toLowerCase():"#document"}function Vr(n){var e;return(n==null||(e=n.ownerDocument)==null?void 0:e.defaultView)||window}function ms(n){var e;return(e=(B4(n)?n.ownerDocument:n.document)||window.document)==null?void 0:e.documentElement}function B4(n){return W_()?n instanceof Node||n instanceof Vr(n).Node:!1}function Ci(n){return W_()?n instanceof Element||n instanceof Vr(n).Element:!1}function ps(n){return W_()?n instanceof HTMLElement||n instanceof Vr(n).HTMLElement:!1}function pI(n){return!W_()||typeof ShadowRoot>"u"?!1:n instanceof ShadowRoot||n instanceof Vr(n).ShadowRoot}const xY=new Set(["inline","contents"]);function xp(n){const{overflow:e,overflowX:t,overflowY:r,display:i}=Ii(n);return/auto|scroll|overlay|hidden|clip/.test(e+r+t)&&!xY.has(i)}const EY=new Set(["table","td","th"]);function AY(n){return EY.has(Ah(n))}const SY=[":popover-open",":modal"];function q_(n){return SY.some(e=>{try{return n.matches(e)}catch{return!1}})}const RY=["transform","translate","scale","rotate","perspective"],CY=["transform","translate","scale","rotate","perspective","filter"],IY=["paint","layout","strict","content"];function GE(n){const e=ZE(),t=Ci(n)?Ii(n):n;return RY.some(r=>t[r]?t[r]!=="none":!1)||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||CY.some(r=>(t.willChange||"").includes(r))||IY.some(r=>(t.contain||"").includes(r))}function PY(n){let e=Na(n);for(;ps(e)&&!th(e);){if(GE(e))return e;if(q_(e))return null;e=Na(e)}return null}function ZE(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const MY=new Set(["html","body","#document"]);function th(n){return MY.has(Ah(n))}function Ii(n){return Vr(n).getComputedStyle(n)}function X_(n){return Ci(n)?{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}:{scrollLeft:n.scrollX,scrollTop:n.scrollY}}function Na(n){if(Ah(n)==="html")return n;const e=n.assignedSlot||n.parentNode||pI(n)&&n.host||ms(n);return pI(e)?e.host:e}function z4(n){const e=Na(n);return th(e)?n.ownerDocument?n.ownerDocument.body:n.body:ps(e)&&xp(e)?e:z4(e)}function Yd(n,e,t){var r;e===void 0&&(e=[]),t===void 0&&(t=!0);const i=z4(n),s=i===((r=n.ownerDocument)==null?void 0:r.body),o=Vr(i);if(s){const a=Ow(o);return e.concat(o,o.visualViewport||[],xp(i)?i:[],a&&t?Yd(a):[])}return e.concat(i,Yd(i,[],t))}function Ow(n){return n.parent&&Object.getPrototypeOf(n.parent)?n.frameElement:null}function j4(n){const e=Ii(n);let t=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const i=ps(n),s=i?n.offsetWidth:t,o=i?n.offsetHeight:r,a=Yy(t)!==s||Yy(r)!==o;return a&&(t=s,r=o),{width:t,height:r,$:a}}function QE(n){return Ci(n)?n:n.contextElement}function Fu(n){const e=QE(n);if(!ps(e))return ls(1);const t=e.getBoundingClientRect(),{width:r,height:i,$:s}=j4(e);let o=(s?Yy(t.width):t.width)/r,a=(s?Yy(t.height):t.height)/i;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const OY=ls(0);function H4(n){const e=Vr(n);return!ZE()||!e.visualViewport?OY:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function kY(n,e,t){return e===void 0&&(e=!1),!t||e&&t!==Vr(n)?!1:e}function Zl(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=!1);const i=n.getBoundingClientRect(),s=QE(n);let o=ls(1);e&&(r?Ci(r)&&(o=Fu(r)):o=Fu(n));const a=kY(s,t,r)?H4(s):ls(0);let u=(i.left+a.x)/o.x,h=(i.top+a.y)/o.y,d=i.width/o.x,g=i.height/o.y;if(s){const y=Vr(s),v=r&&Ci(r)?Vr(r):r;let T=y,w=Ow(T);for(;w&&r&&v!==T;){const E=Fu(w),S=w.getBoundingClientRect(),P=Ii(w),I=S.left+(w.clientLeft+parseFloat(P.paddingLeft))*E.x,L=S.top+(w.clientTop+parseFloat(P.paddingTop))*E.y;u*=E.x,h*=E.y,d*=E.x,g*=E.y,u+=I,h+=L,T=Vr(w),w=Ow(T)}}return Gy({width:d,height:g,x:u,y:h})}function Y_(n,e){const t=X_(n).scrollLeft;return e?e.left+t:Zl(ms(n)).left+t}function $4(n,e){const t=n.getBoundingClientRect(),r=t.left+e.scrollLeft-Y_(n,t),i=t.top+e.scrollTop;return{x:r,y:i}}function NY(n){let{elements:e,rect:t,offsetParent:r,strategy:i}=n;const s=i==="fixed",o=ms(r),a=e?q_(e.floating):!1;if(r===o||a&&s)return t;let u={scrollLeft:0,scrollTop:0},h=ls(1);const d=ls(0),g=ps(r);if((g||!g&&!s)&&((Ah(r)!=="body"||xp(o))&&(u=X_(r)),ps(r))){const v=Zl(r);h=Fu(r),d.x=v.x+r.clientLeft,d.y=v.y+r.clientTop}const y=o&&!g&&!s?$4(o,u):ls(0);return{width:t.width*h.x,height:t.height*h.y,x:t.x*h.x-u.scrollLeft*h.x+d.x+y.x,y:t.y*h.y-u.scrollTop*h.y+d.y+y.y}}function DY(n){return Array.from(n.getClientRects())}function LY(n){const e=ms(n),t=X_(n),r=n.ownerDocument.body,i=Nr(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),s=Nr(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let o=-t.scrollLeft+Y_(n);const a=-t.scrollTop;return Ii(r).direction==="rtl"&&(o+=Nr(e.clientWidth,r.clientWidth)-i),{width:i,height:s,x:o,y:a}}const gI=25;function UY(n,e){const t=Vr(n),r=ms(n),i=t.visualViewport;let s=r.clientWidth,o=r.clientHeight,a=0,u=0;if(i){s=i.width,o=i.height;const d=ZE();(!d||d&&e==="fixed")&&(a=i.offsetLeft,u=i.offsetTop)}const h=Y_(r);if(h<=0){const d=r.ownerDocument,g=d.body,y=getComputedStyle(g),v=d.compatMode==="CSS1Compat"&&parseFloat(y.marginLeft)+parseFloat(y.marginRight)||0,T=Math.abs(r.clientWidth-g.clientWidth-v);T<=gI&&(s-=T)}else h<=gI&&(s+=h);return{width:s,height:o,x:a,y:u}}const VY=new Set(["absolute","fixed"]);function FY(n,e){const t=Zl(n,!0,e==="fixed"),r=t.top+n.clientTop,i=t.left+n.clientLeft,s=ps(n)?Fu(n):ls(1),o=n.clientWidth*s.x,a=n.clientHeight*s.y,u=i*s.x,h=r*s.y;return{width:o,height:a,x:u,y:h}}function mI(n,e,t){let r;if(e==="viewport")r=UY(n,t);else if(e==="document")r=LY(ms(n));else if(Ci(e))r=FY(e,t);else{const i=H4(n);r={x:e.x-i.x,y:e.y-i.y,width:e.width,height:e.height}}return Gy(r)}function W4(n,e){const t=Na(n);return t===e||!Ci(t)||th(t)?!1:Ii(t).position==="fixed"||W4(t,e)}function BY(n,e){const t=e.get(n);if(t)return t;let r=Yd(n,[],!1).filter(a=>Ci(a)&&Ah(a)!=="body"),i=null;const s=Ii(n).position==="fixed";let o=s?Na(n):n;for(;Ci(o)&&!th(o);){const a=Ii(o),u=GE(o);!u&&a.position==="fixed"&&(i=null),(s?!u&&!i:!u&&a.position==="static"&&!!i&&VY.has(i.position)||xp(o)&&!u&&W4(n,o))?r=r.filter(d=>d!==o):i=a,o=Na(o)}return e.set(n,r),r}function zY(n){let{element:e,boundary:t,rootBoundary:r,strategy:i}=n;const o=[...t==="clippingAncestors"?q_(e)?[]:BY(e,this._c):[].concat(t),r],a=o[0],u=o.reduce((h,d)=>{const g=mI(e,d,i);return h.top=Nr(g.top,h.top),h.right=ka(g.right,h.right),h.bottom=ka(g.bottom,h.bottom),h.left=Nr(g.left,h.left),h},mI(e,a,i));return{width:u.right-u.left,height:u.bottom-u.top,x:u.left,y:u.top}}function jY(n){const{width:e,height:t}=j4(n);return{width:e,height:t}}function HY(n,e,t){const r=ps(e),i=ms(e),s=t==="fixed",o=Zl(n,!0,s,e);let a={scrollLeft:0,scrollTop:0};const u=ls(0);function h(){u.x=Y_(i)}if(r||!r&&!s)if((Ah(e)!=="body"||xp(i))&&(a=X_(e)),r){const v=Zl(e,!0,s,e);u.x=v.x+e.clientLeft,u.y=v.y+e.clientTop}else i&&h();s&&!r&&i&&h();const d=i&&!r&&!s?$4(i,a):ls(0),g=o.left+a.scrollLeft-u.x-d.x,y=o.top+a.scrollTop-u.y-d.y;return{x:g,y,width:o.width,height:o.height}}function z0(n){return Ii(n).position==="static"}function yI(n,e){if(!ps(n)||Ii(n).position==="fixed")return null;if(e)return e(n);let t=n.offsetParent;return ms(n)===t&&(t=t.ownerDocument.body),t}function q4(n,e){const t=Vr(n);if(q_(n))return t;if(!ps(n)){let i=Na(n);for(;i&&!th(i);){if(Ci(i)&&!z0(i))return i;i=Na(i)}return t}let r=yI(n,e);for(;r&&AY(r)&&z0(r);)r=yI(r,e);return r&&th(r)&&z0(r)&&!GE(r)?t:r||PY(n)||t}const $Y=async function(n){const e=this.getOffsetParent||q4,t=this.getDimensions,r=await t(n.floating);return{reference:HY(n.reference,await e(n.floating),n.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function WY(n){return Ii(n).direction==="rtl"}const qY={convertOffsetParentRelativeRectToViewportRelativeRect:NY,getDocumentElement:ms,getClippingRect:zY,getOffsetParent:q4,getElementRects:$Y,getClientRects:DY,getDimensions:jY,getScale:Fu,isElement:Ci,isRTL:WY};function X4(n,e){return n.x===e.x&&n.y===e.y&&n.width===e.width&&n.height===e.height}function XY(n,e){let t=null,r;const i=ms(n);function s(){var a;clearTimeout(r),(a=t)==null||a.disconnect(),t=null}function o(a,u){a===void 0&&(a=!1),u===void 0&&(u=1),s();const h=n.getBoundingClientRect(),{left:d,top:g,width:y,height:v}=h;if(a||e(),!y||!v)return;const T=am(g),w=am(i.clientWidth-(d+y)),E=am(i.clientHeight-(g+v)),S=am(d),I={rootMargin:-T+"px "+-w+"px "+-E+"px "+-S+"px",threshold:Nr(0,ka(1,u))||1};let L=!0;function F(Y){const k=Y[0].intersectionRatio;if(k!==u){if(!L)return o();k?o(!1,k):r=setTimeout(()=>{o(!1,1e-7)},1e3)}k===1&&!X4(h,n.getBoundingClientRect())&&o(),L=!1}try{t=new IntersectionObserver(F,{...I,root:i.ownerDocument})}catch{t=new IntersectionObserver(F,I)}t.observe(n)}return o(!0),s}function YY(n,e,t,r){r===void 0&&(r={});const{ancestorScroll:i=!0,ancestorResize:s=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:u=!1}=r,h=QE(n),d=i||s?[...h?Yd(h):[],...Yd(e)]:[];d.forEach(S=>{i&&S.addEventListener("scroll",t,{passive:!0}),s&&S.addEventListener("resize",t)});const g=h&&a?XY(h,t):null;let y=-1,v=null;o&&(v=new ResizeObserver(S=>{let[P]=S;P&&P.target===h&&v&&(v.unobserve(e),cancelAnimationFrame(y),y=requestAnimationFrame(()=>{var I;(I=v)==null||I.observe(e)})),t()}),h&&!u&&v.observe(h),v.observe(e));let T,w=u?Zl(n):null;u&&E();function E(){const S=Zl(n);w&&!X4(w,S)&&t(),w=S,T=requestAnimationFrame(E)}return t(),()=>{var S;d.forEach(P=>{i&&P.removeEventListener("scroll",t),s&&P.removeEventListener("resize",t)}),g?.(),(S=v)==null||S.disconnect(),v=null,u&&cancelAnimationFrame(T)}}const KY=vY,GY=bY,ZY=mY,QY=wY,JY=yY,_I=gY,eK=TY,tK=(n,e,t)=>{const r=new Map,i={platform:qY,...t},s={...i.platform,_c:r};return pY(n,e,{...i,platform:s})};var nK=typeof document<"u",rK=function(){},ry=nK?A.useLayoutEffect:rK;function Zy(n,e){if(n===e)return!0;if(typeof n!=typeof e)return!1;if(typeof n=="function"&&n.toString()===e.toString())return!0;let t,r,i;if(n&&e&&typeof n=="object"){if(Array.isArray(n)){if(t=n.length,t!==e.length)return!1;for(r=t;r--!==0;)if(!Zy(n[r],e[r]))return!1;return!0}if(i=Object.keys(n),t=i.length,t!==Object.keys(e).length)return!1;for(r=t;r--!==0;)if(!{}.hasOwnProperty.call(e,i[r]))return!1;for(r=t;r--!==0;){const s=i[r];if(!(s==="_owner"&&n.$$typeof)&&!Zy(n[s],e[s]))return!1}return!0}return n!==n&&e!==e}function Y4(n){return typeof window>"u"?1:(n.ownerDocument.defaultView||window).devicePixelRatio||1}function vI(n,e){const t=Y4(n);return Math.round(e*t)/t}function j0(n){const e=A.useRef(n);return ry(()=>{e.current=n}),e}function iK(n){n===void 0&&(n={});const{placement:e="bottom",strategy:t="absolute",middleware:r=[],platform:i,elements:{reference:s,floating:o}={},transform:a=!0,whileElementsMounted:u,open:h}=n,[d,g]=A.useState({x:0,y:0,strategy:t,placement:e,middlewareData:{},isPositioned:!1}),[y,v]=A.useState(r);Zy(y,r)||v(r);const[T,w]=A.useState(null),[E,S]=A.useState(null),P=A.useCallback(U=>{U!==Y.current&&(Y.current=U,w(U))},[]),I=A.useCallback(U=>{U!==k.current&&(k.current=U,S(U))},[]),L=s||T,F=o||E,Y=A.useRef(null),k=A.useRef(null),M=A.useRef(d),N=u!=null,H=j0(u),q=j0(i),K=j0(h),j=A.useCallback(()=>{if(!Y.current||!k.current)return;const U={placement:e,strategy:t,middleware:y};q.current&&(U.platform=q.current),tK(Y.current,k.current,U).then(ie=>{const V={...ie,isPositioned:K.current!==!1};de.current&&!Zy(M.current,V)&&(M.current=V,Jx.flushSync(()=>{g(V)}))})},[y,e,t,q,K]);ry(()=>{h===!1&&M.current.isPositioned&&(M.current.isPositioned=!1,g(U=>({...U,isPositioned:!1})))},[h]);const de=A.useRef(!1);ry(()=>(de.current=!0,()=>{de.current=!1}),[]),ry(()=>{if(L&&(Y.current=L),F&&(k.current=F),L&&F){if(H.current)return H.current(L,F,j);j()}},[L,F,j,H,N]);const Ee=A.useMemo(()=>({reference:Y,floating:k,setReference:P,setFloating:I}),[P,I]),O=A.useMemo(()=>({reference:L,floating:F}),[L,F]),W=A.useMemo(()=>{const U={position:t,left:0,top:0};if(!O.floating)return U;const ie=vI(O.floating,d.x),V=vI(O.floating,d.y);return a?{...U,transform:"translate("+ie+"px, "+V+"px)",...Y4(O.floating)>=1.5&&{willChange:"transform"}}:{position:t,left:ie,top:V}},[t,a,O.floating,d.x,d.y]);return A.useMemo(()=>({...d,update:j,refs:Ee,elements:O,floatingStyles:W}),[d,j,Ee,O,W])}const sK=n=>{function e(t){return{}.hasOwnProperty.call(t,"current")}return{name:"arrow",options:n,fn(t){const{element:r,padding:i}=typeof n=="function"?n(t):n;return r&&e(r)?r.current!=null?_I({element:r.current,padding:i}).fn(t):{}:r?_I({element:r,padding:i}).fn(t):{}}}},oK=(n,e)=>({...KY(n),options:[n,e]}),aK=(n,e)=>({...GY(n),options:[n,e]}),lK=(n,e)=>({...eK(n),options:[n,e]}),cK=(n,e)=>({...ZY(n),options:[n,e]}),uK=(n,e)=>({...QY(n),options:[n,e]}),hK=(n,e)=>({...JY(n),options:[n,e]}),fK=(n,e)=>({...sK(n),options:[n,e]});var dK="Arrow",K4=A.forwardRef((n,e)=>{const{children:t,width:r=10,height:i=5,...s}=n;return $.jsx(wn.svg,{...s,ref:e,width:r,height:i,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:n.asChild?t:$.jsx("polygon",{points:"0,0 30,0 15,10"})})});K4.displayName=dK;var pK=K4;function JE(n){const[e,t]=A.useState(void 0);return ro(()=>{if(n){t({width:n.offsetWidth,height:n.offsetHeight});const r=new ResizeObserver(i=>{if(!Array.isArray(i)||!i.length)return;const s=i[0];let o,a;if("borderBoxSize"in s){const u=s.borderBoxSize,h=Array.isArray(u)?u[0]:u;o=h.inlineSize,a=h.blockSize}else o=n.offsetWidth,a=n.offsetHeight;t({width:o,height:a})});return r.observe(n,{box:"border-box"}),()=>r.unobserve(n)}else t(void 0)},[n]),e}var e1="Popper",[G4,Z4]=uc(e1),[gK,Q4]=G4(e1),J4=n=>{const{__scopePopper:e,children:t}=n,[r,i]=A.useState(null);return $.jsx(gK,{scope:e,anchor:r,onAnchorChange:i,children:t})};J4.displayName=e1;var eL="PopperAnchor",tL=A.forwardRef((n,e)=>{const{__scopePopper:t,virtualRef:r,...i}=n,s=Q4(eL,t),o=A.useRef(null),a=ir(e,o),u=A.useRef(null);return A.useEffect(()=>{const h=u.current;u.current=r?.current||o.current,h!==u.current&&s.onAnchorChange(u.current)}),r?null:$.jsx(wn.div,{...i,ref:a})});tL.displayName=eL;var t1="PopperContent",[mK,yK]=G4(t1),nL=A.forwardRef((n,e)=>{const{__scopePopper:t,side:r="bottom",sideOffset:i=0,align:s="center",alignOffset:o=0,arrowPadding:a=0,avoidCollisions:u=!0,collisionBoundary:h=[],collisionPadding:d=0,sticky:g="partial",hideWhenDetached:y=!1,updatePositionStrategy:v="optimized",onPlaced:T,...w}=n,E=Q4(t1,t),[S,P]=A.useState(null),I=ir(e,Ce=>P(Ce)),[L,F]=A.useState(null),Y=JE(L),k=Y?.width??0,M=Y?.height??0,N=r+(s!=="center"?"-"+s:""),H=typeof d=="number"?d:{top:0,right:0,bottom:0,left:0,...d},q=Array.isArray(h)?h:[h],K=q.length>0,j={padding:H,boundary:q.filter(vK),altBoundary:K},{refs:de,floatingStyles:Ee,placement:O,isPositioned:W,middlewareData:U}=iK({strategy:"fixed",placement:N,whileElementsMounted:(...Ce)=>YY(...Ce,{animationFrame:v==="always"}),elements:{reference:E.anchor},middleware:[oK({mainAxis:i+M,alignmentAxis:o}),u&&aK({mainAxis:!0,crossAxis:!1,limiter:g==="partial"?lK():void 0,...j}),u&&cK({...j}),uK({...j,apply:({elements:Ce,rects:Me,availableWidth:lt,availableHeight:Ge})=>{const{width:xn,height:fn}=Me.reference,sr=Ce.floating.style;sr.setProperty("--radix-popper-available-width",`${lt}px`),sr.setProperty("--radix-popper-available-height",`${Ge}px`),sr.setProperty("--radix-popper-anchor-width",`${xn}px`),sr.setProperty("--radix-popper-anchor-height",`${fn}px`)}}),L&&fK({element:L,padding:a}),bK({arrowWidth:k,arrowHeight:M}),y&&hK({strategy:"referenceHidden",...j})]}),[ie,V]=sL(O),Z=eh(T);ro(()=>{W&&Z?.()},[W,Z]);const se=U.arrow?.x,ae=U.arrow?.y,me=U.arrow?.centerOffset!==0,[xe,Se]=A.useState();return ro(()=>{S&&Se(window.getComputedStyle(S).zIndex)},[S]),$.jsx("div",{ref:de.setFloating,"data-radix-popper-content-wrapper":"",style:{...Ee,transform:W?Ee.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:xe,"--radix-popper-transform-origin":[U.transformOrigin?.x,U.transformOrigin?.y].join(" "),...U.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:n.dir,children:$.jsx(mK,{scope:t,placedSide:ie,onArrowChange:F,arrowX:se,arrowY:ae,shouldHideArrow:me,children:$.jsx(wn.div,{"data-side":ie,"data-align":V,...w,ref:I,style:{...w.style,animation:W?void 0:"none"}})})})});nL.displayName=t1;var rL="PopperArrow",_K={top:"bottom",right:"left",bottom:"top",left:"right"},iL=A.forwardRef(function(e,t){const{__scopePopper:r,...i}=e,s=yK(rL,r),o=_K[s.placedSide];return $.jsx("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0},children:$.jsx(pK,{...i,ref:t,style:{...i.style,display:"block"}})})});iL.displayName=rL;function vK(n){return n!==null}var bK=n=>({name:"transformOrigin",options:n,fn(e){const{placement:t,rects:r,middlewareData:i}=e,o=i.arrow?.centerOffset!==0,a=o?0:n.arrowWidth,u=o?0:n.arrowHeight,[h,d]=sL(t),g={start:"0%",center:"50%",end:"100%"}[d],y=(i.arrow?.x??0)+a/2,v=(i.arrow?.y??0)+u/2;let T="",w="";return h==="bottom"?(T=o?g:`${y}px`,w=`${-u}px`):h==="top"?(T=o?g:`${y}px`,w=`${r.floating.height+u}px`):h==="right"?(T=`${-u}px`,w=o?g:`${v}px`):h==="left"&&(T=`${r.floating.width+u}px`,w=o?g:`${v}px`),{data:{x:T,y:w}}}});function sL(n){const[e,t="center"]=n.split("-");return[e,t]}var TK=J4,oL=tL,wK=nL,xK=iL,EK="Portal",aL=A.forwardRef((n,e)=>{const{container:t,...r}=n,[i,s]=A.useState(!1);ro(()=>s(!0),[]);const o=t||i&&globalThis?.document?.body;return o?Gz.createPortal($.jsx(wn.div,{...r,ref:e}),o):null});aL.displayName=EK;function AK(n,e){return A.useReducer((t,r)=>e[t][r]??t,n)}var Ep=n=>{const{present:e,children:t}=n,r=SK(e),i=typeof t=="function"?t({present:r.isPresent}):A.Children.only(t),s=ir(r.ref,RK(i));return typeof t=="function"||r.isPresent?A.cloneElement(i,{ref:s}):null};Ep.displayName="Presence";function SK(n){const[e,t]=A.useState(),r=A.useRef(null),i=A.useRef(n),s=A.useRef("none"),o=n?"mounted":"unmounted",[a,u]=AK(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return A.useEffect(()=>{const h=lm(r.current);s.current=a==="mounted"?h:"none"},[a]),ro(()=>{const h=r.current,d=i.current;if(d!==n){const y=s.current,v=lm(h);n?u("MOUNT"):v==="none"||h?.display==="none"?u("UNMOUNT"):u(d&&y!==v?"ANIMATION_OUT":"UNMOUNT"),i.current=n}},[n,u]),ro(()=>{if(e){let h;const d=e.ownerDocument.defaultView??window,g=v=>{const w=lm(r.current).includes(CSS.escape(v.animationName));if(v.target===e&&w&&(u("ANIMATION_END"),!i.current)){const E=e.style.animationFillMode;e.style.animationFillMode="forwards",h=d.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=E)})}},y=v=>{v.target===e&&(s.current=lm(r.current))};return e.addEventListener("animationstart",y),e.addEventListener("animationcancel",g),e.addEventListener("animationend",g),()=>{d.clearTimeout(h),e.removeEventListener("animationstart",y),e.removeEventListener("animationcancel",g),e.removeEventListener("animationend",g)}}else u("ANIMATION_END")},[e,u]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:A.useCallback(h=>{r.current=h?getComputedStyle(h):null,t(h)},[])}}function lm(n){return n?.animationName||"none"}function RK(n){let e=Object.getOwnPropertyDescriptor(n.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=Object.getOwnPropertyDescriptor(n,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}var CK=Fk[" useInsertionEffect ".trim().toString()]||ro;function Sh({prop:n,defaultProp:e,onChange:t=()=>{},caller:r}){const[i,s,o]=IK({defaultProp:e,onChange:t}),a=n!==void 0,u=a?n:i;{const d=A.useRef(n!==void 0);A.useEffect(()=>{const g=d.current;g!==a&&console.warn(`${r} is changing from ${g?"controlled":"uncontrolled"} to ${a?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),d.current=a},[a,r])}const h=A.useCallback(d=>{if(a){const g=PK(d)?d(n):d;g!==n&&o.current?.(g)}else s(d)},[a,n,s,o]);return[u,h]}function IK({defaultProp:n,onChange:e}){const[t,r]=A.useState(n),i=A.useRef(t),s=A.useRef(e);return CK(()=>{s.current=e},[e]),A.useEffect(()=>{i.current!==t&&(s.current?.(t),i.current=t)},[t,i]),[t,r,s]}function PK(n){return typeof n=="function"}var MK=function(n){if(typeof document>"u")return null;var e=Array.isArray(n)?n[0]:n;return e.ownerDocument.body},nu=new WeakMap,cm=new WeakMap,um={},H0=0,lL=function(n){return n&&(n.host||lL(n.parentNode))},OK=function(n,e){return e.map(function(t){if(n.contains(t))return t;var r=lL(t);return r&&n.contains(r)?r:(console.error("aria-hidden",t,"in not contained inside",n,". Doing nothing"),null)}).filter(function(t){return!!t})},kK=function(n,e,t,r){var i=OK(e,Array.isArray(n)?n:[n]);um[t]||(um[t]=new WeakMap);var s=um[t],o=[],a=new Set,u=new Set(i),h=function(g){!g||a.has(g)||(a.add(g),h(g.parentNode))};i.forEach(h);var d=function(g){!g||u.has(g)||Array.prototype.forEach.call(g.children,function(y){if(a.has(y))d(y);else try{var v=y.getAttribute(r),T=v!==null&&v!=="false",w=(nu.get(y)||0)+1,E=(s.get(y)||0)+1;nu.set(y,w),s.set(y,E),o.push(y),w===1&&T&&cm.set(y,!0),E===1&&y.setAttribute(t,"true"),T||y.setAttribute(r,"true")}catch(S){console.error("aria-hidden: cannot operate on ",y,S)}})};return d(e),a.clear(),H0++,function(){o.forEach(function(g){var y=nu.get(g)-1,v=s.get(g)-1;nu.set(g,y),s.set(g,v),y||(cm.has(g)||g.removeAttribute(r),cm.delete(g)),v||g.removeAttribute(t)}),H0--,H0||(nu=new WeakMap,nu=new WeakMap,cm=new WeakMap,um={})}},NK=function(n,e,t){t===void 0&&(t="data-aria-hidden");var r=Array.from(Array.isArray(n)?n:[n]),i=MK(n);return i?(r.push.apply(r,Array.from(i.querySelectorAll("[aria-live], script"))),kK(r,i,t,"aria-hidden")):function(){return null}},Qi=function(){return Qi=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},Qi.apply(this,arguments)};function cL(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t}function DK(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))}var iy="right-scroll-bar-position",sy="width-before-scroll-bar",LK="with-scroll-bars-hidden",UK="--removed-body-scroll-bar-size";function $0(n,e){return typeof n=="function"?n(e):n&&(n.current=e),n}function VK(n,e){var t=A.useState(function(){return{value:n,callback:e,facade:{get current(){return t.value},set current(r){var i=t.value;i!==r&&(t.value=r,t.callback(r,i))}}}})[0];return t.callback=e,t.facade}var FK=typeof window<"u"?A.useLayoutEffect:A.useEffect,bI=new WeakMap;function BK(n,e){var t=VK(null,function(r){return n.forEach(function(i){return $0(i,r)})});return FK(function(){var r=bI.get(t);if(r){var i=new Set(r),s=new Set(n),o=t.current;i.forEach(function(a){s.has(a)||$0(a,null)}),s.forEach(function(a){i.has(a)||$0(a,o)})}bI.set(t,n)},[n]),t}function zK(n){return n}function jK(n,e){e===void 0&&(e=zK);var t=[],r=!1,i={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return t.length?t[t.length-1]:n},useMedium:function(s){var o=e(s,r);return t.push(o),function(){t=t.filter(function(a){return a!==o})}},assignSyncMedium:function(s){for(r=!0;t.length;){var o=t;t=[],o.forEach(s)}t={push:function(a){return s(a)},filter:function(){return t}}},assignMedium:function(s){r=!0;var o=[];if(t.length){var a=t;t=[],a.forEach(s),o=t}var u=function(){var d=o;o=[],d.forEach(s)},h=function(){return Promise.resolve().then(u)};h(),t={push:function(d){o.push(d),h()},filter:function(d){return o=o.filter(d),t}}}};return i}function HK(n){n===void 0&&(n={});var e=jK(null);return e.options=Qi({async:!0,ssr:!1},n),e}var uL=function(n){var e=n.sideCar,t=cL(n,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=e.read();if(!r)throw new Error("Sidecar medium not found");return A.createElement(r,Qi({},t))};uL.isSideCarExport=!0;function $K(n,e){return n.useMedium(e),uL}var hL=HK(),W0=function(){},K_=A.forwardRef(function(n,e){var t=A.useRef(null),r=A.useState({onScrollCapture:W0,onWheelCapture:W0,onTouchMoveCapture:W0}),i=r[0],s=r[1],o=n.forwardProps,a=n.children,u=n.className,h=n.removeScrollBar,d=n.enabled,g=n.shards,y=n.sideCar,v=n.noRelative,T=n.noIsolation,w=n.inert,E=n.allowPinchZoom,S=n.as,P=S===void 0?"div":S,I=n.gapMode,L=cL(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),F=y,Y=BK([t,e]),k=Qi(Qi({},L),i);return A.createElement(A.Fragment,null,d&&A.createElement(F,{sideCar:hL,removeScrollBar:h,shards:g,noRelative:v,noIsolation:T,inert:w,setCallbacks:s,allowPinchZoom:!!E,lockRef:t,gapMode:I}),o?A.cloneElement(A.Children.only(a),Qi(Qi({},k),{ref:Y})):A.createElement(P,Qi({},k,{className:u,ref:Y}),a))});K_.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};K_.classNames={fullWidth:sy,zeroRight:iy};var WK=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function qK(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var e=WK();return e&&n.setAttribute("nonce",e),n}function XK(n,e){n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}function YK(n){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(n)}var KK=function(){var n=0,e=null;return{add:function(t){n==0&&(e=qK())&&(XK(e,t),YK(e)),n++},remove:function(){n--,!n&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},GK=function(){var n=KK();return function(e,t){A.useEffect(function(){return n.add(e),function(){n.remove()}},[e&&t])}},fL=function(){var n=GK(),e=function(t){var r=t.styles,i=t.dynamic;return n(r,i),null};return e},ZK={left:0,top:0,right:0,gap:0},q0=function(n){return parseInt(n||"",10)||0},QK=function(n){var e=window.getComputedStyle(document.body),t=e[n==="padding"?"paddingLeft":"marginLeft"],r=e[n==="padding"?"paddingTop":"marginTop"],i=e[n==="padding"?"paddingRight":"marginRight"];return[q0(t),q0(r),q0(i)]},JK=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return ZK;var e=QK(n),t=document.documentElement.clientWidth,r=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,r-t+e[2]-e[0])}},eG=fL(),Bu="data-scroll-locked",tG=function(n,e,t,r){var i=n.left,s=n.top,o=n.right,a=n.gap;return t===void 0&&(t="margin"),`
  .`.concat(LK,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(a,"px ").concat(r,`;
  }
  body[`).concat(Bu,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(r,";"),t==="margin"&&`
    padding-left: `.concat(i,`px;
    padding-top: `).concat(s,`px;
    padding-right: `).concat(o,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(r,`;
    `),t==="padding"&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(iy,` {
    right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(sy,` {
    margin-right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(iy," .").concat(iy,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(sy," .").concat(sy,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(Bu,`] {
    `).concat(UK,": ").concat(a,`px;
  }
`)},TI=function(){var n=parseInt(document.body.getAttribute(Bu)||"0",10);return isFinite(n)?n:0},nG=function(){A.useEffect(function(){return document.body.setAttribute(Bu,(TI()+1).toString()),function(){var n=TI()-1;n<=0?document.body.removeAttribute(Bu):document.body.setAttribute(Bu,n.toString())}},[])},rG=function(n){var e=n.noRelative,t=n.noImportant,r=n.gapMode,i=r===void 0?"margin":r;nG();var s=A.useMemo(function(){return JK(i)},[i]);return A.createElement(eG,{styles:tG(s,!e,i,t?"":"!important")})},kw=!1;if(typeof window<"u")try{var hm=Object.defineProperty({},"passive",{get:function(){return kw=!0,!0}});window.addEventListener("test",hm,hm),window.removeEventListener("test",hm,hm)}catch{kw=!1}var ru=kw?{passive:!1}:!1,iG=function(n){return n.tagName==="TEXTAREA"},dL=function(n,e){if(!(n instanceof Element))return!1;var t=window.getComputedStyle(n);return t[e]!=="hidden"&&!(t.overflowY===t.overflowX&&!iG(n)&&t[e]==="visible")},sG=function(n){return dL(n,"overflowY")},oG=function(n){return dL(n,"overflowX")},wI=function(n,e){var t=e.ownerDocument,r=e;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var i=pL(n,r);if(i){var s=gL(n,r),o=s[1],a=s[2];if(o>a)return!0}r=r.parentNode}while(r&&r!==t.body);return!1},aG=function(n){var e=n.scrollTop,t=n.scrollHeight,r=n.clientHeight;return[e,t,r]},lG=function(n){var e=n.scrollLeft,t=n.scrollWidth,r=n.clientWidth;return[e,t,r]},pL=function(n,e){return n==="v"?sG(e):oG(e)},gL=function(n,e){return n==="v"?aG(e):lG(e)},cG=function(n,e){return n==="h"&&e==="rtl"?-1:1},uG=function(n,e,t,r,i){var s=cG(n,window.getComputedStyle(e).direction),o=s*r,a=t.target,u=e.contains(a),h=!1,d=o>0,g=0,y=0;do{if(!a)break;var v=gL(n,a),T=v[0],w=v[1],E=v[2],S=w-E-s*T;(T||S)&&pL(n,a)&&(g+=S,y+=T);var P=a.parentNode;a=P&&P.nodeType===Node.DOCUMENT_FRAGMENT_NODE?P.host:P}while(!u&&a!==document.body||u&&(e.contains(a)||e===a));return(d&&Math.abs(g)<1||!d&&Math.abs(y)<1)&&(h=!0),h},fm=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},xI=function(n){return[n.deltaX,n.deltaY]},EI=function(n){return n&&"current"in n?n.current:n},hG=function(n,e){return n[0]===e[0]&&n[1]===e[1]},fG=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},dG=0,iu=[];function pG(n){var e=A.useRef([]),t=A.useRef([0,0]),r=A.useRef(),i=A.useState(dG++)[0],s=A.useState(fL)[0],o=A.useRef(n);A.useEffect(function(){o.current=n},[n]),A.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(i));var w=DK([n.lockRef.current],(n.shards||[]).map(EI),!0).filter(Boolean);return w.forEach(function(E){return E.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),w.forEach(function(E){return E.classList.remove("allow-interactivity-".concat(i))})}}},[n.inert,n.lockRef.current,n.shards]);var a=A.useCallback(function(w,E){if("touches"in w&&w.touches.length===2||w.type==="wheel"&&w.ctrlKey)return!o.current.allowPinchZoom;var S=fm(w),P=t.current,I="deltaX"in w?w.deltaX:P[0]-S[0],L="deltaY"in w?w.deltaY:P[1]-S[1],F,Y=w.target,k=Math.abs(I)>Math.abs(L)?"h":"v";if("touches"in w&&k==="h"&&Y.type==="range")return!1;var M=wI(k,Y);if(!M)return!0;if(M?F=k:(F=k==="v"?"h":"v",M=wI(k,Y)),!M)return!1;if(!r.current&&"changedTouches"in w&&(I||L)&&(r.current=F),!F)return!0;var N=r.current||F;return uG(N,E,w,N==="h"?I:L)},[]),u=A.useCallback(function(w){var E=w;if(!(!iu.length||iu[iu.length-1]!==s)){var S="deltaY"in E?xI(E):fm(E),P=e.current.filter(function(F){return F.name===E.type&&(F.target===E.target||E.target===F.shadowParent)&&hG(F.delta,S)})[0];if(P&&P.should){E.cancelable&&E.preventDefault();return}if(!P){var I=(o.current.shards||[]).map(EI).filter(Boolean).filter(function(F){return F.contains(E.target)}),L=I.length>0?a(E,I[0]):!o.current.noIsolation;L&&E.cancelable&&E.preventDefault()}}},[]),h=A.useCallback(function(w,E,S,P){var I={name:w,delta:E,target:S,should:P,shadowParent:gG(S)};e.current.push(I),setTimeout(function(){e.current=e.current.filter(function(L){return L!==I})},1)},[]),d=A.useCallback(function(w){t.current=fm(w),r.current=void 0},[]),g=A.useCallback(function(w){h(w.type,xI(w),w.target,a(w,n.lockRef.current))},[]),y=A.useCallback(function(w){h(w.type,fm(w),w.target,a(w,n.lockRef.current))},[]);A.useEffect(function(){return iu.push(s),n.setCallbacks({onScrollCapture:g,onWheelCapture:g,onTouchMoveCapture:y}),document.addEventListener("wheel",u,ru),document.addEventListener("touchmove",u,ru),document.addEventListener("touchstart",d,ru),function(){iu=iu.filter(function(w){return w!==s}),document.removeEventListener("wheel",u,ru),document.removeEventListener("touchmove",u,ru),document.removeEventListener("touchstart",d,ru)}},[]);var v=n.removeScrollBar,T=n.inert;return A.createElement(A.Fragment,null,T?A.createElement(s,{styles:fG(i)}):null,v?A.createElement(rG,{noRelative:n.noRelative,gapMode:n.gapMode}):null)}function gG(n){for(var e=null;n!==null;)n instanceof ShadowRoot&&(e=n.host,n=n.host),n=n.parentNode;return e}const mG=$K(hL,pG);var mL=A.forwardRef(function(n,e){return A.createElement(K_,Qi({},n,{ref:e,sideCar:mG}))});mL.classNames=K_.classNames;var G_="Popover",[yL,bve]=uc(G_,[Z4]),Ap=Z4(),[yG,za]=yL(G_),_L=n=>{const{__scopePopover:e,children:t,open:r,defaultOpen:i,onOpenChange:s,modal:o=!1}=n,a=Ap(e),u=A.useRef(null),[h,d]=A.useState(!1),[g,y]=Sh({prop:r,defaultProp:i??!1,onChange:s,caller:G_});return $.jsx(TK,{...a,children:$.jsx(yG,{scope:e,contentId:qE(),triggerRef:u,open:g,onOpenChange:y,onOpenToggle:A.useCallback(()=>y(v=>!v),[y]),hasCustomAnchor:h,onCustomAnchorAdd:A.useCallback(()=>d(!0),[]),onCustomAnchorRemove:A.useCallback(()=>d(!1),[]),modal:o,children:t})})};_L.displayName=G_;var vL="PopoverAnchor",_G=A.forwardRef((n,e)=>{const{__scopePopover:t,...r}=n,i=za(vL,t),s=Ap(t),{onCustomAnchorAdd:o,onCustomAnchorRemove:a}=i;return A.useEffect(()=>(o(),()=>a()),[o,a]),$.jsx(oL,{...s,...r,ref:e})});_G.displayName=vL;var bL="PopoverTrigger",TL=A.forwardRef((n,e)=>{const{__scopePopover:t,...r}=n,i=za(bL,t),s=Ap(t),o=ir(e,i.triggerRef),a=$.jsx(wn.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":SL(i.open),...r,ref:o,onClick:Ur(n.onClick,i.onOpenToggle)});return i.hasCustomAnchor?a:$.jsx(oL,{asChild:!0,...s,children:a})});TL.displayName=bL;var n1="PopoverPortal",[vG,bG]=yL(n1,{forceMount:void 0}),wL=n=>{const{__scopePopover:e,forceMount:t,children:r,container:i}=n,s=za(n1,e);return $.jsx(vG,{scope:e,forceMount:t,children:$.jsx(Ep,{present:t||s.open,children:$.jsx(aL,{asChild:!0,container:i,children:r})})})};wL.displayName=n1;var nh="PopoverContent",xL=A.forwardRef((n,e)=>{const t=bG(nh,n.__scopePopover),{forceMount:r=t.forceMount,...i}=n,s=za(nh,n.__scopePopover);return $.jsx(Ep,{present:r||s.open,children:s.modal?$.jsx(wG,{...i,ref:e}):$.jsx(xG,{...i,ref:e})})});xL.displayName=nh;var TG=Xy("PopoverContent.RemoveScroll"),wG=A.forwardRef((n,e)=>{const t=za(nh,n.__scopePopover),r=A.useRef(null),i=ir(e,r),s=A.useRef(!1);return A.useEffect(()=>{const o=r.current;if(o)return NK(o)},[]),$.jsx(mL,{as:TG,allowPinchZoom:!0,children:$.jsx(EL,{...n,ref:i,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Ur(n.onCloseAutoFocus,o=>{o.preventDefault(),s.current||t.triggerRef.current?.focus()}),onPointerDownOutside:Ur(n.onPointerDownOutside,o=>{const a=o.detail.originalEvent,u=a.button===0&&a.ctrlKey===!0,h=a.button===2||u;s.current=h},{checkForDefaultPrevented:!1}),onFocusOutside:Ur(n.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1})})})}),xG=A.forwardRef((n,e)=>{const t=za(nh,n.__scopePopover),r=A.useRef(!1),i=A.useRef(!1);return $.jsx(EL,{...n,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{n.onCloseAutoFocus?.(s),s.defaultPrevented||(r.current||t.triggerRef.current?.focus(),s.preventDefault()),r.current=!1,i.current=!1},onInteractOutside:s=>{n.onInteractOutside?.(s),s.defaultPrevented||(r.current=!0,s.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const o=s.target;t.triggerRef.current?.contains(o)&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&i.current&&s.preventDefault()}})}),EL=A.forwardRef((n,e)=>{const{__scopePopover:t,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:s,disableOutsidePointerEvents:o,onEscapeKeyDown:a,onPointerDownOutside:u,onFocusOutside:h,onInteractOutside:d,...g}=n,y=za(nh,t),v=Ap(t);return XX(),$.jsx(L4,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:s,children:$.jsx(N4,{asChild:!0,disableOutsidePointerEvents:o,onInteractOutside:d,onEscapeKeyDown:a,onPointerDownOutside:u,onFocusOutside:h,onDismiss:()=>y.onOpenChange(!1),children:$.jsx(wK,{"data-state":SL(y.open),role:"dialog",id:y.contentId,...v,...g,ref:e,style:{...g.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),AL="PopoverClose",EG=A.forwardRef((n,e)=>{const{__scopePopover:t,...r}=n,i=za(AL,t);return $.jsx(wn.button,{type:"button",...r,ref:e,onClick:Ur(n.onClick,()=>i.onOpenChange(!1))})});EG.displayName=AL;var AG="PopoverArrow",SG=A.forwardRef((n,e)=>{const{__scopePopover:t,...r}=n,i=Ap(t);return $.jsx(xK,{...i,...r,ref:e})});SG.displayName=AG;function SL(n){return n?"open":"closed"}var RG=_L,CG=TL,IG=wL,PG=xL;function RL(n){var e,t,r="";if(typeof n=="string"||typeof n=="number")r+=n;else if(typeof n=="object")if(Array.isArray(n)){var i=n.length;for(e=0;e<i;e++)n[e]&&(t=RL(n[e]))&&(r&&(r+=" "),r+=t)}else for(t in n)n[t]&&(r&&(r+=" "),r+=t);return r}function MG(){for(var n,e,t=0,r="",i=arguments.length;t<i;t++)(n=arguments[t])&&(e=RL(n))&&(r&&(r+=" "),r+=e);return r}const r1="-",OG=n=>{const e=NG(n),{conflictingClassGroups:t,conflictingClassGroupModifiers:r}=n;return{getClassGroupId:o=>{const a=o.split(r1);return a[0]===""&&a.length!==1&&a.shift(),CL(a,e)||kG(o)},getConflictingClassGroupIds:(o,a)=>{const u=t[o]||[];return a&&r[o]?[...u,...r[o]]:u}}},CL=(n,e)=>{if(n.length===0)return e.classGroupId;const t=n[0],r=e.nextPart.get(t),i=r?CL(n.slice(1),r):void 0;if(i)return i;if(e.validators.length===0)return;const s=n.join(r1);return e.validators.find(({validator:o})=>o(s))?.classGroupId},AI=/^\[(.+)\]$/,kG=n=>{if(AI.test(n)){const e=AI.exec(n)[1],t=e?.substring(0,e.indexOf(":"));if(t)return"arbitrary.."+t}},NG=n=>{const{theme:e,classGroups:t}=n,r={nextPart:new Map,validators:[]};for(const i in t)Nw(t[i],r,i,e);return r},Nw=(n,e,t,r)=>{n.forEach(i=>{if(typeof i=="string"){const s=i===""?e:SI(e,i);s.classGroupId=t;return}if(typeof i=="function"){if(DG(i)){Nw(i(r),e,t,r);return}e.validators.push({validator:i,classGroupId:t});return}Object.entries(i).forEach(([s,o])=>{Nw(o,SI(e,s),t,r)})})},SI=(n,e)=>{let t=n;return e.split(r1).forEach(r=>{t.nextPart.has(r)||t.nextPart.set(r,{nextPart:new Map,validators:[]}),t=t.nextPart.get(r)}),t},DG=n=>n.isThemeGetter,LG=n=>{if(n<1)return{get:()=>{},set:()=>{}};let e=0,t=new Map,r=new Map;const i=(s,o)=>{t.set(s,o),e++,e>n&&(e=0,r=t,t=new Map)};return{get(s){let o=t.get(s);if(o!==void 0)return o;if((o=r.get(s))!==void 0)return i(s,o),o},set(s,o){t.has(s)?t.set(s,o):i(s,o)}}},Dw="!",Lw=":",UG=Lw.length,VG=n=>{const{prefix:e,experimentalParseClassName:t}=n;let r=i=>{const s=[];let o=0,a=0,u=0,h;for(let T=0;T<i.length;T++){let w=i[T];if(o===0&&a===0){if(w===Lw){s.push(i.slice(u,T)),u=T+UG;continue}if(w==="/"){h=T;continue}}w==="["?o++:w==="]"?o--:w==="("?a++:w===")"&&a--}const d=s.length===0?i:i.substring(u),g=FG(d),y=g!==d,v=h&&h>u?h-u:void 0;return{modifiers:s,hasImportantModifier:y,baseClassName:g,maybePostfixModifierPosition:v}};if(e){const i=e+Lw,s=r;r=o=>o.startsWith(i)?s(o.substring(i.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:o,maybePostfixModifierPosition:void 0}}if(t){const i=r;r=s=>t({className:s,parseClassName:i})}return r},FG=n=>n.endsWith(Dw)?n.substring(0,n.length-1):n.startsWith(Dw)?n.substring(1):n,BG=n=>{const e=Object.fromEntries(n.orderSensitiveModifiers.map(r=>[r,!0]));return r=>{if(r.length<=1)return r;const i=[];let s=[];return r.forEach(o=>{o[0]==="["||e[o]?(i.push(...s.sort(),o),s=[]):s.push(o)}),i.push(...s.sort()),i}},zG=n=>({cache:LG(n.cacheSize),parseClassName:VG(n),sortModifiers:BG(n),...OG(n)}),jG=/\s+/,HG=(n,e)=>{const{parseClassName:t,getClassGroupId:r,getConflictingClassGroupIds:i,sortModifiers:s}=e,o=[],a=n.trim().split(jG);let u="";for(let h=a.length-1;h>=0;h-=1){const d=a[h],{isExternal:g,modifiers:y,hasImportantModifier:v,baseClassName:T,maybePostfixModifierPosition:w}=t(d);if(g){u=d+(u.length>0?" "+u:u);continue}let E=!!w,S=r(E?T.substring(0,w):T);if(!S){if(!E){u=d+(u.length>0?" "+u:u);continue}if(S=r(T),!S){u=d+(u.length>0?" "+u:u);continue}E=!1}const P=s(y).join(":"),I=v?P+Dw:P,L=I+S;if(o.includes(L))continue;o.push(L);const F=i(S,E);for(let Y=0;Y<F.length;++Y){const k=F[Y];o.push(I+k)}u=d+(u.length>0?" "+u:u)}return u};function $G(){let n=0,e,t,r="";for(;n<arguments.length;)(e=arguments[n++])&&(t=IL(e))&&(r&&(r+=" "),r+=t);return r}const IL=n=>{if(typeof n=="string")return n;let e,t="";for(let r=0;r<n.length;r++)n[r]&&(e=IL(n[r]))&&(t&&(t+=" "),t+=e);return t};function WG(n,...e){let t,r,i,s=o;function o(u){const h=e.reduce((d,g)=>g(d),n());return t=zG(h),r=t.cache.get,i=t.cache.set,s=a,a(u)}function a(u){const h=r(u);if(h)return h;const d=HG(u,t);return i(u,d),d}return function(){return s($G.apply(null,arguments))}}const yn=n=>{const e=t=>t[n]||[];return e.isThemeGetter=!0,e},PL=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,ML=/^\((?:(\w[\w-]*):)?(.+)\)$/i,qG=/^\d+\/\d+$/,XG=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,YG=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,KG=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,GG=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,ZG=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,su=n=>qG.test(n),Qe=n=>!!n&&!Number.isNaN(Number(n)),Jo=n=>!!n&&Number.isInteger(Number(n)),X0=n=>n.endsWith("%")&&Qe(n.slice(0,-1)),Bs=n=>XG.test(n),QG=()=>!0,JG=n=>YG.test(n)&&!KG.test(n),OL=()=>!1,eZ=n=>GG.test(n),tZ=n=>ZG.test(n),nZ=n=>!ke(n)&&!Ne(n),rZ=n=>Rh(n,DL,OL),ke=n=>PL.test(n),Al=n=>Rh(n,LL,JG),Y0=n=>Rh(n,lZ,Qe),RI=n=>Rh(n,kL,OL),iZ=n=>Rh(n,NL,tZ),dm=n=>Rh(n,UL,eZ),Ne=n=>ML.test(n),Wf=n=>Ch(n,LL),sZ=n=>Ch(n,cZ),CI=n=>Ch(n,kL),oZ=n=>Ch(n,DL),aZ=n=>Ch(n,NL),pm=n=>Ch(n,UL,!0),Rh=(n,e,t)=>{const r=PL.exec(n);return r?r[1]?e(r[1]):t(r[2]):!1},Ch=(n,e,t=!1)=>{const r=ML.exec(n);return r?r[1]?e(r[1]):t:!1},kL=n=>n==="position"||n==="percentage",NL=n=>n==="image"||n==="url",DL=n=>n==="length"||n==="size"||n==="bg-size",LL=n=>n==="length",lZ=n=>n==="number",cZ=n=>n==="family-name",UL=n=>n==="shadow",uZ=()=>{const n=yn("color"),e=yn("font"),t=yn("text"),r=yn("font-weight"),i=yn("tracking"),s=yn("leading"),o=yn("breakpoint"),a=yn("container"),u=yn("spacing"),h=yn("radius"),d=yn("shadow"),g=yn("inset-shadow"),y=yn("text-shadow"),v=yn("drop-shadow"),T=yn("blur"),w=yn("perspective"),E=yn("aspect"),S=yn("ease"),P=yn("animate"),I=()=>["auto","avoid","all","avoid-page","page","left","right","column"],L=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],F=()=>[...L(),Ne,ke],Y=()=>["auto","hidden","clip","visible","scroll"],k=()=>["auto","contain","none"],M=()=>[Ne,ke,u],N=()=>[su,"full","auto",...M()],H=()=>[Jo,"none","subgrid",Ne,ke],q=()=>["auto",{span:["full",Jo,Ne,ke]},Jo,Ne,ke],K=()=>[Jo,"auto",Ne,ke],j=()=>["auto","min","max","fr",Ne,ke],de=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],Ee=()=>["start","end","center","stretch","center-safe","end-safe"],O=()=>["auto",...M()],W=()=>[su,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...M()],U=()=>[n,Ne,ke],ie=()=>[...L(),CI,RI,{position:[Ne,ke]}],V=()=>["no-repeat",{repeat:["","x","y","space","round"]}],Z=()=>["auto","cover","contain",oZ,rZ,{size:[Ne,ke]}],se=()=>[X0,Wf,Al],ae=()=>["","none","full",h,Ne,ke],me=()=>["",Qe,Wf,Al],xe=()=>["solid","dashed","dotted","double"],Se=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Ce=()=>[Qe,X0,CI,RI],Me=()=>["","none",T,Ne,ke],lt=()=>["none",Qe,Ne,ke],Ge=()=>["none",Qe,Ne,ke],xn=()=>[Qe,Ne,ke],fn=()=>[su,"full",...M()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[Bs],breakpoint:[Bs],color:[QG],container:[Bs],"drop-shadow":[Bs],ease:["in","out","in-out"],font:[nZ],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[Bs],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[Bs],shadow:[Bs],spacing:["px",Qe],text:[Bs],"text-shadow":[Bs],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",su,ke,Ne,E]}],container:["container"],columns:[{columns:[Qe,ke,Ne,a]}],"break-after":[{"break-after":I()}],"break-before":[{"break-before":I()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:F()}],overflow:[{overflow:Y()}],"overflow-x":[{"overflow-x":Y()}],"overflow-y":[{"overflow-y":Y()}],overscroll:[{overscroll:k()}],"overscroll-x":[{"overscroll-x":k()}],"overscroll-y":[{"overscroll-y":k()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:N()}],"inset-x":[{"inset-x":N()}],"inset-y":[{"inset-y":N()}],start:[{start:N()}],end:[{end:N()}],top:[{top:N()}],right:[{right:N()}],bottom:[{bottom:N()}],left:[{left:N()}],visibility:["visible","invisible","collapse"],z:[{z:[Jo,"auto",Ne,ke]}],basis:[{basis:[su,"full","auto",a,...M()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[Qe,su,"auto","initial","none",ke]}],grow:[{grow:["",Qe,Ne,ke]}],shrink:[{shrink:["",Qe,Ne,ke]}],order:[{order:[Jo,"first","last","none",Ne,ke]}],"grid-cols":[{"grid-cols":H()}],"col-start-end":[{col:q()}],"col-start":[{"col-start":K()}],"col-end":[{"col-end":K()}],"grid-rows":[{"grid-rows":H()}],"row-start-end":[{row:q()}],"row-start":[{"row-start":K()}],"row-end":[{"row-end":K()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":j()}],"auto-rows":[{"auto-rows":j()}],gap:[{gap:M()}],"gap-x":[{"gap-x":M()}],"gap-y":[{"gap-y":M()}],"justify-content":[{justify:[...de(),"normal"]}],"justify-items":[{"justify-items":[...Ee(),"normal"]}],"justify-self":[{"justify-self":["auto",...Ee()]}],"align-content":[{content:["normal",...de()]}],"align-items":[{items:[...Ee(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...Ee(),{baseline:["","last"]}]}],"place-content":[{"place-content":de()}],"place-items":[{"place-items":[...Ee(),"baseline"]}],"place-self":[{"place-self":["auto",...Ee()]}],p:[{p:M()}],px:[{px:M()}],py:[{py:M()}],ps:[{ps:M()}],pe:[{pe:M()}],pt:[{pt:M()}],pr:[{pr:M()}],pb:[{pb:M()}],pl:[{pl:M()}],m:[{m:O()}],mx:[{mx:O()}],my:[{my:O()}],ms:[{ms:O()}],me:[{me:O()}],mt:[{mt:O()}],mr:[{mr:O()}],mb:[{mb:O()}],ml:[{ml:O()}],"space-x":[{"space-x":M()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":M()}],"space-y-reverse":["space-y-reverse"],size:[{size:W()}],w:[{w:[a,"screen",...W()]}],"min-w":[{"min-w":[a,"screen","none",...W()]}],"max-w":[{"max-w":[a,"screen","none","prose",{screen:[o]},...W()]}],h:[{h:["screen","lh",...W()]}],"min-h":[{"min-h":["screen","lh","none",...W()]}],"max-h":[{"max-h":["screen","lh",...W()]}],"font-size":[{text:["base",t,Wf,Al]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[r,Ne,Y0]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",X0,ke]}],"font-family":[{font:[sZ,ke,e]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[i,Ne,ke]}],"line-clamp":[{"line-clamp":[Qe,"none",Ne,Y0]}],leading:[{leading:[s,...M()]}],"list-image":[{"list-image":["none",Ne,ke]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",Ne,ke]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:U()}],"text-color":[{text:U()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...xe(),"wavy"]}],"text-decoration-thickness":[{decoration:[Qe,"from-font","auto",Ne,Al]}],"text-decoration-color":[{decoration:U()}],"underline-offset":[{"underline-offset":[Qe,"auto",Ne,ke]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:M()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Ne,ke]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Ne,ke]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:ie()}],"bg-repeat":[{bg:V()}],"bg-size":[{bg:Z()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},Jo,Ne,ke],radial:["",Ne,ke],conic:[Jo,Ne,ke]},aZ,iZ]}],"bg-color":[{bg:U()}],"gradient-from-pos":[{from:se()}],"gradient-via-pos":[{via:se()}],"gradient-to-pos":[{to:se()}],"gradient-from":[{from:U()}],"gradient-via":[{via:U()}],"gradient-to":[{to:U()}],rounded:[{rounded:ae()}],"rounded-s":[{"rounded-s":ae()}],"rounded-e":[{"rounded-e":ae()}],"rounded-t":[{"rounded-t":ae()}],"rounded-r":[{"rounded-r":ae()}],"rounded-b":[{"rounded-b":ae()}],"rounded-l":[{"rounded-l":ae()}],"rounded-ss":[{"rounded-ss":ae()}],"rounded-se":[{"rounded-se":ae()}],"rounded-ee":[{"rounded-ee":ae()}],"rounded-es":[{"rounded-es":ae()}],"rounded-tl":[{"rounded-tl":ae()}],"rounded-tr":[{"rounded-tr":ae()}],"rounded-br":[{"rounded-br":ae()}],"rounded-bl":[{"rounded-bl":ae()}],"border-w":[{border:me()}],"border-w-x":[{"border-x":me()}],"border-w-y":[{"border-y":me()}],"border-w-s":[{"border-s":me()}],"border-w-e":[{"border-e":me()}],"border-w-t":[{"border-t":me()}],"border-w-r":[{"border-r":me()}],"border-w-b":[{"border-b":me()}],"border-w-l":[{"border-l":me()}],"divide-x":[{"divide-x":me()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":me()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...xe(),"hidden","none"]}],"divide-style":[{divide:[...xe(),"hidden","none"]}],"border-color":[{border:U()}],"border-color-x":[{"border-x":U()}],"border-color-y":[{"border-y":U()}],"border-color-s":[{"border-s":U()}],"border-color-e":[{"border-e":U()}],"border-color-t":[{"border-t":U()}],"border-color-r":[{"border-r":U()}],"border-color-b":[{"border-b":U()}],"border-color-l":[{"border-l":U()}],"divide-color":[{divide:U()}],"outline-style":[{outline:[...xe(),"none","hidden"]}],"outline-offset":[{"outline-offset":[Qe,Ne,ke]}],"outline-w":[{outline:["",Qe,Wf,Al]}],"outline-color":[{outline:U()}],shadow:[{shadow:["","none",d,pm,dm]}],"shadow-color":[{shadow:U()}],"inset-shadow":[{"inset-shadow":["none",g,pm,dm]}],"inset-shadow-color":[{"inset-shadow":U()}],"ring-w":[{ring:me()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:U()}],"ring-offset-w":[{"ring-offset":[Qe,Al]}],"ring-offset-color":[{"ring-offset":U()}],"inset-ring-w":[{"inset-ring":me()}],"inset-ring-color":[{"inset-ring":U()}],"text-shadow":[{"text-shadow":["none",y,pm,dm]}],"text-shadow-color":[{"text-shadow":U()}],opacity:[{opacity:[Qe,Ne,ke]}],"mix-blend":[{"mix-blend":[...Se(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":Se()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[Qe]}],"mask-image-linear-from-pos":[{"mask-linear-from":Ce()}],"mask-image-linear-to-pos":[{"mask-linear-to":Ce()}],"mask-image-linear-from-color":[{"mask-linear-from":U()}],"mask-image-linear-to-color":[{"mask-linear-to":U()}],"mask-image-t-from-pos":[{"mask-t-from":Ce()}],"mask-image-t-to-pos":[{"mask-t-to":Ce()}],"mask-image-t-from-color":[{"mask-t-from":U()}],"mask-image-t-to-color":[{"mask-t-to":U()}],"mask-image-r-from-pos":[{"mask-r-from":Ce()}],"mask-image-r-to-pos":[{"mask-r-to":Ce()}],"mask-image-r-from-color":[{"mask-r-from":U()}],"mask-image-r-to-color":[{"mask-r-to":U()}],"mask-image-b-from-pos":[{"mask-b-from":Ce()}],"mask-image-b-to-pos":[{"mask-b-to":Ce()}],"mask-image-b-from-color":[{"mask-b-from":U()}],"mask-image-b-to-color":[{"mask-b-to":U()}],"mask-image-l-from-pos":[{"mask-l-from":Ce()}],"mask-image-l-to-pos":[{"mask-l-to":Ce()}],"mask-image-l-from-color":[{"mask-l-from":U()}],"mask-image-l-to-color":[{"mask-l-to":U()}],"mask-image-x-from-pos":[{"mask-x-from":Ce()}],"mask-image-x-to-pos":[{"mask-x-to":Ce()}],"mask-image-x-from-color":[{"mask-x-from":U()}],"mask-image-x-to-color":[{"mask-x-to":U()}],"mask-image-y-from-pos":[{"mask-y-from":Ce()}],"mask-image-y-to-pos":[{"mask-y-to":Ce()}],"mask-image-y-from-color":[{"mask-y-from":U()}],"mask-image-y-to-color":[{"mask-y-to":U()}],"mask-image-radial":[{"mask-radial":[Ne,ke]}],"mask-image-radial-from-pos":[{"mask-radial-from":Ce()}],"mask-image-radial-to-pos":[{"mask-radial-to":Ce()}],"mask-image-radial-from-color":[{"mask-radial-from":U()}],"mask-image-radial-to-color":[{"mask-radial-to":U()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":L()}],"mask-image-conic-pos":[{"mask-conic":[Qe]}],"mask-image-conic-from-pos":[{"mask-conic-from":Ce()}],"mask-image-conic-to-pos":[{"mask-conic-to":Ce()}],"mask-image-conic-from-color":[{"mask-conic-from":U()}],"mask-image-conic-to-color":[{"mask-conic-to":U()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:ie()}],"mask-repeat":[{mask:V()}],"mask-size":[{mask:Z()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",Ne,ke]}],filter:[{filter:["","none",Ne,ke]}],blur:[{blur:Me()}],brightness:[{brightness:[Qe,Ne,ke]}],contrast:[{contrast:[Qe,Ne,ke]}],"drop-shadow":[{"drop-shadow":["","none",v,pm,dm]}],"drop-shadow-color":[{"drop-shadow":U()}],grayscale:[{grayscale:["",Qe,Ne,ke]}],"hue-rotate":[{"hue-rotate":[Qe,Ne,ke]}],invert:[{invert:["",Qe,Ne,ke]}],saturate:[{saturate:[Qe,Ne,ke]}],sepia:[{sepia:["",Qe,Ne,ke]}],"backdrop-filter":[{"backdrop-filter":["","none",Ne,ke]}],"backdrop-blur":[{"backdrop-blur":Me()}],"backdrop-brightness":[{"backdrop-brightness":[Qe,Ne,ke]}],"backdrop-contrast":[{"backdrop-contrast":[Qe,Ne,ke]}],"backdrop-grayscale":[{"backdrop-grayscale":["",Qe,Ne,ke]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[Qe,Ne,ke]}],"backdrop-invert":[{"backdrop-invert":["",Qe,Ne,ke]}],"backdrop-opacity":[{"backdrop-opacity":[Qe,Ne,ke]}],"backdrop-saturate":[{"backdrop-saturate":[Qe,Ne,ke]}],"backdrop-sepia":[{"backdrop-sepia":["",Qe,Ne,ke]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":M()}],"border-spacing-x":[{"border-spacing-x":M()}],"border-spacing-y":[{"border-spacing-y":M()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",Ne,ke]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[Qe,"initial",Ne,ke]}],ease:[{ease:["linear","initial",S,Ne,ke]}],delay:[{delay:[Qe,Ne,ke]}],animate:[{animate:["none",P,Ne,ke]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[w,Ne,ke]}],"perspective-origin":[{"perspective-origin":F()}],rotate:[{rotate:lt()}],"rotate-x":[{"rotate-x":lt()}],"rotate-y":[{"rotate-y":lt()}],"rotate-z":[{"rotate-z":lt()}],scale:[{scale:Ge()}],"scale-x":[{"scale-x":Ge()}],"scale-y":[{"scale-y":Ge()}],"scale-z":[{"scale-z":Ge()}],"scale-3d":["scale-3d"],skew:[{skew:xn()}],"skew-x":[{"skew-x":xn()}],"skew-y":[{"skew-y":xn()}],transform:[{transform:[Ne,ke,"","none","gpu","cpu"]}],"transform-origin":[{origin:F()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:fn()}],"translate-x":[{"translate-x":fn()}],"translate-y":[{"translate-y":fn()}],"translate-z":[{"translate-z":fn()}],"translate-none":["translate-none"],accent:[{accent:U()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:U()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Ne,ke]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":M()}],"scroll-mx":[{"scroll-mx":M()}],"scroll-my":[{"scroll-my":M()}],"scroll-ms":[{"scroll-ms":M()}],"scroll-me":[{"scroll-me":M()}],"scroll-mt":[{"scroll-mt":M()}],"scroll-mr":[{"scroll-mr":M()}],"scroll-mb":[{"scroll-mb":M()}],"scroll-ml":[{"scroll-ml":M()}],"scroll-p":[{"scroll-p":M()}],"scroll-px":[{"scroll-px":M()}],"scroll-py":[{"scroll-py":M()}],"scroll-ps":[{"scroll-ps":M()}],"scroll-pe":[{"scroll-pe":M()}],"scroll-pt":[{"scroll-pt":M()}],"scroll-pr":[{"scroll-pr":M()}],"scroll-pb":[{"scroll-pb":M()}],"scroll-pl":[{"scroll-pl":M()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Ne,ke]}],fill:[{fill:["none",...U()]}],"stroke-w":[{stroke:[Qe,Wf,Al,Y0]}],stroke:[{stroke:["none",...U()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},hZ=WG(uZ);function Ql(...n){return hZ(MG(n))}function fZ({...n}){return $.jsx(RG,{"data-slot":"popover",...n})}function dZ({...n}){return $.jsx(CG,{"data-slot":"popover-trigger",...n})}function pZ({className:n,align:e="center",sideOffset:t=4,...r}){return $.jsx(IG,{children:$.jsx(PG,{"data-slot":"popover-content",align:e,sideOffset:t,className:Ql("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",n),...r})})}function VL(n){const e=A.useRef({value:n,previous:n});return A.useMemo(()=>(e.current.value!==n&&(e.current.previous=e.current.value,e.current.value=n),e.current.previous),[n])}var Z_="Checkbox",[gZ,Tve]=uc(Z_),[mZ,i1]=gZ(Z_);function yZ(n){const{__scopeCheckbox:e,checked:t,children:r,defaultChecked:i,disabled:s,form:o,name:a,onCheckedChange:u,required:h,value:d="on",internal_do_not_use_render:g}=n,[y,v]=Sh({prop:t,defaultProp:i??!1,onChange:u,caller:Z_}),[T,w]=A.useState(null),[E,S]=A.useState(null),P=A.useRef(!1),I=T?!!o||!!T.closest("form"):!0,L={checked:y,disabled:s,setChecked:v,control:T,setControl:w,name:a,form:o,value:d,hasConsumerStoppedPropagationRef:P,required:h,defaultChecked:xa(i)?!1:i,isFormControl:I,bubbleInput:E,setBubbleInput:S};return $.jsx(mZ,{scope:e,...L,children:_Z(g)?g(L):r})}var FL="CheckboxTrigger",BL=A.forwardRef(({__scopeCheckbox:n,onKeyDown:e,onClick:t,...r},i)=>{const{control:s,value:o,disabled:a,checked:u,required:h,setControl:d,setChecked:g,hasConsumerStoppedPropagationRef:y,isFormControl:v,bubbleInput:T}=i1(FL,n),w=ir(i,d),E=A.useRef(u);return A.useEffect(()=>{const S=s?.form;if(S){const P=()=>g(E.current);return S.addEventListener("reset",P),()=>S.removeEventListener("reset",P)}},[s,g]),$.jsx(wn.button,{type:"button",role:"checkbox","aria-checked":xa(u)?"mixed":u,"aria-required":h,"data-state":qL(u),"data-disabled":a?"":void 0,disabled:a,value:o,...r,ref:w,onKeyDown:Ur(e,S=>{S.key==="Enter"&&S.preventDefault()}),onClick:Ur(t,S=>{g(P=>xa(P)?!0:!P),T&&v&&(y.current=S.isPropagationStopped(),y.current||S.stopPropagation())})})});BL.displayName=FL;var zL=A.forwardRef((n,e)=>{const{__scopeCheckbox:t,name:r,checked:i,defaultChecked:s,required:o,disabled:a,value:u,onCheckedChange:h,form:d,...g}=n;return $.jsx(yZ,{__scopeCheckbox:t,checked:i,defaultChecked:s,disabled:a,required:o,onCheckedChange:h,name:r,form:d,value:u,internal_do_not_use_render:({isFormControl:y})=>$.jsxs($.Fragment,{children:[$.jsx(BL,{...g,ref:e,__scopeCheckbox:t}),y&&$.jsx(WL,{__scopeCheckbox:t})]})})});zL.displayName=Z_;var jL="CheckboxIndicator",HL=A.forwardRef((n,e)=>{const{__scopeCheckbox:t,forceMount:r,...i}=n,s=i1(jL,t);return $.jsx(Ep,{present:r||xa(s.checked)||s.checked===!0,children:$.jsx(wn.span,{"data-state":qL(s.checked),"data-disabled":s.disabled?"":void 0,...i,ref:e,style:{pointerEvents:"none",...n.style}})})});HL.displayName=jL;var $L="CheckboxBubbleInput",WL=A.forwardRef(({__scopeCheckbox:n,...e},t)=>{const{control:r,hasConsumerStoppedPropagationRef:i,checked:s,defaultChecked:o,required:a,disabled:u,name:h,value:d,form:g,bubbleInput:y,setBubbleInput:v}=i1($L,n),T=ir(t,v),w=VL(s),E=JE(r);A.useEffect(()=>{const P=y;if(!P)return;const I=window.HTMLInputElement.prototype,F=Object.getOwnPropertyDescriptor(I,"checked").set,Y=!i.current;if(w!==s&&F){const k=new Event("click",{bubbles:Y});P.indeterminate=xa(s),F.call(P,xa(s)?!1:s),P.dispatchEvent(k)}},[y,w,s,i]);const S=A.useRef(xa(s)?!1:s);return $.jsx(wn.input,{type:"checkbox","aria-hidden":!0,defaultChecked:o??S.current,required:a,disabled:u,name:h,value:d,form:g,...e,tabIndex:-1,ref:T,style:{...e.style,...E,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});WL.displayName=$L;function _Z(n){return typeof n=="function"}function xa(n){return n==="indeterminate"}function qL(n){return xa(n)?"indeterminate":n?"checked":"unchecked"}/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vZ=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),bZ=n=>n.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()),II=n=>{const e=bZ(n);return e.charAt(0).toUpperCase()+e.slice(1)},XL=(...n)=>n.filter((e,t,r)=>!!e&&e.trim()!==""&&r.indexOf(e)===t).join(" ").trim(),TZ=n=>{for(const e in n)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var wZ={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xZ=A.forwardRef(({color:n="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:r,className:i="",children:s,iconNode:o,...a},u)=>A.createElement("svg",{ref:u,...wZ,width:e,height:e,stroke:n,strokeWidth:r?Number(t)*24/Number(e):t,className:XL("lucide",i),...!s&&!TZ(a)&&{"aria-hidden":"true"},...a},[...o.map(([h,d])=>A.createElement(h,d)),...Array.isArray(s)?s:[s]]));/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YL=(n,e)=>{const t=A.forwardRef(({className:r,...i},s)=>A.createElement(xZ,{ref:s,iconNode:e,className:XL(`lucide-${vZ(II(n))}`,`lucide-${n}`,r),...i}));return t.displayName=II(n),t};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EZ=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],AZ=YL("check",EZ);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SZ=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],RZ=YL("chevron-down",SZ);function Un({className:n,...e}){return $.jsx(zL,{"data-slot":"checkbox",className:Ql("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",n),...e,children:$.jsx(HL,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:$.jsx(AZ,{className:"size-3.5"})})})}function CZ(n){const e=n+"CollectionProvider",[t,r]=uc(e),[i,s]=t(e,{collectionRef:{current:null},itemMap:new Map}),o=w=>{const{scope:E,children:S}=w,P=bt.useRef(null),I=bt.useRef(new Map).current;return $.jsx(i,{scope:E,itemMap:I,collectionRef:P,children:S})};o.displayName=e;const a=n+"CollectionSlot",u=Xy(a),h=bt.forwardRef((w,E)=>{const{scope:S,children:P}=w,I=s(a,S),L=ir(E,I.collectionRef);return $.jsx(u,{ref:L,children:P})});h.displayName=a;const d=n+"CollectionItemSlot",g="data-radix-collection-item",y=Xy(d),v=bt.forwardRef((w,E)=>{const{scope:S,children:P,...I}=w,L=bt.useRef(null),F=ir(E,L),Y=s(d,S);return bt.useEffect(()=>(Y.itemMap.set(L,{ref:L,...I}),()=>void Y.itemMap.delete(L))),$.jsx(y,{[g]:"",ref:F,children:P})});v.displayName=d;function T(w){const E=s(n+"CollectionConsumer",w);return bt.useCallback(()=>{const P=E.collectionRef.current;if(!P)return[];const I=Array.from(P.querySelectorAll(`[${g}]`));return Array.from(E.itemMap.values()).sort((Y,k)=>I.indexOf(Y.ref.current)-I.indexOf(k.ref.current))},[E.collectionRef,E.itemMap])}return[{Provider:o,Slot:h,ItemSlot:v},T,r]}var Q_="Collapsible",[IZ,KL]=uc(Q_),[PZ,s1]=IZ(Q_),GL=A.forwardRef((n,e)=>{const{__scopeCollapsible:t,open:r,defaultOpen:i,disabled:s,onOpenChange:o,...a}=n,[u,h]=Sh({prop:r,defaultProp:i??!1,onChange:o,caller:Q_});return $.jsx(PZ,{scope:t,disabled:s,contentId:qE(),open:u,onOpenToggle:A.useCallback(()=>h(d=>!d),[h]),children:$.jsx(wn.div,{"data-state":a1(u),"data-disabled":s?"":void 0,...a,ref:e})})});GL.displayName=Q_;var ZL="CollapsibleTrigger",QL=A.forwardRef((n,e)=>{const{__scopeCollapsible:t,...r}=n,i=s1(ZL,t);return $.jsx(wn.button,{type:"button","aria-controls":i.contentId,"aria-expanded":i.open||!1,"data-state":a1(i.open),"data-disabled":i.disabled?"":void 0,disabled:i.disabled,...r,ref:e,onClick:Ur(n.onClick,i.onOpenToggle)})});QL.displayName=ZL;var o1="CollapsibleContent",JL=A.forwardRef((n,e)=>{const{forceMount:t,...r}=n,i=s1(o1,n.__scopeCollapsible);return $.jsx(Ep,{present:t||i.open,children:({present:s})=>$.jsx(MZ,{...r,ref:e,present:s})})});JL.displayName=o1;var MZ=A.forwardRef((n,e)=>{const{__scopeCollapsible:t,present:r,children:i,...s}=n,o=s1(o1,t),[a,u]=A.useState(r),h=A.useRef(null),d=ir(e,h),g=A.useRef(0),y=g.current,v=A.useRef(0),T=v.current,w=o.open||a,E=A.useRef(w),S=A.useRef(void 0);return A.useEffect(()=>{const P=requestAnimationFrame(()=>E.current=!1);return()=>cancelAnimationFrame(P)},[]),ro(()=>{const P=h.current;if(P){S.current=S.current||{transitionDuration:P.style.transitionDuration,animationName:P.style.animationName},P.style.transitionDuration="0s",P.style.animationName="none";const I=P.getBoundingClientRect();g.current=I.height,v.current=I.width,E.current||(P.style.transitionDuration=S.current.transitionDuration,P.style.animationName=S.current.animationName),u(r)}},[o.open,r]),$.jsx(wn.div,{"data-state":a1(o.open),"data-disabled":o.disabled?"":void 0,id:o.contentId,hidden:!w,...s,ref:d,style:{"--radix-collapsible-content-height":y?`${y}px`:void 0,"--radix-collapsible-content-width":T?`${T}px`:void 0,...n.style},children:w&&i})});function a1(n){return n?"open":"closed"}var OZ=GL,kZ=QL,NZ=JL,DZ=A.createContext(void 0);function LZ(n){const e=A.useContext(DZ);return n||e||"ltr"}var Mi="Accordion",UZ=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[l1,VZ,FZ]=CZ(Mi),[J_,wve]=uc(Mi,[FZ,KL]),c1=KL(),e6=bt.forwardRef((n,e)=>{const{type:t,...r}=n,i=r,s=r;return $.jsx(l1.Provider,{scope:n.__scopeAccordion,children:t==="multiple"?$.jsx(HZ,{...s,ref:e}):$.jsx(jZ,{...i,ref:e})})});e6.displayName=Mi;var[t6,BZ]=J_(Mi),[n6,zZ]=J_(Mi,{collapsible:!1}),jZ=bt.forwardRef((n,e)=>{const{value:t,defaultValue:r,onValueChange:i=()=>{},collapsible:s=!1,...o}=n,[a,u]=Sh({prop:t,defaultProp:r??"",onChange:i,caller:Mi});return $.jsx(t6,{scope:n.__scopeAccordion,value:bt.useMemo(()=>a?[a]:[],[a]),onItemOpen:u,onItemClose:bt.useCallback(()=>s&&u(""),[s,u]),children:$.jsx(n6,{scope:n.__scopeAccordion,collapsible:s,children:$.jsx(r6,{...o,ref:e})})})}),HZ=bt.forwardRef((n,e)=>{const{value:t,defaultValue:r,onValueChange:i=()=>{},...s}=n,[o,a]=Sh({prop:t,defaultProp:r??[],onChange:i,caller:Mi}),u=bt.useCallback(d=>a((g=[])=>[...g,d]),[a]),h=bt.useCallback(d=>a((g=[])=>g.filter(y=>y!==d)),[a]);return $.jsx(t6,{scope:n.__scopeAccordion,value:o,onItemOpen:u,onItemClose:h,children:$.jsx(n6,{scope:n.__scopeAccordion,collapsible:!0,children:$.jsx(r6,{...s,ref:e})})})}),[$Z,ev]=J_(Mi),r6=bt.forwardRef((n,e)=>{const{__scopeAccordion:t,disabled:r,dir:i,orientation:s="vertical",...o}=n,a=bt.useRef(null),u=ir(a,e),h=VZ(t),g=LZ(i)==="ltr",y=Ur(n.onKeyDown,v=>{if(!UZ.includes(v.key))return;const T=v.target,w=h().filter(M=>!M.ref.current?.disabled),E=w.findIndex(M=>M.ref.current===T),S=w.length;if(E===-1)return;v.preventDefault();let P=E;const I=0,L=S-1,F=()=>{P=E+1,P>L&&(P=I)},Y=()=>{P=E-1,P<I&&(P=L)};switch(v.key){case"Home":P=I;break;case"End":P=L;break;case"ArrowRight":s==="horizontal"&&(g?F():Y());break;case"ArrowDown":s==="vertical"&&F();break;case"ArrowLeft":s==="horizontal"&&(g?Y():F());break;case"ArrowUp":s==="vertical"&&Y();break}const k=P%S;w[k].ref.current?.focus()});return $.jsx($Z,{scope:t,disabled:r,direction:i,orientation:s,children:$.jsx(l1.Slot,{scope:t,children:$.jsx(wn.div,{...o,"data-orientation":s,ref:u,onKeyDown:r?void 0:y})})})}),Qy="AccordionItem",[WZ,u1]=J_(Qy),i6=bt.forwardRef((n,e)=>{const{__scopeAccordion:t,value:r,...i}=n,s=ev(Qy,t),o=BZ(Qy,t),a=c1(t),u=qE(),h=r&&o.value.includes(r)||!1,d=s.disabled||n.disabled;return $.jsx(WZ,{scope:t,open:h,disabled:d,triggerId:u,children:$.jsx(OZ,{"data-orientation":s.orientation,"data-state":u6(h),...a,...i,ref:e,disabled:d,open:h,onOpenChange:g=>{g?o.onItemOpen(r):o.onItemClose(r)}})})});i6.displayName=Qy;var s6="AccordionHeader",o6=bt.forwardRef((n,e)=>{const{__scopeAccordion:t,...r}=n,i=ev(Mi,t),s=u1(s6,t);return $.jsx(wn.h3,{"data-orientation":i.orientation,"data-state":u6(s.open),"data-disabled":s.disabled?"":void 0,...r,ref:e})});o6.displayName=s6;var Uw="AccordionTrigger",a6=bt.forwardRef((n,e)=>{const{__scopeAccordion:t,...r}=n,i=ev(Mi,t),s=u1(Uw,t),o=zZ(Uw,t),a=c1(t);return $.jsx(l1.ItemSlot,{scope:t,children:$.jsx(kZ,{"aria-disabled":s.open&&!o.collapsible||void 0,"data-orientation":i.orientation,id:s.triggerId,...a,...r,ref:e})})});a6.displayName=Uw;var l6="AccordionContent",c6=bt.forwardRef((n,e)=>{const{__scopeAccordion:t,...r}=n,i=ev(Mi,t),s=u1(l6,t),o=c1(t);return $.jsx(NZ,{role:"region","aria-labelledby":s.triggerId,"data-orientation":i.orientation,...o,...r,ref:e,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...n.style}})});c6.displayName=l6;function u6(n){return n?"open":"closed"}var qZ=e6,XZ=i6,YZ=o6,KZ=a6,GZ=c6;function ZZ({...n}){return $.jsx(qZ,{"data-slot":"accordion",...n})}function K0({className:n,...e}){return $.jsx(XZ,{"data-slot":"accordion-item",className:Ql("border-b last:border-b-0",n),...e})}function G0({className:n,children:e,...t}){return $.jsx(YZ,{className:"flex",children:$.jsxs(KZ,{"data-slot":"accordion-trigger",className:Ql("focus-visible:border-ring focus-visible:ring-ring/50 flex flex-1 items-start justify-between gap-4 rounded-md py-4 text-left text-sm font-medium transition-all outline-none hover:underline focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&[data-state=open]>svg]:rotate-180",n),...t,children:[e,$.jsx(RZ,{className:"text-muted-foreground pointer-events-none size-4 shrink-0 translate-y-0.5 transition-transform duration-100"})]})})}function Z0({className:n,children:e,...t}){return $.jsx(GZ,{"data-slot":"accordion-content",className:"data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down overflow-hidden text-sm",...t,children:$.jsx("div",{className:Ql("pt-0 pb-4",n),children:e})})}function Jy(n,e){if(!n)throw new Error(e||"loader assertion failed.")}const h1=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),PI=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);PI&&parseFloat(PI[1]);const MI=globalThis,OI=globalThis.process||{},QZ=globalThis.navigator||{};function h6(n){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function hc(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||h6()}function JZ(n){return hc()?h6()?"Electron":(QZ.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const f6="4.1.0";function eQ(n){try{const e=window[n],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class tQ{constructor(e,t,r="sessionStorage"){this.storage=eQ(r),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function nQ(n){let e;return n<10?e=`${n.toFixed(2)}ms`:n<100?e=`${n.toFixed(1)}ms`:n<1e3?e=`${n.toFixed(0)}ms`:e=`${(n/1e3).toFixed(2)}s`,e}function rQ(n,e=8){const t=Math.max(e-n.length,0);return`${" ".repeat(t)}${n}`}var e_;(function(n){n[n.BLACK=30]="BLACK",n[n.RED=31]="RED",n[n.GREEN=32]="GREEN",n[n.YELLOW=33]="YELLOW",n[n.BLUE=34]="BLUE",n[n.MAGENTA=35]="MAGENTA",n[n.CYAN=36]="CYAN",n[n.WHITE=37]="WHITE",n[n.BRIGHT_BLACK=90]="BRIGHT_BLACK",n[n.BRIGHT_RED=91]="BRIGHT_RED",n[n.BRIGHT_GREEN=92]="BRIGHT_GREEN",n[n.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",n[n.BRIGHT_BLUE=94]="BRIGHT_BLUE",n[n.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",n[n.BRIGHT_CYAN=96]="BRIGHT_CYAN",n[n.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(e_||(e_={}));const iQ=10;function kI(n){return typeof n!="string"?n:(n=n.toUpperCase(),e_[n]||e_.WHITE)}function sQ(n,e,t){return!hc&&typeof n=="string"&&(e&&(n=`\x1B[${kI(e)}m${n}\x1B[39m`),t&&(n=`\x1B[${kI(t)+iQ}m${n}\x1B[49m`)),n}function oQ(n,e=["constructor"]){const t=Object.getPrototypeOf(n),r=Object.getOwnPropertyNames(t),i=n;for(const s of r){const o=i[s];typeof o=="function"&&(e.find(a=>s===a)||(i[s]=o.bind(n)))}}function f1(n,e){if(!n)throw new Error("Assertion failed")}function ou(){let n;if(hc()&&MI.performance)n=MI?.performance?.now?.();else if("hrtime"in OI){const e=OI?.hrtime?.();n=e[0]*1e3+e[1]/1e6}else n=Date.now();return n}const au={debug:hc()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},aQ={enabled:!0,level:0};function lu(){}const NI={},DI={once:!0};class Sp{constructor({id:e}={id:""}){this.VERSION=f6,this._startTs=ou(),this._deltaTs=ou(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new tQ(`__probe-${this.id}__`,aQ),this.timeStamp(`${this.id} started`),oQ(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((ou()-this._startTs).toPrecision(10))}getDelta(){return Number((ou()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,au.warn,arguments,DI)}error(e){return this._getLogFunction(0,e,au.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,au.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,au.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,au.debug||au.info,arguments,DI)}table(e,t,r){return t?this._getLogFunction(e,t,console.table||lu,r&&[r],{tag:cQ(t)}):lu}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||lu)}group(e,t,r={collapsed:!1}){const i=LI({logLevel:e,message:t,opts:r}),{collapsed:s}=r;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,t,r={}){return this.group(e,t,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||lu)}withGroup(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=d6(e)}_getLogFunction(e,t,r,i,s){if(this._shouldLog(e)){s=LI({logLevel:e,message:t,args:i,opts:s}),r=r||s.method,f1(r),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=ou();const o=s.tag||s.message;if(s.once&&o)if(!NI[o])NI[o]=ou();else return lu;return t=lQ(this.id,s.message,s),r.bind(console,t,...s.args)}return lu}}Sp.VERSION=f6;function d6(n){if(!n)return 0;let e;switch(typeof n){case"number":e=n;break;case"object":e=n.logLevel||n.priority||0;break;default:return 0}return f1(Number.isFinite(e)&&e>=0),e}function LI(n){const{logLevel:e,message:t}=n;n.logLevel=d6(e);const r=n.args?Array.from(n.args):[];for(;r.length&&r.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&r.unshift(t),n.message=e;break;case"object":Object.assign(n,e);break}typeof n.message=="function"&&(n.message=n.message());const i=typeof n.message;return f1(i==="string"||i==="object"),Object.assign(n,{args:r},n.opts)}function lQ(n,e,t){if(typeof e=="string"){const r=t.time?rQ(nQ(t.total)):"";e=t.time?`${n}: ${r}  ${e}`:`${n}: ${e}`,e=sQ(e,t.color,t.background)}return e}function cQ(n){for(const e in n)for(const t in n[e])return t||"untitled";return"empty"}const Q0="4.3.3",uQ=Q0[0]>="0"&&Q0[0]<="9"?`v${Q0}`:"";function hQ(){const n=new Sp({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=n,globalThis.loaders.version=uQ,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=n,n}const fQ=hQ();function dQ(n,e){return p6(n||{},e)}function p6(n,e,t=0){if(t>3)return e;const r={...n};for(const[i,s]of Object.entries(e))s&&typeof s=="object"&&!Array.isArray(s)?r[i]=p6(r[i]||{},e[i],t+1):r[i]=e[i];return r}const pQ="latest";function gQ(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}const mQ=gQ();function Da(n,e){if(!n)throw new Error(e||"loaders.gl assertion failed.")}const Vl=typeof process!="object"||String(process)!=="[object process]"||process.browser,yQ=typeof window<"u"&&typeof window.orientation<"u",UI=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);UI&&parseFloat(UI[1]);class _Q{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,t){this.name=e,this.workerThread=t,this.result=new Promise((r,i)=>{this._resolve=r,this._reject=i})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){Da(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Da(this.isRunning),this.isRunning=!1,this._reject(e)}}class J0{terminate(){}}const eT=new Map;function vQ(n){Da(n.source&&!n.url||!n.source&&n.url);let e=eT.get(n.source||n.url);return e||(n.url&&(e=bQ(n.url),eT.set(n.url,e)),n.source&&(e=g6(n.source),eT.set(n.source,e))),Da(e),e}function bQ(n){if(!n.startsWith("http"))return n;const e=TQ(n);return g6(e)}function g6(n){const e=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(e)}function TQ(n){return`try {
  importScripts('${n}');
} catch (error) {
  console.error(error);
  throw error;
}`}function m6(n,e=!0,t){const r=t||new Set;if(n){if(VI(n))r.add(n);else if(VI(n.buffer))r.add(n.buffer);else if(!ArrayBuffer.isView(n)){if(e&&typeof n=="object")for(const i in n)m6(n[i],e,r)}}return t===void 0?Array.from(r):[]}function VI(n){return n?n instanceof ArrayBuffer||typeof MessagePort<"u"&&n instanceof MessagePort||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas:!1}const tT=()=>{};class Vw{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&Vl||typeof J0<"u"&&!Vl}constructor(e){const{name:t,source:r,url:i}=e;Da(r||i),this.name=t,this.source=r,this.url=i,this.onMessage=tT,this.onError=s=>console.log(s),this.worker=Vl?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=tT,this.onError=tT,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||m6(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=vQ({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new J0(r,{eval:!1})}else if(this.source)e=new J0(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class wQ{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return Vw.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,t=(i,s,o)=>i.done(o),r=(i,s)=>i.error(s)){const i=new Promise(s=>(this.jobQueue.push({name:e,onMessage:t,onError:r,onStart:s}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const r=new _Q(t.name,e);e.onMessage=i=>t.onMessage(r,i.type,i.payload),e.onError=i=>t.onError(r,i),t.onStart(r);try{await r.result}catch(i){console.error(`Worker exception: ${i}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Vl||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new Vw({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return yQ?this.maxMobileConcurrency:this.maxConcurrency}}const xQ={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class fa{props;workerPools=new Map;static _workerFarm;static isSupported(){return Vw.isSupported()}static getWorkerFarm(e={}){return fa._workerFarm=fa._workerFarm||new fa({}),fa._workerFarm.setProps(e),fa._workerFarm}constructor(e){this.props={...xQ},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:r,url:i}=e;let s=this.workerPools.get(t);return s||(s=new wQ({name:t,source:r,url:i}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}function EQ(n,e={}){const t=e[n.id]||{},r=Vl?`${n.id}-worker.js`:`${n.id}-worker-node.js`;let i=t.workerUrl;if(!i&&n.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(Vl?i=`modules/${n.module}/dist/${r}`:i=`modules/${n.module}/src/workers/${n.id}-worker-node.ts`),!i){let s=n.version;s==="latest"&&(s=pQ);const o=s?`@${s}`:"";i=`https://unpkg.com/@loaders.gl/${n.module}${o}/dist/${r}`}return Da(i),i}function AQ(n,e=mQ){Da(n,"no worker provided");const t=n.version;return!(!e||!t)}function SQ(n,e){return!fa.isSupported()||!Vl&&!e?._nodeWorkers?!1:n.worker&&e?.worker}async function RQ(n,e,t,r,i){const s=n.id,o=EQ(n,t),u=fa.getWorkerFarm(t).getWorkerPool({name:s,url:o});t=JSON.parse(JSON.stringify(t)),r=JSON.parse(JSON.stringify(r||{}));const h=await u.startJob("process-on-worker",CQ.bind(null,i));return h.postMessage("process",{input:e,options:t,context:r}),await(await h.result).result}async function CQ(n,e,t,r){switch(t){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:i,input:s,options:o}=r;try{const a=await n(s,o);e.postMessage("done",{id:i,result:a})}catch(a){const u=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:i,error:u})}break;default:console.warn(`parse-with-worker unknown message ${t}`)}}function IQ(n,e,t){if(t=t||n.byteLength,n.byteLength<t||e.byteLength<t)return!1;const r=new Uint8Array(n),i=new Uint8Array(e);for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}function PQ(...n){return MQ(n)}function MQ(n){const e=n.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),t=e.reduce((s,o)=>s+o.byteLength,0),r=new Uint8Array(t);let i=0;for(const s of e)r.set(s,i),i+=s.byteLength;return r.buffer}async function OQ(n){const e=[];for await(const t of n)e.push(t);return PQ(...e)}function FI(){let n;if(typeof window<"u"&&window.performance)n=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();n=e[0]*1e3+e[1]/1e6}else n=Date.now();return n}class BI{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=FI(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(FI()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Rp{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:r}=e;let i=this.stats[t];return i||(e instanceof BI?i=e:i=new BI(t,r),this.stats[t]=i),i}}const kQ="Queued Requests",NQ="Active Requests",DQ="Cancelled Requests",LQ="Queued Requests Ever",UQ="Active Requests Ever",VQ={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class FQ{props;stats;activeRequestCount=0;requestQueue=[];requestMap=new Map;updateTimer=null;constructor(e={}){this.props={...VQ,...e},this.stats=new Rp({id:this.props.id}),this.stats.get(kQ),this.stats.get(NQ),this.stats.get(DQ),this.stats.get(LQ),this.stats.get(UQ)}scheduleRequest(e,t=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const r={handle:e,priority:0,getPriority:t},i=new Promise(s=>(r.resolve=s,r));return this.requestQueue.push(r),this.requestMap.set(e,i),this._issueNewRequests(),i}_issueRequest(e){const{handle:t,resolve:r}=e;let i=!1;const s=()=>{i||(i=!0,this.requestMap.delete(t),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,r?r({done:s}):Promise.resolve({done:s})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let t=0;t<e;++t){const r=this.requestQueue.shift();r&&this._issueRequest(r)}}}_updateAllRequests(){const e=this.requestQueue;for(let t=0;t<e.length;++t){const r=e[t];this._updateRequest(r)||(e.splice(t,1),this.requestMap.delete(r.handle),t--)}e.sort((t,r)=>t.priority-r.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let BQ="";const zI={};function zQ(n){for(const e in zI)if(n.startsWith(e)){const t=zI[e];n=n.replace(e,t)}return!n.startsWith("http://")&&!n.startsWith("https://")&&(n=`${BQ}${n}`),n}function jQ(n){return n&&typeof n=="object"&&n.isBuffer}function y6(n){if(jQ(n))return n;if(n instanceof ArrayBuffer)return n;if(ArrayBuffer.isView(n))return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength);if(typeof n=="string"){const e=n;return new TextEncoder().encode(e).buffer}if(n&&typeof n=="object"&&n._toArrayBuffer)return n._toArrayBuffer();throw new Error("toArrayBuffer")}function _6(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(e+1):""}function HQ(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(0,e):""}const $Q=n=>typeof n=="boolean",vd=n=>typeof n=="function",Cp=n=>n!==null&&typeof n=="object",jI=n=>Cp(n)&&n.constructor==={}.constructor,WQ=n=>!!n&&typeof n[Symbol.iterator]=="function",qQ=n=>n&&typeof n[Symbol.asyncIterator]=="function",fc=n=>typeof Response<"u"&&n instanceof Response||n&&n.arrayBuffer&&n.text&&n.json,dc=n=>typeof Blob<"u"&&n instanceof Blob,XQ=n=>n&&typeof n=="object"&&n.isBuffer,YQ=n=>typeof ReadableStream<"u"&&n instanceof ReadableStream||Cp(n)&&vd(n.tee)&&vd(n.cancel)&&vd(n.getReader),KQ=n=>Cp(n)&&vd(n.read)&&vd(n.pipe)&&$Q(n.readable),v6=n=>YQ(n)||KQ(n);class GQ extends Error{constructor(e,t){super(e),this.reason=t.reason,this.url=t.url,this.response=t.response}reason;url;response}const ZQ=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,QQ=/^([-\w.]+\/[-\w.+]+)/;function HI(n,e){return n.toLowerCase()===e.toLowerCase()}function JQ(n){const e=QQ.exec(n);return e?e[1]:n}function $I(n){const e=ZQ.exec(n);return e?e[1]:""}const b6=/\?.*/;function eJ(n){const e=n.match(b6);return e&&e[0]}function d1(n){return n.replace(b6,"")}function tJ(n){if(n.length<50)return n;const e=n.slice(n.length-15);return`${n.substr(0,32)}...${e}`}function tv(n){return fc(n)?n.url:dc(n)?n.name||"":typeof n=="string"?n:""}function p1(n){if(fc(n)){const e=n,t=e.headers.get("content-type")||"",r=d1(e.url);return JQ(t)||$I(r)}return dc(n)?n.type||"":typeof n=="string"?$I(n):""}function nJ(n){return fc(n)?n.headers["content-length"]||-1:dc(n)?n.size:typeof n=="string"?n.length:n instanceof ArrayBuffer||ArrayBuffer.isView(n)?n.byteLength:-1}async function T6(n){if(fc(n))return n;const e={},t=nJ(n);t>=0&&(e["content-length"]=String(t));const r=tv(n),i=p1(n);i&&(e["content-type"]=i);const s=await sJ(n);s&&(e["x-first-bytes"]=s),typeof n=="string"&&(n=new TextEncoder().encode(n));const o=new Response(n,{headers:e});return Object.defineProperty(o,"url",{value:r}),o}async function rJ(n){if(!n.ok)throw await iJ(n)}async function iJ(n){const e=tJ(n.url);let t=`Failed to fetch resource (${n.status}) ${n.statusText}: ${e}`;t=t.length>100?`${t.slice(0,100)}...`:t;const r={reason:n.statusText,url:n.url,response:n};try{const i=n.headers.get("Content-Type");r.reason=!n.bodyUsed&&i?.includes("application/json")?await n.json():await n.text()}catch{}return new GQ(t,r)}async function sJ(n){if(typeof n=="string")return`data:,${n.slice(0,5)}`;if(n instanceof Blob){const t=n.slice(0,5);return await new Promise(r=>{const i=new FileReader;i.onload=s=>r(s?.target?.result),i.readAsDataURL(t)})}if(n instanceof ArrayBuffer){const t=n.slice(0,5);return`data:base64,${oJ(t)}`}return null}function oJ(n){let e="";const t=new Uint8Array(n);for(let r=0;r<t.byteLength;r++)e+=String.fromCharCode(t[r]);return btoa(e)}function aJ(n){return!lJ(n)&&!cJ(n)}function lJ(n){return n.startsWith("http:")||n.startsWith("https:")}function cJ(n){return n.startsWith("data:")}async function WI(n,e){if(typeof n=="string"){const t=zQ(n);return aJ(t)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(t,e):await fetch(t,e)}return await T6(n)}const qI=new Sp({id:"loaders.gl"});class uJ{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class hJ{console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const w6={fetch:null,mimeType:void 0,nothrow:!1,log:new hJ,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:h1,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},fJ={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function x6(){globalThis.loaders=globalThis.loaders||{};const{loaders:n}=globalThis;return n._state||(n._state={}),n._state}function E6(){const n=x6();return n.globalOptions=n.globalOptions||{...w6},n.globalOptions}function dJ(n,e,t,r){return t=t||[],t=Array.isArray(t)?t:[t],pJ(n,t),mJ(e,n,r)}function pJ(n,e){XI(n,null,w6,fJ,e);for(const t of e){const r=n&&n[t.id]||{},i=t.options&&t.options[t.id]||{},s=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};XI(r,t.id,i,s,e)}}function XI(n,e,t,r,i){const s=e||"Top level",o=e?`${e}.`:"";for(const a in n){const u=!e&&Cp(n[a]),h=a==="baseUri"&&!e,d=a==="workerUrl"&&e;if(!(a in t)&&!h&&!d){if(a in r)qI.warn(`${s} loader option '${o}${a}' no longer supported, use '${r[a]}'`)();else if(!u){const g=gJ(a,i);qI.warn(`${s} loader option '${o}${a}' not recognized. ${g}`)()}}}}function gJ(n,e){const t=n.toLowerCase();let r="";for(const i of e)for(const s in i.options){if(n===s)return`Did you mean '${i.id}.${s}'?`;const o=s.toLowerCase();(t.startsWith(o)||o.startsWith(t))&&(r=r||`Did you mean '${i.id}.${s}'?`)}return r}function mJ(n,e,t){const i={...n.options||{}};return yJ(i,t),i.log===null&&(i.log=new uJ),YI(i,E6()),YI(i,e),i}function YI(n,e){for(const t in e)if(t in e){const r=e[t];jI(r)&&jI(n[t])?n[t]={...n[t],...e[t]}:n[t]=e[t]}}function yJ(n,e){e&&!("baseUri"in n)&&(n.baseUri=e)}function g1(n){return n?(Array.isArray(n)&&(n=n[0]),Array.isArray(n?.extensions)):!1}function m1(n){Jy(n,"null loader"),Jy(g1(n),"invalid loader");let e;return Array.isArray(n)&&(e=n[1],n=n[0],n={...n,options:{...n.options,...e}}),(n?.parseTextSync||n?.parseText)&&(n.text=!0),n.text||(n.binary=!0),n}const A6=()=>{const n=x6();return n.loaderRegistry=n.loaderRegistry||[],n.loaderRegistry};function _J(n){const e=A6();n=Array.isArray(n)?n:[n];for(const t of n){const r=m1(t);e.find(i=>r===i)||e.unshift(r)}}function vJ(){return A6()}const bJ=/\.([^.]+)$/;async function TJ(n,e=[],t,r){if(!S6(n))return null;let i=KI(n,e,{...t,nothrow:!0},r);if(i)return i;if(dc(n)&&(n=await n.slice(0,10).arrayBuffer(),i=KI(n,e,t,r)),!i&&!t?.nothrow)throw new Error(R6(n));return i}function KI(n,e=[],t,r){if(!S6(n))return null;if(e&&!Array.isArray(e))return m1(e);let i=[];e&&(i=i.concat(e)),t?.ignoreRegisteredLoaders||i.push(...vJ()),xJ(i);const s=wJ(n,i,t,r);if(!s&&!t?.nothrow)throw new Error(R6(n));return s}function wJ(n,e,t,r){const i=tv(n),s=p1(n),o=d1(i)||r?.url;let a=null,u="";return t?.mimeType&&(a=nT(e,t?.mimeType),u=`match forced by supplied MIME type ${t?.mimeType}`),a=a||EJ(e,o),u=u||(a?`matched url ${o}`:""),a=a||nT(e,s),u=u||(a?`matched MIME type ${s}`:""),a=a||SJ(e,n),u=u||(a?`matched initial data ${C6(n)}`:""),t?.fallbackMimeType&&(a=a||nT(e,t?.fallbackMimeType),u=u||(a?`matched fallback MIME type ${s}`:"")),u&&fQ.log(1,`selectLoader selected ${a?.name}: ${u}.`),a}function S6(n){return!(n instanceof Response&&n.status===204)}function R6(n){const e=tv(n),t=p1(n);let r="No valid loader found (";r+=e?`${_6(e)}, `:"no url provided, ",r+=`MIME type: ${t?`"${t}"`:"not provided"}, `;const i=n?C6(n):"";return r+=i?` first bytes: "${i}"`:"first bytes: not available",r+=")",r}function xJ(n){for(const e of n)m1(e)}function EJ(n,e){const t=e&&bJ.exec(e),r=t&&t[1];return r?AJ(n,r):null}function AJ(n,e){e=e.toLowerCase();for(const t of n)for(const r of t.extensions)if(r.toLowerCase()===e)return t;return null}function nT(n,e){for(const t of n)if(t.mimeTypes?.some(r=>HI(e,r))||HI(e,`application/x.${t.id}`))return t;return null}function SJ(n,e){if(!e)return null;for(const t of n)if(typeof e=="string"){if(RJ(e,t))return t}else if(ArrayBuffer.isView(e)){if(GI(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&GI(e,0,t))return t;return null}function RJ(n,e){return e.testText?e.testText(n):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>n.startsWith(r))}function GI(n,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(i=>CJ(n,e,t,i))}function CJ(n,e,t,r){if(r instanceof ArrayBuffer)return IQ(r,n,r.byteLength);switch(typeof r){case"function":return r(n);case"string":const i=Fw(n,e,r.length);return r===i;default:return!1}}function C6(n,e=5){return typeof n=="string"?n.slice(0,e):ArrayBuffer.isView(n)?Fw(n.buffer,n.byteOffset,e):n instanceof ArrayBuffer?Fw(n,0,e):""}function Fw(n,e,t){if(n.byteLength<e+t)return"";const r=new DataView(n);let i="";for(let s=0;s<t;s++)i+=String.fromCharCode(r.getUint8(e+s));return i}const IJ=256*1024;function*PJ(n,e){const t=e?.chunkSize||IJ;let r=0;const i=new TextEncoder;for(;r<n.length;){const s=Math.min(n.length-r,t),o=n.slice(r,r+s);r+=s,yield i.encode(o)}}const MJ=256*1024;function*OJ(n,e={}){const{chunkSize:t=MJ}=e;let r=0;for(;r<n.byteLength;){const i=Math.min(n.byteLength-r,t),s=new ArrayBuffer(i),o=new Uint8Array(n,r,i);new Uint8Array(s).set(o),r+=i,yield s}}const kJ=1024*1024;async function*NJ(n,e){const t=e?.chunkSize||kJ;let r=0;for(;r<n.size;){const i=r+t,s=await n.slice(r,i).arrayBuffer();r=i,yield s}}function ZI(n,e){return h1?DJ(n,e):LJ(n)}async function*DJ(n,e){const t=n.getReader();let r;try{for(;;){const i=r||t.read();e?._streamReadAhead&&(r=t.read());const{done:s,value:o}=await i;if(s)return;yield y6(o)}}catch{t.releaseLock()}}async function*LJ(n,e){for await(const t of n)yield y6(t)}function UJ(n,e){if(typeof n=="string")return PJ(n,e);if(n instanceof ArrayBuffer)return OJ(n,e);if(dc(n))return NJ(n,e);if(v6(n))return ZI(n,e);if(fc(n))return ZI(n.body,e);throw new Error("makeIterator")}const I6="Cannot convert supplied data type";function VJ(n,e,t){if(e.text&&typeof n=="string")return n;if(XQ(n)&&(n=n.buffer),n instanceof ArrayBuffer){const r=n;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(n)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(n);let r=n.buffer;const i=n.byteLength||n.length;return(n.byteOffset!==0||i!==r.byteLength)&&(r=r.slice(n.byteOffset,n.byteOffset+i)),r}throw new Error(I6)}async function FJ(n,e,t){const r=n instanceof ArrayBuffer||ArrayBuffer.isView(n);if(typeof n=="string"||r)return VJ(n,e);if(dc(n)&&(n=await T6(n)),fc(n)){const i=n;return await rJ(i),e.binary?await i.arrayBuffer():await i.text()}if(v6(n)&&(n=UJ(n,t)),WQ(n)||qQ(n))return OQ(n);throw new Error(I6)}function P6(n,e){const t=E6(),r=n||t;return typeof r.fetch=="function"?r.fetch:Cp(r.fetch)?i=>WI(i,r.fetch):e?.fetch?e?.fetch:WI}function BJ(n,e,t){if(t)return t;const r={fetch:P6(e,n),...n};if(r.url){const i=d1(r.url);r.baseUrl=i,r.queryString=eJ(r.url),r.filename=_6(i),r.baseUrl=HQ(i)}return Array.isArray(r.loaders)||(r.loaders=null),r}function zJ(n,e){if(n&&!Array.isArray(n))return n;let t;if(n&&(t=Array.isArray(n)?n:[n]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...r]:r}return t&&t.length?t:void 0}async function t_(n,e,t,r){e&&!Array.isArray(e)&&!g1(e)&&(r=void 0,t=e,e=void 0),n=await n,t=t||{};const i=tv(n),o=zJ(e,r),a=await TJ(n,o,t);return a?(t=dJ(t,a,o,i),r=BJ({url:i,_parse:t_,loaders:o},t,r||null),await jJ(a,n,t,r)):null}async function jJ(n,e,t,r){if(AQ(n),t=dQ(n.options,t),fc(e)){const s=e,{ok:o,redirected:a,status:u,statusText:h,type:d,url:g}=s,y=Object.fromEntries(s.headers.entries());r.response={headers:y,ok:o,redirected:a,status:u,statusText:h,type:d,url:g}}e=await FJ(e,n,t);const i=n;if(i.parseTextSync&&typeof e=="string")return i.parseTextSync(e,t,r);if(SQ(n,t))return await RQ(n,e,t,r,t_);if(i.parseText&&typeof e=="string")return await i.parseText(e,t,r);if(i.parse)return await i.parse(e,t,r);throw Da(!i.parseSync),new Error(`${n.id} loader - no parser found and worker is disabled`)}async function n_(n,e,t,r){let i,s;!Array.isArray(e)&&!g1(e)?(i=[],s=e):(i=e,s=t);const o=P6(s);let a=n;return typeof n=="string"&&(a=await o(n)),dc(n)&&(a=await o(n)),Array.isArray(i)?await t_(a,i,s):await t_(a,i,s)}const HJ="4.3.3",$J=globalThis.loaders?.parseImageNode,Bw=typeof Image<"u",zw=typeof ImageBitmap<"u",WJ=!!$J,jw=h1?!0:WJ;function qJ(n){switch(n){case"auto":return zw||Bw||jw;case"imagebitmap":return zw;case"image":return Bw;case"data":return jw;default:throw new Error(`@loaders.gl/images: image ${n} not supported in this environment`)}}function XJ(){if(zw)return"imagebitmap";if(Bw)return"image";if(jw)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function YJ(n){const e=GJ(n);if(!e)throw new Error("Not an image");return e}function KJ(n){switch(YJ(n)){case"data":return n;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=n.width,e.height=n.height,t.drawImage(n,0,0),t.getImageData(0,0,n.width,n.height);default:throw new Error("getImageData")}}function GJ(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&n instanceof Image?"image":n&&typeof n=="object"&&n.data&&n.width&&n.height?"data":null}const ZJ=/^data:image\/svg\+xml/,QJ=/\.svg((\?|#).*)?$/;function y1(n){return n&&(ZJ.test(n)||QJ.test(n))}function JJ(n,e){if(y1(e)){let r=new TextDecoder().decode(n);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(s){throw new Error(s.message)}return`data:image/svg+xml;base64,${btoa(r)}`}return M6(n,e)}function M6(n,e){if(y1(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(n)])}async function O6(n,e,t){const r=JJ(n,t),i=self.URL||self.webkitURL,s=typeof r!="string"&&i.createObjectURL(r);try{return await eee(s||r,e)}finally{s&&i.revokeObjectURL(s)}}async function eee(n,e){const t=new Image;return t.src=n,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((r,i)=>{try{t.onload=()=>r(t),t.onerror=s=>{const o=s instanceof Error?s.message:"error";i(new Error(o))}}catch(s){i(s)}})}const tee={};let QI=!0;async function nee(n,e,t){let r;y1(t)?r=await O6(n,e,t):r=M6(n,t);const i=e&&e.imagebitmap;return await ree(r,i)}async function ree(n,e=null){if((iee(e)||!QI)&&(e=null),e)try{return await createImageBitmap(n,e)}catch(t){console.warn(t),QI=!1}return await createImageBitmap(n)}function iee(n){for(const e in n||tee)return!1;return!0}function see(n){return!cee(n,"ftyp",4)||(n[8]&96)===0?null:oee(n)}function oee(n){switch(aee(n,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function aee(n,e,t){return String.fromCharCode(...n.slice(e,t))}function lee(n){return[...n].map(e=>e.charCodeAt(0))}function cee(n,e,t=0){const r=lee(e);for(let i=0;i<r.length;++i)if(r[i]!==n[i+t])return!1;return!0}const Ji=!1,bd=!0;function k6(n){const e=Ip(n);return hee(e)||pee(e)||fee(e)||dee(e)||uee(e)}function uee(n){const e=new Uint8Array(n instanceof DataView?n.buffer:n),t=see(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function hee(n){const e=Ip(n);return e.byteLength>=24&&e.getUint32(0,Ji)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Ji),height:e.getUint32(20,Ji)}:null}function fee(n){const e=Ip(n);return e.byteLength>=10&&e.getUint32(0,Ji)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,bd),height:e.getUint16(8,bd)}:null}function dee(n){const e=Ip(n);return e.byteLength>=14&&e.getUint16(0,Ji)===16973&&e.getUint32(2,bd)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,bd),height:e.getUint32(22,bd)}:null}function pee(n){const e=Ip(n);if(!(e.byteLength>=3&&e.getUint16(0,Ji)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:i}=gee();let s=2;for(;s+9<e.byteLength;){const o=e.getUint16(s,Ji);if(i.has(o))return{mimeType:"image/jpeg",height:e.getUint16(s+5,Ji),width:e.getUint16(s+7,Ji)};if(!r.has(o))return null;s+=2,s+=e.getUint16(s,Ji)}return null}function gee(){const n=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)n.add(t);return{tableMarkers:n,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Ip(n){if(n instanceof DataView)return n;if(ArrayBuffer.isView(n))return new DataView(n.buffer);if(n instanceof ArrayBuffer)return new DataView(n);throw new Error("toDataView")}async function mee(n,e){const{mimeType:t}=k6(n)||{},r=globalThis.loaders?.parseImageNode;return Jy(r),await r(n,t)}async function yee(n,e,t){e=e||{};const i=(e.image||{}).type||"auto",{url:s}=t||{},o=_ee(i);let a;switch(o){case"imagebitmap":a=await nee(n,e,s);break;case"image":a=await O6(n,e,s);break;case"data":a=await mee(n);break;default:Jy(!1)}return i==="data"&&(a=KJ(a)),a}function _ee(n){switch(n){case"auto":case"data":return XJ();default:return qJ(n),n}}const vee=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],bee=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],Tee={image:{type:"auto",decode:!0}},wee={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:HJ,mimeTypes:bee,extensions:vee,parse:yee,tests:[n=>!!k6(new DataView(n))],options:Tee},at=new Sp({id:"deck"});let Hw={};function xee(n){Hw=n}function Jn(n,e,t,r){at.level>0&&Hw[n]&&Hw[n].call(null,e,t,r)}function Eee(n){const e=n[0],t=n[n.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}const Aee={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:Eee,parseTextSync:JSON.parse};function See(){const n="9.1.14",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==n)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${n}`);return e||(at.log(1,`deck.gl ${n}`)(),globalThis.deck={...globalThis.deck,VERSION:n,version:n,log:at,_registerLoggers:xee},_J([Aee,[wee,{imagebitmap:{premultiplyAlpha:"none"}}]])),n}const Ree=See();function _1(n,e){if(!n)throw new Error(e||"shadertools: assertion failed.")}const rT={number:{type:"number",validate(n,e){return Number.isFinite(n)&&typeof e=="object"&&(e.max===void 0||n<=e.max)&&(e.min===void 0||n>=e.min)}},array:{type:"array",validate(n,e){return Array.isArray(n)||ArrayBuffer.isView(n)}}};function Cee(n){const e={};for(const[t,r]of Object.entries(n))e[t]=Iee(r);return e}function Iee(n){let e=JI(n);if(e!=="object")return{value:n,...rT[e],type:e};if(typeof n=="object")return n?n.type!==void 0?{...n,...rT[n.type],type:n.type}:n.value===void 0?{type:"object",value:n}:(e=JI(n.value),{...n,...rT[e],type:e}):{type:"object",value:null};throw new Error("props")}function JI(n){return Array.isArray(n)||ArrayBuffer.isView(n)?"array":typeof n}const Pee=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,Mee=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,Oee={vertex:Pee,fragment:Mee},eP=/void\s+main\s*\([^)]*\)\s*\{\n?/,tP=/}\n?[^{}]*$/,iT=[],oy="__LUMA_INJECT_DECLARATIONS__";function kee(n){const e={vertex:{},fragment:{}};for(const t in n){let r=n[t];const i=Nee(t);typeof r=="string"&&(r={order:0,injection:r}),e[i][t]=r}return e}function Nee(n){const e=n.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function r_(n,e,t,r=!1){const i=e==="vertex";for(const s in t){const o=t[s];o.sort((u,h)=>u.order-h.order),iT.length=o.length;for(let u=0,h=o.length;u<h;++u)iT[u]=o[u].injection;const a=`${iT.join(`
`)}
`;switch(s){case"vs:#decl":i&&(n=n.replace(oy,a));break;case"vs:#main-start":i&&(n=n.replace(eP,u=>u+a));break;case"vs:#main-end":i&&(n=n.replace(tP,u=>a+u));break;case"fs:#decl":i||(n=n.replace(oy,a));break;case"fs:#main-start":i||(n=n.replace(eP,u=>u+a));break;case"fs:#main-end":i||(n=n.replace(tP,u=>a+u));break;default:n=n.replace(s,u=>u+a)}}return n=n.replace(oy,""),r&&(n=n.replace(/\}\s*$/,s=>s+Oee[e])),n}function i_(n){n.map(e=>Dee(e))}function Dee(n){if(n.instance)return;i_(n.dependencies||[]);const{propTypes:e={},deprecations:t=[],inject:r={}}=n,i={normalizedInjections:kee(r),parsedDeprecations:Lee(t)};e&&(i.propValidators=Cee(e)),n.instance=i;let s={};e&&(s=Object.entries(e).reduce((o,[a,u])=>{const h=u?.value;return h&&(o[a]=h),o},{})),n.defaultUniforms={...n.defaultUniforms,...s}}function N6(n,e,t){n.deprecations?.forEach(r=>{r.regex?.test(e)&&(r.deprecated?t.deprecated(r.old,r.new)():t.removed(r.old,r.new)())})}function Lee(n){return n.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),n}function v1(n){i_(n);const e={},t={};D6({modules:n,level:0,moduleMap:e,moduleDepth:t});const r=Object.keys(t).sort((i,s)=>t[s]-t[i]).map(i=>e[i]);return i_(r),r}function D6(n){const{modules:e,level:t,moduleMap:r,moduleDepth:i}=n;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const s of e)r[s.name]=s,(i[s.name]===void 0||i[s.name]<t)&&(i[s.name]=t);for(const s of e)s.dependencies&&D6({modules:s.dependencies,level:t+1,moduleMap:r,moduleDepth:i})}function Uee(n){switch(n?.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function Vee(n,e){if(Number(n.match(/^#version[ \t]+(\d+)/m)?.[1]||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return n=nP(n,Fee),n;case"fragment":return n=nP(n,Bee),n;default:throw new Error(e)}}const L6=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],Fee=[...L6,[$w("attribute"),"in $1"],[$w("varying"),"out $1"]],Bee=[...L6,[$w("varying"),"in $1"]];function nP(n,e){for(const[t,r]of e)n=n.replace(t,r);return n}function $w(n){return new RegExp(`\\b${n}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function U6(n,e){let t="";for(const r in n){const i=n[r];if(t+=`void ${i.signature} {
`,i.header&&(t+=`  ${i.header}`),e[r]){const s=e[r];s.sort((o,a)=>o.order-a.order);for(const o of s)t+=`  ${o.injection}
`}i.footer&&(t+=`  ${i.footer}`),t+=`}
`}return t}function V6(n){const e={vertex:{},fragment:{}};for(const t of n){let r,i;typeof t!="string"?(r=t,i=r.hook):(r={},i=t),i=i.trim();const[s,o]=i.split(":"),a=i.replace(/\(.+/,""),u=Object.assign(r,{signature:o});switch(s){case"vs":e.vertex[a]=u;break;case"fs":e.fragment[a]=u;break;default:throw new Error(s)}}return e}function zee(n,e){return{name:jee(n,e),language:"glsl",version:Hee(n)}}function jee(n,e="unnamed"){const r=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(n);return r?r[1]:e}function Hee(n){let e=100;const t=n.match(/[^\s]+/g);if(t&&t.length>=2&&t[0]==="#version"){const r=parseInt(t[1],10);Number.isFinite(r)&&(e=r)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const F6=`

${oy}
`,$ee=`precision highp float;
`;function Wee(n){const e=v1(n.modules||[]);return{source:Xee(n.platformInfo,{...n,source:n.source,stage:"vertex",modules:e}),getUniforms:B6(e)}}function qee(n){const{vs:e,fs:t}=n,r=v1(n.modules||[]);return{vs:rP(n.platformInfo,{...n,source:e,stage:"vertex",modules:r}),fs:rP(n.platformInfo,{...n,source:t,stage:"fragment",modules:r}),getUniforms:B6(r)}}function Xee(n,e){const{source:t,stage:r,modules:i,hookFunctions:s=[],inject:o={},log:a}=e;_1(typeof t=="string","shader source must be a string");const u=t;let h="";const d=V6(s),g={},y={},v={};for(const w in o){const E=typeof o[w]=="string"?{injection:o[w],order:0}:o[w],S=/^(v|f)s:(#)?([\w-]+)$/.exec(w);if(S){const P=S[2],I=S[3];P?I==="decl"?y[w]=[E]:v[w]=[E]:g[w]=[E]}else v[w]=[E]}const T=i;for(const w of T){a&&N6(w,u,a);const E=z6(w,"wgsl");h+=E;const S=w.injections?.[r]||{};for(const P in S){const I=/^(v|f)s:#([\w-]+)$/.exec(P);if(I){const F=I[2]==="decl"?y:v;F[P]=F[P]||[],F[P].push(S[P])}else g[P]=g[P]||[],g[P].push(S[P])}}return h+=F6,h=r_(h,r,y),h+=U6(d[r],g),h+=u,h=r_(h,r,v),h}function rP(n,e){const{id:t,source:r,stage:i,language:s="glsl",modules:o,defines:a={},hookFunctions:u=[],inject:h={},prologue:d=!0,log:g}=e;_1(typeof r=="string","shader source must be a string");const y=s==="glsl"?zee(r).version:-1,v=n.shaderLanguageVersion,T=y===100?"#version 100":"#version 300 es",E=r.split(`
`).slice(1).join(`
`),S={};o.forEach(k=>{Object.assign(S,k.defines)}),Object.assign(S,a);let P="";switch(s){case"wgsl":break;case"glsl":P=d?`${T}

// ----- PROLOGUE -------------------------
${Yee({id:t,source:r,stage:i})}
${`#define SHADER_TYPE_${i.toUpperCase()}`}

${Uee(n)}
${i==="fragment"?$ee:""}

// ----- APPLICATION DEFINES -------------------------

${Kee(S)}

`:`${T}
`;break}const I=V6(u),L={},F={},Y={};for(const k in h){const M=typeof h[k]=="string"?{injection:h[k],order:0}:h[k],N=/^(v|f)s:(#)?([\w-]+)$/.exec(k);if(N){const H=N[2],q=N[3];H?q==="decl"?F[k]=[M]:Y[k]=[M]:L[k]=[M]}else Y[k]=[M]}for(const k of o){g&&N6(k,E,g);const M=z6(k,i);P+=M;const N=k.instance?.normalizedInjections[i]||{};for(const H in N){const q=/^(v|f)s:#([\w-]+)$/.exec(H);if(q){const j=q[2]==="decl"?F:Y;j[H]=j[H]||[],j[H].push(N[H])}else L[H]=L[H]||[],L[H].push(N[H])}}return P+="// ----- MAIN SHADER SOURCE -------------------------",P+=F6,P=r_(P,i,F),P+=U6(I[i],L),P+=E,P=r_(P,i,Y),s==="glsl"&&y!==v&&(P=Vee(P,i)),P.trim()}function B6(n){return function(t){const r={};for(const i of n){const s=i.getUniforms?.(t,r);Object.assign(r,s)}return r}}function Yee(n){const{id:e,source:t,stage:r}=n;return e&&t.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${r}`:""}function Kee(n={}){let e="";for(const t in n){const r=n[t];(r||Number.isFinite(r))&&(e+=`#define ${t.toUpperCase()} ${n[t]}
`)}return e}function z6(n,e){let t;switch(e){case"vertex":t=n.vs||"";break;case"fragment":t=n.fs||"";break;case"wgsl":t=n.source||"";break;default:_1(!1)}if(!n.name)throw new Error("Shader module must have a name");const r=n.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let i=`// ----- MODULE ${n.name} ---------------

`;return e!=="wgsl"&&(i+=`#define MODULE_${r}
`),i+=`${t}
`,i}const Gee=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,Zee=/^\s*\#\s*endif\s*$/;function Qee(n,e){const t=n.split(`
`),r=[];let i=!0,s=null;for(const o of t){const a=o.match(Gee),u=o.match(Zee);a?(s=a[1],i=!!e?.defines?.[s]):u?i=!0:i&&r.push(o)}return r.join(`
`)}class kl{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return kl.defaultShaderAssembler=kl.defaultShaderAssembler||new kl,kl.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const t=this._getModuleList(e.modules),r=this._hookFunctions,{source:i,getUniforms:s}=Wee({...e,source:e.source,modules:t,hookFunctions:r});return{source:e.platformInfo.shaderLanguage==="wgsl"?Qee(i):i,getUniforms:s,modules:t}}assembleGLSLShaderPair(e){const t=this._getModuleList(e.modules),r=this._hookFunctions;return{...qee({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:r}),modules:t}}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),r={};let i=0;for(let s=0,o=this._defaultModules.length;s<o;++s){const a=this._defaultModules[s],u=a.name;t[i++]=a,r[u]=!0}for(let s=0,o=e.length;s<o;++s){const a=e[s],u=a.name;r[u]||(t[i++]=a,r[u]=!0)}return t.length=i,i_(t),t}}const Jee=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,ete=`#version 300 es
${Jee}`;function tte(n){const{input:e,inputChannels:t,output:r}={};if(!e)return ete;if(!t)throw new Error("inputChannels");const i=nte(t),s=rte(e,t);return`#version 300 es
in ${i} ${e};
out vec4 ${r};
void main() {
  ${r} = ${s};
}`}function nte(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${n}`)}}function rte(n,e){switch(e){case 1:return`vec4(${n}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${n}, 0.0, 1.0)`;case 3:return`vec4(${n}, 1.0)`;case 4:return n;default:throw new Error(`invalid channels: ${e}`)}}class ite{stats=new Map;getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Rp({id:e})),this.stats.get(e)}}const j6=new ite,we=new Sp({id:"luma.gl"}),sT={};function nv(n="id"){sT[n]=sT[n]||1;const e=sT[n]++;return`${n}-${e}`}let Rt=class{static defaultProps={id:"undefined",handle:void 0,userData:void 0};toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(e,t,r){if(!e)throw new Error("no device");this._device=e,this.props=ste(t,r);const i=this.props.id!=="undefined"?this.props.id:nv(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").addCount(e),r.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}};function ste(n,e){const t={...e};for(const r in n)n[r]!==void 0&&(t[r]=n[r]);return t}let zt=class ay extends Rt{static defaultProps={...Rt.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1};static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(e,t){const r={...t};(t.usage||0)&ay.INDEX&&!t.indexType&&(t.data instanceof Uint32Array?r.indexType="uint32":t.data instanceof Uint16Array&&(r.indexType="uint16")),delete r.data,super(e,r,ay.defaultProps),this.usage=r.usage||0,this.indexType=r.indexType,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createBuffer({...this.props,...e})}readSyncWebGL(e,t){throw new Error("not implemented")}static DEBUG_DATA_MAX_LENGTH=32;debugData=new ArrayBuffer(0);_setDebugData(e,t,r){const i=ArrayBuffer.isView(e)?e.buffer:e,s=Math.min(e?e.byteLength:r,ay.DEBUG_DATA_MAX_LENGTH);i===null?this.debugData=new ArrayBuffer(s):t===0&&r===i.byteLength?this.debugData=i.slice(0,s):this.debugData=i.slice(t,t+s)}};function H6(n){const e=iP[n],t=ote(e),r=n.includes("norm"),i=!r&&!n.startsWith("float"),s=n.startsWith("s");return{dataType:iP[n],byteLength:t,integer:i,signed:s,normalized:r}}function ote(n){return ate[n]}const iP={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},ate={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},Kn="texture-compression-bc",At="texture-compression-astc",Xi="texture-compression-etc2",lte="texture-compression-etc1-webgl",gm="texture-compression-pvrtc-webgl",oT="texture-compression-atc-webgl",mm="float32-renderable-webgl",aT="float16-renderable-webgl",cte="rgb9e5ufloat-renderable-webgl",lT="snorm8-renderable-webgl",qf="norm16-renderable-webgl",cT="snorm16-renderable-webgl",ym="float32-filterable",sP="float16-filterable-webgl";function $6(n){const e=ute[n];if(!e)throw new Error(`Unsupported texture format ${n}`);return e}const ute={r8unorm:{},r8snorm:{render:lT},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:lT},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:aT,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:qf},"r16snorm-webgl":{f:cT},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:lT},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:aT,filter:sP},"rg16unorm-webgl":{render:qf},"rg16snorm-webgl":{render:cT},r32uint:{},r32sint:{},r32float:{render:mm,filter:ym},rgb9e5ufloat:{channels:"rgb",packed:!0,render:cte},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:mm},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:qf},"rgb16snorm-webgl":{f:qf},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:ym},rgba16uint:{},rgba16sint:{},rgba16float:{render:aT,filter:sP},"rgba16unorm-webgl":{render:qf},"rgba16snorm-webgl":{render:cT},"rgb32float-webgl":{render:mm,filter:ym},rgba32uint:{},rgba32sint:{},rgba32float:{render:mm,filter:ym},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:Kn},"bc1-rgb-unorm-srgb-webgl":{f:Kn},"bc1-rgba-unorm":{f:Kn},"bc1-rgba-unorm-srgb":{f:Kn},"bc2-rgba-unorm":{f:Kn},"bc2-rgba-unorm-srgb":{f:Kn},"bc3-rgba-unorm":{f:Kn},"bc3-rgba-unorm-srgb":{f:Kn},"bc4-r-unorm":{f:Kn},"bc4-r-snorm":{f:Kn},"bc5-rg-unorm":{f:Kn},"bc5-rg-snorm":{f:Kn},"bc6h-rgb-ufloat":{f:Kn},"bc6h-rgb-float":{f:Kn},"bc7-rgba-unorm":{f:Kn},"bc7-rgba-unorm-srgb":{f:Kn},"etc2-rgb8unorm":{f:Xi},"etc2-rgb8unorm-srgb":{f:Xi},"etc2-rgb8a1unorm":{f:Xi},"etc2-rgb8a1unorm-srgb":{f:Xi},"etc2-rgba8unorm":{f:Xi},"etc2-rgba8unorm-srgb":{f:Xi},"eac-r11unorm":{f:Xi},"eac-r11snorm":{f:Xi},"eac-rg11unorm":{f:Xi},"eac-rg11snorm":{f:Xi},"astc-4x4-unorm":{f:At},"astc-4x4-unorm-srgb":{f:At},"astc-5x4-unorm":{f:At},"astc-5x4-unorm-srgb":{f:At},"astc-5x5-unorm":{f:At},"astc-5x5-unorm-srgb":{f:At},"astc-6x5-unorm":{f:At},"astc-6x5-unorm-srgb":{f:At},"astc-6x6-unorm":{f:At},"astc-6x6-unorm-srgb":{f:At},"astc-8x5-unorm":{f:At},"astc-8x5-unorm-srgb":{f:At},"astc-8x6-unorm":{f:At},"astc-8x6-unorm-srgb":{f:At},"astc-8x8-unorm":{f:At},"astc-8x8-unorm-srgb":{f:At},"astc-10x5-unorm":{f:At},"astc-10x5-unorm-srgb":{f:At},"astc-10x6-unorm":{f:At},"astc-10x6-unorm-srgb":{f:At},"astc-10x8-unorm":{f:At},"astc-10x8-unorm-srgb":{f:At},"astc-10x10-unorm":{f:At},"astc-10x10-unorm-srgb":{f:At},"astc-12x10-unorm":{f:At},"astc-12x10-unorm-srgb":{f:At},"astc-12x12-unorm":{f:At},"astc-12x12-unorm-srgb":{f:At},"pvrtc-rgb4unorm-webgl":{f:gm},"pvrtc-rgba4unorm-webgl":{f:gm},"pvrtc-rbg2unorm-webgl":{f:gm},"pvrtc-rgba2unorm-webgl":{f:gm},"etc1-rbg-unorm-webgl":{f:lte},"atc-rgb-unorm-webgl":{f:oT},"atc-rgba-unorm-webgl":{f:oT},"atc-rgbai-unorm-webgl":{f:oT}},hte=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],fte=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function W6(n){return hte.some(e=>n.startsWith(e))}function b1(n){let e=dte(n);if(W6(n)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const r=pte(n);r&&(e.blockWidth=r.blockWidth,e.blockHeight=r.blockHeight)}const t=fte.exec(n);if(t){const[,r,i,s,o,a]=t,u=`${s}${i}`,h=H6(u),d=h.byteLength*8,g=r.length,y=[d,g>=2?d:0,g>=3?d:0,g>=4?d:0];e={format:n,attachment:e.attachment,dataType:h.dataType,components:g,channels:r,integer:h.integer,signed:h.signed,normalized:h.normalized,bitsPerChannel:y,bytesPerPixel:h.byteLength*r.length,packed:e.packed,srgb:e.srgb},a==="-webgl"&&(e.webgl=!0),o==="-srgb"&&(e.srgb=!0)}return n.endsWith("-webgl")&&(e.webgl=!0),n.endsWith("-srgb")&&(e.srgb=!0),e}function dte(n){const e=$6(n),t=e.bytesPerPixel||1,r=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:n,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||e.channels?.length||1,bytesPerPixel:t,bitsPerChannel:r,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function pte(n){const t=/.*-(\d+)x(\d+)-.*/.exec(n);if(t){const[,r,i]=t;return{blockWidth:Number(r),blockHeight:Number(i)}}return null}function gte(n){const e=$6(n),t={format:n,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},r=b1(n),i=n.startsWith("depth")||n.startsWith("stencil"),s=r?.signed,o=r?.integer,a=r?.webgl;return t.render&&=!s,t.filter&&=!i&&!s&&!o&&!a,t}class mte{}class yte{features;disabledFeatures;constructor(e=[],t){this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures?.[e]&&this.features.has(e)}}class Ea{static defaultProps={id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>we.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:we.get("debug")||void 0,debugShaders:we.get("debug-shaders")||void 0,debugFramebuffers:!!we.get("debug-framebuffers"),debugWebGL:!!we.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0};get[Symbol.toStringTag](){return"Device"}constructor(e){this.props={...Ea.defaultProps,...e},this.id=this.props.id||nv(this[Symbol.toStringTag].toLowerCase())}id;props;userData={};statsManager=j6;timestamp=0;_reused=!1;_lumaData={};getTextureFormatCapabilities(e){const t=gte(e),r=o=>(typeof o=="string"?this.features.has(o):o)??!0,i=r(t.create),s={format:e,create:i,render:i&&r(t.render),filter:i&&r(t.filter),blend:i&&r(t.blend),store:i&&r(t.store)};return this._getDeviceSpecificTextureFormatCapabilities(s)}isTextureFormatSupported(e,t){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return W6(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};return(e.usage||0)&zt.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array?t.indexType="uint16":we.warn("indices buffer content must be of integer type")()),t}}const _te=hc()&&typeof document<"u",vte=()=>_te&&document.readyState==="complete",bte="set luma.log.level=1 (or higher) to trace rendering",oP="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.";class vu{static defaultProps={...Ea.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0};static pageLoaded=Tte().then(()=>{we.probe(2,"DOM is loaded")()});stats=j6;log=we;VERSION="9.1.9";spector;preregisteredAdapters=new Map;constructor(){if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw we.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),we.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");we.error("This version of luma.gl has already been initialized")()}we.log(1,`${this.VERSION} - ${bte}`)(),globalThis.luma=this}registerAdapters(e){for(const t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(e=[]){const t=this.getAdapterMap(e);return Array.from(t).map(([,r])=>r).filter(r=>r.isSupported?.()).map(r=>r.type)}getBestAvailableAdapter(e=[]){const t=this.getAdapterMap(e);return t.get("webgpu")?.isSupported?.()?"webgpu":t.get("webgl")?.isSupported?.()?"webgl":null}setDefaultDeviceProps(e){Object.assign(vu.defaultProps,e)}async createDevice(e={}){e={...vu.defaultProps,...e},e.waitForPageLoad&&await vu.pageLoaded;const t=this.getAdapterMap(e.adapters);let r=e.type||"";r==="best-available"&&(r=this.getBestAvailableAdapter(e.adapters)||r);const o=await(this.getAdapterMap(e.adapters)||t).get(r)?.create?.(e);if(o)return o;throw new Error(oP)}async attachDevice(e){const t=this.getAdapterMap(e.adapters);let r="";e.handle instanceof WebGL2RenderingContext&&(r="webgl"),e.createCanvasContext&&await vu.pageLoaded,e.handle===null&&(r="unknown");const s=await t.get(r)?.attach?.(null);if(s)return s;throw new Error(oP)}enforceWebGL2(e=!0,t=[]){const i=this.getAdapterMap(t).get("webgl");i||we.warn("enforceWebGL2: webgl adapter not found")(),i?.enforceWebGL2?.(e)}getAdapterMap(e=[]){const t=new Map(this.preregisteredAdapters);for(const r of e)t.set(r.type,r);return t}registerDevices(e){we.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const t of e){const r=t.adapter;r&&this.preregisteredAdapters.set(r.type,r)}}}const Ww=new vu;function Tte(){return vte()||typeof window>"u"?Promise.resolve():new Promise(n=>{window.addEventListener("load",()=>n())})}class wte{}class T1{static defaultProps={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"};id;props;canvas;htmlCanvas;offscreenCanvas;type;width=1;height=1;resizeObserver;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};toString(){return`${this[Symbol.toStringTag]}(${this.id})`}constructor(e){if(this.props={...T1.defaultProps,...e},e=this.props,!hc()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=Ete(e.canvas):this.canvas=e.canvas;else{const t=Ate(e),r=xte(e?.container||null);r.insertBefore(t,r.firstChild),this.canvas=t,e?.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(t=>{for(const r of t)r.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),t=this.canvas;return t.parentElement?[t.clientWidth*e,t.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,t]=this.getPixelSize();return e/t}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),t=this._canvasSizeInfo.clientWidth||this.htmlCanvas?.clientWidth;return t?e/t:1}catch{return 1}}cssToDevicePixels(e,t=!0){const r=this.cssToDeviceRatio(),[i,s]=this.getDrawingBufferSize();return Ste(e,r,i,s,t)}setDevicePixelRatio(e,t={}){if(!this.htmlCanvas)return;let r="width"in t?t.width:this.htmlCanvas.clientWidth,i="height"in t?t.height:this.htmlCanvas.clientHeight;(!r||!i)&&(we.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=this.htmlCanvas.width||1,i=this.htmlCanvas.height||1);const s=this._canvasSizeInfo;if(s.clientWidth!==r||s.clientHeight!==i||s.devicePixelRatio!==e){let o=e;const a=Math.floor(r*o),u=Math.floor(i*o);if(this.htmlCanvas.width=a,this.htmlCanvas.height=u,this.device.gl){const[d,g]=this.getDrawingBufferSize();(d!==a||g!==u)&&(o=Math.min(d/r,g/i),this.htmlCanvas.width=Math.floor(r*o),this.htmlCanvas.height=Math.floor(i*o),we.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=r,this._canvasSizeInfo.clientHeight=i,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}}function xte(n){if(typeof n=="string"){const e=document.getElementById(n);if(!e)throw new Error(`${n} is not an HTML element`);return e}else if(n)return n;return document.body}function Ete(n){const e=document.getElementById(n);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function Ate(n){const{width:e,height:t}=n,r=document.createElement("canvas");return r.id=nv("lumagl-auto-created-canvas"),r.width=e||1,r.height=t||1,r.style.width=Number.isFinite(e)?`${e}px`:"100%",r.style.height=Number.isFinite(t)?`${t}px`:"100%",r}function Ste(n,e,t,r,i){const s=n,o=aP(s[0],e,t);let a=lP(s[1],e,r,i),u=aP(s[0]+1,e,t);const h=u===t-1?u:u-1;u=lP(s[1]+1,e,r,i);let d;return i?(u=u===0?u:u+1,d=a,a=u):d=u===r-1?u:u-1,{x:o,y:a,width:Math.max(h-o+1,1),height:Math.max(d-a+1,1)}}function aP(n,e,t){return Math.min(Math.round(n*e),t-1)}function lP(n,e,t,r){return r?Math.max(0,t-1-Math.round(n*e)):Math.min(Math.round(n*e),t-1)}class St extends Rt{static COPY_SRC=1;static COPY_DST=2;static TEXTURE=4;static STORAGE=8;static RENDER_ATTACHMENT=16;static CubeFaces=["+X","-X","+Y","-Y","+Z","-Z"];static defaultProps={...Rt.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0};get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}dimension;format;width;height;depth;mipLevels;updateTimestamp;constructor(e,t){if(t=St.normalizeProps(e,t),super(e,t,St.defaultProps),this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const r=St.getTextureDataSize(this.props.data);this.width=r?.width||1,this.height=r?.height||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?St.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createTexture({...this.props,...e})}static isExternalImage(e){return typeof ImageData<"u"&&e instanceof ImageData||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement||typeof VideoFrame<"u"&&e instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas}static getExternalImageSize(e){if(typeof ImageData<"u"&&e instanceof ImageData||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height};if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement)return{width:e.naturalWidth,height:e.naturalHeight};if(typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement)return{width:e.videoWidth,height:e.videoHeight};if(typeof VideoFrame<"u"&&e instanceof VideoFrame)return{width:e.displayWidth,height:e.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(e){const t=e?.data;return ArrayBuffer.isView(t)}static getTextureDataSize(e){if(!e||ArrayBuffer.isView(e))return null;if(Array.isArray(e))return St.getTextureDataSize(e[0]);if(St.isExternalImage(e))return St.getExternalImageSize(e);if(e&&typeof e=="object"&&e.constructor===Object){const r=Object.values(e)[0];return{width:r.width,height:r.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(e,t){let r;return ArrayBuffer.isView(e)?r=[{data:e,width:t.width,height:t.height}]:Array.isArray(e)?r=e:r=[e],r}static getMipLevelCount(e,t){return Math.floor(Math.log2(Math.max(e,t)))+1}static getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(e)}}static defaultCopyExternalImageOptions={image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1};static normalizeProps(e,t){const r={...t},i=e?.props?._resourceDefaults?.texture||{};Object.assign(r,i);const{width:s,height:o}=r;return typeof s=="number"&&(r.width=Math.max(1,Math.ceil(s))),typeof o=="number"&&(r.height=Math.max(1,Math.ceil(o))),r}}class rv extends Rt{static defaultProps={...Rt.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0};get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,rv.defaultProps)}}function Rte(n,e,t){let r="";const i=e.split(/\r?\n/),s=n.slice().sort((o,a)=>o.lineNum-a.lineNum);switch(t?.showSourceCode||"no"){case"all":let o=0;for(let a=1;a<=i.length;a++)for(r+=q6(i[a-1],a,t);s.length>o&&s[o].lineNum===a;){const u=s[o++];r+=cP(u,i,u.lineNum,{...t,inlineSource:!1})}return r;case"issues":case"no":for(const a of n)r+=cP(a,i,a.lineNum,{inlineSource:t?.showSourceCode!=="no"});return r}}function cP(n,e,t,r){if(r?.inlineSource){const s=Cte(e,t),o=n.linePos>0?`${" ".repeat(n.linePos+5)}^^^
`:"";return`
${s}${o}${n.type.toUpperCase()}: ${n.message}

`}const i=n.type==="error"?"red":"#8B4000";return r?.html?`<div class='luma-compiler-log-error' style="color:${i};"><b> ${n.type.toUpperCase()}: ${n.message}</b></div>`:`${n.type.toUpperCase()}: ${n.message}`}function Cte(n,e,t){let r="";for(let i=e-2;i<=e;i++){const s=n[i-1];s!==void 0&&(r+=q6(s,e,t))}return r}function q6(n,e,t){const r=t?.html?Pte(n):n;return`${Ite(String(e),4)}: ${r}${t?.html?"<br/>":`
`}`}function Ite(n,e){let t="";for(let r=n.length;r<e;++r)t+=" ";return t+n}function Pte(n){return n.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}class iv extends Rt{static defaultProps={...Rt.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0};get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(e,t){t={...t,debugShaders:t.debugShaders||e.props.debugShaders||"errors"},super(e,{id:Mte(t),...t},iv.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const e=this.props.debugShaders;switch(e){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const t=await this.getCompilationInfo();e==="warnings"&&t?.length===0||this._displayShaderLog(t)}_displayShaderLog(e){if(typeof document>"u"||!document?.createElement)return;const t=X6(this.source),r=`${this.stage} ${t}`;let i=Rte(e,this.source,{showSourceCode:"all",html:!0});const s=this.getTranslatedSource();s&&(i+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${s}</pre></code>`);const o=document.createElement("Button");o.innerHTML=`
<h1>Shader Compilation Error in ${r}</h1><br /><br />
<code style="user-select:text;"><pre>
${i}
</pre></code>`,o.style.top="10px",o.style.left="10px",o.style.position="absolute",o.style.zIndex="9999",o.style.width="100%",o.style.textAlign="left",document.body.appendChild(o),document.getElementsByClassName("luma-compiler-log-error")[0]?.scrollIntoView(),o.onclick=()=>{const u=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(u)}}}function Mte(n){return X6(n.source)||n.id||nv(`unnamed ${n.stage}-shader`)}function X6(n,e="unnamed"){const r=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(n);return r?r[1]:e}class Kd extends Rt{static defaultProps={...Rt.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){t=Kd.normalizeProps(e,t),super(e,t,Kd.defaultProps)}static normalizeProps(e,t){const r=e?.props?._resourceDefaults?.sampler||{};return{...t,...r}}}class sv extends Rt{static defaultProps={...Rt.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null};get[Symbol.toStringTag](){return"Framebuffer"}width;height;constructor(e,t={}){super(e,t,sv.defaultProps),this.width=this.props.width,this.height=this.props.height}clone(e){const t=this.colorAttachments.map(i=>i.texture.clone(e)),r=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(e);return this.device.createFramebuffer({...this.props,colorAttachments:t,depthStencilAttachment:r})}resize(e){let t=!e;if(e){const[r,i]=Array.isArray(e)?e:[e.width,e.height];t=t||i!==this.height||r!==this.width,this.width=r,this.height=i}t&&(we.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((t,r)=>{if(typeof t=="string"){const i=this.createColorTexture(t,r);return this.attachResource(i),i.view}return t instanceof St?t.view:t});const e=this.props.depthStencilAttachment;if(e)if(typeof e=="string"){const t=this.createDepthStencilTexture(e);this.attachResource(t),this.depthStencilAttachment=t.view}else e instanceof St?this.depthStencilAttachment=e.view:this.depthStencilAttachment=e}createColorTexture(e,t){return this.device.createTexture({id:`${this.id}-color-attachment-${t}`,usage:St.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(e){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:St.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(e,t){for(let r=0;r<this.colorAttachments.length;++r)if(this.colorAttachments[r]){const i=this.colorAttachments[r].texture.clone({width:e,height:t});this.destroyAttachedResource(this.colorAttachments[r]),this.colorAttachments[r]=i.view,this.attachResource(i.view)}if(this.depthStencilAttachment){const r=this.depthStencilAttachment.texture.clone({width:e,height:t});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=r.view,this.attachResource(r)}this.updateAttachments()}}class rh extends Rt{static defaultProps={...Rt.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}};get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(e,t){super(e,t,rh.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}setUniformsWebGL(e){throw new Error("Use uniform blocks")}}class Ml extends Rt{static defaultClearColor=[0,0,0,1];static defaultClearDepth=1;static defaultClearStencil=0;static defaultProps={...Rt.defaultProps,framebuffer:null,parameters:void 0,clearColor:Ml.defaultClearColor,clearColors:void 0,clearDepth:Ml.defaultClearDepth,clearStencil:Ml.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0};get[Symbol.toStringTag](){return"RenderPass"}constructor(e,t){t=Ml.normalizeProps(e,t),super(e,t,Ml.defaultProps)}static normalizeProps(e,t){return{...e.props._resourceDefaults?.renderPass,...t}}}class s_ extends Rt{static defaultProps={...Rt.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0};get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(e,t){super(e,t,s_.defaultProps),this.shaderLayout=t.shaderLayout}}class w1 extends Rt{static defaultProps={...Rt.defaultProps,measureExecutionTime:void 0};get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,t){super(e,t,w1.defaultProps)}}class x1 extends Rt{static defaultProps={...Rt.defaultProps};get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,t){super(e,t,x1.defaultProps)}}function Ote(n){const[e,t]=Nte[n],r=e==="i32"||e==="u32",i=e!=="u32",s=Dte[e]*t,o=kte(e,t);return{dataType:e,components:t,defaultVertexFormat:o,byteLength:s,integer:r,signed:i}}function kte(n,e){let t;switch(n){case"f32":t="float32";break;case"i32":t="sint32";break;case"u32":t="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?t:`${t}x${e}`}const Nte={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},Dte={f32:4,f16:2,i32:4,u32:4};function Y6(n){let e;n.endsWith("-webgl")&&(n.replace("-webgl",""),e=!0);const[t,r]=n.split("x"),i=t,s=r?parseInt(r):1,o=H6(i),a={type:i,components:s,byteLength:o.byteLength*s,integer:o.integer,signed:o.signed,normalized:o.normalized};return e&&(a.webglOnly=!0),a}function K6(n,e){const t={};for(const r of n.attributes){const i=Ute(n,e,r.name);i&&(t[r.name]=i)}return t}function Lte(n,e,t=16){const r=K6(n,e),i=new Array(t).fill(null);for(const s of Object.values(r))i[s.location]=s;return i}function Ute(n,e,t){const r=Vte(n,t),i=Fte(e,t);if(!r)return null;const s=Ote(r.type),o=i?.vertexFormat||s.defaultVertexFormat,a=Y6(o);return{attributeName:i?.attributeName||r.name,bufferName:i?.bufferName||r.name,location:r.location,shaderType:r.type,shaderDataType:s.dataType,shaderComponents:s.components,vertexFormat:o,bufferDataType:a.type,bufferComponents:a.components,normalized:a.normalized,integer:s.integer,stepMode:i?.stepMode||r.stepMode||"vertex",byteOffset:i?.byteOffset||0,byteStride:i?.byteStride||0}}function Vte(n,e){const t=n.attributes.find(r=>r.name===e);return t||we.warn(`shader layout attribute "${e}" not present in shader`),t||null}function Fte(n,e){Bte(n);let t=zte(n,e);return t||(t=jte(n,e),t)?t:(we.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function Bte(n){for(const e of n)(e.attributes&&e.format||!e.attributes&&!e.format)&&we.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function zte(n,e){for(const t of n)if(t.format&&t.name===e)return{attributeName:t.name,bufferName:e,stepMode:t.stepMode,vertexFormat:t.format,byteOffset:0,byteStride:t.byteStride||0};return null}function jte(n,e){for(const t of n){let r=t.byteStride;if(typeof t.byteStride!="number")for(const s of t.attributes||[]){const o=Y6(s.format);r+=o.byteLength}const i=t.attributes?.find(s=>s.attribute===e);if(i)return{attributeName:i.attribute,bufferName:t.name,stepMode:t.stepMode,vertexFormat:i.format,byteOffset:i.byteOffset,byteStride:r}}return null}class E1 extends Rt{static defaultProps={...Rt.defaultProps,renderPipeline:null};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(e,t){super(e,t,E1.defaultProps),this.maxVertexAttributes=e.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:r,bufferLayout:i}=t.renderPipeline||{};if(!r||!i)throw new Error("VertexArray");this.attributeInfos=Lte(r,i,this.maxVertexAttributes)}setConstantWebGL(e,t){this.device.reportError(new Error("constant attributes not supported"))}}class A1 extends Rt{static defaultProps={...Rt.defaultProps,layout:void 0,buffers:{}};get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,t){super(e,t,A1.defaultProps)}}class S1 extends Rt{static defaultProps={...Rt.defaultProps,type:void 0,count:void 0};get[Symbol.toStringTag](){return"QuerySet"}constructor(e,t){super(e,t,S1.defaultProps)}}const Hte={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function $te(n){return Hte[n]}function Wte(n,e){switch(e){case 1:return n;case 2:return n+n%2;default:return n+(4-n%4)%4}}let _m;function G6(n){return(!_m||_m.byteLength<n)&&(_m=new ArrayBuffer(n)),_m}function qte(n,e){const t=G6(n.BYTES_PER_ELEMENT*e);return new n(t,0,e)}function Xte(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function o_(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":Xte(n)}const uP=1024;class Yte{layout={};byteLength;constructor(e){let t=0;for(const[i,s]of Object.entries(e)){const o=$te(s),{type:a,components:u}=o;t=Wte(t,u);const h=t;t+=u,this.layout[i]={type:a,size:u,offset:h}}t+=(4-t%4)%4;const r=t*4;this.byteLength=Math.max(r,uP)}getData(e){const t=Math.max(this.byteLength,uP),r=G6(t),i={i32:new Int32Array(r),u32:new Uint32Array(r),f32:new Float32Array(r),f16:new Uint16Array(r)};for(const[s,o]of Object.entries(e)){const a=this.layout[s];if(!a){we.warn(`Supplied uniform value ${s} not present in uniform block layout`)();continue}const{type:u,size:h,offset:d}=a,g=i[u];if(h===1){if(typeof o!="number"&&typeof o!="boolean"){we.warn(`Supplied value for single component uniform ${s} is not a number: ${o}`)();continue}g[d]=Number(o)}else{if(!o_(o)){we.warn(`Supplied value for multi component / array uniform ${s} is not a numeric array: ${o}`)();continue}g.set(o,d)}}return new Uint8Array(r)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function Kte(n,e,t=16){if(n!==e)return!1;const r=n,i=e;if(!o_(r))return!1;if(o_(i)&&r.length===i.length){for(let s=0;s<r.length;++s)if(i[s]!==r[s])return!1}return!0}function Gte(n){return o_(n)?n.slice():n}class Zte{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(e){if(this.name=e?.name||"unnamed",e?.name&&e?.shaderLayout){const t=e?.shaderLayout.bindings?.find(i=>i.type==="uniform"&&i.name===e?.name);if(!t)throw new Error(e?.name);const r=t;for(const i of r.uniforms||[])this.bindingLayout[i.name]=i}}setUniforms(e){for(const[t,r]of Object.entries(e))this._setUniform(t,r),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${r}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){Kte(this.uniforms[e],t)||(this.uniforms[e]=Gte(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}class Qte{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(e){for(const[t,r]of Object.entries(e)){const i=t,s=new Yte(r.uniformTypes||{});this.uniformBufferLayouts.set(i,s);const o=new Zte({name:t});o.setUniforms(r.defaultUniforms||{}),this.uniformBlocks.set(i,o)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[t,r]of Object.entries(e))this.uniformBlocks.get(t)?.setUniforms(r);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e)?.byteLength||0}getUniformBufferData(e){const t=this.uniformBlocks.get(e)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(e)?.getData(t)}createUniformBuffer(e,t,r){r&&this.setUniforms(r);const i=this.getUniformBufferByteLength(t),s=e.createBuffer({usage:zt.UNIFORM|zt.COPY_DST,byteLength:i}),o=this.getUniformBufferData(t);return s.write(o),s}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const r=this.getUniformBufferByteLength(t),i=e.createBuffer({usage:zt.UNIFORM|zt.COPY_DST,byteLength:r});this.uniformBuffers.set(t,i)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const r=this.updateUniformBuffer(t);e||=r}return e&&we.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const t=this.uniformBlocks.get(e);let r=this.uniformBuffers.get(e),i=!1;if(r&&t?.needsRedraw){i||=t.needsRedraw;const s=this.getUniformBufferData(e);r=this.uniformBuffers.get(e),r?.write(s);const o=this.uniformBlocks.get(e)?.getAllUniforms();we.log(4,`Writing to uniform buffer ${String(e)}`,s,o)()}return i}}function Z6(n){const e=ArrayBuffer.isView(n)?n.constructor:n;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function Q6(n){switch(n){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(n)}}function Jte(n,e,t){if(!e||e>4)throw new Error(`size ${e}`);const r=e;let i=Z6(n);if(i==="uint8"&&t&&r===1)return"unorm8-webgl";if(i==="uint8"&&t&&r===3)return"unorm8x3-webgl";if(i==="uint8"||i==="sint8"){if(r===1||r===3)throw new Error(`size: ${e}`);return t&&(i=i.replace("int","norm")),`${i}x${r}`}if(i==="uint16"||i==="sint16"){if(r===1||r===3)throw new Error(`size: ${e}`);return t&&(i=i.replace("int","norm")),`${i}x${r}`}return r===1?i:`${i}x${r}`}class uT{bufferLayouts;constructor(e){this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){return e.attributes?e.attributes?.map(t=>t.attribute):[e.name]}mergeBufferLayouts(e,t){const r=[...e];for(const i of t){const s=r.findIndex(o=>o.name===i.name);s<0?r.push(i):r[s]=i}return r}getBufferIndex(e){const t=this.bufferLayouts.findIndex(r=>r.name===e);return t===-1&&we.warn(`BufferLayout: Missing buffer for "${e}".`)(),t}}function ene(n,e){const t=Object.fromEntries(n.attributes.map(i=>[i.name,i.location])),r=e.slice();return r.sort((i,s)=>{const o=i.attributes?i.attributes.map(d=>d.attribute):[i.name],a=s.attributes?s.attributes.map(d=>d.attribute):[s.name],u=Math.min(...o.map(d=>t[d])),h=Math.min(...a.map(d=>t[d]));return u-h}),r}class ri{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class hP{constructor(e,t,r){this.name=e,this.type=t,this.attributes=r,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class pa extends ri{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Aa extends ri{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class qw extends ri{constructor(e,t,r){super(e,r),this.format=t}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class Jl extends ri{constructor(e,t,r,i){super(e,r),this.format=t,this.access=i}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}var aa;(n=>{n[n.Uniform=0]="Uniform",n[n.Storage=1]="Storage",n[n.Texture=2]="Texture",n[n.Sampler=3]="Sampler",n[n.StorageTexture=4]="StorageTexture"})(aa||(aa={}));class vm{constructor(e,t,r,i,s,o,a){this.name=e,this.type=t,this.group=r,this.binding=i,this.attributes=s,this.resourceType=o,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class tne{constructor(e,t){this.name=e,this.type=t}}class nne{constructor(e,t,r,i){this.name=e,this.type=t,this.locationType=r,this.location=i,this.interpolation=null}}class fP{constructor(e,t,r,i){this.name=e,this.type=t,this.locationType=r,this.location=i}}class rne{constructor(e,t,r,i){this.name=e,this.type=t,this.attributes=r,this.id=i}}class ine{constructor(e,t,r){this.name=e,this.type=t,this.attributes=r}}class sne{constructor(e,t=null,r){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=r}}class one{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}function ane(n){var e=(32768&n)>>15,t=(31744&n)>>10,r=1023&n;return t==0?(e?-1:1)*Math.pow(2,-14)*(r/Math.pow(2,10)):t==31?r?NaN:1/0*(e?-1:1):(e?-1:1)*Math.pow(2,t-15)*(1+r/Math.pow(2,10))}const J6=new Float32Array(1),lne=new Int32Array(J6.buffer),Gn=new Uint16Array(1);function cne(n){J6[0]=n;const e=lne[0],t=e>>31&1;let r=e>>23&255,i=8388607&e;if(r===255)return Gn[0]=t<<15|31744|(i!==0?512:0),Gn[0];if(r===0){if(i===0)return Gn[0]=t<<15,Gn[0];i|=8388608;let s=113;for(;!(8388608&i);)i<<=1,s--;return r=127-s,i&=8388607,r>0?(i=(i>>126-r)+(i>>127-r&1),Gn[0]=t<<15|r<<10|i>>13,Gn[0]):(Gn[0]=t<<15,Gn[0])}return r=r-127+15,r>=31?(Gn[0]=t<<15|31744,Gn[0]):r<=0?r<-10?(Gn[0]=t<<15,Gn[0]):(i=(8388608|i)>>1-r,Gn[0]=t<<15|i>>13,Gn[0]):(i>>=13,Gn[0]=t<<15|r<<10|i,Gn[0])}const R1=new Uint32Array(1),eU=new Float32Array(R1.buffer,0,1);function dP(n){const e=112+(n>>6&31)<<23|(63&n)<<17;return R1[0]=e,eU[0]}function une(n,e,t,r,i,s,o,a,u){const h=r*(o>>=i)*(s>>=i)+t*o+e*a;switch(u){case"r8unorm":return[pt(n,h,"8unorm",1)[0]];case"r8snorm":return[pt(n,h,"8snorm",1)[0]];case"r8uint":return[pt(n,h,"8uint",1)[0]];case"r8sint":return[pt(n,h,"8sint",1)[0]];case"rg8unorm":{const d=pt(n,h,"8unorm",2);return[d[0],d[1]]}case"rg8snorm":{const d=pt(n,h,"8snorm",2);return[d[0],d[1]]}case"rg8uint":{const d=pt(n,h,"8uint",2);return[d[0],d[1]]}case"rg8sint":{const d=pt(n,h,"8sint",2);return[d[0],d[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const d=pt(n,h,"8unorm",4);return[d[0],d[1],d[2],d[3]]}case"rgba8snorm":{const d=pt(n,h,"8snorm",4);return[d[0],d[1],d[2],d[3]]}case"rgba8uint":{const d=pt(n,h,"8uint",4);return[d[0],d[1],d[2],d[3]]}case"rgba8sint":{const d=pt(n,h,"8sint",4);return[d[0],d[1],d[2],d[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const d=pt(n,h,"8unorm",4);return[d[2],d[1],d[0],d[3]]}case"r16uint":return[pt(n,h,"16uint",1)[0]];case"r16sint":return[pt(n,h,"16sint",1)[0]];case"r16float":return[pt(n,h,"16float",1)[0]];case"rg16uint":{const d=pt(n,h,"16uint",2);return[d[0],d[1]]}case"rg16sint":{const d=pt(n,h,"16sint",2);return[d[0],d[1]]}case"rg16float":{const d=pt(n,h,"16float",2);return[d[0],d[1]]}case"rgba16uint":{const d=pt(n,h,"16uint",4);return[d[0],d[1],d[2],d[3]]}case"rgba16sint":{const d=pt(n,h,"16sint",4);return[d[0],d[1],d[2],d[3]]}case"rgba16float":{const d=pt(n,h,"16float",4);return[d[0],d[1],d[2],d[3]]}case"r32uint":return[pt(n,h,"32uint",1)[0]];case"r32sint":return[pt(n,h,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[pt(n,h,"32float",1)[0]];case"rg32uint":{const d=pt(n,h,"32uint",2);return[d[0],d[1]]}case"rg32sint":{const d=pt(n,h,"32sint",2);return[d[0],d[1]]}case"rg32float":{const d=pt(n,h,"32float",2);return[d[0],d[1]]}case"rgba32uint":{const d=pt(n,h,"32uint",4);return[d[0],d[1],d[2],d[3]]}case"rgba32sint":{const d=pt(n,h,"32sint",4);return[d[0],d[1],d[2],d[3]]}case"rgba32float":{const d=pt(n,h,"32float",4);return[d[0],d[1],d[2],d[3]]}case"rg11b10ufloat":{const d=new Uint32Array(n.buffer,h,1)[0],g=(4192256&d)>>11,y=(4290772992&d)>>22;return[dP(2047&d),dP(g),(function(v){const T=112+(v>>5&31)<<23|(31&v)<<18;return R1[0]=T,eU[0]})(y),1]}}return null}function pt(n,e,t,r){const i=[0,0,0,0];for(let s=0;s<r;++s)switch(t){case"8unorm":i[s]=n[e]/255,e++;break;case"8snorm":i[s]=n[e]/255*2-1,e++;break;case"8uint":i[s]=n[e],e++;break;case"8sint":i[s]=n[e]-127,e++;break;case"16uint":i[s]=n[e]|n[e+1]<<8,e+=2;break;case"16sint":i[s]=(n[e]|n[e+1]<<8)-32768,e+=2;break;case"16float":i[s]=ane(n[e]|n[e+1]<<8),e+=2;break;case"32uint":case"32sint":i[s]=n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24,e+=4;break;case"32float":i[s]=new Float32Array(n.buffer,e,1)[0],e+=4}return i}function gt(n,e,t,r,i){for(let s=0;s<r;++s)switch(t){case"8unorm":n[e]=255*i[s],e++;break;case"8snorm":n[e]=.5*(i[s]+1)*255,e++;break;case"8uint":n[e]=i[s],e++;break;case"8sint":n[e]=i[s]+127,e++;break;case"16uint":new Uint16Array(n.buffer,e,1)[0]=i[s],e+=2;break;case"16sint":new Int16Array(n.buffer,e,1)[0]=i[s],e+=2;break;case"16float":{const o=cne(i[s]);new Uint16Array(n.buffer,e,1)[0]=o,e+=2;break}case"32uint":new Uint32Array(n.buffer,e,1)[0]=i[s],e+=4;break;case"32sint":new Int32Array(n.buffer,e,1)[0]=i[s],e+=4;break;case"32float":new Float32Array(n.buffer,e,1)[0]=i[s],e+=4}return i}const hT={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class li{constructor(){this.id=li._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){t(a_.instance);for(const r of e)r instanceof Array?this.searchBlock(r,t):r.search(t);t(l_.instance)}}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}li._id=0;class a_ extends li{}a_.instance=new a_;class l_ extends li{}l_.instance=new l_;const tU=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class Lt extends li{constructor(){super()}}class Gd extends Lt{constructor(e,t,r,i,s,o){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=r,this.body=i,this.startLine=s,this.endLine=o}get astNodeType(){return"function"}search(e){if(this.attributes)for(const t of this.attributes)e(t);e(this);for(const t of this.args)e(t);this.searchBlock(this.body,e)}}class hne extends Lt{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class nU extends Lt{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class Xw extends Lt{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class rU extends Lt{constructor(e,t,r,i){super(),this.init=e,this.condition=t,this.increment=r,this.body=i}get astNodeType(){return"for"}search(e){var t,r,i;(t=this.init)===null||t===void 0||t.search(e),(r=this.condition)===null||r===void 0||r.search(e),(i=this.increment)===null||i===void 0||i.search(e),this.searchBlock(this.body,e)}}class $s extends Lt{constructor(e,t,r,i,s){super(),this.attributes=null,this.name=e,this.type=t,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"var"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class C1 extends Lt{constructor(e,t,r){super(),this.attributes=null,this.name=e,this.type=t,this.value=r}get astNodeType(){return"override"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class Td extends Lt{constructor(e,t,r,i,s){super(),this.attributes=null,this.name=e,this.type=t,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"let"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class ly extends Lt{constructor(e,t,r,i,s){super(),this.attributes=null,this.name=e,this.type=t,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}var bu,sd,oe,ee;(n=>{n.increment="++",n.decrement="--"})(bu||(bu={})),(n=>{n.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for IncrementOperator");return n[t]}})(bu||(bu={}));class iU extends Lt{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(n=>{n.assign="=",n.addAssign="+=",n.subtractAssin="-=",n.multiplyAssign="*=",n.divideAssign="/=",n.moduloAssign="%=",n.andAssign="&=",n.orAssign="|=",n.xorAssign="^=",n.shiftLeftAssign="<<=",n.shiftRightAssign=">>="})(sd||(sd={})),(n=>{n.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for AssignOperator");return t}})(sd||(sd={}));class sU extends Lt{constructor(e,t,r){super(),this.operator=e,this.variable=t,this.value=r}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class I1 extends Lt{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return tU.has(this.name)}search(e){for(const t of this.args)t.search(e);e(this)}}class oU extends Lt{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}search(e){var t;this.searchBlock(this.body,e),(t=this.continuing)===null||t===void 0||t.search(e)}}class aU extends Lt{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}search(e){e(this);for(const t of this.cases)t.search(e)}}class lU extends Lt{constructor(e,t,r,i){super(),this.condition=e,this.body=t,this.elseif=r,this.else=i}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class cU extends Lt{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class fne extends Lt{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class dne extends Lt{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class uU extends Lt{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class P1 extends Lt{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class pne extends Lt{constructor(){super()}get astNodeType(){return"discard"}}class hU extends Lt{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class fU extends Lt{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class _e extends Lt{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if(t.name==="f32")return t;for(let r=1;r<e.length;++r){const i=_e._priority.get(t.name);_e._priority.get(e[r].name)<i&&(t=e[r])}return t.name==="x32"?_e.i32:t}getTypeName(){return this.name}}_e.x32=new _e("x32"),_e.f32=new _e("f32"),_e.i32=new _e("i32"),_e.u32=new _e("u32"),_e.f16=new _e("f16"),_e.bool=new _e("bool"),_e.void=new _e("void"),_e._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class pP extends _e{constructor(e){super(e)}}class js extends _e{constructor(e,t,r,i){super(e),this.members=t,this.startLine=r,this.endLine=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}search(e){for(const t of this.members)e(t)}}class re extends _e{constructor(e,t,r){super(e),this.format=t,this.access=r}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}re.vec2f=new re("vec2",_e.f32,null),re.vec3f=new re("vec3",_e.f32,null),re.vec4f=new re("vec4",_e.f32,null),re.vec2i=new re("vec2",_e.i32,null),re.vec3i=new re("vec3",_e.i32,null),re.vec4i=new re("vec4",_e.i32,null),re.vec2u=new re("vec2",_e.u32,null),re.vec3u=new re("vec3",_e.u32,null),re.vec4u=new re("vec4",_e.u32,null),re.vec2h=new re("vec2",_e.f16,null),re.vec3h=new re("vec3",_e.f16,null),re.vec4h=new re("vec4",_e.f16,null),re.vec2b=new re("vec2",_e.bool,null),re.vec3b=new re("vec3",_e.bool,null),re.vec4b=new re("vec4",_e.bool,null),re.mat2x2f=new re("mat2x2",_e.f32,null),re.mat2x3f=new re("mat2x3",_e.f32,null),re.mat2x4f=new re("mat2x4",_e.f32,null),re.mat3x2f=new re("mat3x2",_e.f32,null),re.mat3x3f=new re("mat3x3",_e.f32,null),re.mat3x4f=new re("mat3x4",_e.f32,null),re.mat4x2f=new re("mat4x2",_e.f32,null),re.mat4x3f=new re("mat4x3",_e.f32,null),re.mat4x4f=new re("mat4x4",_e.f32,null),re.mat2x2h=new re("mat2x2",_e.f16,null),re.mat2x3h=new re("mat2x3",_e.f16,null),re.mat2x4h=new re("mat2x4",_e.f16,null),re.mat3x2h=new re("mat3x2",_e.f16,null),re.mat3x3h=new re("mat3x3",_e.f16,null),re.mat3x4h=new re("mat3x4",_e.f16,null),re.mat4x2h=new re("mat4x2",_e.f16,null),re.mat4x3h=new re("mat4x3",_e.f16,null),re.mat4x4h=new re("mat4x4",_e.f16,null),re.mat2x2i=new re("mat2x2",_e.i32,null),re.mat2x3i=new re("mat2x3",_e.i32,null),re.mat2x4i=new re("mat2x4",_e.i32,null),re.mat3x2i=new re("mat3x2",_e.i32,null),re.mat3x3i=new re("mat3x3",_e.i32,null),re.mat3x4i=new re("mat3x4",_e.i32,null),re.mat4x2i=new re("mat4x2",_e.i32,null),re.mat4x3i=new re("mat4x3",_e.i32,null),re.mat4x4i=new re("mat4x4",_e.i32,null),re.mat2x2u=new re("mat2x2",_e.u32,null),re.mat2x3u=new re("mat2x3",_e.u32,null),re.mat2x4u=new re("mat2x4",_e.u32,null),re.mat3x2u=new re("mat3x2",_e.u32,null),re.mat3x3u=new re("mat3x3",_e.u32,null),re.mat3x4u=new re("mat3x4",_e.u32,null),re.mat4x2u=new re("mat4x2",_e.u32,null),re.mat4x3u=new re("mat4x3",_e.u32,null),re.mat4x4u=new re("mat4x4",_e.u32,null);class cy extends _e{constructor(e,t,r,i){super(e),this.storage=t,this.type=r,this.access=i}get astNodeType(){return"pointer"}}class wd extends _e{constructor(e,t,r,i){super(e),this.attributes=t,this.format=r,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}}class od extends _e{constructor(e,t,r){super(e),this.format=t,this.access=r}get astNodeType(){return"sampler"}}class Oi extends li{constructor(){super(),this.postfix=null}}class ec extends Oi{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class Zi extends Oi{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class M1 extends Oi{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return tU.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}}class Dr extends Oi{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class dU extends Oi{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const r=e.evalExpression(this.initializer,e.context);return r!==null&&this.postfix?r.getSubData(e,this.postfix,e.context):r}return null}search(e){this.initializer.search(e)}}class _n extends Oi{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return t!==void 0&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof J}get isVector(){return this.value instanceof X||this.value instanceof Be}get scalarValue(){return this.value instanceof J?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof X||this.value instanceof Be?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class pU extends Oi{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class ih extends Oi{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class gU extends Oi{constructor(){super()}}class ln extends gU{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class bi extends gU{constructor(e,t,r){super(),this.operator=e,this.left=t,this.right=r}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:e.name==="f32"||t.name==="f32"?_e.f32:e.name==="u32"||t.name==="u32"?_e.u32:_e.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class mU extends li{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class uy extends Oi{constructor(){super()}get astNodeType(){return"default"}}class yU extends mU{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class _U extends mU{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class gP extends li{constructor(e,t,r){super(),this.name=e,this.type=t,this.attributes=r}get astNodeType(){return"argument"}}class gne extends li{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class mP extends li{constructor(e,t,r){super(),this.name=e,this.type=t,this.attributes=r}get astNodeType(){return"member"}}class vU extends li{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class ai{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=ai._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,r,i){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,t,r){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}ai._id=0;class Yw extends ai{constructor(){super(new ri("void",null),null)}toString(){return"void"}}Yw.void=new Yw;class cu extends ai{constructor(e){super(new qw("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,t,r,i){this.reference.setDataValue(e,t,r,i)}getSubData(e,t,r){return t?this.reference.getSubData(e,t,r):this}toString(){return`&${this.reference.toString()}`}}class J extends ai{constructor(e,t,r=null){super(t,r),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!==0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",t)}clone(){if(this.data instanceof Float32Array)return new J(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new J(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new J(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,r,i){if(r)return void console.error("SetDataValue: Scalar data does not support postfix",r);if(!(t instanceof J))return void console.error("SetDataValue: Invalid value",t);let s=t.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?s=Math.floor(s):this.typeInfo.name==="bool"&&(s=s?1:0),this.data[0]=s}getSubData(e,t,r){return t?(console.error("getSubData: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}}function mne(n,e,t){const r=e.length;return r===2?t==="f32"?new X(new Float32Array(e),n.getTypeInfo("vec2f")):t==="i32"||t==="bool"?new X(new Int32Array(e),n.getTypeInfo("vec2i")):t==="u32"?new X(new Uint32Array(e),n.getTypeInfo("vec2u")):t==="f16"?new X(new Float32Array(e),n.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${t}`),null):r===3?t==="f32"?new X(new Float32Array(e),n.getTypeInfo("vec3f")):t==="i32"||t==="bool"?new X(new Int32Array(e),n.getTypeInfo("vec3i")):t==="u32"?new X(new Uint32Array(e),n.getTypeInfo("vec3u")):t==="f16"?new X(new Float32Array(e),n.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${t}`),null):r===4?t==="f32"?new X(new Float32Array(e),n.getTypeInfo("vec4f")):t==="i32"||t==="bool"?new X(new Int32Array(e),n.getTypeInfo("vec4i")):t==="u32"?new X(new Uint32Array(e),n.getTypeInfo("vec4u")):t==="f16"?new X(new Float32Array(e),n.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${t}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class X extends ai{constructor(e,t,r=null){if(super(t,r),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const i=this.typeInfo.name;i==="vec2f"||i==="vec3f"||i==="vec4f"?this.data=new Float32Array(e):i==="vec2i"||i==="vec3i"||i==="vec4i"?this.data=new Int32Array(e):i==="vec2u"||i==="vec3u"||i==="vec4u"?this.data=new Uint32Array(e):i==="vec2h"||i==="vec3h"||i==="vec4h"?this.data=new Float32Array(e):i==="vec2b"||i==="vec3b"||i==="vec4b"?this.data=new Int32Array(e):i==="vec2"||i==="vec3"||i==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${i}`)}}clone(){if(this.data instanceof Float32Array)return new X(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new X(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new X(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,r,i){r instanceof ec?console.error("TODO: Set vector postfix"):t instanceof X?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,r){if(t===null)return this;let i=e.getTypeInfo("f32");if(this.typeInfo instanceof Jl)i=this.typeInfo.format||i;else{const o=this.typeInfo.name;o==="vec2f"||o==="vec3f"||o==="vec4f"?i=e.getTypeInfo("f32"):o==="vec2i"||o==="vec3i"||o==="vec4i"?i=e.getTypeInfo("i32"):o==="vec2b"||o==="vec3b"||o==="vec4b"?i=e.getTypeInfo("bool"):o==="vec2u"||o==="vec3u"||o==="vec4u"?i=e.getTypeInfo("u32"):o==="vec2h"||o==="vec3h"||o==="vec4h"?i=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${o}`)}let s=this;for(;t!==null&&s!==null;){if(t instanceof ih){const o=t.index;let a=-1;if(o instanceof _n){if(!(o.value instanceof J))return console.error(`GetSubData: Invalid array index ${o.value}`),null;a=o.value.value}else{const u=e.evalExpression(o,r);if(!(u instanceof J))return console.error("GetSubData: Unknown index type",o),null;a=u.value}if(a<0||a>=s.data.length)return console.error("GetSubData: Index out of range",a),null;if(s.data instanceof Float32Array){const u=new Float32Array(s.data.buffer,s.data.byteOffset+4*a,1);return new J(u,i)}if(s.data instanceof Int32Array){const u=new Int32Array(s.data.buffer,s.data.byteOffset+4*a,1);return new J(u,i)}if(s.data instanceof Uint32Array){const u=new Uint32Array(s.data.buffer,s.data.byteOffset+4*a,1);return new J(u,i)}throw"GetSubData: Invalid data type"}if(!(t instanceof ec))return console.error("GetSubData: Unknown postfix",t),null;{const o=t.value.toLowerCase();if(o.length===1){let u=0;if(o==="x"||o==="r")u=0;else if(o==="y"||o==="g")u=1;else if(o==="z"||o==="b")u=2;else{if(o!=="w"&&o!=="a")return console.error(`GetSubData: Unknown member ${o}`),null;u=3}if(this.data instanceof Float32Array){let h=new Float32Array(this.data.buffer,this.data.byteOffset+4*u,1);return new J(h,i,this)}if(this.data instanceof Int32Array){let h=new Int32Array(this.data.buffer,this.data.byteOffset+4*u,1);return new J(h,i,this)}if(this.data instanceof Uint32Array){let h=new Uint32Array(this.data.buffer,this.data.byteOffset+4*u,1);return new J(h,i,this)}}const a=[];for(const u of o)u==="x"||u==="r"?a.push(this.data[0]):u==="y"||u==="g"?a.push(this.data[1]):u==="z"||u==="b"?a.push(this.data[2]):u==="w"||u==="a"?a.push(this.data[3]):console.error(`GetDataValue: Unknown member ${u}`);s=mne(e,a,i.name)}t=t.postfix}return s}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class Be extends ai{constructor(e,t,r=null){super(t,r),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new Be(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,r,i){r instanceof ec?console.error("TODO: Set matrix postfix"):t instanceof Be?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,r){if(t===null)return this;const i=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof Jl)this.typeInfo.format;else if(i.endsWith("f"))e.getTypeInfo("f32");else if(i.endsWith("i"))e.getTypeInfo("i32");else if(i.endsWith("u"))e.getTypeInfo("u32");else{if(!i.endsWith("h"))return console.error(`GetDataValue: Unknown type ${i}`),null;e.getTypeInfo("f16")}if(t instanceof ih){const s=t.index;let o=-1;if(s instanceof _n){if(!(s.value instanceof J))return console.error(`GetDataValue: Invalid array index ${s.value}`),null;o=s.value.value}else{const h=e.evalExpression(s,r);if(!(h instanceof J))return console.error("GetDataValue: Unknown index type",s),null;o=h.value}if(o<0||o>=this.data.length)return console.error("GetDataValue: Index out of range",o),null;const a=i.endsWith("h")?"h":"f";let u;if(i==="mat2x2"||i==="mat2x2f"||i==="mat2x2h"||i==="mat3x2"||i==="mat3x2f"||i==="mat3x2h"||i==="mat4x2"||i==="mat4x2f"||i==="mat4x2h")u=new X(new Float32Array(this.data.buffer,this.data.byteOffset+2*o*4,2),e.getTypeInfo(`vec2${a}`));else if(i==="mat2x3"||i==="mat2x3f"||i==="mat2x3h"||i==="mat3x3"||i==="mat3x3f"||i==="mat3x3h"||i==="mat4x3"||i==="mat4x3f"||i==="mat4x3h")u=new X(new Float32Array(this.data.buffer,this.data.byteOffset+3*o*4,3),e.getTypeInfo(`vec3${a}`));else{if(i!=="mat2x4"&&i!=="mat2x4f"&&i!=="mat2x4h"&&i!=="mat3x4"&&i!=="mat3x4f"&&i!=="mat3x4h"&&i!=="mat4x4"&&i!=="mat4x4f"&&i!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${i}`),null;u=new X(new Float32Array(this.data.buffer,this.data.byteOffset+4*o*4,4),e.getTypeInfo(`vec4${a}`))}return t.postfix?u.getSubData(e,t.postfix,r):u}return console.error("GetDataValue: Invalid postfix",t),null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class Xt extends ai{constructor(e,t,r=0,i=null){super(t,i),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=r}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new Xt(e.buffer,this.typeInfo,0,null)}setDataValue(e,t,r,i){if(t===null)return void console.log("setDataValue: NULL data.");let s=this.offset,o=this.typeInfo;for(;r;){if(r instanceof ih)if(o instanceof Aa){const a=r.index;if(a instanceof _n){if(!(a.value instanceof J))return void console.error(`SetDataValue: Invalid index type ${a.value}`);s+=a.value.value*o.stride}else{const u=e.evalExpression(a,i);if(!(u instanceof J))return void console.error("SetDataValue: Unknown index type",a);s+=u.value*o.stride}o=o.format}else console.error(`SetDataValue: Type ${o.getTypeName()} is not an array`);else{if(!(r instanceof ec))return void console.error("SetDataValue: Unknown postfix type",r);{const a=r.value;if(o instanceof pa){let u=!1;for(const h of o.members)if(h.name===a){s+=h.offset,o=h.type,u=!0;break}if(!u)return void console.error(`SetDataValue: Member ${a} not found`)}else if(o instanceof ri){const u=o.getTypeName();let h=0;if(a==="x"||a==="r")h=0;else if(a==="y"||a==="g")h=1;else if(a==="z"||a==="b")h=2;else{if(a!=="w"&&a!=="a")return void console.error(`SetDataValue: Unknown member ${a}`);h=3}if(!(t instanceof J))return void console.error("SetDataValue: Invalid value",t);const d=t.value;return u==="vec2f"?void(new Float32Array(this.buffer,s,2)[h]=d):u==="vec3f"?void(new Float32Array(this.buffer,s,3)[h]=d):u==="vec4f"?void(new Float32Array(this.buffer,s,4)[h]=d):u==="vec2i"?void(new Int32Array(this.buffer,s,2)[h]=d):u==="vec3i"?void(new Int32Array(this.buffer,s,3)[h]=d):u==="vec4i"?void(new Int32Array(this.buffer,s,4)[h]=d):u==="vec2u"?void(new Uint32Array(this.buffer,s,2)[h]=d):u==="vec3u"?void(new Uint32Array(this.buffer,s,3)[h]=d):u==="vec4u"?void(new Uint32Array(this.buffer,s,4)[h]=d):void console.error(`SetDataValue: Type ${u} is not a struct`)}}}r=r.postfix}this.setData(e,t,o,s,i)}setData(e,t,r,i,s){const o=r.getTypeName();if(o!=="f32"&&o!=="f16")if(o!=="i32"&&o!=="atomic<i32>"&&o!=="x32")if(o!=="u32"&&o!=="atomic<u32>")if(o!=="bool"){if(o==="vec2f"||o==="vec2h"){const a=new Float32Array(this.buffer,i,2);return void(t instanceof X?(a[0]=t.data[0],a[1]=t.data[1]):(a[0]=t[0],a[1]=t[1]))}if(o==="vec3f"||o==="vec3h"){const a=new Float32Array(this.buffer,i,3);return void(t instanceof X?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2]))}if(o==="vec4f"||o==="vec4h"){const a=new Float32Array(this.buffer,i,4);return void(t instanceof X?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3]))}if(o==="vec2i"){const a=new Int32Array(this.buffer,i,2);return void(t instanceof X?(a[0]=t.data[0],a[1]=t.data[1]):(a[0]=t[0],a[1]=t[1]))}if(o==="vec3i"){const a=new Int32Array(this.buffer,i,3);return void(t instanceof X?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2]))}if(o==="vec4i"){const a=new Int32Array(this.buffer,i,4);return void(t instanceof X?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3]))}if(o==="vec2u"){const a=new Uint32Array(this.buffer,i,2);return void(t instanceof X?(a[0]=t.data[0],a[1]=t.data[1]):(a[0]=t[0],a[1]=t[1]))}if(o==="vec3u"){const a=new Uint32Array(this.buffer,i,3);return void(t instanceof X?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2]))}if(o==="vec4u"){const a=new Uint32Array(this.buffer,i,4);return void(t instanceof X?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3]))}if(o==="vec2b"){const a=new Uint32Array(this.buffer,i,2);return void(t instanceof X?(a[0]=t.data[0],a[1]=t.data[1]):(a[0]=t[0],a[1]=t[1]))}if(o==="vec3b"){const a=new Uint32Array(this.buffer,i,3);return void(t instanceof X?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2]))}if(o==="vec4b"){const a=new Uint32Array(this.buffer,i,4);return void(t instanceof X?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3]))}if(o==="mat2x2f"||o==="mat2x2h"){const a=new Float32Array(this.buffer,i,4);return void(t instanceof Be?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3]))}if(o==="mat2x3f"||o==="mat2x3h"){const a=new Float32Array(this.buffer,i,6);return void(t instanceof Be?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5]))}if(o==="mat2x4f"||o==="mat2x4h"){const a=new Float32Array(this.buffer,i,8);return void(t instanceof Be?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7]))}if(o==="mat3x2f"||o==="mat3x2h"){const a=new Float32Array(this.buffer,i,6);return void(t instanceof Be?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5]))}if(o==="mat3x3f"||o==="mat3x3h"){const a=new Float32Array(this.buffer,i,9);return void(t instanceof Be?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7],a[8]=t.data[8]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8]))}if(o==="mat3x4f"||o==="mat3x4h"){const a=new Float32Array(this.buffer,i,12);return void(t instanceof Be?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7],a[8]=t.data[8],a[9]=t.data[9],a[10]=t.data[10],a[11]=t.data[11]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11]))}if(o==="mat4x2f"||o==="mat4x2h"){const a=new Float32Array(this.buffer,i,8);return void(t instanceof Be?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7]))}if(o==="mat4x3f"||o==="mat4x3h"){const a=new Float32Array(this.buffer,i,12);return void(t instanceof Be?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7],a[8]=t.data[8],a[9]=t.data[9],a[10]=t.data[10],a[11]=t.data[11]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11]))}if(o==="mat4x4f"||o==="mat4x4h"){const a=new Float32Array(this.buffer,i,16);return void(t instanceof Be?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7],a[8]=t.data[8],a[9]=t.data[9],a[10]=t.data[10],a[11]=t.data[11],a[12]=t.data[12],a[13]=t.data[13],a[14]=t.data[14],a[15]=t.data[15]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]))}if(t instanceof Xt){if(r===t.typeInfo)return void new Uint8Array(this.buffer,i,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",o,t.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${o}`)}else t instanceof J&&(new Int32Array(this.buffer,i,1)[0]=t.value);else t instanceof J&&(new Uint32Array(this.buffer,i,1)[0]=t.value);else t instanceof J&&(new Int32Array(this.buffer,i,1)[0]=t.value);else t instanceof J&&(new Float32Array(this.buffer,i,1)[0]=t.value)}getSubData(e,t,r){var i,s,o;if(t===null)return this;let a=this.offset,u=this.typeInfo;for(;t;){if(t instanceof ih){const d=t.index,g=d instanceof Oi?e.evalExpression(d,r):d;let y=0;if(g instanceof J?y=g.value:typeof g=="number"?y=g:console.error("GetDataValue: Invalid index type",d),u instanceof Aa)a+=y*u.stride,u=u.format;else{const v=u.getTypeName();v==="mat4x4"||v==="mat4x4f"||v==="mat4x4h"?(a+=16*y,u=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${u.getTypeName()} is not an array`)}}else{if(!(t instanceof ec))return console.error("GetDataValue: Unknown postfix type",t),null;{const d=t.value;if(u instanceof pa){let g=!1;for(const y of u.members)if(y.name===d){a+=y.offset,u=y.type,g=!0;break}if(!g)return console.error(`GetDataValue: Member ${d} not found`),null}else if(u instanceof ri){const g=u.getTypeName();if(g==="vec2f"||g==="vec3f"||g==="vec4f"||g==="vec2i"||g==="vec3i"||g==="vec4i"||g==="vec2u"||g==="vec3u"||g==="vec4u"||g==="vec2b"||g==="vec3b"||g==="vec4b"||g==="vec2h"||g==="vec3h"||g==="vec4h"||g==="vec2"||g==="vec3"||g==="vec4"){if(d.length>0&&d.length<5){let y="f";const v=[];for(let T=0;T<d.length;++T){const w=d[T].toLowerCase();let E=0;if(w==="x"||w==="r")E=0;else if(w==="y"||w==="g")E=1;else if(w==="z"||w==="b")E=2;else{if(w!=="w"&&w!=="a")return console.error(`Unknown member ${d}`),null;E=3}if(d.length===1){if(g.endsWith("f"))return this.buffer.byteLength<a+4*E+4?(console.log("Insufficient buffer data"),null):new J(new Float32Array(this.buffer,a+4*E,1),e.getTypeInfo("f32"),this);if(g.endsWith("h"))return new J(new Float32Array(this.buffer,a+4*E,1),e.getTypeInfo("f16"),this);if(g.endsWith("i"))return new J(new Int32Array(this.buffer,a+4*E,1),e.getTypeInfo("i32"),this);if(g.endsWith("b"))return new J(new Int32Array(this.buffer,a+4*E,1),e.getTypeInfo("bool"),this);if(g.endsWith("u"))return new J(new Uint32Array(this.buffer,a+4*E,1),e.getTypeInfo("i32"),this)}if(g==="vec2f")v.push(new Float32Array(this.buffer,a,2)[E]);else if(g==="vec3f"){if(a+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const S=new Float32Array(this.buffer,a,3);v.push(S[E])}else if(g==="vec4f")v.push(new Float32Array(this.buffer,a,4)[E]);else if(g==="vec2i")y="i",v.push(new Int32Array(this.buffer,a,2)[E]);else if(g==="vec3i")y="i",v.push(new Int32Array(this.buffer,a,3)[E]);else if(g==="vec4i")y="i",v.push(new Int32Array(this.buffer,a,4)[E]);else if(g==="vec2u"){y="u";const S=new Uint32Array(this.buffer,a,2);v.push(S[E])}else g==="vec3u"?(y="u",v.push(new Uint32Array(this.buffer,a,3)[E])):g==="vec4u"&&(y="u",v.push(new Uint32Array(this.buffer,a,4)[E]))}return v.length===2?u=e.getTypeInfo(`vec2${y}`):v.length===3?u=e.getTypeInfo(`vec3${y}`):v.length===4?u=e.getTypeInfo(`vec4${y}`):console.error(`GetDataValue: Invalid vector length ${v.length}`),new X(v,u,null)}return console.error(`GetDataValue: Unknown member ${d}`),null}return console.error(`GetDataValue: Type ${g} is not a struct`),null}}}t=t.postfix}const h=u.getTypeName();return h==="f32"?new J(new Float32Array(this.buffer,a,1),u,this):h==="i32"?new J(new Int32Array(this.buffer,a,1),u,this):h==="u32"?new J(new Uint32Array(this.buffer,a,1),u,this):h==="vec2f"?new X(new Float32Array(this.buffer,a,2),u,this):h==="vec3f"?new X(new Float32Array(this.buffer,a,3),u,this):h==="vec4f"?new X(new Float32Array(this.buffer,a,4),u,this):h==="vec2i"?new X(new Int32Array(this.buffer,a,2),u,this):h==="vec3i"?new X(new Int32Array(this.buffer,a,3),u,this):h==="vec4i"?new X(new Int32Array(this.buffer,a,4),u,this):h==="vec2u"?new X(new Uint32Array(this.buffer,a,2),u,this):h==="vec3u"?new X(new Uint32Array(this.buffer,a,3),u,this):h==="vec4u"?new X(new Uint32Array(this.buffer,a,4),u,this):u instanceof Jl&&u.name==="atomic"?((i=u.format)===null||i===void 0?void 0:i.name)==="u32"?new J(new Uint32Array(this.buffer,a,1)[0],u.format,this):((s=u.format)===null||s===void 0?void 0:s.name)==="i32"?new J(new Int32Array(this.buffer,a,1)[0],u.format,this):(console.error(`GetDataValue: Invalid atomic format ${(o=u.format)===null||o===void 0?void 0:o.name}`),null):new Xt(this.buffer,u,a,this)}toString(){let e="";if(this.typeInfo instanceof Aa)if(this.typeInfo.format.name==="f32"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let r=1;r<t.length;++r)e+=`, ${t[r]}`}else if(this.typeInfo.format.name==="i32"){const t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let r=1;r<t.length;++r)e+=`, ${t[r]}`}else if(this.typeInfo.format.name==="u32"){const t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let r=1;r<t.length;++r)e+=`, ${t[r]}`}else if(this.typeInfo.format.name==="vec2f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let r=1;r<t.length/2;++r)e+=`, [${t[2*r]}, ${t[2*r+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let r=4;r<t.length;r+=4)e+=`, [${t[r]}, ${t[r+1]}, ${t[r+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let r=4;r<t.length;r+=4)e+=`, [${t[r]}, ${t[r+1]}, ${t[r+2]}, ${t[r+3]}]`}else e="[...]";else this.typeInfo instanceof pa?e+="{...}":e="[...]";return e}}class Hs extends ai{constructor(e,t,r,i){super(t,null),this.data=e,this.descriptor=r,this.view=i}clone(){return new Hs(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;const r=this.descriptor.size;return r instanceof Array&&r.length>0?(e=r[0])!==null&&e!==void 0?e:0:r instanceof Object&&(t=r.width)!==null&&t!==void 0?t:0}get height(){var e,t;const r=this.descriptor.size;return r instanceof Array&&r.length>1?(e=r[1])!==null&&e!==void 0?e:0:r instanceof Object&&(t=r.height)!==null&&t!==void 0?t:0}get depthOrArrayLayers(){var e,t;const r=this.descriptor.size;return r instanceof Array&&r.length>2?(e=r[2])!==null&&e!==void 0?e:0:r instanceof Object&&(t=r.depthOrArrayLayers)!==null&&t!==void 0?t:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const t=[this.width,this.height,this.depthOrArrayLayers];for(let r=0;r<t.length;++r)t[r]=Math.max(1,t[r]>>e);return t}get texelByteSize(){const e=this.format,t=hT[e];return t?t.isDepthStencil?4:t.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,t=hT[e];return!!t&&t.isDepthStencil}getGpuSize(){const e=this.format,t=hT[e],r=this.width;if(!e||r<=0||!t)return-1;const i=this.height,s=this.depthOrArrayLayers,o=this.dimension;return r/t.blockWidth*(o==="1d"?1:i/t.blockHeight)*t.bytesPerBlock*s}getPixel(e,t,r=0,i=0){const s=this.texelByteSize,o=this.bytesPerRow,a=this.height,u=this.data[i];return une(new Uint8Array(u),e,t,r,i,a,o,s,this.format)}setPixel(e,t,r,i,s){const o=this.texelByteSize,a=this.bytesPerRow,u=this.height,h=this.data[i];(function(d,g,y,v,T,w,E,S,P,I){const L=v*(E>>=T)*(w>>=T)+y*E+g*S;switch(P){case"r8unorm":return void gt(d,L,"8unorm",1,I);case"r8snorm":return void gt(d,L,"8snorm",1,I);case"r8uint":return void gt(d,L,"8uint",1,I);case"r8sint":return void gt(d,L,"8sint",1,I);case"rg8unorm":return void gt(d,L,"8unorm",2,I);case"rg8snorm":return void gt(d,L,"8snorm",2,I);case"rg8uint":return void gt(d,L,"8uint",2,I);case"rg8sint":return void gt(d,L,"8sint",2,I);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void gt(d,L,"8unorm",4,I);case"rgba8snorm":return void gt(d,L,"8snorm",4,I);case"rgba8uint":return void gt(d,L,"8uint",4,I);case"rgba8sint":return void gt(d,L,"8sint",4,I);case"r16uint":return void gt(d,L,"16uint",1,I);case"r16sint":return void gt(d,L,"16sint",1,I);case"r16float":return void gt(d,L,"16float",1,I);case"rg16uint":return void gt(d,L,"16uint",2,I);case"rg16sint":return void gt(d,L,"16sint",2,I);case"rg16float":return void gt(d,L,"16float",2,I);case"rgba16uint":return void gt(d,L,"16uint",4,I);case"rgba16sint":return void gt(d,L,"16sint",4,I);case"rgba16float":return void gt(d,L,"16float",4,I);case"r32uint":return void gt(d,L,"32uint",1,I);case"r32sint":return void gt(d,L,"32sint",1,I);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void gt(d,L,"32float",1,I);case"rg32uint":return void gt(d,L,"32uint",2,I);case"rg32sint":return void gt(d,L,"32sint",2,I);case"rg32float":return void gt(d,L,"32float",2,I);case"rgba32uint":return void gt(d,L,"32uint",4,I);case"rgba32sint":return void gt(d,L,"32sint",4,I);case"rgba32float":return void gt(d,L,"32float",4,I);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(h),e,t,r,i,u,a,o,this.format,s)}}(n=>{n[n.token=0]="token",n[n.keyword=1]="keyword",n[n.reserved=2]="reserved"})(ee||(ee={}));class te{constructor(e,t,r){this.name=e,this.type=t,this.rule=r}toString(){return this.name}}class z{}oe=z,z.none=new te("",ee.reserved,""),z.eof=new te("EOF",ee.token,""),z.reserved={asm:new te("asm",ee.reserved,"asm"),bf16:new te("bf16",ee.reserved,"bf16"),do:new te("do",ee.reserved,"do"),enum:new te("enum",ee.reserved,"enum"),f16:new te("f16",ee.reserved,"f16"),f64:new te("f64",ee.reserved,"f64"),handle:new te("handle",ee.reserved,"handle"),i8:new te("i8",ee.reserved,"i8"),i16:new te("i16",ee.reserved,"i16"),i64:new te("i64",ee.reserved,"i64"),mat:new te("mat",ee.reserved,"mat"),premerge:new te("premerge",ee.reserved,"premerge"),regardless:new te("regardless",ee.reserved,"regardless"),typedef:new te("typedef",ee.reserved,"typedef"),u8:new te("u8",ee.reserved,"u8"),u16:new te("u16",ee.reserved,"u16"),u64:new te("u64",ee.reserved,"u64"),unless:new te("unless",ee.reserved,"unless"),using:new te("using",ee.reserved,"using"),vec:new te("vec",ee.reserved,"vec"),void:new te("void",ee.reserved,"void")},z.keywords={array:new te("array",ee.keyword,"array"),atomic:new te("atomic",ee.keyword,"atomic"),bool:new te("bool",ee.keyword,"bool"),f32:new te("f32",ee.keyword,"f32"),i32:new te("i32",ee.keyword,"i32"),mat2x2:new te("mat2x2",ee.keyword,"mat2x2"),mat2x3:new te("mat2x3",ee.keyword,"mat2x3"),mat2x4:new te("mat2x4",ee.keyword,"mat2x4"),mat3x2:new te("mat3x2",ee.keyword,"mat3x2"),mat3x3:new te("mat3x3",ee.keyword,"mat3x3"),mat3x4:new te("mat3x4",ee.keyword,"mat3x4"),mat4x2:new te("mat4x2",ee.keyword,"mat4x2"),mat4x3:new te("mat4x3",ee.keyword,"mat4x3"),mat4x4:new te("mat4x4",ee.keyword,"mat4x4"),ptr:new te("ptr",ee.keyword,"ptr"),sampler:new te("sampler",ee.keyword,"sampler"),sampler_comparison:new te("sampler_comparison",ee.keyword,"sampler_comparison"),struct:new te("struct",ee.keyword,"struct"),texture_1d:new te("texture_1d",ee.keyword,"texture_1d"),texture_2d:new te("texture_2d",ee.keyword,"texture_2d"),texture_2d_array:new te("texture_2d_array",ee.keyword,"texture_2d_array"),texture_3d:new te("texture_3d",ee.keyword,"texture_3d"),texture_cube:new te("texture_cube",ee.keyword,"texture_cube"),texture_cube_array:new te("texture_cube_array",ee.keyword,"texture_cube_array"),texture_multisampled_2d:new te("texture_multisampled_2d",ee.keyword,"texture_multisampled_2d"),texture_storage_1d:new te("texture_storage_1d",ee.keyword,"texture_storage_1d"),texture_storage_2d:new te("texture_storage_2d",ee.keyword,"texture_storage_2d"),texture_storage_2d_array:new te("texture_storage_2d_array",ee.keyword,"texture_storage_2d_array"),texture_storage_3d:new te("texture_storage_3d",ee.keyword,"texture_storage_3d"),texture_depth_2d:new te("texture_depth_2d",ee.keyword,"texture_depth_2d"),texture_depth_2d_array:new te("texture_depth_2d_array",ee.keyword,"texture_depth_2d_array"),texture_depth_cube:new te("texture_depth_cube",ee.keyword,"texture_depth_cube"),texture_depth_cube_array:new te("texture_depth_cube_array",ee.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new te("texture_depth_multisampled_2d",ee.keyword,"texture_depth_multisampled_2d"),texture_external:new te("texture_external",ee.keyword,"texture_external"),u32:new te("u32",ee.keyword,"u32"),vec2:new te("vec2",ee.keyword,"vec2"),vec3:new te("vec3",ee.keyword,"vec3"),vec4:new te("vec4",ee.keyword,"vec4"),bitcast:new te("bitcast",ee.keyword,"bitcast"),block:new te("block",ee.keyword,"block"),break:new te("break",ee.keyword,"break"),case:new te("case",ee.keyword,"case"),continue:new te("continue",ee.keyword,"continue"),continuing:new te("continuing",ee.keyword,"continuing"),default:new te("default",ee.keyword,"default"),diagnostic:new te("diagnostic",ee.keyword,"diagnostic"),discard:new te("discard",ee.keyword,"discard"),else:new te("else",ee.keyword,"else"),enable:new te("enable",ee.keyword,"enable"),fallthrough:new te("fallthrough",ee.keyword,"fallthrough"),false:new te("false",ee.keyword,"false"),fn:new te("fn",ee.keyword,"fn"),for:new te("for",ee.keyword,"for"),function:new te("function",ee.keyword,"function"),if:new te("if",ee.keyword,"if"),let:new te("let",ee.keyword,"let"),const:new te("const",ee.keyword,"const"),loop:new te("loop",ee.keyword,"loop"),while:new te("while",ee.keyword,"while"),private:new te("private",ee.keyword,"private"),read:new te("read",ee.keyword,"read"),read_write:new te("read_write",ee.keyword,"read_write"),return:new te("return",ee.keyword,"return"),requires:new te("requires",ee.keyword,"requires"),storage:new te("storage",ee.keyword,"storage"),switch:new te("switch",ee.keyword,"switch"),true:new te("true",ee.keyword,"true"),alias:new te("alias",ee.keyword,"alias"),type:new te("type",ee.keyword,"type"),uniform:new te("uniform",ee.keyword,"uniform"),var:new te("var",ee.keyword,"var"),override:new te("override",ee.keyword,"override"),workgroup:new te("workgroup",ee.keyword,"workgroup"),write:new te("write",ee.keyword,"write"),r8unorm:new te("r8unorm",ee.keyword,"r8unorm"),r8snorm:new te("r8snorm",ee.keyword,"r8snorm"),r8uint:new te("r8uint",ee.keyword,"r8uint"),r8sint:new te("r8sint",ee.keyword,"r8sint"),r16uint:new te("r16uint",ee.keyword,"r16uint"),r16sint:new te("r16sint",ee.keyword,"r16sint"),r16float:new te("r16float",ee.keyword,"r16float"),rg8unorm:new te("rg8unorm",ee.keyword,"rg8unorm"),rg8snorm:new te("rg8snorm",ee.keyword,"rg8snorm"),rg8uint:new te("rg8uint",ee.keyword,"rg8uint"),rg8sint:new te("rg8sint",ee.keyword,"rg8sint"),r32uint:new te("r32uint",ee.keyword,"r32uint"),r32sint:new te("r32sint",ee.keyword,"r32sint"),r32float:new te("r32float",ee.keyword,"r32float"),rg16uint:new te("rg16uint",ee.keyword,"rg16uint"),rg16sint:new te("rg16sint",ee.keyword,"rg16sint"),rg16float:new te("rg16float",ee.keyword,"rg16float"),rgba8unorm:new te("rgba8unorm",ee.keyword,"rgba8unorm"),rgba8unorm_srgb:new te("rgba8unorm_srgb",ee.keyword,"rgba8unorm_srgb"),rgba8snorm:new te("rgba8snorm",ee.keyword,"rgba8snorm"),rgba8uint:new te("rgba8uint",ee.keyword,"rgba8uint"),rgba8sint:new te("rgba8sint",ee.keyword,"rgba8sint"),bgra8unorm:new te("bgra8unorm",ee.keyword,"bgra8unorm"),bgra8unorm_srgb:new te("bgra8unorm_srgb",ee.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new te("rgb10a2unorm",ee.keyword,"rgb10a2unorm"),rg11b10float:new te("rg11b10float",ee.keyword,"rg11b10float"),rg32uint:new te("rg32uint",ee.keyword,"rg32uint"),rg32sint:new te("rg32sint",ee.keyword,"rg32sint"),rg32float:new te("rg32float",ee.keyword,"rg32float"),rgba16uint:new te("rgba16uint",ee.keyword,"rgba16uint"),rgba16sint:new te("rgba16sint",ee.keyword,"rgba16sint"),rgba16float:new te("rgba16float",ee.keyword,"rgba16float"),rgba32uint:new te("rgba32uint",ee.keyword,"rgba32uint"),rgba32sint:new te("rgba32sint",ee.keyword,"rgba32sint"),rgba32float:new te("rgba32float",ee.keyword,"rgba32float"),static_assert:new te("static_assert",ee.keyword,"static_assert")},z.tokens={decimal_float_literal:new te("decimal_float_literal",ee.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new te("hex_float_literal",ee.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new te("int_literal",ee.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new te("uint_literal",ee.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new te("name",ee.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new te("ident",ee.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new te("and",ee.token,"&"),and_and:new te("and_and",ee.token,"&&"),arrow:new te("arrow ",ee.token,"->"),attr:new te("attr",ee.token,"@"),forward_slash:new te("forward_slash",ee.token,"/"),bang:new te("bang",ee.token,"!"),bracket_left:new te("bracket_left",ee.token,"["),bracket_right:new te("bracket_right",ee.token,"]"),brace_left:new te("brace_left",ee.token,"{"),brace_right:new te("brace_right",ee.token,"}"),colon:new te("colon",ee.token,":"),comma:new te("comma",ee.token,","),equal:new te("equal",ee.token,"="),equal_equal:new te("equal_equal",ee.token,"=="),not_equal:new te("not_equal",ee.token,"!="),greater_than:new te("greater_than",ee.token,">"),greater_than_equal:new te("greater_than_equal",ee.token,">="),shift_right:new te("shift_right",ee.token,">>"),less_than:new te("less_than",ee.token,"<"),less_than_equal:new te("less_than_equal",ee.token,"<="),shift_left:new te("shift_left",ee.token,"<<"),modulo:new te("modulo",ee.token,"%"),minus:new te("minus",ee.token,"-"),minus_minus:new te("minus_minus",ee.token,"--"),period:new te("period",ee.token,"."),plus:new te("plus",ee.token,"+"),plus_plus:new te("plus_plus",ee.token,"++"),or:new te("or",ee.token,"|"),or_or:new te("or_or",ee.token,"||"),paren_left:new te("paren_left",ee.token,"("),paren_right:new te("paren_right",ee.token,")"),semicolon:new te("semicolon",ee.token,";"),star:new te("star",ee.token,"*"),tilde:new te("tilde",ee.token,"~"),underscore:new te("underscore",ee.token,"_"),xor:new te("xor",ee.token,"^"),plus_equal:new te("plus_equal",ee.token,"+="),minus_equal:new te("minus_equal",ee.token,"-="),times_equal:new te("times_equal",ee.token,"*="),division_equal:new te("division_equal",ee.token,"/="),modulo_equal:new te("modulo_equal",ee.token,"%="),and_equal:new te("and_equal",ee.token,"&="),or_equal:new te("or_equal",ee.token,"|="),xor_equal:new te("xor_equal",ee.token,"^="),shift_right_equal:new te("shift_right_equal",ee.token,">>="),shift_left_equal:new te("shift_left_equal",ee.token,"<<=")},z.simpleTokens={"@":oe.tokens.attr,"{":oe.tokens.brace_left,"}":oe.tokens.brace_right,":":oe.tokens.colon,",":oe.tokens.comma,"(":oe.tokens.paren_left,")":oe.tokens.paren_right,";":oe.tokens.semicolon},z.literalTokens={"&":oe.tokens.and,"&&":oe.tokens.and_and,"->":oe.tokens.arrow,"/":oe.tokens.forward_slash,"!":oe.tokens.bang,"[":oe.tokens.bracket_left,"]":oe.tokens.bracket_right,"=":oe.tokens.equal,"==":oe.tokens.equal_equal,"!=":oe.tokens.not_equal,">":oe.tokens.greater_than,">=":oe.tokens.greater_than_equal,">>":oe.tokens.shift_right,"<":oe.tokens.less_than,"<=":oe.tokens.less_than_equal,"<<":oe.tokens.shift_left,"%":oe.tokens.modulo,"-":oe.tokens.minus,"--":oe.tokens.minus_minus,".":oe.tokens.period,"+":oe.tokens.plus,"++":oe.tokens.plus_plus,"|":oe.tokens.or,"||":oe.tokens.or_or,"*":oe.tokens.star,"~":oe.tokens.tilde,_:oe.tokens.underscore,"^":oe.tokens.xor,"+=":oe.tokens.plus_equal,"-=":oe.tokens.minus_equal,"*=":oe.tokens.times_equal,"/=":oe.tokens.division_equal,"%=":oe.tokens.modulo_equal,"&=":oe.tokens.and_equal,"|=":oe.tokens.or_equal,"^=":oe.tokens.xor_equal,">>=":oe.tokens.shift_right_equal,"<<=":oe.tokens.shift_left_equal},z.regexTokens={decimal_float_literal:oe.tokens.decimal_float_literal,hex_float_literal:oe.tokens.hex_float_literal,int_literal:oe.tokens.int_literal,uint_literal:oe.tokens.uint_literal,ident:oe.tokens.ident},z.storage_class=[oe.keywords.function,oe.keywords.private,oe.keywords.workgroup,oe.keywords.uniform,oe.keywords.storage],z.access_mode=[oe.keywords.read,oe.keywords.write,oe.keywords.read_write],z.sampler_type=[oe.keywords.sampler,oe.keywords.sampler_comparison],z.sampled_texture_type=[oe.keywords.texture_1d,oe.keywords.texture_2d,oe.keywords.texture_2d_array,oe.keywords.texture_3d,oe.keywords.texture_cube,oe.keywords.texture_cube_array],z.multisampled_texture_type=[oe.keywords.texture_multisampled_2d],z.storage_texture_type=[oe.keywords.texture_storage_1d,oe.keywords.texture_storage_2d,oe.keywords.texture_storage_2d_array,oe.keywords.texture_storage_3d],z.depth_texture_type=[oe.keywords.texture_depth_2d,oe.keywords.texture_depth_2d_array,oe.keywords.texture_depth_cube,oe.keywords.texture_depth_cube_array,oe.keywords.texture_depth_multisampled_2d],z.texture_external_type=[oe.keywords.texture_external],z.any_texture_type=[...oe.sampled_texture_type,...oe.multisampled_texture_type,...oe.storage_texture_type,...oe.depth_texture_type,...oe.texture_external_type],z.texel_format=[oe.keywords.r8unorm,oe.keywords.r8snorm,oe.keywords.r8uint,oe.keywords.r8sint,oe.keywords.r16uint,oe.keywords.r16sint,oe.keywords.r16float,oe.keywords.rg8unorm,oe.keywords.rg8snorm,oe.keywords.rg8uint,oe.keywords.rg8sint,oe.keywords.r32uint,oe.keywords.r32sint,oe.keywords.r32float,oe.keywords.rg16uint,oe.keywords.rg16sint,oe.keywords.rg16float,oe.keywords.rgba8unorm,oe.keywords.rgba8unorm_srgb,oe.keywords.rgba8snorm,oe.keywords.rgba8uint,oe.keywords.rgba8sint,oe.keywords.bgra8unorm,oe.keywords.bgra8unorm_srgb,oe.keywords.rgb10a2unorm,oe.keywords.rg11b10float,oe.keywords.rg32uint,oe.keywords.rg32sint,oe.keywords.rg32float,oe.keywords.rgba16uint,oe.keywords.rgba16sint,oe.keywords.rgba16float,oe.keywords.rgba32uint,oe.keywords.rgba32sint,oe.keywords.rgba32float],z.const_literal=[oe.tokens.int_literal,oe.tokens.uint_literal,oe.tokens.decimal_float_literal,oe.tokens.hex_float_literal,oe.keywords.true,oe.keywords.false],z.literal_or_ident=[oe.tokens.ident,oe.tokens.int_literal,oe.tokens.uint_literal,oe.tokens.decimal_float_literal,oe.tokens.hex_float_literal,oe.tokens.name],z.element_count_expression=[oe.tokens.int_literal,oe.tokens.uint_literal,oe.tokens.ident],z.template_types=[oe.keywords.vec2,oe.keywords.vec3,oe.keywords.vec4,oe.keywords.mat2x2,oe.keywords.mat2x3,oe.keywords.mat2x4,oe.keywords.mat3x2,oe.keywords.mat3x3,oe.keywords.mat3x4,oe.keywords.mat4x2,oe.keywords.mat4x3,oe.keywords.mat4x4,oe.keywords.atomic,oe.keywords.bitcast,...oe.any_texture_type],z.attribute_name=[oe.tokens.ident,oe.keywords.block,oe.keywords.diagnostic],z.assignment_operators=[oe.tokens.equal,oe.tokens.plus_equal,oe.tokens.minus_equal,oe.tokens.times_equal,oe.tokens.division_equal,oe.tokens.modulo_equal,oe.tokens.and_equal,oe.tokens.or_equal,oe.tokens.xor_equal,oe.tokens.shift_right_equal,oe.tokens.shift_left_equal],z.increment_operators=[oe.tokens.plus_plus,oe.tokens.minus_minus];class yP{constructor(e,t,r,i,s){this.type=e,this.lexeme=t,this.line=r,this.start=i,this.end=s}toString(){return this.lexeme}isTemplateType(){return z.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==z.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class yne{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new yP(z.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let o=1;for(;o>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),o--,o==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),o++)}return!0}}const t=z.simpleTokens[e];if(t)return this._addToken(t),!0;let r=z.none;const i=this._isAlpha(e),s=e==="_";if(this._isAlphaNumeric(e)){let o=this._peekAhead();for(;this._isAlphaNumeric(o);)e+=this._advance(),o=this._peekAhead()}if(i){const o=z.keywords[e];if(o)return this._addToken(o),!0}if(i||s)return this._addToken(z.tokens.ident),!0;for(;;){let o=this._findType(e);const a=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(a=="=")return this._current++,e+=a,this._addToken(z.tokens.minus_equal),!0;if(a=="-")return this._current++,e+=a,this._addToken(z.tokens.minus_minus),!0;const u=this._tokens.length-1;if((z.literal_or_ident.indexOf(this._tokens[u].type)!=-1||this._tokens[u].type==z.tokens.paren_right)&&a!=">")return this._addToken(o),!0}if(e==">"&&(a==">"||a=="=")){let u=!1,h=this._tokens.length-1;for(let d=0;d<5&&h>=0&&z.assignment_operators.indexOf(this._tokens[h].type)===-1;++d,--h)if(this._tokens[h].type===z.tokens.less_than){h>0&&this._tokens[h-1].isArrayOrTemplateType()&&(u=!0);break}if(u)return this._addToken(o),!0}if(o===z.none){let u=e,h=0;const d=2;for(let g=0;g<d;++g)if(u+=this._peekAhead(g),o=this._findType(u),o!==z.none){h=g;break}if(o===z.none)return r!==z.none&&(this._current--,this._addToken(r),!0);e=u,this._current+=h+1}if(r=o,this._isAtEnd())break;e+=this._advance()}return r!==z.none&&(this._addToken(r),!0)}_findType(e){for(const r in z.regexTokens){const i=z.regexTokens[r];if(this._match(e,i.rule))return i}return z.literalTokens[e]||z.none}_match(e,t){const r=t.exec(e);return r&&r.index==0&&r[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new yP(e,t,this._line,this._start,this._current))}}function Re(n){return Array.isArray(n)||n?.buffer instanceof ArrayBuffer}const c_=new Float32Array(1),_ne=new Uint32Array(c_.buffer),vne=new Uint32Array(c_.buffer),u_=new Int32Array(1),bne=new Float32Array(u_.buffer),Tne=new Uint32Array(u_.buffer),h_=new Uint32Array(1),wne=new Float32Array(h_.buffer),xne=new Int32Array(h_.buffer);function _P(n,e,t){if(e===t)return n;if(e==="f32"){if(t==="i32"||t==="x32")return c_[0]=n,_ne[0];if(t==="u32")return c_[0]=n,vne[0]}else if(e==="i32"||e==="x32"){if(t==="f32")return u_[0]=n,bne[0];if(t==="u32")return u_[0]=n,Tne[0]}else if(e==="u32"){if(t==="f32")return h_[0]=n,wne[0];if(t==="i32"||t==="x32")return h_[0]=n,xne[0]}return console.error(`Unsupported cast from ${e} to ${t}`),n}class Ene{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class bm{constructor(e,t){this.align=e,this.size=t}}class ts{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new one,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const t of e)t instanceof Gd&&this._functions.set(t.name,new Ene(t));for(const t of e)if(t instanceof js){const r=this.getTypeInfo(t,null);r instanceof pa&&this.structs.push(r)}for(const t of e)if(t instanceof P1)this.aliases.push(this._getAliasInfo(t));else{if(t instanceof C1){const r=t,i=this._getAttributeNum(r.attributes,"id",0),s=r.type!=null?this.getTypeInfo(r.type,r.attributes):null;this.overrides.push(new rne(r.name,s,r.attributes,i));continue}if(this._isUniformVar(t)){const r=t,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),a=new vm(r.name,o,i,s,r.attributes,aa.Uniform,r.access);a.access||(a.access="read"),this.uniforms.push(a);continue}if(this._isStorageVar(t)){const r=t,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),a=this._isStorageTexture(o),u=new vm(r.name,o,i,s,r.attributes,a?aa.StorageTexture:aa.Storage,r.access);u.access||(u.access="read"),this.storage.push(u);continue}if(this._isTextureVar(t)){const r=t,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),a=this._isStorageTexture(o),u=new vm(r.name,o,i,s,r.attributes,a?aa.StorageTexture:aa.Texture,r.access);u.access||(u.access="read"),a?this.storage.push(u):this.textures.push(u);continue}if(this._isSamplerVar(t)){const r=t,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),a=new vm(r.name,o,i,s,r.attributes,aa.Sampler,r.access);this.samplers.push(a);continue}}for(const t of e)if(t instanceof Gd){const r=this._getAttribute(t,"vertex"),i=this._getAttribute(t,"fragment"),s=this._getAttribute(t,"compute"),o=r||i||s,a=new sne(t.name,o?.name,t.attributes);a.attributes=t.attributes,a.startLine=t.startLine,a.endLine=t.endLine,this.functions.push(a),this._functions.get(t.name).info=a,o&&(this._functions.get(t.name).inUse=!0,a.inUse=!0,a.resources=this._findResources(t,!!o),a.inputs=this._getInputs(t.args),a.outputs=this._getOutputs(t.returnType),this.entry[o.name].push(a)),a.arguments=t.args.map(u=>new ine(u.name,this.getTypeInfo(u.type,u.attributes),u.attributes)),a.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null;continue}for(const t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(const t of this._functions.values())t.node.search(r=>{var i,s,o;if(r instanceof vU){if(r.value)if(Re(r.value))for(const a of r.value)for(const u of this.overrides)a===u.name&&((i=t.info)===null||i===void 0||i.overrides.push(u));else for(const a of this.overrides)r.value===a.name&&((s=t.info)===null||s===void 0||s.overrides.push(a))}else if(r instanceof Dr)for(const a of this.overrides)r.name===a.name&&((o=t.info)===null||o===void 0||o.overrides.push(a))});for(const t of this.uniforms)this._markStructsInUse(t.type);for(const t of this.storage)this._markStructsInUse(t.type)}getFunctionInfo(e){for(const t of this.functions)if(t.name==e)return t;return null}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var r;for(const i of e.calls){const s=(r=this._functions.get(i.name))===null||r===void 0?void 0:r.info;s&&t.add(s)}}findResource(e,t,r){if(r){for(const i of this.entry.compute)if(i.name===r){for(const s of i.resources)if(s.group==e&&s.binding==t)return s}for(const i of this.entry.vertex)if(i.name===r){for(const s of i.resources)if(s.group==e&&s.binding==t)return s}for(const i of this.entry.fragment)if(i.name===r){for(const s of i.resources)if(s.group==e&&s.binding==t)return s}}for(const i of this.uniforms)if(i.group==e&&i.binding==t)return i;for(const i of this.storage)if(i.group==e&&i.binding==t)return i;for(const i of this.textures)if(i.group==e&&i.binding==t)return i;for(const i of this.samplers)if(i.group==e&&i.binding==t)return i;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const r=[],i=this,s=[];return e.search(o=>{if(o instanceof a_)s.push({});else if(o instanceof l_)s.pop();else if(o instanceof $s){const a=o;t&&a.type!==null&&this._markStructsFromAST(a.type),s.length>0&&(s[s.length-1][a.name]=a)}else if(o instanceof Zi){const a=o;t&&a.type!==null&&this._markStructsFromAST(a.type)}else if(o instanceof Td){const a=o;t&&a.type!==null&&this._markStructsFromAST(a.type),s.length>0&&(s[s.length-1][a.name]=a)}else if(o instanceof Dr){const a=o;if(s.length>0&&s[s.length-1][a.name])return;const u=i._findResource(a.name);u&&r.push(u)}else if(o instanceof M1){const a=o,u=i._functions.get(a.name);u&&(t&&(u.inUse=!0),e.calls.add(u.node),u.resources===null&&(u.resources=i._findResources(u.node,t)),r.push(...u.resources))}else if(o instanceof I1){const a=o,u=i._functions.get(a.name);u&&(t&&(u.inUse=!0),e.calls.add(u.node),u.resources===null&&(u.resources=i._findResources(u.node,t)),r.push(...u.resources))}}),[...new Map(r.map(o=>[o.name,o])).values()]}getBindGroups(){const e=[];function t(r,i){r>=e.length&&(e.length=r+1),e[r]===void 0&&(e[r]=[]),i>=e[r].length&&(e[r].length=i+1)}for(const r of this.uniforms)t(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.storage)t(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.textures)t(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.samplers)t(r.group,r.binding),e[r.group][r.binding]=r;return e}_getOutputs(e,t=void 0){if(t===void 0&&(t=[]),e instanceof js)this._getStructOutputs(e,t);else{const r=this._getOutputInfo(e);r!==null&&t.push(r)}return t}_getStructOutputs(e,t){for(const r of e.members)if(r.type instanceof js)this._getStructOutputs(r.type,t);else{const i=this._getAttribute(r,"location")||this._getAttribute(r,"builtin");if(i!==null){const s=this.getTypeInfo(r.type,r.type.attributes),o=this._parseInt(i.value),a=new fP(r.name,s,i.name,o);t.push(a)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const r=this.getTypeInfo(e,e.attributes),i=this._parseInt(t.value);return new fP("",r,t.name,i)}return null}_getInputs(e,t=void 0){t===void 0&&(t=[]);for(const r of e)if(r.type instanceof js)this._getStructInputs(r.type,t);else{const i=this._getInputInfo(r);i!==null&&t.push(i)}return t}_getStructInputs(e,t){for(const r of e.members)if(r.type instanceof js)this._getStructInputs(r.type,t);else{const i=this._getInputInfo(r);i!==null&&t.push(i)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const r=this._getAttribute(e,"interpolation"),i=this.getTypeInfo(e.type,e.attributes),s=this._parseInt(t.value),o=new nne(e.name,i,t.name,s);return r!==null&&(o.interpolation=this._parseString(r.value)),o}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new tne(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const t of this.structs)if(t.name==e)return t;for(const t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof cy){const i=e.type?this.getTypeInfo(e.type,e.attributes):null,s=new qw(e.name,i,t);return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof wd){const i=e,s=i.format?this.getTypeInfo(i.format,i.attributes):null,o=new Aa(i.name,t);return o.format=s,o.count=i.count,this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof js){const i=e,s=new pa(i.name,t);s.startLine=i.startLine,s.endLine=i.endLine;for(const o of i.members){const a=this.getTypeInfo(o.type,o.attributes);s.members.push(new hP(o.name,a,o.attributes))}return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof od){const i=e,s=i.format instanceof _e,o=i.format?s?this.getTypeInfo(i.format,null):new ri(i.format,null):null,a=new Jl(i.name,o,t,i.access);return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof re){const i=e,s=i.format?this.getTypeInfo(i.format,null):null,o=new Jl(i.name,s,t,i.access);return this._types.set(e,o),this._updateTypeInfo(o),o}const r=new ri(e.name,t);return this._types.set(e,r),this._updateTypeInfo(r),r}_updateTypeInfo(e){var t,r,i;const s=this._getTypeSize(e);if(e.size=(t=s?.size)!==null&&t!==void 0?t:0,e instanceof Aa&&e.format){const o=this._getTypeSize(e.format);e.stride=Math.max((r=o?.size)!==null&&r!==void 0?r:0,(i=o?.align)!==null&&i!==void 0?i:0),this._updateTypeInfo(e.format)}e instanceof qw&&this._updateTypeInfo(e.format),e instanceof pa&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let r=0,i=0,s=0,o=0;for(let a=0,u=e.members.length;a<u;++a){const h=e.members[a],d=this._getTypeSize(h);if(!d)continue;(t=this._getAlias(h.type.name))!==null&&t!==void 0||h.type;const g=d.align,y=d.size;r=this._roundUp(g,r+i),i=y,s=r,o=Math.max(o,g),h.offset=r,h.size=y,this._updateTypeInfo(h.type)}e.size=this._roundUp(o,s+i),e.align=o}_getTypeSize(e){var t,r;if(e==null)return null;const i=this._getAttributeNum(e.attributes,"size",0),s=this._getAttributeNum(e.attributes,"align",0);if(e instanceof hP&&(e=e.type),e instanceof ri){const o=this._getAlias(e.name);o!==null&&(e=o)}{const o=ts._typeInfo[e.name];if(o!==void 0){const a=((t=e.format)===null||t===void 0?void 0:t.name)==="f16"?2:1;return new bm(Math.max(s,o.align/a),Math.max(i,o.size/a))}}{const o=ts._typeInfo[e.name.substring(0,e.name.length-1)];if(o){const a=e.name[e.name.length-1]==="h"?2:1;return new bm(Math.max(s,o.align/a),Math.max(i,o.size/a))}}if(e instanceof Aa){let o=e,a=8,u=8;const h=this._getTypeSize(o.format);return h!==null&&(u=h.size,a=h.align),u=o.count*this._getAttributeNum((r=e?.attributes)!==null&&r!==void 0?r:null,"stride",this._roundUp(a,u)),i&&(u=i),new bm(Math.max(s,a),Math.max(i,u))}if(e instanceof pa){let o=0,a=0,u=0,h=0,d=0;for(const g of e.members){const y=this._getTypeSize(g.type);y!==null&&(o=Math.max(y.align,o),u=this._roundUp(y.align,u+h),h=y.size,d=u)}return a=this._roundUp(o,d+h),new bm(Math.max(s,o),Math.max(i,a))}return null}_isUniformVar(e){return e instanceof $s&&e.storage=="uniform"}_isStorageVar(e){return e instanceof $s&&e.storage=="storage"}_isTextureVar(e){return e instanceof $s&&e.type!==null&&ts._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof $s&&e.type!==null&&ts._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,t){const r=e;if(!r||!r.attributes)return null;const i=r.attributes;for(let s of i)if(s.name==t)return s;return null}_getAttributeNum(e,t,r){if(e===null)return r;for(let i of e)if(i.name==t){let s=i!==null&&i.value!==null?i.value:r;return s instanceof Array&&(s=s[0]),typeof s=="number"?s:typeof s=="string"?parseInt(s):r}return r}_roundUp(e,t){return Math.ceil(t/e)*e}}ts._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},ts._textureTypes=z.any_texture_type.map(n=>n.name),ts._samplerTypes=z.sampler_type.map(n=>n.name);let O1=0;class k1{constructor(e,t,r){this.id=O1++,this.name=e,this.value=t,this.node=r}clone(){return new k1(this.name,this.value,this.node)}}class N1{constructor(e){this.id=O1++,this.name=e.name,this.node=e}clone(){return new N1(this.node)}}class D1{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=O1++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?(t=this.variables.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?(t=this.functions.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,r){this.variables.set(e,new k1(e,t,r??null))}setVariable(e,t,r){const i=this.getVariable(e);i!==null?i.value=t:this.createVariable(e,t,r)}getVariableValue(e){var t;const r=this.getVariable(e);return(t=r?.value)!==null&&t!==void 0?t:null}clone(){return new D1(this)}}class Ane{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}}class Sne{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const r=this.exec.evalExpression(e.args[0],t);let i=!0;if(r instanceof X)return r.data.forEach(s=>{s||(i=!1)}),new J(i?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof X){const i=r.data.some(s=>s);return new J(i?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){const r=this.exec.evalExpression(e.args[2],t);if(!(r instanceof J))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return r.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let r=e.args[0];r instanceof ln&&(r=r.right);const i=this.exec.evalExpression(r,t);if(i instanceof Xt&&i.typeInfo.size===0){const s=i.typeInfo,o=i.buffer.byteLength/s.stride;return new J(o,this.getTypeInfo("u32"))}return new J(i.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof X)return new X(r.data.map(s=>Math.abs(s)),r.typeInfo);const i=r;return new J(Math.abs(i.value),i.typeInfo)}Acos(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof X)return new X(r.data.map(s=>Math.acos(s)),r.typeInfo);const i=r;return new J(Math.acos(i.value),r.typeInfo)}Acosh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof X)return new X(r.data.map(s=>Math.acosh(s)),r.typeInfo);const i=r;return new J(Math.acosh(i.value),r.typeInfo)}Asin(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof X)return new X(r.data.map(s=>Math.asin(s)),r.typeInfo);const i=r;return new J(Math.asin(i.value),r.typeInfo)}Asinh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof X)return new X(r.data.map(s=>Math.asinh(s)),r.typeInfo);const i=r;return new J(Math.asinh(i.value),r.typeInfo)}Atan(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof X)return new X(r.data.map(s=>Math.atan(s)),r.typeInfo);const i=r;return new J(Math.atan(i.value),r.typeInfo)}Atanh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof X)return new X(r.data.map(s=>Math.atanh(s)),r.typeInfo);const i=r;return new J(Math.atanh(i.value),r.typeInfo)}Atan2(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(r instanceof X&&i instanceof X)return new X(r.data.map((a,u)=>Math.atan2(a,i.data[u])),r.typeInfo);const s=r,o=i;return new J(Math.atan2(s.value,o.value),r.typeInfo)}Ceil(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof X)return new X(r.data.map(s=>Math.ceil(s)),r.typeInfo);const i=r;return new J(Math.ceil(i.value),r.typeInfo)}_clamp(e,t,r){return Math.min(Math.max(e,t),r)}Clamp(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(r instanceof X&&i instanceof X&&s instanceof X)return new X(r.data.map((h,d)=>this._clamp(h,i.data[d],s.data[d])),r.typeInfo);const o=r,a=i,u=s;return new J(this._clamp(o.value,a.value,u.value),r.typeInfo)}Cos(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof X)return new X(r.data.map(s=>Math.cos(s)),r.typeInfo);const i=r;return new J(Math.cos(i.value),r.typeInfo)}Cosh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof X)return new X(r.data.map(s=>Math.cosh(s)),r.typeInfo);const i=r;return new J(Math.cos(i.value),r.typeInfo)}CountLeadingZeros(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof X)return new X(r.data.map(s=>Math.clz32(s)),r.typeInfo);const i=r;return new J(Math.clz32(i.value),r.typeInfo)}_countOneBits(e){let t=0;for(;e!==0;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof X)return new X(r.data.map(s=>this._countOneBits(s)),r.typeInfo);const i=r;return new J(this._countOneBits(i.value),r.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof X)return new X(r.data.map(s=>this._countTrailingZeros(s)),r.typeInfo);const i=r;return new J(this._countTrailingZeros(i.value),r.typeInfo)}Cross(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(r instanceof X&&i instanceof X){if(r.data.length!==3||i.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const s=r.data,o=i.data;return new X([s[1]*o[2]-o[1]*s[2],s[2]*o[0]-o[2]*s[0],s[0]*o[1]-o[0]*s[1]],r.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){const r=this.exec.evalExpression(e.args[0],t),i=180/Math.PI;return r instanceof X?new X(r.data.map(s=>s*i),r.typeInfo):new J(r.value*i,this.getTypeInfo("f32"))}Determinant(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Be){const i=r.data,s=r.typeInfo.getTypeName(),o=s.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(s==="mat2x2"||s==="mat2x2f"||s==="mat2x2h")return new J(i[0]*i[3]-i[1]*i[2],o);if(s==="mat2x3"||s==="mat2x3f"||s==="mat2x3h")return new J(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),o);if(s==="mat2x4"||s==="mat2x4f"||s==="mat2x4h")console.error(`TODO: Determinant for ${s}`);else if(s==="mat3x2"||s==="mat3x2f"||s==="mat3x2h")console.error(`TODO: Determinant for ${s}`);else{if(s==="mat3x3"||s==="mat3x3f"||s==="mat3x3h")return new J(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),o);s==="mat3x4"||s==="mat3x4f"||s==="mat3x4h"||s==="mat4x2"||s==="mat4x2f"||s==="mat4x2h"||s==="mat4x3"||s==="mat4x3f"||s==="mat4x3h"?console.error(`TODO: Determinant for ${s}`):s!=="mat4x4"&&s!=="mat4x4f"&&s!=="mat4x4h"||console.error(`TODO: Determinant for ${s}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(r instanceof X&&i instanceof X){let a=0;for(let u=0;u<r.data.length;++u)a+=(r.data[u]-i.data[u])*(r.data[u]-i.data[u]);return new J(Math.sqrt(a),this.getTypeInfo("f32"))}const s=r,o=i;return new J(Math.abs(s.value-o.value),r.typeInfo)}_dot(e,t){let r=0;for(let i=0;i<e.length;++i)r+=t[i]*e[i];return r}Dot(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);return r instanceof X&&i instanceof X?new J(this._dot(r.data,i.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof X)return new X(r.data.map(s=>Math.exp(s)),r.typeInfo);const i=r;return new J(Math.exp(i.value),r.typeInfo)}Exp2(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof X)return new X(r.data.map(s=>Math.pow(2,s)),r.typeInfo);const i=r;return new J(Math.pow(2,i.value),r.typeInfo)}ExtractBits(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(i.typeInfo.name!=="u32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const o=i.value,a=s.value;if(r instanceof X)return new X(r.data.map(h=>h>>o&(1<<a)-1),r.typeInfo);if(r.typeInfo.name!=="i32"&&r.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const u=r.value;return new J(u>>o&(1<<a)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(r instanceof X&&i instanceof X&&s instanceof X){const o=this._dot(i.data,s.data);return new X(o<0?Array.from(r.data):r.data.map(a=>-a),r.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof X)return new X(r.data.map(s=>this._firstLeadingBit(s)),r.typeInfo);const i=r;return new J(this._firstLeadingBit(i.value),r.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof X)return new X(r.data.map(s=>this._firstTrailingBit(s)),r.typeInfo);const i=r;return new J(this._firstTrailingBit(i.value),r.typeInfo)}Floor(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof X)return new X(r.data.map(s=>Math.floor(s)),r.typeInfo);const i=r;return new J(Math.floor(i.value),r.typeInfo)}Fma(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(r instanceof X&&i instanceof X&&s instanceof X)return r.data.length!==i.data.length||r.data.length!==s.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new X(r.data.map((h,d)=>h*i.data[d]+s.data[d]),r.typeInfo);const o=r,a=i,u=s;return new J(o.value*a.value+u.value,o.typeInfo)}Fract(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof X)return new X(r.data.map(s=>s-Math.floor(s)),r.typeInfo);const i=r;return new J(i.value-Math.floor(i.value),r.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t),o=this.exec.evalExpression(e.args[3],t);if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const a=s.value,u=(1<<o.value)-1<<a,h=~u;if(r instanceof X&&i instanceof X)return new X(r.data.map((y,v)=>y&h|i.data[v]<<a&u),r.typeInfo);const d=r.value,g=i.value;return new J(d&h|g<<a&u,r.typeInfo)}InverseSqrt(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof X)return new X(r.data.map(s=>1/Math.sqrt(s)),r.typeInfo);const i=r;return new J(1/Math.sqrt(i.value),r.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof X){let s=0;return r.data.forEach(o=>{s+=o*o}),new J(Math.sqrt(s),this.getTypeInfo("f32"))}const i=r;return new J(Math.abs(i.value),r.typeInfo)}Log(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof X)return new X(r.data.map(s=>Math.log(s)),r.typeInfo);const i=r;return new J(Math.log(i.value),r.typeInfo)}Log2(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof X)return new X(r.data.map(s=>Math.log2(s)),r.typeInfo);const i=r;return new J(Math.log2(i.value),r.typeInfo)}Max(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(r instanceof X&&i instanceof X)return new X(r.data.map((a,u)=>Math.max(a,i.data[u])),r.typeInfo);const s=r,o=i;return new J(Math.max(s.value,o.value),r.typeInfo)}Min(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(r instanceof X&&i instanceof X)return new X(r.data.map((a,u)=>Math.min(a,i.data[u])),r.typeInfo);const s=r,o=i;return new J(Math.min(s.value,o.value),r.typeInfo)}Mix(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(r instanceof X&&i instanceof X&&s instanceof X)return new X(r.data.map((u,h)=>r.data[h]*(1-s.data[h])+i.data[h]*s.data[h]),r.typeInfo);const o=i,a=s;return new J(r.value*(1-a.value)+o.value*a.value,r.typeInfo)}Modf(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(r instanceof X&&i instanceof X)return new X(r.data.map((o,a)=>o%i.data[a]),r.typeInfo);const s=i;return new J(r.value%s.value,r.typeInfo)}Normalize(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof X){const i=this.Length(e,t).value;return new X(r.data.map(s=>s/i),r.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(r instanceof X&&i instanceof X)return new X(r.data.map((a,u)=>Math.pow(a,i.data[u])),r.typeInfo);const s=r,o=i;return new J(Math.pow(s.value,o.value),r.typeInfo)}QuantizeToF16(e,t){const r=this.exec.evalExpression(e.args[0],t);return r instanceof X?new X(r.data.map(i=>i),r.typeInfo):new J(r.value,r.typeInfo)}Radians(e,t){const r=this.exec.evalExpression(e.args[0],t);return r instanceof X?new X(r.data.map(i=>i*Math.PI/180),r.typeInfo):new J(r.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(r instanceof X&&i instanceof X){const s=this._dot(r.data,i.data);return new X(r.data.map((o,a)=>o-2*s*i.data[a]),r.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(r instanceof X&&i instanceof X&&s instanceof J){const o=this._dot(i.data,r.data);return new X(r.data.map((a,u)=>{const h=1-s.value*s.value*(1-o*o);if(h<0)return 0;const d=Math.sqrt(h);return s.value*a-(s.value*o+d)*i.data[u]}),r.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof X)return new X(r.data.map(s=>Math.round(s)),r.typeInfo);const i=r;return new J(Math.round(i.value),r.typeInfo)}Saturate(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof X)return new X(r.data.map(s=>Math.min(Math.max(s,0),1)),r.typeInfo);const i=r;return new J(Math.min(Math.max(i.value,0),1),r.typeInfo)}Sign(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof X)return new X(r.data.map(s=>Math.sign(s)),r.typeInfo);const i=r;return new J(Math.sign(i.value),r.typeInfo)}Sin(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof X)return new X(r.data.map(s=>Math.sin(s)),r.typeInfo);const i=r;return new J(Math.sin(i.value),r.typeInfo)}Sinh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof X)return new X(r.data.map(s=>Math.sinh(s)),r.typeInfo);const i=r;return new J(Math.sinh(i.value),r.typeInfo)}_smoothstep(e,t,r){const i=Math.min(Math.max((r-e)/(t-e),0),1);return i*i*(3-2*i)}SmoothStep(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(s instanceof X&&r instanceof X&&i instanceof X)return new X(s.data.map((h,d)=>this._smoothstep(r.data[d],i.data[d],h)),s.typeInfo);const o=r,a=i,u=s;return new J(this._smoothstep(o.value,a.value,u.value),s.typeInfo)}Sqrt(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof X)return new X(r.data.map(s=>Math.sqrt(s)),r.typeInfo);const i=r;return new J(Math.sqrt(i.value),r.typeInfo)}Step(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(i instanceof X&&r instanceof X)return new X(i.data.map((o,a)=>o<r.data[a]?0:1),i.typeInfo);const s=r;return new J(i.value<s.value?0:1,s.typeInfo)}Tan(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof X)return new X(r.data.map(s=>Math.tan(s)),r.typeInfo);const i=r;return new J(Math.tan(i.value),r.typeInfo)}Tanh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof X)return new X(r.data.map(s=>Math.tanh(s)),r.typeInfo);const i=r;return new J(Math.tanh(i.value),r.typeInfo)}_getTransposeType(e){const t=e.getTypeName();return t==="mat2x2f"||t==="mat2x2h"?e:t==="mat2x3f"?this.getTypeInfo("mat3x2f"):t==="mat2x3h"?this.getTypeInfo("mat3x2h"):t==="mat2x4f"?this.getTypeInfo("mat4x2f"):t==="mat2x4h"?this.getTypeInfo("mat4x2h"):t==="mat3x2f"?this.getTypeInfo("mat2x3f"):t==="mat3x2h"?this.getTypeInfo("mat2x3h"):t==="mat3x3f"||t==="mat3x3h"?e:t==="mat3x4f"?this.getTypeInfo("mat4x3f"):t==="mat3x4h"?this.getTypeInfo("mat4x3h"):t==="mat4x2f"?this.getTypeInfo("mat2x4f"):t==="mat4x2h"?this.getTypeInfo("mat2x4h"):t==="mat4x3f"?this.getTypeInfo("mat3x4f"):t==="mat4x3h"?this.getTypeInfo("mat3x4h"):(t==="mat4x4f"||t==="mat4x4h"||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){const r=this.exec.evalExpression(e.args[0],t);if(!(r instanceof Be))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const i=this._getTransposeType(r.typeInfo);if(r.typeInfo.name==="mat2x2"||r.typeInfo.name==="mat2x2f"||r.typeInfo.name==="mat2x2h"){const s=r.data;return new Be([s[0],s[2],s[1],s[3]],i)}if(r.typeInfo.name==="mat2x3"||r.typeInfo.name==="mat2x3f"||r.typeInfo.name==="mat2x3h"){const s=r.data;return new Be([s[0],s[3],s[6],s[1],s[4],s[7]],i)}if(r.typeInfo.name==="mat2x4"||r.typeInfo.name==="mat2x4f"||r.typeInfo.name==="mat2x4h"){const s=r.data;return new Be([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13]],i)}if(r.typeInfo.name==="mat3x2"||r.typeInfo.name==="mat3x2f"||r.typeInfo.name==="mat3x2h"){const s=r.data;return new Be([s[0],s[3],s[1],s[4],s[2],s[5]],i)}if(r.typeInfo.name==="mat3x3"||r.typeInfo.name==="mat3x3f"||r.typeInfo.name==="mat3x3h"){const s=r.data;return new Be([s[0],s[3],s[6],s[1],s[4],s[7],s[2],s[5],s[8]],i)}if(r.typeInfo.name==="mat3x4"||r.typeInfo.name==="mat3x4f"||r.typeInfo.name==="mat3x4h"){const s=r.data;return new Be([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14]],i)}if(r.typeInfo.name==="mat4x2"||r.typeInfo.name==="mat4x2f"||r.typeInfo.name==="mat4x2h"){const s=r.data;return new Be([s[0],s[4],s[1],s[5],s[2],s[6]],i)}if(r.typeInfo.name==="mat4x3"||r.typeInfo.name==="mat4x3f"||r.typeInfo.name==="mat4x3h"){const s=r.data;return new Be([s[0],s[4],s[8],s[1],s[5],s[9],s[2],s[6],s[10]],i)}if(r.typeInfo.name==="mat4x4"||r.typeInfo.name==="mat4x4f"||r.typeInfo.name==="mat4x4h"){const s=r.data;return new Be([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14],s[3],s[7],s[11],s[15]],i)}return console.error(`Invalid matrix type ${r.typeInfo.name}`),null}Trunc(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof X)return new X(r.data.map(s=>Math.trunc(s)),r.typeInfo);const i=r;return new J(Math.trunc(i.value),r.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){const r=e.args[0],i=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(r instanceof Dr){const s=r.name,o=t.getVariableValue(s);if(o instanceof Hs){if(i<0||i>=o.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const a=o.getMipLevelSize(i),u=o.dimension;return u==="1d"?new J(a[0],this.getTypeInfo("u32")):u==="3d"?new X(a,this.getTypeInfo("vec3u")):u==="2d"?new X(a.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${u} not found. Line ${e.line}`),null)}return console.error(`Texture ${s} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){const r=e.args[0],i=this.exec.evalExpression(e.args[1],t),s=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(i instanceof X)||i.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(r instanceof Dr){const o=r.name,a=t.getVariableValue(o);if(a instanceof Hs){const u=Math.floor(i.data[0]),h=Math.floor(i.data[1]);if(u<0||u>=a.width||h<0||h>=a.height)return console.error(`Texture ${o} out of bounds. Line ${e.line}`),null;const d=a.getPixel(u,h,0,s);return d===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new X(d,this.getTypeInfo("vec4f"))}return console.error(`Texture ${o} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){const r=e.args[0];if(r instanceof Dr){const i=r.name,s=t.getVariableValue(i);return s instanceof Hs?new J(s.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,t){const r=e.args[0];if(r instanceof Dr){const i=r.name,s=t.getVariableValue(i);return s instanceof Hs?new J(s.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,t){const r=e.args[0];if(r instanceof Dr){const i=r.name,s=t.getVariableValue(i);return s instanceof Hs?new J(s.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){const r=e.args[0],i=this.exec.evalExpression(e.args[1],t),s=e.args.length===4?this.exec.evalExpression(e.args[2],t).value:0,o=e.args.length===4?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(o.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(i instanceof X)||i.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(r instanceof Dr){const a=r.name,u=t.getVariableValue(a);if(u instanceof Hs){const h=u.getMipLevelSize(0),d=Math.floor(i.data[0]),g=Math.floor(i.data[1]);return d<0||d>=h[0]||g<0||g>=h[1]?(console.error(`Texture ${a} out of bounds. Line ${e.line}`),null):(u.setPixel(d,g,0,s,Array.from(o)),null)}return console.error(`Texture ${a} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let r=e.args[0];r instanceof ln&&(r=r.right);const i=this.exec.getVariableName(r,t);return t.getVariable(i).value.getSubData(this.exec,r.postfix,t)}AtomicStore(e,t){let r=e.args[0];r instanceof ln&&(r=r.right);const i=this.exec.getVariableName(r,t),s=t.getVariable(i);let o=e.args[1];const a=this.exec.evalExpression(o,t),u=s.value.getSubData(this.exec,r.postfix,t);return u instanceof J&&a instanceof J&&(u.value=a.value),s.value instanceof Xt&&s.value.setDataValue(this.exec,u,r.postfix,t),null}AtomicAdd(e,t){let r=e.args[0];r instanceof ln&&(r=r.right);const i=this.exec.getVariableName(r,t),s=t.getVariable(i);let o=e.args[1];const a=this.exec.evalExpression(o,t),u=s.value.getSubData(this.exec,r.postfix,t),h=new J(u.value,u.typeInfo);return u instanceof J&&a instanceof J&&(u.value+=a.value),s.value instanceof Xt&&s.value.setDataValue(this.exec,u,r.postfix,t),h}AtomicSub(e,t){let r=e.args[0];r instanceof ln&&(r=r.right);const i=this.exec.getVariableName(r,t),s=t.getVariable(i);let o=e.args[1];const a=this.exec.evalExpression(o,t),u=s.value.getSubData(this.exec,r.postfix,t),h=new J(u.value,u.typeInfo);return u instanceof J&&a instanceof J&&(u.value-=a.value),s.value instanceof Xt&&s.value.setDataValue(this.exec,u,r.postfix,t),h}AtomicMax(e,t){let r=e.args[0];r instanceof ln&&(r=r.right);const i=this.exec.getVariableName(r,t),s=t.getVariable(i);let o=e.args[1];const a=this.exec.evalExpression(o,t),u=s.value.getSubData(this.exec,r.postfix,t),h=new J(u.value,u.typeInfo);return u instanceof J&&a instanceof J&&(u.value=Math.max(u.value,a.value)),s.value instanceof Xt&&s.value.setDataValue(this.exec,u,r.postfix,t),h}AtomicMin(e,t){let r=e.args[0];r instanceof ln&&(r=r.right);const i=this.exec.getVariableName(r,t),s=t.getVariable(i);let o=e.args[1];const a=this.exec.evalExpression(o,t),u=s.value.getSubData(this.exec,r.postfix,t),h=new J(u.value,u.typeInfo);return u instanceof J&&a instanceof J&&(u.value=Math.min(u.value,a.value)),s.value instanceof Xt&&s.value.setDataValue(this.exec,u,r.postfix,t),h}AtomicAnd(e,t){let r=e.args[0];r instanceof ln&&(r=r.right);const i=this.exec.getVariableName(r,t),s=t.getVariable(i);let o=e.args[1];const a=this.exec.evalExpression(o,t),u=s.value.getSubData(this.exec,r.postfix,t),h=new J(u.value,u.typeInfo);return u instanceof J&&a instanceof J&&(u.value=u.value&a.value),s.value instanceof Xt&&s.value.setDataValue(this.exec,u,r.postfix,t),h}AtomicOr(e,t){let r=e.args[0];r instanceof ln&&(r=r.right);const i=this.exec.getVariableName(r,t),s=t.getVariable(i);let o=e.args[1];const a=this.exec.evalExpression(o,t),u=s.value.getSubData(this.exec,r.postfix,t),h=new J(u.value,u.typeInfo);return u instanceof J&&a instanceof J&&(u.value=u.value|a.value),s.value instanceof Xt&&s.value.setDataValue(this.exec,u,r.postfix,t),h}AtomicXor(e,t){let r=e.args[0];r instanceof ln&&(r=r.right);const i=this.exec.getVariableName(r,t),s=t.getVariable(i);let o=e.args[1];const a=this.exec.evalExpression(o,t),u=s.value.getSubData(this.exec,r.postfix,t),h=new J(u.value,u.typeInfo);return u instanceof J&&a instanceof J&&(u.value=u.value^a.value),s.value instanceof Xt&&s.value.setDataValue(this.exec,u,r.postfix,t),h}AtomicExchange(e,t){let r=e.args[0];r instanceof ln&&(r=r.right);const i=this.exec.getVariableName(r,t),s=t.getVariable(i);let o=e.args[1];const a=this.exec.evalExpression(o,t),u=s.value.getSubData(this.exec,r.postfix,t),h=new J(u.value,u.typeInfo);return u instanceof J&&a instanceof J&&(u.value=a.value),s.value instanceof Xt&&s.value.setDataValue(this.exec,u,r.postfix,t),h}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}}const fT={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},hr={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class Zn extends Ane{constructor(e,t){var r;super(),this.ast=e??[],this.reflection=new ts,this.reflection.updateAST(this.ast),this.context=(r=t?.clone())!==null&&r!==void 0?r:new D1,this.builtins=new Sne(this),this.typeInfo={bool:this.getTypeInfo(_e.bool),i32:this.getTypeInfo(_e.i32),u32:this.getTypeInfo(_e.u32),f32:this.getTypeInfo(_e.f32),f16:this.getTypeInfo(_e.f16),vec2f:this.getTypeInfo(re.vec2f),vec2u:this.getTypeInfo(re.vec2u),vec2i:this.getTypeInfo(re.vec2i),vec2h:this.getTypeInfo(re.vec2h),vec3f:this.getTypeInfo(re.vec3f),vec3u:this.getTypeInfo(re.vec3u),vec3i:this.getTypeInfo(re.vec3i),vec3h:this.getTypeInfo(re.vec3h),vec4f:this.getTypeInfo(re.vec4f),vec4u:this.getTypeInfo(re.vec4u),vec4i:this.getTypeInfo(re.vec4i),vec4h:this.getTypeInfo(re.vec4h),mat2x2f:this.getTypeInfo(re.mat2x2f),mat2x3f:this.getTypeInfo(re.mat2x3f),mat2x4f:this.getTypeInfo(re.mat2x4f),mat3x2f:this.getTypeInfo(re.mat3x2f),mat3x3f:this.getTypeInfo(re.mat3x3f),mat3x4f:this.getTypeInfo(re.mat3x4f),mat4x2f:this.getTypeInfo(re.mat4x2f),mat4x3f:this.getTypeInfo(re.mat4x3f),mat4x4f:this.getTypeInfo(re.mat4x4f)}}getVariableValue(e){var t,r;const i=(r=(t=this.context.getVariable(e))===null||t===void 0?void 0:t.value)!==null&&r!==void 0?r:null;if(i===null)return null;if(i instanceof J)return i.value;if(i instanceof X||i instanceof Be)return Array.from(i.data);if(i instanceof Xt&&i.typeInfo instanceof Aa){if(i.typeInfo.format.name==="u32")return Array.from(new Uint32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="i32")return Array.from(new Int32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="f32")return Array.from(new Float32Array(i.buffer,i.offset,i.typeInfo.count))}return console.error(`Unsupported return variable type ${i.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,r,i){const s=this.context.clone();(i=i??{}).constants&&this._setOverrides(i.constants,s),this._execStatements(this.ast,s);const o=s.getFunction(e);if(!o)return void console.error(`Function ${e} not found`);if(typeof t=="number")t=[t,1,1];else{if(t.length===0)return void console.error("Invalid dispatch count");t.length===1?t=[t[0],1,1]:t.length===2?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const a=t[0],u=t[1],h=t[2],d=this.getTypeInfo("vec3u");s.setVariable("@num_workgroups",new X(t,d));const g=this.reflection.getFunctionInfo(e);g===null&&console.error(`Function ${e} not found in reflection data`);for(const y in r)for(const v in r[y]){const T=r[y][v];s.variables.forEach(w=>{var E;const S=w.node;if(S?.attributes){let P=null,I=null;for(const L of S.attributes)L.name==="binding"?P=L.value:L.name==="group"&&(I=L.value);if(v==P&&y==I){let L=!1;for(const F of g.resources)if(F.name===w.name&&F.group===parseInt(y)&&F.binding===parseInt(v)){L=!0;break}if(L)if(T.texture!==void 0&&T.descriptor!==void 0){const F=new Hs(T.texture,this.getTypeInfo(S.type),T.descriptor,(E=T.texture.view)!==null&&E!==void 0?E:null);w.value=F}else T.uniform!==void 0?w.value=new Xt(T.uniform,this.getTypeInfo(S.type)):w.value=new Xt(T,this.getTypeInfo(S.type))}}})}for(let y=0;y<h;++y)for(let v=0;v<u;++v)for(let T=0;T<a;++T)s.setVariable("@workgroup_id",new X([T,v,y],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(o,[T,v,y],s)}execStatement(e,t){if(e instanceof cU)return this.evalExpression(e.value,t);if(e instanceof hU){if(e.condition){const r=this.evalExpression(e.condition,t);if(!(r instanceof J))throw new Error("Invalid break-if condition");if(!r.value)return null}return Zn._breakObj}if(e instanceof fU)return Zn._continueObj;if(e instanceof Td)this._let(e,t);else if(e instanceof $s)this._var(e,t);else if(e instanceof ly)this._const(e,t);else if(e instanceof Gd)this._function(e,t);else{if(e instanceof lU)return this._if(e,t);if(e instanceof aU)return this._switch(e,t);if(e instanceof rU)return this._for(e,t);if(e instanceof nU)return this._while(e,t);if(e instanceof oU)return this._loop(e,t);if(e instanceof Xw){const r=t.clone();return r.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,r)}if(e instanceof sU)this._assign(e,t);else if(e instanceof iU)this._increment(e,t);else{if(e instanceof js)return null;if(e instanceof C1){const r=e.name;t.getVariable(r)===null&&t.setVariable(r,new J(0,this.getTypeInfo("u32")))}else if(e instanceof I1)this._call(e,t);else{if(e instanceof uU||e instanceof P1)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){return e instanceof bi?this._evalBinaryOp(e,t):e instanceof _n?this._evalLiteral(e,t):e instanceof Dr?this._evalVariable(e,t):e instanceof M1?this._evalCall(e,t):e instanceof Zi?this._evalCreate(e,t):e instanceof dU?this._evalConst(e,t):e instanceof pU?this._evalBitcast(e,t):e instanceof ln?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof _e){const i=this.reflection.getTypeInfo(e);if(i!==null)return i}let r=(t=this.typeInfo[e])!==null&&t!==void 0?t:null;return r!==null||(r=this.reflection.getTypeInfoByName(e)),r}_setOverrides(e,t){for(const r in e){const i=e[r],s=this.reflection.getOverrideInfo(r);s!==null?(s.type===null&&(s.type=this.getTypeInfo("u32")),s.type.name==="u32"||s.type.name==="i32"||s.type.name==="f32"||s.type.name==="f16"?t.setVariable(r,new J(i,s.type)):s.type.name==="bool"?t.setVariable(r,new J(i?1:0,s.type)):s.type.name==="vec2"||s.type.name==="vec3"||s.type.name==="vec4"||s.type.name==="vec2f"||s.type.name==="vec3f"||s.type.name==="vec4f"||s.type.name==="vec2i"||s.type.name==="vec3i"||s.type.name==="vec4i"||s.type.name==="vec2u"||s.type.name==="vec3u"||s.type.name==="vec4u"||s.type.name==="vec2h"||s.type.name==="vec3h"||s.type.name==="vec4h"?t.setVariable(r,new X(i,s.type)):console.error(`Invalid constant type for ${r}`)):console.error(`Override ${r} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,r){const i=[1,1,1];for(const d of e.node.attributes)if(d.name==="workgroup_size"){if(d.value.length>0){const g=r.getVariableValue(d.value[0]);i[0]=g instanceof J?g.value:parseInt(d.value[0])}if(d.value.length>1){const g=r.getVariableValue(d.value[1]);i[1]=g instanceof J?g.value:parseInt(d.value[1])}if(d.value.length>2){const g=r.getVariableValue(d.value[2]);i[2]=g instanceof J?g.value:parseInt(d.value[2])}}const s=this.getTypeInfo("vec3u"),o=this.getTypeInfo("u32");r.setVariable("@workgroup_size",new X(i,s));const a=i[0],u=i[1],h=i[2];for(let d=0,g=0;d<h;++d)for(let y=0;y<u;++y)for(let v=0;v<a;++v,++g){const T=[v,y,d],w=[v+t[0]*i[0],y+t[1]*i[1],d+t[2]*i[2]];r.setVariable("@local_invocation_id",new X(T,s)),r.setVariable("@global_invocation_id",new X(w,s)),r.setVariable("@local_invocation_index",new J(g,o)),this._dispatchExec(e,r)}}_dispatchExec(e,t){for(const r of e.node.args)for(const i of r.attributes)if(i.name==="builtin"){const s=`@${i.value}`,o=t.getVariable(s);o!==void 0&&t.variables.set(r.name,o)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof ln;)e=e.right;return e instanceof Dr?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(const r of e){if(r instanceof Array){const s=t.clone(),o=this._execStatements(r,s);if(o)return o;continue}const i=this.execStatement(r,t);if(i)return i}return null}_call(e,t){const r=t.clone();r.currentFunctionName=e.name;const i=t.getFunction(e.name);if(i){for(let s=0;s<i.node.args.length;++s){const o=i.node.args[s],a=this.evalExpression(e.args[s],r);r.setVariable(o.name,a,o)}this._execStatements(i.node.body,r)}else e.isBuiltin?this._callBuiltinFunction(e,r):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){const r=this.getVariableName(e.variable,t),i=t.getVariable(r);i?e.operator==="++"?i.value instanceof J?i.value.value++:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):e.operator==="--"?i.value instanceof J?i.value.value--:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${r} not found. Line ${e.line}`)}_getVariableData(e,t){if(e instanceof Dr){const r=this.getVariableName(e,t),i=t.getVariable(r);return i===null?(console.error(`Variable ${r} not found. Line ${e.line}`),null):i.value.getSubData(this,e.postfix,t)}if(e instanceof ln){if(e.operator==="*"){const r=this._getVariableData(e.right,t);return r instanceof cu?r.reference.getSubData(this,e.postfix,t):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const r=this._getVariableData(e.right,t);return new cu(r)}}return null}_assign(e,t){let r=null,i="<var>",s=null;if(e.variable instanceof ln){const u=this._getVariableData(e.variable,t),h=this.evalExpression(e.value,t),d=e.operator;if(d==="="){if(u instanceof J||u instanceof X||u instanceof Be){if(h instanceof J||h instanceof X||h instanceof Be&&u.data.length===h.data.length)return void u.data.set(h.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(u instanceof Xt&&h instanceof Xt&&u.buffer.byteLength-u.offset>=h.buffer.byteLength-h.offset)return void(u.buffer.byteLength%4==0?new Uint32Array(u.buffer,u.offset,u.typeInfo.size/4).set(new Uint32Array(h.buffer,h.offset,h.typeInfo.size/4)):new Uint8Array(u.buffer,u.offset,u.typeInfo.size).set(new Uint8Array(h.buffer,h.offset,h.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(d==="+=")return u instanceof J||u instanceof X||u instanceof Be?h instanceof J||h instanceof X||h instanceof Be?void u.data.set(h.data.map((g,y)=>u.data[y]+g)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(d==="-=")return(u instanceof J||u instanceof X||u instanceof Be)&&(h instanceof J||h instanceof X||h instanceof Be)?void u.data.set(h.data.map((g,y)=>u.data[y]-g)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof ln){if(e.variable.operator==="*"){i=this.getVariableName(e.variable.right,t);const u=t.getVariable(i);if(!(u&&u.value instanceof cu))return void console.error(`Variable ${i} is not a pointer. Line ${e.line}`);r=u.value.reference;let h=e.variable.postfix;if(!h){let d=e.variable.right;for(;d instanceof ln;){if(d.postfix){h=d.postfix;break}d=d.right}}h&&(r=r.getSubData(this,h,t))}}else{s=e.variable.postfix,i=this.getVariableName(e.variable,t);const u=t.getVariable(i);if(u===null)return void console.error(`Variable ${i} not found. Line ${e.line}`);r=u.value}if(r instanceof cu&&(r=r.reference),r===null)return void console.error(`Variable ${i} not found. Line ${e.line}`);const o=this.evalExpression(e.value,t),a=e.operator;if(a!=="="){const u=r.getSubData(this,s,t);if(u instanceof X&&o instanceof J){const h=u.data,d=o.value;if(a==="+=")for(let g=0;g<h.length;++g)h[g]+=d;else if(a==="-=")for(let g=0;g<h.length;++g)h[g]-=d;else if(a==="*=")for(let g=0;g<h.length;++g)h[g]*=d;else if(a==="/=")for(let g=0;g<h.length;++g)h[g]/=d;else if(a==="%=")for(let g=0;g<h.length;++g)h[g]%=d;else if(a==="&=")for(let g=0;g<h.length;++g)h[g]&=d;else if(a==="|=")for(let g=0;g<h.length;++g)h[g]|=d;else if(a==="^=")for(let g=0;g<h.length;++g)h[g]^=d;else if(a==="<<=")for(let g=0;g<h.length;++g)h[g]<<=d;else if(a===">>=")for(let g=0;g<h.length;++g)h[g]>>=d;else console.error(`Invalid operator ${a}. Line ${e.line}`)}else if(u instanceof X&&o instanceof X){const h=u.data,d=o.data;if(h.length!==d.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(a==="+=")for(let g=0;g<h.length;++g)h[g]+=d[g];else if(a==="-=")for(let g=0;g<h.length;++g)h[g]-=d[g];else if(a==="*=")for(let g=0;g<h.length;++g)h[g]*=d[g];else if(a==="/=")for(let g=0;g<h.length;++g)h[g]/=d[g];else if(a==="%=")for(let g=0;g<h.length;++g)h[g]%=d[g];else if(a==="&=")for(let g=0;g<h.length;++g)h[g]&=d[g];else if(a==="|=")for(let g=0;g<h.length;++g)h[g]|=d[g];else if(a==="^=")for(let g=0;g<h.length;++g)h[g]^=d[g];else if(a==="<<=")for(let g=0;g<h.length;++g)h[g]<<=d[g];else if(a===">>=")for(let g=0;g<h.length;++g)h[g]>>=d[g];else console.error(`Invalid operator ${a}. Line ${e.line}`)}else{if(!(u instanceof J&&o instanceof J))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);a==="+="?u.value+=o.value:a==="-="?u.value-=o.value:a==="*="?u.value*=o.value:a==="/="?u.value/=o.value:a==="%="?u.value%=o.value:a==="&="?u.value&=o.value:a==="|="?u.value|=o.value:a==="^="?u.value^=o.value:a==="<<="?u.value<<=o.value:a===">>="?u.value>>=o.value:console.error(`Invalid operator ${a}. Line ${e.line}`)}return void(r instanceof Xt&&r.setDataValue(this,u,s,t))}if(r instanceof Xt)r.setDataValue(this,o,s,t);else if(s){if(!(r instanceof X||r instanceof Be))return void console.error(`Variable ${i} is not a vector or matrix. Line ${e.line}`);if(s instanceof ih){const u=this.evalExpression(s.index,t).value;if(r instanceof X){if(!(o instanceof J))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[u]=o.value}else{if(!(r instanceof Be))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const h=this.evalExpression(s.index,t).value;if(h<0)return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(o instanceof X))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const d=r.typeInfo.getTypeName();if(d==="mat2x2"||d==="mat2x2f"||d==="mat2x2h"){if(!(h<2&&o.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[2*h]=o.data[0],r.data[2*h+1]=o.data[1]}else if(d==="mat2x3"||d==="mat2x3f"||d==="mat2x3h"){if(!(h<2&&o.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[3*h]=o.data[0],r.data[3*h+1]=o.data[1],r.data[3*h+2]=o.data[2]}else if(d==="mat2x4"||d==="mat2x4f"||d==="mat2x4h"){if(!(h<2&&o.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[4*h]=o.data[0],r.data[4*h+1]=o.data[1],r.data[4*h+2]=o.data[2],r.data[4*h+3]=o.data[3]}else if(d==="mat3x2"||d==="mat3x2f"||d==="mat3x2h"){if(!(h<3&&o.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[2*h]=o.data[0],r.data[2*h+1]=o.data[1]}else if(d==="mat3x3"||d==="mat3x3f"||d==="mat3x3h"){if(!(h<3&&o.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[3*h]=o.data[0],r.data[3*h+1]=o.data[1],r.data[3*h+2]=o.data[2]}else if(d==="mat3x4"||d==="mat3x4f"||d==="mat3x4h"){if(!(h<3&&o.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[4*h]=o.data[0],r.data[4*h+1]=o.data[1],r.data[4*h+2]=o.data[2],r.data[4*h+3]=o.data[3]}else if(d==="mat4x2"||d==="mat4x2f"||d==="mat4x2h"){if(!(h<4&&o.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[2*h]=o.data[0],r.data[2*h+1]=o.data[1]}else if(d==="mat4x3"||d==="mat4x3f"||d==="mat4x3h"){if(!(h<4&&o.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[3*h]=o.data[0],r.data[3*h+1]=o.data[1],r.data[3*h+2]=o.data[2]}else{if(d!=="mat4x4"&&d!=="mat4x4f"&&d!=="mat4x4h")return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(h<4&&o.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[4*h]=o.data[0],r.data[4*h+1]=o.data[1],r.data[4*h+2]=o.data[2],r.data[4*h+3]=o.data[3]}}}}}else if(s instanceof ec){const u=s.value;if(!(r instanceof X))return void console.error(`Invalid assignment to ${u}. Variable ${i} is not a vector. Line ${e.line}`);if(o instanceof J){if(u.length>1)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);if(u==="x")r.data[0]=o.value;else if(u==="y"){if(r.data.length<2)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);r.data[1]=o.value}else if(u==="z"){if(r.data.length<3)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);r.data[2]=o.value}else if(u==="w"){if(r.data.length<4)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);r.data[3]=o.value}}else{if(!(o instanceof X))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(u.length!==o.data.length)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);for(let h=0;h<u.length;++h){const d=u[h];if(d==="x"||d==="r")r.data[0]=o.data[h];else if(d==="y"||d==="g"){if(o.data.length<2)return void console.error(`Invalid assignment to ${d} for variable ${i}. Line ${e.line}`);r.data[1]=o.data[h]}else if(d==="z"||d==="b"){if(o.data.length<3)return void console.error(`Invalid assignment to ${d} for variable ${i}. Line ${e.line}`);r.data[2]=o.data[h]}else{if(d!=="w"&&d!=="a")return void console.error(`Invalid assignment to ${d} for variable ${i}. Line ${e.line}`);if(o.data.length<4)return void console.error(`Invalid assignment to ${d} for variable ${i}. Line ${e.line}`);r.data[3]=o.data[h]}}}}}else r instanceof J&&o instanceof J?r.value=o.value:r instanceof X&&o instanceof X||r instanceof Be&&o instanceof Be?r.data.set(o.data):console.error(`Invalid assignment to ${i}. Line ${e.line}`)}_function(e,t){const r=new N1(e);t.functions.set(e.name,r)}_const(e,t){let r=null;e.value!==null&&(r=this.evalExpression(e.value,t)),t.createVariable(e.name,r,e)}_let(e,t){let r=null;if(e.value!==null){if(r=this.evalExpression(e.value,t),r===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof ln||(r=r.clone())}else{const i=e.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||i==="array"){const s=new Zi(e.type,[]);r=this._evalCreate(s,t)}}t.createVariable(e.name,r,e)}_var(e,t){let r=null;if(e.value!==null){if(r=this.evalExpression(e.value,t),r===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof ln||(r=r.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const i=e.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||e.type instanceof wd||e.type instanceof js||e.type instanceof re){const s=new Zi(e.type,[]);r=this._evalCreate(s,t)}}t.createVariable(e.name,r,e)}_switch(e,t){t=t.clone();const r=this.evalExpression(e.condition,t);if(!(r instanceof J))return console.error(`Invalid if condition. Line ${e.line}`),null;let i=null;for(const s of e.cases)if(s instanceof yU)for(const o of s.selectors){if(o instanceof uy){i=s;continue}const a=this.evalExpression(o,t);if(!(a instanceof J))return console.error(`Invalid case selector. Line ${e.line}`),null;if(a.value===r.value)return this._execStatements(s.body,t)}else s instanceof _U&&(i=s);return i?this._execStatements(i.body,t):null}_if(e,t){t=t.clone();const r=this.evalExpression(e.condition,t);if(!(r instanceof J))return console.error(`Invalid if condition. Line ${e.line}`),null;if(r.value)return this._execStatements(e.body,t);for(const i of e.elseif){const s=this.evalExpression(i.condition,t);if(!(s instanceof J))return console.error(`Invalid if condition. Line ${e.line}`),null;if(s.value)return this._execStatements(i.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof J?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const r=this._execStatements(e.body,t);if(r===Zn._breakObj)break;if(r!==null&&r!==Zn._continueObj)return r;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const r=this._execStatements(e.body,t);if(r===Zn._breakObj)break;if(r===Zn._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===Zn._breakObj)break}else if(r!==null)return r}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const r=this._execStatements(e.body,t);if(r===Zn._breakObj)break;if(r!==Zn._continueObj&&r!==null)return r}return null}_evalBitcast(e,t){const r=this.evalExpression(e.value,t),i=e.type;if(r instanceof J){const s=_P(r.value,r.typeInfo.name,i.name);return new J(s,this.getTypeInfo(i))}if(r instanceof X){const s=r.typeInfo.getTypeName();let o="";if(s.endsWith("f"))o="f32";else if(s.endsWith("i"))o="i32";else if(s.endsWith("u"))o="u32";else if(s.endsWith("b"))o="bool";else{if(!s.endsWith("h"))return console.error(`Unknown vector type ${s}. Line ${e.line}`),null;o="f16"}const a=i.getTypeName();let u="";if(a.endsWith("f"))u="f32";else if(a.endsWith("i"))u="i32";else if(a.endsWith("u"))u="u32";else if(a.endsWith("b"))u="bool";else{if(!a.endsWith("h"))return console.error(`Unknown vector type ${u}. Line ${e.line}`),null;u="f16"}const h=(function(d,g,y){if(g===y)return d;const v=new Array(d.length);for(let T=0;T<d.length;T++)v[T]=_P(d[T],g,y);return v})(Array.from(r.data),o,u);return new X(h,this.getTypeInfo(i))}return console.error(`TODO: bitcast for ${r.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var r;if(e instanceof Zi){if(e.type===null)return Yw.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}const i=e instanceof Zi?e.type.name:e.name,s=e instanceof Zi?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(s===null)return console.error(`Unknown type ${i}. Line ${e.line}`),null;if(s.size===0)return null;const o=new Xt(new ArrayBuffer(s.size),s,0);if(s instanceof pa){if(e.args)for(let a=0;a<e.args.length;++a){const u=s.members[a],h=e.args[a],d=this.evalExpression(h,t);o.setData(this,d,u.type,u.offset,t)}}else if(s instanceof Aa){let a=0;if(e.args)for(let u=0;u<e.args.length;++u){const h=e.args[u],d=this.evalExpression(h,t);s.format===null&&(((r=d.typeInfo)===null||r===void 0?void 0:r.name)==="x32"?s.format=this.getTypeInfo("i32"):s.format=d.typeInfo),o.setData(this,d,s.format,a,t),a+=s.stride}}else console.error(`Unknown type "${i}". Line ${e.line}`);return e instanceof Zi?o.getSubData(this,e.postfix,t):o}_evalLiteral(e,t){const r=this.getTypeInfo(e.type),i=r.name;return i==="x32"||i==="u32"||i==="f32"||i==="f16"||i==="i32"||i==="bool"?new J(e.scalarValue,r):i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"?this._callConstructorVec(e,t):i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const r=t.getVariableValue(e.name);return r===null?r:r.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if(t.name==="f32")return t;for(let r=1;r<e.length;++r){const i=Zn._priority.get(t.name);Zn._priority.get(e[r].name)<i&&(t=e[r])}return t.name==="x32"?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const r=this.evalExpression(e.right,t);if(e.operator==="&")return new cu(r);if(e.operator==="*")return r instanceof cu?r.reference.getSubData(this,e.postfix,t):(console.error(`Invalid dereference. Line ${e.line}`),null);const i=r instanceof J?r.value:r instanceof X?Array.from(r.data):null;switch(e.operator){case"+":{if(Re(i)){const a=i.map((u,h)=>+u);return new X(a,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new J(+s,o)}case"-":{if(Re(i)){const a=i.map((u,h)=>-u);return new X(a,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new J(-s,o)}case"!":{if(Re(i)){const a=i.map((u,h)=>u?0:1);return new X(a,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new J(s?0:1,o)}case"~":{if(Re(i)){const a=i.map((u,h)=>~u);return new X(a,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new J(~s,o)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){const r=this.evalExpression(e.left,t),i=this.evalExpression(e.right,t),s=r instanceof J?r.value:r instanceof X||r instanceof Be?Array.from(r.data):null,o=i instanceof J?i.value:i instanceof X||i instanceof Be?Array.from(i.data):null;switch(e.operator){case"+":{if(Re(s)&&Re(o)){const d=s,g=o;if(d.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=d.map((v,T)=>v+g[T]);return new X(y,r.typeInfo)}if(Re(s)){const d=o,g=s.map((y,v)=>y+d);return new X(g,r.typeInfo)}if(Re(o)){const d=s,g=o.map((y,v)=>d+y);return new X(g,i.typeInfo)}const a=s,u=o,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new J(a+u,h)}case"-":{if(Re(s)&&Re(o)){const d=s,g=o;if(d.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=d.map((v,T)=>v-g[T]);return new X(y,r.typeInfo)}if(Re(s)){const d=o,g=s.map((y,v)=>y-d);return new X(g,r.typeInfo)}if(Re(o)){const d=s,g=o.map((y,v)=>d-y);return new X(g,i.typeInfo)}const a=s,u=o,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new J(a-u,h)}case"*":{if(Re(s)&&Re(o)){const d=s,g=o;if(r instanceof Be&&i instanceof Be){const y=(function(E,S,P,I){if(hr[S.name]===void 0||hr[I.name]===void 0)return null;const L=hr[S.name][0],F=hr[S.name][1],Y=hr[I.name][0];if(L!==hr[I.name][1])return null;const k=new Array(Y*F);for(let M=0;M<F;M++)for(let N=0;N<Y;N++){let H=0;for(let q=0;q<L;q++)H+=E[q*F+M]*P[N*L+q];k[M*Y+N]=H}return k})(d,r.typeInfo,g,i.typeInfo);if(y===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const v=hr[i.typeInfo.name][0],T=hr[r.typeInfo.name][1],w=this.getTypeInfo(`mat${v}x${T}f`);return new Be(y,w)}if(r instanceof Be&&i instanceof X){const y=(function(v,T,w,E){if(hr[T.name]===void 0||fT[E.name]===void 0)return null;const S=hr[T.name][0],P=hr[T.name][1];if(S!==w.length)return null;const I=new Array(P);for(let L=0;L<P;L++){let F=0;for(let Y=0;Y<S;Y++)F+=v[Y*P+L]*w[Y];I[L]=F}return I})(d,r.typeInfo,g,i.typeInfo);return y===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new X(y,i.typeInfo)}if(r instanceof X&&i instanceof Be){const y=(function(v,T,w,E){if(fT[T.name]===void 0||hr[E.name]===void 0)return null;const S=hr[E.name][0],P=hr[E.name][1];if(P!==v.length)return null;const I=[];for(let L=0;L<S;L++){let F=0;for(let Y=0;Y<P;Y++)F+=v[Y]*w[Y*S+L];I[L]=F}return I})(d,r.typeInfo,g,i.typeInfo);return y===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new X(y,r.typeInfo)}{if(d.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=d.map((v,T)=>v*g[T]);return new X(y,r.typeInfo)}}if(Re(s)){const d=o,g=s.map((y,v)=>y*d);return r instanceof Be?new Be(g,r.typeInfo):new X(g,r.typeInfo)}if(Re(o)){const d=s,g=o.map((y,v)=>d*y);return i instanceof Be?new Be(g,i.typeInfo):new X(g,i.typeInfo)}const a=s,u=o,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new J(a*u,h)}case"%":{if(Re(s)&&Re(o)){const d=s,g=o;if(d.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=d.map((v,T)=>v%g[T]);return new X(y,r.typeInfo)}if(Re(s)){const d=o,g=s.map((y,v)=>y%d);return new X(g,r.typeInfo)}if(Re(o)){const d=s,g=o.map((y,v)=>d%y);return new X(g,i.typeInfo)}const a=s,u=o,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new J(a%u,h)}case"/":{if(Re(s)&&Re(o)){const d=s,g=o;if(d.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=d.map((v,T)=>v/g[T]);return new X(y,r.typeInfo)}if(Re(s)){const d=o,g=s.map((y,v)=>y/d);return new X(g,r.typeInfo)}if(Re(o)){const d=s,g=o.map((y,v)=>d/y);return new X(g,i.typeInfo)}const a=s,u=o,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new J(a/u,h)}case"&":{if(Re(s)&&Re(o)){const d=s,g=o;if(d.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=d.map((v,T)=>v&g[T]);return new X(y,r.typeInfo)}if(Re(s)){const d=o,g=s.map((y,v)=>y&d);return new X(g,r.typeInfo)}if(Re(o)){const d=s,g=o.map((y,v)=>d&y);return new X(g,i.typeInfo)}const a=s,u=o,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new J(a&u,h)}case"|":{if(Re(s)&&Re(o)){const d=s,g=o;if(d.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=d.map((v,T)=>v|g[T]);return new X(y,r.typeInfo)}if(Re(s)){const d=o,g=s.map((y,v)=>y|d);return new X(g,r.typeInfo)}if(Re(o)){const d=s,g=o.map((y,v)=>d|y);return new X(g,i.typeInfo)}const a=s,u=o,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new J(a|u,h)}case"^":{if(Re(s)&&Re(o)){const d=s,g=o;if(d.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=d.map((v,T)=>v^g[T]);return new X(y,r.typeInfo)}if(Re(s)){const d=o,g=s.map((y,v)=>y^d);return new X(g,r.typeInfo)}if(Re(o)){const d=s,g=o.map((y,v)=>d^y);return new X(g,i.typeInfo)}const a=s,u=o,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new J(a^u,h)}case"<<":{if(Re(s)&&Re(o)){const d=s,g=o;if(d.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=d.map((v,T)=>v<<g[T]);return new X(y,r.typeInfo)}if(Re(s)){const d=o,g=s.map((y,v)=>y<<d);return new X(g,r.typeInfo)}if(Re(o)){const d=s,g=o.map((y,v)=>d<<y);return new X(g,i.typeInfo)}const a=s,u=o,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new J(a<<u,h)}case">>":{if(Re(s)&&Re(o)){const d=s,g=o;if(d.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=d.map((v,T)=>v>>g[T]);return new X(y,r.typeInfo)}if(Re(s)){const d=o,g=s.map((y,v)=>y>>d);return new X(g,r.typeInfo)}if(Re(o)){const d=s,g=o.map((y,v)=>d>>y);return new X(g,i.typeInfo)}const a=s,u=o,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new J(a>>u,h)}case">":if(Re(s)&&Re(o)){const a=s,u=o;if(a.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=a.map((d,g)=>d>u[g]?1:0);return new X(h,r.typeInfo)}if(Re(s)){const a=o,u=s.map((h,d)=>h>a?1:0);return new X(u,r.typeInfo)}if(Re(o)){const a=s,u=o.map((h,d)=>a>h?1:0);return new X(u,i.typeInfo)}return new J(s>o?1:0,this.getTypeInfo("bool"));case"<":if(Re(s)&&Re(o)){const a=s,u=o;if(a.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=a.map((d,g)=>d<u[g]?1:0);return new X(h,r.typeInfo)}if(Re(s)){const a=o,u=s.map((h,d)=>h<a?1:0);return new X(u,r.typeInfo)}if(Re(o)){const a=s,u=o.map((h,d)=>a<h?1:0);return new X(u,i.typeInfo)}return new J(s<o?1:0,this.getTypeInfo("bool"));case"==":if(Re(s)&&Re(o)){const a=s,u=o;if(a.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=a.map((d,g)=>d===u[g]?1:0);return new X(h,r.typeInfo)}if(Re(s)){const a=o,u=s.map((h,d)=>h==a?1:0);return new X(u,r.typeInfo)}if(Re(o)){const a=s,u=o.map((h,d)=>a==h?1:0);return new X(u,i.typeInfo)}return new J(s===o?1:0,this.getTypeInfo("bool"));case"!=":if(Re(s)&&Re(o)){const a=s,u=o;if(a.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=a.map((d,g)=>d!==u[g]?1:0);return new X(h,r.typeInfo)}if(Re(s)){const a=o,u=s.map((h,d)=>h!==a?1:0);return new X(u,r.typeInfo)}if(Re(o)){const a=s,u=o.map((h,d)=>a!==h?1:0);return new X(u,i.typeInfo)}return new J(s!==o?1:0,this.getTypeInfo("bool"));case">=":if(Re(s)&&Re(o)){const a=s,u=o;if(a.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=a.map((d,g)=>d>=u[g]?1:0);return new X(h,r.typeInfo)}if(Re(s)){const a=o,u=s.map((h,d)=>h>=a?1:0);return new X(u,r.typeInfo)}if(Re(o)){const a=s,u=o.map((h,d)=>a>=h?1:0);return new X(u,i.typeInfo)}return new J(s>=o?1:0,this.getTypeInfo("bool"));case"<=":if(Re(s)&&Re(o)){const a=s,u=o;if(a.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=a.map((d,g)=>d<=u[g]?1:0);return new X(h,r.typeInfo)}if(Re(s)){const a=o,u=s.map((h,d)=>h<=a?1:0);return new X(u,r.typeInfo)}if(Re(o)){const a=s,u=o.map((h,d)=>a<=h?1:0);return new X(u,i.typeInfo)}return new J(s<=o?1:0,this.getTypeInfo("bool"));case"&&":if(Re(s)&&Re(o)){const a=s,u=o;if(a.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=a.map((d,g)=>d&&u[g]?1:0);return new X(h,r.typeInfo)}if(Re(s)){const a=o,u=s.map((h,d)=>h&&a?1:0);return new X(u,r.typeInfo)}if(Re(o)){const a=s,u=o.map((h,d)=>a&&h?1:0);return new X(u,i.typeInfo)}return new J(s&&o?1:0,this.getTypeInfo("bool"));case"||":if(Re(s)&&Re(o)){const a=s,u=o;if(a.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=a.map((d,g)=>d||u[g]?1:0);return new X(h,r.typeInfo)}if(Re(s)){const a=o,u=s.map((h,d)=>h||a?1:0);return new X(u,r.typeInfo)}if(Re(o)){const a=s,u=o.map((h,d)=>a||h?1:0);return new X(u,i.typeInfo)}return new J(s||o?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const r=t.clone();r.currentFunctionName=e.name;const i=t.getFunction(e.name);if(!i)return e.isBuiltin?this._callBuiltinFunction(e,r):this.getTypeInfo(e.name)?this._evalCreate(e,t):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let s=0;s<i.node.args.length;++s){const o=i.node.args[s],a=this.evalExpression(e.args[s],r);r.createVariable(o.name,a,o)}return this._execStatements(i.node.body,r)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothstep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const r=t.getFunction(e.name);if(r){const i=t.clone();for(let s=0;s<r.node.args.length;++s){const o=r.node.args[s],a=this.evalExpression(e.args[s],i);i.setVariable(o.name,a,o)}return this._execStatements(r.node.body,i)}return null}_callConstructorValue(e,t){if(!e.args||e.args.length===0)return new J(0,this.getTypeInfo(e.type));const r=this.evalExpression(e.args[0],t);return r.typeInfo=this.getTypeInfo(e.type),r.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){const r=this.getTypeInfo(e.type),i=e.type.getTypeName(),s=fT[i];if(s===void 0)return console.error(`Invalid vec constructor ${i}. Line ${e.line}`),null;const o=[];if(e instanceof _n)if(e.isVector){const a=e.vectorValue;for(const u of a)o.push(u)}else o.push(e.scalarValue);else if(e.args)for(const a of e.args){const u=this.evalExpression(a,t);if(u instanceof X){const h=u.data;for(let d=0;d<h.length;++d){let g=h[d];o.push(g)}}else if(u instanceof J){let h=u.value;o.push(h)}}if(e.type instanceof re&&e.type.format===null&&(e.type.format=re.f32),o.length===0){const a=new Array(s).fill(0);return new X(a,r).getSubData(this,e.postfix,t)}if(o.length===1)for(;o.length<s;)o.push(o[0]);return o.length<s?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new X(o.length>s?o.slice(0,s):o,r).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){const r=this.getTypeInfo(e.type),i=e.type.getTypeName(),s=hr[i];if(s===void 0)return console.error(`Invalid matrix constructor ${i}. Line ${e.line}`),null;const o=[];if(e instanceof _n)if(e.isVector){const a=e.vectorValue;for(const u of a)o.push(u)}else o.push(e.scalarValue);else if(e.args)for(const a of e.args){const u=this.evalExpression(a,t);u instanceof X?o.push(...u.data):u instanceof J?o.push(u.value):u instanceof Be&&o.push(...u.data)}if(r instanceof Jl&&r.format===null&&(r.format=this.getTypeInfo("f32")),o.length===0){const a=new Array(s[2]).fill(0);return new Be(a,r).getSubData(this,e.postfix,t)}return o.length!==s[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new Be(o,r).getSubData(this,e.postfix,t)}}Zn._breakObj=new ai(new ri("BREAK",null),null),Zn._continueObj=new ai(new ri("CONTINUE",null),null),Zn._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class Rne{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class Cne{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new Rne,this._exec=new Zn,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const r=this._global_decl_or_directive();if(!r)break;t.push(r)}if(this._deferArrayCountEval.length>0){for(const r of this._deferArrayCountEval){const i=r.arrayType,s=r.countNode;if(s instanceof Dr){const o=s.name,a=this._context.constants.get(o);if(a)try{const u=a.constEvaluate(this._exec);i.count=u}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const r of t)r.search(i=>{i instanceof mP||i instanceof cy?i.type=this._forwardType(i.type):i instanceof wd?i.format=this._forwardType(i.format):i instanceof $s||i instanceof Td||i instanceof ly?i.type=this._forwardType(i.type):i instanceof Gd?i.returnType=this._forwardType(i.returnType):i instanceof gP&&(i.type=this._forwardType(i.type))});return t}_forwardType(e){if(e instanceof pP){const t=this._getType(e.name);if(t)return t}else e instanceof cy?e.type=this._forwardType(e.type):e instanceof wd&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const t=new yne(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=t??this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==z.eof}_match(e){if(e instanceof te)return!!this._check(e)&&(this._advance(),!0);for(let t=0,r=e.length;t<r;++t){const i=e[t];if(this._check(i))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const r=t.type;let i=!1;for(const s of e){if(r===s)return!0;s===z.tokens.name&&(i=!0)}if(i){const s=z.tokens.name.rule.exec(t.lexeme);if(s&&s.index==0&&s[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===z.tokens.name){const r=z.tokens.name.rule.exec(t.lexeme);return r&&r.index==0&&r[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=(t=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&t!==void 0?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(z.tokens.semicolon)&&!this._isAtEnd(););if(this._match(z.keywords.alias)){const t=this._type_alias();return this._consume(z.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(z.keywords.diagnostic)){const t=this._diagnostic();return this._consume(z.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(z.keywords.requires)){const t=this._requires_directive();return this._consume(z.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(z.keywords.enable)){const t=this._enable_directive();return this._consume(z.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}const e=this._attribute();if(this._check(z.keywords.var)){const t=this._global_variable_decl();return t!=null&&(t.attributes=e),this._consume(z.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(z.keywords.override)){const t=this._override_variable_decl();return t!=null&&(t.attributes=e),this._consume(z.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(z.keywords.let)){const t=this._global_let_decl();return t!=null&&(t.attributes=e),this._consume(z.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(z.keywords.const)){const t=this._global_const_decl();return t!=null&&(t.attributes=e),this._consume(z.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(z.keywords.struct)){const t=this._struct_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(z.keywords.fn)){const t=this._function_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(z.keywords.fn))return null;const e=this._currentLine,t=this._consume(z.tokens.ident,"Expected function name.").toString();this._consume(z.tokens.paren_left,"Expected '(' for function arguments.");const r=[];if(!this._check(z.tokens.paren_right))do{if(this._check(z.tokens.paren_right))break;const a=this._attribute(),u=this._consume(z.tokens.name,"Expected argument name.").toString();this._consume(z.tokens.colon,"Expected ':' for argument type.");const h=this._attribute(),d=this._type_decl();d!=null&&(d.attributes=h,r.push(this._updateNode(new gP(u,d,a))))}while(this._match(z.tokens.comma));this._consume(z.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(z.tokens.arrow)){const a=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=a)}const s=this._compound_statement(),o=this._currentLine;return this._updateNode(new Gd(t,r,i,s,e,o),e)}_compound_statement(){const e=[];for(this._consume(z.tokens.brace_left,"Expected '{' for block.");!this._check(z.tokens.brace_right);){const t=this._statement();t!==null&&e.push(t)}return this._consume(z.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(z.tokens.semicolon)&&!this._isAtEnd(););if(this._check(z.tokens.attr)&&this._attribute(),this._check(z.keywords.if))return this._if_statement();if(this._check(z.keywords.switch))return this._switch_statement();if(this._check(z.keywords.loop))return this._loop_statement();if(this._check(z.keywords.for))return this._for_statement();if(this._check(z.keywords.while))return this._while_statement();if(this._check(z.keywords.continuing))return this._continuing_statement();if(this._check(z.keywords.static_assert))return this._static_assert_statement();if(this._check(z.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(z.keywords.return))e=this._return_statement();else if(this._check([z.keywords.var,z.keywords.let,z.keywords.const]))e=this._variable_statement();else if(this._match(z.keywords.discard))e=this._updateNode(new pne);else if(this._match(z.keywords.break)){const t=this._updateNode(new hU);if(this._currentLoop.length>0){const r=this._currentLoop[this._currentLoop.length-1];t.loopId=r.id}e=t,this._check(z.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(z.keywords.continue)){const t=this._updateNode(new fU);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{const r=this._currentLoop[this._currentLoop.length-1];t.loopId=r.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(z.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(z.keywords.static_assert))return null;const e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new hne(t),e)}_while_statement(){if(!this._match(z.keywords.while))return null;const e=this._updateNode(new nU(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(z.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(z.keywords.continuing))return null;const t=this._currentLine,r=this._compound_statement();return this._updateNode(new Xw(r,e),t)}_for_statement(){if(!this._match(z.keywords.for))return null;this._consume(z.tokens.paren_left,"Expected '('.");const e=this._updateNode(new rU(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(z.tokens.semicolon)?null:this._for_init(),this._consume(z.tokens.semicolon,"Expected ';'."),e.condition=this._check(z.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(z.tokens.semicolon,"Expected ';'."),e.increment=this._check(z.tokens.paren_right)?null:this._for_increment(),this._consume(z.tokens.paren_right,"Expected ')'."),this._check(z.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(z.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(z.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new $s(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(z.keywords.let)){const e=this._currentLine,t=this._consume(z.tokens.name,"Expected name for let.").toString();let r=null;if(this._match(z.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}this._consume(z.tokens.equal,"Expected '=' for let.");const i=this._short_circuit_or_expression();return this._updateNode(new Td(t,r,null,null,i),e)}if(this._match(z.keywords.const)){const e=this._currentLine,t=this._consume(z.tokens.name,"Expected name for const.").toString();let r=null;if(this._match(z.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}this._consume(z.tokens.equal,"Expected '=' for const.");const i=this._short_circuit_or_expression();return r===null&&i instanceof _n&&(r=i.type),this._updateNode(new ly(t,r,null,null,i),e)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(t==null)return null;if(!this._check(z.increment_operators))return this._current=e,null;const r=this._consume(z.increment_operators,"Expected increment operator");return this._updateNode(new iU(r.type===z.tokens.plus_plus?bu.increment:bu.decrement,t))}_assignment_statement(){let e=null;const t=this._currentLine;if(this._check(z.tokens.brace_right))return null;let r=this._match(z.tokens.underscore);if(r||(e=this._unary_expression()),!r&&e==null)return null;const i=this._consume(z.assignment_operators,"Expected assignment operator."),s=this._short_circuit_or_expression();return this._updateNode(new sU(sd.parse(i.lexeme),e,s),t)}_func_call_statement(){if(!this._check(z.tokens.ident))return null;const e=this._currentLine,t=this._current,r=this._consume(z.tokens.ident,"Expected function name."),i=this._argument_expression_list();return i===null?(this._current=t,null):this._updateNode(new I1(r.lexeme,i),e)}_loop_statement(){if(!this._match(z.keywords.loop))return null;this._check(z.tokens.attr)&&this._attribute(),this._consume(z.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new oU([],null));this._currentLoop.push(e);let t=this._statement();for(;t!==null;){if(Array.isArray(t))for(let r of t)e.body.push(r);else e.body.push(t);if(t instanceof Xw){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(z.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(z.keywords.switch))return null;const e=this._updateNode(new aU(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(z.tokens.attr)&&this._attribute(),this._consume(z.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(z.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([z.keywords.default,z.keywords.case]);){if(this._match(z.keywords.case)){const r=this._case_selectors();for(const s of r)if(s instanceof uy){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(z.tokens.colon),this._check(z.tokens.attr)&&this._attribute(),this._consume(z.tokens.brace_left,"Exected '{' for switch case.");const i=this._case_body();this._consume(z.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new yU(r,i)))}if(this._match(z.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(z.tokens.colon),this._check(z.tokens.attr)&&this._attribute(),this._consume(z.tokens.brace_left,"Exected '{' for switch default.");const r=this._case_body();this._consume(z.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new _U(r)))}}return e}_case_selectors(){const e=[];for(this._match(z.keywords.default)?e.push(this._updateNode(new uy)):e.push(this._shift_expression());this._match(z.tokens.comma);)this._match(z.keywords.default)?e.push(this._updateNode(new uy)):e.push(this._shift_expression());return e}_case_body(){if(this._match(z.keywords.fallthrough))return this._consume(z.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const t=this._case_body();return t.length==0?e:[...e,t[0]]}_if_statement(){if(!this._match(z.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(z.tokens.attr)&&this._attribute();const r=this._compound_statement();let i=[];this._match_elseif()&&(this._check(z.tokens.attr)&&this._attribute(),i=this._elseif_statement(i));let s=null;return this._match(z.keywords.else)&&(this._check(z.tokens.attr)&&this._attribute(),s=this._compound_statement()),this._updateNode(new lU(t,r,i,s),e)}_match_elseif(){return this._tokens[this._current].type===z.keywords.else&&this._tokens[this._current+1].type===z.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const t=this._optional_paren_expression(),r=this._compound_statement();return e.push(this._updateNode(new gne(t,r))),this._match_elseif()&&(this._check(z.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(z.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new cU(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(z.tokens.or_or);)e=this._updateNode(new bi(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(z.tokens.and_and);)e=this._updateNode(new bi(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(z.tokens.or);)e=this._updateNode(new bi(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(z.tokens.xor);)e=this._updateNode(new bi(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(z.tokens.and);)e=this._updateNode(new bi(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([z.tokens.equal_equal,z.tokens.not_equal])?this._updateNode(new bi(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([z.tokens.less_than,z.tokens.greater_than,z.tokens.less_than_equal,z.tokens.greater_than_equal]);)e=this._updateNode(new bi(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([z.tokens.shift_left,z.tokens.shift_right]);)e=this._updateNode(new bi(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([z.tokens.plus,z.tokens.minus]);)e=this._updateNode(new bi(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([z.tokens.star,z.tokens.forward_slash,z.tokens.modulo]);)e=this._updateNode(new bi(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([z.tokens.minus,z.tokens.bang,z.tokens.tilde,z.tokens.star,z.tokens.and])?this._updateNode(new ln(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(z.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(z.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new ih(e)),r=this._postfix_expression();return r&&(t.postfix=r),t}if(this._match(z.tokens.period)){const e=this._consume(z.tokens.name,"Expected member name."),t=this._postfix_expression(),r=this._updateNode(new ec(e.lexeme));return t&&(r.postfix=t),r}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(t!==null)return t;switch(e){case"void":return _e.void;case"bool":return _e.bool;case"i32":return _e.i32;case"u32":return _e.u32;case"f32":return _e.f32;case"f16":return _e.f16;case"vec2f":return re.vec2f;case"vec3f":return re.vec3f;case"vec4f":return re.vec4f;case"vec2i":return re.vec2i;case"vec3i":return re.vec3i;case"vec4i":return re.vec4i;case"vec2u":return re.vec2u;case"vec3u":return re.vec3u;case"vec4u":return re.vec4u;case"vec2h":return re.vec2h;case"vec3h":return re.vec3h;case"vec4h":return re.vec4h;case"mat2x2f":return re.mat2x2f;case"mat2x3f":return re.mat2x3f;case"mat2x4f":return re.mat2x4f;case"mat3x2f":return re.mat3x2f;case"mat3x3f":return re.mat3x3f;case"mat3x4f":return re.mat3x4f;case"mat4x2f":return re.mat4x2f;case"mat4x3f":return re.mat4x3f;case"mat4x4f":return re.mat4x4f;case"mat2x2h":return re.mat2x2h;case"mat2x3h":return re.mat2x3h;case"mat2x4h":return re.mat2x4h;case"mat3x2h":return re.mat3x2h;case"mat3x3h":return re.mat3x3h;case"mat3x4h":return re.mat3x4h;case"mat4x2h":return re.mat4x2h;case"mat4x3h":return re.mat4x3h;case"mat4x4h":return re.mat4x4h;case"mat2x2i":return re.mat2x2i;case"mat2x3i":return re.mat2x3i;case"mat2x4i":return re.mat2x4i;case"mat3x2i":return re.mat3x2i;case"mat3x3i":return re.mat3x3i;case"mat3x4i":return re.mat3x4i;case"mat4x2i":return re.mat4x2i;case"mat4x3i":return re.mat4x3i;case"mat4x4i":return re.mat4x4i;case"mat2x2u":return re.mat2x2u;case"mat2x3u":return re.mat2x3u;case"mat2x4u":return re.mat2x4u;case"mat3x2u":return re.mat3x2u;case"mat3x3u":return re.mat3x3u;case"mat3x4u":return re.mat3x4u;case"mat4x2u":return re.mat4x2u;case"mat4x3u":return re.mat4x3u;case"mat4x4u":return re.mat4x4u}return null}_validateTypeRange(e,t){if(t.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(t.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(z.tokens.ident)){const r=this._previous().toString();if(this._check(z.tokens.paren_left)){const i=this._argument_expression_list(),s=this._getType(r);return s!==null?this._updateNode(new Zi(s,i)):this._updateNode(new M1(r,i))}if(this._context.constants.has(r)){const i=this._context.constants.get(r);return this._updateNode(new dU(r,i.value))}return this._updateNode(new Dr(r))}if(this._match(z.tokens.int_literal)){const r=this._previous().toString();let i=r.endsWith("i")||r.endsWith("i")?_e.i32:r.endsWith("u")||r.endsWith("U")?_e.u32:_e.x32;const s=parseInt(r);return this._validateTypeRange(s,i),this._updateNode(new _n(new J(s,this._exec.getTypeInfo(i)),i))}if(this._match(z.tokens.uint_literal)){const r=parseInt(this._previous().toString());return this._validateTypeRange(r,_e.u32),this._updateNode(new _n(new J(r,this._exec.getTypeInfo(_e.u32)),_e.u32))}if(this._match([z.tokens.decimal_float_literal,z.tokens.hex_float_literal])){let r=this._previous().toString(),i=r.endsWith("h");i&&(r=r.substring(0,r.length-1));const s=parseFloat(r);this._validateTypeRange(s,i?_e.f16:_e.f32);const o=i?_e.f16:_e.f32;return this._updateNode(new _n(new J(s,this._exec.getTypeInfo(o)),o))}if(this._match([z.keywords.true,z.keywords.false])){let r=this._previous().toString()===z.keywords.true.rule;return this._updateNode(new _n(new J(r?1:0,this._exec.getTypeInfo(_e.bool)),_e.bool))}if(this._check(z.tokens.paren_left))return this._paren_expression();if(this._match(z.keywords.bitcast)){this._consume(z.tokens.less_than,"Expected '<'.");const r=this._type_decl();this._consume(z.tokens.greater_than,"Expected '>'.");const i=this._paren_expression();return this._updateNode(new pU(r,i))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new Zi(e,t))}_argument_expression_list(){if(!this._match(z.tokens.paren_left))return null;const e=[];do{if(this._check(z.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(z.tokens.comma));return this._consume(z.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(z.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(z.tokens.paren_right),e}_paren_expression(){this._consume(z.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(z.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(z.keywords.struct))return null;const e=this._currentLine,t=this._consume(z.tokens.ident,"Expected name for struct.").toString();this._consume(z.tokens.brace_left,"Expected '{' for struct body.");const r=[];for(;!this._check(z.tokens.brace_right);){const o=this._attribute(),a=this._consume(z.tokens.name,"Expected variable name.").toString();this._consume(z.tokens.colon,"Expected ':' for struct member type.");const u=this._attribute(),h=this._type_decl();h!=null&&(h.attributes=u),this._check(z.tokens.brace_right)?this._match(z.tokens.comma):this._consume(z.tokens.comma,"Expected ',' for struct member."),r.push(this._updateNode(new mP(a,h,o)))}this._consume(z.tokens.brace_right,"Expected '}' after struct body.");const i=this._currentLine,s=this._updateNode(new js(t,r,e,i),e);return this._context.structs.set(t,s),s}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(z.tokens.equal)){const t=this._const_expression();e.value=t}if(e.type!==null&&e.value instanceof _n){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof _n&&(e.type=e.value.type.name==="x32"?_e.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(z.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(z.keywords.const))return null;const t=this._consume(z.tokens.name,"Expected variable name"),r=this._currentLine;let i=null;if(this._match(z.tokens.colon)){const u=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=u)}let s=null;this._consume(z.tokens.equal,"const declarations require an assignment");const o=this._short_circuit_or_expression();try{let u=[_e.f32],h=o.constEvaluate(this._exec,u);h instanceof J&&this._validateTypeRange(h.value,u[0]),u[0]instanceof re&&u[0].format===null&&h.typeInfo instanceof Jl&&h.typeInfo.format!==null&&(h.typeInfo.format.name==="f16"?u[0].format=_e.f16:h.typeInfo.format.name==="f32"?u[0].format=_e.f32:h.typeInfo.format.name==="i32"?u[0].format=_e.i32:h.typeInfo.format.name==="u32"?u[0].format=_e.u32:h.typeInfo.format.name==="bool"?u[0].format=_e.bool:console.error(`TODO: impelement template format type ${h.typeInfo.format.name}`)),s=this._updateNode(new _n(h,u[0])),this._exec.context.setVariable(t.toString(),h)}catch{s=o}if(i!==null&&s instanceof _n){if(s.type.name!=="x32"&&i.getTypeName()!==s.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${s.type.name} to ${i.name}. Line:${this._currentLine}`);s.type=i,s.isScalar&&this._validateTypeRange(s.scalarValue,s.type)}else i===null&&s instanceof _n&&(i=(e=s?.type)!==null&&e!==void 0?e:_e.f32,i===_e.x32&&(i=_e.i32));const a=this._updateNode(new ly(t.toString(),i,"","",s),r);return this._context.constants.set(a.name,a),a}_global_let_decl(){if(!this._match(z.keywords.let))return null;const e=this._currentLine,t=this._consume(z.tokens.name,"Expected variable name");let r=null;if(this._match(z.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}let i=null;if(this._match(z.tokens.equal)&&(i=this._const_expression()),r!==null&&i instanceof _n){if(i.type.name!=="x32"&&r.getTypeName()!==i.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${i.type.name} to ${r.name}. Line:${this._currentLine}`);i.type=r}else r===null&&i instanceof _n&&(r=i.type.name==="x32"?_e.i32:i.type);return i instanceof _n&&i.isScalar&&this._validateTypeRange(i.scalarValue,r),this._updateNode(new Td(t.toString(),r,"","",i),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(z.keywords.var))return null;const e=this._currentLine;let t="",r="";this._match(z.tokens.less_than)&&(t=this._consume(z.storage_class,"Expected storage_class.").toString(),this._match(z.tokens.comma)&&(r=this._consume(z.access_mode,"Expected access_mode.").toString()),this._consume(z.tokens.greater_than,"Expected '>'."));const i=this._consume(z.tokens.name,"Expected variable name");let s=null;if(this._match(z.tokens.colon)){const o=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=o)}return this._updateNode(new $s(i.toString(),s,t,r,null),e)}_override_decl(){if(!this._match(z.keywords.override))return null;const e=this._consume(z.tokens.name,"Expected variable name");let t=null;if(this._match(z.tokens.colon)){const r=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=r)}return this._updateNode(new C1(e.toString(),t,null))}_diagnostic(){this._consume(z.tokens.paren_left,"Expected '('");const e=this._consume(z.tokens.ident,"Expected severity control name.");this._consume(z.tokens.comma,"Expected ','");let t=this._consume(z.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(z.tokens.period)&&(t+=`.${this._consume(z.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(z.tokens.paren_right,"Expected ')'"),this._updateNode(new uU(e.toString(),t))}_enable_directive(){const e=this._consume(z.tokens.ident,"identity expected.");return this._updateNode(new fne(e.toString()))}_requires_directive(){const e=[this._consume(z.tokens.ident,"identity expected.").toString()];for(;this._match(z.tokens.comma);){const t=this._consume(z.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new dne(e))}_type_alias(){const e=this._consume(z.tokens.ident,"identity expected.");this._consume(z.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(t===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const r=this._updateNode(new P1(e.toString(),t));return this._context.aliases.set(r.name,r),r}_type_decl(){if(this._check([z.tokens.ident,...z.texel_format,z.keywords.bool,z.keywords.f32,z.keywords.i32,z.keywords.u32])){const r=this._advance().toString();if(this._context.structs.has(r))return this._context.structs.get(r);if(this._context.aliases.has(r))return this._context.aliases.get(r).type;if(!this._getType(r)){const i=this._updateNode(new pP(r));return this._forwardTypeCount++,i}return this._updateNode(new _e(r))}let e=this._texture_sampler_types();if(e)return e;if(this._check(z.template_types)){let r=this._advance().toString(),i=null,s=null;return this._match(z.tokens.less_than)&&(i=this._type_decl(),s=null,this._match(z.tokens.comma)&&(s=this._consume(z.access_mode,"Expected access_mode for pointer").toString()),this._consume(z.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new re(r,i,s))}if(this._match(z.keywords.ptr)){let r=this._previous().toString();this._consume(z.tokens.less_than,"Expected '<' for pointer.");const i=this._consume(z.storage_class,"Expected storage_class for pointer");this._consume(z.tokens.comma,"Expected ',' for pointer.");const s=this._type_decl();let o=null;return this._match(z.tokens.comma)&&(o=this._consume(z.access_mode,"Expected access_mode for pointer").toString()),this._consume(z.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new cy(r,i.toString(),s,o))}const t=this._attribute();if(this._match(z.keywords.array)){let r=null,i=-1;const s=this._previous();let o=null;if(this._match(z.tokens.less_than)){r=this._type_decl(),this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let u="";if(this._match(z.tokens.comma)){o=this._shift_expression();try{u=o.constEvaluate(this._exec).toString(),o=null}catch{u="1"}}this._consume(z.tokens.greater_than,"Expected '>' for array."),i=u?parseInt(u):0}const a=this._updateNode(new wd(s.toString(),t,r,i));return o&&this._deferArrayCountEval.push({arrayType:a,countNode:o}),a}return null}_texture_sampler_types(){if(this._match(z.sampler_type))return this._updateNode(new od(this._previous().toString(),null,null));if(this._match(z.depth_texture_type))return this._updateNode(new od(this._previous().toString(),null,null));if(this._match(z.sampled_texture_type)||this._match(z.multisampled_texture_type)){const e=this._previous();this._consume(z.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(z.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new od(e.toString(),t,null))}if(this._match(z.storage_texture_type)){const e=this._previous();this._consume(z.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(z.texel_format,"Invalid texel format.").toString();this._consume(z.tokens.comma,"Expected ',' after texel format.");const r=this._consume(z.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(z.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new od(e.toString(),t,r))}return null}_attribute(){let e=[];for(;this._match(z.tokens.attr);){const t=this._consume(z.attribute_name,"Expected attribute name"),r=this._updateNode(new vU(t.toString(),null));if(this._match(z.tokens.paren_left)){if(r.value=this._consume(z.literal_or_ident,"Expected attribute value").toString(),this._check(z.tokens.comma)){this._advance();do{const i=this._consume(z.literal_or_ident,"Expected attribute value").toString();r.value instanceof Array||(r.value=[r.value]),r.value.push(i)}while(this._match(z.tokens.comma))}this._consume(z.tokens.paren_right,"Expected ')'")}e.push(r)}return e.length==0?null:e}}class Ine extends ts{constructor(e){super(),e&&this.update(e)}update(e){const t=new Cne().parse(e);this.updateAST(t)}}function Pne(n){const e={attributes:[],bindings:[]};let t;try{t=Mne(n)}catch(s){return we.error(s.message)(),e}for(const s of t.uniforms){const o=[];for(const a of s.type?.members||[])o.push({name:a.name,type:vP(a.type)});e.bindings.push({type:"uniform",name:s.name,group:s.group,location:s.binding,members:o})}for(const s of t.textures)e.bindings.push({type:"texture",name:s.name,group:s.group,location:s.binding});for(const s of t.samplers)e.bindings.push({type:"sampler",name:s.name,group:s.group,location:s.binding});const r=t.entry.vertex[0],i=r?.inputs.length||0;for(let s=0;s<i;s++){const o=r.inputs[s];if(o.locationType==="location"){const a=vP(o.type);e.attributes.push({name:o.name,location:Number(o.location),type:a})}}return e}function vP(n){return n.format?`${n.name}<${n.format.name}>`:n.name}function Mne(n){try{return new Ine(n)}catch(e){if(e instanceof Error)throw e;let t="WGSL parse error";throw typeof e=="object"&&e?.message&&(t+=`: ${e.message} `),typeof e=="object"&&e?.token&&(t+=e.token.line||""),new Error(t,{cause:e})}}const One={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...One}};const Tr=globalThis.mathgl.config;function kne(n,{precision:e=Tr.precision}={}){return n=Nne(n),`${parseFloat(n.toPrecision(e))}`}function tc(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}function ga(n,e,t){return Lne(n,r=>Math.max(e,Math.min(t,r)))}function Fl(n,e,t){return tc(n)?n.map((r,i)=>Fl(r,e[i],t)):t*e+(1-t)*n}function Zs(n,e,t){const r=Tr.EPSILON;try{if(n===e)return!0;if(tc(n)&&tc(e)){if(n.length!==e.length)return!1;for(let i=0;i<n.length;++i)if(!Zs(n[i],e[i]))return!1;return!0}return n&&n.equals?n.equals(e):e&&e.equals?e.equals(n):typeof n=="number"&&typeof e=="number"?Math.abs(n-e)<=Tr.EPSILON*Math.max(1,Math.abs(n),Math.abs(e)):!1}finally{Tr.EPSILON=r}}function Nne(n){return Math.round(n/Tr.EPSILON)*Tr.EPSILON}function Dne(n){return n.clone?n.clone():new Array(n.length)}function Lne(n,e,t){if(tc(n)){const r=n;t=t||Dne(r);for(let i=0;i<t.length&&i<r.length;++i){const s=typeof n=="number"?n:n[i];t[i]=e(s,i,t)}return t}return e(n)}class L1 extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,t=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+t];return this.check()}toArray(e=[],t=0){for(let r=0;r<this.ELEMENTS;++r)e[t+r]=this[r];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:tc(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Tr)}formatString(e){let t="";for(let r=0;r<this.ELEMENTS;++r)t+=(r>0?", ":"")+kne(this[r],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!Zs(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,r){if(r===void 0)return this.lerp(this,e,t);for(let i=0;i<this.ELEMENTS;++i){const s=e[i],o=typeof t=="number"?t:t[i];this[i]=s+r*(o-s)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),t[r]);return this.check()}add(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=t[r];return this.check()}subtract(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=t[r];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(Tr.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),t);return this.check()}get elements(){return this}}function Une(n,e){if(n.length!==e)return!1;for(let t=0;t<n.length;++t)if(!Number.isFinite(n[t]))return!1;return!0}function It(n){if(!Number.isFinite(n))throw new Error(`Invalid number ${JSON.stringify(n)}`);return n}function xd(n,e,t=""){if(Tr.debug&&!Une(n,e))throw new Error(`math.gl: ${t} some fields set to invalid numbers'`);return n}function Zd(n,e){if(!n)throw new Error(`math.gl assertion ${e}`)}class bU extends L1{get x(){return this[0]}set x(e){this[0]=It(e)}get y(){return this[1]}set y(e){this[1]=It(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let r=0;r<this.ELEMENTS;++r){const i=this[r]-e[r];t+=i*i}return It(t)}dot(e){let t=0;for(let r=0;r<this.ELEMENTS;++r)t+=this[r]*e[r];return It(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=t[r];return this.check()}divide(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=t[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Zd(e>=0&&e<this.ELEMENTS,"index is out of range"),It(this[e])}setComponent(e,t){return Zd(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}const Ed=1e-6;let Pi=typeof Float32Array<"u"?Float32Array:Array;function Vne(){const n=new Pi(2);return Pi!=Float32Array&&(n[0]=0,n[1]=0),n}function bP(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n}function Fne(n,e){return n[0]=-e[0],n[1]=-e[1],n}function TU(n,e,t,r){const i=e[0],s=e[1];return n[0]=i+r*(t[0]-i),n[1]=s+r*(t[1]-s),n}function Bne(n,e,t){const r=e[0],i=e[1];return n[0]=t[0]*r+t[3]*i+t[6],n[1]=t[1]*r+t[4]*i+t[7],n}function zne(n,e,t){const r=e[0],i=e[1];return n[0]=t[0]*r+t[4]*i+t[12],n[1]=t[1]*r+t[5]*i+t[13],n}(function(){const n=Vne();return function(e,t,r,i,s,o){let a,u;for(t||(t=2),r||(r=0),i?u=Math.min(i*t+r,e.length):u=e.length,a=r;a<u;a+=t)n[0]=e[a],n[1]=e[a+1],s(n,n,o),e[a]=n[0],e[a+1]=n[1];return e}})();function jne(n,e,t){const r=e[0],i=e[1],s=t[3]*r+t[7]*i||1;return n[0]=(t[0]*r+t[4]*i)/s,n[1]=(t[1]*r+t[5]*i)/s,n}function wU(n,e,t){const r=e[0],i=e[1],s=e[2],o=t[3]*r+t[7]*i+t[11]*s||1;return n[0]=(t[0]*r+t[4]*i+t[8]*s)/o,n[1]=(t[1]*r+t[5]*i+t[9]*s)/o,n[2]=(t[2]*r+t[6]*i+t[10]*s)/o,n}function Hne(n,e,t){const r=e[0],i=e[1];return n[0]=t[0]*r+t[2]*i,n[1]=t[1]*r+t[3]*i,n[2]=e[2],n}function $ne(n,e,t){const r=e[0],i=e[1];return n[0]=t[0]*r+t[2]*i,n[1]=t[1]*r+t[3]*i,n[2]=e[2],n[3]=e[3],n}function xU(n,e,t){const r=e[0],i=e[1],s=e[2];return n[0]=t[0]*r+t[3]*i+t[6]*s,n[1]=t[1]*r+t[4]*i+t[7]*s,n[2]=t[2]*r+t[5]*i+t[8]*s,n[3]=e[3],n}function EU(){const n=new Pi(3);return Pi!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Wne(n){const e=n[0],t=n[1],r=n[2];return Math.sqrt(e*e+t*t+r*r)}function TP(n,e,t){const r=new Pi(3);return r[0]=n,r[1]=e,r[2]=t,r}function qne(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function Xne(n){const e=n[0],t=n[1],r=n[2];return e*e+t*t+r*r}function Yne(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function Kne(n,e){const t=e[0],r=e[1],i=e[2];let s=t*t+r*r+i*i;return s>0&&(s=1/Math.sqrt(s)),n[0]=e[0]*s,n[1]=e[1]*s,n[2]=e[2]*s,n}function AU(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function hy(n,e,t){const r=e[0],i=e[1],s=e[2],o=t[0],a=t[1],u=t[2];return n[0]=i*u-s*a,n[1]=s*o-r*u,n[2]=r*a-i*o,n}function Gne(n,e,t,r){const i=e[0],s=e[1],o=e[2];return n[0]=i+r*(t[0]-i),n[1]=s+r*(t[1]-s),n[2]=o+r*(t[2]-o),n}function U1(n,e,t){const r=e[0],i=e[1],s=e[2];let o=t[3]*r+t[7]*i+t[11]*s+t[15];return o=o||1,n[0]=(t[0]*r+t[4]*i+t[8]*s+t[12])/o,n[1]=(t[1]*r+t[5]*i+t[9]*s+t[13])/o,n[2]=(t[2]*r+t[6]*i+t[10]*s+t[14])/o,n}function SU(n,e,t){const r=e[0],i=e[1],s=e[2];return n[0]=r*t[0]+i*t[3]+s*t[6],n[1]=r*t[1]+i*t[4]+s*t[7],n[2]=r*t[2]+i*t[5]+s*t[8],n}function RU(n,e,t){const r=t[0],i=t[1],s=t[2],o=t[3],a=e[0],u=e[1],h=e[2];let d=i*h-s*u,g=s*a-r*h,y=r*u-i*a,v=i*y-s*g,T=s*d-r*y,w=r*g-i*d;const E=o*2;return d*=E,g*=E,y*=E,v*=2,T*=2,w*=2,n[0]=a+d+v,n[1]=u+g+T,n[2]=h+y+w,n}function Zne(n,e,t,r){const i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[0],s[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),s[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),n[0]=s[0]+t[0],n[1]=s[1]+t[1],n[2]=s[2]+t[2],n}function Qne(n,e,t,r){const i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),s[1]=i[1],s[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),n[0]=s[0]+t[0],n[1]=s[1]+t[1],n[2]=s[2]+t[2],n}function Jne(n,e,t,r){const i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),s[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),s[2]=i[2],n[0]=s[0]+t[0],n[1]=s[1]+t[1],n[2]=s[2]+t[2],n}function ere(n,e){const t=n[0],r=n[1],i=n[2],s=e[0],o=e[1],a=e[2],u=Math.sqrt((t*t+r*r+i*i)*(s*s+o*o+a*a)),h=u&&AU(n,e)/u;return Math.acos(Math.min(Math.max(h,-1),1))}const CU=qne,IU=Wne,dT=Xne;(function(){const n=EU();return function(e,t,r,i,s,o){let a,u;for(t||(t=3),r||(r=0),i?u=Math.min(i*t+r,e.length):u=e.length,a=r;a<u;a+=t)n[0]=e[a],n[1]=e[a+1],n[2]=e[a+2],s(n,n,o),e[a]=n[0],e[a+1]=n[1],e[a+2]=n[2];return e}})();const pT=[0,0,0];let Tm;class Pe extends bU{static get ZERO(){return Tm||(Tm=new Pe(0,0,0),Object.freeze(Tm)),Tm}constructor(e=0,t=0,r=0){super(-0,-0,-0),arguments.length===1&&tc(e)?this.copy(e):(Tr.debug&&(It(e),It(t),It(r)),this[0]=e,this[1]=t,this[2]=r)}set(e,t,r){return this[0]=e,this[1]=t,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Tr.debug&&(It(e.x),It(e.y),It(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=It(e)}angle(e){return ere(this,e)}cross(e){return hy(this,this,e),this.check()}rotateX({radians:e,origin:t=pT}){return Zne(this,this,t,e),this.check()}rotateY({radians:e,origin:t=pT}){return Qne(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=pT}){return Jne(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return U1(this,this,e),this.check()}transformAsVector(e){return wU(this,this,e),this.check()}transformByMatrix3(e){return SU(this,this,e),this.check()}transformByMatrix2(e){return Hne(this,this,e),this.check()}transformByQuaternion(e){return RU(this,this,e),this.check()}}let wm;class V1 extends bU{static get ZERO(){return wm||(wm=new V1(0,0,0,0),Object.freeze(wm)),wm}constructor(e=0,t=0,r=0,i=0){super(-0,-0,-0,-0),tc(e)&&arguments.length===1?this.copy(e):(Tr.debug&&(It(e),It(t),It(r),It(i)),this[0]=e,this[1]=t,this[2]=r,this[3]=i)}set(e,t,r,i){return this[0]=e,this[1]=t,this[2]=r,this[3]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return Tr.debug&&(It(e.x),It(e.y),It(e.z),It(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=It(e)}get w(){return this[3]}set w(e){this[3]=It(e)}transform(e){return U1(this,this,e),this.check()}transformByMatrix3(e){return xU(this,this,e),this.check()}transformByMatrix2(e){return $ne(this,this,e),this.check()}transformByQuaternion(e){return RU(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class PU extends L1{toString(){let e="[";if(Tr.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let r=0;r<this.RANK;++r)e+=` ${this[r*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,r){return this[t*this.RANK+e]=It(r),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)t[i]=this[r+i];return t}setColumn(e,t){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)this[r+i]=t[i];return this}}function tre(){const n=new Pi(9);return Pi!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function nre(n,e){if(n===e){const t=e[1],r=e[2],i=e[5];n[1]=e[3],n[2]=e[6],n[3]=t,n[5]=e[7],n[6]=r,n[7]=i}else n[0]=e[0],n[1]=e[3],n[2]=e[6],n[3]=e[1],n[4]=e[4],n[5]=e[7],n[6]=e[2],n[7]=e[5],n[8]=e[8];return n}function rre(n,e){const t=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],u=e[6],h=e[7],d=e[8],g=d*o-a*h,y=-d*s+a*u,v=h*s-o*u;let T=t*g+r*y+i*v;return T?(T=1/T,n[0]=g*T,n[1]=(-d*r+i*h)*T,n[2]=(a*r-i*o)*T,n[3]=y*T,n[4]=(d*t-i*u)*T,n[5]=(-a*t+i*s)*T,n[6]=v*T,n[7]=(-h*t+r*u)*T,n[8]=(o*t-r*s)*T,n):null}function ire(n){const e=n[0],t=n[1],r=n[2],i=n[3],s=n[4],o=n[5],a=n[6],u=n[7],h=n[8];return e*(h*s-o*u)+t*(-h*i+o*a)+r*(u*i-s*a)}function wP(n,e,t){const r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],u=e[5],h=e[6],d=e[7],g=e[8],y=t[0],v=t[1],T=t[2],w=t[3],E=t[4],S=t[5],P=t[6],I=t[7],L=t[8];return n[0]=y*r+v*o+T*h,n[1]=y*i+v*a+T*d,n[2]=y*s+v*u+T*g,n[3]=w*r+E*o+S*h,n[4]=w*i+E*a+S*d,n[5]=w*s+E*u+S*g,n[6]=P*r+I*o+L*h,n[7]=P*i+I*a+L*d,n[8]=P*s+I*u+L*g,n}function sre(n,e,t){const r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],u=e[5],h=e[6],d=e[7],g=e[8],y=t[0],v=t[1];return n[0]=r,n[1]=i,n[2]=s,n[3]=o,n[4]=a,n[5]=u,n[6]=y*r+v*o+h,n[7]=y*i+v*a+d,n[8]=y*s+v*u+g,n}function ore(n,e,t){const r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],u=e[5],h=e[6],d=e[7],g=e[8],y=Math.sin(t),v=Math.cos(t);return n[0]=v*r+y*o,n[1]=v*i+y*a,n[2]=v*s+y*u,n[3]=v*o-y*r,n[4]=v*a-y*i,n[5]=v*u-y*s,n[6]=h,n[7]=d,n[8]=g,n}function xP(n,e,t){const r=t[0],i=t[1];return n[0]=r*e[0],n[1]=r*e[1],n[2]=r*e[2],n[3]=i*e[3],n[4]=i*e[4],n[5]=i*e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n}function are(n,e){const t=e[0],r=e[1],i=e[2],s=e[3],o=t+t,a=r+r,u=i+i,h=t*o,d=r*o,g=r*a,y=i*o,v=i*a,T=i*u,w=s*o,E=s*a,S=s*u;return n[0]=1-g-T,n[3]=d-S,n[6]=y+E,n[1]=d+S,n[4]=1-h-T,n[7]=v-w,n[2]=y-E,n[5]=v+w,n[8]=1-h-g,n}var Kw;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL1ROW0=3]="COL1ROW0",n[n.COL1ROW1=4]="COL1ROW1",n[n.COL1ROW2=5]="COL1ROW2",n[n.COL2ROW0=6]="COL2ROW0",n[n.COL2ROW1=7]="COL2ROW1",n[n.COL2ROW2=8]="COL2ROW2"})(Kw||(Kw={}));const lre=Object.freeze([1,0,0,0,1,0,0,0,1]);class jn extends PU{static get IDENTITY(){return ure()}static get ZERO(){return cre()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return Kw}constructor(e,...t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):t.length>0?this.copy([e,...t]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(lre)}fromObject(e){return this.check()}fromQuaternion(e){return are(this,e),this.check()}set(e,t,r,i,s,o,a,u,h){return this[0]=e,this[1]=t,this[2]=r,this[3]=i,this[4]=s,this[5]=o,this[6]=a,this[7]=u,this[8]=h,this.check()}setRowMajor(e,t,r,i,s,o,a,u,h){return this[0]=e,this[1]=i,this[2]=a,this[3]=t,this[4]=s,this[5]=u,this[6]=r,this[7]=o,this[8]=h,this.check()}determinant(){return ire(this)}transpose(){return nre(this,this),this.check()}invert(){return rre(this,this),this.check()}multiplyLeft(e){return wP(this,e,this),this.check()}multiplyRight(e){return wP(this,this,e),this.check()}rotate(e){return ore(this,this,e),this.check()}scale(e){return Array.isArray(e)?xP(this,this,e):xP(this,this,[e,e]),this.check()}translate(e){return sre(this,this,e),this.check()}transform(e,t){let r;switch(e.length){case 2:r=Bne(t||[-0,-0],e,this);break;case 3:r=SU(t||[-0,-0,-0],e,this);break;case 4:r=xU(t||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return xd(r,e.length),r}transformVector(e,t){return this.transform(e,t)}transformVector2(e,t){return this.transform(e,t)}transformVector3(e,t){return this.transform(e,t)}}let xm,Em=null;function cre(){return xm||(xm=new jn([0,0,0,0,0,0,0,0,0]),Object.freeze(xm)),xm}function ure(){return Em||(Em=new jn,Object.freeze(Em)),Em}function hre(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function fre(n,e){if(n===e){const t=e[1],r=e[2],i=e[3],s=e[6],o=e[7],a=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=t,n[6]=e[9],n[7]=e[13],n[8]=r,n[9]=s,n[11]=e[14],n[12]=i,n[13]=o,n[14]=a}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n}function Gw(n,e){const t=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],u=e[6],h=e[7],d=e[8],g=e[9],y=e[10],v=e[11],T=e[12],w=e[13],E=e[14],S=e[15],P=t*a-r*o,I=t*u-i*o,L=t*h-s*o,F=r*u-i*a,Y=r*h-s*a,k=i*h-s*u,M=d*w-g*T,N=d*E-y*T,H=d*S-v*T,q=g*E-y*w,K=g*S-v*w,j=y*S-v*E;let de=P*j-I*K+L*q+F*H-Y*N+k*M;return de?(de=1/de,n[0]=(a*j-u*K+h*q)*de,n[1]=(i*K-r*j-s*q)*de,n[2]=(w*k-E*Y+S*F)*de,n[3]=(y*Y-g*k-v*F)*de,n[4]=(u*H-o*j-h*N)*de,n[5]=(t*j-i*H+s*N)*de,n[6]=(E*L-T*k-S*I)*de,n[7]=(d*k-y*L+v*I)*de,n[8]=(o*K-a*H+h*M)*de,n[9]=(r*H-t*K-s*M)*de,n[10]=(T*Y-w*L+S*P)*de,n[11]=(g*L-d*Y-v*P)*de,n[12]=(a*N-o*q-u*M)*de,n[13]=(t*q-r*N+i*M)*de,n[14]=(w*I-T*F-E*P)*de,n[15]=(d*F-g*I+y*P)*de,n):null}function dre(n){const e=n[0],t=n[1],r=n[2],i=n[3],s=n[4],o=n[5],a=n[6],u=n[7],h=n[8],d=n[9],g=n[10],y=n[11],v=n[12],T=n[13],w=n[14],E=n[15],S=e*o-t*s,P=e*a-r*s,I=t*a-r*o,L=h*T-d*v,F=h*w-g*v,Y=d*w-g*T,k=e*Y-t*F+r*L,M=s*Y-o*F+a*L,N=h*I-d*P+g*S,H=v*I-T*P+w*S;return u*k-i*M+E*N-y*H}function Bl(n,e,t){const r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],u=e[5],h=e[6],d=e[7],g=e[8],y=e[9],v=e[10],T=e[11],w=e[12],E=e[13],S=e[14],P=e[15];let I=t[0],L=t[1],F=t[2],Y=t[3];return n[0]=I*r+L*a+F*g+Y*w,n[1]=I*i+L*u+F*y+Y*E,n[2]=I*s+L*h+F*v+Y*S,n[3]=I*o+L*d+F*T+Y*P,I=t[4],L=t[5],F=t[6],Y=t[7],n[4]=I*r+L*a+F*g+Y*w,n[5]=I*i+L*u+F*y+Y*E,n[6]=I*s+L*h+F*v+Y*S,n[7]=I*o+L*d+F*T+Y*P,I=t[8],L=t[9],F=t[10],Y=t[11],n[8]=I*r+L*a+F*g+Y*w,n[9]=I*i+L*u+F*y+Y*E,n[10]=I*s+L*h+F*v+Y*S,n[11]=I*o+L*d+F*T+Y*P,I=t[12],L=t[13],F=t[14],Y=t[15],n[12]=I*r+L*a+F*g+Y*w,n[13]=I*i+L*u+F*y+Y*E,n[14]=I*s+L*h+F*v+Y*S,n[15]=I*o+L*d+F*T+Y*P,n}function f_(n,e,t){const r=t[0],i=t[1],s=t[2];let o,a,u,h,d,g,y,v,T,w,E,S;return e===n?(n[12]=e[0]*r+e[4]*i+e[8]*s+e[12],n[13]=e[1]*r+e[5]*i+e[9]*s+e[13],n[14]=e[2]*r+e[6]*i+e[10]*s+e[14],n[15]=e[3]*r+e[7]*i+e[11]*s+e[15]):(o=e[0],a=e[1],u=e[2],h=e[3],d=e[4],g=e[5],y=e[6],v=e[7],T=e[8],w=e[9],E=e[10],S=e[11],n[0]=o,n[1]=a,n[2]=u,n[3]=h,n[4]=d,n[5]=g,n[6]=y,n[7]=v,n[8]=T,n[9]=w,n[10]=E,n[11]=S,n[12]=o*r+d*i+T*s+e[12],n[13]=a*r+g*i+w*s+e[13],n[14]=u*r+y*i+E*s+e[14],n[15]=h*r+v*i+S*s+e[15]),n}function F1(n,e,t){const r=t[0],i=t[1],s=t[2];return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n[3]=e[3]*r,n[4]=e[4]*i,n[5]=e[5]*i,n[6]=e[6]*i,n[7]=e[7]*i,n[8]=e[8]*s,n[9]=e[9]*s,n[10]=e[10]*s,n[11]=e[11]*s,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function pre(n,e,t,r){let i=r[0],s=r[1],o=r[2],a=Math.sqrt(i*i+s*s+o*o),u,h,d,g,y,v,T,w,E,S,P,I,L,F,Y,k,M,N,H,q,K,j,de,Ee;return a<Ed?null:(a=1/a,i*=a,s*=a,o*=a,h=Math.sin(t),u=Math.cos(t),d=1-u,g=e[0],y=e[1],v=e[2],T=e[3],w=e[4],E=e[5],S=e[6],P=e[7],I=e[8],L=e[9],F=e[10],Y=e[11],k=i*i*d+u,M=s*i*d+o*h,N=o*i*d-s*h,H=i*s*d-o*h,q=s*s*d+u,K=o*s*d+i*h,j=i*o*d+s*h,de=s*o*d-i*h,Ee=o*o*d+u,n[0]=g*k+w*M+I*N,n[1]=y*k+E*M+L*N,n[2]=v*k+S*M+F*N,n[3]=T*k+P*M+Y*N,n[4]=g*H+w*q+I*K,n[5]=y*H+E*q+L*K,n[6]=v*H+S*q+F*K,n[7]=T*H+P*q+Y*K,n[8]=g*j+w*de+I*Ee,n[9]=y*j+E*de+L*Ee,n[10]=v*j+S*de+F*Ee,n[11]=T*j+P*de+Y*Ee,e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n)}function MU(n,e,t){const r=Math.sin(t),i=Math.cos(t),s=e[4],o=e[5],a=e[6],u=e[7],h=e[8],d=e[9],g=e[10],y=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=s*i+h*r,n[5]=o*i+d*r,n[6]=a*i+g*r,n[7]=u*i+y*r,n[8]=h*i-s*r,n[9]=d*i-o*r,n[10]=g*i-a*r,n[11]=y*i-u*r,n}function gre(n,e,t){const r=Math.sin(t),i=Math.cos(t),s=e[0],o=e[1],a=e[2],u=e[3],h=e[8],d=e[9],g=e[10],y=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=s*i-h*r,n[1]=o*i-d*r,n[2]=a*i-g*r,n[3]=u*i-y*r,n[8]=s*r+h*i,n[9]=o*r+d*i,n[10]=a*r+g*i,n[11]=u*r+y*i,n}function OU(n,e,t){const r=Math.sin(t),i=Math.cos(t),s=e[0],o=e[1],a=e[2],u=e[3],h=e[4],d=e[5],g=e[6],y=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=s*i+h*r,n[1]=o*i+d*r,n[2]=a*i+g*r,n[3]=u*i+y*r,n[4]=h*i-s*r,n[5]=d*i-o*r,n[6]=g*i-a*r,n[7]=y*i-u*r,n}function mre(n,e){const t=e[0],r=e[1],i=e[2],s=e[4],o=e[5],a=e[6],u=e[8],h=e[9],d=e[10];return n[0]=Math.sqrt(t*t+r*r+i*i),n[1]=Math.sqrt(s*s+o*o+a*a),n[2]=Math.sqrt(u*u+h*h+d*d),n}function yre(n,e){const t=e[0],r=e[1],i=e[2],s=e[3],o=t+t,a=r+r,u=i+i,h=t*o,d=r*o,g=r*a,y=i*o,v=i*a,T=i*u,w=s*o,E=s*a,S=s*u;return n[0]=1-g-T,n[1]=d+S,n[2]=y-E,n[3]=0,n[4]=d-S,n[5]=1-h-T,n[6]=v+w,n[7]=0,n[8]=y+E,n[9]=v-w,n[10]=1-h-g,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function _re(n,e,t,r,i,s,o){const a=1/(t-e),u=1/(i-r),h=1/(s-o);return n[0]=s*2*a,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=s*2*u,n[6]=0,n[7]=0,n[8]=(t+e)*a,n[9]=(i+r)*u,n[10]=(o+s)*h,n[11]=-1,n[12]=0,n[13]=0,n[14]=o*s*2*h,n[15]=0,n}function vre(n,e,t,r,i){const s=1/Math.tan(e/2);if(n[0]=s/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=s,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,i!=null&&i!==1/0){const o=1/(r-i);n[10]=(i+r)*o,n[14]=2*i*r*o}else n[10]=-1,n[14]=-2*r;return n}const bre=vre;function Tre(n,e,t,r,i,s,o){const a=1/(e-t),u=1/(r-i),h=1/(s-o);return n[0]=-2*a,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*u,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*h,n[11]=0,n[12]=(e+t)*a,n[13]=(i+r)*u,n[14]=(o+s)*h,n[15]=1,n}const wre=Tre;function xre(n,e,t,r){let i,s,o,a,u,h,d,g,y,v;const T=e[0],w=e[1],E=e[2],S=r[0],P=r[1],I=r[2],L=t[0],F=t[1],Y=t[2];return Math.abs(T-L)<Ed&&Math.abs(w-F)<Ed&&Math.abs(E-Y)<Ed?hre(n):(g=T-L,y=w-F,v=E-Y,i=1/Math.sqrt(g*g+y*y+v*v),g*=i,y*=i,v*=i,s=P*v-I*y,o=I*g-S*v,a=S*y-P*g,i=Math.sqrt(s*s+o*o+a*a),i?(i=1/i,s*=i,o*=i,a*=i):(s=0,o=0,a=0),u=y*a-v*o,h=v*s-g*a,d=g*o-y*s,i=Math.sqrt(u*u+h*h+d*d),i?(i=1/i,u*=i,h*=i,d*=i):(u=0,h=0,d=0),n[0]=s,n[1]=u,n[2]=g,n[3]=0,n[4]=o,n[5]=h,n[6]=y,n[7]=0,n[8]=a,n[9]=d,n[10]=v,n[11]=0,n[12]=-(s*T+o*w+a*E),n[13]=-(u*T+h*w+d*E),n[14]=-(g*T+y*w+v*E),n[15]=1,n)}function Ere(){const n=new Pi(4);return Pi!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function Are(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n}function B1(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n}function Sre(n){const e=n[0],t=n[1],r=n[2],i=n[3];return Math.sqrt(e*e+t*t+r*r+i*i)}function Rre(n){const e=n[0],t=n[1],r=n[2],i=n[3];return e*e+t*t+r*r+i*i}function Cre(n,e){const t=e[0],r=e[1],i=e[2],s=e[3];let o=t*t+r*r+i*i+s*s;return o>0&&(o=1/Math.sqrt(o)),n[0]=t*o,n[1]=r*o,n[2]=i*o,n[3]=s*o,n}function Ire(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]*e[3]}function Pre(n,e,t,r){const i=e[0],s=e[1],o=e[2],a=e[3];return n[0]=i+r*(t[0]-i),n[1]=s+r*(t[1]-s),n[2]=o+r*(t[2]-o),n[3]=a+r*(t[3]-a),n}function Ih(n,e,t){const r=e[0],i=e[1],s=e[2],o=e[3];return n[0]=t[0]*r+t[4]*i+t[8]*s+t[12]*o,n[1]=t[1]*r+t[5]*i+t[9]*s+t[13]*o,n[2]=t[2]*r+t[6]*i+t[10]*s+t[14]*o,n[3]=t[3]*r+t[7]*i+t[11]*s+t[15]*o,n}function Mre(n,e,t){const r=e[0],i=e[1],s=e[2],o=t[0],a=t[1],u=t[2],h=t[3],d=h*r+a*s-u*i,g=h*i+u*r-o*s,y=h*s+o*i-a*r,v=-o*r-a*i-u*s;return n[0]=d*h+v*-o+g*-u-y*-a,n[1]=g*h+v*-a+y*-o-d*-u,n[2]=y*h+v*-u+d*-a-g*-o,n[3]=e[3],n}(function(){const n=Ere();return function(e,t,r,i,s,o){let a,u;for(t||(t=4),r||(r=0),i?u=Math.min(i*t+r,e.length):u=e.length,a=r;a<u;a+=t)n[0]=e[a],n[1]=e[a+1],n[2]=e[a+2],n[3]=e[a+3],s(n,n,o),e[a]=n[0],e[a+1]=n[1],e[a+2]=n[2],e[a+3]=n[3];return e}})();var Zw;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL0ROW3=3]="COL0ROW3",n[n.COL1ROW0=4]="COL1ROW0",n[n.COL1ROW1=5]="COL1ROW1",n[n.COL1ROW2=6]="COL1ROW2",n[n.COL1ROW3=7]="COL1ROW3",n[n.COL2ROW0=8]="COL2ROW0",n[n.COL2ROW1=9]="COL2ROW1",n[n.COL2ROW2=10]="COL2ROW2",n[n.COL2ROW3=11]="COL2ROW3",n[n.COL3ROW0=12]="COL3ROW0",n[n.COL3ROW1=13]="COL3ROW1",n[n.COL3ROW2=14]="COL3ROW2",n[n.COL3ROW3=15]="COL3ROW3"})(Zw||(Zw={}));const Ore=45*Math.PI/180,kre=1,gT=.1,mT=500,Nre=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class fr extends PU{static get IDENTITY(){return Lre()}static get ZERO(){return Dre()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Zw}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,r,i,s,o,a,u,h,d,g,y,v,T,w,E){return this[0]=e,this[1]=t,this[2]=r,this[3]=i,this[4]=s,this[5]=o,this[6]=a,this[7]=u,this[8]=h,this[9]=d,this[10]=g,this[11]=y,this[12]=v,this[13]=T,this[14]=w,this[15]=E,this.check()}setRowMajor(e,t,r,i,s,o,a,u,h,d,g,y,v,T,w,E){return this[0]=e,this[1]=s,this[2]=h,this[3]=v,this[4]=t,this[5]=o,this[6]=d,this[7]=T,this[8]=r,this[9]=a,this[10]=g,this[11]=w,this[12]=i,this[13]=u,this[14]=y,this[15]=E,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(Nre)}fromObject(e){return this.check()}fromQuaternion(e){return yre(this,e),this.check()}frustum(e){const{left:t,right:r,bottom:i,top:s,near:o=gT,far:a=mT}=e;return a===1/0?Ure(this,t,r,i,s,o):_re(this,t,r,i,s,o,a),this.check()}lookAt(e){const{eye:t,center:r=[0,0,0],up:i=[0,1,0]}=e;return xre(this,t,r,i),this.check()}ortho(e){const{left:t,right:r,bottom:i,top:s,near:o=gT,far:a=mT}=e;return wre(this,t,r,i,s,o,a),this.check()}orthographic(e){const{fovy:t=Ore,aspect:r=kre,focalDistance:i=1,near:s=gT,far:o=mT}=e;EP(t);const a=t/2,u=i*Math.tan(a),h=u*r;return this.ortho({left:-h,right:h,bottom:-u,top:u,near:s,far:o})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:r=1,near:i=.1,far:s=500}=e;return EP(t),bre(this,t,r,i,s),this.check()}determinant(){return dre(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const r=this.getScale(t),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*s,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*s,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const r=this.getScale(t),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=this[4]*i,e[4]=this[5]*s,e[5]=this[6]*o,e[6]=this[8]*i,e[7]=this[9]*s,e[8]=this[10]*o,e}transpose(){return fre(this,this),this.check()}invert(){return Gw(this,this),this.check()}multiplyLeft(e){return Bl(this,e,this),this.check()}multiplyRight(e){return Bl(this,this,e),this.check()}rotateX(e){return MU(this,this,e),this.check()}rotateY(e){return gre(this,this,e),this.check()}rotateZ(e){return OU(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return pre(this,this,e,t),this.check()}scale(e){return F1(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return f_(this,this,e),this.check()}transform(e,t){return e.length===4?(t=Ih(t||[-0,-0,-0,-0],e,this),xd(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:r}=e;let i;switch(r){case 2:i=zne(t||[-0,-0],e,this);break;case 3:i=U1(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return xd(i,e.length),i}transformAsVector(e,t){let r;switch(e.length){case 2:r=jne(t||[-0,-0],e,this);break;case 3:r=wU(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return xd(r,e.length),r}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,r){return this.identity().translate([e,t,r])}}let Am,Sm;function Dre(){return Am||(Am=new fr([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Am)),Am}function Lre(){return Sm||(Sm=new fr,Object.freeze(Sm)),Sm}function EP(n){if(n>Math.PI*2)throw Error("expected radians")}function Ure(n,e,t,r,i,s){const o=2*s/(t-e),a=2*s/(i-r),u=(t+e)/(t-e),h=(i+r)/(i-r),d=-1,g=-1,y=-2*s;return n[0]=o,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=a,n[6]=0,n[7]=0,n[8]=u,n[9]=h,n[10]=d,n[11]=g,n[12]=0,n[13]=0,n[14]=y,n[15]=0,n}function AP(){const n=new Pi(4);return Pi!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Vre(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function kU(n,e,t){t=t*.5;const r=Math.sin(t);return n[0]=r*e[0],n[1]=r*e[1],n[2]=r*e[2],n[3]=Math.cos(t),n}function SP(n,e,t){const r=e[0],i=e[1],s=e[2],o=e[3],a=t[0],u=t[1],h=t[2],d=t[3];return n[0]=r*d+o*a+i*h-s*u,n[1]=i*d+o*u+s*a-r*h,n[2]=s*d+o*h+r*u-i*a,n[3]=o*d-r*a-i*u-s*h,n}function Fre(n,e,t){t*=.5;const r=e[0],i=e[1],s=e[2],o=e[3],a=Math.sin(t),u=Math.cos(t);return n[0]=r*u+o*a,n[1]=i*u+s*a,n[2]=s*u-i*a,n[3]=o*u-r*a,n}function Bre(n,e,t){t*=.5;const r=e[0],i=e[1],s=e[2],o=e[3],a=Math.sin(t),u=Math.cos(t);return n[0]=r*u-s*a,n[1]=i*u+o*a,n[2]=s*u+r*a,n[3]=o*u-i*a,n}function zre(n,e,t){t*=.5;const r=e[0],i=e[1],s=e[2],o=e[3],a=Math.sin(t),u=Math.cos(t);return n[0]=r*u+i*a,n[1]=i*u-r*a,n[2]=s*u+o*a,n[3]=o*u-s*a,n}function jre(n,e){const t=e[0],r=e[1],i=e[2];return n[0]=t,n[1]=r,n[2]=i,n[3]=Math.sqrt(Math.abs(1-t*t-r*r-i*i)),n}function fy(n,e,t,r){const i=e[0],s=e[1],o=e[2],a=e[3];let u=t[0],h=t[1],d=t[2],g=t[3],y,v,T,w,E;return y=i*u+s*h+o*d+a*g,y<0&&(y=-y,u=-u,h=-h,d=-d,g=-g),1-y>Ed?(v=Math.acos(y),E=Math.sin(v),T=Math.sin((1-r)*v)/E,w=Math.sin(r*v)/E):(T=1-r,w=r),n[0]=T*i+w*u,n[1]=T*s+w*h,n[2]=T*o+w*d,n[3]=T*a+w*g,n}function Hre(n,e){const t=e[0],r=e[1],i=e[2],s=e[3],o=t*t+r*r+i*i+s*s,a=o?1/o:0;return n[0]=-t*a,n[1]=-r*a,n[2]=-i*a,n[3]=s*a,n}function $re(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n}function NU(n,e){const t=e[0]+e[4]+e[8];let r;if(t>0)r=Math.sqrt(t+1),n[3]=.5*r,r=.5/r,n[0]=(e[5]-e[7])*r,n[1]=(e[6]-e[2])*r,n[2]=(e[1]-e[3])*r;else{let i=0;e[4]>e[0]&&(i=1),e[8]>e[i*3+i]&&(i=2);const s=(i+1)%3,o=(i+2)%3;r=Math.sqrt(e[i*3+i]-e[s*3+s]-e[o*3+o]+1),n[i]=.5*r,r=.5/r,n[3]=(e[s*3+o]-e[o*3+s])*r,n[s]=(e[s*3+i]+e[i*3+s])*r,n[o]=(e[o*3+i]+e[i*3+o])*r}return n}const Wre=Are,qre=B1,Xre=Ire,Yre=Pre,Kre=Sre,Gre=Rre,DU=Cre,Zre=(function(){const n=EU(),e=TP(1,0,0),t=TP(0,1,0);return function(r,i,s){const o=AU(i,s);return o<-.999999?(hy(n,e,i),IU(n)<1e-6&&hy(n,t,i),Kne(n,n),kU(r,n,Math.PI),r):o>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(hy(n,i,s),r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=1+o,DU(r,r))}})();(function(){const n=AP(),e=AP();return function(t,r,i,s,o,a){return fy(n,r,o,a),fy(e,i,s,a),fy(t,n,e,2*a*(1-a)),t}})();(function(){const n=tre();return function(e,t,r,i){return n[0]=r[0],n[3]=r[1],n[6]=r[2],n[1]=i[0],n[4]=i[1],n[7]=i[2],n[2]=-t[0],n[5]=-t[1],n[8]=-t[2],DU(e,NU(e,n))}})();const Qre=[0,0,0,1];class RP extends L1{constructor(e=0,t=0,r=0,i=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,t,r,i)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,t,r,i){return this[0]=e,this[1]=t,this[2]=r,this[3]=i,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return NU(this,e),this.check()}fromAxisRotation(e,t){return kU(this,e,t),this.check()}identity(){return Vre(this),this.check()}setAxisAngle(e,t){return this.fromAxisRotation(e,t)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=It(e)}get y(){return this[1]}set y(e){this[1]=It(e)}get z(){return this[2]}set z(e){this[2]=It(e)}get w(){return this[3]}set w(e){this[3]=It(e)}len(){return Kre(this)}lengthSquared(){return Gre(this)}dot(e){return Xre(this,e)}rotationTo(e,t){return Zre(this,e,t),this.check()}add(e){return Wre(this,this,e),this.check()}calculateW(){return jre(this,this),this.check()}conjugate(){return $re(this,this),this.check()}invert(){return Hre(this,this),this.check()}lerp(e,t,r){return r===void 0?this.lerp(this,e,t):(Yre(this,e,t,r),this.check())}multiplyRight(e){return SP(this,this,e),this.check()}multiplyLeft(e){return SP(this,e,this),this.check()}normalize(){const e=this.len(),t=e>0?1/e:0;return this[0]=this[0]*t,this[1]=this[1]*t,this[2]=this[2]*t,this[3]=this[3]*t,e===0&&(this[3]=1),this.check()}rotateX(e){return Fre(this,this,e),this.check()}rotateY(e){return Bre(this,this,e),this.check()}rotateZ(e){return zre(this,this,e),this.check()}scale(e){return qre(this,this,e),this.check()}slerp(e,t,r){let i,s,o;switch(arguments.length){case 1:({start:i=Qre,target:s,ratio:o}=e);break;case 2:i=this,s=e,o=t;break;default:i=e,s=t,o=r}return fy(this,i,s,o),this.check()}transformVector4(e,t=new V1){return Mre(t,e,this),xd(t,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,t){return this.setAxisAngle(e,t)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const Jre=1e-15,eie=1e-20;function LU(n,e=[],t=0){const r=Math.fround(n),i=n-r;return e[t]=r,e[t+1]=i,e}function tie(n){return n-Math.fround(n)}function nie(n){const e=new Float32Array(32);for(let t=0;t<4;++t)for(let r=0;r<4;++r){const i=t*4+r;LU(n[r*4+t],e,i*2)}return e}const rie=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,iie={name:"fp32",vs:rie},sie=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,oie={ONE:1},aie={name:"fp64arithmetic",vs:sie,defaultUniforms:oie,uniformTypes:{ONE:"f32"},fp64ify:LU,fp64LowPart:tie,fp64ifyMatrix4:nie},lie=[0,1,1,1],cie=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,uie=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,CP={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:lie},vs:cie,fs:uie,getUniforms:hie};function hie(n={},e){const t={};if(n.highlightedObjectColor!==void 0)if(n.highlightedObjectColor===null)t.isHighlightActive=!1;else{t.isHighlightActive=!0;const r=n.highlightedObjectColor.slice(0,3);t.highlightedObjectColor=r}if(n.highlightColor){const r=Array.from(n.highlightColor,i=>i/255);Number.isFinite(r[3])||(r[3]=1),t.highlightColor=r}return n.isActive!==void 0&&(t.isActive=!!n.isActive,t.isAttribute=!!n.isAttribute),n.useFloatColors!==void 0&&(t.useFloatColors=!!n.useFloatColors),t}const IP=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,fie=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  pointLightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,UU=3,die=255;var Qd;(function(n){n[n.POINT=0]="POINT",n[n.DIRECTIONAL=1]="DIRECTIONAL"})(Qd||(Qd={}));const dy={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS:UU},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:Qd.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:fie,vs:IP,fs:IP,getUniforms:pie};function pie(n,e={}){if(n=n&&{...n},!n)return{...dy.defaultUniforms};n.lights&&(n={...n,...mie(n.lights),lights:void 0});const{ambientLight:t,pointLights:r,directionalLights:i}=n||{};if(!(t||r&&r.length>0||i&&i.length>0))return{...dy.defaultUniforms,enabled:0};const o={...dy.defaultUniforms,...e,...gie({ambientLight:t,pointLights:r,directionalLights:i})};return n.enabled!==void 0&&(o.enabled=n.enabled?1:0),o}function gie({ambientLight:n,pointLights:e=[],directionalLights:t=[]}){const r={};r.ambientLightColor=yT(n);let i=0;for(const s of e){r.lightType=Qd.POINT;const o=i;r[`lightColor${o}`]=yT(s),r[`lightPosition${o}`]=s.position,r[`lightAttenuation${o}`]=s.attenuation||[1,0,0],i++}for(const s of t){r.lightType=Qd.DIRECTIONAL;const o=i;r[`lightColor${o}`]=yT(s),r[`lightDirection${o}`]=s.direction,i++}return i>UU&&we.warn("MAX_LIGHTS exceeded")(),r.directionalLightCount=t.length,r.pointLightCount=e.length,r}function mie(n){const e={pointLights:[],directionalLights:[]};for(const t of n||[])switch(t.type){case"ambient":e.ambientLight=t;break;case"directional":e.directionalLights?.push(t);break;case"point":e.pointLights?.push(t);break}return e}function yT(n={}){const{color:e=[0,0,0],intensity:t=1}=n;return e.map(r=>r*t/die)}const yie=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,_ie=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,vie=`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, phongMaterial.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,VU={props:{},name:"gouraudMaterial",vs:_ie.replace("phongMaterial","gouraudMaterial"),fs:yie.replace("phongMaterial","gouraudMaterial"),source:vie.replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:1},dependencies:[dy],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(n){const e={...n};return e.specularColor&&(e.specularColor=e.specularColor.map(t=>t/255)),{...VU.defaultUniforms,...e}}},PP=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,bie={name:"layer",vs:PP,fs:PP,getUniforms:n=>({opacity:Math.pow(n.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},Tie=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,FU="#define SMOOTH_EDGE_RADIUS 0.5",wie=`${FU}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,xie=`${FU}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,BU={name:"geometry",source:Tie,vs:wie,fs:xie},Eie=25;var un;(function(n){n[n.Start=1]="Start",n[n.Move=2]="Move",n[n.End=4]="End",n[n.Cancel=8]="Cancel"})(un||(un={}));var vn;(function(n){n[n.None=0]="None",n[n.Left=1]="Left",n[n.Right=2]="Right",n[n.Up=4]="Up",n[n.Down=8]="Down",n[n.Horizontal=3]="Horizontal",n[n.Vertical=12]="Vertical",n[n.All=15]="All"})(vn||(vn={}));var Ye;(function(n){n[n.Possible=1]="Possible",n[n.Began=2]="Began",n[n.Changed=4]="Changed",n[n.Ended=8]="Ended",n[n.Recognized=8]="Recognized",n[n.Cancelled=16]="Cancelled",n[n.Failed=32]="Failed"})(Ye||(Ye={}));const Aie="compute",Sie="auto",Qw="manipulation",py="none",Jw="pan-x",ex="pan-y";function Rie(n){if(n.includes(py))return py;const e=n.includes(Jw),t=n.includes(ex);return e&&t?py:e||t?e?Jw:ex:n.includes(Qw)?Qw:Sie}class Cie{constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){e===Aie&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));return Rie(e.join(" "))}}function d_(n){return n.trim().split(/\s+/g)}function _T(n,e,t){if(n)for(const r of d_(e))n.addEventListener(r,t,!1)}function vT(n,e,t){if(n)for(const r of d_(e))n.removeEventListener(r,t,!1)}function MP(n){return(n.ownerDocument||n).defaultView}function Iie(n,e){let t=n;for(;t;){if(t===e)return!0;t=t.parentNode}return!1}function zU(n){const e=n.length;if(e===1)return{x:Math.round(n[0].clientX),y:Math.round(n[0].clientY)};let t=0,r=0,i=0;for(;i<e;)t+=n[i].clientX,r+=n[i].clientY,i++;return{x:Math.round(t/e),y:Math.round(r/e)}}function OP(n){const e=[];let t=0;for(;t<n.pointers.length;)e[t]={clientX:Math.round(n.pointers[t].clientX),clientY:Math.round(n.pointers[t].clientY)},t++;return{timeStamp:Date.now(),pointers:e,center:zU(e),deltaX:n.deltaX,deltaY:n.deltaY}}function jU(n,e){const t=e.x-n.x,r=e.y-n.y;return Math.sqrt(t*t+r*r)}function kP(n,e){const t=e.clientX-n.clientX,r=e.clientY-n.clientY;return Math.sqrt(t*t+r*r)}function Pie(n,e){const t=e.x-n.x,r=e.y-n.y;return Math.atan2(r,t)*180/Math.PI}function NP(n,e){const t=e.clientX-n.clientX,r=e.clientY-n.clientY;return Math.atan2(r,t)*180/Math.PI}function HU(n,e){return n===e?vn.None:Math.abs(n)>=Math.abs(e)?n<0?vn.Left:vn.Right:e<0?vn.Up:vn.Down}function Mie(n,e){const t=e.center;let r=n.offsetDelta,i=n.prevDelta;const s=n.prevInput;return(e.eventType===un.Start||s?.eventType===un.End)&&(i=n.prevDelta={x:s?.deltaX||0,y:s?.deltaY||0},r=n.offsetDelta={x:t.x,y:t.y}),{deltaX:i.x+(t.x-r.x),deltaY:i.y+(t.y-r.y)}}function $U(n,e,t){return{x:e/n||0,y:t/n||0}}function Oie(n,e){return kP(e[0],e[1])/kP(n[0],n[1])}function kie(n,e){return NP(e[1],e[0])-NP(n[1],n[0])}function Nie(n,e){const t=n.lastInterval||e,r=e.timeStamp-t.timeStamp;let i,s,o,a;if(e.eventType!==un.Cancel&&(r>Eie||t.velocity===void 0)){const u=e.deltaX-t.deltaX,h=e.deltaY-t.deltaY,d=$U(r,u,h);s=d.x,o=d.y,i=Math.abs(d.x)>Math.abs(d.y)?d.x:d.y,a=HU(u,h),n.lastInterval=e}else i=t.velocity,s=t.velocityX,o=t.velocityY,a=t.direction;e.velocity=i,e.velocityX=s,e.velocityY=o,e.direction=a}function Die(n,e){const{session:t}=n,{pointers:r}=e,{length:i}=r;t.firstInput||(t.firstInput=OP(e)),i>1&&!t.firstMultiple?t.firstMultiple=OP(e):i===1&&(t.firstMultiple=!1);const{firstInput:s,firstMultiple:o}=t,a=o?o.center:s.center,u=e.center=zU(r);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-s.timeStamp,e.angle=Pie(a,u),e.distance=jU(a,u);const{deltaX:h,deltaY:d}=Mie(t,e);e.deltaX=h,e.deltaY=d,e.offsetDirection=HU(e.deltaX,e.deltaY);const g=$U(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=g.x,e.overallVelocityY=g.y,e.overallVelocity=Math.abs(g.x)>Math.abs(g.y)?g.x:g.y,e.scale=o?Oie(o.pointers,r):1,e.rotation=o?kie(o.pointers,r):0,e.maxPointers=t.prevInput?e.pointers.length>t.prevInput.maxPointers?e.pointers.length:t.prevInput.maxPointers:e.pointers.length;let y=n.element;return Iie(e.srcEvent.target,y)&&(y=e.srcEvent.target),e.target=y,Nie(t,e),e}function Lie(n,e,t){const r=t.pointers.length,i=t.changedPointers.length,s=e&un.Start&&r-i===0,o=e&(un.End|un.Cancel)&&r-i===0;t.isFirst=!!s,t.isFinal=!!o,s&&(n.session={}),t.eventType=e;const a=Die(n,t);n.emit("hammer.input",a),n.recognize(a),n.session.prevInput=a}let Uie=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=t=>{this.manager.options.enable&&this.handler(t)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){Lie(this.manager,e,t)}init(){_T(this.element,this.evEl,this.domHandler),_T(this.target,this.evTarget,this.domHandler),_T(MP(this.element),this.evWin,this.domHandler)}destroy(){vT(this.element,this.evEl,this.domHandler),vT(this.target,this.evTarget,this.domHandler),vT(MP(this.element),this.evWin,this.domHandler)}};const Vie={pointerdown:un.Start,pointermove:un.Move,pointerup:un.End,pointercancel:un.Cancel,pointerout:un.Cancel},Fie="pointerdown",Bie="pointermove pointerup pointercancel";class zie extends Uie{constructor(e){super(e),this.evEl=Fie,this.evWin=Bie,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:t}=this;let r=!1;const i=Vie[e.type],s=e.pointerType,o=s==="touch";let a=t.findIndex(u=>u.pointerId===e.pointerId);i&un.Start&&(e.buttons||o)?a<0&&(t.push(e),a=t.length-1):i&(un.End|un.Cancel)&&(r=!0),!(a<0)&&(t[a]=e,this.callback(i,{pointers:t,changedPointers:[e],eventType:i,pointerType:s,srcEvent:e}),r&&t.splice(a,1))}}const jie=["","webkit","Moz","MS","ms","o"];function Hie(n,e){const t=e[0].toUpperCase()+e.slice(1);for(const r of jie){const i=r?r+t:e;if(i in n)return i}}const $ie=1,DP=2,LP={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class Wie{constructor(e,t){this.options={...LP,...t,cssProps:{...LP.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new zie(this),this.touchAction=new Cie(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?DP:$ie}recognize(e){const{session:t}=this;if(t.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let r;const{recognizers:i}=this;let{curRecognizer:s}=t;(!s||s&&s.state&Ye.Recognized)&&(s=t.curRecognizer=null);let o=0;for(;o<i.length;)r=i[o],t.stopped!==DP&&(!s||r===s||r.canRecognizeWith(s))?r.recognize(e):r.reset(),!s&&r.state&(Ye.Began|Ye.Changed|Ye.Ended)&&(s=t.curRecognizer=r),o++}get(e){const{recognizers:t}=this;for(let r=0;r<t.length;r++)if(t[r].options.event===e)return t[r];return null}add(e){if(Array.isArray(e)){for(const r of e)this.add(r);return this}const t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const r of e)this.remove(r);return this}const t=typeof e=="string"?this.get(e):e;if(t){const{recognizers:r}=this,i=r.indexOf(t);i!==-1&&(r.splice(i,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;const{handlers:r}=this;for(const i of d_(e))r[i]=r[i]||[],r[i].push(t)}off(e,t){if(!e)return;const{handlers:r}=this;for(const i of d_(e))t?r[i]&&r[i].splice(r[i].indexOf(t),1):delete r[i]}emit(e,t){const r=this.handlers[e]&&this.handlers[e].slice();if(!r||!r.length)return;const i=t;i.type=e,i.preventDefault=function(){t.srcEvent.preventDefault()};let s=0;for(;s<r.length;)r[s](i),s++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:t}=this;if(t){for(const[r,i]of Object.entries(this.options.cssProps)){const s=Hie(t.style,r);e?(this.oldCssProps[s]=t.style[s],t.style[s]=i):t.style[s]=this.oldCssProps[s]||""}e||(this.oldCssProps={})}}}let qie=1;function Xie(){return qie++}function UP(n){return n&Ye.Cancelled?"cancel":n&Ye.Ended?"end":n&Ye.Changed?"move":n&Ye.Began?"start":""}class WU{constructor(e){this.options=e,this.id=Xie(),this.state=Ye.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const i of e)this.recognizeWith(i);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{simultaneous:r}=this;return r[t.id]||(r[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const r of e)this.dropRecognizeWith(r);return this}let t;return typeof e=="string"?t=this.manager.get(e):t=e,t&&delete this.simultaneous[t.id],this}requireFailure(e){if(Array.isArray(e)){for(const i of e)this.requireFailure(i);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{requireFail:r}=this;return r.indexOf(t)===-1&&(r.push(t),t.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const r of e)this.dropRequireFailure(r);return this}let t;if(typeof e=="string"?t=this.manager.get(e):t=e,t){const r=this.requireFail.indexOf(t);r>-1&&this.requireFail.splice(r,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:t}=this;t<Ye.Ended&&this.manager.emit(this.options.event+UP(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=Ye.Ended&&this.manager.emit(this.options.event+UP(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=Ye.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(Ye.Failed|Ye.Possible)))return!1;e++}return!0}recognize(e){const t={...e};if(!this.options.enable){this.reset(),this.state=Ye.Failed;return}this.state&(Ye.Recognized|Ye.Cancelled|Ye.Failed)&&(this.state=Ye.Possible),this.state=this.process(t),this.state&(Ye.Began|Ye.Changed|Ye.Ended|Ye.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class qU extends WU{attrTest(e){const t=this.options.pointers;return t===0||e.pointers.length===t}process(e){const{state:t}=this,{eventType:r}=e,i=t&(Ye.Began|Ye.Changed),s=this.attrTest(e);return i&&(r&un.Cancel||!s)?t|Ye.Cancelled:i||s?r&un.End?t|Ye.Ended:t&Ye.Began?t|Ye.Changed:Ye.Began:Ye.Failed}}class VP extends WU{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[Qw]}process(e){const{options:t}=this,r=e.pointers.length===t.pointers,i=e.distance<t.threshold,s=e.deltaTime<t.time;if(this.reset(),e.eventType&un.Start&&this.count===0)return this.failTimeout();if(i&&s&&r){if(e.eventType!==un.End)return this.failTimeout();const o=this.pTime?e.timeStamp-this.pTime<t.interval:!0,a=!this.pCenter||jU(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!a||!o?this.count=1:this.count+=1,this._input=e,this.count%t.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=Ye.Recognized,this.tryEmit(this._input)},t.interval),Ye.Began):Ye.Recognized}return Ye.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=Ye.Failed},this.options.interval),Ye.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===Ye.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const Yie=["","start","move","end","cancel","up","down","left","right"];class FP extends qU{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:vn.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,t=[];return e&vn.Horizontal&&t.push(ex),e&vn.Vertical&&t.push(Jw),t}getEventNames(){return Yie.map(e=>this.options.event+e)}directionTest(e){const{options:t}=this;let r=!0,{distance:i}=e,{direction:s}=e;const o=e.deltaX,a=e.deltaY;return s&t.direction||(t.direction&vn.Horizontal?(s=o===0?vn.None:o<0?vn.Left:vn.Right,r=o!==this.pX,i=Math.abs(e.deltaX)):(s=a===0?vn.None:a<0?vn.Up:vn.Down,r=a!==this.pY,i=Math.abs(e.deltaY))),e.direction=s,r&&i>t.threshold&&!!(s&t.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&Ye.Began)||!(this.state&Ye.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const t=vn[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}const Kie=["","start","move","end","cancel","in","out"];class Gie extends qU{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[py]}getEventNames(){return Kie.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&Ye.Began))}emit(e){if(e.scale!==1){const t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}}class ov{constructor(e,t,r){this.element=e,this.callback=t,this.options=r}}const Zie=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Qie=Zie.indexOf("firefox")!==-1,BP=4.000244140625,Jie=40,ese=.25;class tse extends ov{constructor(e,t,r){super(e,t,{enable:!0,...r}),this.handleEvent=i=>{if(!this.options.enable)return;let s=i.deltaY;globalThis.WheelEvent&&(Qie&&i.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(s/=globalThis.devicePixelRatio),i.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(s*=Jie)),s!==0&&s%BP===0&&(s=Math.floor(s/BP)),i.shiftKey&&s&&(s=s*ese),this.callback({type:"wheel",center:{x:i.clientX,y:i.clientY},delta:-s,srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){e==="wheel"&&(this.options.enable=t)}}const zP=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class nse extends ov{constructor(e,t,r){super(e,t,{enable:!0,...r}),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,zP.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){zP.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const jP=["keydown","keyup"];class rse extends ov{constructor(e,t,r){super(e,t,{enable:!0,tabIndex:0,...r}),this.handleEvent=i=>{const s=i.target||i.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:"keydown",srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:"keyup",srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",jP.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){jP.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e==="keydown"&&(this.enableDownEvent=t),e==="keyup"&&(this.enableUpEvent=t)}}class ise extends ov{constructor(e,t,r){super(e,t,r),this.handleEvent=i=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e==="contextmenu"&&(this.options.enable=t)}}const HP=1,tx=2,$P=4,sse={pointerdown:HP,pointermove:tx,pointerup:$P,mousedown:HP,mousemove:tx,mouseup:$P},ose=0,ase=1,lse=2,cse=1,use=2,hse=4;function fse(n){const e=sse[n.srcEvent.type];if(!e)return null;const{buttons:t,button:r}=n.srcEvent;let i=!1,s=!1,o=!1;return e===tx?(i=!!(t&cse),s=!!(t&hse),o=!!(t&use)):(i=r===ose,s=r===ase,o=r===lse),{leftButton:i,middleButton:s,rightButton:o}}function dse(n,e){const t=n.center;if(!t)return null;const r=e.getBoundingClientRect(),i=r.width/e.offsetWidth||1,s=r.height/e.offsetHeight||1,o={x:(t.x-r.left-e.clientLeft)/i,y:(t.y-r.top-e.clientTop)/s};return{center:t,offsetCenter:o}}const pse={srcElement:"root",priority:0};class gse{constructor(e,t){this.handleEvent=r=>{if(this.isEmpty())return;const i=this._normalizeEvent(r);let s=r.srcEvent.target;for(;s&&s!==i.rootElement;){if(this._emit(i,s),i.handled)return;s=s.parentNode}this._emit(i,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,r,i=!1,s=!1){const{handlers:o,handlersByElement:a}=this,u={...pse,...r};let h=a.get(u.srcElement);h||(h=[],a.set(u.srcElement,h));const d={type:e,handler:t,srcElement:u.srcElement,priority:u.priority};i&&(d.once=!0),s&&(d.passive=!0),o.push(d),this._active=this._active||!d.passive;let g=h.length-1;for(;g>=0&&!(h[g].priority>=d.priority);)g--;h.splice(g+1,0,d)}remove(e,t){const{handlers:r,handlersByElement:i}=this;for(let s=r.length-1;s>=0;s--){const o=r[s];if(o.type===e&&o.handler===t){r.splice(s,1);const a=i.get(o.srcElement);a.splice(a.indexOf(o),1),a.length===0&&i.delete(o.srcElement)}}this._active=r.some(s=>!s.passive)}_emit(e,t){const r=this.handlersByElement.get(t);if(r){let i=!1;const s=()=>{e.handled=!0},o=()=>{e.handled=!0,i=!0},a=[];for(let u=0;u<r.length;u++){const{type:h,handler:d,once:g}=r[u];if(d({...e,type:h,stopPropagation:s,stopImmediatePropagation:o}),g&&a.push(r[u]),i)break}for(let u=0;u<a.length;u++){const{type:h,handler:d}=a[u];this.remove(h,d)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...fse(e),...dse(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}function mse(n){if("recognizer"in n)return n;let e;const t=Array.isArray(n)?[...n]:[n];if(typeof t[0]=="function"){const r=t.shift(),i=t.shift()||{};e=new r(i)}else e=t.shift();return{recognizer:e,recognizeWith:typeof t[0]=="string"?[t[0]]:t[0],requireFailure:typeof t[1]=="string"?[t[1]]:t[1]}}class yse{constructor(e=null,t={}){if(this._onBasicInput=r=>{this.manager.emit(r.srcEvent.type,r)},this._onOtherEvent=r=>{this.manager.emit(r.type,r)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,!!e){this.manager=new Wie(e,this.options);for(const r of this.options.recognizers){const{recognizer:i,recognizeWith:s,requireFailure:o}=mse(r);this.manager.add(i),s&&i.recognizeWith(s),o&&i.requireFailure(o)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new tse(e,this._onOtherEvent,{enable:!1}),this.moveInput=new nse(e,this._onOtherEvent,{enable:!1}),this.keyInput=new rse(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new ise(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,r){this._addEventHandler(e,t,r,!1)}once(e,t,r){this._addEventHandler(e,t,r,!0)}watch(e,t,r){this._addEventHandler(e,t,r,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){const{manager:r}=this;if(!r)return;const i=r.get(e);i&&(i.set({enable:t}),r.touchAction.update()),this.wheelInput?.enableEventType(e,t),this.moveInput?.enableEventType(e,t),this.keyInput?.enableEventType(e,t),this.contextmenuInput?.enableEventType(e,t)}_addEventHandler(e,t,r,i,s){if(typeof e!="string"){r=t;for(const[h,d]of Object.entries(e))this._addEventHandler(h,d,r,i,s);return}const{manager:o,events:a}=this;if(!o)return;let u=a.get(e);if(!u){const h=this._getRecognizerName(e)||e;u=new gse(this,h),a.set(e,u),o&&o.on(e,u.handleEvent)}u.add(e,t,r,i,s),u.isEmpty()||this._toggleRecognizer(u.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const[s,o]of Object.entries(e))this._removeEventHandler(s,o);return}const{events:r}=this,i=r.get(e);if(i&&(i.remove(e,t),i.isEmpty())){const{recognizerName:s}=i;let o=!1;for(const a of r.values())if(a.recognizerName===s&&!a.isEmpty()){o=!0;break}o||this._toggleRecognizer(s,!1)}}_getRecognizerName(e){return this.manager.recognizers.find(t=>t.getEventNames().includes(e))?.options.event}}const ot={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(ot,"IDENTITY",{get:()=>(at.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Lr={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},oo={common:0,meters:1,pixels:2},nx={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},WP={multipan:[FP,{threshold:10,direction:vn.Vertical,pointers:2}],pinch:[Gie,{},null,["multipan"]],pan:[FP,{threshold:1},["pinch"],["multipan"]],dblclick:[VP,{event:"dblclick",taps:2}],click:[VP,{event:"click"},null,["dblclick"]]};function _se(n,e){if(n===e)return!0;if(Array.isArray(n)){const t=n.length;if(!e||e.length!==t)return!1;for(let r=0;r<t;r++)if(n[r]!==e[r])return!1;return!0}return!1}function Pp(n){let e={},t;return r=>{for(const i in r)if(!_se(r[i],e[i])){t=n(r),e=r;break}return t}}const qP=[0,0,0,0],vse=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],XU=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],bse=[0,0,0],YU=[0,0,0],Tse=Pp(Ese);function KU(n,e,t=YU){t.length<3&&(t=[t[0],t[1],0]);let r=t,i,s=!0;switch(e===ot.LNGLAT_OFFSETS||e===ot.METER_OFFSETS?i=t:i=n.isGeospatial?[Math.fround(n.longitude),Math.fround(n.latitude),0]:null,n.projectionMode){case Lr.WEB_MERCATOR:(e===ot.LNGLAT||e===ot.CARTESIAN)&&(i=[0,0,0],s=!1);break;case Lr.WEB_MERCATOR_AUTO_OFFSET:e===ot.LNGLAT?r=i:e===ot.CARTESIAN&&(r=[Math.fround(n.center[0]),Math.fround(n.center[1]),0],i=n.unprojectPosition(r),r[0]-=t[0],r[1]-=t[1],r[2]-=t[2]);break;case Lr.IDENTITY:r=n.position.map(Math.fround),r[2]=r[2]||0;break;case Lr.GLOBE:s=!1,i=null;break;default:s=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:r,offsetMode:s}}function wse(n,e,t){const{viewMatrixUncentered:r,projectionMatrix:i}=n;let{viewMatrix:s,viewProjectionMatrix:o}=n,a=qP,u=qP,h=n.cameraPosition;const{geospatialOrigin:d,shaderCoordinateOrigin:g,offsetMode:y}=KU(n,e,t);return y&&(u=n.projectPosition(d||g),h=[h[0]-u[0],h[1]-u[1],h[2]-u[2]],u[3]=1,a=Ih([],u,o),s=r||s,o=Bl([],i,s),o=Bl([],o,vse)),{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:a,originCommon:u,cameraPosCommon:h,shaderCoordinateOrigin:g,geospatialOrigin:d}}function xse({viewport:n,devicePixelRatio:e=1,modelMatrix:t=null,coordinateSystem:r=ot.DEFAULT,coordinateOrigin:i=YU,autoWrapLongitude:s=!1}){r===ot.DEFAULT&&(r=n.isGeospatial?ot.LNGLAT:ot.CARTESIAN);const o=Tse({viewport:n,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:i});return o.wrapLongitude=s,o.modelMatrix=t||XU,o}function Ese({viewport:n,devicePixelRatio:e,coordinateSystem:t,coordinateOrigin:r}){const{projectionCenter:i,viewProjectionMatrix:s,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:u,geospatialOrigin:h}=wse(n,t,r),d=n.getDistanceScales(),g=[n.width*e,n.height*e],y=Ih([],[0,0,-n.focalDistance,1],n.projectionMatrix)[3]||1,v={coordinateSystem:t,projectionMode:n.projectionMode,coordinateOrigin:u,commonOrigin:o.slice(0,3),center:i,pseudoMeters:!!n._pseudoMeters,viewportSize:g,devicePixelRatio:e,focalDistance:y,commonUnitsPerMeter:d.unitsPerMeter,commonUnitsPerWorldUnit:d.unitsPerMeter,commonUnitsPerWorldUnit2:bse,scale:n.scale,wrapLongitude:!1,viewProjectionMatrix:s,modelMatrix:XU,cameraPosition:a};if(h){const T=n.getDistanceScales(h);switch(t){case ot.METER_OFFSETS:v.commonUnitsPerWorldUnit=T.unitsPerMeter,v.commonUnitsPerWorldUnit2=T.unitsPerMeter2;break;case ot.LNGLAT:case ot.LNGLAT_OFFSETS:n._pseudoMeters||(v.commonUnitsPerMeter=T.unitsPerMeter),v.commonUnitsPerWorldUnit=T.unitsPerDegree,v.commonUnitsPerWorldUnit2=T.unitsPerDegree2;break;case ot.CARTESIAN:v.commonUnitsPerWorldUnit=[1,1,T.unitsPerMeter[2]],v.commonUnitsPerWorldUnit2=[0,0,T.unitsPerMeter2[2]];break}}return v}const Ase=Object.keys(ot).map(n=>`const COORDINATE_SYSTEM_${n}: i32 = ${ot[n]};`).join(""),Sse=Object.keys(Lr).map(n=>`const PROJECTION_MODE_${n}: i32 = ${Lr[n]};`).join(""),Rse=Object.keys(oo).map(n=>`const UNIT_${n.toUpperCase()}: i32 = ${oo[n]};`).join(""),Cse=`${Ase}
${Sse}
${Rse}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,Ise=`${Cse}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the zaxis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,Pse=Object.keys(ot).map(n=>`const int COORDINATE_SYSTEM_${n} = ${ot[n]};`).join(""),Mse=Object.keys(Lr).map(n=>`const int PROJECTION_MODE_${n} = ${Lr[n]};`).join(""),Ose=Object.keys(oo).map(n=>`const int UNIT_${n.toUpperCase()} = ${oo[n]};`).join(""),kse=`${Pse}
${Mse}
${Ose}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,Nse={};function Dse(n=Nse){return"viewport"in n?xse(n):{}}const z1={name:"project",dependencies:[iie,BU],source:Ise,vs:kse,getUniforms:Dse,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},Lse=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,Use=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Ph={name:"project32",dependencies:[z1],source:Lse,vs:Use};function Vse(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function zu(n,e){const t=Ih([],e,n);return B1(t,t,1/t[3]),t}function XP(n,e){const t=n%e;return t<0?e+t:t}function rx(n,e,t){return n<e?e:n>t?t:n}function Fse(n){return Math.log(n)*Math.LOG2E}const j1=Math.log2||Fse;function ao(n,e){if(!n)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Ei=Math.PI,GU=Ei/4,ii=Ei/180,ix=180/Ei,sh=512,p_=4003e4,Tu=85.051129,Bse=1.5;function zse(n){return j1(n)}function La(n){const[e,t]=n;ao(Number.isFinite(e)),ao(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const r=e*ii,i=t*ii,s=sh*(r+Ei)/(2*Ei),o=sh*(Ei+Math.log(Math.tan(GU+i*.5)))/(2*Ei);return[s,o]}function oh(n){const[e,t]=n,r=e/sh*(2*Ei)-Ei,i=2*(Math.atan(Math.exp(t/sh*(2*Ei)-Ei))-GU);return[r*ix,i*ix]}function jse(n){const{latitude:e}=n;ao(Number.isFinite(e));const t=Math.cos(e*ii);return zse(p_*t)-9}function bT(n){const e=Math.cos(n*ii);return sh/p_/e}function sx(n){const{latitude:e,longitude:t,highPrecision:r=!1}=n;ao(Number.isFinite(e)&&Number.isFinite(t));const i=sh,s=Math.cos(e*ii),o=i/360,a=o/s,u=i/p_/s,h={unitsPerMeter:[u,u,u],metersPerUnit:[1/u,1/u,1/u],unitsPerDegree:[o,a,u],degreesPerUnit:[1/o,1/a,1/u]};if(r){const d=ii*Math.tan(e*ii)/s,g=o*d/2,y=i/p_*d,v=y/a*u;h.unitsPerDegree2=[0,g,y],h.unitsPerMeter2=[v,0,v]}return h}function ZU(n,e){const[t,r,i]=n,[s,o,a]=e,{unitsPerMeter:u,unitsPerMeter2:h}=sx({longitude:t,latitude:r,highPrecision:!0}),d=La(n);d[0]+=s*(u[0]+h[0]*o),d[1]+=o*(u[1]+h[1]*o);const g=oh(d),y=(i||0)+(a||0);return Number.isFinite(i)||Number.isFinite(a)?[g[0],g[1],y]:g}function Hse(n){const{height:e,pitch:t,bearing:r,altitude:i,scale:s,center:o}=n,a=Vse();f_(a,a,[0,0,-i]),MU(a,a,-t*ii),OU(a,a,r*ii);const u=s/e;return F1(a,a,[u,u,u]),o&&f_(a,a,Yne([],o)),a}function $se(n){const{width:e,height:t,altitude:r,pitch:i=0,offset:s,center:o,scale:a,nearZMultiplier:u=1,farZMultiplier:h=1}=n;let{fovy:d=Jd(Bse)}=n;r!==void 0&&(d=Jd(r));const g=d*ii,y=i*ii,v=H1(d);let T=v;o&&(T+=o[2]*a/Math.cos(y)/t);const w=g*(.5+(s?s[1]:0)/t),E=Math.sin(w)*T/Math.sin(rx(Math.PI/2-y-w,.01,Math.PI-.01)),S=Math.sin(y)*E+T,P=T*10,I=Math.min(S*h,P);return{fov:g,aspect:e/t,focalDistance:v,near:u,far:I}}function Jd(n){return 2*Math.atan(.5/n)*ix}function H1(n){return .5/Math.tan(.5*n*ii)}function QU(n,e){const[t,r,i=0]=n;return ao(Number.isFinite(t)&&Number.isFinite(r)&&Number.isFinite(i)),zu(e,[t,r,i,1])}function $1(n,e,t=0){const[r,i,s]=n;if(ao(Number.isFinite(r)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(s))return zu(e,[r,i,s,1]);const o=zu(e,[r,i,0,1]),a=zu(e,[r,i,1,1]),u=o[2],h=a[2],d=u===h?0:((t||0)-u)/(h-u);return TU([],o,a,d)}function Wse(n){const{width:e,height:t,bounds:r,minExtent:i=0,maxZoom:s=24,offset:o=[0,0]}=n,[[a,u],[h,d]]=r,g=qse(n.padding),y=La([a,rx(d,-Tu,Tu)]),v=La([h,rx(u,-Tu,Tu)]),T=[Math.max(Math.abs(v[0]-y[0]),i),Math.max(Math.abs(v[1]-y[1]),i)],w=[e-g.left-g.right-Math.abs(o[0])*2,t-g.top-g.bottom-Math.abs(o[1])*2];ao(w[0]>0&&w[1]>0);const E=w[0]/T[0],S=w[1]/T[1],P=(g.right-g.left)/2/E,I=(g.top-g.bottom)/2/S,L=[(v[0]+y[0])/2+P,(v[1]+y[1])/2+I],F=oh(L),Y=Math.min(s,j1(Math.abs(Math.min(E,S))));return ao(Number.isFinite(Y)),{longitude:F[0],latitude:F[1],zoom:Y}}function qse(n=0){return typeof n=="number"?{top:n,bottom:n,left:n,right:n}:(ao(Number.isFinite(n.top)&&Number.isFinite(n.bottom)&&Number.isFinite(n.left)&&Number.isFinite(n.right)),n)}const YP=Math.PI/180;function Xse(n,e=0){const{width:t,height:r,unproject:i}=n,s={targetZ:e},o=i([0,r],s),a=i([t,r],s);let u,h;const d=n.fovy?.5*n.fovy*YP:Math.atan(.5/n.altitude),g=(90-n.pitch)*YP;return d>g-.01?(u=KP(n,0,e),h=KP(n,t,e)):(u=i([0,0],s),h=i([t,0],s)),[o,a,h,u]}function KP(n,e,t){const{pixelUnprojectionMatrix:r}=n,i=zu(r,[e,0,1,1]),s=zu(r,[e,n.height,1,1]),a=(t*n.distanceScales.unitsPerMeter[2]-i[2])/(s[2]-i[2]),u=TU([],i,s,a),h=oh(u);return h.push(t),h}const GP=512;function Yse(n){const{width:e,height:t,pitch:r=0}=n;let{longitude:i,latitude:s,zoom:o,bearing:a=0}=n;(i<-180||i>180)&&(i=XP(i+180,360)-180),(a<-180||a>180)&&(a=XP(a+180,360)-180);const u=j1(t/GP);if(o<=u)o=u,s=0;else{const h=t/2/Math.pow(2,o),d=oh([0,h])[1];if(s<d)s=d;else{const g=oh([0,GP-h])[1];s>g&&(s=g)}}return{width:e,height:t,longitude:i,latitude:s,zoom:o,pitch:r,bearing:a}}const JU=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,Kse=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,Gse=`
${JU}
${Kse}
`,Zse=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,Qse=`
${JU}
${Zse}
`,Jse=Pp(ioe),eoe=Pp(soe),toe=[0,0,0,1],noe=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function roe(n,e){const[t,r,i]=n,s=$1([t,r,i],e);return Number.isFinite(i)?s:[s[0],s[1],0]}function ioe({viewport:n,center:e}){return new fr(n.viewProjectionMatrix).invert().transform(e)}function soe({viewport:n,shadowMatrices:e}){const t=[],r=n.pixelUnprojectionMatrix,i=n.isGeospatial?void 0:1,s=[[0,0,i],[n.width,0,i],[0,n.height,i],[n.width,n.height,i],[0,0,-1],[n.width,0,-1],[0,n.height,-1],[n.width,n.height,-1]].map(o=>roe(o,r));for(const o of e){const a=o.clone().translate(new Pe(n.center).negate()),u=s.map(d=>a.transform(d)),h=new fr().ortho({left:Math.min(...u.map(d=>d[0])),right:Math.max(...u.map(d=>d[0])),bottom:Math.min(...u.map(d=>d[1])),top:Math.max(...u.map(d=>d[1])),near:Math.min(...u.map(d=>-d[2])),far:Math.max(...u.map(d=>-d[2]))});t.push(h.multiplyRight(o))}return t}function ooe(n){const{shadowEnabled:e=!0,project:t}=n;if(!e||!t||!n.shadowMatrices||!n.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};const r=z1.getUniforms(t),i=Jse({viewport:t.viewport,center:r.center}),s=[],o=eoe({shadowMatrices:n.shadowMatrices,viewport:t.viewport}).slice();for(let u=0;u<n.shadowMatrices.length;u++){const h=o[u],d=h.clone().translate(new Pe(t.viewport.center).negate());r.coordinateSystem===ot.LNGLAT&&r.projectionMode===Lr.WEB_MERCATOR?(o[u]=d,s[u]=i):(o[u]=h.clone().multiplyRight(noe),s[u]=d.transform(i))}const a={drawShadowMap:!!n.drawToShadowMap,useShadowMap:n.shadowMaps?n.shadowMaps.length>0:!1,color:n.shadowColor||toe,lightId:n.shadowLightId||0,lightCount:n.shadowMatrices.length,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};for(let u=0;u<o.length;u++)a[`viewProjectionMatrix${u}`]=o[u],a[`projectCenter${u}`]=s[u];for(let u=0;u<2;u++)a[`shadow_uShadowMap${u}`]=n.shadowMaps&&n.shadowMaps[u]||n.dummyShadowMap;return a}const ZP={name:"shadow",dependencies:[z1],vs:Gse,fs:Qse,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:ooe,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},Mh={...CP,defaultUniforms:{...CP.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},aoe=[BU],loe=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],coe=[];function uoe(n){const e=kl.getDefaultShaderAssembler();for(const r of aoe)e.addDefaultModule(r);const t=n==="glsl"?loe:coe;for(const r of t)e.addShaderHook(r);return e}const hoe=[255,255,255],foe=1;let doe=0;class poe{constructor(e={}){this.type="ambient";const{color:t=hoe}=e,{intensity:r=foe}=e;this.id=e.id||`ambient-${doe++}`,this.color=t,this.intensity=r}}const goe=[255,255,255],moe=1,yoe=[0,0,-1];let _oe=0;class QP{constructor(e={}){this.type="directional";const{color:t=goe}=e,{intensity:r=moe}=e,{direction:i=yoe}=e,{_shadow:s=!1}=e;this.id=e.id||`directional-${_oe++}`,this.color=t,this.intensity=r,this.type="directional",this.direction=new Pe(i).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}}class voe{constructor(e,t={id:"pass"}){const{id:r}=t;this.id=r,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class W1 extends voe{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[t,r]=this.device.canvasContext.getDrawingBufferSize(),i=e.clearCanvas??!0,s=e.clearColor??(i?[0,0,0,0]:!1),o=i?1:!1,a=i?0:!1,u=e.colorMask??15,h={viewport:[0,0,t,r]};e.colorMask&&(h.colorMask=u),e.scissorRect&&(h.scissorRect=e.scissorRect);const d=this.device.beginRenderPass({framebuffer:e.target,parameters:h,clearColor:s,clearDepth:o,clearStencil:a});try{return this._drawLayers(d,e)}finally{d.end(),this.device.submit()}}_drawLayers(e,t){const{target:r,shaderModuleProps:i,viewports:s,views:o,onViewportActive:a,clearStack:u=!0}=t;t.pass=t.pass||"unknown",u&&(this._lastRenderIndex=-1);const h=[];for(const d of s){const g=o&&o[d.id];a?.(d);const y=this._getDrawLayerParams(d,t),v=d.subViewports||[d];for(const T of v){const w=this._drawLayersInViewport(e,{target:r,shaderModuleProps:i,viewport:T,view:g,pass:t.pass,layers:t.layers},y);h.push(w)}}return h}_getDrawLayerParams(e,{layers:t,pass:r,isPicking:i=!1,layerFilter:s,cullRect:o,effects:a,shaderModuleProps:u},h=!1){const d=[],g=eV(this._lastRenderIndex+1),y={layer:t[0],viewport:e,isPicking:i,renderPass:r,cullRect:o},v={};for(let T=0;T<t.length;T++){const w=t[T],E=this._shouldDrawLayer(w,y,s,v),S={shouldDrawLayer:E};E&&!h&&(S.shouldDrawLayer=!0,S.layerRenderIndex=g(w,E),S.shaderModuleProps=this._getShaderModuleProps(w,a,r,u),S.layerParameters={...w.context.deck?.props.parameters,...this.getLayerParameters(w,T,e)}),d[T]=S}return d}_drawLayersInViewport(e,{layers:t,shaderModuleProps:r,pass:i,target:s,viewport:o,view:a},u){const h=boe(this.device,{shaderModuleProps:r,target:s,viewport:o});if(a&&a.props.clear){const g=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;this.device.beginRenderPass({framebuffer:s,parameters:{viewport:h,scissorRect:h},clearColor:g.color?[0,0,0,0]:!1,clearDepth:g.depth?1:!1}).end()}const d={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:h});for(let g=0;g<t.length;g++){const y=t[g],v=u[g],{shouldDrawLayer:T}=v;if(T&&y.props.pickable&&d.pickableCount++,y.isComposite&&d.compositeCount++,y.isDrawable&&v.shouldDrawLayer){const{layerRenderIndex:w,shaderModuleProps:E,layerParameters:S}=v;d.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,w),E.project&&(E.project.viewport=o),y.context.renderPass=e;try{y._drawLayer({renderPass:e,shaderModuleProps:E,uniforms:{layerIndex:w},parameters:S})}catch(P){y.raiseError(P,`drawing ${y} to ${i}`)}}}return d}shouldDrawLayer(e){return!0}getShaderModuleProps(e,t,r){return null}getLayerParameters(e,t,r){return e.props.parameters}_shouldDrawLayer(e,t,r,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(t))return!1;t.layer=o,o=o.parent}if(r){const a=t.layer.id;if(a in i||(i[a]=r(t)),!i[a])return!1}return e.activateViewport(t.viewport),!0}_getShaderModuleProps(e,t,r,i){const s=this.device.canvasContext.cssToDeviceRatio(),o=e.internalState?.propsInTransition||e.props,a={layer:o,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:s,modelMatrix:o.modelMatrix,coordinateSystem:o.coordinateSystem,coordinateOrigin:o.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(t)for(const u of t)JP(a,u.getShaderModuleProps?.(e,a));return JP(a,this.getShaderModuleProps(e,t,a),i)}}function eV(n=0,e={}){const t={},r=(i,s)=>{const o=i.props._offset,a=i.id,u=i.parent&&i.parent.id;let h;if(u&&!(u in e)&&r(i.parent,!1),u in t){const d=t[u]=t[u]||eV(e[u],e);h=d(i,s),t[a]=d}else Number.isFinite(o)?(h=o+(e[u]||0),t[a]=null):h=n;return s&&h>=n&&(n=h+1),e[a]=h,h};return r}function boe(n,{shaderModuleProps:e,target:t,viewport:r}){const i=e?.project?.devicePixelRatio??n.canvasContext.cssToDeviceRatio(),[,s]=n.canvasContext.getDrawingBufferSize(),o=t?t.height:s,a=r;return[a.x*i,o-(a.y+a.height)*i,a.width*i,a.height*i]}function JP(n,...e){for(const t of e)if(t)for(const r in t)n[r]?Object.assign(n[r],t[r]):n[r]=t[r];return n}class Toe extends W1{constructor(e,t){super(e,t);const r=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),i=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[r],depthStencilAttachment:i})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const t=this.fbo,r=this.device.canvasContext.cssToDeviceRatio(),i=e.viewports[0],s=i.width*r,o=i.height*r,a=[1,1,1,1];(s!==t.width||o!==t.height)&&t.resize({width:s,height:o}),super.render({...e,clearColor:a,target:t,pass:"shadow"})}getLayerParameters(e,t,r){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,t,r){return{shadow:{project:r.project,drawToShadowMap:!0}}}}const woe={color:[255,255,255],intensity:1},eM=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],xoe=[0,0,0,200/255];class tV{constructor(e={}){this.id="lighting-effect",this.shadowColor=xoe,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:t,deck:r}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),r._addDefaultShaderModule(ZP),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const t in e){const r=e[t];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:r,onViewportActive:i,views:s}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let o=0;o<this.shadowPasses.length;o++)this.shadowPasses[o].render({layers:e,layerFilter:t,viewports:r,onViewportActive:i,views:s,shaderModuleProps:{shadow:{shadowLightId:o,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,t){const r=this.shadow?{project:t.project,shadowMaps:this.shadowPasses.map(o=>o.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},i={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(o=>o.getProjectedLight({layer:e})),pointLights:this.pointLights.map(o=>o.getProjectedLight({layer:e}))},s=e.props.material;return{shadow:r,lighting:i,phongMaterial:s,gouraudMaterial:s}}cleanup(e){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(ZP))}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const r=new fr().lookAt({eye:new Pe(t.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const r=new Toe(e);this.shadowPasses[t]=r}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:r}=this;!e&&t.length===0&&r.length===0&&(this.ambientLight=new poe(woe),this.directionalLights.push(new QP(eM[0]),new QP(eM[1])))}}class Eoe{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:r=1,type:i,padding:s=0,copy:o=!1,initialize:a=!1,maxCount:u}){const h=i||e&&e.constructor||Float32Array,d=t*r+s;if(ArrayBuffer.isView(e)){if(d<=e.length)return e;if(d*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new h(e.buffer,0,d)}let g=1/0;u&&(g=u*r+s);const y=this._allocate(h,d,a,g);return e&&o?y.set(e):a||y.fill(0,0,4),this._release(e),y}release(e){this._release(e)}_allocate(e,t,r,i){let s=Math.max(Math.ceil(t*this.opts.overAlloc),1);s>i&&(s=i);const o=this._pool,a=e.BYTES_PER_ELEMENT*s,u=o.findIndex(h=>h.byteLength>=a);if(u>=0){const h=new e(o.splice(u,1)[0],0,s);return r&&h.fill(0),h}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:r}=e,{byteLength:i}=r,s=t.findIndex(o=>o.byteLength>=i);s<0?t.push(r):(s>0||t.length<this.opts.poolSize)&&t.splice(s,0,r),t.length>this.opts.poolSize&&t.shift()}}const ah=new Eoe;function ad(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Aoe(n){return[n[12],n[13],n[14]]}function Soe(n){return{left:uu(n[3]+n[0],n[7]+n[4],n[11]+n[8],n[15]+n[12]),right:uu(n[3]-n[0],n[7]-n[4],n[11]-n[8],n[15]-n[12]),bottom:uu(n[3]+n[1],n[7]+n[5],n[11]+n[9],n[15]+n[13]),top:uu(n[3]-n[1],n[7]-n[5],n[11]-n[9],n[15]-n[13]),near:uu(n[3]+n[2],n[7]+n[6],n[11]+n[10],n[15]+n[14]),far:uu(n[3]-n[2],n[7]-n[6],n[11]-n[10],n[15]-n[14])}}const tM=new Pe;function uu(n,e,t,r){tM.set(n,e,t);const i=tM.len();return{distance:r/i,normal:new Pe(-n/i,-e/i,-t/i)}}function Roe(n){return n-Math.fround(n)}let Xf;function TT(n,e){const{size:t=1,startIndex:r=0}=e,i=e.endIndex!==void 0?e.endIndex:n.length,s=(i-r)/t;Xf=ah.allocate(Xf,s,{type:Float32Array,size:t*2});let o=r,a=0;for(;o<i;){for(let u=0;u<t;u++){const h=n[o++];Xf[a+u]=h,Xf[a+u+t]=Roe(h)}a+=t*2}return Xf.subarray(0,s*t*2)}function Coe(n){let e=null,t=!1;for(const r of n)r&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const Ioe=Math.PI/180,Poe=ad(),nM=[0,0,0],Moe={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function Ooe({width:n,height:e,orthographic:t,fovyRadians:r,focalDistance:i,padding:s,near:o,far:a}){const u=n/e,h=t?new fr().orthographic({fovy:r,aspect:u,focalDistance:i,near:o,far:a}):new fr().perspective({fovy:r,aspect:u,near:o,far:a});if(s){const{left:d=0,right:g=0,top:y=0,bottom:v=0}=s,T=ga((d+n-g)/2,0,n)-n/2,w=ga((y+e-v)/2,0,e)-e/2;h[8]-=T*2/n,h[9]+=w*2/e}return h}class Oh{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||Moe,this.focalDistance=e.focalDistance||1,this.position=e.position||nM,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Lr.WEB_MERCATOR:Lr.WEB_MERCATOR_AUTO_OFFSET:Lr.IDENTITY}equals(e){return e instanceof Oh?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Zs(e.projectionMatrix,this.projectionMatrix)&&Zs(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:t=!0}={}){const r=this.projectPosition(e),i=QU(r,this.pixelProjectionMatrix),[s,o]=i,a=t?o:this.height-o;return e.length===2?[s,a]:[s,a,i[2]]}unproject(e,{topLeft:t=!0,targetZ:r}={}){const[i,s,o]=e,a=t?s:this.height-s,u=r&&r*this.distanceScales.unitsPerMeter[2],h=$1([i,a,o],this.pixelUnprojectionMatrix,u),[d,g,y]=this.unprojectPosition(h);return Number.isFinite(o)?[d,g,y]:Number.isFinite(r)?[d,g,r]:[d,g]}projectPosition(e){const[t,r]=this.projectFlat(e),i=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,r,i]}unprojectPosition(e){const[t,r]=this.unprojectFlat(e),i=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,r,i]}projectFlat(e){if(this.isGeospatial){const t=La(e);return t[1]=ga(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?oh(e):e}getBounds(e={}){const t={targetZ:e.z||0},r=this.unproject([0,0],t),i=this.unproject([this.width,0],t),s=this.unproject([0,this.height],t),o=this.unproject([this.width,this.height],t);return[Math.min(r[0],i[0],s[0],o[0]),Math.min(r[1],i[1],s[1],o[1]),Math.max(r[0],i[0],s[0],o[0]),Math.max(r[1],i[1],s[1],o[1])]}getDistanceScales(e){return e&&this.isGeospatial?sx({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:r=1,height:i=1}){return e<this.x+this.width&&this.x<e+r&&t<this.y+this.height&&this.y<t+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,Soe(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=jse({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||sx({latitude:r,longitude:t}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:s,modelMatrix:o}=e;let a=nM;if(s&&(a=o?new fr(o).transformAsVector(s,[]):s),this.isGeospatial){const u=this.projectPosition([t,r,0]);this.center=new Pe(a).scale(this.distanceScales.unitsPerMeter).add(u)}else this.center=this.projectPosition(a)}_initMatrices(e){const{viewMatrix:t=Poe,projectionMatrix:r=null,orthographic:i=!1,fovyRadians:s,fovy:o=75,near:a=.1,far:u=1e3,padding:h=null,focalDistance:d=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new fr().multiplyRight(t).translate(new Pe(this.center).negate()),this.projectionMatrix=r||Ooe({width:this.width,height:this.height,orthographic:i,fovyRadians:s||o*Ioe,focalDistance:d,padding:h,near:a,far:u});const g=ad();Bl(g,g,this.projectionMatrix),Bl(g,g,this.viewMatrix),this.viewProjectionMatrix=g,this.viewMatrixInverse=Gw([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=Aoe(this.viewMatrixInverse);const y=ad(),v=ad();F1(y,y,[this.width/2,-this.height/2,1]),f_(y,y,[1,-1,0]),Bl(v,y,this.viewProjectionMatrix),this.pixelProjectionMatrix=v,this.pixelUnprojectionMatrix=Gw(ad(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||at.warn("Pixel project matrix not invertible")()}}Oh.displayName="Viewport";class lo extends Oh{constructor(e={}){const{latitude:t=0,longitude:r=0,zoom:i=0,pitch:s=0,bearing:o=0,nearZMultiplier:a=.1,farZMultiplier:u=1.01,nearZ:h,farZ:d,orthographic:g=!1,projectionMatrix:y,repeat:v=!1,worldOffset:T=0,position:w,padding:E,legacyMeterSizes:S=!1}=e;let{width:P,height:I,altitude:L=1.5}=e;const F=Math.pow(2,i);P=P||1,I=I||1;let Y,k=null;if(y)L=y[5]/2,Y=Jd(L);else{e.fovy?(Y=e.fovy,L=H1(Y)):Y=Jd(L);let N;if(E){const{top:H=0,bottom:q=0}=E;N=[0,ga((H+I-q)/2,0,I)-I/2]}k=$se({width:P,height:I,scale:F,center:w&&[0,0,w[2]*bT(t)],offset:N,pitch:s,fovy:Y,nearZMultiplier:a,farZMultiplier:u}),Number.isFinite(h)&&(k.near=h),Number.isFinite(d)&&(k.far=d)}let M=Hse({height:I,pitch:s,bearing:o,scale:F,altitude:L});T&&(M=new fr().translate([512*T,0,0]).multiplyLeft(M)),super({...e,width:P,height:I,viewMatrix:M,longitude:r,latitude:t,zoom:i,...k,fovy:Y,focalDistance:L}),this.latitude=t,this.longitude=r,this.zoom=i,this.pitch=s,this.bearing=o,this.altitude=L,this.fovy=Y,this.orthographic=g,this._subViewports=v?[]:null,this._pseudoMeters=S,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let i=t;i<=r;i++){const s=i?new lo({...this,worldOffset:i}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,r]=this.projectFlat(e),i=(e[2]||0)*bT(e[1]);return[t,r,i]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,r]=this.unprojectFlat(e),i=(e[2]||0)/bT(r);return[t,r,i]}addMetersToLngLat(e,t){return ZU(e,t)}panByPosition(e,t){const r=$1(t,this.pixelUnprojectionMatrix),i=this.projectFlat(e),s=bP([],i,Fne([],r)),o=bP([],this.center,s),[a,u]=this.unprojectFlat(o);return{longitude:a,latitude:u}}getBounds(e={}){const t=Xse(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:r,height:i}=this,{longitude:s,latitude:o,zoom:a}=Wse({width:r,height:i,bounds:e,...t});return new lo({width:r,height:i,longitude:s,latitude:o,zoom:a})}}lo.displayName="WebMercatorViewport";const rM=[0,0,0];function wT(n,e,t=!1){const r=e.projectPosition(n);if(t&&e instanceof lo){const[i,s,o=0]=n,a=e.getDistanceScales([i,s]);r[2]=o*a.unitsPerMeter[2]}return r}function koe(n){const{viewport:e,modelMatrix:t,coordinateOrigin:r}=n;let{coordinateSystem:i,fromCoordinateSystem:s,fromCoordinateOrigin:o}=n;return i===ot.DEFAULT&&(i=e.isGeospatial?ot.LNGLAT:ot.CARTESIAN),s===void 0&&(s=i),o===void 0&&(o=r),{viewport:e,coordinateSystem:i,coordinateOrigin:r,modelMatrix:t,fromCoordinateSystem:s,fromCoordinateOrigin:o}}function nV(n,{viewport:e,modelMatrix:t,coordinateSystem:r,coordinateOrigin:i,offsetMode:s}){let[o,a,u=0]=n;switch(t&&([o,a,u]=Ih([],[o,a,u,1],t)),r){case ot.LNGLAT:return wT([o,a,u],e,s);case ot.LNGLAT_OFFSETS:return wT([o+i[0],a+i[1],u+(i[2]||0)],e,s);case ot.METER_OFFSETS:return wT(ZU(i,[o,a,u]),e,s);case ot.CARTESIAN:default:return e.isGeospatial?[o+i[0],a+i[1],u+i[2]]:e.projectPosition([o,a,u])}}function Noe(n,e){const{viewport:t,coordinateSystem:r,coordinateOrigin:i,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:a}=koe(e),{autoOffset:u=!0}=e,{geospatialOrigin:h=rM,shaderCoordinateOrigin:d=rM,offsetMode:g=!1}=u?KU(t,r,i):{},y=nV(n,{viewport:t,modelMatrix:s,coordinateSystem:o,coordinateOrigin:a,offsetMode:g});if(g){const v=t.projectPosition(h||d);CU(y,y,v)}return y}let Doe=1,Loe=1;class rV{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(e){const{delay:t=0,duration:r=Number.POSITIVE_INFINITY,rate:i=1,repeat:s=1}=e,o=Doe++,a={time:0,delay:t,duration:r,rate:i,repeat:s};return this._setChannelTime(a,this.time),this.channels.set(o,a),o}removeChannel(e){this.channels.delete(e);for(const[t,r]of this.animations)r.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;const t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const i of t)this._setChannelTime(i,this.time);const r=this.animations.values();for(const i of r){const{animation:s,channel:o}=i;s.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const r=Loe++;return this.animations.set(r,{animation:e,channel:t}),e.setTime(this.getTime(t)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const r=t-e.delay,i=e.duration*e.repeat;r>=i?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}function Uoe(n){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(n):setTimeout(n,1e3/60)}function Voe(n){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(n):clearTimeout(n)}let Foe=0;const Boe={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:n=>console.error(n),stats:Ww.stats.get(`animation-loop-${Foe++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class zoe{device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;_error=null;constructor(e){if(this.props={...Boe,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:t=!0}=this.props;this.stats=e.stats||new Rp({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:t}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){if(this.props.onError(e),this._error=Error(),this.device?.canvasContext?.canvas instanceof HTMLCanvasElement){const r=document.createElement("h1");r.innerHTML=e.message,r.style.position="absolute",r.style.top="20%",r.style.left="10px",r.style.color="black",r.style.backgroundColor="red",document.body.appendChild(r)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=Uoe(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(Voe(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device?.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){const e=this.device?.canvasContext?.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.canvasContext?.canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const r=this.props.onAddHTML(t);r&&(t.innerHTML=r)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};const[e,t]=this.device?.canvasContext?.getPixelSize()||[1,1];let r=1;const i=this.device?.canvasContext?.canvas;return i&&i.clientHeight?r=i.clientWidth/i.clientHeight:e>0&&t>0&&(r=e/t),{width:e,height:t,aspect:r}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.props.autoResizeDrawingBuffer&&this.device?.canvasContext?.resize({useDevicePixels:this.props.useDevicePixels})}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const xT={};function av(n="id"){xT[n]=xT[n]||1;const e=xT[n]++;return`${n}-${e}`}class iM{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(e){if(this.id=e.id||av("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&zt.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){this.indices?.destroy();for(const e of Object.values(this.attributes))e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function joe(n,e){if(e instanceof iM)return e;const t=Hoe(n,e),{attributes:r,bufferLayout:i}=$oe(n,e);return new iM({topology:e.topology||"triangle-list",bufferLayout:i,vertexCount:e.vertexCount,indices:t,attributes:r})}function Hoe(n,e){if(!e.indices)return;const t=e.indices.value;return n.createBuffer({usage:zt.INDEX,data:t})}function $oe(n,e){const t=[],r={};for(const[s,o]of Object.entries(e.attributes)){let a=s;switch(s){case"POSITION":a="positions";break;case"NORMAL":a="normals";break;case"TEXCOORD_0":a="texCoords";break;case"COLOR_0":a="colors";break}if(o){r[a]=n.createBuffer({data:o.value,id:`${s}-buffer`});const{value:u,size:h,normalized:d}=o;t.push({name:a,format:Jte(u,h,d)})}}const i=e._calculateVertexCount(e.attributes,e.indices);return{attributes:r,bufferLayout:t,vertexCount:i}}class q1{static defaultProps={...rh.defaultProps};static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new q1(e),e._lumaData.defaultPipelineFactory}device;destroyPolicy;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};constructor(e){this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}createRenderPipeline(e){const t={...rh.defaultProps,...e},r=this._hashRenderPipeline(t);if(!this._renderPipelineCache[r]){const i=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:void 0});i.hash=r,this._renderPipelineCache[r]={pipeline:i,useCount:0}}return this._renderPipelineCache[r].useCount++,this._renderPipelineCache[r].pipeline}createComputePipeline(e){const t={...s_.defaultProps,...e},r=this._hashComputePipeline(t);if(!this._computePipelineCache[r]){const i=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0});i.hash=r,this._computePipelineCache[r]={pipeline:i,useCount:0}}return this._computePipelineCache[r].useCount++,this._computePipelineCache[r].pipeline}release(e){const t=e.hash,r=e instanceof s_?this._computePipelineCache:this._renderPipelineCache;r[t].useCount--,r[t].useCount===0&&this.destroyPolicy==="unused"&&(r[t].pipeline.destroy(),delete r[t])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const t=e.vs?this._getHash(e.vs.source):0,r=e.fs?this._getHash(e.fs.source):0,i="-",s=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${t}/${r}V${i}BL${s}`;default:const o=this._getHash(JSON.stringify(e.parameters));return`${t}/${r}V${i}T${e.topology}P${o}BL${s}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}}class X1{static defaultProps={...iv.defaultProps};static getDefaultShaderFactory(e){return e._lumaData.defaultShaderFactory||=new X1(e),e._lumaData.defaultShaderFactory}device;destroyPolicy;_cache={};constructor(e){this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}createShader(e){const t=this._hashShader(e);let r=this._cache[t];if(!r){const i=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=r={shader:i,useCount:0}}return r.useCount++,r.shader}release(e){const t=this._hashShader(e),r=this._cache[t];r&&(r.useCount--,r.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[t],r.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}}function Woe(n,e){const t={},r="Values";if(n.attributes.length===0&&!n.varyings?.length)return{"No attributes or varyings":{[r]:"N/A"}};for(const i of n.attributes)if(i){const s=`${i.location} ${i.name}: ${i.type}`;t[`in ${s}`]={[r]:i.stepMode||"vertex"}}for(const i of n.varyings||[]){const s=`${i.location} ${i.name}`;t[`out ${s}`]={[r]:JSON.stringify(i)}}return t}let In=null,ET=null;function qoe(n,{id:e,minimap:t,opaque:r,top:i="0",left:s="0",rgbaScale:o=1}){In||(In=document.createElement("canvas"),In.id=e,In.title=e,In.style.zIndex="100",In.style.position="absolute",In.style.top=i,In.style.left=s,In.style.border="blue 5px solid",In.style.transform="scaleY(-1)",document.body.appendChild(In),ET=In.getContext("2d")),(In.width!==n.width||In.height!==n.height)&&(In.width=n.width/2,In.height=n.height/2,In.style.width="400px",In.style.height="400px");const a=n.device.readPixelsToArrayWebGL(n),u=ET?.createImageData(n.width,n.height);if(u){for(let d=0;d<a.length;d+=4)u.data[0+d+0]=a[d+0]*o,u.data[0+d+1]=a[d+1]*o,u.data[0+d+2]=a[d+2]*o,u.data[0+d+3]=r?255:a[d+3]*o;ET?.putImageData(u,0,0)}}function ox(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let r=0;r<n.length;r++)if(!ox(n[r],e[r],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const r=Object.keys(n),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!e.hasOwnProperty(s)||!ox(n[s],e[s],t-1))return!1;return!0}return!1}function Xoe(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function Yoe(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":!1}function iV(n){return Xoe(n)||Yoe(n)}function Koe(n){return iV(n)||typeof n=="number"||typeof n=="boolean"}function sV(n){const e={bindings:{},uniforms:{}};return Object.keys(n).forEach(t=>{const r=n[t];Koe(r)?e.uniforms[t]=r:e.bindings[t]=r}),e}class Goe{options={disableWarnings:!1};modules;moduleUniforms;moduleBindings;constructor(e,t){Object.assign(this.options,t);const r=v1(Object.values(e).filter(i=>i.dependencies));for(const i of r)e[i.name]=i;we.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[i,s]of Object.entries(e))this._addModule(s),s.name&&i!==s.name&&!this.options.disableWarnings&&we.warn(`Module name: ${i} vs ${s.name}`)()}destroy(){}setProps(e){for(const t of Object.keys(e)){const r=t,i=e[r]||{},s=this.modules[r];if(!s){this.options.disableWarnings||we.warn(`Module ${t} not found`)();continue}const o=this.moduleUniforms[r],a=this.moduleBindings[r],u=s.getUniforms?.(i,o)||i,{uniforms:h,bindings:d}=sV(u);this.moduleUniforms[r]={...o,...h},this.moduleBindings[r]={...a,...d}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){const e={};for(const[t,r]of Object.entries(this.moduleUniforms))for(const[i,s]of Object.entries(r))e[`${t}.${i}`]={type:this.modules[t].uniformTypes?.[i],value:String(s)};return e}_addModule(e){const t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}let Zoe="";async function Qoe(n,e){const t=new Image;return t.crossOrigin="anonymous",t.src=n.startsWith("http")?n:Zoe+n,await t.decode(),e?await createImageBitmap(t,e):await createImageBitmap(t)}class AT{device;id;texture;sampler;view;ready;isReady=!1;destroyed=!1;resolveReady=()=>{};rejectReady=()=>{};get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}constructor(e,t){this.device=e,this.id=t.id||av("async-texture"),typeof t?.data=="string"&&t.dimension==="2d"&&(t={...t,data:Qoe(t.data)}),this.ready=new Promise((r,i)=>{this.resolveReady=()=>{this.isReady=!0,r()},this.rejectReady=i}),this.initAsync(t)}async initAsync(e){const t=e.data;let r;try{r=await oV(t)}catch(s){this.rejectReady(s)}if(this.destroyed)return;const i={...e,data:r};this.texture=this.device.createTexture(i),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0,this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}}async function oV(n){if(n=await n,Array.isArray(n))return await Promise.all(n.map(oV));if(n&&typeof n=="object"&&n.constructor===Object){const e=n,t=await Promise.all(Object.values(e)),r=Object.keys(e),i={};for(let s=0;s<r.length;s++)i[r[s]]=t[s];return i}return n}const Sl=2,Joe=1e4;class si{static defaultProps={...rh.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:kl.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};uniforms={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;_getModuleUniforms;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}constructor(e,t){this.props={...si.defaultProps,...t},t=this.props,this.id=t.id||av("model"),this.device=e,Object.assign(this.userData,t.userData);const r=Object.fromEntries(this.props.modules?.map(u=>[u.name,u])||[]),i=t.shaderInputs||new Goe(r,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(i);const s=tae(e),o=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:u,getUniforms:h}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:s,...this.props,modules:o});this.source=u,this._getModuleUniforms=h,this.props.shaderLayout||=Pne(this.source)}else{const{vs:u,fs:h,getUniforms:d}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:s,...this.props,modules:o});this.vs=u,this.fs=h,this._getModuleUniforms=d}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||q1.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||X1.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.uniforms&&this.setUniformsWebGL(t.uniforms),t.moduleSettings&&this.updateModuleSettingsWebGL(t.moduleSettings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||=e}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const t=this._areBindingsLoading();if(t)return we.info(Sl,`>>> DRAWING ABORTED ${this.id}: ${t} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let r;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const i=this._getBindings();this.pipeline.setBindings(i,{disableWarnings:this.props.disableWarnings}),ax(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:s}=this.vertexArray,o=s?s.byteLength/(s.indexType==="uint32"?4:2):void 0;r=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:o,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),r?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",r}setGeometry(e){this._gpuGeometry?.destroy();const t=e&&joe(this.device,e);if(t){this.setTopology(t.topology||"triangle-list");const r=new uT(this.bufferLayout);this.bufferLayout=r.mergeBufferLayouts(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)}this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const t=new uT(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){ox(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new Qte(this.shaderInputs.modules);for(const[t,r]of Object.entries(this.shaderInputs.modules))if(eae(r)){const i=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=i}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){const r=t?.disableWarnings??this.props.disableWarnings;e.indices&&we.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=ene(this.pipeline.shaderLayout,this.bufferLayout);const i=new uT(this.bufferLayout);for(const[s,o]of Object.entries(e)){const a=i.getBufferLayout(s);if(!a){r||we.warn(`Model(${this.id}): Missing layout for buffer "${s}".`)();continue}const u=i.getAttributeNamesForBuffer(a);let h=!1;for(const d of u){const g=this._attributeInfos[d];if(g){const y=this.device.type==="webgpu"?i.getBufferIndex(g.bufferName):g.location;this.vertexArray.setBuffer(y,o),h=!0}}!h&&!r&&we.warn(`Model(${this.id}): Ignoring buffer "${o.id}" for unknown attribute "${s}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[r,i]of Object.entries(e)){const s=this._attributeInfos[r];s?this.vertexArray.setConstantWebGL(s.location,i):(t?.disableWarnings??this.props.disableWarnings)||we.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${r}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){ax(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){const{bindings:t,uniforms:r}=sV(this._getModuleUniforms(e));Object.assign(this.bindings,t),Object.assign(this.uniforms,r),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof AT&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[t,r]of Object.entries(this.bindings))r instanceof AT?r.isReady&&(e[t]=r.texture):e[t]=r;return e}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof rv?e=Math.max(e,t.texture.updateTimestamp):t instanceof zt||t instanceof St?e=Math.max(e,t.updateTimestamp):t instanceof AT?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof Kd||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[r]of Object.entries(t))!this.pipeline.shaderLayout.attributes.find(i=>i.name===r)&&r!=="positions"&&delete t[r];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||=e,this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(we.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const r=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let i=null;this.source?i=r:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:r,fs:i}),this._attributeInfos=K6(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){const e=we.level>3?0:Joe;we.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,we.group(Sl,`>>> DRAWING MODEL ${this.id}`,{collapsed:we.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=Woe(this.pipeline.shaderLayout,this.id);we.table(Sl,e)();const t=this.shaderInputs.getDebugTable();for(const[i,s]of Object.entries(this.uniforms))t[i]={value:s};we.table(Sl,t)();const r=this._getAttributeDebugTable();we.table(Sl,this._attributeInfos)(),we.table(Sl,r)(),we.groupEnd(Sl)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(e){const t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;const r=e.props.framebuffer;r&&qoe(r,{id:r.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,r]of Object.entries(this._attributeInfos)){const i=this.vertexArray.attributes[r.location];e[r.location]={name:t,type:r.shaderType,values:i?this._getBufferOrConstantValues(i,r.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,r=t.indexType==="uint32"?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:r.toString()}}return e}_getBufferOrConstantValues(e,t){const r=Q6(t);return(e instanceof zt?new r(e.debugData):e).toString()}}function eae(n){return!!(n.uniformTypes&&!ax(n.uniformTypes))}function tae(n){return{type:n.type,shaderLanguage:n.info.shadingLanguage,shaderLanguageVersion:n.info.shadingLanguageVersion,gpu:n.info.gpu,features:n.features}}function ax(n){for(const e in n)return!1;return!0}class lh{device;model;transformFeedback;static defaultProps={...si.defaultProps,outputs:void 0,feedbackBuffers:void 0};static isSupported(e){return e?.info?.type==="webgl"}constructor(e,t=lh.defaultProps){if(!lh.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new si(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||tte(),topology:t.topology||"point-list",varyings:t.outputs||t.varyings,...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e?.inputBuffers&&this.model.setAttributes(e.inputBuffers),e?.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(!t)throw new Error("BufferTransform#getBuffer");if(t instanceof zt)return t.readAsync();const{buffer:r,byteOffset:i=0,byteLength:s=r.byteLength}=t;return r.readAsync(i,s)}}class ch{id;topology;vertexCount;indices;attributes;userData={};constructor(e){const{attributes:t={},indices:r=null,vertexCount:i=null}=e;this.id=e.id||av("geometry"),this.topology=e.topology,r&&(this.indices=ArrayBuffer.isView(r)?{value:r,size:1}:r),this.attributes={};for(const[s,o]of Object.entries(t)){const a=ArrayBuffer.isView(o)?{value:o}:o;if(!ArrayBuffer.isView(a.value))throw new Error(`${this._print(s)}: must be typed array or object with value as typed array`);if((s==="POSITION"||s==="positions")&&!a.size&&(a.size=3),s==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=a}else this.attributes[s]=a}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let r=1/0;for(const i of Object.values(e)){const{value:s,size:o,constant:a}=i;!a&&s&&o!==void 0&&o>=1&&(r=Math.min(r,s.length/o))}return r}}const nae={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class aV extends W1{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:r,viewports:i,onViewportActive:s,pickingFBO:o,deviceRect:{x:a,y:u,width:h,height:d},cullRect:g,effects:y,pass:v="picking",pickZ:T,shaderModuleProps:w}){this.pickZ=T;const E=this._resetColorEncoder(T),S=[a,u,h,d],P=super.render({target:o,layers:e,layerFilter:t,views:r,viewports:i,onViewportActive:s,cullRect:g,effects:y?.filter(L=>L.useInPicking),pass:v,isPicking:!0,shaderModuleProps:w,clearColor:[0,0,0,0],colorMask:15,scissorRect:S});return this._colorEncoderState=null,{decodePickingColor:E&&iae.bind(null,E),stats:P}}shouldDrawLayer(e){const{pickable:t,operation:r}=e.props;return t&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getShaderModuleProps(e,t,r){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,t,r){const i={...e.props.parameters},{pickable:s,operation:o}=e.props;return!this._colorEncoderState||o.includes("terrain")?i.blend=!1:s&&o.includes("draw")&&(Object.assign(i,nae),i.blend=!0,i.blendColor=rae(this._colorEncoderState,e,r)),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function rae(n,e,t){const{byLayer:r,byAlpha:i}=n;let s,o=r.get(e);return o?(o.viewports.push(t),s=o.a):(s=r.size+1,s<=255?(o={a:s,layer:e,viewports:[t]},r.set(e,o),i[s]=o):(at.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function iae(n,e){const t=n.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}const yu={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},g_=Symbol.for("component"),Sa=Symbol.for("propTypes"),ST=Symbol.for("deprecatedProps"),ju=Symbol.for("asyncPropDefaults"),nc=Symbol.for("asyncPropOriginal"),ma=Symbol.for("asyncPropResolved");function lv(n,e=()=>!0){return Array.isArray(n)?lV(n,e,[]):e(n)?[n]:[]}function lV(n,e,t){let r=-1;for(;++r<n.length;){const i=n[r];Array.isArray(i)?lV(i,e,t):e(i)&&t.push(i)}return t}function sae({target:n,source:e,start:t=0,count:r=1}){const i=e.length,s=r*i;let o=0;for(let a=t;o<i;o++)n[a++]=e[o];for(;o<s;)o<s-o?(n.copyWithin(t+o,t,t+o),o*=2):(n.copyWithin(t+o,t,t+s-o),o=s);return n}class oae{constructor(e,t,r){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=r,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const r=++this._loadCount;let i=e;typeof e=="string"&&(i=n_(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const s of this._subscribers)s.onChange(this.getData())}}class aae{constructor(e){this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:e.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:t,forceUpdate:r=!1,persistent:i=!0}){let s=this._resources[e];s?s.setData(t,r):(s=new oae(e,t,this._context),this._resources[e]=s),s.persistent=i}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const r in t){const i=t[r],s=this._resources[i.resourceId];s&&s.unsubscribe(i)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:r,requestId:i="default"}){const{_resources:s,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),s[e]||this.add({resourceId:e,data:null,persistent:!1}));const a=s[e];if(this._track(r,i,a,t),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,r,i){const s=this._consumers,o=s[e]=s[e]||{};let a=o[t];const u=a&&a.resourceId&&this._resources[a.resourceId];u&&(u.unsubscribe(a),this.prune()),r&&(a?(a.onChange=i,a.resourceId=r.id):a={onChange:i,resourceId:r.id},o[t]=a,r.subscribe(a))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}const lae="layerManager.setLayers",cae="layerManager.activateViewport";class uae{constructor(e,t){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=a=>{Jn(cae,this,a),a&&(this.context.viewport=a)};const{deck:r,stats:i,viewport:s,timeline:o}=t||{};this.layers=[],this.resourceManager=new aae({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e?.gl,deck:r,shaderAssembler:uoe(e?.info?.shadingLanguage||"glsl"),defaultShaderModules:[bie],renderPass:void 0,stats:i||new Rp({id:"deck.gl"}),viewport:s||new Oh({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new rV,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const i=r.getNeedsRedraw(e);t=t||i}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(r=>t.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){Jn(lae,this,t,e),this._lastRenderedLayers=e;const r=lv(e,Boolean);for(const i of r)i.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:t}=this.context;t.find(r=>r.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:t}=this.context,r=t.findIndex(i=>i.name===e.name);r>=0&&(t.splice(r,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,r){r.raiseError(t,`${e} of ${r}`)}_updateLayers(e,t){const r={};for(const o of e)r[o.id]?at.warn(`Multiple old layers with same id ${o.id}`)():r[o.id]=o;if(this._defaultShaderModulesChanged){for(const o of e)o.setNeedsUpdate(),o.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const i=[];this._updateSublayersRecursively(t,r,i),this._finalizeOldLayers(r);let s=!1;for(const o of i)if(o.hasUniformTransition()){s=`Uniform transition in ${o}`;break}this._needsUpdate=s,this.layers=i}_updateSublayersRecursively(e,t,r){for(const i of e){i.context=this.context;const s=t[i.id];s===null&&at.warn(`Multiple new layers with same id ${i.id}`)(),t[i.id]=null;let o=null;try{this._debug&&s!==i&&i.validateProps(),s?(this._transferLayerState(s,i),this._updateLayer(i)):this._initializeLayer(i),r.push(i),o=i.isComposite?i.getSubLayers():null}catch(a){this._handleError("matching",a,i)}o&&this._updateSublayersRecursively(o,t,r)}}_finalizeOldLayers(e){for(const t in e){const r=e[t];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=yu.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=yu.MATCHED,t!==e&&(e.lifecycle=yu.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=yu.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=yu.FINALIZED}catch(t){this._handleError("finalization",t,e)}}}function Ai(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let r=0;r<n.length;r++)if(!Ai(n[r],e[r],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const r=Object.keys(n),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!e.hasOwnProperty(s)||!Ai(n[s],e[s],t-1))return!1;return!0}return!1}class hae{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t=typeof e=="string"?this.getView(e):e,r=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,t){const r=this.getViewports(),i={x:e[0],y:e[1]};for(let s=r.length-1;s>=0;--s){const o=r[s];if(o.containsPixel(i)){const a=e.slice();return a[0]-=o.x,a[1]-=o.y,o.unproject(a,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=lv(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Ai(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):at.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){const r=t.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>this.getView(e.id)?.makeViewport({viewState:s,width:this.width,height:this.height})})}_updateController(e,t,r,i){const s=e.controller;if(s&&r){const o={...t,...s,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!i||i.constructor!==s.type)&&(i=this._createController(e,o)),i&&i.setProps(o),i}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let i=e.length;i--;){const s=e[i],o=this.getViewState(s),a=s.makeViewport({viewState:o,width:this.width,height:this.height});let u=t[s.id];const h=!!s.controller;h&&!u&&(r=!0),(r||!h)&&u&&(u.finalize(),u=null),this.controllers[s.id]=this._updateController(s,o,a,u),a&&this._viewports.unshift(a)}for(const i in t){const s=t[i];s&&!this.controllers[i]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((r,i)=>!e[i].equals(t[i]))}}const fae=/([0-9]+\.?[0-9]*)(%|px)/;function ea(n){switch(typeof n){case"number":return{position:n,relative:!1};case"string":const e=fae.exec(n);if(e&&e.length>=3){const t=e[2]==="%",r=parseFloat(e[1]);return{position:t?r/100:r,relative:t}}default:throw new Error(`Could not parse position string ${n}`)}}function ta(n,e){return n.relative?Math.round(n.position*e):n.position}class uh{constructor(e){const{id:t,x:r=0,y:i=0,width:s="100%",height:o="100%",padding:a=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=ea(r),this._y=ea(i),this._width=ea(s),this._height=ea(o),this._padding=a&&{left:ea(a.left||0),right:ea(a.right||0),top:ea(a.top||0),bottom:ea(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&Ai(this.props,e.props,2)}makeViewport({width:e,height:t,viewState:r}){r=this.filterViewState(r);const i=this.getDimensions({width:e,height:t});if(!i.height||!i.width)return null;const s=this.getViewportType(r);return new s({...r,...this.props,...i})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:e?.id||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const r in this.props.viewState)r!=="id"&&(t[r]=this.props.viewState[r]);return t}return e}getDimensions({width:e,height:t}){const r={x:ta(this._x,e),y:ta(this._y,t),width:ta(this._width,e),height:ta(this._height,t)};return this._padding&&(r.padding={left:ta(this._padding.left,e),top:ta(this._padding.top,t),right:ta(this._padding.right,e),bottom:ta(this._padding.bottom,t)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class cv{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){this.cancel(),this.settings=e,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:e,settings:t}=this;this._handle=e.addChannel({delay:e.getTime(),duration:t.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const sM=()=>{},lx={BREAK:1,SNAP_TO_END:2,IGNORE:3},dae=n=>n,pae=lx.BREAK;class gae{constructor(e){this._onTransitionUpdate=t=>{const{time:r,settings:{interpolator:i,startProps:s,endProps:o,duration:a,easing:u}}=t,h=u(r/a),d=i.interpolateProps(s,o,h);this.propsInTransition=this.getControllerState({...this.props,...d}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new cv(e.timeline),this.onViewStateChange=e.onViewStateChange||sM,this.onStateChange=e.onStateChange||sM}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let i=r;if(this.transition.inProgress){const{interruption:s,endProps:o}=this.transition.settings;i={...r,...s===lx.SNAP_TO_END?o:this.propsInTransition||r}}this._triggerTransition(i,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:r}=e;return(t>0||t==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===lx.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const r=this.getControllerState(e),i=this.getControllerState(t).shortestPathFrom(r),s=t.transitionInterpolator,o=s.getDuration?s.getDuration(e,t):t.transitionDuration;if(o===0)return;const a=s.initializeProps(e,i);this.propsInTransition={};const u={duration:o,easing:t.transitionEasing||dae,interpolator:s,interruption:t.transitionInterruption||pae,startProps:a.start,endProps:a.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(u),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(t)}}}function Bn(n,e){if(!n)throw new Error(e||"deck.gl: assertion failed.")}class mae{constructor(e){const{compare:t,extract:r,required:i}=e;this._propsToCompare=t,this._propsToExtract=r||t,this._requiredProps=i}arePropsEqual(e,t){for(const r of this._propsToCompare)if(!(r in e)||!(r in t)||!Zs(e[r],t[r]))return!1;return!0}initializeProps(e,t){const r={},i={};for(const s of this._propsToExtract)(s in e||s in t)&&(r[s]=e[s],i[s]=t[s]);return this._checkRequiredProps(r),this._checkRequiredProps(i),{start:r,end:i}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const r=e[t];Bn(Number.isFinite(r)||Array.isArray(r),`${t} is required for transition`)})}}const yae=["longitude","latitude","zoom","bearing","pitch"],_ae=["longitude","latitude","zoom"];class cV extends mae{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:yae,required:_ae},super(r.transitionProps),this.opts=r}initializeProps(e,t){const r=super.initializeProps(e,t),{makeViewport:i,around:s}=this.opts;if(i&&s){const o=i(e),a=i(t),u=o.unproject(s);r.start.around=s,Object.assign(r.end,{around:a.project(u),aroundPosition:u,width:t.width,height:t.height})}return r}interpolateProps(e,t,r){const i={};for(const s of this._propsToExtract)i[s]=Fl(e[s]||0,t[s]||0,r);if(t.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...t,...i});Object.assign(i,s.panByPosition(t.aroundPosition,Fl(e.around,t.around,r)))}return i}}const na={transitionDuration:0},vae=300,Rm=n=>1-(1-n)*(1-n),hu={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},Rl={};class bae{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new gae({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const e in this._events)this._events[e]&&this.eventManager?.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return t?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:r}=this.props,{offsetCenter:i}=e;return[i.x-t,i.y-r]}isPointInBounds(e,t){const{width:r,height:i}=this.props;if(t&&t.handled)return!1;const s=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=i;return s&&t&&t.stopPropagation(),s}isFunctionKeyPressed(e){const{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?vae:0;const{scrollZoom:r=!0,dragPan:i=!0,dragRotate:s=!0,doubleClickZoom:o=!0,touchZoom:a=!0,touchRotate:u=!1,keyboard:h=!0}=e,d=!!this.onViewStateChange;this.toggleEvents(hu.WHEEL,d&&r),this.toggleEvents(hu.PAN,d),this.toggleEvents(hu.PINCH,d&&(a||u)),this.toggleEvents(hu.MULTI_PAN,d&&u),this.toggleEvents(hu.DOUBLE_CLICK,d&&o),this.toggleEvents(hu.KEYBOARD,d&&h),this.scrollZoom=r,this.dragPan=i,this.dragRotate=s,this.doubleClickZoom=o,this.touchZoom=a,this.touchRotate=u,this.keyboard=h}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(r=>{this._events[r]!==t&&(this._events[r]=t,t?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,t=null,r={}){const i={...e.getViewportProps(),...t},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),s){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:o,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const i=this.controllerState[r?"panStart":"rotateStart"]({pos:t});return this._panMove=r,this.updateViewport(i,na,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),r=this.controllerState.pan({pos:t});return this.updateViewport(r,na,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2],s=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Rm},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),r=this.controllerState.rotate({pos:t});return this.updateViewport(r,na,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2],s=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Rm},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:r=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=e;let o=2/(1+Math.exp(-Math.abs(s*r)));s<0&&o!==0&&(o=1/o);const a=this.controllerState.zoom({pos:t,scale:o});return this.updateViewport(a,{...this._getTransitionProps({around:t}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.controllerState.rotateStart({pos:t});return this.updateViewport(r,na,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const r=this.controllerState.rotate({pos:t});return this.updateViewport(r,na,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const r=this.getCenter(e),i=[r[0],r[1]+=e.velocityY*t/2],s=this.controllerState.rotate({pos:i});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Rm},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return Rl._startPinchRotation=e.rotation,Rl._lastPinchEvent=e,this.updateViewport(r,na,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:r}=e,i=this.getCenter(e);t=t.zoom({pos:i,scale:r})}if(this.touchRotate){const{rotation:r}=e;t=t.rotate({deltaAngleX:Rl._startPinchRotation-r})}return this.updateViewport(t,na,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Rl._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:r}=Rl;if(this.touchZoom&&t&&r&&e.scale!==r.scale){const i=this.getCenter(e);let s=this.controllerState.rotateEnd();const o=Math.log2(e.scale),a=(o-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),u=Math.pow(2,o+a*t/2);s=s.zoom({pos:i,scale:u}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:i}),transitionDuration:t,transitionEasing:Rm},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Rl._startPinchRotation=null,Rl._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:t,scale:r?.5:2});return this.updateViewport(i,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:i,rotateSpeedX:s,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let u;const h={};switch(e.srcEvent.code){case"Minus":u=t?a.zoomOut(r).zoomOut(r):a.zoomOut(r),h.isZooming=!0;break;case"Equal":u=t?a.zoomIn(r).zoomIn(r):a.zoomIn(r),h.isZooming=!0;break;case"ArrowLeft":t?(u=a.rotateLeft(s),h.isRotating=!0):(u=a.moveLeft(i),h.isPanning=!0);break;case"ArrowRight":t?(u=a.rotateRight(s),h.isRotating=!0):(u=a.moveRight(i),h.isPanning=!0);break;case"ArrowUp":t?(u=a.rotateUp(o),h.isRotating=!0):(u=a.moveUp(i),h.isPanning=!0);break;case"ArrowDown":t?(u=a.rotateDown(o),h.isRotating=!0):(u=a.moveDown(i),h.isPanning=!0);break;default:return!1}return this.updateViewport(u,this._getTransitionProps(),h),!0}_getTransitionProps(e){const{transition:t}=this;return!t||!t.transitionInterpolator?na:e?{...t,transitionInterpolator:new cV({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}}class Tae{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}const oM=5,wae=1.2;class xae extends Tae{constructor(e){const{width:t,height:r,latitude:i,longitude:s,zoom:o,bearing:a=0,pitch:u=0,altitude:h=1.5,position:d=[0,0,0],maxZoom:g=20,minZoom:y=0,maxPitch:v=60,minPitch:T=0,startPanLngLat:w,startZoomLngLat:E,startRotatePos:S,startBearing:P,startPitch:I,startZoom:L,normalize:F=!0}=e;Bn(Number.isFinite(s)),Bn(Number.isFinite(i)),Bn(Number.isFinite(o)),super({width:t,height:r,latitude:i,longitude:s,zoom:o,bearing:a,pitch:u,altitude:h,maxZoom:g,minZoom:y,maxPitch:v,minPitch:T,normalize:F,position:d},{startPanLngLat:w,startZoomLngLat:E,startRotatePos:S,startBearing:P,startPitch:I,startZoom:L}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const r=this.getState().startPanLngLat||this._unproject(t);if(!r)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:r=0}){const{startRotatePos:i,startBearing:s,startPitch:o}=this.getState();if(!i||s===void 0||o===void 0)return this;let a;return e?a=this._getNewRotation(e,i,o,s):a={bearing:s+t,pitch:o+r},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:r}){let{startZoom:i,startZoomLngLat:s}=this.getState();if(s||(i=this.getViewportProps().zoom,s=this._unproject(t)||this._unproject(e)),!s)return this;const{maxZoom:o,minZoom:a}=this.getViewportProps();let u=i+Math.log2(r);u=ga(u,a,o);const h=this.makeViewport({...this.getViewportProps(),zoom:u});return this._getUpdatedState({zoom:u,...h.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),r={...this.getViewportProps()},{bearing:i,longitude:s}=r;return Math.abs(i-t.bearing)>180&&(r.bearing=i<0?i+360:i-360),Math.abs(s-t.longitude)>180&&(r.longitude=s<0?s+360:s-360),r}applyConstraints(e){const{maxZoom:t,minZoom:r,zoom:i}=e;e.zoom=ga(i,r,t);const{maxPitch:s,minPitch:o,pitch:a}=e;e.pitch=ga(a,o,s);const{normalize:u=!0}=e;return u&&Object.assign(e,Yse(e)),e}_zoomFromCenter(e){const{width:t,height:r}=this.getViewportProps();return this.zoom({pos:[t/2,r/2],scale:e})}_panFromCenter(e){const{width:t,height:r}=this.getViewportProps();return this.pan({startPos:[t/2,r/2],pos:[t/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,r,i){const s=e[0]-t[0],o=e[1]-t[1],a=e[1],u=t[1],{width:h,height:d}=this.getViewportProps(),g=s/h;let y=0;o>0?Math.abs(d-u)>oM&&(y=o/(u-d)*wae):o<0&&u>oM&&(y=1-a/u),y=ga(y,-1,1);const{minPitch:v,maxPitch:T}=this.getViewportProps(),w=i+180*g;let E=r;return y>0?E=r+y*(T-r):y<0&&(E=r-y*(v-r)),{pitch:E,bearing:w}}}class Eae extends bae{constructor(){super(...arguments),this.ControllerState=xae,this.transition={transitionDuration:300,transitionInterpolator:new cV({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class Y1 extends uh{constructor(e={}){super(e)}getViewportType(){return lo}get ControllerType(){return Eae}}Y1.displayName="MapView";const Aae=new tV;function Sae(n,e){const t=n.order??1/0,r=e.order??1/0;return t-r}class Rae{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(r=>r.id===e.id)){const r=t.findIndex(i=>Sae(i,e)>0);r<0?t.push(e):t.splice(r,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Ai(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const i of this.effects)t[i.id]=i;const r=[];for(const i of e){const s=t[i.id];let o=i;s&&s!==i?s.setProps?(s.setProps(i.props),o=s):s.cleanup(this._context):s||i.setup(this._context),r.push(o),delete t[i.id]}for(const i in t)t[i].cleanup(this._context);this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(i=>i instanceof tV)||this._resolvedEffects.push(Aae),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class Cae extends W1{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const Iae="deckRenderer.renderLayers";class Pae{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new Cae(e),this.pickLayersPass=new aV(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};r.effects&&this._preRender(r.effects,r);const i=this.lastPostProcessEffect?this.renderBuffers[0]:r.target;this.lastPostProcessEffect&&(r.clearColor=[0,0,0,0],r.clearCanvas=!0);const s=t.render({...r,target:i});r.effects&&this._postRender(r.effects,r),this.renderCount++,Jn(Iae,this,s,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const r of e)t.preRenderStats[r.id]=r.preRender(t),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(r=>{const i=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${r}`,colorAttachments:[i]}))});for(const r of e)r.resize(t)}_postRender(e,t){const{renderBuffers:r}=this,i={...t,inputBuffer:r[0],swapBuffer:r[1]};for(const s of e)if(s.postRender){i.target=s.id===this.lastPostProcessEffect?t.target:void 0;const o=s.postRender(i);i.inputBuffer=o,i.swapBuffer=o===r[0]?r[1]:r[0]}}}const Mae={pickedColor:null,pickedObjectIndex:-1};function Oae({pickedColors:n,decodePickingColor:e,deviceX:t,deviceY:r,deviceRadius:i,deviceRect:s}){const{x:o,y:a,width:u,height:h}=s;let d=i*i,g=-1,y=0;for(let v=0;v<h;v++){const T=v+a-r,w=T*T;if(w>d)y+=4*u;else for(let E=0;E<u;E++){if(n[y+3]-1>=0){const P=E+o-t,I=P*P+w;I<=d&&(d=I,g=y)}y+=4}}if(g>=0){const v=n.slice(g,g+4),T=e(v);if(T){const w=Math.floor(g/4/u),E=g/4-w*u;return{...T,pickedColor:v,pickedX:o+E,pickedY:a+w}}at.error("Picked non-existent layer. Is picking buffer corrupt?")()}return Mae}function kae({pickedColors:n,decodePickingColor:e}){const t=new Map;if(n){for(let r=0;r<n.length;r+=4)if(n[r+3]-1>=0){const s=n.slice(r,r+4),o=s.join(",");if(!t.has(o)){const a=e(s);a?t.set(o,{...a,color:s}):at.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(t.values())}function uV({pickInfo:n,viewports:e,pixelRatio:t,x:r,y:i,z:s}){let o=e[0];e.length>1&&(o=Dae(n?.pickedViewports||e,{x:r,y:i}));let a;if(o){const u=[r-o.x,i-o.y];s!==void 0&&(u[2]=s),a=o.unproject(u)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:r,y:i,pixel:[r,i],coordinate:a,devicePixel:n&&"pickedX"in n?[n.pickedX,n.pickedY]:void 0,pixelRatio:t}}function Nae(n){const{pickInfo:e,lastPickedInfo:t,mode:r,layers:i}=n,{pickedColor:s,pickedLayer:o,pickedObjectIndex:a}=e,u=o?[o]:[];if(r==="hover"){const g=t.index,y=t.layerId,v=o?o.props.id:null;if(v!==y||a!==g){if(v!==y){const T=i.find(w=>w.props.id===y);T&&u.unshift(T)}t.layerId=v,t.index=a,t.info=null}}const h=uV(n),d=new Map;return d.set(null,h),u.forEach(g=>{let y={...h};g===o&&(y.color=s,y.index=a,y.picked=!0),y=hV({layer:g,info:y,mode:r});const v=y.layer;g===o&&r==="hover"&&(t.info=y),d.set(v.id,y),r==="hover"&&v.updateAutoHighlight(y)}),d}function hV({layer:n,info:e,mode:t}){for(;n&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=n,e=n.getPickingInfo({info:e,mode:t,sourceLayer:r}),n=n.parent}return e}function Dae(n,e){for(let t=n.length-1;t>=0;t--){const r=n[t];if(r.containsPixel(e))return r}return n[0]}class Lae{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new aV(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:r,viewports:i},s=this.lastPickedInfo.info){const o=s&&s.layer&&s.layer.id,a=s&&s.viewport&&s.viewport.id,u=o?r.find(y=>y.id===o):null,h=a&&i.find(y=>y.id===a)||i[0],d=h&&h.unproject([e-h.x,t-h.y]);return{...s,...{x:e,y:t,viewport:h,coordinate:d,layer:u}}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const t=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=t}const{canvas:e}=this.device.getDefaultCanvasContext();this.pickingFBO?.resize({width:e.width,height:e.height}),this.depthFBO?.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const t=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return t.length?t:null}_pickClosestObject({layers:e,views:t,viewports:r,x:i,y:s,radius:o=0,depth:a=1,mode:u="query",unproject3D:h,onViewportActive:d,effects:g}){const y=this.device.canvasContext.cssToDeviceRatio(),v=this._getPickable(e);if(!v||r.length===0)return{result:[],emptyInfo:uV({viewports:r,x:i,y:s,pixelRatio:y})};this._resizeBuffer();const T=this.device.canvasContext.cssToDevicePixels([i,s],!0),w=[T.x+Math.floor(T.width/2),T.y+Math.floor(T.height/2)],E=Math.round(o*y),{width:S,height:P}=this.pickingFBO,I=this._getPickingRect({deviceX:w[0],deviceY:w[1],deviceRadius:E,deviceWidth:S,deviceHeight:P}),L={x:i-o,y:s-o,width:o*2+1,height:o*2+1};let F;const Y=[],k=new Set;for(let M=0;M<a;M++){let N;if(I){const q=this._drawAndSample({layers:v,views:t,viewports:r,onViewportActive:d,deviceRect:I,cullRect:L,effects:g,pass:`picking:${u}`});N=Oae({...q,deviceX:w[0],deviceY:w[1],deviceRadius:E,deviceRect:I})}else N={pickedColor:null,pickedObjectIndex:-1};let H;if(N.pickedLayer&&h&&this.depthFBO){const{pickedColors:q}=this._drawAndSample({layers:[N.pickedLayer],views:t,viewports:r,onViewportActive:d,deviceRect:{x:N.pickedX,y:N.pickedY,width:1,height:1},cullRect:L,effects:g,pass:`picking:${u}:z`},!0);q[3]&&(H=q[0])}N.pickedLayer&&M+1<a&&(k.add(N.pickedLayer),N.pickedLayer.disablePickingIndex(N.pickedObjectIndex)),F=Nae({pickInfo:N,lastPickedInfo:this.lastPickedInfo,mode:u,layers:v,viewports:r,x:i,y:s,z:H,pixelRatio:y});for(const q of F.values())q.layer&&Y.push(q);if(!N.pickedColor)break}for(const M of k)M.restorePickingColors();return{result:Y,emptyInfo:F.get(null)}}_pickVisibleObjects({layers:e,views:t,viewports:r,x:i,y:s,width:o=1,height:a=1,mode:u="query",maxObjects:h=null,onViewportActive:d,effects:g}){const y=this._getPickable(e);if(!y||r.length===0)return[];this._resizeBuffer();const v=this.device.canvasContext.cssToDeviceRatio(),T=this.device.canvasContext.cssToDevicePixels([i,s],!0),w=T.x,E=T.y+T.height,S=this.device.canvasContext.cssToDevicePixels([i+o,s+a],!0),P=S.x+S.width,I=S.y,L={x:w,y:I,width:P-w,height:E-I},F=this._drawAndSample({layers:y,views:t,viewports:r,onViewportActive:d,deviceRect:L,cullRect:{x:i,y:s,width:o,height:a},effects:g,pass:`picking:${u}`}),Y=kae(F),k=new Map,M=[],N=Number.isFinite(h);for(let H=0;H<Y.length&&!(N&&M.length>=h);H++){const q=Y[H];let K={color:q.pickedColor,layer:null,index:q.pickedObjectIndex,picked:!0,x:i,y:s,pixelRatio:v};K=hV({layer:q.pickedLayer,info:K,mode:u});const j=K.layer.id;k.has(j)||k.set(j,new Set);const de=k.get(j),Ee=K.object??K.index;de.has(Ee)||(de.add(Ee),M.push(K))}return M}_drawAndSample({layers:e,views:t,viewports:r,onViewportActive:i,deviceRect:s,cullRect:o,effects:a,pass:u},h=!1){const d=h?this.depthFBO:this.pickingFBO,g={layers:e,layerFilter:this.layerFilter,views:t,viewports:r,onViewportActive:i,pickingFBO:d,deviceRect:s,cullRect:o,effects:a,pass:u,pickZ:h,preRenderStats:{},isPicking:!0};for(const P of a)P.useInPicking&&(g.preRenderStats[P.id]=P.preRender(g));const{decodePickingColor:y}=this.pickLayersPass.render(g),{x:v,y:T,width:w,height:E}=s,S=new(h?Float32Array:Uint8Array)(w*E*4);return this.device.readPixelsToArrayWebGL(d,{sourceX:v,sourceY:T,sourceWidth:w,sourceHeight:E,target:S}),{pickedColors:S,decodePickingColor:y}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:r,deviceWidth:i,deviceHeight:s}){const o=Math.max(0,e-r),a=Math.max(0,t-r),u=Math.min(i,e+r+1)-o,h=Math.min(s,t+r+1)-a;return u<=0||h<=0?null:{x:o,y:a,width:u,height:h}}}const Uae={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},Vae="top-left",aM="__root";class Fae{constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!Ai(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const t={};for(const r of this.resolvedWidgets)t[r.id]=r;this.resolvedWidgets.length=0;for(const r of this.defaultWidgets)t[r.id]=null,this.resolvedWidgets.push(r);for(let r of e){const i=t[r.id];i?i.viewId!==r.viewId||i.placement!==r.placement?(this._remove(i),this._add(r)):r!==i&&(i.setProps(r.props),r=i):this._add(r),t[r.id]=null,this.resolvedWidgets.push(r)}for(const r in t){const i=t[r];i&&this._remove(i)}this.widgets=e}_add(e){const{viewId:t=null,placement:r=Vae}=e,i=e.onAdd({deck:this.deck,viewId:t});i&&this._getContainer(t,r).append(i),e._element=i}_remove(e){e.onRemove?.(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,t){const r=e||aM;let i=this.containers[r];i||(i=document.createElement("div"),i.style.pointerEvents="none",i.style.position="absolute",i.style.overflow="hidden",this.parentElement?.append(i),this.containers[r]=i);let s=i.querySelector(`.${t}`);return s||(s=document.createElement("div"),s.className=t,s.style.position="absolute",s.style.zIndex="2",Object.assign(s.style,Uae[t]),i.append(s)),s}_updateContainers(){const e=this.deck.width,t=this.deck.height;for(const r in this.containers){const i=this.lastViewports[r]||null,s=r===aM||i,o=this.containers[r];s?(o.style.display="block",o.style.left=`${i?i.x:0}px`,o.style.top=`${i?i.y:0}px`,o.style.width=`${i?i.width:e}px`,o.style.height=`${i?i.height:t}px`):o.style.display="none"}}onRedraw({viewports:e,layers:t}){const r=e.reduce((i,s)=>(i[s.id]=s,i),{});for(const i of this.getWidgets()){const{viewId:s}=i;if(s){const o=r[s];o&&(i.onViewportChange&&i.onViewportChange(o),i.onRedraw?.({viewports:[o],layers:t}))}else{if(i.onViewportChange)for(const o of e)i.onViewportChange(o);i.onRedraw?.({viewports:e,layers:t})}}this.lastViewports=r,this._updateContainers()}onHover(e,t){for(const r of this.getWidgets()){const{viewId:i}=r;(!i||i===e.viewport?.id)&&r.onHover?.(e,t)}}onEvent(e,t){const r=nx[t.type];if(r)for(const i of this.getWidgets()){const{viewId:s}=i;(!s||s===e.viewport?.id)&&i[r]?.(e,t)}}}const Bae={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class zae{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const t=document.createElement("div");return t.className="deck-tooltip",Object.assign(t.style,Bae),this.deck=e,this.element=t,t}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){this.isVisible&&e.id===this.lastViewport?.id&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:t}=this,r=t&&t.props.getTooltip;if(!r)return;const i=r(e);this.lastViewport=e.viewport,this.setTooltip(i,e.x,e.y)}setTooltip(e,t,r){const i=this.element;if(i){if(typeof e=="string")i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${t}px, ${r}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(i.style,e.style)}}}var wu;(function(n){n[n.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",n[n.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",n[n.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",n[n.POINTS=0]="POINTS",n[n.LINES=1]="LINES",n[n.LINE_LOOP=2]="LINE_LOOP",n[n.LINE_STRIP=3]="LINE_STRIP",n[n.TRIANGLES=4]="TRIANGLES",n[n.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",n[n.TRIANGLE_FAN=6]="TRIANGLE_FAN",n[n.ZERO=0]="ZERO",n[n.ONE=1]="ONE",n[n.SRC_COLOR=768]="SRC_COLOR",n[n.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",n[n.SRC_ALPHA=770]="SRC_ALPHA",n[n.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",n[n.DST_ALPHA=772]="DST_ALPHA",n[n.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",n[n.DST_COLOR=774]="DST_COLOR",n[n.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",n[n.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",n[n.CONSTANT_COLOR=32769]="CONSTANT_COLOR",n[n.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",n[n.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",n[n.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",n[n.FUNC_ADD=32774]="FUNC_ADD",n[n.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",n[n.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",n[n.BLEND_EQUATION=32777]="BLEND_EQUATION",n[n.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",n[n.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",n[n.BLEND_DST_RGB=32968]="BLEND_DST_RGB",n[n.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",n[n.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",n[n.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",n[n.BLEND_COLOR=32773]="BLEND_COLOR",n[n.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",n[n.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",n[n.LINE_WIDTH=2849]="LINE_WIDTH",n[n.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",n[n.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",n[n.CULL_FACE_MODE=2885]="CULL_FACE_MODE",n[n.FRONT_FACE=2886]="FRONT_FACE",n[n.DEPTH_RANGE=2928]="DEPTH_RANGE",n[n.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",n[n.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",n[n.DEPTH_FUNC=2932]="DEPTH_FUNC",n[n.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",n[n.STENCIL_FUNC=2962]="STENCIL_FUNC",n[n.STENCIL_FAIL=2964]="STENCIL_FAIL",n[n.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",n[n.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",n[n.STENCIL_REF=2967]="STENCIL_REF",n[n.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",n[n.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",n[n.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",n[n.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",n[n.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",n[n.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",n[n.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",n[n.VIEWPORT=2978]="VIEWPORT",n[n.SCISSOR_BOX=3088]="SCISSOR_BOX",n[n.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",n[n.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",n[n.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",n[n.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",n[n.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",n[n.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",n[n.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",n[n.RED_BITS=3410]="RED_BITS",n[n.GREEN_BITS=3411]="GREEN_BITS",n[n.BLUE_BITS=3412]="BLUE_BITS",n[n.ALPHA_BITS=3413]="ALPHA_BITS",n[n.DEPTH_BITS=3414]="DEPTH_BITS",n[n.STENCIL_BITS=3415]="STENCIL_BITS",n[n.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",n[n.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",n[n.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",n[n.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",n[n.SAMPLES=32937]="SAMPLES",n[n.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",n[n.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",n[n.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",n[n.VENDOR=7936]="VENDOR",n[n.RENDERER=7937]="RENDERER",n[n.VERSION=7938]="VERSION",n[n.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",n[n.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",n[n.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",n[n.STATIC_DRAW=35044]="STATIC_DRAW",n[n.STREAM_DRAW=35040]="STREAM_DRAW",n[n.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",n[n.ARRAY_BUFFER=34962]="ARRAY_BUFFER",n[n.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",n[n.BUFFER_SIZE=34660]="BUFFER_SIZE",n[n.BUFFER_USAGE=34661]="BUFFER_USAGE",n[n.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",n[n.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",n[n.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",n[n.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",n[n.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",n[n.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",n[n.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",n[n.CULL_FACE=2884]="CULL_FACE",n[n.FRONT=1028]="FRONT",n[n.BACK=1029]="BACK",n[n.FRONT_AND_BACK=1032]="FRONT_AND_BACK",n[n.BLEND=3042]="BLEND",n[n.DEPTH_TEST=2929]="DEPTH_TEST",n[n.DITHER=3024]="DITHER",n[n.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",n[n.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",n[n.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",n[n.SCISSOR_TEST=3089]="SCISSOR_TEST",n[n.STENCIL_TEST=2960]="STENCIL_TEST",n[n.NO_ERROR=0]="NO_ERROR",n[n.INVALID_ENUM=1280]="INVALID_ENUM",n[n.INVALID_VALUE=1281]="INVALID_VALUE",n[n.INVALID_OPERATION=1282]="INVALID_OPERATION",n[n.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",n[n.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",n[n.CW=2304]="CW",n[n.CCW=2305]="CCW",n[n.DONT_CARE=4352]="DONT_CARE",n[n.FASTEST=4353]="FASTEST",n[n.NICEST=4354]="NICEST",n[n.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",n[n.BYTE=5120]="BYTE",n[n.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",n[n.SHORT=5122]="SHORT",n[n.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",n[n.INT=5124]="INT",n[n.UNSIGNED_INT=5125]="UNSIGNED_INT",n[n.FLOAT=5126]="FLOAT",n[n.DOUBLE=5130]="DOUBLE",n[n.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",n[n.ALPHA=6406]="ALPHA",n[n.RGB=6407]="RGB",n[n.RGBA=6408]="RGBA",n[n.LUMINANCE=6409]="LUMINANCE",n[n.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",n[n.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",n[n.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",n[n.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",n[n.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",n[n.VERTEX_SHADER=35633]="VERTEX_SHADER",n[n.COMPILE_STATUS=35713]="COMPILE_STATUS",n[n.DELETE_STATUS=35712]="DELETE_STATUS",n[n.LINK_STATUS=35714]="LINK_STATUS",n[n.VALIDATE_STATUS=35715]="VALIDATE_STATUS",n[n.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",n[n.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",n[n.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",n[n.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",n[n.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",n[n.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",n[n.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",n[n.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",n[n.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",n[n.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",n[n.SHADER_TYPE=35663]="SHADER_TYPE",n[n.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",n[n.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",n[n.NEVER=512]="NEVER",n[n.LESS=513]="LESS",n[n.EQUAL=514]="EQUAL",n[n.LEQUAL=515]="LEQUAL",n[n.GREATER=516]="GREATER",n[n.NOTEQUAL=517]="NOTEQUAL",n[n.GEQUAL=518]="GEQUAL",n[n.ALWAYS=519]="ALWAYS",n[n.KEEP=7680]="KEEP",n[n.REPLACE=7681]="REPLACE",n[n.INCR=7682]="INCR",n[n.DECR=7683]="DECR",n[n.INVERT=5386]="INVERT",n[n.INCR_WRAP=34055]="INCR_WRAP",n[n.DECR_WRAP=34056]="DECR_WRAP",n[n.NEAREST=9728]="NEAREST",n[n.LINEAR=9729]="LINEAR",n[n.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",n[n.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",n[n.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",n[n.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",n[n.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",n[n.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",n[n.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",n[n.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",n[n.TEXTURE_2D=3553]="TEXTURE_2D",n[n.TEXTURE=5890]="TEXTURE",n[n.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",n[n.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",n[n.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",n[n.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",n[n.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",n[n.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",n[n.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",n[n.TEXTURE0=33984]="TEXTURE0",n[n.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",n[n.REPEAT=10497]="REPEAT",n[n.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",n[n.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",n[n.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",n[n.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",n[n.FLOAT_VEC2=35664]="FLOAT_VEC2",n[n.FLOAT_VEC3=35665]="FLOAT_VEC3",n[n.FLOAT_VEC4=35666]="FLOAT_VEC4",n[n.INT_VEC2=35667]="INT_VEC2",n[n.INT_VEC3=35668]="INT_VEC3",n[n.INT_VEC4=35669]="INT_VEC4",n[n.BOOL=35670]="BOOL",n[n.BOOL_VEC2=35671]="BOOL_VEC2",n[n.BOOL_VEC3=35672]="BOOL_VEC3",n[n.BOOL_VEC4=35673]="BOOL_VEC4",n[n.FLOAT_MAT2=35674]="FLOAT_MAT2",n[n.FLOAT_MAT3=35675]="FLOAT_MAT3",n[n.FLOAT_MAT4=35676]="FLOAT_MAT4",n[n.SAMPLER_2D=35678]="SAMPLER_2D",n[n.SAMPLER_CUBE=35680]="SAMPLER_CUBE",n[n.LOW_FLOAT=36336]="LOW_FLOAT",n[n.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",n[n.HIGH_FLOAT=36338]="HIGH_FLOAT",n[n.LOW_INT=36339]="LOW_INT",n[n.MEDIUM_INT=36340]="MEDIUM_INT",n[n.HIGH_INT=36341]="HIGH_INT",n[n.FRAMEBUFFER=36160]="FRAMEBUFFER",n[n.RENDERBUFFER=36161]="RENDERBUFFER",n[n.RGBA4=32854]="RGBA4",n[n.RGB5_A1=32855]="RGB5_A1",n[n.RGB565=36194]="RGB565",n[n.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",n[n.STENCIL_INDEX=6401]="STENCIL_INDEX",n[n.STENCIL_INDEX8=36168]="STENCIL_INDEX8",n[n.DEPTH_STENCIL=34041]="DEPTH_STENCIL",n[n.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",n[n.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",n[n.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",n[n.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",n[n.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",n[n.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",n[n.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",n[n.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",n[n.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",n[n.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",n[n.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",n[n.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",n[n.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",n[n.NONE=0]="NONE",n[n.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",n[n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",n[n.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",n[n.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",n[n.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",n[n.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",n[n.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",n[n.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",n[n.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",n[n.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",n[n.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",n[n.READ_BUFFER=3074]="READ_BUFFER",n[n.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",n[n.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",n[n.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",n[n.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",n[n.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",n[n.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",n[n.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",n[n.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",n[n.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",n[n.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",n[n.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",n[n.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",n[n.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",n[n.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",n[n.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",n[n.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",n[n.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",n[n.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",n[n.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",n[n.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",n[n.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",n[n.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",n[n.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",n[n.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",n[n.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",n[n.RED=6403]="RED",n[n.RGB8=32849]="RGB8",n[n.RGBA8=32856]="RGBA8",n[n.RGB10_A2=32857]="RGB10_A2",n[n.TEXTURE_3D=32879]="TEXTURE_3D",n[n.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",n[n.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",n[n.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",n[n.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",n[n.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",n[n.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",n[n.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",n[n.SRGB=35904]="SRGB",n[n.SRGB8=35905]="SRGB8",n[n.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",n[n.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",n[n.RGBA32F=34836]="RGBA32F",n[n.RGB32F=34837]="RGB32F",n[n.RGBA16F=34842]="RGBA16F",n[n.RGB16F=34843]="RGB16F",n[n.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",n[n.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",n[n.R11F_G11F_B10F=35898]="R11F_G11F_B10F",n[n.RGB9_E5=35901]="RGB9_E5",n[n.RGBA32UI=36208]="RGBA32UI",n[n.RGB32UI=36209]="RGB32UI",n[n.RGBA16UI=36214]="RGBA16UI",n[n.RGB16UI=36215]="RGB16UI",n[n.RGBA8UI=36220]="RGBA8UI",n[n.RGB8UI=36221]="RGB8UI",n[n.RGBA32I=36226]="RGBA32I",n[n.RGB32I=36227]="RGB32I",n[n.RGBA16I=36232]="RGBA16I",n[n.RGB16I=36233]="RGB16I",n[n.RGBA8I=36238]="RGBA8I",n[n.RGB8I=36239]="RGB8I",n[n.RED_INTEGER=36244]="RED_INTEGER",n[n.RGB_INTEGER=36248]="RGB_INTEGER",n[n.RGBA_INTEGER=36249]="RGBA_INTEGER",n[n.R8=33321]="R8",n[n.RG8=33323]="RG8",n[n.R16F=33325]="R16F",n[n.R32F=33326]="R32F",n[n.RG16F=33327]="RG16F",n[n.RG32F=33328]="RG32F",n[n.R8I=33329]="R8I",n[n.R8UI=33330]="R8UI",n[n.R16I=33331]="R16I",n[n.R16UI=33332]="R16UI",n[n.R32I=33333]="R32I",n[n.R32UI=33334]="R32UI",n[n.RG8I=33335]="RG8I",n[n.RG8UI=33336]="RG8UI",n[n.RG16I=33337]="RG16I",n[n.RG16UI=33338]="RG16UI",n[n.RG32I=33339]="RG32I",n[n.RG32UI=33340]="RG32UI",n[n.R8_SNORM=36756]="R8_SNORM",n[n.RG8_SNORM=36757]="RG8_SNORM",n[n.RGB8_SNORM=36758]="RGB8_SNORM",n[n.RGBA8_SNORM=36759]="RGBA8_SNORM",n[n.RGB10_A2UI=36975]="RGB10_A2UI",n[n.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",n[n.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",n[n.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",n[n.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",n[n.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",n[n.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",n[n.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",n[n.HALF_FLOAT=5131]="HALF_FLOAT",n[n.RG=33319]="RG",n[n.RG_INTEGER=33320]="RG_INTEGER",n[n.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",n[n.CURRENT_QUERY=34917]="CURRENT_QUERY",n[n.QUERY_RESULT=34918]="QUERY_RESULT",n[n.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",n[n.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",n[n.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",n[n.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",n[n.DRAW_BUFFER0=34853]="DRAW_BUFFER0",n[n.DRAW_BUFFER1=34854]="DRAW_BUFFER1",n[n.DRAW_BUFFER2=34855]="DRAW_BUFFER2",n[n.DRAW_BUFFER3=34856]="DRAW_BUFFER3",n[n.DRAW_BUFFER4=34857]="DRAW_BUFFER4",n[n.DRAW_BUFFER5=34858]="DRAW_BUFFER5",n[n.DRAW_BUFFER6=34859]="DRAW_BUFFER6",n[n.DRAW_BUFFER7=34860]="DRAW_BUFFER7",n[n.DRAW_BUFFER8=34861]="DRAW_BUFFER8",n[n.DRAW_BUFFER9=34862]="DRAW_BUFFER9",n[n.DRAW_BUFFER10=34863]="DRAW_BUFFER10",n[n.DRAW_BUFFER11=34864]="DRAW_BUFFER11",n[n.DRAW_BUFFER12=34865]="DRAW_BUFFER12",n[n.DRAW_BUFFER13=34866]="DRAW_BUFFER13",n[n.DRAW_BUFFER14=34867]="DRAW_BUFFER14",n[n.DRAW_BUFFER15=34868]="DRAW_BUFFER15",n[n.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",n[n.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",n[n.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",n[n.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",n[n.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",n[n.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",n[n.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",n[n.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",n[n.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",n[n.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",n[n.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",n[n.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",n[n.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",n[n.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",n[n.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",n[n.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",n[n.SAMPLER_3D=35679]="SAMPLER_3D",n[n.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",n[n.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",n[n.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",n[n.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",n[n.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",n[n.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",n[n.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",n[n.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",n[n.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",n[n.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",n[n.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",n[n.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",n[n.MAX_SAMPLES=36183]="MAX_SAMPLES",n[n.SAMPLER_BINDING=35097]="SAMPLER_BINDING",n[n.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",n[n.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",n[n.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",n[n.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",n[n.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",n[n.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",n[n.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",n[n.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",n[n.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",n[n.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",n[n.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",n[n.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",n[n.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",n[n.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",n[n.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",n[n.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",n[n.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",n[n.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",n[n.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",n[n.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",n[n.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",n[n.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",n[n.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",n[n.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",n[n.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",n[n.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",n[n.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",n[n.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",n[n.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",n[n.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",n[n.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",n[n.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",n[n.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",n[n.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",n[n.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",n[n.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",n[n.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",n[n.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",n[n.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",n[n.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",n[n.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",n[n.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",n[n.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",n[n.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",n[n.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",n[n.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",n[n.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",n[n.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",n[n.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",n[n.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",n[n.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",n[n.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",n[n.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",n[n.UNIFORM_TYPE=35383]="UNIFORM_TYPE",n[n.UNIFORM_SIZE=35384]="UNIFORM_SIZE",n[n.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",n[n.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",n[n.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",n[n.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",n[n.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",n[n.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",n[n.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",n[n.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",n[n.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",n[n.OBJECT_TYPE=37138]="OBJECT_TYPE",n[n.SYNC_CONDITION=37139]="SYNC_CONDITION",n[n.SYNC_STATUS=37140]="SYNC_STATUS",n[n.SYNC_FLAGS=37141]="SYNC_FLAGS",n[n.SYNC_FENCE=37142]="SYNC_FENCE",n[n.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",n[n.UNSIGNALED=37144]="UNSIGNALED",n[n.SIGNALED=37145]="SIGNALED",n[n.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",n[n.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",n[n.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",n[n.WAIT_FAILED=37149]="WAIT_FAILED",n[n.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",n[n.COLOR=6144]="COLOR",n[n.DEPTH=6145]="DEPTH",n[n.STENCIL=6146]="STENCIL",n[n.MIN=32775]="MIN",n[n.MAX=32776]="MAX",n[n.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",n[n.STREAM_READ=35041]="STREAM_READ",n[n.STREAM_COPY=35042]="STREAM_COPY",n[n.STATIC_READ=35045]="STATIC_READ",n[n.STATIC_COPY=35046]="STATIC_COPY",n[n.DYNAMIC_READ=35049]="DYNAMIC_READ",n[n.DYNAMIC_COPY=35050]="DYNAMIC_COPY",n[n.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",n[n.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",n[n.INVALID_INDEX=4294967295]="INVALID_INDEX",n[n.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",n[n.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",n[n.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",n[n.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",n[n.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",n[n.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",n[n.R16_EXT=33322]="R16_EXT",n[n.RG16_EXT=33324]="RG16_EXT",n[n.RGB16_EXT=32852]="RGB16_EXT",n[n.RGBA16_EXT=32859]="RGBA16_EXT",n[n.R16_SNORM_EXT=36760]="R16_SNORM_EXT",n[n.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",n[n.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",n[n.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",n[n.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",n[n.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",n[n.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",n[n.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",n[n.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",n[n.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",n[n.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",n[n.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",n[n.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",n[n.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",n[n.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",n[n.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",n[n.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",n[n.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",n[n.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",n[n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",n[n.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",n[n.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",n[n.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",n[n.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",n[n.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",n[n.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",n[n.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",n[n.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",n[n.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",n[n.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",n[n.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",n[n.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",n[n.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",n[n.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",n[n.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",n[n.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",n[n.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",n[n.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",n[n.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",n[n.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",n[n.LINE_WEBGL=6913]="LINE_WEBGL",n[n.FILL_WEBGL=6914]="FILL_WEBGL",n[n.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",n[n.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",n[n.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",n[n.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",n[n.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",n[n.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",n[n.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",n[n.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",n[n.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",n[n.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",n[n.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",n[n.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",n[n.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",n[n.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",n[n.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",n[n.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",n[n.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",n[n.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",n[n.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",n[n.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",n[n.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",n[n.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",n[n.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",n[n.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(wu||(wu={}));const K1={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},on=(n,e,t)=>e?n.enable(t):n.disable(t),lM=(n,e,t)=>n.hint(t,e),Or=(n,e,t)=>n.pixelStorei(t,e),cM=(n,e,t)=>{const r=t===36006?36009:36008;return n.bindFramebuffer(r,e)},Yf=(n,e,t)=>{const i={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[t];n.bindBuffer(i,e)};function RT(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}const jae={3042:on,32773:(n,e)=>n.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(n,e)=>n.clearColor(...e),3107:(n,e)=>n.colorMask(...e),2884:on,2885:(n,e)=>n.cullFace(e),2929:on,2931:(n,e)=>n.clearDepth(e),2932:(n,e)=>n.depthFunc(e),2928:(n,e)=>n.depthRange(...e),2930:(n,e)=>n.depthMask(e),3024:on,35723:lM,35725:(n,e)=>n.useProgram(e),36007:(n,e)=>n.bindRenderbuffer(36161,e),36389:(n,e)=>n.bindTransformFeedback?.(36386,e),34229:(n,e)=>n.bindVertexArray(e),36006:cM,36010:cM,34964:Yf,36662:Yf,36663:Yf,35053:Yf,35055:Yf,2886:(n,e)=>n.frontFace(e),33170:lM,2849:(n,e)=>n.lineWidth(e),32823:on,32824:"polygonOffset",10752:"polygonOffset",35977:on,32926:on,32928:on,32938:"sampleCoverage",32939:"sampleCoverage",3089:on,3088:(n,e)=>n.scissor(...e),2960:on,2961:(n,e)=>n.clearStencil(e),2968:(n,e)=>n.stencilMaskSeparate(1028,e),36005:(n,e)=>n.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(n,e)=>n.viewport(...e),34383:on,10754:on,12288:on,12289:on,12290:on,12291:on,12292:on,12293:on,12294:on,12295:on,3333:Or,3317:Or,37440:Or,37441:Or,37443:Or,3330:Or,3332:Or,3331:Or,3314:Or,32878:Or,3316:Or,3315:Or,32877:Or,framebuffer:(n,e)=>{const t=e&&"handle"in e?e.handle:e;return n.bindFramebuffer(36160,t)},blend:(n,e)=>e?n.enable(3042):n.disable(3042),blendColor:(n,e)=>n.blendColor(...e),blendEquation:(n,e)=>{const t=typeof e=="number"?[e,e]:e;n.blendEquationSeparate(...t)},blendFunc:(n,e)=>{const t=e?.length===2?[...e,...e]:e;n.blendFuncSeparate(...t)},clearColor:(n,e)=>n.clearColor(...e),clearDepth:(n,e)=>n.clearDepth(e),clearStencil:(n,e)=>n.clearStencil(e),colorMask:(n,e)=>n.colorMask(...e),cull:(n,e)=>e?n.enable(2884):n.disable(2884),cullFace:(n,e)=>n.cullFace(e),depthTest:(n,e)=>e?n.enable(2929):n.disable(2929),depthFunc:(n,e)=>n.depthFunc(e),depthMask:(n,e)=>n.depthMask(e),depthRange:(n,e)=>n.depthRange(...e),dither:(n,e)=>e?n.enable(3024):n.disable(3024),derivativeHint:(n,e)=>{n.hint(35723,e)},frontFace:(n,e)=>n.frontFace(e),mipmapHint:(n,e)=>n.hint(33170,e),lineWidth:(n,e)=>n.lineWidth(e),polygonOffsetFill:(n,e)=>e?n.enable(32823):n.disable(32823),polygonOffset:(n,e)=>n.polygonOffset(...e),sampleCoverage:(n,e)=>n.sampleCoverage(e[0],e[1]||!1),scissorTest:(n,e)=>e?n.enable(3089):n.disable(3089),scissor:(n,e)=>n.scissor(...e),stencilTest:(n,e)=>e?n.enable(2960):n.disable(2960),stencilMask:(n,e)=>{e=RT(e)?e:[e,e];const[t,r]=e;n.stencilMaskSeparate(1028,t),n.stencilMaskSeparate(1029,r)},stencilFunc:(n,e)=>{e=RT(e)&&e.length===3?[...e,...e]:e;const[t,r,i,s,o,a]=e;n.stencilFuncSeparate(1028,t,r,i),n.stencilFuncSeparate(1029,s,o,a)},stencilOp:(n,e)=>{e=RT(e)&&e.length===3?[...e,...e]:e;const[t,r,i,s,o,a]=e;n.stencilOpSeparate(1028,t,r,i),n.stencilOpSeparate(1029,s,o,a)},viewport:(n,e)=>n.viewport(...e)};function qt(n,e,t){return e[n]!==void 0?e[n]:t[n]}const Hae={blendEquation:(n,e,t)=>n.blendEquationSeparate(qt(32777,e,t),qt(34877,e,t)),blendFunc:(n,e,t)=>n.blendFuncSeparate(qt(32969,e,t),qt(32968,e,t),qt(32971,e,t),qt(32970,e,t)),polygonOffset:(n,e,t)=>n.polygonOffset(qt(32824,e,t),qt(10752,e,t)),sampleCoverage:(n,e,t)=>n.sampleCoverage(qt(32938,e,t),qt(32939,e,t)),stencilFuncFront:(n,e,t)=>n.stencilFuncSeparate(1028,qt(2962,e,t),qt(2967,e,t),qt(2963,e,t)),stencilFuncBack:(n,e,t)=>n.stencilFuncSeparate(1029,qt(34816,e,t),qt(36003,e,t),qt(36004,e,t)),stencilOpFront:(n,e,t)=>n.stencilOpSeparate(1028,qt(2964,e,t),qt(2965,e,t),qt(2966,e,t)),stencilOpBack:(n,e,t)=>n.stencilOpSeparate(1029,qt(34817,e,t),qt(34818,e,t),qt(34819,e,t))},uM={enable:(n,e)=>n({[e]:!0}),disable:(n,e)=>n({[e]:!1}),pixelStorei:(n,e,t)=>n({[e]:t}),hint:(n,e,t)=>n({[e]:t}),useProgram:(n,e)=>n({35725:e}),bindRenderbuffer:(n,e,t)=>n({36007:t}),bindTransformFeedback:(n,e,t)=>n({36389:t}),bindVertexArray:(n,e)=>n({34229:e}),bindFramebuffer:(n,e,t)=>{switch(e){case 36160:return n({36006:t,36010:t});case 36009:return n({36006:t});case 36008:return n({36010:t});default:return null}},bindBuffer:(n,e,t)=>{const r={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return r?n({[r]:t}):{valueChanged:!0}},blendColor:(n,e,t,r,i)=>n({32773:new Float32Array([e,t,r,i])}),blendEquation:(n,e)=>n({32777:e,34877:e}),blendEquationSeparate:(n,e,t)=>n({32777:e,34877:t}),blendFunc:(n,e,t)=>n({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(n,e,t,r,i)=>n({32969:e,32968:t,32971:r,32970:i}),clearColor:(n,e,t,r,i)=>n({3106:new Float32Array([e,t,r,i])}),clearDepth:(n,e)=>n({2931:e}),clearStencil:(n,e)=>n({2961:e}),colorMask:(n,e,t,r,i)=>n({3107:[e,t,r,i]}),cullFace:(n,e)=>n({2885:e}),depthFunc:(n,e)=>n({2932:e}),depthRange:(n,e,t)=>n({2928:new Float32Array([e,t])}),depthMask:(n,e)=>n({2930:e}),frontFace:(n,e)=>n({2886:e}),lineWidth:(n,e)=>n({2849:e}),polygonOffset:(n,e,t)=>n({32824:e,10752:t}),sampleCoverage:(n,e,t)=>n({32938:e,32939:t}),scissor:(n,e,t,r,i)=>n({3088:new Int32Array([e,t,r,i])}),stencilMask:(n,e)=>n({2968:e,36005:e}),stencilMaskSeparate:(n,e,t)=>n({[e===1028?2968:36005]:t}),stencilFunc:(n,e,t,r)=>n({2962:e,2967:t,2963:r,34816:e,36003:t,36004:r}),stencilFuncSeparate:(n,e,t,r,i)=>n({[e===1028?2962:34816]:t,[e===1028?2967:36003]:r,[e===1028?2963:36004]:i}),stencilOp:(n,e,t,r)=>n({2964:e,2965:t,2966:r,34817:e,34818:t,34819:r}),stencilOpSeparate:(n,e,t,r,i)=>n({[e===1028?2964:34817]:t,[e===1028?2965:34818]:r,[e===1028?2966:34819]:i}),viewport:(n,e,t,r,i)=>n({2978:[e,t,r,i]})},Yi=(n,e)=>n.isEnabled(e),hM={3042:Yi,2884:Yi,2929:Yi,3024:Yi,32823:Yi,32926:Yi,32928:Yi,3089:Yi,2960:Yi,35977:Yi},$ae=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function kh(n,e){if(qae(e))return;const t={};for(const i in e){const s=Number(i),o=jae[i];o&&(typeof o=="string"?t[o]=!0:o(n,e[i],s))}const r=n.state&&n.state.cache;if(r)for(const i in t){const s=Hae[i];s(n,e,r)}}function fV(n,e=K1){if(typeof e=="number"){const i=e,s=hM[i];return s?s(n,i):n.getParameter(i)}const t=Array.isArray(e)?e:Object.keys(e),r={};for(const i of t){const s=hM[i];r[i]=s?s(n,Number(i)):n.getParameter(Number(i))}return r}function Wae(n){kh(n,K1)}function qae(n){for(const e in n)return!1;return!0}function Xae(n,e){if(n===e)return!0;const t=Array.isArray(n)||ArrayBuffer.isView(n),r=Array.isArray(e)||ArrayBuffer.isView(e);if(t&&r&&n.length===e.length){for(let i=0;i<n.length;++i)if(n[i]!==e[i])return!1;return!0}return!1}class zl{static get(e){return e.state}gl;program=null;stateStack=[];enable=!0;cache=null;log;initialized=!1;constructor(e,t){this.gl=e,this.log=t?.log||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];kh(this.gl,e),this.stateStack.pop()}trackState(e,t){if(this.cache=t.copyState?fV(e):Object.assign({},K1),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,Kae(e);for(const r in uM){const i=uM[r];Yae(e,r,i)}fM(e,"getParameter"),fM(e,"isEnabled")}_updateCache(e){let t=!1,r;const i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const s in e){const o=e[s],a=this.cache[s];Xae(o,a)||(t=!0,r=a,i&&!(s in i)&&(i[s]=a),this.cache[s]=o)}return{valueChanged:t,oldValue:r}}}function fM(n,e){const t=n[e].bind(n);n[e]=function(i){if(i===void 0||$ae.has(i))return t(i);const s=zl.get(n);return i in s.cache||(s.cache[i]=t(i)),s.enable?s.cache[i]:t(i)},Object.defineProperty(n[e],"name",{value:`${e}-from-cache`,configurable:!1})}function Yae(n,e,t){if(!n[e])return;const r=n[e].bind(n);n[e]=function(...s){const o=zl.get(n),{valueChanged:a,oldValue:u}=t(o._updateCache,...s);return a&&r(...s),u},Object.defineProperty(n[e],"name",{value:`${e}-to-cache`,configurable:!1})}function Kae(n){const e=n.useProgram.bind(n);n.useProgram=function(r){const i=zl.get(n);i.program!==r&&(e(r),i.program=r)}}function Gae(n,e,t){let r="";const i={preserveDrawingBuffer:!0,...t};let s=null;if(s||=n.getContext("webgl2",i),i.failIfMajorPerformanceCaveat&&(r||="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow."),!s&&!t.failIfMajorPerformanceCaveat&&(i.failIfMajorPerformanceCaveat=!1,s=n.getContext("webgl2",i),s.luma||={},s.luma.softwareRenderer=!0),s||(s=n.getContext("webgl",{}),s&&(s=null,r||="Your browser only supports WebGL1")),!s)throw r||="Your browser does not support WebGL",new Error(`Failed to create WebGL context: ${r}`);const{onContextLost:o,onContextRestored:a}=e;return n.addEventListener("webglcontextlost",u=>o(u),!1),n.addEventListener("webglcontextrestored",u=>a(u),!1),s.luma||={},s}function hh(n,e,t){return t[e]===void 0&&(t[e]=n.getExtension(e)||null),t[e]}function Zae(n,e){const t=n.getParameter(7936),r=n.getParameter(7937);hh(n,"WEBGL_debug_renderer_info",e);const i=e.WEBGL_debug_renderer_info,s=n.getParameter(i?i.UNMASKED_VENDOR_WEBGL:7936),o=n.getParameter(i?i.UNMASKED_RENDERER_WEBGL:7937),a=s||t,u=o||r,h=n.getParameter(7938),d=dV(a,u),g=Qae(a,u),y=Jae(a,u);return{type:"webgl",gpu:d,gpuType:y,gpuBackend:g,vendor:a,renderer:u,version:h,shadingLanguage:"glsl",shadingLanguageVersion:300}}function dV(n,e){return/NVIDIA/i.exec(n)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(n)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(n)||/Apple/i.exec(e)?"apple":/AMD/i.exec(n)||/AMD/i.exec(e)||/ATI/i.exec(n)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(n)||/SwiftShader/i.exec(e)?"software":"unknown"}function Qae(n,e){return/Metal/i.exec(n)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(n)||/ANGLE/i.exec(e)?"opengl":"unknown"}function Jae(n,e){if(/SwiftShader/i.exec(n)||/SwiftShader/i.exec(e))return"cpu";switch(dV(n,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function pV(n){switch(n){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(n))}const ld="WEBGL_compressed_texture_s3tc",cd="WEBGL_compressed_texture_s3tc_srgb",xu="EXT_texture_compression_rgtc",Eu="EXT_texture_compression_bptc",ele="WEBGL_compressed_texture_etc",tle="WEBGL_compressed_texture_astc",nle="WEBGL_compressed_texture_etc1",rle="WEBGL_compressed_texture_pvrtc",ile="WEBGL_compressed_texture_atc",dM="EXT_texture_norm16",pM="EXT_render_snorm",sle="EXT_color_buffer_float",G1={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[pM],"norm16-renderable-webgl":[dM],"snorm16-renderable-webgl":[dM,pM],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[ld,cd,xu,Eu],"texture-compression-bc5-webgl":[xu],"texture-compression-bc7-webgl":[Eu],"texture-compression-etc2":[ele],"texture-compression-astc":[tle],"texture-compression-etc1-webgl":[nle],"texture-compression-pvrtc-webgl":[rle],"texture-compression-atc-webgl":[ile]};function ole(n){return n in G1}function ale(n,e,t){return(G1[e]||[]).every(i=>hh(n,i,t))}const Z1={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:sle,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:ld},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:cd},"bc1-rgba-unorm":{gl:33777,x:ld},"bc1-rgba-unorm-srgb":{gl:35916,x:cd},"bc2-rgba-unorm":{gl:33778,x:ld},"bc2-rgba-unorm-srgb":{gl:35918,x:cd},"bc3-rgba-unorm":{gl:33779,x:ld},"bc3-rgba-unorm-srgb":{gl:35919,x:cd},"bc4-r-unorm":{gl:36283,x:xu},"bc4-r-snorm":{gl:36284,x:xu},"bc5-rg-unorm":{gl:36285,x:xu},"bc5-rg-snorm":{gl:36286,x:xu},"bc6h-rgb-ufloat":{gl:36495,x:Eu},"bc6h-rgb-float":{gl:36494,x:Eu},"bc7-rgba-unorm":{gl:36492,x:Eu},"bc7-rgba-unorm-srgb":{gl:36493,x:Eu},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function lle(n,e,t){let r=e.create;const i=Z1[e.format];return i?.gl===void 0&&(r=!1),i?.x&&(r=r&&!!hh(n,i.x,t)),{format:e.format,create:r&&e.create,render:r&&e.render,filter:r&&e.filter,blend:r&&e.blend,store:r&&e.store}}function gV(n){const e=Z1[n],t=hle(n),r=b1(n);return{internalFormat:t,format:e?.dataFormat||ule(r.channels,r.integer,r.normalized,t),type:r.dataType?pV(r.dataType):e?.types?.[0]||5121,compressed:r.compressed||!1}}function cle(n){switch(b1(n).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${n}`)}}function ule(n,e,t,r){if(r===6408||r===6407)return r;switch(n){case"r":return e&&!t?36244:6403;case"rg":return e&&!t?33320:33319;case"rgb":return e&&!t?36248:6407;case"rgba":return e&&!t?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function hle(n){const t=Z1[n]?.gl;if(t===void 0)throw new Error(`Unsupported texture format ${n}`);return t}const gM={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class fle extends yte{gl;extensions;testedFeatures=new Set;constructor(e,t,r){super([],r),this.gl=e,this.extensions=t,hh(e,"EXT_color_buffer_float",t)}*[Symbol.iterator](){const e=this.getFeatures();for(const t of e)this.has(t)&&(yield t);return[]}has(e){return this.disabledFeatures?.[e]?!1:(this.testedFeatures.has(e)||(this.testedFeatures.add(e),ole(e)&&ale(this.gl,e,this.extensions)&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)),this.features.has(e))}initializeFeatures(){const e=this.getFeatures().filter(t=>t!=="polygon-mode-webgl");for(const t of e)this.has(t)}getFeatures(){return[...Object.keys(gM),...Object.keys(G1)]}getWebGLFeature(e){const t=gM[e];return typeof t=="string"?!!hh(this.gl,t,this.extensions):!!t}}class dle extends mte{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(e){super(),this.gl=e}getParameter(e){return this.limits[e]===void 0&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]||0}}class Ad extends sv{device;gl;handle;colorAttachments=[];depthStencilAttachment=null;constructor(e,t){super(e,t);const r=t.handle===null;this.device=e,this.gl=e.gl,this.handle=this.props.handle||r?this.props.handle:this.gl.createFramebuffer(),r||(e.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const e=this.gl.bindFramebuffer(36160,this.handle);for(let t=0;t<this.colorAttachments.length;++t){const r=this.colorAttachments[t];if(r){const i=36064+t;this._attachTextureView(i,r)}}if(this.depthStencilAttachment){const t=cle(this.depthStencilAttachment.props.format);this._attachTextureView(t,this.depthStencilAttachment)}if(this.device.props.debug){const t=this.gl.checkFramebufferStatus(36160);if(t!==36053)throw new Error(`Framebuffer ${gle(t)}`)}this.gl.bindFramebuffer(36160,e)}_attachTextureView(e,t){const{gl:r}=this.device,{texture:i}=t,s=t.props.baseMipLevel,o=t.props.baseArrayLayer;switch(r.bindTexture(i.glTarget,i.handle),i.glTarget){case 35866:case 32879:r.framebufferTextureLayer(36160,e,i.handle,s,o);break;case 34067:const a=ple(o);r.framebufferTexture2D(36160,e,a,i.handle,s);break;case 3553:r.framebufferTexture2D(36160,e,3553,i.handle,s);break;default:throw new Error("Illegal texture type")}r.bindTexture(i.glTarget,null)}}function ple(n){return n<34069?n+34069:n}function gle(n){switch(n){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${n}`}}class mle extends T1{device;format="rgba8unorm";depthStencilFormat="depth24plus";presentationSize;_framebuffer=null;get[Symbol.toStringTag](){return"WebGLCanvasContext"}constructor(e,t){super(t),this.device=e,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new Ad(this.device,{handle:null}),this._framebuffer}update(){const e=this.getPixelSize();(e[0]!==this.presentationSize[0]||e[1]!==this.presentationSize[1])&&(this.presentationSize=e,this.resize())}resize(e){if(this.device.gl&&this.canvas){const t=this.getDevicePixelRatio(e?.useDevicePixels);this.setDevicePixelRatio(t,e);return}}commit(){}}async function mV(n,e){const t=document.getElementsByTagName("head")[0];if(!t)throw new Error("loadScript");const r=document.createElement("script");return r.setAttribute("type","text/javascript"),r.setAttribute("src",n),new Promise((i,s)=>{r.onload=i,r.onerror=o=>s(new Error(`Unable to load script '${n}': ${o}`)),t.appendChild(r)})}const yle=1;let kr=null,mM=!1;const Q1={debugSpectorJS:we.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function _le(n){if(!globalThis.SPECTOR)try{await mV(n.debugSpectorJSUrl||Q1.debugSpectorJSUrl)}catch(e){we.warn(String(e))}}function vle(n){if(n={...Q1,...n},!n.debugSpectorJS)return null;if(!kr&&globalThis.SPECTOR&&!globalThis.luma?.spector){we.probe(yle,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:e}=globalThis.SPECTOR;kr=new e,globalThis.luma&&(globalThis.luma.spector=kr)}if(!kr)return null;if(mM||(mM=!0,kr.spyCanvases(),kr?.onCaptureStarted.add(e=>we.info("Spector capture started:",e)()),kr?.onCapture.add(e=>{we.info("Spector capture complete:",e)(),kr?.getResultUI(),kr?.resultView.display(),kr?.resultView.addCapture(e)})),n.gl){const e=n.gl,t=e.device;kr?.startCapture(n.gl,500),e.device=t,new Promise(r=>setTimeout(r,2e3)).then(r=>{we.info("Spector capture stopped after 2 seconds")(),kr?.stopCapture()})}return kr}const ble="https://unpkg.com/webgl-debug@2.0.1/index.js";function yV(n){return n.luma=n.luma||{},n.luma}async function Tle(){hc()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await mV(ble))}function wle(n,e={}){return e.debugWebGL||e.traceWebGL?Ele(n,e):xle(n)}function xle(n){const e=yV(n);return e.realContext?e.realContext:n}function Ele(n,e){if(!globalThis.WebGLDebugUtils)return we.warn("webgl-debug not loaded")(),n;const t=yV(n);if(t.debugContext)return t.debugContext;globalThis.WebGLDebugUtils.init({...wu,...n});const r=globalThis.WebGLDebugUtils.makeDebugContext(n,Ale.bind(null,e),Sle.bind(null,e));for(const o in wu)!(o in r)&&typeof wu[o]=="number"&&(r[o]=wu[o]);class i{}Object.setPrototypeOf(r,Object.getPrototypeOf(n)),Object.setPrototypeOf(i,r);const s=Object.create(i);return t.realContext=n,t.debugContext=s,s.debug=!0,s}function yM(n,e){e=Array.from(e).map(r=>r===void 0?"undefined":r);let t=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,e);return t=`${t.slice(0,100)}${t.length>100?"...":""}`,`gl.${n}(${t})`}function Ale(n,e,t,r){r=Array.from(r).map(a=>a===void 0?"undefined":a);const i=globalThis.WebGLDebugUtils.glEnumToString(e),s=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,r),o=`${i} in gl.${t}(${s})`;we.error(o)();debugger}function Sle(n,e,t){let r="";we.level>=1&&(r=yM(e,t),n.traceWebGL&&we.log(1,r)());for(const i of t)if(i===void 0){r=r||yM(e,t);debugger}}const CT={};function Rle(n="id"){CT[n]=CT[n]||1;const e=CT[n]++;return`${n}-${e}`}class Sd extends zt{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength;bytesUsed;constructor(e,t={}){super(e,t),this.device=e,this.gl=this.device.gl;const r=typeof t=="object"?t.handle:void 0;this.handle=r||this.gl.createBuffer(),e.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=Cle(this.props.usage),this.glUsage=Ile(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,t.data?this._initWithData(t.data,t.byteOffset,t.byteLength):this._initWithByteLength(t.byteLength||0)}_initWithData(e,t=0,r=e.byteLength+t){const i=this.glTarget;this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,this.glUsage),this.gl.bufferSubData(i,t,e),this.gl.bindBuffer(i,null),this.bytesUsed=r,this.byteLength=r,this._setDebugData(e,t,r),this.trackAllocatedMemory(r)}_initWithByteLength(e){let t=e;e===0&&(t=new Float32Array(0));const r=this.glTarget;return this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,t,this.glUsage),this.gl.bindBuffer(r,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(e,t=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,t,e),this.gl.bindBuffer(36663,null),this._setDebugData(e,t,e.byteLength)}async readAsync(e=0,t){return this.readSyncWebGL(e,t)}readSyncWebGL(e=0,t){t=t??this.byteLength-e;const r=new Uint8Array(t),i=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,r,i,t),this.gl.bindBuffer(36662,null),this._setDebugData(r,e,t),r}}function Cle(n){return n&zt.INDEX?34963:n&zt.VERTEX?34962:n&zt.UNIFORM?35345:34962}function Ile(n){return n&zt.INDEX||n&zt.VERTEX?35044:n&zt.UNIFORM?35048:35044}function Ple(n){const e=n.split(/\r?\n/),t=[];for(const r of e){if(r.length<=1)continue;const i=r.split(":");if(i.length===2){const[g,y]=i;t.push({message:y.trim(),type:_M(g),lineNum:0,linePos:0});continue}const[s,o,a,...u]=i;let h=parseInt(a,10);isNaN(h)&&(h=0);let d=parseInt(o,10);isNaN(d)&&(d=0),t.push({message:u.join(":").trim(),type:_M(s),lineNum:h,linePos:d})}return t}function _M(n){const e=["warning","error","info"],t=n.toLowerCase();return e.includes(t)?t:"info"}class Mle extends iv{device;handle;constructor(e,t){switch(super(e,t),this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const e=this.device.gl.getShaderInfoLog(this.handle);return e?Ple(e):[]}getTranslatedSource(){return this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders?.getTranslatedShaderSource(this.handle)||null}async _compile(e){e=e.startsWith("#version ")?e:`#version 300 es
${e}`;const{gl:t}=this.device;if(t.shaderSource(this.handle,e),t.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}we.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),we.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const e=async i=>await new Promise(s=>setTimeout(s,i));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:r}=this.device;for(;;){if(r.getShaderParameter(this.handle,37297))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function Ole(n,e,t,r){if(Lle(e))return r(n);const i=n;i.pushState();try{return kle(n,e),kh(i.gl,t),r(n)}finally{i.popState()}}function kle(n,e){const t=n,{gl:r}=t;if(e.cullMode)switch(e.cullMode){case"none":r.disable(2884);break;case"front":r.enable(2884),r.cullFace(1028);break;case"back":r.enable(2884),r.cullFace(1029);break}if(e.frontFace&&r.frontFace(jl("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&n.features.has("depth-clip-control")&&r.enable(34383),e.depthBias!==void 0&&(r.enable(32823),r.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&n.features.has("provoking-vertex-webgl")){const s=t.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,o=jl("provokingVertex",e.provokingVertex,{first:36429,last:36430});s?.provokingVertexWEBGL(o)}if((e.polygonMode||e.polygonOffsetLine)&&n.features.has("polygon-mode-webgl")){if(e.polygonMode){const s=t.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,o=jl("polygonMode",e.polygonMode,{fill:6914,line:6913});s?.polygonModeWEBGL(1028,o),s?.polygonModeWEBGL(1029,o)}e.polygonOffsetLine&&r.enable(10754)}if(n.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&r.enable(12288),e.clipDistance1&&r.enable(12289),e.clipDistance2&&r.enable(12290),e.clipDistance3&&r.enable(12291),e.clipDistance4&&r.enable(12292),e.clipDistance5&&r.enable(12293),e.clipDistance6&&r.enable(12294),e.clipDistance7&&r.enable(12295)),e.depthWriteEnabled!==void 0&&r.depthMask(Dle("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?r.enable(2929):r.disable(2929),r.depthFunc(cx("depthCompare",e.depthCompare))),e.stencilWriteMask){const i=e.stencilWriteMask;r.stencilMaskSeparate(1028,i),r.stencilMaskSeparate(1029,i)}if(e.stencilReadMask&&we.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const i=e.stencilReadMask||4294967295,s=cx("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?r.enable(2960):r.disable(2960),r.stencilFuncSeparate(1028,s,0,i),r.stencilFuncSeparate(1029,s,0,i)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const i=IT("stencilPassOperation",e.stencilPassOperation),s=IT("stencilFailOperation",e.stencilFailOperation),o=IT("stencilDepthFailOperation",e.stencilDepthFailOperation);r.stencilOpSeparate(1028,s,o,i),r.stencilOpSeparate(1029,s,o,i)}switch(e.blend){case!0:r.enable(3042);break;case!1:r.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const i=vM("blendColorOperation",e.blendColorOperation||"add"),s=vM("blendAlphaOperation",e.blendAlphaOperation||"add");r.blendEquationSeparate(i,s);const o=Cm("blendColorSrcFactor",e.blendColorSrcFactor||"one"),a=Cm("blendColorDstFactor",e.blendColorDstFactor||"zero"),u=Cm("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),h=Cm("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");r.blendFuncSeparate(o,a,u,h)}}function cx(n,e){return jl(n,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function IT(n,e){return jl(n,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function vM(n,e){return jl(n,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function Cm(n,e){return jl(n,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function Nle(n,e){return`Illegal parameter ${e} for ${n}`}function jl(n,e,t){if(!(e in t))throw new Error(Nle(n,e));return t[e]}function Dle(n,e){return e}function Lle(n){let e=!0;for(const t in n){e=!1;break}return e}function _V(n){const e={};return n.addressModeU&&(e[10242]=PT(n.addressModeU)),n.addressModeV&&(e[10243]=PT(n.addressModeV)),n.addressModeW&&(e[32882]=PT(n.addressModeW)),n.magFilter&&(e[10240]=ux(n.magFilter)),(n.minFilter||n.mipmapFilter)&&(e[10241]=Ule(n.minFilter||"linear",n.mipmapFilter)),n.lodMinClamp!==void 0&&(e[33082]=n.lodMinClamp),n.lodMaxClamp!==void 0&&(e[33083]=n.lodMaxClamp),n.type==="comparison-sampler"&&(e[34892]=34894),n.compare&&(e[34893]=cx("compare",n.compare)),n.maxAnisotropy&&(e[34046]=n.maxAnisotropy),e}function PT(n){switch(n){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function ux(n){switch(n){case"nearest":return 9728;case"linear":return 9729}}function Ule(n,e="none"){if(!e)return ux(n);switch(e){case"none":return ux(n);case"nearest":return n==="nearest"?9984:9986;case"linear":return n==="nearest"?9985:9987}}class hx extends Kd{device;handle;parameters;constructor(e,t){super(e,t),this.device=e,this.parameters=_V(t),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(e){for(const[t,r]of Object.entries(e)){const i=Number(t);switch(i){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,i,r);break;default:this.device.gl.samplerParameteri(this.handle,i,r);break}}}}class Au extends rv{device;gl;handle;texture;constructor(e,t){super(e,{...St.defaultProps,...t}),this.device=e,this.gl=this.device.gl,this.handle=null,this.texture=t.texture}}const Vle="Failed to deduce GL constant from typed array";function Fle(n){switch(ArrayBuffer.isView(n)?n.constructor:n){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(Vle)}}function Ble(n,e){const{clamped:t=!0}=e||{};switch(n){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return t?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function vV(n){switch(n){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function zle(n){switch(n){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function m_(n,e,t){if(jle(e))return t(n);const{nocatch:r=!0}=e,i=zl.get(n);i.push(),kh(n,e);let s;if(r)s=t(n),i.pop();else try{s=t(n)}finally{i.pop()}return s}function jle(n){for(const e in n)return!1;return!0}function Hle(n,e,t){const{dimension:r,width:i,height:s,depth:o=0}=t,{glInternalFormat:a}=t,u=t.glTarget;switch(r){case"2d-array":case"3d":n.texStorage3D(u,e,a,i,s,o);break;default:n.texStorage2D(u,e,a,i,s)}}function bM(n,e,t,r){const{width:i,height:s}=r,{dimension:o,depth:a=0,mipLevel:u=0}=r,{x:h=0,y:d=0,z:g=0}=r,{glFormat:y,glType:v}=r,T=bV(r.glTarget,o,a),w=r.flipY?{37440:!0}:{};m_(n,w,()=>{switch(o){case"2d-array":case"3d":n.bindTexture(T,e),n.texSubImage3D(T,u,h,d,g,i,s,a,y,v,t),n.bindTexture(T,null);break;case"2d":case"cube":n.bindTexture(T,e),n.texSubImage2D(T,u,h,d,i,s,y,v,t),n.bindTexture(T,null);break;default:throw new Error(o)}})}function TM(n,e,t){const{dimension:r,width:i,height:s,depth:o=0,mipLevel:a=0,byteOffset:u=0}=t,{x:h=0,y:d=0,z:g=0}=t,{glFormat:y,glType:v,compressed:T}=t,w=bV(t.glTarget,r,o);switch(r){case"2d-array":case"3d":T?n.compressedTexSubImage3D(w,a,h,d,g,i,s,o,y,e,u):n.texSubImage3D(w,a,h,d,g,i,s,o,y,v,e,u);break;case"2d":case"cube":T?n.compressedTexSubImage2D(w,a,h,d,i,s,y,e,u):n.texSubImage2D(w,a,h,d,i,s,y,v,e,u);break;default:throw new Error(r)}}function $le(n){switch(n){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(n)}function bV(n,e,t){return e==="cube"?34069+t:n}function Wle(n,e){const{sourceX:t=0,sourceY:r=0,sourceAttachment:i=0}=e||{};let{target:s=null,sourceWidth:o,sourceHeight:a,sourceDepth:u,sourceFormat:h,sourceType:d}=e||{};const{framebuffer:g,deleteFramebuffer:y}=TV(n),{gl:v,handle:T}=g;o||=g.width,a||=g.height;const w=g.colorAttachments[i]?.texture;if(!w)throw new Error(`Invalid framebuffer attachment ${i}`);u=w?.depth||1,h||=w?.glFormat||6408,d||=w?.glType||5121,s=Yle(s,d,h,o,a),d=d||Fle(s);const E=v.bindFramebuffer(36160,T);return v.readBuffer(36064+i),v.readPixels(t,r,o,a,h,d,s),v.readBuffer(36064),v.bindFramebuffer(36160,E||null),y&&g.destroy(),s}function qle(n,e){const{target:t,sourceX:r=0,sourceY:i=0,sourceFormat:s=6408,targetByteOffset:o=0}=e||{};let{sourceWidth:a,sourceHeight:u,sourceType:h}=e||{};const{framebuffer:d,deleteFramebuffer:g}=TV(n);a=a||d.width,u=u||d.height;const y=d;h=h||5121;let v=t;if(!v){const w=vV(s),E=zle(h),S=o+a*u*w*E;v=y.device.createBuffer({byteLength:S})}const T=n.device.createCommandEncoder();return T.copyTextureToBuffer({sourceTexture:n,width:a,height:u,origin:[r,i],destinationBuffer:v,byteOffset:o}),T.destroy(),g&&d.destroy(),v}function TV(n){return n instanceof sv?{framebuffer:n,deleteFramebuffer:!1}:{framebuffer:Xle(n),deleteFramebuffer:!0}}function Xle(n,e){const{device:t,width:r,height:i,id:s}=n;return t.createFramebuffer({...e,id:`framebuffer-for-${s}`,width:r,height:i,colorAttachments:[n]})}function Yle(n,e,t,r,i,s){if(n)return n;e||=5121;const o=Ble(e,{clamped:!1}),a=vV(t);return new o(r*i*a)}class Rd extends St{device;gl;handle;sampler=void 0;view=void 0;mipmaps;compressed;glTarget;glFormat;glType;glInternalFormat;textureUnit=0;constructor(e,t){super(e,t);const r={...this.props};r.data=t.data,this.device=e,this.gl=this.device.gl,this.glTarget=$le(this.props.dimension);const i=gV(this.props.format);this.glInternalFormat=i.internalFormat,this.glFormat=i.format,this.glType=i.type,this.compressed=i.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(r),Object.seal(this)}_initialize(e){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:e.data});let{width:t,height:r}=e;if(!t||!r){const i=St.getTextureDataSize(e.data);t=i?.width||1,r=i?.height||1}if(this.width=t,this.height=r,this.depth=e.depth,this.setSampler(e.sampler),this.view=new Au(this.device,{...this.props,texture:this}),this.bind(),Hle(this.gl,this.mipLevels,this),e.data)switch(e.dimension){case"1d":this.setTexture1DData(e.data);break;case"2d":this.setTexture2DData(e.data);break;case"3d":this.setTexture3DData(e.data);break;case"cube":this.setTextureCubeData(e.data);break;case"2d-array":this.setTextureArrayData(e.data);break;case"cube-array":this.setTextureCubeArrayData(e.data);break;default:throw new Error(e.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(e){return new Au(this.device,{...e,texture:this})}setSampler(e={}){let t;e instanceof hx?(this.sampler=e,t=e.props):(this.sampler=new hx(this.device,e),t=e);const r=_V(t);this._setSamplerParameters(r)}generateMipmap(e){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(we.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!e?.force)))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(r){we.warn(`Error generating mipmap for ${this}: ${r.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(e){const t=St.getExternalImageSize(e.image),r={...St.defaultCopyExternalImageOptions,...t,...e},{image:i,depth:s,mipLevel:o,x:a,y:u,z:h,flipY:d}=r;let{width:g,height:y}=r;const{dimension:v,glTarget:T,glFormat:w,glInternalFormat:E,glType:S}=this;if(g=Math.min(g,this.width-a),y=Math.min(y,this.height-u),e.sourceX||e.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return bM(this.device.gl,this.handle,i,{dimension:v,mipLevel:o,x:a,y:u,z:h,width:g,height:y,depth:s,glFormat:w,glType:S,glTarget:T,flipY:d}),{width:r.width,height:r.height}}setTexture1DData(e){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(e,t=0){this.bind();const r=St.normalizeTextureData(e,this);r.length>1&&this.props.mipmaps!==!1&&we.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let i=0;i<r.length;i++){const s=r[i];this._setMipLevel(t,i,s)}this.unbind()}setTexture3DData(e){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(e)&&(this.bind(),TM(this.device.gl,e,this),this.unbind())}setTextureCubeData(e,t=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const r of St.CubeFaces)this.setTextureCubeFaceData(e[r],r)}setTextureArrayData(e){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(e){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(e,t,r=0){Array.isArray(e)&&e.length>1&&this.props.mipmaps!==!1&&we.warn(`${this.id} has mipmap and multiple LODs.`)();const i=St.CubeFaces.indexOf(t);this.setTexture2DData(e,i)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(e){const{face:t,width:r,height:i,pixels:s,data:o,format:a=6408,type:u=5121}=e,{gl:h}=this,d=s||o;this.bind(),d instanceof Promise?d.then(g=>this.setImageDataForFace(Object.assign({},e,{face:t,data:g,pixels:g}))):this.width||this.height?h.texImage2D(t,0,a,r,i,0,a,u,d):h.texImage2D(t,0,a,a,u,d)}_getImageDataMap(e){for(let t=0;t<St.CubeFaces.length;++t){const r=St.CubeFaces[t];e[r]&&(e[34069+t]=e[r],delete e[r])}return e}_setSamplerParameters(e){we.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(e))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[t,r]of Object.entries(e)){const i=Number(t),s=r;switch(i){case 33082:case 33083:this.gl.texParameterf(this.glTarget,i,s);break;case 10241:this.gl.texParameteri(this.glTarget,i,s);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,i,s);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,i,s);break;default:this.gl.texParameteri(this.glTarget,i,s);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(e,t,r,i=this.glTarget){if(St.isExternalImage(r)){bM(this.device.gl,this.handle,r,{...this,depth:e,mipLevel:t,glTarget:i,flipY:this.props.flipY});return}if(St.isTextureLevelData(r)){TM(this.device.gl,r.data,{...this,depth:e,mipLevel:t,glTarget:i});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(e){const{gl:t}=this;return e!==void 0&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,this.handle),e}unbind(e){const{gl:t}=this;return e!==void 0&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,null),e}}const Kle=[1,2,4,8];class Gle extends Ml{device;glParameters;constructor(e,t){super(e,t),this.device=e;let r;if(!t?.parameters?.viewport)if(t?.framebuffer){const{width:s,height:o}=t.framebuffer;r=[0,0,s,o]}else{const[s,o]=e.getCanvasContext().getDrawingBufferSize();r=[0,0,s,o]}if(this.device.pushState(),this.setParameters({viewport:r,...this.props.parameters}),this.props.framebuffer?.handle)if(this.props.framebuffer){const s=this.props.framebuffer.colorAttachments.map((o,a)=>36064+a);this.device.gl.drawBuffers(s)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(e={}){const t={...this.glParameters};t.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(t.depthMask=!this.props.depthReadOnly),t.stencilMask=this.props.stencilReadOnly?0:1,t[35977]=this.props.discard,e.viewport&&(e.viewport.length>=6?(t.viewport=e.viewport.slice(0,4),t.depthRange=[e.viewport[4],e.viewport[5]]):t.viewport=e.viewport),e.scissorRect&&(t.scissorTest=!0,t.scissor=e.scissorRect),e.blendConstant&&(t.blendColor=e.blendConstant),e.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),e[2967]=e.stencilReference),e.colorMask&&(t.colorMask=Kle.map(r=>!!(r&e.colorMask))),this.glParameters=t,kh(this.device.gl,t)}beginOcclusionQuery(e){this.props.occlusionQuerySet?.beginOcclusionQuery()}endOcclusionQuery(){this.props.occlusionQuerySet?.endOcclusionQuery()}clear(){const e={...this.glParameters};let t=0;this.props.clearColors&&this.props.clearColors.forEach((r,i)=>{r&&this.clearColorBuffer(i,r)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(t|=16384,e.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(t|=256,e.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(t|=1024,e.clearStencil=this.props.clearStencil),t!==0&&m_(this.device.gl,e,()=>{this.device.gl.clear(t)})}clearColorBuffer(e=0,t=[0,0,0,0]){m_(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(t.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,e,t);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,e,t);break;case Float32Array:this.device.gl.clearBufferfv(6144,e,t);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function Zle(n){return Qle.includes(n)}const Qle=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],wV={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function xV(n){const e=wV[n];if(!e)throw new Error("uniform");const[t,r,,i]=e;return{format:i,components:r,glType:t}}function Jle(n){const e=wV[n];if(!e)throw new Error("attribute");const[,t,,r,i]=e;return{attributeType:r,vertexFormat:i,components:t}}function ece(n,e){const t={attributes:[],bindings:[]};t.attributes=tce(n,e);const r=ice(n,e);for(const a of r){const u=a.uniforms.map(h=>({name:h.name,format:h.format,byteOffset:h.byteOffset,byteStride:h.byteStride,arrayLength:h.arrayLength}));t.bindings.push({type:"uniform",name:a.name,group:0,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:u})}const i=rce(n,e);let s=0;for(const a of i)if(Zle(a.type)){const{viewDimension:u,sampleType:h}=oce(a.type);t.bindings.push({type:"texture",name:a.name,group:0,location:s,viewDimension:u,sampleType:h}),a.textureUnit=s,s+=1}i.length&&(t.uniforms=i);const o=nce(n,e);return o?.length&&(t.varyings=o),t}function tce(n,e){const t=[],r=n.getProgramParameter(e,35721);for(let i=0;i<r;i++){const s=n.getActiveAttrib(e,i);if(!s)throw new Error("activeInfo");const{name:o,type:a}=s,u=n.getAttribLocation(e,o);if(u>=0){const{attributeType:h}=Jle(a),d=/instance/i.test(o)?"instance":"vertex";t.push({name:o,location:u,stepMode:d,type:h})}}return t.sort((i,s)=>i.location-s.location),t}function nce(n,e){const t=[],r=n.getProgramParameter(e,35971);for(let i=0;i<r;i++){const s=n.getTransformFeedbackVarying(e,i);if(!s)throw new Error("activeInfo");const{name:o,type:a,size:u}=s,{glType:h,components:d}=xV(a),g={location:i,name:o,type:h,size:u*d};t.push(g)}return t.sort((i,s)=>i.location-s.location),t}function rce(n,e){const t=[],r=n.getProgramParameter(e,35718);for(let i=0;i<r;i++){const s=n.getActiveUniform(e,i);if(!s)throw new Error("activeInfo");const{name:o,size:a,type:u}=s,{name:h,isArray:d}=ace(o);let g=n.getUniformLocation(e,h);const y={location:g,name:h,size:a,type:u,isArray:d};if(t.push(y),y.size>1)for(let v=0;v<y.size;v++){const T=`${h}[${v}]`;g=n.getUniformLocation(e,T);const w={...y,name:T,location:g};t.push(w)}}return t}function ice(n,e){const t=(s,o)=>n.getActiveUniformBlockParameter(e,s,o),r=[],i=n.getProgramParameter(e,35382);for(let s=0;s<i;s++){const o={name:n.getActiveUniformBlockName(e,s)||"",location:t(s,35391),byteLength:t(s,35392),vertex:t(s,35396),fragment:t(s,35398),uniformCount:t(s,35394),uniforms:[]},a=t(s,35395)||[],u=n.getActiveUniforms(e,a,35383),h=n.getActiveUniforms(e,a,35384),d=n.getActiveUniforms(e,a,35387),g=n.getActiveUniforms(e,a,35388);for(let y=0;y<o.uniformCount;++y){const v=n.getActiveUniform(e,a[y]);if(!v)throw new Error("activeInfo");o.uniforms.push({name:v.name,format:xV(u[y]).format,type:u[y],arrayLength:h[y],byteOffset:d[y],byteStride:g[y]})}r.push(o)}return r.sort((s,o)=>s.location-o.location),r}const sce={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function oce(n){const e=sce[n];if(!e)throw new Error("sampler");const[t,r]=e;return{viewDimension:t,sampleType:r}}function ace(n){if(n[n.length-1]!=="]")return{name:n,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(n);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${n}`);return{name:t[1],length:t[2]?1:0,isArray:!!t[2]}}function lce(n,e,t,r){const i=n;let s=r;s===!0&&(s=1),s===!1&&(s=0);const o=typeof s=="number"?[s]:s;switch(t){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof r!="number")throw new Error("samplers must be set to integers");return n.uniform1i(e,r);case 5126:return n.uniform1fv(e,o);case 35664:return n.uniform2fv(e,o);case 35665:return n.uniform3fv(e,o);case 35666:return n.uniform4fv(e,o);case 5124:return n.uniform1iv(e,o);case 35667:return n.uniform2iv(e,o);case 35668:return n.uniform3iv(e,o);case 35669:return n.uniform4iv(e,o);case 35670:return n.uniform1iv(e,o);case 35671:return n.uniform2iv(e,o);case 35672:return n.uniform3iv(e,o);case 35673:return n.uniform4iv(e,o);case 5125:return i.uniform1uiv(e,o,1);case 36294:return i.uniform2uiv(e,o,2);case 36295:return i.uniform3uiv(e,o,3);case 36296:return i.uniform4uiv(e,o,4);case 35674:return n.uniformMatrix2fv(e,!1,o);case 35675:return n.uniformMatrix3fv(e,!1,o);case 35676:return n.uniformMatrix4fv(e,!1,o);case 35685:return i.uniformMatrix2x3fv(e,!1,o);case 35686:return i.uniformMatrix2x4fv(e,!1,o);case 35687:return i.uniformMatrix3x2fv(e,!1,o);case 35688:return i.uniformMatrix3x4fv(e,!1,o);case 35689:return i.uniformMatrix4x2fv(e,!1,o);case 35690:return i.uniformMatrix4x3fv(e,!1,o)}throw new Error("Illegal uniform")}function cce(n){return iV(n)!==null||typeof n=="number"||typeof n=="boolean"}function uce(n){const e={bindings:{},uniforms:{}};return Object.keys(n).forEach(t=>{const r=n[t];cce(r)?e.uniforms[t]=r:e.bindings[t]=r}),e}function hce(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(n)}}function fce(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(n)}}const wM=4;class dce extends rh{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};constructor(e,t){super(e,t),this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=t.vs,this.fs=t.fs;const{varyings:r,bufferMode:i=35981}=t;r&&r.length>0&&(this.varyings=r,this.device.gl.transformFeedbackVaryings(this.handle,r,i)),this._linkShaders(),we.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=ece(this.device.gl,this.handle),we.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=pce(this.introspectedLayout,t.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(e,t){for(const[r,i]of Object.entries(e)){const s=this.shaderLayout.bindings.find(o=>o.name===r)||this.shaderLayout.bindings.find(o=>o.name===`${r}Uniforms`);if(!s){const o=this.shaderLayout.bindings.map(a=>`"${a.name}"`).join(", ");t?.disableWarnings||we.warn(`No binding "${r}" in render pipeline "${this.id}", expected one of ${o}`,i)();continue}switch(i||we.warn(`Unsetting binding "${r}" in render pipeline "${this.id}"`)(),s.type){case"uniform":if(!(i instanceof Sd)&&!(i.buffer instanceof Sd))throw new Error("buffer value");break;case"texture":if(!(i instanceof Au||i instanceof Rd||i instanceof Ad))throw new Error("texture value");break;case"sampler":we.warn(`Ignoring sampler ${r}`)();break;default:throw new Error(s.type)}this.bindings[r]=i}}draw(e){const{renderPass:t,parameters:r=this.props.parameters,topology:i=this.props.topology,vertexArray:s,vertexCount:o,instanceCount:a,isInstanced:u=!1,firstVertex:h=0,transformFeedback:d}=e,g=hce(i),y=!!s.indexBuffer,v=s.indexBuffer?.glIndexType;if(this.linkStatus!=="success")return we.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return we.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),s.bindBeforeRender(t),d&&d.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const T=t;return Ole(this.device,r,T.glParameters,()=>{y&&u?this.device.gl.drawElementsInstanced(g,o||0,v,h,a||0):y?this.device.gl.drawElements(g,o||0,v,h):u?this.device.gl.drawArraysInstanced(g,h,o||0,a||0):this.device.gl.drawArrays(g,h,o||0),d&&d.end()}),s.unbindAfterRender(t),!0}setUniformsWebGL(e){const{bindings:t}=uce(e);Object.keys(t).forEach(r=>{we.warn(`Unsupported value "${JSON.stringify(t[r])}" used in setUniforms() for key ${r}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,e)}async _linkShaders(){const{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),we.time(wM,`linkProgram for ${this.id}`)(),e.linkProgram(this.handle),we.timeEnd(wM,`linkProgram for ${this.id}`)(),we.level,!this.device.features.has("compilation-status-async-webgl")){const r=this._getLinkStatus();this._reportLinkStatus(r);return}we.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),we.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const t=this._getLinkStatus();this._reportLinkStatus(t)}async _reportLinkStatus(e){switch(e){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch(this.fs?.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const t=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${e}: ${t}`)}}_getLinkStatus(){const{gl:e}=this.device;return e.getProgramParameter(this.handle,35714)?(e.validateProgram(this.handle),e.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const e=async i=>await new Promise(s=>setTimeout(s,i));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:r}=this.device;for(;;){if(r.getProgramParameter(this.handle,37297))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(const t of this.shaderLayout.bindings)!this.bindings[t.name]&&!this.bindings[t.name.replace(/Uniforms$/,"")]&&(we.warn(`Binding ${t.name} not found in ${this.id}`)(),e=!1);return e}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:e}=this.device;e.useProgram(this.handle);let t=0,r=0;for(const i of this.shaderLayout.bindings){const s=this.bindings[i.name]||this.bindings[i.name.replace(/Uniforms$/,"")];if(!s)throw new Error(`No value for binding ${i.name} in ${this.id}`);switch(i.type){case"uniform":const{name:o}=i,a=e.getUniformBlockIndex(this.handle,o);if(a===4294967295)throw new Error(`Invalid uniform block name ${o}`);e.uniformBlockBinding(this.handle,r,a),s instanceof Sd?e.bindBufferBase(35345,r,s.handle):e.bindBufferRange(35345,r,s.buffer.handle,s.offset||0,s.size||s.buffer.byteLength-s.offset),r+=1;break;case"texture":if(!(s instanceof Au||s instanceof Rd||s instanceof Ad))throw new Error("texture");let u;if(s instanceof Au)u=s.texture;else if(s instanceof Rd)u=s;else if(s instanceof Ad&&s.colorAttachments[0]instanceof Au)we.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),u=s.colorAttachments[0].texture;else throw new Error("No texture");e.activeTexture(33984+t),e.bindTexture(u.glTarget,u.handle),t+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${i.type}' not supported in WebGL`)}}}_applyUniforms(){for(const e of this.shaderLayout.uniforms||[]){const{name:t,location:r,type:i,textureUnit:s}=e,o=this.uniforms[t]??s;o!==void 0&&lce(this.device.gl,r,i,o)}}}function pce(n,e){const t={...n,attributes:n.attributes.map(r=>({...r}))};for(const r of e?.attributes||[]){const i=t.attributes.find(s=>s.name===r.name);i?(i.type=r.type||i.type,i.stepMode=r.stepMode||i.stepMode):we.warn(`shader layout attribute ${r.name} not present in shader`)}return t}class gce extends x1{device;commands=[];constructor(e){super(e,{}),this.device=e}submitCommands(e=this.commands){for(const t of e)switch(t.name){case"copy-buffer-to-buffer":mce(this.device,t.options);break;case"copy-buffer-to-texture":yce(this.device,t.options);break;case"copy-texture-to-buffer":_ce(this.device,t.options);break;case"copy-texture-to-texture":vce(this.device,t.options);break;default:throw new Error(t.name)}}}function mce(n,e){const t=e.sourceBuffer,r=e.destinationBuffer;n.gl.bindBuffer(36662,t.handle),n.gl.bindBuffer(36663,r.handle),n.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),n.gl.bindBuffer(36662,null),n.gl.bindBuffer(36663,null)}function yce(n,e){throw new Error("Not implemented")}function _ce(n,e){const{sourceTexture:t,mipLevel:r=0,aspect:i="all",width:s=e.sourceTexture.width,height:o=e.sourceTexture.height,depthOrArrayLayers:a=0,origin:u=[0,0],destinationBuffer:h,byteOffset:d=0,bytesPerRow:g,rowsPerImage:y}=e;if(i!=="all")throw new Error("aspect not supported in WebGL");if(r!==0||a!==0||g||y)throw new Error("not implemented");const{framebuffer:v,destroyFramebuffer:T}=EV(t);let w;try{const E=h,S=s||v.width,P=o||v.height,I=gV(v.colorAttachments[0].texture.props.format),L=I.format,F=I.type;n.gl.bindBuffer(35051,E.handle),w=n.gl.bindFramebuffer(36160,v.handle),n.gl.readPixels(u[0],u[1],S,P,L,F,d)}finally{n.gl.bindBuffer(35051,null),w!==void 0&&n.gl.bindFramebuffer(36160,w),T&&v.destroy()}}function vce(n,e){const{sourceTexture:t,destinationMipLevel:r=0,origin:i=[0,0],destinationOrigin:s=[0,0],destinationTexture:o}=e;let{width:a=e.destinationTexture.width,height:u=e.destinationTexture.height}=e;const{framebuffer:h,destroyFramebuffer:d}=EV(t),[g,y]=i,[v,T,w]=s,E=n.gl.bindFramebuffer(36160,h.handle);let S=null,P;if(o instanceof Rd)S=o,a=Number.isFinite(a)?a:S.width,u=Number.isFinite(u)?u:S.height,S.bind(0),P=S.glTarget;else throw new Error("invalid destination");switch(P){case 3553:case 34067:n.gl.copyTexSubImage2D(P,r,v,T,g,y,a,u);break;case 35866:case 32879:n.gl.copyTexSubImage3D(P,r,v,T,w,g,y,a,u);break}S&&S.unbind(),n.gl.bindFramebuffer(36160,E),d&&h.destroy()}function EV(n){if(n instanceof St){const{width:e,height:t,id:r}=n;return{framebuffer:n.device.createFramebuffer({id:`framebuffer-for-${r}`,width:e,height:t,colorAttachments:[n]}),destroyFramebuffer:!0}}return{framebuffer:n,destroyFramebuffer:!1}}class bce extends w1{device;commandBuffer;constructor(e,t){super(e,t),this.device=e,this.commandBuffer=new gce(e)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}resolveQuerySet(e,t,r){}}function Tce(n){const{target:e,source:t,start:r=0,count:i=1}=n,s=t.length,o=i*s;let a=0;for(let u=r;a<s;a++)e[u++]=t[a];for(;a<o;)a<o-a?(e.copyWithin(r+a,r,r+a),a*=2):(e.copyWithin(r+a,r,r+o-a),a=o);return n.target}class J1 extends E1{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(e){return JZ()==="Chrome"}constructor(e,t){super(e,t),this.device=e,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){const t=e;if(t&&t.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,t?t.handle:null),this.indexBuffer=t,this.device.gl.bindVertexArray(null)}setBuffer(e,t){const r=t;if(r.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:i,type:s,stride:o,offset:a,normalized:u,integer:h,divisor:d}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,r.handle),h?this.device.gl.vertexAttribIPointer(e,i,s,o,a):this.device.gl.vertexAttribPointer(e,i,s,u,o,a),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,d||0),this.attributes[e]=r,this.device.gl.bindVertexArray(null)}setConstantWebGL(e,t){this._enable(e,!1),this.attributes[e]=t}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){const t=this.attributes[e];ArrayBuffer.isView(t)&&this.device.setConstantAttributeWebGL(e,t)}}_getAccessor(e){const t=this.attributeInfos[e];if(!t)throw new Error(`Unknown attribute location ${e}`);const r=pV(t.bufferDataType);return{size:t.bufferComponents,type:r,stride:t.byteStride,offset:t.byteOffset,normalized:t.normalized,integer:t.integer,divisor:t.stepMode==="instance"?1:0}}_enable(e,t=!0){const i=J1.isConstantAttributeZeroSupported(this.device)||e!==0;(t||i)&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),t?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,t){const r=wce(t),i=r.byteLength*e,s=r.length*e;if(this.buffer&&i!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${i} !== ${this.buffer.byteLength}.`);let o=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:i}),o=o||!xce(r,this.bufferValue),o){const a=qte(t.constructor,s);Tce({target:a,source:r,start:0,count:s}),this.buffer.write(a),this.bufferValue=t}return this.buffer}}function wce(n){return Array.isArray(n)?new Float32Array(n):n}function xce(n,e){if(!n||!e||n.length!==e.length||n.constructor!==e.constructor)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}class Ece extends A1{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(e,t){super(e,t),this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,t.buffers&&this.setBuffers(t.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(e="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(fce(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const t in e)this.setBuffer(t,e[t])})}setBuffer(e,t){const r=this._getVaryingIndex(e),{buffer:i,byteLength:s,byteOffset:o}=this._getBufferRange(t);if(r<0){this.unusedBuffers[e]=i,we.warn(`${this.id} unusedBuffers varying buffer ${e}`)();return}this.buffers[r]={buffer:i,byteLength:s,byteOffset:o},this.bindOnUse||this._bindBuffer(r,i,o,s)}getBuffer(e){if(xM(e))return this.buffers[e]||null;const t=this._getVaryingIndex(e);return t>=0?this.buffers[t]:null}bind(e=this.handle){if(typeof e!="function")return this.gl.bindTransformFeedback(36386,e),this;let t;return this._bound?t=e():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,t=e(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),t}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof Sd)return{buffer:e,byteOffset:0,byteLength:e.byteLength};const{buffer:t,byteOffset:r=0,byteLength:i=e.buffer.byteLength}=e;return{buffer:t,byteOffset:r,byteLength:i}}_getVaryingIndex(e){if(xM(e))return Number(e);for(const t of this.layout.varyings)if(e===t.name)return t.location;return-1}_bindBuffers(){for(const e in this.buffers){const{buffer:t,byteLength:r,byteOffset:i}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),t,i,r)}}_unbindBuffers(){for(const e in this.buffers)this.gl.bindBufferBase(35982,Number(e),null)}_bindBuffer(e,t,r=0,i){const s=t&&t.handle;!s||i===void 0?this.gl.bindBufferBase(35982,e,s):this.gl.bindBufferRange(35982,e,s,r,i)}}function xM(n){return typeof n=="number"?Number.isInteger(n):/^\d+$/.test(n)}class Ace extends S1{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(e,t){if(super(e,t),this.device=e,t.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(e){return this._begin(e?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(e){this._queryPending||(this.target=e,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.device.gl.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise((r,i)=>{const s=()=>{this.isResultAvailable()?(r(this.getResult()),this._pollingPromise=null):t++>e?(i("Timed out"),this._pollingPromise=null):requestAnimationFrame(s)};requestAnimationFrame(s)}),this._pollingPromise}}class Su extends Ea{type="webgl";handle;features;limits;info;canvasContext;lost;_resolveContextLost;gl;debug=!1;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};_extensions={};_polyfilled=!1;spectorJS;constructor(e){super({...e,id:e.id||Rle("webgl-device")});const t=Ea._getCanvasContextProps(e);if(!t)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let r=t.canvas?.gl?.device;if(r)throw new Error(`WebGL context already attached to device ${r.id}`);this.canvasContext=new mle(this,t),this.lost=new Promise(d=>{this._resolveContextLost=d});const i={...e.webgl};t.alphaMode==="premultiplied"&&(i.premultipliedAlpha=!0),e.powerPreference!==void 0&&(i.powerPreference=e.powerPreference);const o=this.props._handle||Gae(this.canvasContext.canvas,{onContextLost:d=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."}),onContextRestored:d=>console.log("WebGL context restored")},i);if(!o)throw new Error("WebGL context creation failed");if(r=o.device,r){if(e._reuseDevices)return we.log(1,`Not creating a new Device, instead returning a reference to Device ${r.id} already attached to WebGL context`,r)(),r._reused=!0,r;throw new Error(`WebGL context already attached to device ${r.id}`)}this.handle=o,this.gl=o,this.spectorJS=vle({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=Zae(this.gl,this._extensions),this.limits=new dle(this.gl),this.features=new fle(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),t.autoResize!==!1&&this.canvasContext.resize(),new zl(this.gl,{log:(...d)=>we.log(1,...d)()}).trackState(this.gl,{copyState:!1});const u=e.debugWebGL||e.debug,h=e.debugWebGL;u&&(this.gl=wle(this.gl,{debugWebGL:u,traceWebGL:h}),we.warn("WebGL debug mode activated. Performance reduced.")(),e.debugWebGL&&(we.level=Math.max(we.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){const t=this._normalizeBufferProps(e);return new Sd(this,t)}createTexture(e){return new Rd(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new hx(this,e)}createShader(e){return new Mle(this,e)}createFramebuffer(e){return new Ad(this,e)}createVertexArray(e){return new J1(this,e)}createTransformFeedback(e){return new Ece(this,e)}createQuerySet(e){return new Ace(this,e)}createRenderPipeline(e){return new dce(this,e)}beginRenderPass(e){return new Gle(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}renderPass=null;createCommandEncoder(e={}){return new bce(this,e)}submit(){this.renderPass?.end(),this.renderPass=null}readPixelsToArrayWebGL(e,t){return Wle(e,t)}readPixelsToBufferWebGL(e,t){return qle(e,t)}setParametersWebGL(e){kh(this.gl,e)}getParametersWebGL(e){return fV(this.gl,e)}withParametersWebGL(e,t){return m_(this.gl,e,t)}resetWebGL(){we.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),Wae(this.gl)}_getDeviceSpecificTextureFormatCapabilities(e){return lle(this.gl,e,this._extensions)}loseDevice(){let e=!1;const r=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return r&&(e=!0,r.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),e}pushState(){zl.get(this.gl).push()}popState(){zl.get(this.gl).pop()}setSpectorMetadata(e,t){e.__SPECTOR_Metadata=t}getGLKey(e,t){const r=Number(e);for(const i in this.gl)if(this.gl[i]===r)return`GL.${i}`;return t?.emptyIfUnknown?"":String(e)}getGLKeys(e){const t={emptyIfUnknown:!0};return Object.entries(e).reduce((r,[i,s])=>(r[`${i}:${this.getGLKey(i,t)}`]=`${s}:${this.getGLKey(s,t)}`,r),{})}_constants;setConstantAttributeWebGL(e,t){const r=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(r).fill(null);const i=this._constants[e];switch(i&&Ice(i,t)&&we.info(1,`setConstantAttributeWebGL(${e}) could have been skipped, value unchanged`)(),this._constants[e]=t,t.constructor){case Float32Array:Sce(this,e,t);break;case Int32Array:Rce(this,e,t);break;case Uint32Array:Cce(this,e,t);break;default:throw new Error("constant")}}getExtension(e){return hh(this.gl,e,this._extensions),this._extensions}}function Sce(n,e,t){switch(t.length){case 1:n.gl.vertexAttrib1fv(e,t);break;case 2:n.gl.vertexAttrib2fv(e,t);break;case 3:n.gl.vertexAttrib3fv(e,t);break;case 4:n.gl.vertexAttrib4fv(e,t);break}}function Rce(n,e,t){n.gl.vertexAttribI4iv(e,t)}function Cce(n,e,t){n.gl.vertexAttribI4uiv(e,t)}function Ice(n,e){if(!n||!e||n.length!==e.length||n.constructor!==e.constructor)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}const Pce={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},Mce=n=>({drawBuffersWEBGL(e){return n.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),Oce=n=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return n.createVertexArray()},deleteVertexArrayOES(e){return n.deleteVertexArray(e)},isVertexArrayOES(e){return n.isVertexArray(e)},bindVertexArrayOES(e){return n.bindVertexArray(e)}}),kce=n=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return n.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return n.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return n.vertexAttribDivisor(...e)}});function Nce(n=!0){const e=HTMLCanvasElement.prototype;if(!n&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(t,r){if(t==="webgl"||t==="experimental-webgl"){const i=this.originalGetContext("webgl2",r);return i instanceof HTMLElement&&Dce(i),i}return this.originalGetContext(t,r)}}function Dce(n){n.getExtension("EXT_color_buffer_float");const e={...Pce,WEBGL_disjoint_timer_query:n.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:Mce(n),OES_vertex_array_object:Oce(n),ANGLE_instanced_arrays:kce(n)},t=n.getExtension;n.getExtension=function(i){const s=t.call(n,i);return s||(i in e?e[i]:null)};const r=n.getSupportedExtensions;n.getSupportedExtensions=function(){return(r.apply(n)||[])?.concat(Object.keys(e))}}const Im=1;class Lce extends wte{type="webgl";constructor(){super(),Ea.defaultProps={...Ea.defaultProps,...Q1},Su.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(e){Nce(e)}async attach(e){if(e instanceof Su)return e;if(e?.device instanceof Ea)return e.device;if(!Uce(e))throw new Error("Invalid WebGL2RenderingContext");return new Su({_handle:e,createCanvasContext:{canvas:e.canvas,autoResize:!1}})}async create(e={}){we.groupCollapsed(Im,"WebGLDevice created")();const t=[];(e.debugWebGL||e.debug)&&t.push(Tle()),e.debugSpectorJS&&t.push(_le(e));const r=await Promise.allSettled(t);for(const o of r)o.status==="rejected"&&we.error(`Failed to initialize debug libraries ${o.reason}`)();const i=new Su(e),s=`${i._reused?"Reusing":"Created"} device with WebGL2 ${i.debug?"debug ":""}context: ${i.info.vendor}, ${i.info.renderer} for canvas: ${i.canvasContext.id}`;return we.probe(Im,s)(),we.table(Im,i.info)(),we.groupEnd(Im)(),i}}function Uce(n){return typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext?!0:!!(n&&Number.isFinite(n._version))}const EM=new Lce;function ra(){}const Vce=({isDragging:n})=>n?"grabbing":"grab",AV={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:ra,onWebGLInitialized:ra,onResize:ra,onViewStateChange:ra,onInteractionStateChange:ra,onBeforeRender:ra,onAfterRender:ra,onLoad:ra,onError:n=>at.error(n.message,n.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:Vce,getTooltip:null,debug:!1,drawPickingColors:!1};class eA{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Rp({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=r=>{const{_pickRequest:i}=this;if(r.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(r.leftButton||r.rightButton)return;{const s=r.offsetCenter;if(!s)return;i.x=s.x,i.y=s.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=r},this._onEvent=r=>{const i=nx[r.type],s=r.offsetCenter;if(!i||!s||!this.layerManager)return;const o=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:s.x,y:s.y,layers:o,viewports:this.getViewports(s)},this._lastPointerDownInfo),{layer:u}=a,h=u&&(u[i]||u.props[i]),d=this.props[i];let g=!1;h&&(g=h.call(u,a,r)),g||(d?.(a,r),this.widgetManager.onEvent(a,r))},this._onPointerDown=r=>{if(this.device?.type==="webgpu")return;const i=r.offsetCenter,s=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=s.result[0]||s.emptyInfo},this.props={...AV,...e},e=this.props,e.viewState&&e.initialViewState&&at.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let t=this.device;!t&&e.gl&&(e.gl instanceof WebGLRenderingContext&&at.error("WebGL1 context not supported.")(),t=EM.attach(e.gl)),t||(t=Ww.createDevice({type:"best-available",_reuseDevices:!0,adapters:[EM],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&ah.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&at.removed("onLayerHover","onHover")(),"onLayerClick"in e&&at.removed("onLayerClick","onClick")(),e.initialViewState&&!Ai(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop?.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t),this.widgetManager.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return t=t||r||i||s||o,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return Bn(this.viewManager),this.viewManager.views}getViewports(e){return Bn(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){this.layerManager?.removeDefaultShaderModule(e)}_pick(e,t,r){Bn(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(t).timeStart();const s=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return i.get(t).timeEnd(),s}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),Bn(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){if(!this.canvas)return;const{width:t,height:r}=e;if(t||t===0){const i=Number.isFinite(t)?`${t}px`:t;this.canvas.style.width=i}if(r||r===0){const i=Number.isFinite(r)?`${r}px`:r;this.canvas.style.position=e.style?.position||"absolute",this.canvas.style.height=i}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const t=e.clientWidth??e.width,r=e.clientHeight??e.height;(t!==this.width||r!==this.height)&&(this.width=t,this.height=r,this.viewManager?.setProps({width:t,height:r}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:t,height:r}))}_createAnimationLoop(e,t){const{gl:r,onError:i,useDevicePixels:s}=t;return new zoe({device:e,useDevicePixels:s,autoResizeDrawingBuffer:!r,autoResizeViewport:!1,onInitialize:o=>this._setDevice(o.device),onRender:this._onRenderFrame.bind(this),onError:i})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new Y1({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){if(this.device?.type==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const{result:t,emptyInfo:r}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=t.length>0;let i=r,s=!1;for(const o of t)i=o,s=o.layer?.onHover(o,e.event)||s;s||(this.props.onHover?.(i,e.event),this.widgetManager.onHover(i,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const t=new rV;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new yse(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(WP).map(i=>{const[s,o,a,u]=WP[i],h=this.props.eventRecognizerOptions?.[i],d={...o,...h,event:i};return{recognizer:new s(d),recognizeWith:a,requestFailure:u}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const i in nx)this.eventManager.on(i,this._onEvent);this.viewManager=new hae({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new uae(this.device,{deck:this,stats:this.stats,viewport:r,timeline:t}),this.effectManager=new Rae({deck:this,device:this.device}),this.deckRenderer=new Pae(this.device),this.deckPicker=new Lae(this.device),this.widgetManager=new Fae({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new zae),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){const{device:r,gl:i}=this.layerManager.context;this.props.onBeforeRender({device:r,gl:i});const s={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};this.deckRenderer?.renderLayers(s),s.pass==="screen"&&this.widgetManager.onRedraw({viewports:s.viewports,layers:s.layers}),this.props.onAfterRender({device:r,gl:i})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),at.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this.device?.type!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const r=Ww.stats.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}eA.defaultProps=AV;eA.VERSION=Ree;function Fce(n){switch(n){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return Q6(n)}}const Bce=Z6;function Pm(n,e,t){const r=t==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:n,format:e.size>1?`${r}x${e.size}`:e.type,byteOffset:e.offset||0}}function Nl(n){return n.stride||n.size*n.bytesPerElement}function zce(n,e){return n.type===e.type&&n.size===e.size&&Nl(n)===Nl(e)&&(n.offset||0)===(e.offset||0)}function fx(n,e){e.offset&&at.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=Nl(n),r=e.vertexOffset!==void 0?e.vertexOffset:n.vertexOffset||0,i=e.elementOffset||0,s=r*t+i*n.bytesPerElement+(n.offset||0);return{...e,offset:s,stride:t}}function jce(n,e){const t=fx(n,e);return{high:t,low:{...t,offset:t.offset+n.size*4}}}class Hce{constructor(e,t,r){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const i=t.logicalType||t.type,s=i==="float64";let{defaultValue:o}=t;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let a;s?a="float32":!i&&t.isIndexed?a="uint32":a=i||"float32";let u=Fce(i||a);this.doublePrecision=s,s&&t.fp64===!1&&(u=Float32Array),this.value=null,this.settings={...t,defaultType:u,defaultValue:o,logicalType:i,type:a,normalized:a.includes("norm"),size:this.size,bytesPerElement:u.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Nl(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),ah.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){const r={};if(this.state.constant){const i=this.value;if(t){const s=fx(this.getAccessor(),t),o=s.offset/i.BYTES_PER_ELEMENT,a=s.size||this.size;r[e]=i.subarray(o,o+a)}else r[e]=i}else r[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?r[`${e}64Low`]=r[e]:r[`${e}64Low`]=new Float32Array(this.size)),r}_getBufferLayout(e=this.id,t=null){const r=this.getAccessor(),i=[],s={name:this.id,byteStride:Nl(r),attributes:i};if(this.doublePrecision){const o=jce(r,t||{});i.push(Pm(e,{...r,...o.high},this.device.type),Pm(`${e}64Low`,{...r,...o.low},this.device.type))}else if(t){const o=fx(r,t);i.push(Pm(e,{...r,...o},this.device.type))}else i.push(Pm(e,r,this.device.type));return s}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:r,size:i}=this,s=r*i;if(t&&s&&t.length>=s){const o=new Array(i).fill(1/0),a=new Array(i).fill(-1/0);for(let u=0;u<s;)for(let h=0;h<i;h++){const d=t[u++];d<o[h]&&(o[h]=d),d>a[h]&&(a[h]=d)}e=[o,a]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof zt?r={buffer:e}:r=e;const i={...this.settings,...r};if(ArrayBuffer.isView(r.value)){if(!r.type)if(this.doublePrecision&&r.value instanceof Float64Array)i.type="float32";else{const o=Bce(r.value);i.type=i.normalized?o.replace("int","norm"):o}i.bytesPerElement=r.value.BYTES_PER_ELEMENT,i.stride=Nl(i)}if(t.bounds=null,r.constant){let s=r.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!t.constant||!this._areValuesEqual(s,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(s)?s:new Float32Array(s)}else if(r.buffer){const s=r.buffer;t.externalBuffer=s,t.constant=!1,this.value=r.value||null}else if(r.value){this._checkExternalBuffer(r);let s=r.value;t.externalBuffer=null,t.constant=!1,this.value=s;let{buffer:o}=this;const a=Nl(i),u=(i.vertexOffset||0)*a;if(this.doublePrecision&&s instanceof Float64Array&&(s=TT(s,i)),this.settings.isIndexed){const d=this.settings.defaultType;s.constructor!==d&&(s=new d(s))}const h=s.byteLength+u+a*2;(!o||o.byteLength<h)&&(o=this._createBuffer(h)),o.write(s,u)}return this.setAccessor(i),!0}updateSubBuffer(e={}){this.state.bounds=null;const t=this.value,{startOffset:r=0,endOffset:i}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?TT(t,{size:this.size,startIndex:r,endIndex:i}):t.subarray(r,i),r*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){const{state:r}=this,i=r.allocatedValue,s=ah.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=s;const{byteOffset:o}=this;let{buffer:a}=this;return(!a||a.byteLength<s.byteLength+o)&&(a=this._createBuffer(s.byteLength+o),t&&i&&a.write(i instanceof Float64Array?TT(i,this):i,o)),r.allocatedValue=s,r.constant=!1,r.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);const r=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=t.BYTES_PER_ELEMENT<4),i)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);!(t instanceof r)&&this.settings.normalized&&!("normalized"in e)&&at.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(t=>(t+128)/255*2-1);case"snorm16":return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(t=>t/255);case"unorm16":return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,r){const{defaultValue:i,size:s}=this.settings;if(Number.isFinite(e))return t[r]=e,t;if(!e){let o=s;for(;--o>=0;)t[r+o]=i[o];return t}switch(s){case 4:t[r+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:t[r+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:t[r+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:t[r+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let o=s;for(;--o>=0;)t[r+o]=Number.isFinite(e[o])?e[o]:i[o]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:r}=this;for(let i=0;i<r;i++)if(e[i]!==t[i])return!1;return!0}_createBuffer(e){this._buffer&&this._buffer.destroy();const{isIndexed:t,type:r}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:(t?zt.INDEX:zt.VERTEX)|zt.COPY_DST,indexType:t?r:void 0,byteLength:e}),this._buffer}}const AM=[],SM=[];function uv(n,e=0,t=1/0){let r=AM;const i={index:-1,data:n,target:[]};return n?typeof n[Symbol.iterator]=="function"?r=n:n.length>0&&(SM.length=n.length,r=SM):r=AM,(e>0||Number.isFinite(t))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,t),i.index=e-1),{iterable:r,objectInfo:i}}function SV(n){return n&&n[Symbol.asyncIterator]}function RV(n,e){const{size:t,stride:r,offset:i,startIndices:s,nested:o}=e,a=n.BYTES_PER_ELEMENT,u=r?r/a:t,h=i?i/a:0,d=Math.floor((n.length-h)/u);return(g,{index:y,target:v})=>{if(!s){const S=y*u+h;for(let P=0;P<t;P++)v[P]=n[S+P];return v}const T=s[y],w=s[y+1]||d;let E;if(o){E=new Array(w-T);for(let S=T;S<w;S++){const P=S*u+h;v=new Array(t);for(let I=0;I<t;I++)v[I]=n[P+I];E[S-T]=v}}else if(u===t)E=n.subarray(T*t+h,w*t+h);else{E=new n.constructor((w-T)*t);let S=0;for(let P=T;P<w;P++){const I=P*u+h;for(let L=0;L<t;L++)E[S++]=n[I+L]}}return E}}const $ce=[],gy=[[0,1/0]];function Wce(n,e){if(n===gy||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return n;const t=[],r=n.length;let i=0;for(let s=0;s<r;s++){const o=n[s];o[1]<e[0]?(t.push(o),i=s+1):o[0]>e[1]?t.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return t.splice(i,0,e),t}const qce={interpolation:{duration:0,easing:n=>n},spring:{stiffness:.05,damping:.5}};function CV(n,e){if(!n)return null;Number.isFinite(n)&&(n={type:"interpolation",duration:n});const t=n.type||"interpolation";return{...qce[t],...e,...n,type:t}}class IV extends Hce{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:gy}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t;(t=this.state).layoutChanged||(t.layoutChanged=!zce(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,r=this.settings.transition,i=Array.isArray(t)?e[t.find(s=>e[s])]:e[t];return CV(i,r)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:r=0,endRow:i=1/0}=t;this.state.updateRanges=Wce(this.state.updateRanges,[r,i])}else this.state.updateRanges=gy}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=$ce}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,t.updateRanges!==gy),!0):!1}updateBuffer({numInstances:e,data:t,props:r,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:o,noAlloc:a}}=this;let u=!0;if(o){for(const[h,d]of s)o.call(i,this,{data:t,startRow:h,endRow:d,props:r,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[h,d]of s){const g=Number.isFinite(h)?this.getVertexOffset(h):0,y=Number.isFinite(d)?this.getVertexOffset(d):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:g,endOffset:y})}this._checkAttributeArray()}else u=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),u}setConstantValue(e){return this.device.type==="webgpu"||e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:r,settings:i}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),i.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const o=e;Bn(ArrayBuffer.isView(o.value),`invalid ${i.accessor}`);const a=!!o.size&&o.size!==this.size;return r.binaryAccessor=RV(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:t,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const r in e)Object.assign(t,super.getValue(r,e[r]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,r=super._getBufferLayout(),{stepMode:i}=this.settings;if(i==="dynamic"?r.stepMode=e?e.isInstanced?"instance":"vertex":"instance":r.stepMode=i??"vertex",!t)return r;for(const s in t){const o=super._getBufferLayout(s,t[s]);r.attributes.push(...o.attributes)}return r}_autoUpdater(e,{data:t,startRow:r,endRow:i,props:s,numInstances:o}){if(e.constant&&this.context.device.type!=="webgpu")return;const{settings:a,state:u,value:h,size:d,startIndices:g}=e,{accessor:y,transform:v}=a;let T=u.binaryAccessor||(typeof y=="function"?y:s[y]);typeof T!="function"&&(T=()=>T),Bn(typeof T=="function",`accessor "${y}" is not a function`);let w=e.getVertexOffset(r);const{iterable:E,objectInfo:S}=uv(t,r,i);for(const P of E){S.index++;let I=T(P,S);if(v&&(I=v.call(this,I)),g){const L=(S.index<g.length-1?g[S.index+1]:o)-g[S.index];if(I&&Array.isArray(I[0])){let F=w;for(const Y of I)e._normalizeValue(Y,h,F),F+=d}else I&&I.length>d?h.set(I,w):(e._normalizeValue(I,S.target,0),sae({target:h,source:S.target,start:w,count:L}));w+=L*d}else e._normalizeValue(I,h,w),w+=d}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let r=!0;switch(t){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function MT(n){const{source:e,target:t,start:r=0,size:i,getData:s}=n,o=n.end||t.length,a=e.length,u=o-r;if(a>u){t.set(e.subarray(0,u),r);return}if(t.set(e,r),!s)return;let h=a;for(;h<u;){const d=s(h,e);for(let g=0;g<i;g++)t[r+h]=d[g]||0,h++}}function Xce({source:n,target:e,size:t,getData:r,sourceStartIndices:i,targetStartIndices:s}){if(!i||!s)return MT({source:n,target:e,size:t,getData:r}),e;let o=0,a=0;const u=r&&((d,g)=>r(d+a,g)),h=Math.min(i.length,s.length);for(let d=1;d<h;d++){const g=i[d]*t,y=s[d]*t;MT({source:n.subarray(o,g),target:e,start:a,end:y,size:t,getData:u}),o=g,a=y}return a<e.length&&MT({source:[],target:e,start:a,size:t,getData:u}),e}function Yce(n){const{device:e,settings:t,value:r}=n,i=new IV(e,t);return i.setData({value:r instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:t.normalized}),i}function PV(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${n}"`)}}function MV(n){switch(n){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function OV(n){n.push(n.shift())}function Kce(n,e){const{doublePrecision:t,settings:r,value:i,size:s}=n,o=t&&i instanceof Float64Array?2:1;let a=0;const{shaderAttributes:u}=n.settings;if(u)for(const h of Object.values(u))a=Math.max(a,h.vertexOffset??0);return(r.noAlloc?i.length:(e+a)*s)*o}function kV({device:n,source:e,target:t}){return(!t||t.byteLength<e.byteLength)&&(t?.destroy(),t=n.createBuffer({byteLength:e.byteLength,usage:e.usage})),t}function NV({device:n,buffer:e,attribute:t,fromLength:r,toLength:i,fromStartIndices:s,getData:o=a=>a}){const a=t.doublePrecision&&t.value instanceof Float64Array?2:1,u=t.size*a,h=t.byteOffset,d=t.settings.bytesPerElement<4?h/t.settings.bytesPerElement*4:h,g=t.startIndices,y=s&&g,v=t.isConstant;if(!y&&e&&r>=i)return e;const T=t.value instanceof Float64Array?Float32Array:t.value.constructor,w=v?t.value:new T(t.getBuffer().readSyncWebGL(h,i*T.BYTES_PER_ELEMENT).buffer);if(t.settings.normalized&&!v){const I=o;o=(L,F)=>t.normalizeConstant(I(L,F))}const E=v?(I,L)=>o(w,L):(I,L)=>o(w.subarray(I+h,I+h+u),L),S=e?new Float32Array(e.readSyncWebGL(d,r*4).buffer):new Float32Array(0),P=new Float32Array(i);return Xce({source:S,target:P,sourceStartIndices:s,targetStartIndices:g,size:u,getData:E}),(!e||e.byteLength<P.byteLength+d)&&(e?.destroy(),e=n.createBuffer({byteLength:P.byteLength+d,usage:35050})),e.write(P,d),e}class DV{constructor({device:e,attribute:t,timeline:r}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new cv(r),this.attribute=t,this.attributeInTransition=Yce(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,r=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=Kce(this.attribute,t),this.transition.start({...e,duration:r})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class Gce extends DV{constructor({device:e,attribute:t,timeline:r}){super({device:e,attribute:t,timeline:r}),this.type="interpolation",this.transform=eue(e,t)}start(e,t){const r=this.currentLength,i=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:s,attribute:o}=this;OV(s),s[0]=NV({device:this.device,buffer:s[0],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter}),s[1]=kV({device:this.device,source:s[0],target:s[1]}),this.setBuffer(s[1]);const{transform:a}=this,u=a.model;let h=Math.floor(this.currentLength/o.size);LV(o)&&(h/=2),u.setVertexCount(h),o.isConstant?(u.setAttributes({aFrom:s[0]}),u.setConstantAttributes({aTo:o.value})):u.setAttributes({aFrom:s[0],aTo:o.getBuffer()}),a.transformFeedback.setBuffers({vCurrent:s[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:r}=this.transition;let i=r/e;t&&(i=t(i));const{model:s}=this.transform,o={time:i};s.shaderInputs.setProps({interpolation:o}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const Zce=`uniform interpolationUniforms {
  float time;
} interpolation;
`,RM={name:"interpolation",vs:Zce,uniformTypes:{time:"f32"}},Qce=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,Jce=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function LV(n){return n.doublePrecision&&n.value instanceof Float64Array}function eue(n,e){const t=e.size,r=PV(t),i=MV(t),s=e.getBufferLayout();return LV(e)?new lh(n,{vs:Jce,bufferLayout:[{name:"aFrom",byteStride:8*t,attributes:[{attribute:"aFrom",format:i,byteOffset:0},{attribute:"aFrom64Low",format:i,byteOffset:4*t}]},{name:"aTo",byteStride:8*t,attributes:[{attribute:"aTo",format:i,byteOffset:0},{attribute:"aTo64Low",format:i,byteOffset:4*t}]}],modules:[aie,RM],defines:{ATTRIBUTE_TYPE:r,ATTRIBUTE_SIZE:t},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new lh(n,{vs:Qce,bufferLayout:[{name:"aFrom",format:i},{name:"aTo",format:s.attributes[0].format}],modules:[RM],defines:{ATTRIBUTE_TYPE:r},varyings:["vCurrent"],disableWarnings:!0})}class tue extends DV{constructor({device:e,attribute:t,timeline:r}){super({device:e,attribute:t,timeline:r}),this.type="spring",this.texture=aue(e),this.framebuffer=lue(e,this.texture),this.transform=oue(e,t)}start(e,t){const r=this.currentLength,i=this.currentStartIndices;super.start(e,t);const{buffers:s,attribute:o}=this;for(let u=0;u<2;u++)s[u]=NV({device:this.device,buffer:s[u],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter});s[2]=kV({device:this.device,source:s[0],target:s[2]}),this.setBuffer(s[1]);const{model:a}=this.transform;a.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?a.setConstantAttributes({aTo:o.value}):a.setAttributes({aTo:o.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:r,transition:i}=this,s=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});const o={stiffness:s.stiffness,damping:s.damping};t.model.shaderInputs.setProps({spring:o}),t.run({framebuffer:r,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),OV(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(r)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const nue=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,rue={name:"spring",vs:nue,uniformTypes:{damping:"f32",stiffness:"f32"}},iue=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,sue=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function oue(n,e){const t=PV(e.size),r=MV(e.size);return new lh(n,{vs:iue,fs:sue,bufferLayout:[{name:"aPrev",format:r},{name:"aCur",format:r},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[rue],defines:{ATTRIBUTE_TYPE:t},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function aue(n){return n.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function lue(n,e){return n.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const cue={interpolation:Gce,spring:tue};class uue{constructor(e,{id:t,timeline:r}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:r}){this.numInstances=r||1;for(const i in e){const s=e[i],o=s.getTransitionSetting(t);o&&this._updateAttribute(i,s,o)}for(const i in this.transitions){const s=e[i];(!s||!s.getTransitionSetting(t))&&this._removeTransition(i)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const r=this.transitions[t];r.inProgress&&(e[t]=r.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,r){const i=this.transitions[e];let s=!i||i.type!==r.type;if(s){i&&this._removeTransition(e);const o=cue[r.type];o?this.transitions[e]=new o({attribute:t,timeline:this.timeline,device:this.device}):(at.error(`unsupported transition type '${r.type}'`)(),s=!1)}(s||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const CM="attributeManager.invalidate",hue="attributeManager.updateStart",fue="attributeManager.updateEnd",due="attribute.updateStart",pue="attribute.allocate",gue="attribute.updateEnd";class mue{constructor(e,{id:t="attribute-manager",stats:r,timeline:i}={}){this.mergeBoundsMemoized=Pp(Coe),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new uue(e,{id:`${t}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const r=this._invalidateTrigger(e,t);Jn(CM,this,e,r)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);Jn(CM,this,"all")}update({data:e,numInstances:t,startIndices:r=null,transitions:i,props:s={},buffers:o={},context:a={}}){let u=!1;Jn(hue,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const h in this.attributes){const d=this.attributes[h],g=d.settings.accessor;d.startIndices=r,d.numInstances=t,s[h]&&at.removed(`props.${h}`,`data.attributes.${h}`)(),d.setExternalBuffer(o[h])||d.setBinaryValue(typeof g=="string"?o[g]:void 0,e.startIndices)||typeof g=="string"&&!o[g]&&d.setConstantValue(s[g])||d.needsUpdate()&&(u=!0,this._updateAttribute({attribute:d,numInstances:t,data:e,props:s,context:a})),this.needsRedraw=this.needsRedraw||d.needsRedraw()}u&&Jn(fue,this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const t=e.map(r=>this.attributes[r]?.getBounds());return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:r}=this,i={...r.getAttributes()};for(const s in t){const o=t[s];o.needsRedraw(e)&&!r.hasAttribute(s)&&(i[s]=o)}return i}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(const r in e){const i=e[r],s={...i,id:r,size:i.isIndexed&&1||i.size||1,...t};this.attributes[r]=new IV(this.device,s)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(i=>{e[i]||(e[i]=[]),e[i].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:r,updateTriggers:i}=this,s=i[e];return s&&s.forEach(o=>{const a=r[o];a&&a.setNeedsUpdate(a.id,t)}),s}_updateAttribute(e){const{attribute:t,numInstances:r}=e;if(Jn(due,t),t.constant){t.setConstantValue(t.value);return}t.allocate(r)&&Jn(pue,t,r),t.updateBuffer(e)&&(this.needsRedraw=!0,Jn(gue,t,r))}}class yue extends cv{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:r,duration:i,easing:s}}=this,o=s(e/i);this._value=Fl(t,r,o)}}const IM=1e-5;function PM(n,e,t,r,i){const s=e-n,a=(t-e)*i,u=-s*r;return a+u+s+e}function _ue(n,e,t,r,i){if(Array.isArray(t)){const s=[];for(let o=0;o<t.length;o++)s[o]=PM(n[o],e[o],t[o],r,i);return s}return PM(n,e,t,r,i)}function MM(n,e){if(Array.isArray(n)){let t=0;for(let r=0;r<n.length;r++){const i=n[r]-e[r];t+=i*i}return Math.sqrt(t)}return Math.abs(n-e)}class vue extends cv{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:r,stiffness:i}=this.settings,{_prevValue:s=e,_currValue:o=e}=this;let a=_ue(s,o,t,r,i);const u=MM(a,t),h=MM(a,o);u<IM&&h<IM&&(a=t,this.end()),this._prevValue=o,this._currValue=a}}const bue={interpolation:yue,spring:vue};class Tue{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,r,i){const{transitions:s}=this;if(s.has(e)){const u=s.get(e),{value:h=u.settings.fromValue}=u;t=h,this.remove(e)}if(i=CV(i),!i)return;const o=bue[i.type];if(!o){at.error(`unsupported transition type '${i.type}'`)();return}const a=new o(this.timeline);a.start({...i,fromValue:t,toValue:r}),s.set(e,a)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,r]of this.transitions)r.update(),e[t]=r.value,r.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function wue(n){const e=n[Sa];for(const t in e){const r=e[t],{validate:i}=r;if(i&&!i(n[t],r))throw new Error(`Invalid prop ${t}: ${n[t]}`)}}function xue(n,e){const t=UV({newProps:n,oldProps:e,propTypes:n[Sa],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=Aue(n,e);let i=!1;return r||(i=Sue(n,e)),{dataChanged:r,propsChanged:t,updateTriggersChanged:i,extensionsChanged:Rue(n,e),transitionsChanged:Eue(n,e)}}function Eue(n,e){if(!n.transitions)return!1;const t={},r=n[Sa];let i=!1;for(const s in n.transitions){const o=r[s],a=o&&o.type;(a==="number"||a==="color"||a==="array")&&dx(n[s],e[s],o)&&(t[s]=!0,i=!0)}return i?t:!1}function UV({newProps:n,oldProps:e,ignoreProps:t={},propTypes:r={},triggerName:i="props"}){if(e===n)return!1;if(typeof n!="object"||n===null)return`${i} changed shallowly`;if(typeof e!="object"||e===null)return`${i} changed shallowly`;for(const s of Object.keys(n))if(!(s in t)){if(!(s in e))return`${i}.${s} added`;const o=dx(n[s],e[s],r[s]);if(o)return`${i}.${s} ${o}`}for(const s of Object.keys(e))if(!(s in t)){if(!(s in n))return`${i}.${s} dropped`;if(!Object.hasOwnProperty.call(n,s)){const o=dx(n[s],e[s],r[s]);if(o)return`${i}.${s} ${o}`}}return!1}function dx(n,e,t){let r=t&&t.equal;return r&&!r(n,e,t)||!r&&(r=n&&e&&n.equals,r&&!r.call(n,e))?"changed deeply":!r&&e!==n?"changed shallowly":null}function Aue(n,e){if(e===null)return"oldProps is null, initial diff";let t=!1;const{dataComparator:r,_dataDiff:i}=n;return r?r(n.data,e.data)||(t="Data comparator detected a change"):n.data!==e.data&&(t="A new data container was supplied"),t&&i&&(t=i(n.data,e.data)||t),t}function Sue(n,e){if(e===null)return{all:!0};if("all"in n.updateTriggers&&OM(n,e,"all"))return{all:!0};const t={};let r=!1;for(const i in n.updateTriggers)i!=="all"&&OM(n,e,i)&&(t[i]=!0,r=!0);return r?t:!1}function Rue(n,e){if(e===null)return!0;const t=e.extensions,{extensions:r}=n;if(r===t)return!1;if(!t||!r||r.length!==t.length)return!0;for(let i=0;i<r.length;i++)if(!r[i].equals(t[i]))return!0;return!1}function OM(n,e,t){let r=n.updateTriggers[t];r=r??{};let i=e.updateTriggers[t];return i=i??{},UV({oldProps:i,newProps:r,triggerName:t})}const Cue="count(): argument not an object",Iue="count(): argument not a container";function Pue(n){if(!Oue(n))throw new Error(Cue);if(typeof n.count=="function")return n.count();if(Number.isFinite(n.size))return n.size;if(Number.isFinite(n.length))return n.length;if(Mue(n))return Object.keys(n).length;throw new Error(Iue)}function Mue(n){return n!==null&&typeof n=="object"&&n.constructor===Object}function Oue(n){return n!==null&&typeof n=="object"}function kM(n,e){if(!e)return n;const t={...n,...e};if("defines"in e&&(t.defines={...n.defines,...e.defines}),"modules"in e&&(t.modules=(n.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=t.modules.findIndex(i=>i.name==="project32");r>=0&&t.modules.splice(r,1)}if("inject"in e)if(!n.inject)t.inject=e.inject;else{const r={...n.inject};for(const i in e.inject)r[i]=(r[i]||"")+e.inject[i];t.inject=r}return t}const kue={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},px={};function Nue(n,e,t,r){if(t instanceof St)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let i=null;t.compressed&&(i={minFilter:"linear",mipmapFilter:t.data.length>1?"nearest":"linear"});const s=e.createTexture({...t,sampler:{...kue,...i,...r},mipmaps:!0});return px[s.id]=n,s}function Due(n,e){!e||!(e instanceof St)||px[e.id]===n&&(e.delete(),delete px[e.id])}const Lue={boolean:{validate(n,e){return!0},equal(n,e,t){return!!n==!!e}},number:{validate(n,e){return Number.isFinite(n)&&(!("max"in e)||n<=e.max)&&(!("min"in e)||n>=e.min)}},color:{validate(n,e){return e.optional&&!n||gx(n)&&(n.length===3||n.length===4)},equal(n,e,t){return Ai(n,e,1)}},accessor:{validate(n,e){const t=y_(n);return t==="function"||t===y_(e.value)},equal(n,e,t){return typeof e=="function"?!0:Ai(n,e,1)}},array:{validate(n,e){return e.optional&&!n||gx(n)},equal(n,e,t){const{compare:r}=t,i=Number.isInteger(r)?r:r?1:0;return r?Ai(n,e,i):n===e}},object:{equal(n,e,t){if(t.ignore)return!0;const{compare:r}=t,i=Number.isInteger(r)?r:r?1:0;return r?Ai(n,e,i):n===e}},function:{validate(n,e){return e.optional&&!n||typeof n=="function"},equal(n,e,t){return!t.compare&&t.ignore!==!1||n===e}},data:{transform:(n,e,t)=>{if(!n)return n;const{dataTransform:r}=t.props;return r?r(n):typeof n.shape=="string"&&n.shape.endsWith("-table")&&Array.isArray(n.data)?n.data:n}},image:{transform:(n,e,t)=>{const r=t.context;return!r||!r.device?null:Nue(t.id,r.device,n,{...e.parameters,...t.props.textureParameters})},release:(n,e,t)=>{Due(t.id,n)}}};function Uue(n){const e={},t={},r={};for(const[i,s]of Object.entries(n)){const o=s?.deprecatedFor;if(o)r[i]=Array.isArray(o)?o:[o];else{const a=Vue(i,s);e[i]=a,t[i]=a.value}}return{propTypes:e,defaultProps:t,deprecatedProps:r}}function Vue(n,e){switch(y_(e)){case"object":return Kf(n,e);case"array":return Kf(n,{type:"array",value:e,compare:!1});case"boolean":return Kf(n,{type:"boolean",value:e});case"number":return Kf(n,{type:"number",value:e});case"function":return Kf(n,{type:"function",value:e,compare:!0});default:return{name:n,type:"unknown",value:e}}}function Kf(n,e){return"type"in e?{name:n,...Lue[e.type],...e}:"value"in e?{name:n,type:y_(e.value),...e}:{name:n,type:"object",value:e}}function gx(n){return Array.isArray(n)||ArrayBuffer.isView(n)}function y_(n){return gx(n)?"array":n===null?"null":typeof n}function Fue(n,e){let t;for(let s=e.length-1;s>=0;s--){const o=e[s];"extensions"in o&&(t=o.extensions)}const r=mx(n.constructor,t),i=Object.create(r);i[g_]=n,i[nc]={},i[ma]={};for(let s=0;s<e.length;++s){const o=e[s];for(const a in o)i[a]=o[a]}return Object.freeze(i),i}const Bue="_mergedDefaultProps";function mx(n,e){if(!(n instanceof hv.constructor))return{};let t=Bue;if(e)for(const i of e){const s=i.constructor;s&&(t+=`:${s.extensionName||s.name}`)}const r=VV(n,t);return r||(n[t]=zue(n,e||[]))}function zue(n,e){if(!n.prototype)return null;const r=Object.getPrototypeOf(n),i=mx(r),s=VV(n,"defaultProps")||{},o=Uue(s),a=Object.assign(Object.create(null),i,o.defaultProps),u=Object.assign(Object.create(null),i?.[Sa],o.propTypes),h=Object.assign(Object.create(null),i?.[ST],o.deprecatedProps);for(const d of e){const g=mx(d.constructor);g&&(Object.assign(a,g),Object.assign(u,g[Sa]),Object.assign(h,g[ST]))}return jue(a,n),$ue(a,u),Hue(a,h),a[Sa]=u,a[ST]=h,e.length===0&&!tA(n,"_propTypes")&&(n._propTypes=u),a}function jue(n,e){const t=que(e);Object.defineProperties(n,{id:{writable:!0,value:t}})}function Hue(n,e){for(const t in e)Object.defineProperty(n,t,{enumerable:!1,set(r){const i=`${this.id}: ${t}`;for(const s of e[t])tA(this,s)||(this[s]=r);at.deprecated(i,e[t].join("/"))()}})}function $ue(n,e){const t={},r={};for(const i in e){const s=e[i],{name:o,value:a}=s;s.async&&(t[o]=a,r[o]=Wue(o))}n[ju]=t,n[nc]={},Object.defineProperties(n,r)}function Wue(n){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||SV(e)?this[nc][n]=e:this[ma][n]=e},get(){if(this[ma]){if(n in this[ma])return this[ma][n]||this[ju][n];if(n in this[nc]){const e=this[g_]&&this[g_].internalState;if(e&&e.hasAsyncProp(n))return e.getAsyncProp(n)||this[ju][n]}}return this[ju][n]}}}function tA(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function VV(n,e){return tA(n,e)&&n[e]}function que(n){const e=n.componentName;return e||at.warn(`${n.name}.componentName not specified`)(),e||n.name}let Xue=0;class hv{constructor(...e){this.props=Fue(this,e),this.id=this.props.id,this.count=Xue++}clone(e){const{props:t}=this,r={};for(const i in t[ju])i in t[ma]?r[i]=t[ma][i]:i in t[nc]&&(r[i]=t[nc][i]);return new this.constructor({...t,...r,...e})}}hv.componentName="Component";hv.defaultProps={};const Yue=Object.freeze({});class Kue{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||Yue}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[g_]||this.component;const t=e[ma]||{},r=e[nc]||e,i=e[ju]||{};for(const s in t){const o=t[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o),t[s]=this.getAsyncProp(s)}for(const s in r){const o=r[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(SV(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const r=this.asyncProps[e];return t===r.resolvedValue||t===r.lastValue?!1:(r.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(t=this._postProcessValue(r,t),r.resolvedValue=t,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,t,r){const i=this.asyncProps[e];i&&r>=i.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=t,i.resolvedLoadCount=r,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const i=r.pendingLoadCount;t.then(s=>{this.component&&(s=this._postProcessValue(r,s),this._setAsyncPropValue(e,s,i),this._onResolve(e,s))}).catch(s=>{this._onError(e,s)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const i=r.pendingLoadCount;let s=[],o=0;for await(const a of t){if(!this.component)return;const{dataTransform:u}=this.component.props;u?s=u(a,s):s=s.concat(a),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:o,endRow:s.length}]}),o=s.length,this._setAsyncPropValue(e,s,i)}this._onResolve(e,s)}_postProcessValue(e,t){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(t,r,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const i=this.component&&this.component.props[Sa];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class Gue extends Kue{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const r=this.layer,i=r?.props.fetch;return i?i(t,{propName:e,layer:r}):super._fetch(e,t)}_onResolve(e,t){const r=this.layer;if(r){const i=r.props.onDataLoad;e==="data"&&i&&i(t,{propName:e,layer:r})}}_onError(e,t){const r=this.layer;r&&r.raiseError(t,`loading ${e} of ${this.layer}`)}}const Zue="layer.changeFlag",Que="layer.initialize",Jue="layer.update",ehe="layer.finalize",the="layer.matched",NM=2**24-1,nhe=Object.freeze([]),rhe=Pp(({oldViewport:n,viewport:e})=>n.equals(e));let vi=new Uint8ClampedArray(0);const ihe={data:{type:"data",value:nhe,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:n=>n&&n.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(n,{propName:e,layer:t,loaders:r,loadOptions:i,signal:s})=>{const{resourceManager:o}=t.context;i=i||t.getLoadOptions(),r=r||t.props.loaders,s&&(i={...i,fetch:{...i?.fetch,signal:s}});let a=o.contains(n);return!a&&!i&&(o.add({resourceId:n,data:n_(n,r),persistent:!1}),a=!0),a?o.subscribe({resourceId:n,onChange:u=>t.internalState?.reloadAsyncProp(e,u),consumerId:t.id,requestId:e}):n_(n,r,i)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:ot.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:n})=>[0,-n*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class ys extends hv{constructor(){super(...arguments),this.internalState=null,this.lifecycle=yu.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){Bn(this.internalState);const t=this.internalState.viewport||this.context.viewport,r=nV(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,s,o]=QU(r,t.pixelProjectionMatrix);return e.length===2?[i,s]:[i,s,o]}unproject(e){return Bn(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){Bn(this.internalState);const r=this.internalState.viewport||this.context.viewport;return Noe(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===ot.DEFAULT||e===ot.LNGLAT||e===ot.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){Bn(e instanceof Uint8Array);const[t,r,i]=e;return t+r*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:Pue(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(e){e=kM(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=kM(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&t)if(Array.isArray(r))for(const i of r)t.invalidateAll(i);else t.invalidateAll();if(t){const{props:i}=e,s=this.internalState.hasPickingBuffer,o=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(s!==o){this.internalState.hasPickingBuffer=o;const{pickingColors:a,instancePickingColors:u}=t.attributes,h=a||u;h&&(o&&h.constant&&(h.constant=!1,t.invalidate(h.id)),!h.value&&!o&&(h.constant=!0,h.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e.renderPass)}getPickingInfo({info:e,mode:t,sourceLayer:r}){const{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,t){t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),this.props.onError?.(e)||this.context?.onError?.(e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!rhe({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const r in e)e[r].layoutChanged()&&(t=!0);for(const r of this.getModels())this._setModelAttributes(r,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,r=this.getNumInstances(),i=this.getStartIndices();e.update({data:t.data,numInstances:r,startIndices:i,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),r=Object.create(this.props);for(const i in t)Object.defineProperty(r,i,{value:t[i]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const r=Math.floor(vi.length/4);if(this.internalState.usesPickingColorCache=!0,r<t){t>NM&&at.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),vi=ah.allocate(vi,t,{size:4,copy:!0,maxCount:Math.max(t,NM)});const i=Math.floor(vi.length/4),s=[0,0,0];for(let o=r;o<i;o++)this.encodePickingColor(o,s),vi[o*4+0]=s[0],vi[o*4+1]=s[1],vi[o*4+2]=s[2],vi[o*4+3]=0}e.value=vi.subarray(0,t*4)}_setModelAttributes(e,t,r=!1){if(!Object.keys(t).length)return;if(r){const a=this.getAttributeManager();e.setBufferLayout(a.getBufferLayouts(e)),t=a.getAttributes()}const i=e.userData?.excludeAttributes||{},s={},o={};for(const a in t){if(i[a])continue;const u=t[a].getValue();for(const h in u){const d=u[h];d instanceof zt?t[a].settings.isIndexed?e.setIndexBuffer(d):s[h]=d:d&&(o[h]=d)}}e.setAttributes(s),e.setConstantAttributes(o)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:i}=this.getAttributeManager().attributes,s=r||i,o=s&&t.attributes&&t.attributes[s.id];if(o&&o.value){const a=o.value,u=this.encodePickingColor(e);for(let h=0;h<t.length;h++){const d=s.getVertexOffset(h);a[d]===u[0]&&a[d+1]===u[1]&&a[d+2]===u[2]&&this._disablePickingIndex(h)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:r}=this.getAttributeManager().attributes,i=t||r;if(!i)return;const s=i.getVertexOffset(e),o=i.getVertexOffset(e+1);i.buffer.write(new Uint8Array(o-s),s)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,r=e||t;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==vi.buffer&&(r.value=vi.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){Bn(!this.internalState),Bn(Number.isFinite(this.props.coordinateSystem)),Jn(Que,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new Gue({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(at.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new Tue(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Jn(the,this,this===e);const{state:t,internalState:r}=e;this!==e&&(this.internalState=r,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Jn(Jue,this,e),!e)return;const t=this.props,r=this.context,i=this.internalState,s=r.viewport,o=this._updateUniformTransition();i.propsInTransition=o,r.viewport=i.viewport||s,this.props=o;try{const a=this._getUpdateParams(),u=this.getModels();if(r.device)this.updateState(a);else try{this.updateState(a)}catch{}for(const d of this.props.extensions)d.updateState.call(this,a,d);this.setNeedsRedraw(),this._updateAttributes();const h=this.getModels()[0]!==u[0];this._postUpdate(a,h)}finally{r.viewport=s,this.props=t,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){Jn(ehe,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:t=null,uniforms:r={},parameters:i={}}){this._updateAttributeTransition();const s=this.props,o=this.context;this.props=this.internalState.propsInTransition||s;try{t&&this.setShaderModuleProps(t);const{getPolygonOffset:a}=this.props,u=a&&a(r)||[0,0];o.device instanceof Su&&o.device.setParametersWebGL({polygonOffset:u});for(const h of this.getModels())h.device.type==="webgpu"?h.setParameters({...h.parameters,...i}):h.setParameters(i);if(o.device instanceof Su)o.device.withParametersWebGL(i,()=>{const h={renderPass:e,shaderModuleProps:t,uniforms:r,parameters:i,context:o};for(const d of this.props.extensions)d.draw.call(this,h,d);this.draw(h)});else{const h={renderPass:e,shaderModuleProps:t,uniforms:r,parameters:i,context:o};for(const d of this.props.extensions)d.draw.call(this,h,d);this.draw(h)}}finally{this.props=s}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const i in e)if(e[i]){let s=!1;switch(i){case"dataChanged":const o=e[i],a=t[i];o&&Array.isArray(a)&&(t.dataChanged=Array.isArray(o)?a.concat(o):o,s=!0);default:t[i]||(t[i]=e[i],s=!0)}s&&Jn(Zue,this,i,e)}const r=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=r,t.somethingChanged=r||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){const r=xue(e,t);if(r.updateTriggersChanged)for(const i in r.updateTriggersChanged)r.updateTriggersChanged[i]&&this.invalidateAttribute(i);if(r.transitionsChanged)for(const i in r.transitionsChanged)this.internalState.uniformTransitions.add(i,t[i],e[i],e.transitions?.[i]);return this.setChangeFlags(r)}validateProps(){wue(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(t.highlightColor=r(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new mue(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:r,oldProps:i}=e,s=this.state.model;s?.isInstanced&&s.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:a,highlightColor:u}=r;if(t||i.autoHighlight!==o||i.highlightedObjectIndex!==a||i.highlightColor!==u){const h={};Array.isArray(u)&&(h.highlightColor=u),(t||i.autoHighlight!==o||a!==i.highlightedObjectIndex)&&(h.highlightedObjectColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setShaderModuleProps({picking:h})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),i=r?r.getNeedsRedraw(e):!1;if(t=t||i,t)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}ys.defaultProps=ihe;ys.layerName="Layer";const she="compositeLayer.renderLayers";class fv extends ys{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id&&(e.object=t.__source.object,e.index=t.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:r}=this.props;return r&&r[e]&&r[e].type||t}getSubLayerRow(e,t,r){return e.__source={parent:this,object:t,index:r},e}getSubLayerAccessor(e){if(typeof e=="function"){const t={index:-1,data:this.props.data,target:[]};return(r,i)=>r&&r.__source?(t.index=r.__source.index,e(r.__source.object,t)):e(r,i)}return e}getSubLayerProps(e={}){const{opacity:t,pickable:r,visible:i,parameters:s,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:u,highlightColor:h,coordinateSystem:d,coordinateOrigin:g,wrapLongitude:y,positionFormat:v,modelMatrix:T,extensions:w,fetch:E,operation:S,_subLayerProps:P}=this.props,I={id:"",updateTriggers:{},opacity:t,pickable:r,visible:i,parameters:s,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:u,highlightColor:h,coordinateSystem:d,coordinateOrigin:g,wrapLongitude:y,positionFormat:v,modelMatrix:T,extensions:w,fetch:E,operation:S},L=P&&e.id&&P[e.id],F=L&&L.updateTriggers,Y=e.id||"sublayer";if(L){const k=this.props[Sa],M=e.type?e.type._propTypes:{};for(const N in L){const H=M[N]||k[N];H&&H.type==="accessor"&&(L[N]=this.getSubLayerAccessor(L[N]))}}Object.assign(I,e,L),I.id=`${this.props.id}-${Y}`,I.updateTriggers={all:this.props.updateTriggers?.all,...e.updateTriggers,...F};for(const k of w){const M=k.getSubLayerProps.call(this,k);M&&Object.assign(I,M,{updateTriggers:Object.assign(I.updateTriggers,M.updateTriggers)})}return I}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let r=this.internalState.subLayers;const i=!r||this.needsUpdate();if(i){const s=this.renderLayers();r=lv(s,Boolean),this.internalState.subLayers=r}Jn(she,this,i,r);for(const s of r)s.parent=this}}fv.layerName="CompositeLayer";const Mm=Math.PI/180,DM=180/Math.PI,my=6370972,Ru=256;function ohe(){const n=Ru/my,e=Math.PI/180*Ru;return{unitsPerMeter:[n,n,n],unitsPerMeter2:[0,0,0],metersPerUnit:[1/n,1/n,1/n],unitsPerDegree:[e,e,n],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/n]}}class ahe extends Oh{constructor(e={}){const{longitude:t=0,zoom:r=0,nearZMultiplier:i=.5,farZMultiplier:s=1,resolution:o=10}=e;let{latitude:a=0,height:u,altitude:h=1.5,fovy:d}=e;a=Math.max(Math.min(a,Tu),-Tu),u=u||1,d?h=H1(d):d=Jd(h);const g=1/Math.PI/Math.cos(a*Math.PI/180),y=Math.pow(2,r)*g,v=e.nearZ??i,T=e.farZ??(h+Ru*2*y/u)*s,w=new fr().lookAt({eye:[0,-h,0],up:[0,0,1]});w.rotateX(a*Mm),w.rotateZ(-t*Mm),w.scale(y/u),super({...e,height:u,viewMatrix:w,longitude:t,latitude:a,zoom:r,distanceScales:ohe(),fovy:d,focalDistance:h,near:v,far:T}),this.scale=y,this.latitude=a,this.longitude=t,this.resolution=o}get projectionMode(){return Lr.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const t={targetZ:e.z||0},r=this.unproject([0,this.height/2],t),i=this.unproject([this.width/2,0],t),s=this.unproject([this.width,this.height/2],t),o=this.unproject([this.width/2,this.height],t);return s[0]<this.longitude&&(s[0]+=360),r[0]>this.longitude&&(r[0]-=360),[Math.min(r[0],s[0],i[0],o[0]),Math.min(r[1],s[1],i[1],o[1]),Math.max(r[0],s[0],i[0],o[0]),Math.max(r[1],s[1],i[1],o[1])]}unproject(e,{topLeft:t=!0,targetZ:r}={}){const[i,s,o]=e,a=t?s:this.height-s,{pixelUnprojectionMatrix:u}=this;let h;if(Number.isFinite(o))h=OT(u,[i,a,o,1]);else{const v=OT(u,[i,a,-1,1]),T=OT(u,[i,a,1,1]),w=((r||0)/my+1)*Ru,E=dT(CU([],v,T)),S=dT(v),P=dT(T),L=4*((4*S*P-(E-S-P)**2)/16)/E,F=Math.sqrt(S-L),Y=Math.sqrt(Math.max(0,w*w-L)),k=(F-Y)/Math.sqrt(E);h=Gne([],v,T,k)}const[d,g,y]=this.unprojectPosition(h);return Number.isFinite(o)?[d,g,y]:Number.isFinite(r)?[d,g,r]:[d,g]}projectPosition(e){const[t,r,i=0]=e,s=t*Mm,o=r*Mm,a=Math.cos(o),u=(i/my+1)*Ru;return[Math.sin(s)*a*u,-Math.cos(s)*a*u,Math.sin(o)*u]}unprojectPosition(e){const[t,r,i]=e,s=IU(e),o=Math.asin(i/s),u=Math.atan2(t,-r)*DM,h=o*DM,d=(s/Ru-1)*my;return[u,h,d]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,t){const r=this.unproject(t);return{longitude:e[0]-r[0]+this.longitude,latitude:e[1]-r[1]+this.latitude}}}function OT(n,e){const t=Ih([],e,n);return B1(t,t,1/t[3]),t}class FV{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:t={}}=e;this.typedArrayManager=ah,this.attributes={},this._attributeDefs=t,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:t,buffers:r={},getGeometry:i,geometryBuffer:s,positionFormat:o,dataChanged:a,normalize:u=!0}=this.opts;if(this.data=t,this.getGeometry=i,this.positionSize=s&&s.size||(o==="XY"?2:3),this.buffers=r,this.normalize=u,s&&(Bn(t.startIndices),this.getGeometry=this.getGeometryFromBuffer(s),u||(r.vertexPositions=s)),this.geometryBuffer=r.vertexPositions,Array.isArray(a))for(const h of a)this._rebuildGeometry(h);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:t}){this._rebuildGeometry({startRow:e,endRow:t})}getGeometryFromBuffer(e){const t=e.value||e;return ArrayBuffer.isView(t)?RV(t,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,t){const{attributes:r,buffers:i,_attributeDefs:s,typedArrayManager:o}=this;for(const a in s)if(a in i)o.release(r[a]),r[a]=null;else{const u=s[a];u.copy=t,r[a]=o.allocate(r[a],e,u)}}_forEachGeometry(e,t,r){const{data:i,getGeometry:s}=this,{iterable:o,objectInfo:a}=uv(i,t,r);for(const u of o){a.index++;const h=s?s(u,a):null;e(h,a.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:t,vertexStarts:r,instanceCount:i}=this;const{data:s,geometryBuffer:o}=this,{startRow:a=0,endRow:u=1/0}=e||{},h={};if(e||(t=[0],r=[0]),this.normalize||!o)this._forEachGeometry((g,y)=>{const v=g&&this.normalizeGeometry(g);h[y]=v,r[y+1]=r[y]+(v?this.getGeometrySize(v):0)},a,u),i=r[r.length-1];else if(r=s.startIndices,i=r[s.length]||0,ArrayBuffer.isView(o))i=i||o.length/this.positionSize;else if(o instanceof zt){const g=this.positionSize*4;i=i||o.byteLength/g}else if(o.buffer){const g=o.stride||this.positionSize*4;i=i||o.buffer.byteLength/g}else if(o.value){const g=o.value,y=o.stride/g.BYTES_PER_ELEMENT||this.positionSize;i=i||g.length/y}this._allocate(i,!!e),this.indexStarts=t,this.vertexStarts=r,this.instanceCount=i;const d={};this._forEachGeometry((g,y)=>{const v=h[y]||g;d.vertexStart=r[y],d.indexStart=t[y];const T=y<r.length-1?r[y+1]:i;d.geometrySize=T-r[y],d.geometryIndex=y,this.updateGeometryAttributes(v,d)},a,u),this.vertexCount=t[t.length-1]}}const lhe=typeof window<"u"?A.useLayoutEffect:A.useEffect;function __(n,e){for(;n;){if(n===e)return!0;n=Object.getPrototypeOf(n)}return!1}const che={position:"absolute",zIndex:-1};function BV(n,e){if(typeof n=="function")return n(e);if(Array.isArray(n))return n.map(t=>BV(t,e));if(dv(n)){if(uhe(n))return e.style=che,A.cloneElement(n,e);if(hhe(n))return A.cloneElement(n,e)}return n}function dv(n){return n&&typeof n=="object"&&"type"in n||!1}function uhe(n){return n.props?.mapStyle}function hhe(n){const e=n.type;return e&&e.deckGLViewProps}function yx(n){if(typeof n=="function")return A.createElement(uh,{},n);if(Array.isArray(n))return n.map(yx);if(dv(n)){if(n.type===A.Fragment)return yx(n.props.children);if(__(n.type,uh))return n}return n}function fhe({children:n,layers:e=[],views:t=null}){const r=[],i=[],s={};return A.Children.forEach(yx(n),o=>{if(dv(o)){const a=o.type;if(__(a,ys)){const u=dhe(a,o.props);i.push(u)}else r.push(o);if(__(a,uh)&&a!==uh&&o.props.id){const u=new a(o.props);s[u.id]=u}}else o&&r.push(o)}),Object.keys(s).length>0&&(Array.isArray(t)?t.forEach(o=>{s[o.id]=o}):t&&(s[t.id]=t),t=Object.values(s)),e=i.length>0?[...i,...e]:e,{layers:e,children:r,views:t}}function dhe(n,e){const t={},r=n.defaultProps||{};for(const i in e)r[i]!==e[i]&&(t[i]=e[i]);return new n(t)}const phe=A.createContext();function ghe({children:n,deck:e,ContextProvider:t=phe.Provider}){const{viewManager:r}=e||{};if(!r||!r.views.length)return[];const i={},s=r.views[0].id;for(const o of n){let a=s,u=o;dv(o)&&__(o.type,uh)&&(a=o.props.id||s,u=o.props.children);const h=r.getViewport(a),d=r.getViewState(a);if(h){d.padding=h.padding;const{x:g,y,width:v,height:T}=h;u=BV(u,{x:g,y,width:v,height:T,viewport:h,viewState:d}),i[a]||(i[a]={viewport:h,children:[]}),i[a].children.push(u)}}return Object.keys(i).map(o=>{const{viewport:a,children:u}=i[o],{x:h,y:d,width:g,height:y}=a,v={position:"absolute",left:h,top:d,width:g,height:y},T=`view-${o}`,w=A.createElement("div",{key:T,id:T,style:v},...u),E={deck:e,viewport:a,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:P=>{P.viewId=o,e._onViewStateChange(P)},widgets:[]},S=`view-${o}-context`;return A.createElement(t,{key:S,value:E},w)})}const mhe={mixBlendMode:null};function yhe({width:n,height:e,style:t}){const r={position:"absolute",zIndex:0,left:0,top:0,width:n,height:e},i={left:0,top:0};if(t)for(const s in t)s in mhe?i[s]=t[s]:r[s]=t[s];return{containerStyle:r,canvasStyle:i}}function _he(n){return{get deck(){return n.deck},pickObject:e=>n.deck.pickObject(e),pickMultipleObjects:e=>n.deck.pickMultipleObjects(e),pickObjects:e=>n.deck.pickObjects(e)}}function zV(n){n.redrawReason&&(n.deck._drawLayers(n.redrawReason),n.redrawReason=null)}function vhe(n,e,t){const r=new e({...t,_customRender:t.deviceProps?.adapters?.[0]?.type==="webgpu"?void 0:i=>{n.redrawReason=i;const s=r.getViewports();n.lastRenderedViewports!==s?n.forceUpdate():zV(n)}});return r}function bhe(n,e){const[t,r]=A.useState(0),s=A.useRef({control:null,version:t,forceUpdate:()=>r(F=>F+1)}).current,o=A.useRef(null),a=A.useRef(null),u=A.useMemo(()=>fhe(n),[n.layers,n.views,n.children]);let h=!0;const d=F=>h&&n.viewState?(s.viewStateUpdateRequested=F,null):(s.viewStateUpdateRequested=null,n.onViewStateChange?.(F)),g=F=>{h?s.interactionStateUpdateRequested=F:(s.interactionStateUpdateRequested=null,n.onInteractionStateChange?.(F))},y=A.useMemo(()=>{const F={widgets:[],...n,style:null,width:"100%",height:"100%",parent:o.current,canvas:a.current,layers:u.layers,views:u.views,onViewStateChange:d,onInteractionStateChange:g};return delete F._customRender,s.deck&&s.deck.setProps(F),F},[n]);A.useEffect(()=>{const F=n.Deck||eA;return s.deck=vhe(s,F,{...y,parent:o.current,canvas:a.current}),()=>s.deck?.finalize()},[]),lhe(()=>{zV(s);const{viewStateUpdateRequested:F,interactionStateUpdateRequested:Y}=s;F&&d(F),Y&&g(Y)}),A.useImperativeHandle(e,()=>_he(s),[]);const v=s.deck&&s.deck.isInitialized?s.deck.getViewports():void 0,{ContextProvider:T,width:w="100%",height:E="100%",id:S,style:P}=n,{containerStyle:I,canvasStyle:L}=A.useMemo(()=>yhe({width:w,height:E,style:P}),[w,E,P]);if(!s.viewStateUpdateRequested&&s.lastRenderedViewports===v||s.version!==t){s.lastRenderedViewports=v,s.version=t;const F=ghe({children:u.children,deck:s.deck,ContextProvider:T}),Y=A.createElement("canvas",{key:"canvas",id:S||"deckgl-overlay",ref:a,style:L});s.control=A.createElement("div",{id:`${S||"deckgl"}-wrapper`,ref:o,style:I},[Y,F])}return h=!1,s.control}const The=A.forwardRef(bhe),whe=new Uint32Array([0,2,1,0,3,2]),xhe=new Float32Array([0,1,0,0,1,0,1,1]);function Ehe(n,e){if(!e)return Ahe(n);const t=Math.max(Math.abs(n[0][0]-n[3][0]),Math.abs(n[1][0]-n[2][0])),r=Math.max(Math.abs(n[1][1]-n[0][1]),Math.abs(n[2][1]-n[3][1])),i=Math.ceil(t/e)+1,s=Math.ceil(r/e)+1,o=(i-1)*(s-1)*6,a=new Uint32Array(o),u=new Float32Array(i*s*2),h=new Float64Array(i*s*3);let d=0,g=0;for(let y=0;y<i;y++){const v=y/(i-1);for(let T=0;T<s;T++){const w=T/(s-1),E=She(n,v,w);h[d*3+0]=E[0],h[d*3+1]=E[1],h[d*3+2]=E[2]||0,u[d*2+0]=v,u[d*2+1]=1-w,y>0&&T>0&&(a[g++]=d-s,a[g++]=d-s-1,a[g++]=d-1,a[g++]=d-s,a[g++]=d-1,a[g++]=d),d++}}return{vertexCount:o,positions:h,indices:a,texCoords:u}}function Ahe(n){const e=new Float64Array(12);for(let t=0;t<n.length;t++)e[t*3+0]=n[t][0],e[t*3+1]=n[t][1],e[t*3+2]=n[t][2]||0;return{vertexCount:6,positions:e,indices:whe,texCoords:xhe}}function She(n,e,t){return Fl(Fl(n[0],n[1],t),Fl(n[3],n[2],t),e)}const LM=`uniform bitmapUniforms {
  vec4 bounds;
  float coordinateConversion;
  float desaturate;
  vec3 tintColor;
  vec4 transparentColor;
} bitmap;
`,Rhe={name:"bitmap",vs:LM,fs:LM,uniformTypes:{bounds:"vec4<f32>",coordinateConversion:"f32",desaturate:"f32",tintColor:"vec3<f32>",transparentColor:"vec4<f32>"}},Che=`#version 300 es
#define SHADER_NAME bitmap-layer-vertex-shader

in vec2 texCoords;
in vec3 positions;
in vec3 positions64Low;

out vec2 vTexCoord;
out vec2 vTexPos;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (bitmap.coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project.commonOrigin.xy;
  } else if (bitmap.coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`,Ihe=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`,Phe=`#version 300 es
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

in vec2 vTexCoord;
in vec2 vTexPos;

out vec4 fragColor;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), bitmap.desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * bitmap.tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  if (bitmap.transparentColor.a == 0.0) {
    return vec4(color, alpha);
  }
  float blendedAlpha = alpha + bitmap.transparentColor.a * (1.0 - alpha);
  float highLightRatio = alpha / blendedAlpha;
  vec3 blendedRGB = mix(bitmap.transparentColor.rgb, color, highLightRatio);
  return vec4(blendedRGB, blendedAlpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bitmap.bounds[0]) / (bitmap.bounds[2] - bitmap.bounds[0]),
    (pos.y - bitmap.bounds[3]) / (bitmap.bounds[1] - bitmap.bounds[3])
  );
}

${Ihe}

void main(void) {
  vec2 uv = vTexCoord;
  if (bitmap.coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (bitmap.coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture(bitmapTexture, uv);

  fragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * layer.opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(fragColor, geometry);

  if (bool(picking.isActive) && !bool(picking.isAttribute)) {
    // Since instance information is not used, we can use picking color for pixel index
    fragColor.rgb = packUVsIntoRGB(uv);
  }
}
`,Mhe={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:ot.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0,value:null}};class nA extends ys{getShaders(){return super.getShaders({vs:Che,fs:Phe,modules:[Ph,Mh,Rhe]})}initializeState(){const e=this.getAttributeManager();e.remove(["instancePickingColors"]);const t=!0;e.add({indices:{size:1,isIndexed:!0,update:r=>r.value=this.state.mesh.indices,noAlloc:t},positions:{size:3,type:"float64",fp64:this.use64bitPositions(),update:r=>r.value=this.state.mesh.positions,noAlloc:t},texCoords:{size:2,update:r=>r.value=this.state.mesh.texCoords,noAlloc:t}})}updateState({props:e,oldProps:t,changeFlags:r}){const i=this.getAttributeManager();if(r.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),i.invalidateAll()),e.bounds!==t.bounds){const s=this.state.mesh,o=this._createMesh();this.state.model.setVertexCount(o.vertexCount);for(const a in o)s&&s[a]!==o[a]&&i.invalidate(a);this.setState({mesh:o,...this._getCoordinateUniforms()})}else e._imageCoordinateSystem!==t._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(e){const{image:t}=this.props,r=e.info;if(!r.color||!t)return r.bitmap=null,r;const{width:i,height:s}=t;r.index=0;const o=Ohe(r.color);return r.bitmap={size:{width:i,height:s},uv:o,pixel:[Math.floor(o[0]*i),Math.floor(o[1]*s)]},r}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(e){super._updateAutoHighlight({...e,color:this.encodePickingColor(0)})}_createMesh(){const{bounds:e}=this.props;let t=e;return UM(e)&&(t=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),Ehe(t,this.context.viewport.resolution)}_getModel(){return new si(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-list",isInstanced:!1})}draw(e){const{shaderModuleProps:t}=e,{model:r,coordinateConversion:i,bounds:s,disablePicking:o}=this.state,{image:a,desaturate:u,transparentColor:h,tintColor:d}=this.props;if(!(t.picking.isActive&&o)&&a&&r){const g={bitmapTexture:a,bounds:s,coordinateConversion:i,desaturate:u,tintColor:d.slice(0,3).map(y=>y/255),transparentColor:h.map(y=>y/255)};r.shaderInputs.setProps({bitmap:g}),r.draw(this.context.renderPass)}}_getCoordinateUniforms(){const{LNGLAT:e,CARTESIAN:t,DEFAULT:r}=ot;let{_imageCoordinateSystem:i}=this.props;if(i!==r){const{bounds:s}=this.props;if(!UM(s))throw new Error("_imageCoordinateSystem only supports rectangular bounds");const o=this.context.viewport.resolution?e:t;if(i=i===e?e:t,i===e&&o===t)return{coordinateConversion:-1,bounds:s};if(i===t&&o===e){const a=La([s[0],s[1]]),u=La([s[2],s[3]]);return{coordinateConversion:1,bounds:[a[0],a[1],u[0],u[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}nA.layerName="BitmapLayer";nA.defaultProps=Mhe;function Ohe(n){const[e,t,r]=n,i=(r&240)/256,s=(r&15)/16;return[(e+s)/256,(t+i)/256]}function UM(n){return Number.isFinite(n[0])}const VM=`uniform iconUniforms {
  float sizeScale;
  vec2 iconsTextureDim;
  float sizeMinPixels;
  float sizeMaxPixels;
  bool billboard;
  highp int sizeUnits;
  float alphaCutoff;
} icon;
`,khe={name:"icon",vs:VM,fs:VM,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}},Nhe=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
icon.sizeMinPixels, icon.sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (icon.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / icon.iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,Dhe=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * layer.opacity * vColor.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Lhe=1024,Uhe=4,FM=()=>{},BM={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Vhe={x:0,y:0,width:0,height:0};function Fhe(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function Bhe(n,e,t,r){const i=Math.min(t/e.width,r/e.height),s=Math.floor(e.width*i),o=Math.floor(e.height*i);return i===1?{image:e,width:s,height:o}:(n.canvas.height=o,n.canvas.width=s,n.clearRect(0,0,s,o),n.drawImage(e,0,0,e.width,e.height,0,0,s,o),{image:n.canvas,width:s,height:o})}function ep(n){return n&&(n.id||n.url)}function zhe(n,e,t,r){const{width:i,height:s,device:o}=n,a=o.createTexture({format:"rgba8unorm",width:e,height:t,sampler:r,mipmaps:!0}),u=o.createCommandEncoder();return u.copyTextureToTexture({sourceTexture:n,destinationTexture:a,width:i,height:s}),u.finish(),n.destroy(),a}function zM(n,e,t){for(let r=0;r<e.length;r++){const{icon:i,xOffset:s}=e[r],o=ep(i);n[o]={...i,x:s,y:t}}}function jhe({icons:n,buffer:e,mapping:t={},xOffset:r=0,yOffset:i=0,rowHeight:s=0,canvasWidth:o}){let a=[];for(let u=0;u<n.length;u++){const h=n[u],d=ep(h);if(!t[d]){const{height:g,width:y}=h;r+y+e>o&&(zM(t,a,i),r=0,i=s+i+e,s=0,a=[]),a.push({icon:h,xOffset:r}),r=r+y+e,s=Math.max(s,g)}}return a.length>0&&zM(t,a,i),{mapping:t,rowHeight:s,xOffset:r,yOffset:i,canvasWidth:o,canvasHeight:Fhe(s+i+e)}}function Hhe(n,e,t){if(!n||!e)return null;t=t||{};const r={},{iterable:i,objectInfo:s}=uv(n);for(const o of i){s.index++;const a=e(o,s),u=ep(a);if(!a)throw new Error("Icon is missing.");if(!a.url)throw new Error("Icon url is missing.");!r[u]&&(!t[u]||a.url!==t[u].url)&&(r[u]={...a,source:o,sourceIndex:s.index})}return r}class $he{constructor(e,{onUpdate:t=FM,onError:r=FM}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=Uhe,this._canvasWidth=Lhe,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=t,this.onError=r}finalize(){this._texture?.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const t=this._autoPacking?ep(e):e;return this._mapping[t]||Vhe}setProps({loadOptions:e,autoPacking:t,iconAtlas:r,iconMapping:i,textureParameters:s}){e&&(this._loadOptions=e),t!==void 0&&(this._autoPacking=t),i&&(this._mapping=i),r&&(this._texture?.delete(),this._texture=null,this._externalTexture=r),s&&(this._samplerParameters=s)}get isLoaded(){return this._pendingCount===0}packIcons(e,t){if(!this._autoPacking||typeof document>"u")return;const r=Object.values(Hhe(e,t,this._mapping)||{});if(r.length>0){const{mapping:i,xOffset:s,yOffset:o,rowHeight:a,canvasHeight:u}=jhe({icons:r,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=a,this._mapping=i,this._xOffset=s,this._yOffset=o,this._canvasHeight=u,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||BM,mipmaps:!0})),this._texture.height!==this._canvasHeight&&(this._texture=zhe(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||BM)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(r)}}_loadIcons(e){const t=this._canvas.getContext("2d",{willReadFrequently:!0});for(const r of e)this._pendingCount++,n_(r.url,this._loadOptions).then(i=>{const s=ep(r),o=this._mapping[s],{x:a,y:u,width:h,height:d}=o,{image:g,width:y,height:v}=Bhe(t,i,h,d);this._texture?.copyExternalImage({image:g,x:a+(h-y)/2,y:u+(d-v)/2,width:y,height:v}),o.width=y,o.height=v,this._texture.generateMipmap(),this.onUpdate()}).catch(i=>{this.onError({url:r.url,source:r.source,sourceIndex:r.sourceIndex,loadOptions:this._loadOptions,error:i})}).finally(()=>{this._pendingCount--})}}const jV=[0,0,0,255],Whe={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:n=>n.position},getIcon:{type:"accessor",value:n=>n.icon},getColor:{type:"accessor",value:jV},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class On extends ys{getShaders(){return super.getShaders({vs:Nhe,fs:Dhe,modules:[Ph,Mh,khe]})}initializeState(){this.state={iconManager:new $he(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:jV},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:t,oldProps:r,changeFlags:i}=e,s=this.getAttributeManager(),{iconAtlas:o,iconMapping:a,data:u,getIcon:h,textureParameters:d}=t,{iconManager:g}=this.state;if(typeof o=="string")return;const y=o||this.internalState.isAsyncPropLoading("iconAtlas");g.setProps({loadOptions:t.loadOptions,autoPacking:!y,iconAtlas:o,iconMapping:y?a:null,textureParameters:d}),y?r.iconMapping!==t.iconMapping&&s.invalidate("getIcon"):(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getIcon))&&g.packIcons(u,h),i.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),s.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:t,sizeMinPixels:r,sizeMaxPixels:i,sizeUnits:s,billboard:o,alphaCutoff:a}=this.props,{iconManager:u}=this.state,h=u.getTexture();if(h){const d=this.state.model,g={iconsTexture:h,iconsTextureDim:[h.width,h.height],sizeUnits:oo[s],sizeScale:t,sizeMinPixels:r,sizeMaxPixels:i,billboard:o,alphaCutoff:a};d.shaderInputs.setProps({icon:g}),d.draw(this.context.renderPass)}}_getModel(){const e=[-1,-1,1,-1,-1,1,1,1];return new si(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ch({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){const t=this.getCurrentLayer()?.props.onIconError;t?t(e):at.error(e.error.message)()}getInstanceOffset(e){const{width:t,height:r,anchorX:i=t/2,anchorY:s=r/2}=this.state.iconManager.getIconMapping(e);return[t/2-i,r/2-s]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:t,y:r,width:i,height:s}=this.state.iconManager.getIconMapping(e);return[t,r,i,s]}}On.defaultProps=Whe;On.layerName="IconLayer";const jM=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,qhe={name:"scatterplot",vs:jM,fs:jM,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},Xhe=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,Yhe=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Khe=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)

struct LayerUniforms {
  opacity: f32,
};

var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    // discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        // discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    // discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,HM=[0,0,0,255],Ghe={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:n=>n.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:HM},getLineColor:{type:"accessor",value:HM},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class rA extends ys{getShaders(){return super.getShaders({vs:Xhe,fs:Yhe,source:Khe,modules:[Ph,Mh,qhe]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:t,radiusScale:r,radiusMinPixels:i,radiusMaxPixels:s,stroked:o,filled:a,billboard:u,antialiasing:h,lineWidthUnits:d,lineWidthScale:g,lineWidthMinPixels:y,lineWidthMaxPixels:v}=this.props,T={stroked:o,filled:a,billboard:u,antialiasing:h,radiusUnits:oo[t],radiusScale:r,radiusMinPixels:i,radiusMaxPixels:s,lineWidthUnits:oo[d],lineWidthScale:g,lineWidthMinPixels:y,lineWidthMaxPixels:v},w=this.state.model;w.shaderInputs.setProps({scatterplot:T}),w.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new si(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ch({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}rA.defaultProps=Ghe;rA.layerName="ScatterplotLayer";const HV={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function $V(n,e,t={}){return Zhe(n,t)!==e?(Jhe(n,t),!0):!1}function Zhe(n,e={}){return Math.sign(Qhe(n,e))}const $M={x:0,y:1,z:2};function Qhe(n,e={}){const{start:t=0,end:r=n.length,plane:i="xy"}=e,s=e.size||2;let o=0;const a=$M[i[0]],u=$M[i[1]];for(let h=t,d=r-s;h<r;h+=s)o+=(n[h+a]-n[d+a])*(n[h+u]+n[d+u]),d=h;return o/2}function Jhe(n,e){const{start:t=0,end:r=n.length,size:i=2}=e,s=(r-t)/i,o=Math.floor(s/2);for(let a=0;a<o;++a){const u=t+a*i,h=t+(s-1-a)*i;for(let d=0;d<i;++d){const g=n[u+d];n[u+d]=n[h+d],n[h+d]=g}}}function Si(n,e){const t=e.length,r=n.length;if(r>0){let i=!0;for(let s=0;s<t;s++)if(n[r-t+s]!==e[s]){i=!1;break}if(i)return!1}for(let i=0;i<t;i++)n[r+i]=e[i];return!0}function _x(n,e){const t=e.length;for(let r=0;r<t;r++)n[r]=e[r]}function tp(n,e,t,r,i=[]){const s=r+e*t;for(let o=0;o<t;o++)i[o]=n[s+o];return i}function vx(n,e,t,r,i=[]){let s,o;if(t&8)s=(r[3]-n[1])/(e[1]-n[1]),o=3;else if(t&4)s=(r[1]-n[1])/(e[1]-n[1]),o=1;else if(t&2)s=(r[2]-n[0])/(e[0]-n[0]),o=2;else if(t&1)s=(r[0]-n[0])/(e[0]-n[0]),o=0;else return null;for(let a=0;a<n.length;a++)i[a]=(o&1)===a?r[o]:s*(e[a]-n[a])+n[a];return i}function yy(n,e){let t=0;return n[0]<e[0]?t|=1:n[0]>e[2]&&(t|=2),n[1]<e[1]?t|=4:n[1]>e[3]&&(t|=8),t}function WV(n,e){const{size:t=2,broken:r=!1,gridResolution:i=10,gridOffset:s=[0,0],startIndex:o=0,endIndex:a=n.length}=e||{},u=(a-o)/t;let h=[];const d=[h],g=tp(n,0,t,o);let y,v;const T=XV(g,i,s,[]),w=[];Si(h,g);for(let E=1;E<u;E++){for(y=tp(n,E,t,o,y),v=yy(y,T);v;){vx(g,y,v,T,w);const S=yy(w,T);S&&(vx(g,w,S,T,w),v=S),Si(h,w),_x(g,w),tfe(T,i,v),r&&h.length>t&&(h=[],d.push(h),Si(h,g)),v=yy(y,T)}Si(h,y),_x(g,y)}return r?d:d[0]}const WM=0,efe=1;function qV(n,e=null,t){if(!n.length)return[];const{size:r=2,gridResolution:i=10,gridOffset:s=[0,0],edgeTypes:o=!1}=t||{},a=[],u=[{pos:n,types:o?new Array(n.length/r).fill(efe):null,holes:e||[]}],h=[[],[]];let d=[];for(;u.length;){const{pos:g,types:y,holes:v}=u.shift();nfe(g,r,v[0]||g.length,h),d=XV(h[0],i,s,d);const T=yy(h[1],d);if(T){let w=qM(g,y,r,0,v[0]||g.length,d,T);const E={pos:w[0].pos,types:w[0].types,holes:[]},S={pos:w[1].pos,types:w[1].types,holes:[]};u.push(E,S);for(let P=0;P<v.length;P++)w=qM(g,y,r,v[P],v[P+1]||g.length,d,T),w[0]&&(E.holes.push(E.pos.length),E.pos=Om(E.pos,w[0].pos),o&&(E.types=Om(E.types,w[0].types))),w[1]&&(S.holes.push(S.pos.length),S.pos=Om(S.pos,w[1].pos),o&&(S.types=Om(S.types,w[1].types)))}else{const w={positions:g};o&&(w.edgeTypes=y),v.length&&(w.holeIndices=v),a.push(w)}}return a}function qM(n,e,t,r,i,s,o){const a=(i-r)/t,u=[],h=[],d=[],g=[],y=[];let v,T,w;const E=tp(n,a-1,t,r);let S=Math.sign(o&8?E[1]-s[3]:E[0]-s[2]),P=e&&e[a-1],I=0,L=0;for(let F=0;F<a;F++)v=tp(n,F,t,r,v),T=Math.sign(o&8?v[1]-s[3]:v[0]-s[2]),w=e&&e[r/t+F],T&&S&&S!==T&&(vx(E,v,o,s,y),Si(u,y)&&d.push(P),Si(h,y)&&g.push(P)),T<=0?(Si(u,v)&&d.push(w),I-=T):d.length&&(d[d.length-1]=WM),T>=0?(Si(h,v)&&g.push(w),L+=T):g.length&&(g[g.length-1]=WM),_x(E,v),S=T,P=w;return[I?{pos:u,types:e&&d}:null,L?{pos:h,types:e&&g}:null]}function XV(n,e,t,r){const i=Math.floor((n[0]-t[0])/e)*e+t[0],s=Math.floor((n[1]-t[1])/e)*e+t[1];return r[0]=i,r[1]=s,r[2]=i+e,r[3]=s+e,r}function tfe(n,e,t){t&8?(n[1]+=e,n[3]+=e):t&4?(n[1]-=e,n[3]-=e):t&2?(n[0]+=e,n[2]+=e):t&1&&(n[0]-=e,n[2]-=e)}function nfe(n,e,t,r){let i=1/0,s=-1/0,o=1/0,a=-1/0;for(let u=0;u<t;u+=e){const h=n[u],d=n[u+1];i=h<i?h:i,s=h>s?h:s,o=d<o?d:o,a=d>a?d:a}return r[0][0]=i,r[0][1]=o,r[1][0]=s,r[1][1]=a,r}function Om(n,e){for(let t=0;t<e.length;t++)n.push(e[t]);return n}const rfe=85.051129;function ife(n,e){const{size:t=2,startIndex:r=0,endIndex:i=n.length,normalize:s=!0}=e||{},o=n.slice(r,i);YV(o,t,0,i-r);const a=WV(o,{size:t,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(s)for(const u of a)KV(u,t);return a}function sfe(n,e=null,t){const{size:r=2,normalize:i=!0,edgeTypes:s=!1}=t||{};e=e||[];const o=[],a=[];let u=0,h=0;for(let g=0;g<=e.length;g++){const y=e[g]||n.length,v=h,T=ofe(n,r,u,y);for(let w=T;w<y;w++)o[h++]=n[w];for(let w=u;w<T;w++)o[h++]=n[w];YV(o,r,v,h),afe(o,r,v,h,t?.maxLatitude),u=y,a[g]=h}a.pop();const d=qV(o,a,{size:r,gridResolution:360,gridOffset:[-180,-180],edgeTypes:s});if(i)for(const g of d)KV(g.positions,r);return d}function ofe(n,e,t,r){let i=-1,s=-1;for(let o=t+1;o<r;o+=e){const a=Math.abs(n[o]);a>i&&(i=a,s=o-1)}return s}function afe(n,e,t,r,i=rfe){const s=n[t],o=n[r-e];if(Math.abs(s-o)>180){const a=tp(n,0,e,t);a[0]+=Math.round((o-s)/360)*360,Si(n,a),a[1]=Math.sign(a[1])*i,Si(n,a),a[0]=s,Si(n,a)}}function YV(n,e,t,r){let i=n[0],s;for(let o=t;o<r;o+=e){s=n[o];const a=s-i;(a>180||a<-180)&&(s-=Math.round(a/360)*360),n[o]=i=s}}function KV(n,e){let t;const r=n.length/e;for(let s=0;s<r&&(t=n[s*e],(t+180)%360===0);s++);const i=-Math.round(t/360)*360;if(i!==0)for(let s=0;s<r;s++)n[s*e]+=i}function lfe(n,e,t,r){let i;if(Array.isArray(n[0])){const s=n.length*e;i=new Array(s);for(let o=0;o<n.length;o++)for(let a=0;a<e;a++)i[o*e+a]=n[o][a]||0}else i=n;return t?WV(i,{size:e,gridResolution:t}):r?ife(i,{size:e}):i}const cfe=1,ufe=2,kT=4;class hfe extends FV{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?lfe(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(XM(e)){let r=0;for(const i of e)r+=this.getGeometrySize(i);return r}const t=this.getPathLength(e);return t<2?0:this.isClosed(e)?t<3?0:t+2:t}updateGeometryAttributes(e,t){if(t.geometrySize!==0)if(e&&XM(e))for(const r of e){const i=this.getGeometrySize(r);t.geometrySize=i,this.updateGeometryAttributes(r,t),t.vertexStart+=i}else this._updateSegmentTypes(e,t),this._updatePositions(e,t)}_updateSegmentTypes(e,t){const r=this.attributes.segmentTypes,i=e?this.isClosed(e):!1,{vertexStart:s,geometrySize:o}=t;r.fill(0,s,s+o),i?(r[s]=kT,r[s+o-2]=kT):(r[s]+=cfe,r[s+o-2]+=ufe),r[s+o-1]=kT}_updatePositions(e,t){const{positions:r}=this.attributes;if(!r||!e)return;const{vertexStart:i,geometrySize:s}=t,o=new Array(3);for(let a=i,u=0;u<s;a++,u++)this.getPointOnPath(e,u,o),r[a*3]=o[0],r[a*3+1]=o[1],r[a*3+2]=o[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,t,r=[]){const{positionSize:i}=this;t*i>=e.length&&(t+=1-e.length/i);const s=t*i;return r[0]=e[s],r[1]=e[s+1],r[2]=i===3&&e[s+2]||0,r}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:t}=this,r=e.length-t;return e[0]===e[r]&&e[1]===e[r+1]&&(t===2||e[2]===e[r+2])}}function XM(n){return Array.isArray(n[0])}const YM=`uniform pathUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float jointType;
  float capType;
  float miterLimit;
  bool billboard;
  highp int widthUnits;
} path;
`,ffe={name:"path",vs:YM,fs:YM,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}},dfe=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = path.capType;
} else {
vJointType = path.jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),
path.widthMinPixels, path.widthMaxPixels) / 2.0);
vec3 width;
if (path.billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,pfe=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,GV=[0,0,0,255],gfe={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:n=>n.path},getColor:{type:"accessor",value:GV},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},NT={enter:(n,e)=>e.length?e.subarray(e.length-n.length):n};class iA extends ys{getShaders(){return super.getShaders({vs:dfe,fs:pfe,modules:[Ph,Mh,ffe]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:NT,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:NT,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:NT,defaultValue:GV},instancePickingColors:{size:4,type:"uint8",accessor:(r,{index:i,target:s})=>this.encodePickingColor(r&&r.__source?r.__source.index:i,s)}}),this.setState({pathTesselator:new hfe({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);const{props:t,changeFlags:r}=e,i=this.getAttributeManager();if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPath)){const{pathTesselator:o}=this.state,a=t.data.attributes||{};o.updateGeometry({data:t.data,geometryBuffer:a.getPath,buffers:a,normalize:!t._pathType,loop:t._pathType==="loop",getGeometry:t.getPath,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:r.dataChanged}),this.setState({numInstances:o.instanceCount,startIndices:o.vertexStarts}),r.dataChanged||i.invalidateAll()}r.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),i.invalidateAll())}getPickingInfo(e){const t=super.getPickingInfo(e),{index:r}=t,i=this.props.data;return i[0]&&i[0].__source&&(t.object=i.find(s=>s.__source.index===r)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let r=0;r<t.length;r++)t[r].__source.index===e&&this._disablePickingIndex(r);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:t,capRounded:r,billboard:i,miterLimit:s,widthUnits:o,widthScale:a,widthMinPixels:u,widthMaxPixels:h}=this.props,d=this.state.model,g={jointType:Number(t),capType:Number(r),billboard:i,widthUnits:oo[o],widthScale:a,miterLimit:s,widthMinPixels:u,widthMaxPixels:h};d.shaderInputs.setProps({path:g}),d.draw(this.context.renderPass)}_getModel(){const e=[0,1,2,1,4,2,1,3,4,3,5,4],t=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new si(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ch({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(t),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateSegmentTypes(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("segmentTypes")}}iA.defaultProps=gfe;iA.layerName="PathLayer";var km={exports:{}},KM;function mfe(){if(KM)return km.exports;KM=1,km.exports=n,km.exports.default=n;function n(O,W,U){U=U||2;var ie=W&&W.length,V=ie?W[0]*U:O.length,Z=e(O,0,V,U,!0),se=[];if(!Z||Z.next===Z.prev)return se;var ae,me,xe,Se,Ce,Me,lt;if(ie&&(Z=u(O,W,Z,U)),O.length>80*U){ae=xe=O[0],me=Se=O[1];for(var Ge=U;Ge<V;Ge+=U)Ce=O[Ge],Me=O[Ge+1],Ce<ae&&(ae=Ce),Me<me&&(me=Me),Ce>xe&&(xe=Ce),Me>Se&&(Se=Me);lt=Math.max(xe-ae,Se-me),lt=lt!==0?32767/lt:0}return r(Z,se,U,ae,me,lt,0),se}function e(O,W,U,ie,V){var Z,se;if(V===Ee(O,W,U,ie)>0)for(Z=W;Z<U;Z+=ie)se=K(Z,O[Z],O[Z+1],se);else for(Z=U-ie;Z>=W;Z-=ie)se=K(Z,O[Z],O[Z+1],se);return se&&L(se,se.next)&&(j(se),se=se.next),se}function t(O,W){if(!O)return O;W||(W=O);var U=O,ie;do if(ie=!1,!U.steiner&&(L(U,U.next)||I(U.prev,U,U.next)===0)){if(j(U),U=W=U.prev,U===U.next)break;ie=!0}else U=U.next;while(ie||U!==W);return W}function r(O,W,U,ie,V,Z,se){if(O){!se&&Z&&v(O,ie,V,Z);for(var ae=O,me,xe;O.prev!==O.next;){if(me=O.prev,xe=O.next,Z?s(O,ie,V,Z):i(O)){W.push(me.i/U|0),W.push(O.i/U|0),W.push(xe.i/U|0),j(O),O=xe.next,ae=xe.next;continue}if(O=xe,O===ae){se?se===1?(O=o(t(O),W,U),r(O,W,U,ie,V,Z,2)):se===2&&a(O,W,U,ie,V,Z):r(t(O),W,U,ie,V,Z,1);break}}}}function i(O){var W=O.prev,U=O,ie=O.next;if(I(W,U,ie)>=0)return!1;for(var V=W.x,Z=U.x,se=ie.x,ae=W.y,me=U.y,xe=ie.y,Se=V<Z?V<se?V:se:Z<se?Z:se,Ce=ae<me?ae<xe?ae:xe:me<xe?me:xe,Me=V>Z?V>se?V:se:Z>se?Z:se,lt=ae>me?ae>xe?ae:xe:me>xe?me:xe,Ge=ie.next;Ge!==W;){if(Ge.x>=Se&&Ge.x<=Me&&Ge.y>=Ce&&Ge.y<=lt&&S(V,ae,Z,me,se,xe,Ge.x,Ge.y)&&I(Ge.prev,Ge,Ge.next)>=0)return!1;Ge=Ge.next}return!0}function s(O,W,U,ie){var V=O.prev,Z=O,se=O.next;if(I(V,Z,se)>=0)return!1;for(var ae=V.x,me=Z.x,xe=se.x,Se=V.y,Ce=Z.y,Me=se.y,lt=ae<me?ae<xe?ae:xe:me<xe?me:xe,Ge=Se<Ce?Se<Me?Se:Me:Ce<Me?Ce:Me,xn=ae>me?ae>xe?ae:xe:me>xe?me:xe,fn=Se>Ce?Se>Me?Se:Me:Ce>Me?Ce:Me,sr=w(lt,Ge,W,U,ie),_s=w(xn,fn,W,U,ie),ct=O.prevZ,nt=O.nextZ;ct&&ct.z>=sr&&nt&&nt.z<=_s;){if(ct.x>=lt&&ct.x<=xn&&ct.y>=Ge&&ct.y<=fn&&ct!==V&&ct!==se&&S(ae,Se,me,Ce,xe,Me,ct.x,ct.y)&&I(ct.prev,ct,ct.next)>=0||(ct=ct.prevZ,nt.x>=lt&&nt.x<=xn&&nt.y>=Ge&&nt.y<=fn&&nt!==V&&nt!==se&&S(ae,Se,me,Ce,xe,Me,nt.x,nt.y)&&I(nt.prev,nt,nt.next)>=0))return!1;nt=nt.nextZ}for(;ct&&ct.z>=sr;){if(ct.x>=lt&&ct.x<=xn&&ct.y>=Ge&&ct.y<=fn&&ct!==V&&ct!==se&&S(ae,Se,me,Ce,xe,Me,ct.x,ct.y)&&I(ct.prev,ct,ct.next)>=0)return!1;ct=ct.prevZ}for(;nt&&nt.z<=_s;){if(nt.x>=lt&&nt.x<=xn&&nt.y>=Ge&&nt.y<=fn&&nt!==V&&nt!==se&&S(ae,Se,me,Ce,xe,Me,nt.x,nt.y)&&I(nt.prev,nt,nt.next)>=0)return!1;nt=nt.nextZ}return!0}function o(O,W,U){var ie=O;do{var V=ie.prev,Z=ie.next.next;!L(V,Z)&&F(V,ie,ie.next,Z)&&N(V,Z)&&N(Z,V)&&(W.push(V.i/U|0),W.push(ie.i/U|0),W.push(Z.i/U|0),j(ie),j(ie.next),ie=O=Z),ie=ie.next}while(ie!==O);return t(ie)}function a(O,W,U,ie,V,Z){var se=O;do{for(var ae=se.next.next;ae!==se.prev;){if(se.i!==ae.i&&P(se,ae)){var me=q(se,ae);se=t(se,se.next),me=t(me,me.next),r(se,W,U,ie,V,Z,0),r(me,W,U,ie,V,Z,0);return}ae=ae.next}se=se.next}while(se!==O)}function u(O,W,U,ie){var V=[],Z,se,ae,me,xe;for(Z=0,se=W.length;Z<se;Z++)ae=W[Z]*ie,me=Z<se-1?W[Z+1]*ie:O.length,xe=e(O,ae,me,ie,!1),xe===xe.next&&(xe.steiner=!0),V.push(E(xe));for(V.sort(h),Z=0;Z<V.length;Z++)U=d(V[Z],U);return U}function h(O,W){return O.x-W.x}function d(O,W){var U=g(O,W);if(!U)return W;var ie=q(U,O);return t(ie,ie.next),t(U,U.next)}function g(O,W){var U=W,ie=O.x,V=O.y,Z=-1/0,se;do{if(V<=U.y&&V>=U.next.y&&U.next.y!==U.y){var ae=U.x+(V-U.y)*(U.next.x-U.x)/(U.next.y-U.y);if(ae<=ie&&ae>Z&&(Z=ae,se=U.x<U.next.x?U:U.next,ae===ie))return se}U=U.next}while(U!==W);if(!se)return null;var me=se,xe=se.x,Se=se.y,Ce=1/0,Me;U=se;do ie>=U.x&&U.x>=xe&&ie!==U.x&&S(V<Se?ie:Z,V,xe,Se,V<Se?Z:ie,V,U.x,U.y)&&(Me=Math.abs(V-U.y)/(ie-U.x),N(U,O)&&(Me<Ce||Me===Ce&&(U.x>se.x||U.x===se.x&&y(se,U)))&&(se=U,Ce=Me)),U=U.next;while(U!==me);return se}function y(O,W){return I(O.prev,O,W.prev)<0&&I(W.next,O,O.next)<0}function v(O,W,U,ie){var V=O;do V.z===0&&(V.z=w(V.x,V.y,W,U,ie)),V.prevZ=V.prev,V.nextZ=V.next,V=V.next;while(V!==O);V.prevZ.nextZ=null,V.prevZ=null,T(V)}function T(O){var W,U,ie,V,Z,se,ae,me,xe=1;do{for(U=O,O=null,Z=null,se=0;U;){for(se++,ie=U,ae=0,W=0;W<xe&&(ae++,ie=ie.nextZ,!!ie);W++);for(me=xe;ae>0||me>0&&ie;)ae!==0&&(me===0||!ie||U.z<=ie.z)?(V=U,U=U.nextZ,ae--):(V=ie,ie=ie.nextZ,me--),Z?Z.nextZ=V:O=V,V.prevZ=Z,Z=V;U=ie}Z.nextZ=null,xe*=2}while(se>1);return O}function w(O,W,U,ie,V){return O=(O-U)*V|0,W=(W-ie)*V|0,O=(O|O<<8)&16711935,O=(O|O<<4)&252645135,O=(O|O<<2)&858993459,O=(O|O<<1)&1431655765,W=(W|W<<8)&16711935,W=(W|W<<4)&252645135,W=(W|W<<2)&858993459,W=(W|W<<1)&1431655765,O|W<<1}function E(O){var W=O,U=O;do(W.x<U.x||W.x===U.x&&W.y<U.y)&&(U=W),W=W.next;while(W!==O);return U}function S(O,W,U,ie,V,Z,se,ae){return(V-se)*(W-ae)>=(O-se)*(Z-ae)&&(O-se)*(ie-ae)>=(U-se)*(W-ae)&&(U-se)*(Z-ae)>=(V-se)*(ie-ae)}function P(O,W){return O.next.i!==W.i&&O.prev.i!==W.i&&!M(O,W)&&(N(O,W)&&N(W,O)&&H(O,W)&&(I(O.prev,O,W.prev)||I(O,W.prev,W))||L(O,W)&&I(O.prev,O,O.next)>0&&I(W.prev,W,W.next)>0)}function I(O,W,U){return(W.y-O.y)*(U.x-W.x)-(W.x-O.x)*(U.y-W.y)}function L(O,W){return O.x===W.x&&O.y===W.y}function F(O,W,U,ie){var V=k(I(O,W,U)),Z=k(I(O,W,ie)),se=k(I(U,ie,O)),ae=k(I(U,ie,W));return!!(V!==Z&&se!==ae||V===0&&Y(O,U,W)||Z===0&&Y(O,ie,W)||se===0&&Y(U,O,ie)||ae===0&&Y(U,W,ie))}function Y(O,W,U){return W.x<=Math.max(O.x,U.x)&&W.x>=Math.min(O.x,U.x)&&W.y<=Math.max(O.y,U.y)&&W.y>=Math.min(O.y,U.y)}function k(O){return O>0?1:O<0?-1:0}function M(O,W){var U=O;do{if(U.i!==O.i&&U.next.i!==O.i&&U.i!==W.i&&U.next.i!==W.i&&F(U,U.next,O,W))return!0;U=U.next}while(U!==O);return!1}function N(O,W){return I(O.prev,O,O.next)<0?I(O,W,O.next)>=0&&I(O,O.prev,W)>=0:I(O,W,O.prev)<0||I(O,O.next,W)<0}function H(O,W){var U=O,ie=!1,V=(O.x+W.x)/2,Z=(O.y+W.y)/2;do U.y>Z!=U.next.y>Z&&U.next.y!==U.y&&V<(U.next.x-U.x)*(Z-U.y)/(U.next.y-U.y)+U.x&&(ie=!ie),U=U.next;while(U!==O);return ie}function q(O,W){var U=new de(O.i,O.x,O.y),ie=new de(W.i,W.x,W.y),V=O.next,Z=W.prev;return O.next=W,W.prev=O,U.next=V,V.prev=U,ie.next=U,U.prev=ie,Z.next=ie,ie.prev=Z,ie}function K(O,W,U,ie){var V=new de(O,W,U);return ie?(V.next=ie.next,V.prev=ie,ie.next.prev=V,ie.next=V):(V.prev=V,V.next=V),V}function j(O){O.next.prev=O.prev,O.prev.next=O.next,O.prevZ&&(O.prevZ.nextZ=O.nextZ),O.nextZ&&(O.nextZ.prevZ=O.prevZ)}function de(O,W,U){this.i=O,this.x=W,this.y=U,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}n.deviation=function(O,W,U,ie){var V=W&&W.length,Z=V?W[0]*U:O.length,se=Math.abs(Ee(O,0,Z,U));if(V)for(var ae=0,me=W.length;ae<me;ae++){var xe=W[ae]*U,Se=ae<me-1?W[ae+1]*U:O.length;se-=Math.abs(Ee(O,xe,Se,U))}var Ce=0;for(ae=0;ae<ie.length;ae+=3){var Me=ie[ae]*U,lt=ie[ae+1]*U,Ge=ie[ae+2]*U;Ce+=Math.abs((O[Me]-O[Ge])*(O[lt+1]-O[Me+1])-(O[Me]-O[lt])*(O[Ge+1]-O[Me+1]))}return se===0&&Ce===0?0:Math.abs((Ce-se)/se)};function Ee(O,W,U,ie){for(var V=0,Z=W,se=U-ie;Z<U;Z+=ie)V+=(O[se]-O[Z])*(O[Z+1]+O[se+1]),se=Z;return V}return n.flatten=function(O){for(var W=O[0][0].length,U={vertices:[],holes:[],dimensions:W},ie=0,V=0;V<O.length;V++){for(var Z=0;Z<O[V].length;Z++)for(var se=0;se<W;se++)U.vertices.push(O[V][Z][se]);V>0&&(ie+=O[V-1].length,U.holes.push(ie))}return U},km.exports}var yfe=mfe();const _fe=qx(yfe),Nm=HV.CLOCKWISE,GM=HV.COUNTER_CLOCKWISE,ya={};function vfe(n){if(n=n&&n.positions||n,!Array.isArray(n)&&!ArrayBuffer.isView(n))throw new Error("invalid polygon")}function ud(n){return"positions"in n?n.positions:n}function _y(n){return"holeIndices"in n?n.holeIndices:null}function bfe(n){return Array.isArray(n[0])}function Tfe(n){return n.length>=1&&n[0].length>=2&&Number.isFinite(n[0][0])}function wfe(n){const e=n[0],t=n[n.length-1];return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function xfe(n,e,t,r){for(let i=0;i<e;i++)if(n[t+i]!==n[r-e+i])return!1;return!0}function ZM(n,e,t,r,i){let s=e;const o=t.length;for(let a=0;a<o;a++)for(let u=0;u<r;u++)n[s++]=t[a][u]||0;if(!wfe(t))for(let a=0;a<r;a++)n[s++]=t[0][a]||0;return ya.start=e,ya.end=s,ya.size=r,$V(n,i,ya),s}function QM(n,e,t,r,i=0,s,o){s=s||t.length;const a=s-i;if(a<=0)return e;let u=e;for(let h=0;h<a;h++)n[u++]=t[i+h];if(!xfe(t,r,i,s))for(let h=0;h<r;h++)n[u++]=t[i+h];return ya.start=e,ya.end=u,ya.size=r,$V(n,o,ya),u}function Efe(n,e){vfe(n);const t=[],r=[];if("positions"in n){const{positions:i,holeIndices:s}=n;if(s){let o=0;for(let a=0;a<=s.length;a++)o=QM(t,o,i,e,s[a-1],s[a],a===0?Nm:GM),r.push(o);return r.pop(),{positions:t,holeIndices:r}}n=i}if(!bfe(n))return QM(t,0,n,e,0,t.length,Nm),t;if(!Tfe(n)){let i=0;for(const[s,o]of n.entries())i=ZM(t,i,o,e,s===0?Nm:GM),r.push(i);return r.pop(),{positions:t,holeIndices:r}}return ZM(t,0,n,e,Nm),t}function DT(n,e,t){const r=n.length/3;let i=0;for(let s=0;s<r;s++){const o=(s+1)%r;i+=n[s*3+e]*n[o*3+t],i-=n[o*3+e]*n[s*3+t]}return Math.abs(i/2)}function JM(n,e,t,r){const i=n.length/3;for(let s=0;s<i;s++){const o=s*3,a=n[o+0],u=n[o+1],h=n[o+2];n[o+e]=a,n[o+t]=u,n[o+r]=h}}function Afe(n,e,t,r){let i=_y(n);i&&(i=i.map(a=>a/e));let s=ud(n);const o=r&&e===3;if(t){const a=s.length;s=s.slice();const u=[];for(let h=0;h<a;h+=e){u[0]=s[h],u[1]=s[h+1],o&&(u[2]=s[h+2]);const d=t(u);s[h]=d[0],s[h+1]=d[1],o&&(s[h+2]=d[2])}}if(o){const a=DT(s,0,1),u=DT(s,0,2),h=DT(s,1,2);if(!a&&!u&&!h)return[];a>u&&a>h||(u>h?(t||(s=s.slice()),JM(s,0,2,1)):(t||(s=s.slice()),JM(s,2,0,1)))}return _fe(s,i,e)}class Sfe extends FV{constructor(e){const{fp64:t,IndexType:r=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:t?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:r,size:1}}})}get(e){const{attributes:t}=this;return e==="indices"?t.indices&&t.indices.subarray(0,this.vertexCount):t[e]}updateGeometry(e){super.updateGeometry(e);const t=this.buffers.indices;if(t)this.vertexCount=(t.value||t).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const t=Efe(e,this.positionSize);return this.opts.resolution?qV(ud(t),_y(t),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?sfe(ud(t),_y(t),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):t}return e}getGeometrySize(e){if(eO(e)){let t=0;for(const r of e)t+=this.getGeometrySize(r);return t}return ud(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,t){if(e&&eO(e))for(const r of e){const i=this.getGeometrySize(r);t.geometrySize=i,this.updateGeometryAttributes(r,t),t.vertexStart+=i,t.indexStart=this.indexStarts[t.geometryIndex+1]}else{const r=e;this._updateIndices(r,t),this._updatePositions(r,t),this._updateVertexValid(r,t)}}_updateIndices(e,{geometryIndex:t,vertexStart:r,indexStart:i}){const{attributes:s,indexStarts:o,typedArrayManager:a}=this;let u=s.indices;if(!u||!e)return;let h=i;const d=Afe(e,this.positionSize,this.opts.preproject,this.opts.full3d);u=a.allocate(u,i+d.length,{copy:!0});for(let g=0;g<d.length;g++)u[h++]=d[g]+r;o[t+1]=i+d.length,s.indices=u}_updatePositions(e,{vertexStart:t,geometrySize:r}){const{attributes:{positions:i},positionSize:s}=this;if(!i||!e)return;const o=ud(e);for(let a=t,u=0;u<r;a++,u++){const h=o[u*s],d=o[u*s+1],g=s>2?o[u*s+2]:0;i[a*3]=h,i[a*3+1]=d,i[a*3+2]=g}}_updateVertexValid(e,{vertexStart:t,geometrySize:r}){const{positionSize:i}=this,s=this.attributes.vertexValid,o=e&&_y(e);if(e&&e.edgeTypes?s.set(e.edgeTypes,t):s.fill(1,t,t+r),o)for(let a=0;a<o.length;a++)s[t+o[a]/i-1]=0;s[t+r-1]=0}}function eO(n){return Array.isArray(n)&&n.length>0&&!Number.isFinite(n[0])}const tO=`uniform solidPolygonUniforms {
  bool extruded;
  bool isWireframe;
  float elevationScale;
} solidPolygon;
`,Rfe={name:"solidPolygon",vs:tO,fs:tO,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}},ZV=`in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project.commonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (solidPolygon.extruded) {
pos.z += props.elevations * solidPolygon.elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (solidPolygon.extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * layer.opacity);
} else {
vColor = vec4(colors.rgb, colors.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Cfe=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${ZV}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,Ife=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${ZV}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`,Pfe=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,v_=[0,0,0,255],Mfe={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:n=>n.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:v_},getLineColor:{type:"accessor",value:v_},material:!0},Dm={enter:(n,e)=>e.length?e.subarray(e.length-n.length):n};class sA extends ys{getShaders(e){return super.getShaders({vs:e==="top"?Cfe:Ife,fs:Pfe,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[Ph,VU,Mh,Rfe]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:t}=this.props;const{_full3d:r}=this.props;e.isGeospatial&&t===ot.DEFAULT&&(t=ot.LNGLAT);let i;t===ot.LNGLAT&&(r?i=e.projectPosition.bind(e):i=e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new Sfe({preproject:i,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const s=this.getAttributeManager(),o=!0;s.remove(["instancePickingColors"]),s.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:o},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:Dm,accessor:"getPolygon",update:this.calculatePositions,noAlloc:o,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:o},elevations:{size:1,stepMode:"dynamic",transition:Dm,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:Dm,accessor:"getFillColor",defaultValue:v_},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:Dm,accessor:"getLineColor",defaultValue:v_},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(a,{index:u,target:h})=>this.encodePickingColor(a&&a.__source?a.__source.index:u,h)}})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:r}=t,i=this.props.data;return i[0]&&i[0].__source&&(t.object=i.find(s=>s.__source.index===r)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let r=0;r<t.length;r++)t[r].__source.index===e&&this._disablePickingIndex(r);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:t,filled:r,wireframe:i,elevationScale:s}=this.props,{topModel:o,sideModel:a,wireframeModel:u,polygonTesselator:h}=this.state,d={extruded:!!t,elevationScale:s,isWireframe:!1};u&&i&&(u.setInstanceCount(h.instanceCount-1),u.shaderInputs.setProps({solidPolygon:{...d,isWireframe:!0}}),u.draw(this.context.renderPass)),a&&r&&(a.setInstanceCount(h.instanceCount-1),a.shaderInputs.setProps({solidPolygon:d}),a.draw(this.context.renderPass)),o&&r&&(o.setVertexCount(h.vertexCount),o.shaderInputs.setProps({solidPolygon:d}),o.draw(this.context.renderPass))}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:t,oldProps:r,changeFlags:i}=e,s=this.getAttributeManager();(i.extensionsChanged||t.filled!==r.filled||t.extruded!==r.extruded)&&(this.state.models?.forEach(a=>a.destroy()),this.setState(this._getModels()),s.invalidateAll())}updateGeometry({props:e,oldProps:t,changeFlags:r}){if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPolygon)){const{polygonTesselator:s}=this.state,o=e.data.attributes||{};s.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:o.getPolygon,buffers:o,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:r.dataChanged,full3d:e._full3d}),this.setState({numInstances:s.instanceCount,startIndices:s.vertexStarts}),r.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:t,extruded:r}=this.props;let i,s,o;if(t){const a=this.getShaders("top");a.defines.NON_INSTANCED_MODEL=1;const u=this.getAttributeManager().getBufferLayouts({isInstanced:!1});i=new si(this.context.device,{...a,id:`${e}-top`,topology:"triangle-list",bufferLayout:u,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(r){const a=this.getAttributeManager().getBufferLayouts({isInstanced:!0});s=new si(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:a,geometry:new ch({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),o=new si(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:a,geometry:new ch({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[s,o,i].filter(Boolean),topModel:i,sideModel:s,wireframeModel:o}}calculateIndices(e){const{polygonTesselator:t}=this.state;e.startIndices=t.indexStarts,e.value=t.get("indices")}calculatePositions(e){const{polygonTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}sA.defaultProps=Mfe;sA.layerName="SolidPolygonLayer";function Ofe({data:n,getIndex:e,dataRange:t,replace:r}){const{startRow:i=0,endRow:s=1/0}=t,o=n.length;let a=o,u=o;for(let y=0;y<o;y++){const v=e(n[y]);if(a>y&&v>=i&&(a=y),v>=s){u=y;break}}let h=a;const g=u-a!==r.length?n.slice(u):void 0;for(let y=0;y<r.length;y++)n[h++]=r[y];if(g){for(let y=0;y<g.length;y++)n[h++]=g[y];n.length=h}return{startRow:a,endRow:a+r.length}}function kfe(n,e){if(!n)return null;const t="startIndices"in n?n.startIndices[e]:e,r=n.featureIds.value[t];return t!==-1?Nfe(n,r,t):null}function Nfe(n,e,t){const r={properties:{...n.properties[e]}};for(const i in n.numericProps)r.properties[i]=n.numericProps[i].value[t];return r}function Dfe(n,e){const t={points:null,lines:null,polygons:null};for(const r in t){const i=n[r].globalFeatureIds.value;t[r]=new Uint8ClampedArray(i.length*4);const s=[];for(let o=0;o<i.length;o++)e(i[o],s),t[r][o*4+0]=s[0],t[r][o*4+1]=s[1],t[r][o*4+2]=s[2],t[r][o*4+3]=255}return t}const nO=`uniform sdfUniforms {
  float gamma;
  bool enabled;
  float buffer;
  float outlineBuffer;
  vec4 outlineColor;
} sdf;
`,Lfe={name:"sdf",vs:nO,fs:nO,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}},Ufe=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf.enabled) {
float distance = alpha;
alpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);
if (sdf.outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);
color = mix(sdf.outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * layer.opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,LT=192/256,rO=[],Vfe={getIconOffsets:{type:"accessor",value:n=>n.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class oA extends On{getShaders(){const e=super.getShaders();return{...e,modules:[...e.modules,Lfe],fs:Ufe}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(t,{index:r,target:i})=>this.encodePickingColor(r,i)}})}updateState(e){super.updateState(e);const{props:t,oldProps:r}=e;let{outlineColor:i}=t;i!==r.outlineColor&&(i=i.map(s=>s/255),i[3]=Number.isFinite(i[3])?i[3]:1,this.setState({outlineColor:i})),!t.sdf&&t.outlineWidth&&at.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){const{sdf:t,smoothing:r,outlineWidth:i}=this.props,{outlineColor:s}=this.state,o=i?Math.max(r,LT*(1-i)):-1,a=this.state.model,u={buffer:LT,outlineBuffer:o,gamma:r,enabled:!!t,outlineColor:s};if(a.shaderInputs.setProps({sdf:u}),super.draw(e),t&&i){const{iconManager:h}=this.state;h.getTexture()&&(a.shaderInputs.setProps({sdf:{...u,outlineBuffer:LT}}),a.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(t=>super.getInstanceOffset(t)):rO}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(t=>super.getInstanceIconFrame(t)):rO}}oA.defaultProps=Vfe;oA.layerName="MultiIconLayer";const Cd=1e20;class Ffe{constructor({fontSize:e=24,buffer:t=3,radius:r=8,cutoff:i=.25,fontFamily:s="sans-serif",fontWeight:o="normal",fontStyle:a="normal",lang:u=null}={}){this.buffer=t,this.cutoff=i,this.radius=r,this.lang=u;const h=this.size=e+t*4,d=this._createCanvas(h),g=this.ctx=d.getContext("2d",{willReadFrequently:!0});g.font=`${a} ${o} ${e}px ${s}`,g.textBaseline="alphabetic",g.textAlign="left",g.fillStyle="black",this.gridOuter=new Float64Array(h*h),this.gridInner=new Float64Array(h*h),this.f=new Float64Array(h),this.z=new Float64Array(h+1),this.v=new Uint16Array(h)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:i,actualBoundingBoxLeft:s,actualBoundingBoxRight:o}=this.ctx.measureText(e),a=Math.ceil(r),u=0,h=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-s))),d=Math.min(this.size-this.buffer,a+Math.ceil(i)),g=h+2*this.buffer,y=d+2*this.buffer,v=Math.max(g*y,0),T=new Uint8ClampedArray(v),w={data:T,width:g,height:y,glyphWidth:h,glyphHeight:d,glyphTop:a,glyphLeft:u,glyphAdvance:t};if(h===0||d===0)return w;const{ctx:E,buffer:S,gridInner:P,gridOuter:I}=this;this.lang&&(E.lang=this.lang),E.clearRect(S,S,h,d),E.fillText(e,S,S+a);const L=E.getImageData(S,S,h,d);I.fill(Cd,0,v),P.fill(0,0,v);for(let F=0;F<d;F++)for(let Y=0;Y<h;Y++){const k=L.data[4*(F*h+Y)+3]/255;if(k===0)continue;const M=(F+S)*g+Y+S;if(k===1)I[M]=0,P[M]=Cd;else{const N=.5-k;I[M]=N>0?N*N:0,P[M]=N<0?N*N:0}}iO(I,0,0,g,y,g,this.f,this.v,this.z),iO(P,S,S,h,d,g,this.f,this.v,this.z);for(let F=0;F<v;F++){const Y=Math.sqrt(I[F])-Math.sqrt(P[F]);T[F]=Math.round(255-255*(Y/this.radius+this.cutoff))}return w}}function iO(n,e,t,r,i,s,o,a,u){for(let h=e;h<e+r;h++)sO(n,t*s+h,s,i,o,a,u);for(let h=t;h<t+i;h++)sO(n,h*s+e,1,r,o,a,u)}function sO(n,e,t,r,i,s,o){s[0]=0,o[0]=-Cd,o[1]=Cd,i[0]=n[e];for(let a=1,u=0,h=0;a<r;a++){i[a]=n[e+a*t];const d=a*a;do{const g=s[u];h=(i[a]-i[g]+d-g*g)/(a-g)/2}while(h<=o[u]&&--u>-1);u++,s[u]=a,o[u]=h,o[u+1]=Cd}for(let a=0,u=0;a<r;a++){for(;o[u+1]<a;)u++;const h=s[u],d=a-h;n[e+a*t]=i[h]+d*d}}const Bfe=32,zfe=[];function jfe(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function Hfe({characterSet:n,getFontWidth:e,fontHeight:t,buffer:r,maxCanvasWidth:i,mapping:s={},xOffset:o=0,yOffset:a=0}){let u=0,h=o;const d=t+r*2;for(const g of n)if(!s[g]){const y=e(g);h+y+r*2>i&&(h=0,u++),s[g]={x:h+r,y:a+u*d+r,width:y,height:d,layoutWidth:y,layoutHeight:t},h+=y+r*2}return{mapping:s,xOffset:h,yOffset:a+u*d,canvasHeight:jfe(a+(u+1)*d)}}function QV(n,e,t,r){let i=0;for(let s=e;s<t;s++){const o=n[s];i+=r[o]?.layoutWidth||0}return i}function JV(n,e,t,r,i,s){let o=e,a=0;for(let u=e;u<t;u++){const h=QV(n,u,u+1,i);a+h>r&&(o<u&&s.push(u),o=u,a=0),a+=h}return a}function $fe(n,e,t,r,i,s){let o=e,a=e,u=e,h=0;for(let d=e;d<t;d++)if((n[d]===" "||n[d+1]===" "||d+1===t)&&(u=d+1),u>a){let g=QV(n,a,u,i);h+g>r&&(o<a&&(s.push(a),o=a,h=0),g>r&&(g=JV(n,a,u,r,i,s),o=s[s.length-1])),a=u,h+=g}return h}function Wfe(n,e,t,r,i=0,s){s===void 0&&(s=n.length);const o=[];return e==="break-all"?JV(n,i,s,t,r,o):$fe(n,i,s,t,r,o),o}function qfe(n,e,t,r,i,s){let o=0,a=0;for(let u=e;u<t;u++){const h=n[u],d=r[h];d?(a||(a=d.layoutHeight),i[u]=o+d.layoutWidth/2,o+=d.layoutWidth):(at.warn(`Missing character: ${h} (${h.codePointAt(0)})`)(),i[u]=o,o+=Bfe)}s[0]=o,s[1]=a}function Xfe(n,e,t,r,i){const s=Array.from(n),o=s.length,a=new Array(o),u=new Array(o),h=new Array(o),d=(t==="break-word"||t==="break-all")&&isFinite(r)&&r>0,g=[0,0],y=[0,0];let v=0,T=0,w=0;for(let E=0;E<=o;E++){const S=s[E];if((S===`
`||E===o)&&(w=E),w>T){const P=d?Wfe(s,t,r,i,T,w):zfe;for(let I=0;I<=P.length;I++){const L=I===0?T:P[I-1],F=I<P.length?P[I]:w;qfe(s,L,F,i,a,y);for(let Y=L;Y<F;Y++){a[Y]-y[0]/2;const k=s[Y],M=i[k]?.layoutOffsetY||0;u[Y]=v+y[1]/2+M,h[Y]=y[0]}v=v+y[1]*e,g[0]=Math.max(g[0],y[0])}T=w}S===`
`&&(a[T]=0,u[T]=0,h[T]=0,T++)}return g[1]=v,{x:a,y:u,rowWidth:h,size:g}}function Yfe({value:n,length:e,stride:t,offset:r,startIndices:i,characterSet:s}){const o=n.BYTES_PER_ELEMENT,a=t?t/o:1,u=r?r/o:0,h=i[e]||Math.ceil((n.length-u)/a),d=s&&new Set,g=new Array(e);let y=n;if(a>1||u>0){const v=n.constructor;y=new v(h);for(let T=0;T<h;T++)y[T]=n[T*a+u]}for(let v=0;v<e;v++){const T=i[v],w=i[v+1]||h,E=y.subarray(T,w);g[v]=String.fromCodePoint.apply(null,E),d&&E.forEach(d.add,d)}if(d)for(const v of d)s.add(String.fromCodePoint(v));return{texts:g,characterCount:h}}class eF{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){const t=this._cache[e];return t&&(this._deleteOrder(e),this._appendOrder(e)),t}set(e,t){this._cache[e]?(this.delete(e),this._cache[e]=t,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=t,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const t=this._order.indexOf(e);t>=0&&this._order.splice(t,1)}_appendOrder(e){this._order.push(e)}}function Kfe(){const n=[];for(let e=32;e<128;e++)n.push(String.fromCharCode(e));return n}const Hu={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:Kfe(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},oO=1024,aO=.9,lO=1.2,tF=3;let b_=new eF(tF);function Gfe(n,e){let t;typeof e=="string"?t=new Set(Array.from(e)):t=new Set(e);const r=b_.get(n);if(!r)return t;for(const i in r.mapping)t.has(i)&&t.delete(i);return t}function Zfe(n,e){for(let t=0;t<n.length;t++)e.data[4*t+3]=n[t]}function cO(n,e,t,r){n.font=`${r} ${t}px ${e}`,n.fillStyle="#000",n.textBaseline="alphabetic",n.textAlign="left"}function Qfe(n){at.assert(Number.isFinite(n)&&n>=tF,"Invalid cache limit"),b_=new eF(n)}class Jfe{constructor(){this.props={...Hu}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:t}=this.props;return(e*lO+t*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const t=Gfe(this._key,this.props.characterSet),r=b_.get(this._key);if(r&&t.size===0){this._atlas!==r&&(this._atlas=r);return}const i=this._generateFontAtlas(t,r);this._atlas=i,b_.set(this._key,i)}_generateFontAtlas(e,t){const{fontFamily:r,fontWeight:i,fontSize:s,buffer:o,sdf:a,radius:u,cutoff:h}=this.props;let d=t&&t.data;d||(d=document.createElement("canvas"),d.width=oO);const g=d.getContext("2d",{willReadFrequently:!0});cO(g,r,s,i);const{mapping:y,canvasHeight:v,xOffset:T,yOffset:w}=Hfe({getFontWidth:E=>g.measureText(E).width,fontHeight:s*lO,buffer:o,characterSet:e,maxCanvasWidth:oO,...t&&{mapping:t.mapping,xOffset:t.xOffset,yOffset:t.yOffset}});if(d.height!==v){const E=g.getImageData(0,0,d.width,d.height);d.height=v,g.putImageData(E,0,0)}if(cO(g,r,s,i),a){const E=new Ffe({fontSize:s,buffer:o,radius:u,cutoff:h,fontFamily:r,fontWeight:`${i}`});for(const S of e){const{data:P,width:I,height:L,glyphTop:F}=E.draw(S);y[S].width=I,y[S].layoutOffsetY=s*aO-F;const Y=g.createImageData(I,L);Zfe(P,Y),g.putImageData(Y,y[S].x,y[S].y)}}else for(const E of e)g.fillText(E,y[E].x,y[E].y+o+s*aO);return{xOffset:T,yOffset:w,mapping:y,data:d,width:d.width,height:d.height}}_getKey(){const{fontFamily:e,fontWeight:t,fontSize:r,buffer:i,sdf:s,radius:o,cutoff:a}=this.props;return s?`${e} ${t} ${r} ${i} ${o} ${a}`:`${e} ${t} ${r} ${i}`}}const uO=`uniform textBackgroundUniforms {
  bool billboard;
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  vec4 borderRadius;
  vec4 padding;
  highp int sizeUnits;
  bool stroked;
} textBackground;
`,ede={name:"textBackground",vs:uO,fs:uO,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",borderRadius:"vec4<f32>",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}},tde=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),
textBackground.sizeMinPixels, textBackground.sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (textBackground.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,nde=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
float round_rect(vec2 p, vec2 size, vec4 radii) {
vec2 pixelPositionCB = (p - 0.5) * size;
vec2 sizeCB = size * 0.5;
float maxBorderRadius = min(size.x, size.y) * 0.5;
vec4 borderRadius = vec4(min(radii, maxBorderRadius));
borderRadius.xy =
(pixelPositionCB.x > 0.0) ? borderRadius.xy : borderRadius.zw;
borderRadius.x = (pixelPositionCB.y > 0.0) ? borderRadius.x : borderRadius.y;
vec2 q = abs(pixelPositionCB) - sizeCB + borderRadius.x;
return -(min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - borderRadius.x);
}
float rect(vec2 p, vec2 size) {
vec2 pixelPosition = p * size;
return min(min(pixelPosition.x, size.x - pixelPosition.x),
min(pixelPosition.y, size.y - pixelPosition.y));
}
vec4 get_stroked_fragColor(float dist) {
float isBorder = smoothedge(dist, vLineWidth);
return mix(vFillColor, vLineColor, isBorder);
}
void main(void) {
geometry.uv = uv;
if (textBackground.borderRadius != vec4(0.0)) {
float distToEdge = round_rect(uv, dimensions, textBackground.borderRadius);
if (textBackground.stroked) {
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
float shapeAlpha = smoothedge(-distToEdge, 0.0);
fragColor.a *= shapeAlpha;
} else {
if (textBackground.stroked) {
float distToEdge = rect(uv, dimensions);
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,rde={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,borderRadius:{type:"object",value:0},padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:n=>n.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class aA extends ys{getShaders(){return super.getShaders({vs:tde,fs:nde,modules:[Ph,Mh,ede]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);const{changeFlags:t}=e;t.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{billboard:t,sizeScale:r,sizeUnits:i,sizeMinPixels:s,sizeMaxPixels:o,getLineWidth:a}=this.props;let{padding:u,borderRadius:h}=this.props;u.length<4&&(u=[u[0],u[1],u[0],u[1]]),Array.isArray(h)||(h=[h,h,h,h]);const d=this.state.model,g={billboard:t,stroked:!!a,borderRadius:h,padding:u,sizeUnits:oo[i],sizeScale:r,sizeMinPixels:s,sizeMaxPixels:o};d.shaderInputs.setProps({textBackground:g}),d.draw(this.context.renderPass)}_getModel(){const e=[0,0,1,0,0,1,1,1];return new si(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ch({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}}aA.defaultProps=rde;aA.layerName="TextBackgroundLayer";const hO={start:1,middle:0,end:-1},fO={top:1,center:0,bottom:-1},UT=[0,0,0,255],ide=1,sde={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:UT},getBorderWidth:{type:"accessor",value:0},backgroundBorderRadius:{type:"object",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Hu.characterSet},fontFamily:Hu.fontFamily,fontWeight:Hu.fontWeight,lineHeight:ide,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:UT},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:n=>n.text},getPosition:{type:"accessor",value:n=>n.position},getColor:{type:"accessor",value:UT},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class lA extends fv{constructor(){super(...arguments),this.getBoundingRect=(e,t)=>{let{size:[r,i]}=this.transformParagraph(e,t);const{fontSize:s}=this.state.fontAtlasManager.props;r/=s,i/=s;const{getTextAnchor:o,getAlignmentBaseline:a}=this.props,u=hO[typeof o=="function"?o(e,t):o],h=fO[typeof a=="function"?a(e,t):a];return[(u-1)*r/2,(h-1)*i/2,r,i]},this.getIconOffsets=(e,t)=>{const{getTextAnchor:r,getAlignmentBaseline:i}=this.props,{x:s,y:o,rowWidth:a,size:[u,h]}=this.transformParagraph(e,t),d=hO[typeof r=="function"?r(e,t):r],g=fO[typeof i=="function"?i(e,t):i],y=s.length,v=new Array(y*2);let T=0;for(let w=0;w<y;w++){const E=(1-d)*(u-a[w])/2;v[T++]=(d-1)*u/2+E+s[w],v[T++]=(g-1)*h/2+o[w]}return v}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new Jfe},this.props.maxWidth>0&&at.once(1,"v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:t,oldProps:r,changeFlags:i}=e;(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||t.lineHeight!==r.lineHeight||t.wordBreak!==r.wordBreak||t.maxWidth!==r.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:t,fontWeight:r}=this.props,{fontAtlasManager:i,characterSet:s}=this.state,o={...e,characterSet:s,fontFamily:t,fontWeight:r};if(!i.mapping)return i.setProps(o),!0;for(const a in o)if(o[a]!==i.props[a])return i.setProps(o),!0;return!1}_updateText(){const{data:e,characterSet:t}=this.props,r=e.attributes?.getText;let{getText:i}=this.props,s=e.startIndices,o;const a=t==="auto"&&new Set;if(r&&s){const{texts:u,characterCount:h}=Yfe({...ArrayBuffer.isView(r)?{value:r}:r,length:e.length,startIndices:s,characterSet:a});o=h,i=(d,{index:g})=>u[g]}else{const{iterable:u,objectInfo:h}=uv(e);s=[0],o=0;for(const d of u){h.index++;const g=Array.from(i(d,h)||"");a&&g.forEach(a.add,a),o+=g.length,s.push(o)}}this.setState({getText:i,startIndices:s,numInstances:o,characterSet:a||t})}transformParagraph(e,t){const{fontAtlasManager:r}=this.state,i=r.mapping,s=this.state.getText,{wordBreak:o,lineHeight:a,maxWidth:u}=this.props,h=s(e,t)||"";return Xfe(h,a,o,u*r.props.fontSize,i)}renderLayers(){const{startIndices:e,numInstances:t,getText:r,fontAtlasManager:{scale:i,atlas:s,mapping:o},styleVersion:a}=this.state,{data:u,_dataDiff:h,getPosition:d,getColor:g,getSize:y,getAngle:v,getPixelOffset:T,getBackgroundColor:w,getBorderColor:E,getBorderWidth:S,backgroundBorderRadius:P,backgroundPadding:I,background:L,billboard:F,fontSettings:Y,outlineWidth:k,outlineColor:M,sizeScale:N,sizeUnits:H,sizeMinPixels:q,sizeMaxPixels:K,transitions:j,updateTriggers:de}=this.props,Ee=this.getSubLayerClass("characters",oA),O=this.getSubLayerClass("background",aA);return[L&&new O({getFillColor:w,getLineColor:E,getLineWidth:S,borderRadius:P,padding:I,getPosition:d,getSize:y,getAngle:v,getPixelOffset:T,billboard:F,sizeScale:N,sizeUnits:H,sizeMinPixels:q,sizeMaxPixels:K,transitions:j&&{getPosition:j.getPosition,getAngle:j.getAngle,getSize:j.getSize,getFillColor:j.getBackgroundColor,getLineColor:j.getBorderColor,getLineWidth:j.getBorderWidth,getPixelOffset:j.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:de.getPosition,getAngle:de.getAngle,getSize:de.getSize,getFillColor:de.getBackgroundColor,getLineColor:de.getBorderColor,getLineWidth:de.getBorderWidth,getPixelOffset:de.getPixelOffset,getBoundingRect:{getText:de.getText,getTextAnchor:de.getTextAnchor,getAlignmentBaseline:de.getAlignmentBaseline,styleVersion:a}}}),{data:u.attributes&&u.attributes.background?{length:u.length,attributes:u.attributes.background}:u,_dataDiff:h,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new Ee({sdf:Y.sdf,smoothing:Number.isFinite(Y.smoothing)?Y.smoothing:Hu.smoothing,outlineWidth:k/(Y.radius||Hu.radius),outlineColor:M,iconAtlas:s,iconMapping:o,getPosition:d,getColor:g,getSize:y,getAngle:v,getPixelOffset:T,billboard:F,sizeScale:N*i,sizeUnits:H,sizeMinPixels:q*i,sizeMaxPixels:K*i,transitions:j&&{getPosition:j.getPosition,getAngle:j.getAngle,getColor:j.getColor,getSize:j.getSize,getPixelOffset:j.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:de.getText,getPosition:de.getPosition,getAngle:de.getAngle,getColor:de.getColor,getSize:de.getSize,getPixelOffset:de.getPixelOffset,getIconOffsets:{getTextAnchor:de.getTextAnchor,getAlignmentBaseline:de.getAlignmentBaseline,styleVersion:a}}}),{data:u,_dataDiff:h,startIndices:e,numInstances:t,getIconOffsets:this.getIconOffsets,getIcon:r})]}static set fontAtlasCacheLimit(e){Qfe(e)}}lA.defaultProps=sde;lA.layerName="TextLayer";const vy={circle:{type:rA,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:On,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:lA,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},by={type:iA,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},bx={type:sA,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function Gf({type:n,props:e}){const t={};for(const r in e)t[r]=n.defaultProps[e[r]];return t}function VT(n,e){const{transitions:t,updateTriggers:r}=n.props,i={updateTriggers:{},transitions:t&&{getPosition:t.geometry}};for(const s in e){const o=e[s];let a=n.props[s];s.startsWith("get")&&(a=n.getSubLayerAccessor(a),i.updateTriggers[o]=r[s],t&&(i.transitions[o]=t[s])),i[o]=a}return i}function ode(n){if(Array.isArray(n))return n;switch(at.assert(n.type,"GeoJSON does not have type"),n.type){case"Feature":return[n];case"FeatureCollection":return at.assert(Array.isArray(n.features),"GeoJSON does not have features array"),n.features;default:return[{geometry:n}]}}function dO(n,e,t={}){const r={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:i=0,endRow:s=n.length}=t;for(let o=i;o<s;o++){const a=n[o],{geometry:u}=a;if(u)if(u.type==="GeometryCollection"){at.assert(Array.isArray(u.geometries),"GeoJSON does not have geometries array");const{geometries:h}=u;for(let d=0;d<h.length;d++){const g=h[d];pO(g,r,e,a,o)}}else pO(u,r,e,a,o)}return r}function pO(n,e,t,r,i){const{type:s,coordinates:o}=n,{pointFeatures:a,lineFeatures:u,polygonFeatures:h,polygonOutlineFeatures:d}=e;if(!lde(s,o)){at.warn(`${s} coordinates are malformed`)();return}switch(s){case"Point":a.push(t({geometry:n},r,i));break;case"MultiPoint":o.forEach(g=>{a.push(t({geometry:{type:"Point",coordinates:g}},r,i))});break;case"LineString":u.push(t({geometry:n},r,i));break;case"MultiLineString":o.forEach(g=>{u.push(t({geometry:{type:"LineString",coordinates:g}},r,i))});break;case"Polygon":h.push(t({geometry:n},r,i)),o.forEach(g=>{d.push(t({geometry:{type:"LineString",coordinates:g}},r,i))});break;case"MultiPolygon":o.forEach(g=>{h.push(t({geometry:{type:"Polygon",coordinates:g}},r,i)),g.forEach(y=>{d.push(t({geometry:{type:"LineString",coordinates:y}},r,i))})});break}}const ade={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function lde(n,e){let t=ade[n];for(at.assert(t,`Unknown GeoJSON type ${n}`);e&&--t>0;)e=e[0];return e&&Number.isFinite(e[0])}function nF(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function Lm(n){return n.geometry.coordinates}function cde(n,e){const t=nF(),{pointFeatures:r,lineFeatures:i,polygonFeatures:s,polygonOutlineFeatures:o}=n;return t.points.data=r,t.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),t.points.getPosition=Lm,t.lines.data=i,t.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),t.lines.getPath=Lm,t.polygons.data=s,t.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),t.polygons.getPolygon=Lm,t.polygonsOutline.data=o,t.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),t.polygonsOutline.getPath=Lm,t}function ude(n,e){const t=nF(),{points:r,lines:i,polygons:s}=n,o=Dfe(n,e);return t.points.data={length:r.positions.value.length/r.positions.size,attributes:{...r.attributes,getPosition:r.positions,instancePickingColors:{size:4,value:o.points}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},t.lines.data={length:i.pathIndices.value.length-1,startIndices:i.pathIndices.value,attributes:{...i.attributes,getPath:i.positions,instancePickingColors:{size:4,value:o.lines}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},t.lines._pathType="open",t.polygons.data={length:s.polygonIndices.value.length-1,startIndices:s.polygonIndices.value,attributes:{...s.attributes,getPolygon:s.positions,pickingColors:{size:4,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},t.polygons._normalize=!1,s.triangles&&(t.polygons.data.attributes.indices=s.triangles.value),t.polygonsOutline.data={length:s.primitivePolygonIndices.value.length-1,startIndices:s.primitivePolygonIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:4,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},t.polygonsOutline._pathType="open",t}const hde=["points","linestrings","polygons"],fde={...Gf(vy.circle),...Gf(vy.icon),...Gf(vy.text),...Gf(by),...Gf(bx),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:n=>n.properties.icon},getText:{type:"accessor",value:n=>n.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class cA extends fv{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:t}){if(!t.dataChanged)return;const{data:r}=this.props,i=r&&"points"in r&&"polygons"in r&&"lines"in r;this.setState({binary:i}),i?this._updateStateBinary({props:e,changeFlags:t}):this._updateStateJSON({props:e,changeFlags:t})}_updateStateBinary({props:e,changeFlags:t}){const r=ude(e.data,this.encodePickingColor);this.setState({layerProps:r})}_updateStateJSON({props:e,changeFlags:t}){const r=ode(e.data),i=this.getSubLayerRow.bind(this);let s={};const o={};if(Array.isArray(t.dataChanged)){const u=this.state.features;for(const h in u)s[h]=u[h].slice(),o[h]=[];for(const h of t.dataChanged){const d=dO(r,i,h);for(const g in u)o[g].push(Ofe({data:s[g],getIndex:y=>y.__source.index,dataRange:h,replace:d[g]}))}}else s=dO(r,i);const a=cde(s,o);this.setState({features:s,featuresDiff:o,layerProps:a})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:r,sourceLayer:i}=t;return t.featureType=hde.find(s=>i.id.startsWith(`${this.id}-${s}-`)),r>=0&&i.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(t.index=this.props.data.points.globalFeatureIds.value[r]),t}_updateAutoHighlight(e){const t=`${this.id}-points-`,r=e.featureType==="points";for(const i of this.getSubLayers())i.id.startsWith(t)===r&&i.updateAutoHighlight(e)}_renderPolygonLayer(){const{extruded:e,wireframe:t}=this.props,{layerProps:r}=this.state,i="polygons-fill",s=this.shouldRenderSubLayer(i,r.polygons?.data)&&this.getSubLayerClass(i,bx.type);if(s){const o=VT(this,bx.props),a=e&&t;return a||delete o.getLineColor,o.updateTriggers.lineColors=a,new s(o,this.getSubLayerProps({id:i,updateTriggers:o.updateTriggers}),r.polygons)}return null}_renderLineLayers(){const{extruded:e,stroked:t}=this.props,{layerProps:r}=this.state,i="polygons-stroke",s="linestrings",o=!e&&t&&this.shouldRenderSubLayer(i,r.polygonsOutline?.data)&&this.getSubLayerClass(i,by.type),a=this.shouldRenderSubLayer(s,r.lines?.data)&&this.getSubLayerClass(s,by.type);if(o||a){const u=VT(this,by.props);return[o&&new o(u,this.getSubLayerProps({id:i,updateTriggers:u.updateTriggers}),r.polygonsOutline),a&&new a(u,this.getSubLayerProps({id:s,updateTriggers:u.updateTriggers}),r.lines)]}return null}_renderPointLayers(){const{pointType:e}=this.props,{layerProps:t,binary:r}=this.state;let{highlightedObjectIndex:i}=this.props;!r&&Number.isFinite(i)&&(i=t.points.data.findIndex(a=>a.__source.index===i));const s=new Set(e.split("+")),o=[];for(const a of s){const u=`points-${a}`,h=vy[a],d=h&&this.shouldRenderSubLayer(u,t.points?.data)&&this.getSubLayerClass(u,h.type);if(d){const g=VT(this,h.props);let y=t.points;if(a==="text"&&r){const{instancePickingColors:v,...T}=y.data.attributes;y={...y,data:{...y.data,attributes:T}}}o.push(new d(g,this.getSubLayerProps({id:u,updateTriggers:g.updateTriggers,highlightedObjectIndex:i}),y))}}return o}renderLayers(){const{extruded:e}=this.props,t=this._renderPolygonLayer(),r=this._renderLineLayers(),i=this._renderPointLayers();return[!e&&t,r,i,e&&t]}getSubLayerAccessor(e){const{binary:t}=this.state;return!t||typeof e!="function"?super.getSubLayerAccessor(e):(r,i)=>{const{data:s,index:o}=i,a=kfe(s,o);return e(a,i)}}}cA.layerName="GeoJsonLayer";cA.defaultProps=fde;class dde{constructor(e){this.index=e,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(e){this._bbox||(this._bbox=e,"west"in e?this.boundingBox=[[e.west,e.south],[e.east,e.north]]:this.boundingBox=[[e.left,e.top],[e.right,e.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return!!this._loader&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const e=this.content?this.content.byteLength:0;return Number.isFinite(e)||console.error("byteLength not defined in tile data"),e}async _loadData({getData:e,requestScheduler:t,onLoad:r,onError:i}){const{index:s,id:o,bbox:a,userData:u,zoom:h}=this,d=this._loaderId;this._abortController=new AbortController;const{signal:g}=this._abortController,y=await t.scheduleRequest(this,w=>w.isSelected?1:-1);if(!y){this._isCancelled=!0;return}if(this._isCancelled){y.done();return}let v=null,T;try{v=await e({index:s,id:o,bbox:a,userData:u,zoom:h,signal:g})}catch(w){T=w||!0}finally{y.done()}if(d===this._loaderId){if(this._loader=void 0,this.content=v,this._isCancelled&&!v){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,T?i(T,this):r(this)}}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){this.isLoaded||(this._isCancelled=!0,this._abortController?.abort())}}const er={OUTSIDE:-1,INTERSECTING:0,INSIDE:1},gO=new Pe,pde=new Pe;class uA{constructor(e=[0,0,0],t=[0,0,0],r){r=r||gO.copy(e).add(t).scale(.5),this.center=new Pe(r),this.halfDiagonal=new Pe(t).subtract(this.center),this.minimum=new Pe(e),this.maximum=new Pe(t)}clone(){return new uA(this.minimum,this.maximum,this.center)}equals(e){return this===e||!!e&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){const{halfDiagonal:t}=this,r=pde.from(e.normal),i=t.x*Math.abs(r.x)+t.y*Math.abs(r.y)+t.z*Math.abs(r.z),s=this.center.dot(r)+e.distance;return s-i>0?er.INSIDE:s+i<0?er.OUTSIDE:er.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=gO.from(e).subtract(this.center),{halfDiagonal:r}=this;let i=0,s;return s=Math.abs(t.x)-r.x,s>0&&(i+=s*s),s=Math.abs(t.y)-r.y,s>0&&(i+=s*s),s=Math.abs(t.z)-r.z,s>0&&(i+=s*s),i}}const Zf=new Pe,mO=new Pe;class hA{constructor(e=[0,0,0],t=0){this.radius=-0,this.center=new Pe,this.fromCenterRadius(e,t)}fromCenterRadius(e,t){return this.center.from(e),this.radius=t,this}fromCornerPoints(e,t){return t=Zf.from(t),this.center=new Pe().from(e).add(t).scale(.5),this.radius=this.center.distance(t),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new hA(this.center,this.radius)}union(e){const t=this.center,r=this.radius,i=e.center,s=e.radius,o=Zf.copy(i).subtract(t),a=o.magnitude();if(r>=a+s)return this.clone();if(s>=a+r)return e.clone();const u=(r+a+s)*.5;return mO.copy(o).scale((-r+u)/a).add(t),this.center.copy(mO),this.radius=u,this}expand(e){const r=Zf.from(e).subtract(this.center).magnitude();return r>this.radius&&(this.radius=r),this}transform(e){this.center.transform(e);const t=mre(Zf,e);return this.radius=Math.max(t[0],Math.max(t[1],t[2]))*this.radius,this}distanceSquaredTo(e){const t=this.distanceTo(e);return t*t}distanceTo(e){const r=Zf.from(e).subtract(this.center);return Math.max(0,r.len()-this.radius)}intersectPlane(e){const t=this.center,r=this.radius,s=e.normal.dot(t)+e.distance;return s<-r?er.OUTSIDE:s<r?er.INTERSECTING:er.INSIDE}}const gde=new Pe,mde=new Pe,Um=new Pe,Vm=new Pe,Fm=new Pe,yde=new Pe,_de=new Pe,zs={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class fA{constructor(e=[0,0,0],t=[0,0,0,0,0,0,0,0,0]){this.center=new Pe().from(e),this.halfAxes=new jn(t)}get halfSize(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2);return[new Pe(e).len(),new Pe(t).len(),new Pe(r).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2),i=new Pe(e).normalize(),s=new Pe(t).normalize(),o=new Pe(r).normalize();return new RP().fromMatrix3(new jn([...i,...s,...o]))}fromCenterHalfSizeQuaternion(e,t,r){const i=new RP(r),s=new jn().fromQuaternion(i);return s[0]=s[0]*t[0],s[1]=s[1]*t[0],s[2]=s[2]*t[0],s[3]=s[3]*t[1],s[4]=s[4]*t[1],s[5]=s[5]*t[1],s[6]=s[6]*t[2],s[7]=s[7]*t[2],s[8]=s[8]*t[2],this.center=new Pe().from(e),this.halfAxes=s,this}clone(){return new fA(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new hA){const t=this.halfAxes,r=t.getColumn(0,Um),i=t.getColumn(1,Vm),s=t.getColumn(2,Fm),o=gde.copy(r).add(i).add(s);return e.center.copy(this.center),e.radius=o.magnitude(),e}intersectPlane(e){const t=this.center,r=e.normal,i=this.halfAxes,s=r.x,o=r.y,a=r.z,u=Math.abs(s*i[zs.COLUMN0ROW0]+o*i[zs.COLUMN0ROW1]+a*i[zs.COLUMN0ROW2])+Math.abs(s*i[zs.COLUMN1ROW0]+o*i[zs.COLUMN1ROW1]+a*i[zs.COLUMN1ROW2])+Math.abs(s*i[zs.COLUMN2ROW0]+o*i[zs.COLUMN2ROW1]+a*i[zs.COLUMN2ROW2]),h=r.dot(t)+e.distance;return h<=-u?er.OUTSIDE:h>=u?er.INSIDE:er.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=mde.from(e).subtract(this.center),r=this.halfAxes,i=r.getColumn(0,Um),s=r.getColumn(1,Vm),o=r.getColumn(2,Fm),a=i.magnitude(),u=s.magnitude(),h=o.magnitude();i.normalize(),s.normalize(),o.normalize();let d=0,g;return g=Math.abs(t.dot(i))-a,g>0&&(d+=g*g),g=Math.abs(t.dot(s))-u,g>0&&(d+=g*g),g=Math.abs(t.dot(o))-h,g>0&&(d+=g*g),d}computePlaneDistances(e,t,r=[-0,-0]){let i=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;const o=this.center,a=this.halfAxes,u=a.getColumn(0,Um),h=a.getColumn(1,Vm),d=a.getColumn(2,Fm),g=yde.copy(u).add(h).add(d).add(o),y=_de.copy(g).subtract(e);let v=t.dot(y);return i=Math.min(v,i),s=Math.max(v,s),g.copy(o).add(u).add(h).subtract(d),y.copy(g).subtract(e),v=t.dot(y),i=Math.min(v,i),s=Math.max(v,s),g.copy(o).add(u).subtract(h).add(d),y.copy(g).subtract(e),v=t.dot(y),i=Math.min(v,i),s=Math.max(v,s),g.copy(o).add(u).subtract(h).subtract(d),y.copy(g).subtract(e),v=t.dot(y),i=Math.min(v,i),s=Math.max(v,s),o.copy(g).subtract(u).add(h).add(d),y.copy(g).subtract(e),v=t.dot(y),i=Math.min(v,i),s=Math.max(v,s),o.copy(g).subtract(u).add(h).subtract(d),y.copy(g).subtract(e),v=t.dot(y),i=Math.min(v,i),s=Math.max(v,s),o.copy(g).subtract(u).subtract(h).add(d),y.copy(g).subtract(e),v=t.dot(y),i=Math.min(v,i),s=Math.max(v,s),o.copy(g).subtract(u).subtract(h).subtract(d),y.copy(g).subtract(e),v=t.dot(y),i=Math.min(v,i),s=Math.max(v,s),r[0]=i,r[1]=s,r}transform(e){this.center.transformAsPoint(e);const t=this.halfAxes.getColumn(0,Um);t.transformAsPoint(e);const r=this.halfAxes.getColumn(1,Vm);r.transformAsPoint(e);const i=this.halfAxes.getColumn(2,Fm);return i.transformAsPoint(e),this.halfAxes=new jn([...t,...r,...i]),this}getTransform(){throw new Error("not implemented")}}const yO=new Pe,_O=new Pe;class np{constructor(e=[0,0,1],t=0){this.normal=new Pe,this.distance=-0,this.fromNormalDistance(e,t)}fromNormalDistance(e,t){return Zd(Number.isFinite(t)),this.normal.from(e).normalize(),this.distance=t,this}fromPointNormal(e,t){e=yO.from(e),this.normal.from(t).normalize();const r=-this.normal.dot(e);return this.distance=r,this}fromCoefficients(e,t,r,i){return this.normal.set(e,t,r),Zd(Zs(this.normal.len(),1)),this.distance=i,this}clone(){return new np(this.normal,this.distance)}equals(e){return Zs(this.distance,e.distance)&&Zs(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const t=_O.copy(this.normal).transformAsVector(e).normalize(),r=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(r,t)}projectPointOntoPlane(e,t=[0,0,0]){const r=yO.from(e),i=this.getPointDistance(r),s=_O.copy(this.normal).scale(i);return r.subtract(s).to(t)}}const vO=[new Pe([1,0,0]),new Pe([0,1,0]),new Pe([0,0,1])],bO=new Pe,vde=new Pe;class Xs{constructor(e=[]){this.planes=e}fromBoundingSphere(e){this.planes.length=2*vO.length;const t=e.center,r=e.radius;let i=0;for(const s of vO){let o=this.planes[i],a=this.planes[i+1];o||(o=this.planes[i]=new np),a||(a=this.planes[i+1]=new np);const u=bO.copy(s).scale(-r).add(t);o.fromPointNormal(u,s);const h=bO.copy(s).scale(r).add(t),d=vde.copy(s).negate();a.fromPointNormal(h,d),i+=2}return this}computeVisibility(e){let t=er.INSIDE;for(const r of this.planes)switch(e.intersectPlane(r)){case er.OUTSIDE:return er.OUTSIDE;case er.INTERSECTING:t=er.INTERSECTING;break}return t}computeVisibilityWithPlaneMask(e,t){if(Zd(Number.isFinite(t),"parentPlaneMask is required."),t===Xs.MASK_OUTSIDE||t===Xs.MASK_INSIDE)return t;let r=Xs.MASK_INSIDE;const i=this.planes;for(let s=0;s<this.planes.length;++s){const o=s<31?1<<s:0;if(s<31&&(t&o)===0)continue;const a=i[s],u=e.intersectPlane(a);if(u===er.OUTSIDE)return Xs.MASK_OUTSIDE;u===er.INTERSECTING&&(r|=o)}return r}}Xs.MASK_OUTSIDE=4294967295;Xs.MASK_INSIDE=0;Xs.MASK_INDETERMINATE=2147483647;new Pe;new Pe;new Pe;new Pe;new Pe;new Pe;new Pe;new Pe;new Pe;new Pe;new Pe;new Pe;new Pe;new Pe;new Pe;new Pe;new Pe;const Ki=new jn,bde=new jn,Tde=new jn,Bm=new jn,TO=new jn;function wde(n,e={}){const t=eie,r=10;let i=0,s=0;const o=bde,a=Tde;o.identity(),a.copy(n);const u=t*xde(a);for(;s<r&&Ede(a)>u;)Ade(a,Bm),TO.copy(Bm).transpose(),a.multiplyRight(Bm),a.multiplyLeft(TO),o.multiplyRight(Bm),++i>2&&(++s,i=0);return e.unitary=o.toTarget(e.unitary),e.diagonal=a.toTarget(e.diagonal),e}function xde(n){let e=0;for(let t=0;t<9;++t){const r=n[t];e+=r*r}return Math.sqrt(e)}const Tx=[1,0,0],wx=[2,2,1];function Ede(n){let e=0;for(let t=0;t<3;++t){const r=n[Ki.getElementIndex(wx[t],Tx[t])];e+=2*r*r}return Math.sqrt(e)}function Ade(n,e){const t=Jre;let r=0,i=1;for(let h=0;h<3;++h){const d=Math.abs(n[Ki.getElementIndex(wx[h],Tx[h])]);d>r&&(i=h,r=d)}const s=Tx[i],o=wx[i];let a=1,u=0;if(Math.abs(n[Ki.getElementIndex(o,s)])>t){const h=n[Ki.getElementIndex(o,o)],d=n[Ki.getElementIndex(s,s)],g=n[Ki.getElementIndex(o,s)],y=(h-d)/2/g;let v;y<0?v=-1/(-y+Math.sqrt(1+y*y)):v=1/(y+Math.sqrt(1+y*y)),a=1/Math.sqrt(1+v*v),u=v*a}return jn.IDENTITY.to(e),e[Ki.getElementIndex(s,s)]=e[Ki.getElementIndex(o,o)]=a,e[Ki.getElementIndex(o,s)]=u,e[Ki.getElementIndex(s,o)]=-u,e}const ia=new Pe,Sde=new Pe,Rde=new Pe,Cde=new Pe,Ide=new Pe,Pde=new jn,Mde={diagonal:new jn,unitary:new jn};function Ode(n,e=new fA){if(!n||n.length===0)return e.halfAxes=new jn([0,0,0,0,0,0,0,0,0]),e.center=new Pe,e;const t=n.length,r=new Pe(0,0,0);for(const N of n)r.add(N);const i=1/t;r.multiplyByScalar(i);let s=0,o=0,a=0,u=0,h=0,d=0;for(const N of n){const H=ia.copy(N).subtract(r);s+=H.x*H.x,o+=H.x*H.y,a+=H.x*H.z,u+=H.y*H.y,h+=H.y*H.z,d+=H.z*H.z}s*=i,o*=i,a*=i,u*=i,h*=i,d*=i;const g=Pde;g[0]=s,g[1]=o,g[2]=a,g[3]=o,g[4]=u,g[5]=h,g[6]=a,g[7]=h,g[8]=d;const{unitary:y}=wde(g,Mde),v=e.halfAxes.copy(y);let T=v.getColumn(0,Rde),w=v.getColumn(1,Cde),E=v.getColumn(2,Ide),S=-Number.MAX_VALUE,P=-Number.MAX_VALUE,I=-Number.MAX_VALUE,L=Number.MAX_VALUE,F=Number.MAX_VALUE,Y=Number.MAX_VALUE;for(const N of n)ia.copy(N),S=Math.max(ia.dot(T),S),P=Math.max(ia.dot(w),P),I=Math.max(ia.dot(E),I),L=Math.min(ia.dot(T),L),F=Math.min(ia.dot(w),F),Y=Math.min(ia.dot(E),Y);T=T.multiplyByScalar(.5*(L+S)),w=w.multiplyByScalar(.5*(F+P)),E=E.multiplyByScalar(.5*(Y+I)),e.center.copy(T).add(w).add(E);const k=Sde.set(S-L,P-F,I-Y).multiplyByScalar(.5),M=new jn([k[0],0,0,0,k[1],0,0,0,k[2]]);return e.halfAxes.multiplyRight(M),e}const Cu=512,wO=3,rF=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],iF=rF.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),kde=iF.concat([[.25,.5],[.75,.5]]);class Iu{constructor(e,t,r){this.x=e,this.y=t,this.z=r}get children(){if(!this._children){const e=this.x*2,t=this.y*2,r=this.z+1;this._children=[new Iu(e,t,r),new Iu(e,t+1,r),new Iu(e+1,t,r),new Iu(e+1,t+1,r)]}return this._children}update(e){const{viewport:t,cullingVolume:r,elevationBounds:i,minZ:s,maxZ:o,bounds:a,offset:u,project:h}=e,d=this.getBoundingVolume(i,u,h);if(a&&!this.insideBounds(a)||r.computeVisibility(d)<0)return!1;if(!this.childVisible){let{z:y}=this;if(y<o&&y>=s){const v=d.distanceTo(t.cameraPosition)*t.scale/t.height;y+=Math.floor(Math.log2(v))}if(y>=o)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const y of this.children)y.update(e);return!0}getSelected(e=[]){if(this.selected&&e.push(this),this._children)for(const t of this._children)t.getSelected(e);return e}insideBounds([e,t,r,i]){const s=Math.pow(2,this.z),o=Cu/s;return this.x*o<r&&this.y*o<i&&(this.x+1)*o>e&&(this.y+1)*o>t}getBoundingVolume(e,t,r){if(r){const u=this.z<1?kde:this.z<2?iF:rF,h=[];for(const d of u){const g=Ex(this.x+d[0],this.y+d[1],this.z);g[2]=e[0],h.push(r(g)),e[0]!==e[1]&&(g[2]=e[1],h.push(r(g)))}return Ode(h)}const i=Math.pow(2,this.z),s=Cu/i,o=this.x*s+t*Cu,a=Cu-(this.y+1)*s;return new uA([o,a,e[0]],[o+s,a+s,e[1]])}}function Nde(n,e,t,r){const i=n instanceof ahe&&n.resolution?n.projectPosition:null,s=Object.values(n.getFrustumPlanes()).map(({normal:v,distance:T})=>new np(v.clone().negate(),T)),o=new Xs(s),a=n.distanceScales.unitsPerMeter[2],u=t&&t[0]*a||0,h=t&&t[1]*a||0,d=n instanceof lo&&n.pitch<=60?e:0;if(r){const[v,T,w,E]=r,S=La([v,E]),P=La([w,T]);r=[S[0],Cu-S[1],P[0],Cu-P[1]]}const g=new Iu(0,0,0),y={viewport:n,project:i,cullingVolume:o,elevationBounds:[u,h],minZ:d,maxZ:e,bounds:r,offset:0};if(g.update(y),n instanceof lo&&n.subViewports&&n.subViewports.length>1){for(y.offset=-1;g.update(y)&&!(--y.offset<-wO););for(y.offset=1;g.update(y)&&!(++y.offset>wO););}return g.getSelected()}const co=512,Dde=[-1/0,-1/0,1/0,1/0],Lde={equal:(n,e)=>{if(n===e)return!0;if(!Array.isArray(n)||!Array.isArray(e))return!1;const t=n.length;if(t!==e.length)return!1;for(let r=0;r<t;r++)if(n[r]!==e[r])return!1;return!0}};function sF(n,e){const t=[e.transformAsPoint([n[0],n[1]]),e.transformAsPoint([n[2],n[1]]),e.transformAsPoint([n[0],n[3]]),e.transformAsPoint([n[2],n[3]])];return[Math.min(...t.map(i=>i[0])),Math.min(...t.map(i=>i[1])),Math.max(...t.map(i=>i[0])),Math.max(...t.map(i=>i[1]))]}function Ude(n){return Math.abs(n.split("").reduce((e,t)=>(e<<5)-e+t.charCodeAt(0)|0,0))}function Vde(n,e){if(!n||!n.length)return null;const{index:t,id:r}=e;if(Array.isArray(n)){const s=Ude(r)%n.length;n=n[s]}let i=n;for(const s of Object.keys(t)){const o=new RegExp(`{${s}}`,"g");i=i.replace(o,String(t[s]))}return Number.isInteger(t.y)&&Number.isInteger(t.z)&&(i=i.replace(/\{-y\}/g,String(Math.pow(2,t.z)-t.y-1))),i}function Fde(n,e,t){let r;return r=n.getBounds(),n.isGeospatial?[Math.max(r[0],t[0]),Math.max(r[1],t[1]),Math.min(r[2],t[2]),Math.min(r[3],t[3])]:[Math.max(Math.min(r[0],t[2]),t[0]),Math.max(Math.min(r[1],t[3]),t[1]),Math.min(Math.max(r[2],t[0]),t[2]),Math.min(Math.max(r[3],t[1]),t[3])]}function Bde({viewport:n,z:e,cullRect:t}){return(n.subViewports||[n]).map(i=>xx(i,e||0,t))}function xx(n,e,t){if(!Array.isArray(e)){const s=t.x-n.x,o=t.y-n.y,{width:a,height:u}=t,h={targetZ:e},d=n.unproject([s,o],h),g=n.unproject([s+a,o],h),y=n.unproject([s,o+u],h),v=n.unproject([s+a,o+u],h);return[Math.min(d[0],g[0],y[0],v[0]),Math.min(d[1],g[1],y[1],v[1]),Math.max(d[0],g[0],y[0],v[0]),Math.max(d[1],g[1],y[1],v[1])]}const r=xx(n,e[0],t),i=xx(n,e[1],t);return[Math.min(r[0],i[0]),Math.min(r[1],i[1]),Math.max(r[2],i[2]),Math.max(r[3],i[3])]}function zde(n,e,t){return t?sF(n,t).map(i=>i*e/co):n.map(r=>r*e/co)}function dA(n,e){return Math.pow(2,n)*co/e}function Ex(n,e,t){const r=dA(t,co),i=n/r*360-180,s=Math.PI-2*Math.PI*e/r,o=180/Math.PI*Math.atan(.5*(Math.exp(s)-Math.exp(-s)));return[i,o]}function xO(n,e,t,r){const i=dA(t,r);return[n/i*co,e/i*co]}function jde(n,e,t,r,i=co){if(n.isGeospatial){const[h,d]=Ex(e,t,r),[g,y]=Ex(e+1,t+1,r);return{west:h,north:d,east:g,south:y}}const[s,o]=xO(e,t,r,i),[a,u]=xO(e+1,t+1,r,i);return{left:s,top:o,right:a,bottom:u}}function Hde(n,e,t,r,i){const s=Fde(n,null,r),o=dA(e,t),[a,u,h,d]=zde(s,o,i),g=[];for(let y=Math.floor(a);y<h;y++)for(let v=Math.floor(u);v<d;v++)g.push({x:y,y:v,z:e});return g}function $de({viewport:n,maxZoom:e,minZoom:t,zRange:r,extent:i,tileSize:s=co,modelMatrix:o,modelMatrixInverse:a,zoomOffset:u=0}){let h=n.isGeospatial?Math.round(n.zoom+Math.log2(co/s))+u:Math.ceil(n.zoom)+u;if(typeof t=="number"&&Number.isFinite(t)&&h<t){if(!i)return[];h=t}typeof e=="number"&&Number.isFinite(e)&&h>e&&(h=e);let d=i;return o&&a&&i&&!n.isGeospatial&&(d=sF(i,o)),n.isGeospatial?Nde(n,h,r,i):Hde(n,h,s,d||Dde,a)}function Wde(n){let e={},t;return r=>{for(const i in r)if(!qde(r[i],e[i])){t=n(r),e=r;break}return t}}function qde(n,e){if(n===e)return!0;if(Array.isArray(n)){const t=n.length;if(!e||e.length!==t)return!1;for(let r=0;r<t;r++)if(n[r]!==e[r])return!1;return!0}return!1}const EO=1,pv=2,Xde="never",Yde="no-overlap",pA="best-available",Kde=5,Gde={[pA]:Jde,[Yde]:epe,[Xde]:()=>{}},Zde={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}};class Qde{constructor(e){this._getCullBounds=Wde(Bde),this.opts={...Zde,...e},this.setOptions(this.opts),this.onTileLoad=t=>{this.opts.onTileLoad?.(t),this.opts.maxCacheByteSize!==null&&(this._cacheByteSize+=t.byteLength,this._resizeCache())},this._requestScheduler=new FQ({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new fr,this._modelMatrixInverse=new fr}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(e=>e.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(e=>e.needsReload)}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(const e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const e of this._cache.keys()){const t=this._cache.get(e);!this._selectedTiles||!this._selectedTiles.includes(t)?this._cache.delete(e):t.setNeedsReload()}}update(e,{zRange:t,modelMatrix:r}={zRange:null,modelMatrix:null}){const i=r?new fr(r):new fr,s=!i.equals(this._modelMatrix);if(!this._viewport||!e.equals(this._viewport)||!Zs(this._zRange,t)||s){s&&(this._modelMatrixInverse=i.clone().invert(),this._modelMatrix=i),this._viewport=e,this._zRange=t;const a=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:t,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=a.map(u=>this._getTile(u,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(a=>this._getTile(a.index,!0)));const o=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),o&&this._frameNumber++,this._frameNumber}isTileVisible(e,t){if(!e.isVisible)return!1;if(t&&this._viewport){const r=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:t}),{bbox:i}=e;for(const[s,o,a,u]of r){let h;if("west"in i)h=i.west<a&&i.east>s&&i.south<u&&i.north>o;else{const d=Math.min(i.top,i.bottom),g=Math.max(i.top,i.bottom);h=i.left<a&&i.right>s&&d<u&&g>o}if(h)return!0}return!1}return!0}getTileIndices({viewport:e,maxZoom:t,minZoom:r,zRange:i,modelMatrix:s,modelMatrixInverse:o}){const{tileSize:a,extent:u,zoomOffset:h}=this.opts;return $de({viewport:e,maxZoom:t,minZoom:r,zRange:i,tileSize:a,extent:u,modelMatrix:s,modelMatrixInverse:o,zoomOffset:h})}getTileId(e){return`${e.x}-${e.y}-${e.z}`}getTileZoom(e){return e.z}getTileMetadata(e){const{tileSize:t}=this.opts;return{bbox:jde(this._viewport,e.x,e.y,e.z,t)}}getParentIndex(e){const t=Math.floor(e.x/2),r=Math.floor(e.y/2),i=e.z-1;return{x:t,y:r,z:i}}updateTileStates(){const e=this.opts.refinementStrategy||pA,t=new Array(this._cache.size);let r=0;for(const i of this._cache.values())t[r++]=i.isVisible,i.isSelected=!1,i.isVisible=!1;for(const i of this._selectedTiles)i.isSelected=!0,i.isVisible=!0;(typeof e=="function"?e:Gde[e])(Array.from(this._cache.values())),r=0;for(const i of this._cache.values())if(t[r++]!==i.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:e=0}=this.opts,t=[];let r=0;for(const i of this._cache.values())i.isLoading&&(r++,!i.isSelected&&!i.isVisible&&t.push(i));for(;e>0&&r>e&&t.length>0;)t.shift().abort(),r--}_rebuildTree(){const{_cache:e}=this;for(const t of e.values())t.parent=null,t.children&&(t.children.length=0);for(const t of e.values()){const r=this._getNearestAncestor(t);t.parent=r,r?.children&&r.children.push(t)}}_resizeCache(){const{_cache:e,opts:t}=this,r=t.maxCacheSize??(t.maxCacheByteSize!==null?1/0:Kde*this.selectedTiles.length),i=t.maxCacheByteSize??1/0;if(e.size>r||this._cacheByteSize>i){for(const[o,a]of e)if(!a.isVisible&&!a.isSelected&&(this._cacheByteSize-=t.maxCacheByteSize!==null?a.byteLength:0,e.delete(o),this.opts.onTileUnload?.(a)),e.size<=r&&this._cacheByteSize<=i)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((o,a)=>o.zoom-a.zoom),this._dirty=!1)}_getTile(e,t){const r=this.getTileId(e);let i=this._cache.get(r),s=!1;return!i&&t?(i=new dde(e),Object.assign(i,this.getTileMetadata(i.index)),Object.assign(i,{id:r,zoom:this.getTileZoom(i.index)}),s=!0,this._cache.set(r,i),this._dirty=!0):i&&i.needsReload&&(s=!0),i&&s&&i.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),i}_getNearestAncestor(e){const{_minZoom:t=0}=this;let r=e.index;for(;this.getTileZoom(r)>t;){r=this.getParentIndex(r);const i=this._getTile(r);if(i)return i}return null}}function Jde(n){for(const e of n)e.state=0;for(const e of n)e.isSelected&&!oF(e)&&gA(e);for(const e of n)e.isVisible=!!(e.state&pv)}function epe(n){for(const t of n)t.state=0;for(const t of n)t.isSelected&&oF(t);const e=Array.from(n).sort((t,r)=>t.zoom-r.zoom);for(const t of e)if(t.isVisible=!!(t.state&pv),t.children&&(t.isVisible||t.state&EO))for(const r of t.children)r.state=EO;else t.isSelected&&gA(t)}function oF(n){let e=n;for(;e;){if(e.isLoaded||e.content)return e.state|=pv,!0;e=e.parent}return!1}function gA(n){for(const e of n.children)e.isLoaded||e.content?e.state|=pv:gA(e)}const tpe={TilesetClass:Qde,data:{type:"data",value:[]},dataComparator:Lde.equal,renderSubLayers:{type:"function",value:n=>new cA(n)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:n=>{}},onTileUnload:{type:"function",value:n=>{}},onTileError:{type:"function",value:n=>console.error(n)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:pA,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0};class mA extends fv{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){this.state?.tileset?.finalize()}get isLoaded(){return!!this.state?.tileset?.selectedTiles?.every(e=>e.isLoaded&&e.layers&&e.layers.every(t=>t.isLoaded))}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({changeFlags:e}){let{tileset:t}=this.state;const r=e.propsOrDataChanged||e.updateTriggersChanged,i=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getTileData);t?r&&(t.setOptions(this._getTilesetOptions()),i?t.reloadAll():t.tiles.forEach(s=>{s.layers=null})):(t=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:t})),this._updateTileset()}_getTilesetOptions(){const{tileSize:e,maxCacheSize:t,maxCacheByteSize:r,refinementStrategy:i,extent:s,maxZoom:o,minZoom:a,maxRequests:u,debounceTime:h,zoomOffset:d}=this.props;return{maxCacheSize:t,maxCacheByteSize:r,maxZoom:o,minZoom:a,tileSize:e,refinementStrategy:i,extent:s,maxRequests:u,debounceTime:h,zoomOffset:d,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const e=this.state.tileset,{zRange:t,modelMatrix:r}=this.props,i=e.update(this.context.viewport,{zRange:t,modelMatrix:r}),{isLoaded:s}=e,o=this.state.isLoaded!==s,a=this.state.frameNumber!==i;s&&(o||a)&&this._onViewportLoad(),a&&this.setState({frameNumber:i}),this.state.isLoaded=s}_onViewportLoad(){const{tileset:e}=this.state,{onViewportLoad:t}=this.props;t&&t(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,this.setNeedsUpdate()}_onTileError(e,t){this.props.onTileError(e),t.layers=null,this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){const{data:t,getTileData:r,fetch:i}=this.props,{signal:s}=e;return e.url=typeof t=="string"||Array.isArray(t)?Vde(t,e):null,r?r(e):i&&e.url?i(e.url,{propName:"data",layer:this,signal:s}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo(e){const t=e.sourceLayer,r=t.props.tile,i=e.info;return i.picked&&(i.tile=r),i.sourceTile=r,i.sourceTileSubLayer=t,i}_updateAutoHighlight(e){e.sourceTileSubLayer.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map(e=>{const t=this.getSubLayerPropsByTile(e);if(!(!e.isLoaded&&!e.content))if(e.layers)t&&e.layers[0]&&Object.keys(t).some(r=>e.layers[0].props[r]!==t[r])&&(e.layers=e.layers.map(r=>r.clone(t)));else{const r=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:e.id,updateTriggers:this.props.updateTriggers}),data:e.content,_offset:0,tile:e});e.layers=lv(r,Boolean).map(i=>i.clone({tile:e,...t}))}return e.layers})}filterSubLayer({layer:e,cullRect:t}){const{tile:r}=e.props;return this.state.tileset.isTileVisible(r,t)}}mA.defaultProps=tpe;mA.layerName="TileLayer";const npe=({visible:n=!0}={})=>new mA({id:"osm-layer",data:["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],maxRequests:20,pickable:!1,minZoom:0,maxZoom:19,tileSize:256,zoomOffset:devicePixelRatio===1?-1:0,visible:n,renderSubLayers:e=>{const[[t,r],[i,s]]=e.tile.boundingBox,{data:o,...a}=e;return new nA({...a,image:o,bounds:[t,r,i,s]})}});localStorage.getItem("api_url")||localStorage.setItem("api_url","http://192.168.0.137:5000");const xr=localStorage.getItem("api_url")||"http://192.168.0.137:5000";function rpe({visible:n=!0,viewportBounds:e}={}){const[t,r]=A.useState([]),i=A.useRef(null),s=A.useRef(e),o=A.useCallback(a=>{const u=new URLSearchParams({minLat:a.minLat.toString(),maxLat:a.maxLat.toString(),minLon:a.minLon.toString(),maxLon:a.maxLon.toString(),vesselTypes:"20,21,22,23,24,25,26,27,28,29"});fetch(`${xr}/v1/vessels/position/all?${u}`).then(h=>{if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);return h.json()}).then(h=>r(h)).catch(h=>console.error("Error fetching WIGVessels:",h))},[]);return s.current=e,A.useEffect(()=>{if(!(!n||!e))return i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{s.current&&o(s.current)},500),()=>{i.current&&clearTimeout(i.current)}},[n,e,o]),A.useEffect(()=>{if(!n||!e)return;const a=setInterval(()=>{s.current&&o(s.current)},3e4);return()=>clearInterval(a)},[n,o]),new On({id:"wig-vessel-layer",data:t,visible:n,pickable:!0,getPosition:a=>[a.longitude,a.latitude],getIcon:()=>({url:"/Ship-Icon.png",height:1024,width:720}),getAngle:a=>a.TrueHeading==511?0:360-(a.TrueHeading||0),getSize:40})}function ipe({visible:n=!0,viewportBounds:e}={}){const[t,r]=A.useState([]),i=A.useRef(null),s=A.useRef(e),o=A.useCallback(a=>{const u=new URLSearchParams({minLat:a.minLat.toString(),maxLat:a.maxLat.toString(),minLon:a.minLon.toString(),maxLon:a.maxLon.toString(),vesselTypes:"30"});fetch(`${xr}/v1/vessels/position/all?${u}`).then(h=>{if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);return h.json()}).then(h=>r(h)).catch(h=>console.error("Error fetching Fishing Vessels:",h))},[]);return s.current=e,A.useEffect(()=>{if(!(!n||!e))return i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{s.current&&o(s.current)},250),()=>{i.current&&clearTimeout(i.current)}},[n,e,o]),A.useEffect(()=>{if(!n||!e)return;const a=setInterval(()=>{s.current&&o(s.current)},3e4);return()=>clearInterval(a)},[n,o]),new On({id:"fishing-vessel-layer",data:t,visible:n,pickable:!0,getPosition:a=>[a.Longitude,a.Latitude],getIcon:()=>({url:"/Ship-Icon.png",height:512,width:360}),getAngle:a=>a.TrueHeading==511?0:360-(a.TrueHeading||0),getSize:40})}function spe({visible:n=!0,viewportBounds:e}={}){const[t,r]=A.useState([]),i=A.useRef(null),s=A.useRef(e),o=A.useCallback(a=>{const u=new URLSearchParams({minLat:a.minLat.toString(),maxLat:a.maxLat.toString(),minLon:a.minLon.toString(),maxLon:a.maxLon.toString(),vesselTypes:"31,32"});fetch(`${xr}/v1/vessels/position/all?${u}`).then(h=>{if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);return h.json()}).then(h=>r(h)).catch(h=>console.error("Error fetching Towing Vessels:",h))},[]);return s.current=e,A.useEffect(()=>{if(!(!n||!e))return i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{s.current&&o(s.current)},250),()=>{i.current&&clearTimeout(i.current)}},[n,e,o]),A.useEffect(()=>{if(!n||!e)return;const a=setInterval(()=>{s.current&&o(s.current)},3e4);return()=>clearInterval(a)},[n,o]),new On({id:"towing-vessel-layer",data:t,visible:n,pickable:!0,getPosition:a=>[a.Longitude,a.Latitude],getIcon:()=>({url:"/Ship-Icon.png",height:512,width:360}),getAngle:a=>a.TrueHeading==511?0:360-(a.TrueHeading||0),getSize:40})}function ope({visible:n=!0,viewportBounds:e}={}){const[t,r]=A.useState([]),i=A.useRef(null),s=A.useRef(e),o=A.useCallback(a=>{const u=new URLSearchParams({minLat:a.minLat.toString(),maxLat:a.maxLat.toString(),minLon:a.minLon.toString(),maxLon:a.maxLon.toString(),vesselTypes:"35"});fetch(`${xr}/v1/vessels/position/all?${u}`).then(h=>{if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);return h.json()}).then(h=>r(h)).catch(h=>console.error("Error fetching Military Vessels:",h))},[]);return s.current=e,A.useEffect(()=>{if(!(!n||!e))return i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{s.current&&o(s.current)},250),()=>{i.current&&clearTimeout(i.current)}},[n,e,o]),A.useEffect(()=>{if(!n||!e)return;const a=setInterval(()=>{s.current&&o(s.current)},3e4);return()=>clearInterval(a)},[n,o]),new On({id:"military-vessel-layer",data:t,visible:n,pickable:!0,getPosition:a=>[a.Longitude,a.Latitude],getIcon:()=>({url:"/Ship-Icon.png",height:512,width:360}),getAngle:a=>a.TrueHeading==511?0:360-(a.TrueHeading||0),getSize:40})}function ape({visible:n=!0,viewportBounds:e}={}){const[t,r]=A.useState([]),i=A.useRef(null),s=A.useRef(e),o=A.useCallback(a=>{const u=new URLSearchParams({minLat:a.minLat.toString(),maxLat:a.maxLat.toString(),minLon:a.minLon.toString(),maxLon:a.maxLon.toString(),vesselTypes:"37"});fetch(`${xr}/v1/vessels/position/all?${u}`).then(h=>{if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);return h.json()}).then(h=>r(h)).catch(h=>console.error("Error fetching Pleasure Crafts:",h))},[]);return s.current=e,A.useEffect(()=>{if(!(!n||!e))return i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{s.current&&o(s.current)},250),()=>{i.current&&clearTimeout(i.current)}},[n,e,o]),A.useEffect(()=>{if(!n||!e)return;const a=setInterval(()=>{s.current&&o(s.current)},3e4);return()=>clearInterval(a)},[n,o]),new On({id:"pleasure-craft-layer",data:t,visible:n,pickable:!0,getPosition:a=>[a.Longitude,a.Latitude],getIcon:()=>({url:"/Ship-Icon.png",height:512,width:360}),getAngle:a=>a.TrueHeading==511?0:360-(a.TrueHeading||0),getSize:40})}function lpe({visible:n=!0,viewportBounds:e}={}){const[t,r]=A.useState([]),i=A.useRef(null),s=A.useRef(e),o=A.useCallback(a=>{const u=new URLSearchParams({minLat:a.minLat.toString(),maxLat:a.maxLat.toString(),minLon:a.minLon.toString(),maxLon:a.maxLon.toString(),vesselTypes:"40,41,42,43,44,45,46,47,48,49"});fetch(`${xr}/v1/vessels/position/all?${u}`).then(h=>{if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);return h.json()}).then(h=>r(h)).catch(h=>console.error("Error fetching High Speed Crafts:",h))},[]);return s.current=e,A.useEffect(()=>{if(!(!n||!e))return i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{s.current&&o(s.current)},250),()=>{i.current&&clearTimeout(i.current)}},[n,e,o]),A.useEffect(()=>{if(!n||!e)return;const a=setInterval(()=>{s.current&&o(s.current)},3e4);return()=>clearInterval(a)},[n,o]),new On({id:"hsc-layer",data:t,visible:n,pickable:!0,getPosition:a=>[a.Longitude,a.Latitude],getIcon:()=>({url:"/Ship-Icon.png",height:512,width:360}),getAngle:a=>a.TrueHeading==511?0:360-(a.TrueHeading||0),getSize:40})}function cpe({visible:n=!0,viewportBounds:e}={}){const[t,r]=A.useState([]),i=A.useRef(null),s=A.useRef(e),o=A.useCallback(a=>{const u=new URLSearchParams({minLat:a.minLat.toString(),maxLat:a.maxLat.toString(),minLon:a.minLon.toString(),maxLon:a.maxLon.toString(),vesselTypes:"52"});fetch(`${xr}/v1/vessels/position/all?${u}`).then(h=>{if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);return h.json()}).then(h=>r(h)).catch(h=>console.error("Error fetching Tugs:",h))},[]);return s.current=e,A.useEffect(()=>{if(!(!n||!e))return i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{s.current&&o(s.current)},250),()=>{i.current&&clearTimeout(i.current)}},[n,e,o]),A.useEffect(()=>{if(!n||!e)return;const a=setInterval(()=>{s.current&&o(s.current)},3e4);return()=>clearInterval(a)},[n,o]),new On({id:"tug-layer",data:t,visible:n,pickable:!0,getPosition:a=>[a.Longitude,a.Latitude],getIcon:()=>({url:"/Ship-Icon.png",height:512,width:360}),getAngle:a=>a.TrueHeading==511?0:360-(a.TrueHeading||0),getSize:40})}function upe({visible:n=!0,viewportBounds:e}={}){const[t,r]=A.useState([]),i=A.useRef(null),s=A.useRef(e),o=A.useCallback(a=>{const u=new URLSearchParams({minLat:a.minLat.toString(),maxLat:a.maxLat.toString(),minLon:a.minLon.toString(),maxLon:a.maxLon.toString(),vesselTypes:"55"});fetch(`${xr}/v1/vessels/position/all?${u}`).then(h=>{if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);return h.json()}).then(h=>r(h)).catch(h=>console.error("Error fetching Tugs:",h))},[]);return s.current=e,A.useEffect(()=>{if(!(!n||!e))return i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{s.current&&o(s.current)},250),()=>{i.current&&clearTimeout(i.current)}},[n,e,o]),A.useEffect(()=>{if(!n||!e)return;const a=setInterval(()=>{s.current&&o(s.current)},3e4);return()=>clearInterval(a)},[n,o]),new On({id:"law-enforcement-layer",data:t,visible:n,pickable:!0,getPosition:a=>[a.Longitude,a.Latitude],getIcon:()=>({url:"/Ship-Icon.png",height:512,width:360}),getAngle:a=>a.TrueHeading==511?0:360-(a.TrueHeading||0),getSize:40})}function hpe({visible:n=!0,viewportBounds:e}={}){const[t,r]=A.useState([]),i=A.useRef(null),s=A.useRef(e),o=A.useCallback(a=>{const u=new URLSearchParams({minLat:a.minLat.toString(),maxLat:a.maxLat.toString(),minLon:a.minLon.toString(),maxLon:a.maxLon.toString(),vesselTypes:"58"});fetch(`${xr}/v1/vessels/position/all?${u}`).then(h=>{if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);return h.json()}).then(h=>r(h)).catch(h=>console.error("Error fetching Medical Transport Vessels:",h))},[]);return s.current=e,A.useEffect(()=>{if(!(!n||!e))return i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{s.current&&o(s.current)},250),()=>{i.current&&clearTimeout(i.current)}},[n,e,o]),A.useEffect(()=>{if(!n||!e)return;const a=setInterval(()=>{s.current&&o(s.current)},3e4);return()=>clearInterval(a)},[n,o]),new On({id:"medical-transport-layer",data:t,visible:n,pickable:!0,getPosition:a=>[a.Longitude,a.Latitude],getIcon:()=>({url:"/Ship-Icon.png",height:512,width:360}),getAngle:a=>a.TrueHeading==511?0:360-(a.TrueHeading||0),getSize:40})}function fpe({visible:n=!0,viewportBounds:e}={}){const[t,r]=A.useState([]),i=A.useRef(null),s=A.useRef(e),o=A.useCallback(a=>{const u=new URLSearchParams({minLat:a.minLat.toString(),maxLat:a.maxLat.toString(),minLon:a.minLon.toString(),maxLon:a.maxLon.toString(),vesselTypes:"60,61,62,63,64,65,66,67,68,69"});fetch(`${xr}/v1/vessels/position/all?${u}`).then(h=>{if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);return h.json()}).then(h=>r(h)).catch(h=>console.error("Error fetching Passenger Vessels:",h))},[]);return s.current=e,A.useEffect(()=>{if(!(!n||!e))return i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{s.current&&o(s.current)},250),()=>{i.current&&clearTimeout(i.current)}},[n,e,o]),A.useEffect(()=>{if(!n||!e)return;const a=setInterval(()=>{s.current&&o(s.current)},3e4);return()=>clearInterval(a)},[n,o]),new On({id:"passenger-vessel-layer",data:t,visible:n,pickable:!0,getPosition:a=>[a.Longitude,a.Latitude],getIcon:()=>({url:"/Ship-Icon.png",height:512,width:360}),getAngle:a=>a.TrueHeading==511?0:360-(a.TrueHeading||0),getSize:40})}function dpe({visible:n=!0,viewportBounds:e}={}){const[t,r]=A.useState([]),i=A.useRef(null),s=A.useRef(e),o=A.useCallback(a=>{const u=new URLSearchParams({minLat:a.minLat.toString(),maxLat:a.maxLat.toString(),minLon:a.minLon.toString(),maxLon:a.maxLon.toString(),vesselTypes:"70,71,72,73,74,75,76,77,78,79"});fetch(`${xr}/v1/vessels/position/all?${u}`).then(h=>{if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);return h.json()}).then(h=>r(h)).catch(h=>console.error("Error fetching Cargo Vessels:",h))},[]);return s.current=e,A.useEffect(()=>{if(!(!n||!e))return i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{s.current&&o(s.current)},250),()=>{i.current&&clearTimeout(i.current)}},[n,e,o]),A.useEffect(()=>{if(!n||!e)return;const a=setInterval(()=>{s.current&&o(s.current)},3e4);return()=>clearInterval(a)},[n,o]),new On({id:"cargo-vessel-layer",data:t,visible:n,pickable:!0,getPosition:a=>[a.Longitude,a.Latitude],getIcon:()=>({url:"/Ship-Icon.png",height:512,width:360}),getAngle:a=>a.TrueHeading==511?0:360-(a.TrueHeading||0),getSize:40})}function ppe({visible:n=!0,viewportBounds:e}={}){const[t,r]=A.useState([]),i=A.useRef(null),s=A.useRef(e),o=A.useCallback(a=>{const u=new URLSearchParams({minLat:a.minLat.toString(),maxLat:a.maxLat.toString(),minLon:a.minLon.toString(),maxLon:a.maxLon.toString(),vesselTypes:"80,81,82,83,84,85,86,87,88,89"});fetch(`${xr}/v1/vessels/position/all?${u}`).then(h=>{if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);return h.json()}).then(h=>r(h)).catch(h=>console.error("Error fetching Tanker Vessels:",h))},[]);return s.current=e,A.useEffect(()=>{if(!(!n||!e))return i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{s.current&&o(s.current)},250),()=>{i.current&&clearTimeout(i.current)}},[n,e,o]),A.useEffect(()=>{if(!n||!e)return;const a=setInterval(()=>{s.current&&o(s.current)},3e4);return()=>clearInterval(a)},[n,o]),new On({id:"tanker-vessel-layer",data:t,visible:n,pickable:!0,getPosition:a=>[a.Longitude,a.Latitude],getIcon:()=>({url:"/Ship-Icon.png",height:512,width:360}),getAngle:a=>a.TrueHeading==511?0:360-(a.TrueHeading||0),getSize:40})}function gpe({visible:n=!0,viewportBounds:e}={}){const[t,r]=A.useState([]),i=A.useRef(null),s=A.useRef(e),o=A.useCallback(a=>{const u=new URLSearchParams({minLat:a.minLat.toString(),maxLat:a.maxLat.toString(),minLon:a.minLon.toString(),maxLon:a.maxLon.toString(),vesselTypes:"36"});fetch(`${xr}/v1/vessels/position/all?${u}`).then(h=>{if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);return h.json()}).then(h=>r(h)).catch(h=>console.error("Error fetching Sailing Vessels:",h))},[]);return s.current=e,A.useEffect(()=>{if(!(!n||!e))return i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{s.current&&o(s.current)},250),()=>{i.current&&clearTimeout(i.current)}},[n,e,o]),A.useEffect(()=>{if(!n||!e)return;const a=setInterval(()=>{s.current&&o(s.current)},3e4);return()=>clearInterval(a)},[n,o]),new On({id:"sailing-vessel-layer",data:t,visible:n,pickable:!0,getPosition:a=>[a.Longitude,a.Latitude],getIcon:()=>({url:"/Ship-Icon.png",height:512,width:360}),getAngle:a=>a.TrueHeading==511?0:360-(a.TrueHeading||0),getSize:40})}function mpe({visible:n=!0,viewportBounds:e}={}){const[t,r]=A.useState([]),i=A.useRef(null),s=A.useRef(e),o=A.useCallback(a=>{const u=new URLSearchParams({minLat:a.minLat.toString(),maxLat:a.maxLat.toString(),minLon:a.minLon.toString(),maxLon:a.maxLon.toString(),vesselTypes:"0,33,34,50,51,53,54,59,90,91,92,93,94,95,96,97,98,99"});fetch(`${xr}/v1/vessels/position/all?${u}`).then(h=>{if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);return h.json()}).then(h=>r(h)).catch(h=>console.error("Error fetching Other Vessels:",h))},[]);return s.current=e,A.useEffect(()=>{if(!(!n||!e))return i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{s.current&&o(s.current)},250),()=>{i.current&&clearTimeout(i.current)}},[n,e,o]),A.useEffect(()=>{if(!n||!e)return;const a=setInterval(()=>{s.current&&o(s.current)},3e4);return()=>clearInterval(a)},[n,o]),new On({id:"other-vessel-layer",data:t,visible:n,pickable:!0,getPosition:a=>[a.Longitude,a.Latitude],getIcon:()=>({url:"/Ship-Icon.png",height:512,width:360}),getAngle:a=>a.TrueHeading==511?0:360-(a.TrueHeading||0),getSize:40})}const AO=(n,e)=>{let t;return(...r)=>{t&&window.clearTimeout(t),t=window.setTimeout(()=>n(...r),e)}},ype=bt.memo(({})=>{const[n,e]=A.useState(null);A.useEffect(()=>{const de=cE(xh,Ee=>{e(Ee?Ee.uid:null)});return()=>de()},[]);const[t,r]=A.useState({latitude:20,longitude:0,zoom:2,pitch:0,bearing:0});A.useEffect(()=>{let de=!0;return(async()=>{try{if(n)try{const O=await A4(n);if(de&&O?.mapPosition){const{latitude:W,longitude:U,zoom:ie}=O.mapPosition;r({latitude:W,longitude:U,zoom:ie,pitch:0,bearing:0});return}}catch(O){console.error("Failed to load user map position:",O)}const Ee=localStorage.getItem("mapPosition");if(de&&Ee)try{const{latitude:O,longitude:W,zoom:U}=JSON.parse(Ee);r({latitude:O,longitude:W,zoom:U,pitch:0,bearing:0})}catch(O){console.error("Failed to parse saved map position:",O)}}catch(Ee){console.error("Error while loading map position:",Ee)}})(),()=>{de=!1}},[n]);const[i,s]=A.useState({osm:!0,wigVessels:!0,fishingVessels:!0,towingVessels:!0,militaryVessels:!0,pleasureCrafts:!0,highSpeedCrafts:!0,tugs:!0,lawEnforcement:!0,medicalTransport:!0,passengerVessels:!0,cargoVessels:!0,tankerVessels:!0,sailingVessels:!0,otherVessels:!0,lighthouse:!1}),[o,a]=A.useState(),u=A.useCallback(AO(de=>{const Ee={longitude:de.longitude,latitude:de.latitude,zoom:de.zoom};localStorage.setItem("mapPosition",JSON.stringify(Ee))},300),[]),h=A.useCallback(AO(async(de,Ee)=>{try{await S4(de,{mapPosition:{longitude:Ee.longitude,latitude:Ee.latitude,zoom:Ee.zoom}})}catch(O){console.error("Failed to save map position to Firestore:",O)}},1e3),[]);A.useEffect(()=>{if(!n)return;const de=localStorage.getItem("mapPosition");if(de)try{const Ee=JSON.parse(de);h(n,Ee)}catch(Ee){console.error("Failed to parse saved map position for upload:",Ee)}},[n,h]);const d=A.useCallback(de=>{if(de)try{const O=new lo({...de,width:window.innerWidth,height:window.innerHeight}).getBounds();a({minLon:O[0],minLat:O[1],maxLon:O[2],maxLat:O[3]})}catch(Ee){console.error("Failed to update viewport bounds:",Ee)}},[]);A.useEffect(()=>{d(t)},[t,d]);const g=A.useCallback(({viewState:de})=>{r(de),u(de),d(de),n&&h(n,de)},[u,d,n,h]),y=rpe({visible:i.wigVessels,viewportBounds:o}),v=ipe({visible:i.fishingVessels,viewportBounds:o}),T=spe({visible:i.towingVessels,viewportBounds:o}),w=ope({visible:i.militaryVessels,viewportBounds:o}),E=ape({visible:i.pleasureCrafts,viewportBounds:o}),S=lpe({visible:i.highSpeedCrafts,viewportBounds:o}),P=cpe({visible:i.tugs,viewportBounds:o}),I=upe({visible:i.lawEnforcement,viewportBounds:o}),L=hpe({visible:i.medicalTransport,viewportBounds:o}),F=fpe({visible:i.passengerVessels,viewportBounds:o}),Y=dpe({visible:i.cargoVessels,viewportBounds:o}),k=ppe({visible:i.tankerVessels,viewportBounds:o}),M=gpe({visible:i.sailingVessels,viewportBounds:o}),N=mpe({visible:i.otherVessels,viewportBounds:o}),H=A.useMemo(()=>{const de=[];return i.osm&&de.push(npe()),i.lighthouse,i.wigVessels&&de.push(y),i.fishingVessels&&de.push(v),i.towingVessels&&de.push(T),i.militaryVessels&&de.push(w),i.pleasureCrafts&&de.push(E),i.highSpeedCrafts&&de.push(S),i.tugs&&de.push(P),i.lawEnforcement&&de.push(I),i.medicalTransport&&de.push(L),i.passengerVessels&&de.push(F),i.cargoVessels&&de.push(Y),i.tankerVessels&&de.push(k),i.sailingVessels&&de.push(M),i.otherVessels&&de.push(N),de},[i,y,v,T,w,E,S,P,I,L,F,Y,k,M,N]),q=A.useMemo(()=>({scrollZoom:{smooth:!0,speed:.1},dragRotate:!1,keyboard:!0,touchRotate:!1}),[]),K=A.useCallback(de=>{s(Ee=>({...Ee,[de]:!Ee[de]}))},[]),j=$_();return $.jsx($.Fragment,{children:$.jsx(The,{layers:H,views:new Y1({repeat:!0}),viewState:t,onViewStateChange:g,controller:q,getTooltip:()=>null,getCursor:()=>"grab",style:{position:"absolute",width:"100vw",height:"100vh"},children:$.jsx("div",{className:`absolute ${j?"top-6 right-6":"top-20 right-4"} z-50`,children:$.jsxs(fZ,{children:[$.jsx(dZ,{asChild:!0,children:$.jsx("div",{className:"bg-white/70 p-2.5 rounded-full cursor-pointer text-xl hover:bg-white/90 transition-colors dark:bg-gray-900 dark:text-white",children:$.jsx(CX,{})})}),$.jsx(pZ,{className:"w-55 mr-3 mt-1",children:$.jsxs(ZZ,{type:"single",collapsible:!0,className:"w-full",children:[$.jsxs(K0,{value:"layers",children:[$.jsx(G0,{className:"cursor-pointer",children:"Maps"}),$.jsx(Z0,{children:$.jsx("div",{className:"flex flex-col space-y-2 mt-2",children:$.jsxs("div",{className:"flex items-center space-x-2",children:[$.jsx(Un,{id:"osm-layer",checked:i.osm,onCheckedChange:()=>K("osm"),className:"cursor-pointer"}),$.jsx("label",{htmlFor:"osm-layer",className:"text-sm",children:"OpenStreetMap"})]})})})]}),$.jsxs(K0,{value:"buildings",children:[$.jsx(G0,{className:"cursor-pointer",children:"Buildings"}),$.jsx(Z0,{children:$.jsxs("div",{className:"flex flex-col space-y-2 mt-2",children:[$.jsxs("div",{className:"flex items-center space-x-2",children:[$.jsx(Un,{id:"ports-layer",checked:!1,onCheckedChange:()=>{},className:"cursor-pointer"}),$.jsx("label",{htmlFor:"ports-layer",className:"text-sm",children:"Ports"})]}),$.jsxs("div",{className:"flex items-center space-x-2",children:[$.jsx(Un,{id:"lighthouse-layer",checked:i.lighthouse,onCheckedChange:()=>K("lighthouse"),className:"cursor-pointer"}),$.jsx("label",{htmlFor:"lighthouse-layer",className:"text-sm",children:"Lighthouses"})]})]})})]}),$.jsxs(K0,{value:"vessels",children:[$.jsx(G0,{className:"cursor-pointer",children:"Vessels"}),$.jsx(Z0,{children:$.jsxs("div",{className:"flex flex-col space-y-2 mt-2",children:[$.jsxs("div",{className:"flex items-center space-x-2",children:[$.jsx(Un,{id:"wig-vessel-layer",checked:i.wigVessels,onCheckedChange:()=>K("wigVessels"),className:"cursor-pointer"}),$.jsx("label",{htmlFor:"wig-vessel-layer",className:"text-sm",children:"Wing in Ground Vessels"})]}),$.jsxs("div",{className:"flex items-center space-x-2",children:[$.jsx(Un,{id:"fishing-vessel-layer",checked:i.fishingVessels,onCheckedChange:()=>K("fishingVessels"),className:"cursor-pointer"}),$.jsx("label",{htmlFor:"fishing-vessel-layer",className:"text-sm",children:"Fishing Vessels"})]}),"                                      ",$.jsxs("div",{className:"flex items-center space-x-2",children:[$.jsx(Un,{id:"towing-vessel-layer",checked:i.towingVessels,onCheckedChange:()=>K("towingVessels"),className:"cursor-pointer"}),$.jsx("label",{htmlFor:"towing-vessel-layer",className:"text-sm",children:"Towing Vessels"})]}),$.jsxs("div",{className:"flex items-center space-x-2",children:[$.jsx(Un,{id:"military-vessel-layer",checked:i.militaryVessels,onCheckedChange:()=>K("militaryVessels"),className:"cursor-pointer"}),$.jsx("label",{htmlFor:"military-vessel-layer",className:"text-sm",children:"Military Vessels"})]}),$.jsxs("div",{className:"flex items-center space-x-2",children:[$.jsx(Un,{id:"sailing-vessel-layer",checked:i.sailingVessels,onCheckedChange:()=>K("sailingVessels"),className:"cursor-pointer"}),$.jsx("label",{htmlFor:"sailing-vessel-layer",className:"text-sm",children:"Sailing Vessels"})]}),$.jsxs("div",{className:"flex items-center space-x-2",children:[$.jsx(Un,{id:"pleasure-craft-layer",checked:i.pleasureCrafts,onCheckedChange:()=>K("pleasureCrafts"),className:"cursor-pointer"}),$.jsx("label",{htmlFor:"pleasure-craft-layer",className:"text-sm",children:"Pleasure Crafts"})]}),$.jsxs("div",{className:"flex items-center space-x-2",children:[$.jsx(Un,{id:"hsc-layer",checked:i.highSpeedCrafts,onCheckedChange:()=>K("highSpeedCrafts"),className:"cursor-pointer"}),$.jsx("label",{htmlFor:"hsc-layer",className:"text-sm",children:"High Speed Crafts"})]}),$.jsxs("div",{className:"flex items-center space-x-2",children:[$.jsx(Un,{id:"tug-layer",checked:i.tugs,onCheckedChange:()=>K("tugs"),className:"cursor-pointer"}),$.jsx("label",{htmlFor:"tug-layer",className:"text-sm",children:"Tugs"})]}),$.jsxs("div",{className:"flex items-center space-x-2",children:[$.jsx(Un,{id:"law-enforcement-layer",checked:i.lawEnforcement,onCheckedChange:()=>K("lawEnforcement"),className:"cursor-pointer"}),$.jsx("label",{htmlFor:"law-enforcement-layer",className:"text-sm",children:"Law Enforcement"})]}),$.jsxs("div",{className:"flex items-center space-x-2",children:[$.jsx(Un,{id:"medical-transport-layer",checked:i.medicalTransport,onCheckedChange:()=>K("medicalTransport"),className:"cursor-pointer"}),$.jsx("label",{htmlFor:"medical-transport-layer",className:"text-sm",children:"Medical Transport"})]}),$.jsxs("div",{className:"flex items-center space-x-2",children:[$.jsx(Un,{id:"passenger-vessel-layer",checked:i.passengerVessels,onCheckedChange:()=>K("passengerVessels"),className:"cursor-pointer"}),$.jsx("label",{htmlFor:"passenger-vessel-layer",className:"text-sm",children:"Passenger Vessels"})]}),$.jsxs("div",{className:"flex items-center space-x-2",children:[$.jsx(Un,{id:"cargo-vessel-layer",checked:i.cargoVessels,onCheckedChange:()=>K("cargoVessels"),className:"cursor-pointer"}),$.jsx("label",{htmlFor:"cargo-vessel-layer",className:"text-sm",children:"Cargo Vessels"})]}),$.jsxs("div",{className:"flex items-center space-x-2",children:[$.jsx(Un,{id:"tanker-vessel-layer",checked:i.tankerVessels,onCheckedChange:()=>K("tankerVessels"),className:"cursor-pointer"}),$.jsx("label",{htmlFor:"tanker-vessel-layer",className:"text-sm",children:"Tankers"})]}),$.jsxs("div",{className:"flex items-center space-x-2",children:[$.jsx(Un,{id:"other-vessel-layer",checked:i.otherVessels,onCheckedChange:()=>K("otherVessels"),className:"cursor-pointer"}),$.jsx("label",{htmlFor:"other-vessel-layer",className:"text-sm",children:"Other Vessels"})]})]})})]})]})})]})})})})});async function _pe(n){const e=Qu(Ju,"usernames",n);return(await WE(e)).exists()}async function vpe(n,e,t){await Cw(Qu(Ju,"users",e),{username:n,email:t,createdAt:x4()},{merge:!0}),await Cw(Qu(Ju,"usernames",n),{uid:e})}async function bpe(n,e,t){if(!n||!e||!t)throw new Error("Email, password and username are required");if(await _pe(t))throw new Error("Username is already taken");let r;try{r=(await M7(xh,n,e)).user}catch(i){throw console.error("createUserWithEmailAndPassword failed:",i?.code??i?.message??i),new Error(`Registration failed: ${i?.code??i?.message??"unknown error"}`)}try{await vpe(t,r.uid,n)}catch(i){console.error("saveUsername failed:",i?.code??i?.message??i);try{r&&(await L7(r),console.info("Rolled back newly created auth user due to username save failure."))}catch(s){console.error("Failed to delete user during rollback:",s?.code??s?.message??s)}throw new Error(`Failed to save username: ${i?.code??i?.message??"unknown error"}`)}return r}async function Tpe(n,e){const{user:t}=await O7(xh,n,e);return t}async function wpe(){await D7(xh)}async function xpe(n){const e=Qu(Ju,"users",n),t=await WE(e);return t.exists()&&t.data().username||null}function Epe(){const[n,e]=A.useState(""),[t,r]=A.useState(""),[i,s]=A.useState(""),[o,a]=A.useState(""),[u,h]=A.useState(null),[d,g]=A.useState(!1),y=async v=>{if(v.preventDefault(),h(null),!t||!n||!i||!o){h("All fields are required");return}if(!(w=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(w))(t)){h("Please enter a valid email address");return}if(i!==o){h("Passwords do not match");return}if(i.length<6){h("Password must be at least 6 characters");return}try{g(!0),await bpe(t,i,n)}catch(w){const E=w?.message??"Registration failed";E.includes("auth/invalid-email")?h("Invalid email address"):E.includes("EMAIL_EXISTS")||E.includes("auth/email-already-in-use")?h("An account with this email already exists"):h(E)}finally{g(!1)}};return $.jsxs("div",{className:"backdrop-blur-sm p-3 rounded-lg shadow-lg max-w-md mx-auto mt-5 bg-white/30",children:[$.jsx("h2",{className:"text-2xl font-bold mb-4 text-center",children:"Register"}),u&&$.jsx("div",{className:"text-red-500 mb-4 text-center",children:u}),$.jsxs("form",{onSubmit:y,className:"space-y-4",children:[$.jsxs("div",{children:[$.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"username",children:"Username"}),$.jsx("input",{type:"text",id:"username",value:n,onChange:v=>e(v.target.value),className:"w-full p-2 border border-gray-900 rounded",required:!0})]}),$.jsxs("div",{children:[$.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"email",children:"Email"}),$.jsx("input",{type:"email",id:"email",value:t,onChange:v=>r(v.target.value),className:"w-full p-2 border border-gray-900 rounded",required:!0})]}),$.jsxs("div",{children:[$.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"password",children:"Password"}),$.jsx("input",{type:"password",id:"password",value:i,onChange:v=>s(v.target.value),className:"w-full p-2 border border-gray-900 rounded",required:!0,minLength:6})]}),$.jsxs("div",{children:[$.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"confirmPassword",children:"Confirm Password"}),$.jsx("input",{type:"password",id:"confirmPassword",value:o,onChange:v=>a(v.target.value),className:"w-full p-2 border border-gray-900 rounded",required:!0,minLength:6})]}),$.jsx("button",{type:"submit",className:"w-full bg-blue-600 text-white p-2 rounded hover:bg-blue-700 transition cursor-pointer duration-200 disabled:opacity-50",disabled:d,children:d?"Registering":"Register"})]})]})}function Ape(){const[n,e]=A.useState(""),[t,r]=A.useState(""),[i,s]=A.useState(null),[o,a]=A.useState(!1),u=async h=>{if(h.preventDefault(),s(null),!n||!t){s("Email and password are required");return}try{a(!0),await Tpe(n,t)}catch(d){const g=d?.message??"Login failed";g.includes("auth/invalid-email")?s("Invalid email address"):g.includes("auth/user-not-found")||g.includes("auth/wrong-password")?s("Incorrect email or password"):s(g)}finally{a(!1)}};return $.jsxs("div",{className:"backdrop-blur-sm p-3 rounded-lg shadow-lg max-w-md mx-auto mt-5 bg-white/30",children:[$.jsx("h2",{className:"text-2xl font-bold mb-4 text-center",children:"Login"}),i&&$.jsx("div",{className:"text-red-500 mb-4 text-center",children:i}),$.jsxs("form",{onSubmit:u,children:[$.jsxs("div",{className:"mb-4",children:[$.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"email",children:"Email"}),$.jsx("input",{type:"email",id:"email",value:n,onChange:h=>e(h.target.value),className:"w-full p-2 border border-gray-900 rounded",required:!0,disabled:o})]}),$.jsxs("div",{className:"mb-4",children:[$.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"password",children:"Password"}),$.jsx("input",{type:"password",id:"password",value:t,onChange:h=>r(h.target.value),className:"w-full p-2 border border-gray-900 rounded",required:!0,disabled:o})]}),$.jsx("button",{type:"submit",className:"w-full bg-blue-600 text-white p-2 rounded hover:bg-blue-700 transition cursor-pointer duration-200 disabled:opacity-50",disabled:o,children:o?"Logging in...":"Login"})]})]})}const Spe=()=>A.useContext(C4),yA=A.createContext({});function _A(n){const e=A.useRef(null);return e.current===null&&(e.current=n()),e.current}const vA=typeof window<"u",aF=vA?A.useLayoutEffect:A.useEffect,gv=A.createContext(null);function bA(n,e){n.indexOf(e)===-1&&n.push(e)}function TA(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}const uo=(n,e,t)=>t>e?e:t<n?n:t;let wA=()=>{};const ho={},lF=n=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(n);function cF(n){return typeof n=="object"&&n!==null}const uF=n=>/^0[^.\s]+$/u.test(n);function xA(n){let e;return()=>(e===void 0&&(e=n()),e)}const oi=n=>n,Rpe=(n,e)=>t=>e(n(t)),Mp=(...n)=>n.reduce(Rpe),rp=(n,e,t)=>{const r=e-n;return r===0?1:(t-n)/r};class EA{constructor(){this.subscriptions=[]}add(e){return bA(this.subscriptions,e),()=>TA(this.subscriptions,e)}notify(e,t,r){const i=this.subscriptions.length;if(i)if(i===1)this.subscriptions[0](e,t,r);else for(let s=0;s<i;s++){const o=this.subscriptions[s];o&&o(e,t,r)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const cs=n=>n*1e3,ni=n=>n/1e3;function hF(n,e){return e?n*(1e3/e):0}const fF=(n,e,t)=>(((1-3*t+3*e)*n+(3*t-6*e))*n+3*e)*n,Cpe=1e-7,Ipe=12;function Ppe(n,e,t,r,i){let s,o,a=0;do o=e+(t-e)/2,s=fF(o,r,i)-n,s>0?t=o:e=o;while(Math.abs(s)>Cpe&&++a<Ipe);return o}function Op(n,e,t,r){if(n===e&&t===r)return oi;const i=s=>Ppe(s,0,1,n,t);return s=>s===0||s===1?s:fF(i(s),e,r)}const dF=n=>e=>e<=.5?n(2*e)/2:(2-n(2*(1-e)))/2,pF=n=>e=>1-n(1-e),gF=Op(.33,1.53,.69,.99),AA=pF(gF),mF=dF(AA),yF=n=>(n*=2)<1?.5*AA(n):.5*(2-Math.pow(2,-10*(n-1))),SA=n=>1-Math.sin(Math.acos(n)),_F=pF(SA),vF=dF(SA),Mpe=Op(.42,0,1,1),Ope=Op(0,0,.58,1),bF=Op(.42,0,.58,1),kpe=n=>Array.isArray(n)&&typeof n[0]!="number",TF=n=>Array.isArray(n)&&typeof n[0]=="number",Npe={linear:oi,easeIn:Mpe,easeInOut:bF,easeOut:Ope,circIn:SA,circInOut:vF,circOut:_F,backIn:AA,backInOut:mF,backOut:gF,anticipate:yF},Dpe=n=>typeof n=="string",SO=n=>{if(TF(n)){wA(n.length===4);const[e,t,r,i]=n;return Op(e,t,r,i)}else if(Dpe(n))return Npe[n];return n},zm=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function Lpe(n,e){let t=new Set,r=new Set,i=!1,s=!1;const o=new WeakSet;let a={delta:0,timestamp:0,isProcessing:!1};function u(d){o.has(d)&&(h.schedule(d),n()),d(a)}const h={schedule:(d,g=!1,y=!1)=>{const T=y&&i?t:r;return g&&o.add(d),T.has(d)||T.add(d),d},cancel:d=>{r.delete(d),o.delete(d)},process:d=>{if(a=d,i){s=!0;return}i=!0,[t,r]=[r,t],t.forEach(u),t.clear(),i=!1,s&&(s=!1,h.process(d))}};return h}const Upe=40;function wF(n,e){let t=!1,r=!0;const i={delta:0,timestamp:0,isProcessing:!1},s=()=>t=!0,o=zm.reduce((I,L)=>(I[L]=Lpe(s),I),{}),{setup:a,read:u,resolveKeyframes:h,preUpdate:d,update:g,preRender:y,render:v,postRender:T}=o,w=()=>{const I=ho.useManualTiming?i.timestamp:performance.now();t=!1,ho.useManualTiming||(i.delta=r?1e3/60:Math.max(Math.min(I-i.timestamp,Upe),1)),i.timestamp=I,i.isProcessing=!0,a.process(i),u.process(i),h.process(i),d.process(i),g.process(i),y.process(i),v.process(i),T.process(i),i.isProcessing=!1,t&&e&&(r=!1,n(w))},E=()=>{t=!0,r=!0,i.isProcessing||n(w)};return{schedule:zm.reduce((I,L)=>{const F=o[L];return I[L]=(Y,k=!1,M=!1)=>(t||E(),F.schedule(Y,k,M)),I},{}),cancel:I=>{for(let L=0;L<zm.length;L++)o[zm[L]].cancel(I)},state:i,steps:o}}const{schedule:Dt,cancel:Ua,state:Vn,steps:FT}=wF(typeof requestAnimationFrame<"u"?requestAnimationFrame:oi,!0);let Ty;function Vpe(){Ty=void 0}const br={now:()=>(Ty===void 0&&br.set(Vn.isProcessing||ho.useManualTiming?Vn.timestamp:performance.now()),Ty),set:n=>{Ty=n,queueMicrotask(Vpe)}},xF=n=>e=>typeof e=="string"&&e.startsWith(n),RA=xF("--"),Fpe=xF("var(--"),CA=n=>Fpe(n)?Bpe.test(n.split("/*")[0].trim()):!1,Bpe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Nh={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},ip={...Nh,transform:n=>uo(0,1,n)},jm={...Nh,default:1},Id=n=>Math.round(n*1e5)/1e5,IA=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function zpe(n){return n==null}const jpe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,PA=(n,e)=>t=>!!(typeof t=="string"&&jpe.test(t)&&t.startsWith(n)||e&&!zpe(t)&&Object.prototype.hasOwnProperty.call(t,e)),EF=(n,e,t)=>r=>{if(typeof r!="string")return r;const[i,s,o,a]=r.match(IA);return{[n]:parseFloat(i),[e]:parseFloat(s),[t]:parseFloat(o),alpha:a!==void 0?parseFloat(a):1}},Hpe=n=>uo(0,255,n),BT={...Nh,transform:n=>Math.round(Hpe(n))},Dl={test:PA("rgb","red"),parse:EF("red","green","blue"),transform:({red:n,green:e,blue:t,alpha:r=1})=>"rgba("+BT.transform(n)+", "+BT.transform(e)+", "+BT.transform(t)+", "+Id(ip.transform(r))+")"};function $pe(n){let e="",t="",r="",i="";return n.length>5?(e=n.substring(1,3),t=n.substring(3,5),r=n.substring(5,7),i=n.substring(7,9)):(e=n.substring(1,2),t=n.substring(2,3),r=n.substring(3,4),i=n.substring(4,5),e+=e,t+=t,r+=r,i+=i),{red:parseInt(e,16),green:parseInt(t,16),blue:parseInt(r,16),alpha:i?parseInt(i,16)/255:1}}const Ax={test:PA("#"),parse:$pe,transform:Dl.transform},kp=n=>({test:e=>typeof e=="string"&&e.endsWith(n)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${n}`}),oa=kp("deg"),us=kp("%"),$e=kp("px"),Wpe=kp("vh"),qpe=kp("vw"),RO={...us,parse:n=>us.parse(n)/100,transform:n=>us.transform(n*100)},Pu={test:PA("hsl","hue"),parse:EF("hue","saturation","lightness"),transform:({hue:n,saturation:e,lightness:t,alpha:r=1})=>"hsla("+Math.round(n)+", "+us.transform(Id(e))+", "+us.transform(Id(t))+", "+Id(ip.transform(r))+")"},cn={test:n=>Dl.test(n)||Ax.test(n)||Pu.test(n),parse:n=>Dl.test(n)?Dl.parse(n):Pu.test(n)?Pu.parse(n):Ax.parse(n),transform:n=>typeof n=="string"?n:n.hasOwnProperty("red")?Dl.transform(n):Pu.transform(n),getAnimatableNone:n=>{const e=cn.parse(n);return e.alpha=0,cn.transform(e)}},Xpe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function Ype(n){return isNaN(n)&&typeof n=="string"&&(n.match(IA)?.length||0)+(n.match(Xpe)?.length||0)>0}const AF="number",SF="color",Kpe="var",Gpe="var(",CO="${}",Zpe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function sp(n){const e=n.toString(),t=[],r={color:[],number:[],var:[]},i=[];let s=0;const a=e.replace(Zpe,u=>(cn.test(u)?(r.color.push(s),i.push(SF),t.push(cn.parse(u))):u.startsWith(Gpe)?(r.var.push(s),i.push(Kpe),t.push(u)):(r.number.push(s),i.push(AF),t.push(parseFloat(u))),++s,CO)).split(CO);return{values:t,split:a,indexes:r,types:i}}function RF(n){return sp(n).values}function CF(n){const{split:e,types:t}=sp(n),r=e.length;return i=>{let s="";for(let o=0;o<r;o++)if(s+=e[o],i[o]!==void 0){const a=t[o];a===AF?s+=Id(i[o]):a===SF?s+=cn.transform(i[o]):s+=i[o]}return s}}const Qpe=n=>typeof n=="number"?0:cn.test(n)?cn.getAnimatableNone(n):n;function Jpe(n){const e=RF(n);return CF(n)(e.map(Qpe))}const Va={test:Ype,parse:RF,createTransformer:CF,getAnimatableNone:Jpe};function zT(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*(2/3-t)*6:n}function ege({hue:n,saturation:e,lightness:t,alpha:r}){n/=360,e/=100,t/=100;let i=0,s=0,o=0;if(!e)i=s=o=t;else{const a=t<.5?t*(1+e):t+e-t*e,u=2*t-a;i=zT(u,a,n+1/3),s=zT(u,a,n),o=zT(u,a,n-1/3)}return{red:Math.round(i*255),green:Math.round(s*255),blue:Math.round(o*255),alpha:r}}function T_(n,e){return t=>t>0?e:n}const Bt=(n,e,t)=>n+(e-n)*t,jT=(n,e,t)=>{const r=n*n,i=t*(e*e-r)+r;return i<0?0:Math.sqrt(i)},tge=[Ax,Dl,Pu],nge=n=>tge.find(e=>e.test(n));function IO(n){const e=nge(n);if(!e)return!1;let t=e.parse(n);return e===Pu&&(t=ege(t)),t}const PO=(n,e)=>{const t=IO(n),r=IO(e);if(!t||!r)return T_(n,e);const i={...t};return s=>(i.red=jT(t.red,r.red,s),i.green=jT(t.green,r.green,s),i.blue=jT(t.blue,r.blue,s),i.alpha=Bt(t.alpha,r.alpha,s),Dl.transform(i))},Sx=new Set(["none","hidden"]);function rge(n,e){return Sx.has(n)?t=>t<=0?n:e:t=>t>=1?e:n}function ige(n,e){return t=>Bt(n,e,t)}function MA(n){return typeof n=="number"?ige:typeof n=="string"?CA(n)?T_:cn.test(n)?PO:age:Array.isArray(n)?IF:typeof n=="object"?cn.test(n)?PO:sge:T_}function IF(n,e){const t=[...n],r=t.length,i=n.map((s,o)=>MA(s)(s,e[o]));return s=>{for(let o=0;o<r;o++)t[o]=i[o](s);return t}}function sge(n,e){const t={...n,...e},r={};for(const i in t)n[i]!==void 0&&e[i]!==void 0&&(r[i]=MA(n[i])(n[i],e[i]));return i=>{for(const s in r)t[s]=r[s](i);return t}}function oge(n,e){const t=[],r={color:0,var:0,number:0};for(let i=0;i<e.values.length;i++){const s=e.types[i],o=n.indexes[s][r[s]],a=n.values[o]??0;t[i]=a,r[s]++}return t}const age=(n,e)=>{const t=Va.createTransformer(e),r=sp(n),i=sp(e);return r.indexes.var.length===i.indexes.var.length&&r.indexes.color.length===i.indexes.color.length&&r.indexes.number.length>=i.indexes.number.length?Sx.has(n)&&!i.values.length||Sx.has(e)&&!r.values.length?rge(n,e):Mp(IF(oge(r,i),i.values),t):T_(n,e)};function PF(n,e,t){return typeof n=="number"&&typeof e=="number"&&typeof t=="number"?Bt(n,e,t):MA(n)(n,e)}const lge=n=>{const e=({timestamp:t})=>n(t);return{start:(t=!0)=>Dt.update(e,t),stop:()=>Ua(e),now:()=>Vn.isProcessing?Vn.timestamp:br.now()}},MF=(n,e,t=10)=>{let r="";const i=Math.max(Math.round(e/t),2);for(let s=0;s<i;s++)r+=Math.round(n(s/(i-1))*1e4)/1e4+", ";return`linear(${r.substring(0,r.length-2)})`},w_=2e4;function OA(n){let e=0;const t=50;let r=n.next(e);for(;!r.done&&e<w_;)e+=t,r=n.next(e);return e>=w_?1/0:e}function cge(n,e=100,t){const r=t({...n,keyframes:[0,e]}),i=Math.min(OA(r),w_);return{type:"keyframes",ease:s=>r.next(i*s).value/e,duration:ni(i)}}const uge=5;function OF(n,e,t){const r=Math.max(e-uge,0);return hF(t-n(r),e-r)}const Yt={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},HT=.001;function hge({duration:n=Yt.duration,bounce:e=Yt.bounce,velocity:t=Yt.velocity,mass:r=Yt.mass}){let i,s,o=1-e;o=uo(Yt.minDamping,Yt.maxDamping,o),n=uo(Yt.minDuration,Yt.maxDuration,ni(n)),o<1?(i=h=>{const d=h*o,g=d*n,y=d-t,v=Rx(h,o),T=Math.exp(-g);return HT-y/v*T},s=h=>{const g=h*o*n,y=g*t+t,v=Math.pow(o,2)*Math.pow(h,2)*n,T=Math.exp(-g),w=Rx(Math.pow(h,2),o);return(-i(h)+HT>0?-1:1)*((y-v)*T)/w}):(i=h=>{const d=Math.exp(-h*n),g=(h-t)*n+1;return-HT+d*g},s=h=>{const d=Math.exp(-h*n),g=(t-h)*(n*n);return d*g});const a=5/n,u=dge(i,s,a);if(n=cs(n),isNaN(u))return{stiffness:Yt.stiffness,damping:Yt.damping,duration:n};{const h=Math.pow(u,2)*r;return{stiffness:h,damping:o*2*Math.sqrt(r*h),duration:n}}}const fge=12;function dge(n,e,t){let r=t;for(let i=1;i<fge;i++)r=r-n(r)/e(r);return r}function Rx(n,e){return n*Math.sqrt(1-e*e)}const pge=["duration","bounce"],gge=["stiffness","damping","mass"];function MO(n,e){return e.some(t=>n[t]!==void 0)}function mge(n){let e={velocity:Yt.velocity,stiffness:Yt.stiffness,damping:Yt.damping,mass:Yt.mass,isResolvedFromDuration:!1,...n};if(!MO(n,gge)&&MO(n,pge))if(n.visualDuration){const t=n.visualDuration,r=2*Math.PI/(t*1.2),i=r*r,s=2*uo(.05,1,1-(n.bounce||0))*Math.sqrt(i);e={...e,mass:Yt.mass,stiffness:i,damping:s}}else{const t=hge(n);e={...e,...t,mass:Yt.mass},e.isResolvedFromDuration=!0}return e}function x_(n=Yt.visualDuration,e=Yt.bounce){const t=typeof n!="object"?{visualDuration:n,keyframes:[0,1],bounce:e}:n;let{restSpeed:r,restDelta:i}=t;const s=t.keyframes[0],o=t.keyframes[t.keyframes.length-1],a={done:!1,value:s},{stiffness:u,damping:h,mass:d,duration:g,velocity:y,isResolvedFromDuration:v}=mge({...t,velocity:-ni(t.velocity||0)}),T=y||0,w=h/(2*Math.sqrt(u*d)),E=o-s,S=ni(Math.sqrt(u/d)),P=Math.abs(E)<5;r||(r=P?Yt.restSpeed.granular:Yt.restSpeed.default),i||(i=P?Yt.restDelta.granular:Yt.restDelta.default);let I;if(w<1){const F=Rx(S,w);I=Y=>{const k=Math.exp(-w*S*Y);return o-k*((T+w*S*E)/F*Math.sin(F*Y)+E*Math.cos(F*Y))}}else if(w===1)I=F=>o-Math.exp(-S*F)*(E+(T+S*E)*F);else{const F=S*Math.sqrt(w*w-1);I=Y=>{const k=Math.exp(-w*S*Y),M=Math.min(F*Y,300);return o-k*((T+w*S*E)*Math.sinh(M)+F*E*Math.cosh(M))/F}}const L={calculatedDuration:v&&g||null,next:F=>{const Y=I(F);if(v)a.done=F>=g;else{let k=F===0?T:0;w<1&&(k=F===0?cs(T):OF(I,F,Y));const M=Math.abs(k)<=r,N=Math.abs(o-Y)<=i;a.done=M&&N}return a.value=a.done?o:Y,a},toString:()=>{const F=Math.min(OA(L),w_),Y=MF(k=>L.next(F*k).value,F,30);return F+"ms "+Y},toTransition:()=>{}};return L}x_.applyToOptions=n=>{const e=cge(n,100,x_);return n.ease=e.ease,n.duration=cs(e.duration),n.type="keyframes",n};function Cx({keyframes:n,velocity:e=0,power:t=.8,timeConstant:r=325,bounceDamping:i=10,bounceStiffness:s=500,modifyTarget:o,min:a,max:u,restDelta:h=.5,restSpeed:d}){const g=n[0],y={done:!1,value:g},v=M=>a!==void 0&&M<a||u!==void 0&&M>u,T=M=>a===void 0?u:u===void 0||Math.abs(a-M)<Math.abs(u-M)?a:u;let w=t*e;const E=g+w,S=o===void 0?E:o(E);S!==E&&(w=S-g);const P=M=>-w*Math.exp(-M/r),I=M=>S+P(M),L=M=>{const N=P(M),H=I(M);y.done=Math.abs(N)<=h,y.value=y.done?S:H};let F,Y;const k=M=>{v(y.value)&&(F=M,Y=x_({keyframes:[y.value,T(y.value)],velocity:OF(I,M,y.value),damping:i,stiffness:s,restDelta:h,restSpeed:d}))};return k(0),{calculatedDuration:null,next:M=>{let N=!1;return!Y&&F===void 0&&(N=!0,L(M),k(M)),F!==void 0&&M>=F?Y.next(M-F):(!N&&L(M),y)}}}function yge(n,e,t){const r=[],i=t||ho.mix||PF,s=n.length-1;for(let o=0;o<s;o++){let a=i(n[o],n[o+1]);if(e){const u=Array.isArray(e)?e[o]||oi:e;a=Mp(u,a)}r.push(a)}return r}function _ge(n,e,{clamp:t=!0,ease:r,mixer:i}={}){const s=n.length;if(wA(s===e.length),s===1)return()=>e[0];if(s===2&&e[0]===e[1])return()=>e[1];const o=n[0]===n[1];n[0]>n[s-1]&&(n=[...n].reverse(),e=[...e].reverse());const a=yge(e,r,i),u=a.length,h=d=>{if(o&&d<n[0])return e[0];let g=0;if(u>1)for(;g<n.length-2&&!(d<n[g+1]);g++);const y=rp(n[g],n[g+1],d);return a[g](y)};return t?d=>h(uo(n[0],n[s-1],d)):h}function vge(n,e){const t=n[n.length-1];for(let r=1;r<=e;r++){const i=rp(0,e,r);n.push(Bt(t,1,i))}}function bge(n){const e=[0];return vge(e,n.length-1),e}function Tge(n,e){return n.map(t=>t*e)}function wge(n,e){return n.map(()=>e||bF).splice(0,n.length-1)}function Pd({duration:n=300,keyframes:e,times:t,ease:r="easeInOut"}){const i=kpe(r)?r.map(SO):SO(r),s={done:!1,value:e[0]},o=Tge(t&&t.length===e.length?t:bge(e),n),a=_ge(o,e,{ease:Array.isArray(i)?i:wge(e,i)});return{calculatedDuration:n,next:u=>(s.value=a(u),s.done=u>=n,s)}}const xge=n=>n!==null;function kA(n,{repeat:e,repeatType:t="loop"},r,i=1){const s=n.filter(xge),a=i<0||e&&t!=="loop"&&e%2===1?0:s.length-1;return!a||r===void 0?s[a]:r}const Ege={decay:Cx,inertia:Cx,tween:Pd,keyframes:Pd,spring:x_};function kF(n){typeof n.type=="string"&&(n.type=Ege[n.type])}class NA{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,t){return this.finished.then(e,t)}}const Age=n=>n/100;class DA extends NA{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:t}=this.options;t&&t.updatedAt!==br.now()&&this.tick(br.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;kF(e);const{type:t=Pd,repeat:r=0,repeatDelay:i=0,repeatType:s,velocity:o=0}=e;let{keyframes:a}=e;const u=t||Pd;u!==Pd&&typeof a[0]!="number"&&(this.mixKeyframes=Mp(Age,PF(a[0],a[1])),a=[0,100]);const h=u({...e,keyframes:a});s==="mirror"&&(this.mirroredGenerator=u({...e,keyframes:[...a].reverse(),velocity:-o})),h.calculatedDuration===null&&(h.calculatedDuration=OA(h));const{calculatedDuration:d}=h;this.calculatedDuration=d,this.resolvedDuration=d+i,this.totalDuration=this.resolvedDuration*(r+1)-i,this.generator=h}updateTime(e){const t=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=t}tick(e,t=!1){const{generator:r,totalDuration:i,mixKeyframes:s,mirroredGenerator:o,resolvedDuration:a,calculatedDuration:u}=this;if(this.startTime===null)return r.next(0);const{delay:h=0,keyframes:d,repeat:g,repeatType:y,repeatDelay:v,type:T,onUpdate:w,finalKeyframe:E}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-i/this.speed,this.startTime)),t?this.currentTime=e:this.updateTime(e);const S=this.currentTime-h*(this.playbackSpeed>=0?1:-1),P=this.playbackSpeed>=0?S<0:S>i;this.currentTime=Math.max(S,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=i);let I=this.currentTime,L=r;if(g){const M=Math.min(this.currentTime,i)/a;let N=Math.floor(M),H=M%1;!H&&M>=1&&(H=1),H===1&&N--,N=Math.min(N,g+1),!!(N%2)&&(y==="reverse"?(H=1-H,v&&(H-=v/a)):y==="mirror"&&(L=o)),I=uo(0,1,H)*a}const F=P?{done:!1,value:d[0]}:L.next(I);s&&(F.value=s(F.value));let{done:Y}=F;!P&&u!==null&&(Y=this.playbackSpeed>=0?this.currentTime>=i:this.currentTime<=0);const k=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&Y);return k&&T!==Cx&&(F.value=kA(d,this.options,E,this.speed)),w&&w(F.value),k&&this.finish(),F}then(e,t){return this.finished.then(e,t)}get duration(){return ni(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+ni(e)}get time(){return ni(this.currentTime)}set time(e){e=cs(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(br.now());const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=ni(this.currentTime))}play(){if(this.isStopped)return;const{driver:e=lge,startTime:t}=this.options;this.driver||(this.driver=e(i=>this.tick(i))),this.options.onPlay?.();const r=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=r):this.holdTime!==null?this.startTime=r-this.holdTime:this.startTime||(this.startTime=t??r),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(br.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),e.observe(this)}}function Sge(n){for(let e=1;e<n.length;e++)n[e]??(n[e]=n[e-1])}const Ll=n=>n*180/Math.PI,Ix=n=>{const e=Ll(Math.atan2(n[1],n[0]));return Px(e)},Rge={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:n=>(Math.abs(n[0])+Math.abs(n[3]))/2,rotate:Ix,rotateZ:Ix,skewX:n=>Ll(Math.atan(n[1])),skewY:n=>Ll(Math.atan(n[2])),skew:n=>(Math.abs(n[1])+Math.abs(n[2]))/2},Px=n=>(n=n%360,n<0&&(n+=360),n),OO=Ix,kO=n=>Math.sqrt(n[0]*n[0]+n[1]*n[1]),NO=n=>Math.sqrt(n[4]*n[4]+n[5]*n[5]),Cge={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:kO,scaleY:NO,scale:n=>(kO(n)+NO(n))/2,rotateX:n=>Px(Ll(Math.atan2(n[6],n[5]))),rotateY:n=>Px(Ll(Math.atan2(-n[2],n[0]))),rotateZ:OO,rotate:OO,skewX:n=>Ll(Math.atan(n[4])),skewY:n=>Ll(Math.atan(n[1])),skew:n=>(Math.abs(n[1])+Math.abs(n[4]))/2};function Mx(n){return n.includes("scale")?1:0}function Ox(n,e){if(!n||n==="none")return Mx(e);const t=n.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let r,i;if(t)r=Cge,i=t;else{const a=n.match(/^matrix\(([-\d.e\s,]+)\)$/u);r=Rge,i=a}if(!i)return Mx(e);const s=r[e],o=i[1].split(",").map(Pge);return typeof s=="function"?s(o):o[s]}const Ige=(n,e)=>{const{transform:t="none"}=getComputedStyle(n);return Ox(t,e)};function Pge(n){return parseFloat(n.trim())}const Dh=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Lh=new Set(Dh),DO=n=>n===Nh||n===$e,Mge=new Set(["x","y","z"]),Oge=Dh.filter(n=>!Mge.has(n));function kge(n){const e=[];return Oge.forEach(t=>{const r=n.getValue(t);r!==void 0&&(e.push([t,r.get()]),r.set(t.startsWith("scale")?1:0))}),e}const Hl={width:({x:n},{paddingLeft:e="0",paddingRight:t="0"})=>n.max-n.min-parseFloat(e)-parseFloat(t),height:({y:n},{paddingTop:e="0",paddingBottom:t="0"})=>n.max-n.min-parseFloat(e)-parseFloat(t),top:(n,{top:e})=>parseFloat(e),left:(n,{left:e})=>parseFloat(e),bottom:({y:n},{top:e})=>parseFloat(e)+(n.max-n.min),right:({x:n},{left:e})=>parseFloat(e)+(n.max-n.min),x:(n,{transform:e})=>Ox(e,"x"),y:(n,{transform:e})=>Ox(e,"y")};Hl.translateX=Hl.x;Hl.translateY=Hl.y;const $l=new Set;let kx=!1,Nx=!1,Dx=!1;function NF(){if(Nx){const n=Array.from($l).filter(r=>r.needsMeasurement),e=new Set(n.map(r=>r.element)),t=new Map;e.forEach(r=>{const i=kge(r);i.length&&(t.set(r,i),r.render())}),n.forEach(r=>r.measureInitialState()),e.forEach(r=>{r.render();const i=t.get(r);i&&i.forEach(([s,o])=>{r.getValue(s)?.set(o)})}),n.forEach(r=>r.measureEndState()),n.forEach(r=>{r.suspendedScrollY!==void 0&&window.scrollTo(0,r.suspendedScrollY)})}Nx=!1,kx=!1,$l.forEach(n=>n.complete(Dx)),$l.clear()}function DF(){$l.forEach(n=>{n.readKeyframes(),n.needsMeasurement&&(Nx=!0)})}function Nge(){Dx=!0,DF(),NF(),Dx=!1}class LA{constructor(e,t,r,i,s,o=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=r,this.motionValue=i,this.element=s,this.isAsync=o}scheduleResolve(){this.state="scheduled",this.isAsync?($l.add(this),kx||(kx=!0,Dt.read(DF),Dt.resolveKeyframes(NF))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:r,motionValue:i}=this;if(e[0]===null){const s=i?.get(),o=e[e.length-1];if(s!==void 0)e[0]=s;else if(r&&t){const a=r.readValue(t,o);a!=null&&(e[0]=a)}e[0]===void 0&&(e[0]=o),i&&s===void 0&&i.set(e[0])}Sge(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),$l.delete(this)}cancel(){this.state==="scheduled"&&($l.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const Dge=n=>n.startsWith("--");function Lge(n,e,t){Dge(e)?n.style.setProperty(e,t):n.style[e]=t}const Uge=xA(()=>window.ScrollTimeline!==void 0),Vge={};function Fge(n,e){const t=xA(n);return()=>Vge[e]??t()}const LF=Fge(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),hd=([n,e,t,r])=>`cubic-bezier(${n}, ${e}, ${t}, ${r})`,LO={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:hd([0,.65,.55,1]),circOut:hd([.55,0,1,.45]),backIn:hd([.31,.01,.66,-.59]),backOut:hd([.33,1.53,.69,.99])};function UF(n,e){if(n)return typeof n=="function"?LF()?MF(n,e):"ease-out":TF(n)?hd(n):Array.isArray(n)?n.map(t=>UF(t,e)||LO.easeOut):LO[n]}function Bge(n,e,t,{delay:r=0,duration:i=300,repeat:s=0,repeatType:o="loop",ease:a="easeOut",times:u}={},h=void 0){const d={[e]:t};u&&(d.offset=u);const g=UF(a,i);Array.isArray(g)&&(d.easing=g);const y={delay:r,duration:i,easing:Array.isArray(g)?"linear":g,fill:"both",iterations:s+1,direction:o==="reverse"?"alternate":"normal"};return h&&(y.pseudoElement=h),n.animate(d,y)}function VF(n){return typeof n=="function"&&"applyToOptions"in n}function zge({type:n,...e}){return VF(n)&&LF()?n.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class jge extends NA{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:t,name:r,keyframes:i,pseudoElement:s,allowFlatten:o=!1,finalKeyframe:a,onComplete:u}=e;this.isPseudoElement=!!s,this.allowFlatten=o,this.options=e,wA(typeof e.type!="string");const h=zge(e);this.animation=Bge(t,r,i,h,s),h.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!s){const d=kA(i,this.options,a,this.speed);this.updateMotionValue?this.updateMotionValue(d):Lge(t,r,d),this.animation.cancel()}u?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const e=this.animation.effect?.getComputedTiming?.().duration||0;return ni(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+ni(e)}get time(){return ni(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=cs(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:t}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,e&&Uge()?(this.animation.timeline=e,oi):t(this)}}const FF={anticipate:yF,backInOut:mF,circInOut:vF};function Hge(n){return n in FF}function $ge(n){typeof n.ease=="string"&&Hge(n.ease)&&(n.ease=FF[n.ease])}const UO=10;class Wge extends jge{constructor(e){$ge(e),kF(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:t,onUpdate:r,onComplete:i,element:s,...o}=this.options;if(!t)return;if(e!==void 0){t.set(e);return}const a=new DA({...o,autoplay:!1}),u=cs(this.finishedTime??this.time);t.setWithVelocity(a.sample(u-UO).value,a.sample(u).value,UO),a.stop()}}const VO=(n,e)=>e==="zIndex"?!1:!!(typeof n=="number"||Array.isArray(n)||typeof n=="string"&&(Va.test(n)||n==="0")&&!n.startsWith("url("));function qge(n){const e=n[0];if(n.length===1)return!0;for(let t=0;t<n.length;t++)if(n[t]!==e)return!0}function Xge(n,e,t,r){const i=n[0];if(i===null)return!1;if(e==="display"||e==="visibility")return!0;const s=n[n.length-1],o=VO(i,e),a=VO(s,e);return!o||!a?!1:qge(n)||(t==="spring"||VF(t))&&r}function Lx(n){n.duration=0,n.type="keyframes"}const Yge=new Set(["opacity","clipPath","filter","transform"]),Kge=xA(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function Gge(n){const{motionValue:e,name:t,repeatDelay:r,repeatType:i,damping:s,type:o}=n;if(!(e?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:u,transformTemplate:h}=e.owner.getProps();return Kge()&&t&&Yge.has(t)&&(t!=="transform"||!h)&&!u&&!r&&i!=="mirror"&&s!==0&&o!=="inertia"}const Zge=40;class Qge extends NA{constructor({autoplay:e=!0,delay:t=0,type:r="keyframes",repeat:i=0,repeatDelay:s=0,repeatType:o="loop",keyframes:a,name:u,motionValue:h,element:d,...g}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=br.now();const y={autoplay:e,delay:t,type:r,repeat:i,repeatDelay:s,repeatType:o,name:u,motionValue:h,element:d,...g},v=d?.KeyframeResolver||LA;this.keyframeResolver=new v(a,(T,w,E)=>this.onKeyframesResolved(T,w,y,!E),u,h,d),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(e,t,r,i){this.keyframeResolver=void 0;const{name:s,type:o,velocity:a,delay:u,isHandoff:h,onUpdate:d}=r;this.resolvedAt=br.now(),Xge(e,s,o,a)||((ho.instantAnimations||!u)&&d?.(kA(e,r,t)),e[0]=e[e.length-1],Lx(r),r.repeat=0);const y={startTime:i?this.resolvedAt?this.resolvedAt-this.createdAt>Zge?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:t,...r,keyframes:e},v=!h&&Gge(y)?new Wge({...y,element:y.motionValue.owner.current}):new DA(y);v.finished.then(()=>this.notifyFinished()).catch(oi),this.pendingTimeline&&(this.stopTimeline=v.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=v}get finished(){return this._animation?this.animation.finished:this._finished}then(e,t){return this.finished.finally(e).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),Nge()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const Jge=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function eme(n){const e=Jge.exec(n);if(!e)return[,];const[,t,r,i]=e;return[`--${t??r}`,i]}function BF(n,e,t=1){const[r,i]=eme(n);if(!r)return;const s=window.getComputedStyle(e).getPropertyValue(r);if(s){const o=s.trim();return lF(o)?parseFloat(o):o}return CA(i)?BF(i,e,t+1):i}function UA(n,e){return n?.[e]??n?.default??n}const zF=new Set(["width","height","top","left","right","bottom",...Dh]),tme={test:n=>n==="auto",parse:n=>n},jF=n=>e=>e.test(n),HF=[Nh,$e,us,oa,qpe,Wpe,tme],FO=n=>HF.find(jF(n));function nme(n){return typeof n=="number"?n===0:n!==null?n==="none"||n==="0"||uF(n):!0}const rme=new Set(["brightness","contrast","saturate","opacity"]);function ime(n){const[e,t]=n.slice(0,-1).split("(");if(e==="drop-shadow")return n;const[r]=t.match(IA)||[];if(!r)return n;const i=t.replace(r,"");let s=rme.has(e)?1:0;return r!==t&&(s*=100),e+"("+s+i+")"}const sme=/\b([a-z-]*)\(.*?\)/gu,Ux={...Va,getAnimatableNone:n=>{const e=n.match(sme);return e?e.map(ime).join(" "):n}},BO={...Nh,transform:Math.round},ome={rotate:oa,rotateX:oa,rotateY:oa,rotateZ:oa,scale:jm,scaleX:jm,scaleY:jm,scaleZ:jm,skew:oa,skewX:oa,skewY:oa,distance:$e,translateX:$e,translateY:$e,translateZ:$e,x:$e,y:$e,z:$e,perspective:$e,transformPerspective:$e,opacity:ip,originX:RO,originY:RO,originZ:$e},VA={borderWidth:$e,borderTopWidth:$e,borderRightWidth:$e,borderBottomWidth:$e,borderLeftWidth:$e,borderRadius:$e,radius:$e,borderTopLeftRadius:$e,borderTopRightRadius:$e,borderBottomRightRadius:$e,borderBottomLeftRadius:$e,width:$e,maxWidth:$e,height:$e,maxHeight:$e,top:$e,right:$e,bottom:$e,left:$e,padding:$e,paddingTop:$e,paddingRight:$e,paddingBottom:$e,paddingLeft:$e,margin:$e,marginTop:$e,marginRight:$e,marginBottom:$e,marginLeft:$e,backgroundPositionX:$e,backgroundPositionY:$e,...ome,zIndex:BO,fillOpacity:ip,strokeOpacity:ip,numOctaves:BO},ame={...VA,color:cn,backgroundColor:cn,outlineColor:cn,fill:cn,stroke:cn,borderColor:cn,borderTopColor:cn,borderRightColor:cn,borderBottomColor:cn,borderLeftColor:cn,filter:Ux,WebkitFilter:Ux},$F=n=>ame[n];function WF(n,e){let t=$F(n);return t!==Ux&&(t=Va),t.getAnimatableNone?t.getAnimatableNone(e):void 0}const lme=new Set(["auto","none","0"]);function cme(n,e,t){let r=0,i;for(;r<n.length&&!i;){const s=n[r];typeof s=="string"&&!lme.has(s)&&sp(s).values.length&&(i=n[r]),r++}if(i&&t)for(const s of e)n[s]=WF(t,i)}class ume extends LA{constructor(e,t,r,i,s){super(e,t,r,i,s,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:r}=this;if(!t||!t.current)return;super.readKeyframes();for(let u=0;u<e.length;u++){let h=e[u];if(typeof h=="string"&&(h=h.trim(),CA(h))){const d=BF(h,t.current);d!==void 0&&(e[u]=d),u===e.length-1&&(this.finalKeyframe=h)}}if(this.resolveNoneKeyframes(),!zF.has(r)||e.length!==2)return;const[i,s]=e,o=FO(i),a=FO(s);if(o!==a)if(DO(o)&&DO(a))for(let u=0;u<e.length;u++){const h=e[u];typeof h=="string"&&(e[u]=parseFloat(h))}else Hl[r]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,r=[];for(let i=0;i<e.length;i++)(e[i]===null||nme(e[i]))&&r.push(i);r.length&&cme(e,r,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:r}=this;if(!e||!e.current)return;r==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Hl[r](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const i=t[t.length-1];i!==void 0&&e.getValue(r,i).jump(i,!1)}measureEndState(){const{element:e,name:t,unresolvedKeyframes:r}=this;if(!e||!e.current)return;const i=e.getValue(t);i&&i.jump(this.measuredOrigin,!1);const s=r.length-1,o=r[s];r[s]=Hl[t](e.measureViewportBox(),window.getComputedStyle(e.current)),o!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=o),this.removedTransforms?.length&&this.removedTransforms.forEach(([a,u])=>{e.getValue(a).set(u)}),this.resolveNoneKeyframes()}}function hme(n,e,t){if(n instanceof EventTarget)return[n];if(typeof n=="string"){let r=document;const i=t?.[n]??r.querySelectorAll(n);return i?Array.from(i):[]}return Array.from(n)}const qF=(n,e)=>e&&typeof n=="number"?e.transform(n):n;function XF(n){return cF(n)&&"offsetHeight"in n}const zO=30,fme=n=>!isNaN(parseFloat(n));class dme{constructor(e,t={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=r=>{const i=br.now();if(this.updatedAt!==i&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(r),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const s of this.dependents)s.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){this.current=e,this.updatedAt=br.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=fme(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new EA);const r=this.events[e].add(t);return e==="change"?()=>{r(),Dt.read(()=>{this.events.change.getSize()||this.stop()})}:r}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,t,r){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-r}jump(e,t=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=br.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>zO)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,zO);return hF(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function fh(n,e){return new dme(n,e)}const{schedule:FA}=wF(queueMicrotask,!1),Ti={x:!1,y:!1};function YF(){return Ti.x||Ti.y}function pme(n){return n==="x"||n==="y"?Ti[n]?null:(Ti[n]=!0,()=>{Ti[n]=!1}):Ti.x||Ti.y?null:(Ti.x=Ti.y=!0,()=>{Ti.x=Ti.y=!1})}function KF(n,e){const t=hme(n),r=new AbortController,i={passive:!0,...e,signal:r.signal};return[t,i,()=>r.abort()]}function jO(n){return!(n.pointerType==="touch"||YF())}function gme(n,e,t={}){const[r,i,s]=KF(n,t),o=a=>{if(!jO(a))return;const{target:u}=a,h=e(u,a);if(typeof h!="function"||!u)return;const d=g=>{jO(g)&&(h(g),u.removeEventListener("pointerleave",d))};u.addEventListener("pointerleave",d,i)};return r.forEach(a=>{a.addEventListener("pointerenter",o,i)}),s}const GF=(n,e)=>e?n===e?!0:GF(n,e.parentElement):!1,BA=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1,mme=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function yme(n){return mme.has(n.tagName)||n.tabIndex!==-1}const wy=new WeakSet;function HO(n){return e=>{e.key==="Enter"&&n(e)}}function $T(n,e){n.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const _me=(n,e)=>{const t=n.currentTarget;if(!t)return;const r=HO(()=>{if(wy.has(t))return;$T(t,"down");const i=HO(()=>{$T(t,"up")}),s=()=>$T(t,"cancel");t.addEventListener("keyup",i,e),t.addEventListener("blur",s,e)});t.addEventListener("keydown",r,e),t.addEventListener("blur",()=>t.removeEventListener("keydown",r),e)};function $O(n){return BA(n)&&!YF()}function vme(n,e,t={}){const[r,i,s]=KF(n,t),o=a=>{const u=a.currentTarget;if(!$O(a))return;wy.add(u);const h=e(u,a),d=(v,T)=>{window.removeEventListener("pointerup",g),window.removeEventListener("pointercancel",y),wy.has(u)&&wy.delete(u),$O(v)&&typeof h=="function"&&h(v,{success:T})},g=v=>{d(v,u===window||u===document||t.useGlobalTarget||GF(u,v.target))},y=v=>{d(v,!1)};window.addEventListener("pointerup",g,i),window.addEventListener("pointercancel",y,i)};return r.forEach(a=>{(t.useGlobalTarget?window:a).addEventListener("pointerdown",o,i),XF(a)&&(a.addEventListener("focus",h=>_me(h,i)),!yme(a)&&!a.hasAttribute("tabindex")&&(a.tabIndex=0))}),s}function ZF(n){return cF(n)&&"ownerSVGElement"in n}function bme(n){return ZF(n)&&n.tagName==="svg"}const nr=n=>!!(n&&n.getVelocity),Tme=[...HF,cn,Va],wme=n=>Tme.find(jF(n)),zA=A.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"});function WO(n,e){if(typeof n=="function")return n(e);n!=null&&(n.current=e)}function xme(...n){return e=>{let t=!1;const r=n.map(i=>{const s=WO(i,e);return!t&&typeof s=="function"&&(t=!0),s});if(t)return()=>{for(let i=0;i<r.length;i++){const s=r[i];typeof s=="function"?s():WO(n[i],null)}}}}function Eme(...n){return A.useCallback(xme(...n),n)}class Ame extends A.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const r=t.offsetParent,i=XF(r)&&r.offsetWidth||0,s=this.props.sizeRef.current;s.height=t.offsetHeight||0,s.width=t.offsetWidth||0,s.top=t.offsetTop,s.left=t.offsetLeft,s.right=i-s.width-s.left}return null}componentDidUpdate(){}render(){return this.props.children}}function Sme({children:n,isPresent:e,anchorX:t,root:r}){const i=A.useId(),s=A.useRef(null),o=A.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:a}=A.useContext(zA),u=Eme(s,n?.ref);return A.useInsertionEffect(()=>{const{width:h,height:d,top:g,left:y,right:v}=o.current;if(e||!s.current||!h||!d)return;const T=t==="left"?`left: ${y}`:`right: ${v}`;s.current.dataset.motionPopId=i;const w=document.createElement("style");a&&(w.nonce=a);const E=r??document.head;return E.appendChild(w),w.sheet&&w.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${h}px !important;
            height: ${d}px !important;
            ${T}px !important;
            top: ${g}px !important;
          }
        `),()=>{E.contains(w)&&E.removeChild(w)}},[e]),$.jsx(Ame,{isPresent:e,childRef:s,sizeRef:o,children:A.cloneElement(n,{ref:u})})}const Rme=({children:n,initial:e,isPresent:t,onExitComplete:r,custom:i,presenceAffectsLayout:s,mode:o,anchorX:a,root:u})=>{const h=_A(Cme),d=A.useId();let g=!0,y=A.useMemo(()=>(g=!1,{id:d,initial:e,isPresent:t,custom:i,onExitComplete:v=>{h.set(v,!0);for(const T of h.values())if(!T)return;r&&r()},register:v=>(h.set(v,!1),()=>h.delete(v))}),[t,h,r]);return s&&g&&(y={...y}),A.useMemo(()=>{h.forEach((v,T)=>h.set(T,!1))},[t]),A.useEffect(()=>{!t&&!h.size&&r&&r()},[t]),o==="popLayout"&&(n=$.jsx(Sme,{isPresent:t,anchorX:a,root:u,children:n})),$.jsx(gv.Provider,{value:y,children:n})};function Cme(){return new Map}function QF(n=!0){const e=A.useContext(gv);if(e===null)return[!0,null];const{isPresent:t,onExitComplete:r,register:i}=e,s=A.useId();A.useEffect(()=>{if(n)return i(s)},[n]);const o=A.useCallback(()=>n&&r&&r(s),[s,r,n]);return!t&&r?[!1,o]:[!0]}const Hm=n=>n.key||"";function qO(n){const e=[];return A.Children.forEach(n,t=>{A.isValidElement(t)&&e.push(t)}),e}const Ime=({children:n,custom:e,initial:t=!0,onExitComplete:r,presenceAffectsLayout:i=!0,mode:s="sync",propagate:o=!1,anchorX:a="left",root:u})=>{const[h,d]=QF(o),g=A.useMemo(()=>qO(n),[n]),y=o&&!h?[]:g.map(Hm),v=A.useRef(!0),T=A.useRef(g),w=_A(()=>new Map),[E,S]=A.useState(g),[P,I]=A.useState(g);aF(()=>{v.current=!1,T.current=g;for(let Y=0;Y<P.length;Y++){const k=Hm(P[Y]);y.includes(k)?w.delete(k):w.get(k)!==!0&&w.set(k,!1)}},[P,y.length,y.join("-")]);const L=[];if(g!==E){let Y=[...g];for(let k=0;k<P.length;k++){const M=P[k],N=Hm(M);y.includes(N)||(Y.splice(k,0,M),L.push(M))}return s==="wait"&&L.length&&(Y=L),I(qO(Y)),S(g),null}const{forceRender:F}=A.useContext(yA);return $.jsx($.Fragment,{children:P.map(Y=>{const k=Hm(Y),M=o&&!h?!1:g===P||y.includes(k),N=()=>{if(w.has(k))w.set(k,!0);else return;let H=!0;w.forEach(q=>{q||(H=!1)}),H&&(F?.(),I(T.current),o&&d?.(),r&&r())};return $.jsx(Rme,{isPresent:M,initial:!v.current||t?void 0:!1,custom:e,presenceAffectsLayout:i,mode:s,root:u,onExitComplete:M?void 0:N,anchorX:a,children:Y},k)})})},JF=A.createContext({strict:!1}),XO={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},dh={};for(const n in XO)dh[n]={isEnabled:e=>XO[n].some(t=>!!e[t])};function Pme(n){for(const e in n)dh[e]={...dh[e],...n[e]}}const Mme=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function E_(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||Mme.has(n)}let eB=n=>!E_(n);function Ome(n){typeof n=="function"&&(eB=e=>e.startsWith("on")?!E_(e):n(e))}try{Ome(require("@emotion/is-prop-valid").default)}catch{}function kme(n,e,t){const r={};for(const i in n)i==="values"&&typeof n.values=="object"||(eB(i)||t===!0&&E_(i)||!e&&!E_(i)||n.draggable&&i.startsWith("onDrag"))&&(r[i]=n[i]);return r}const mv=A.createContext({});function yv(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}function op(n){return typeof n=="string"||Array.isArray(n)}const jA=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],HA=["initial",...jA];function _v(n){return yv(n.animate)||HA.some(e=>op(n[e]))}function tB(n){return!!(_v(n)||n.variants)}function Nme(n,e){if(_v(n)){const{initial:t,animate:r}=n;return{initial:t===!1||op(t)?t:void 0,animate:op(r)?r:void 0}}return n.inherit!==!1?e:{}}function Dme(n){const{initial:e,animate:t}=Nme(n,A.useContext(mv));return A.useMemo(()=>({initial:e,animate:t}),[YO(e),YO(t)])}function YO(n){return Array.isArray(n)?n.join(" "):n}const ap={};function Lme(n){for(const e in n)ap[e]=n[e],RA(e)&&(ap[e].isCSSVariable=!0)}function nB(n,{layout:e,layoutId:t}){return Lh.has(n)||n.startsWith("origin")||(e||t!==void 0)&&(!!ap[n]||n==="opacity")}const Ume={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Vme=Dh.length;function Fme(n,e,t){let r="",i=!0;for(let s=0;s<Vme;s++){const o=Dh[s],a=n[o];if(a===void 0)continue;let u=!0;if(typeof a=="number"?u=a===(o.startsWith("scale")?1:0):u=parseFloat(a)===0,!u||t){const h=qF(a,VA[o]);if(!u){i=!1;const d=Ume[o]||o;r+=`${d}(${h}) `}t&&(e[o]=h)}}return r=r.trim(),t?r=t(e,i?"":r):i&&(r="none"),r}function $A(n,e,t){const{style:r,vars:i,transformOrigin:s}=n;let o=!1,a=!1;for(const u in e){const h=e[u];if(Lh.has(u)){o=!0;continue}else if(RA(u)){i[u]=h;continue}else{const d=qF(h,VA[u]);u.startsWith("origin")?(a=!0,s[u]=d):r[u]=d}}if(e.transform||(o||t?r.transform=Fme(e,n.transform,t):r.transform&&(r.transform="none")),a){const{originX:u="50%",originY:h="50%",originZ:d=0}=s;r.transformOrigin=`${u} ${h} ${d}`}}const WA=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function rB(n,e,t){for(const r in e)!nr(e[r])&&!nB(r,t)&&(n[r]=e[r])}function Bme({transformTemplate:n},e){return A.useMemo(()=>{const t=WA();return $A(t,e,n),Object.assign({},t.vars,t.style)},[e])}function zme(n,e){const t=n.style||{},r={};return rB(r,t,n),Object.assign(r,Bme(n,e)),r}function jme(n,e){const t={},r=zme(n,e);return n.drag&&n.dragListener!==!1&&(t.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(t.tabIndex=0),t.style=r,t}const Hme={offset:"stroke-dashoffset",array:"stroke-dasharray"},$me={offset:"strokeDashoffset",array:"strokeDasharray"};function Wme(n,e,t=1,r=0,i=!0){n.pathLength=1;const s=i?Hme:$me;n[s.offset]=$e.transform(-r);const o=$e.transform(e),a=$e.transform(t);n[s.array]=`${o} ${a}`}function iB(n,{attrX:e,attrY:t,attrScale:r,pathLength:i,pathSpacing:s=1,pathOffset:o=0,...a},u,h,d){if($A(n,a,h),u){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:g,style:y}=n;g.transform&&(y.transform=g.transform,delete g.transform),(y.transform||g.transformOrigin)&&(y.transformOrigin=g.transformOrigin??"50% 50%",delete g.transformOrigin),y.transform&&(y.transformBox=d?.transformBox??"fill-box",delete g.transformBox),e!==void 0&&(g.x=e),t!==void 0&&(g.y=t),r!==void 0&&(g.scale=r),i!==void 0&&Wme(g,i,s,o,!1)}const sB=()=>({...WA(),attrs:{}}),oB=n=>typeof n=="string"&&n.toLowerCase()==="svg";function qme(n,e,t,r){const i=A.useMemo(()=>{const s=sB();return iB(s,e,oB(r),n.transformTemplate,n.style),{...s.attrs,style:{...s.style}}},[e]);if(n.style){const s={};rB(s,n.style,n),i.style={...s,...i.style}}return i}const Xme=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function qA(n){return typeof n!="string"||n.includes("-")?!1:!!(Xme.indexOf(n)>-1||/[A-Z]/u.test(n))}function Yme(n,e,t,{latestValues:r},i,s=!1){const a=(qA(n)?qme:jme)(e,r,i,n),u=kme(e,typeof n=="string",s),h=n!==A.Fragment?{...u,...a,ref:t}:{},{children:d}=e,g=A.useMemo(()=>nr(d)?d.get():d,[d]);return A.createElement(n,{...h,children:g})}function KO(n){const e=[{},{}];return n?.values.forEach((t,r)=>{e[0][r]=t.get(),e[1][r]=t.getVelocity()}),e}function XA(n,e,t,r){if(typeof e=="function"){const[i,s]=KO(r);e=e(t!==void 0?t:n.custom,i,s)}if(typeof e=="string"&&(e=n.variants&&n.variants[e]),typeof e=="function"){const[i,s]=KO(r);e=e(t!==void 0?t:n.custom,i,s)}return e}function xy(n){return nr(n)?n.get():n}function Kme({scrapeMotionValuesFromProps:n,createRenderState:e},t,r,i){return{latestValues:Gme(t,r,i,n),renderState:e()}}function Gme(n,e,t,r){const i={},s=r(n,{});for(const y in s)i[y]=xy(s[y]);let{initial:o,animate:a}=n;const u=_v(n),h=tB(n);e&&h&&!u&&n.inherit!==!1&&(o===void 0&&(o=e.initial),a===void 0&&(a=e.animate));let d=t?t.initial===!1:!1;d=d||o===!1;const g=d?a:o;if(g&&typeof g!="boolean"&&!yv(g)){const y=Array.isArray(g)?g:[g];for(let v=0;v<y.length;v++){const T=XA(n,y[v]);if(T){const{transitionEnd:w,transition:E,...S}=T;for(const P in S){let I=S[P];if(Array.isArray(I)){const L=d?I.length-1:0;I=I[L]}I!==null&&(i[P]=I)}for(const P in w)i[P]=w[P]}}}return i}const aB=n=>(e,t)=>{const r=A.useContext(mv),i=A.useContext(gv),s=()=>Kme(n,e,r,i);return t?s():_A(s)};function YA(n,e,t){const{style:r}=n,i={};for(const s in r)(nr(r[s])||e.style&&nr(e.style[s])||nB(s,n)||t?.getValue(s)?.liveStyle!==void 0)&&(i[s]=r[s]);return i}const Zme=aB({scrapeMotionValuesFromProps:YA,createRenderState:WA});function lB(n,e,t){const r=YA(n,e,t);for(const i in n)if(nr(n[i])||nr(e[i])){const s=Dh.indexOf(i)!==-1?"attr"+i.charAt(0).toUpperCase()+i.substring(1):i;r[s]=n[i]}return r}const Qme=aB({scrapeMotionValuesFromProps:lB,createRenderState:sB}),Jme=Symbol.for("motionComponentSymbol");function Mu(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function eye(n,e,t){return A.useCallback(r=>{r&&n.onMount&&n.onMount(r),e&&(r?e.mount(r):e.unmount()),t&&(typeof t=="function"?t(r):Mu(t)&&(t.current=r))},[e])}const KA=n=>n.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),tye="framerAppearId",cB="data-"+KA(tye),uB=A.createContext({});function nye(n,e,t,r,i){const{visualElement:s}=A.useContext(mv),o=A.useContext(JF),a=A.useContext(gv),u=A.useContext(zA).reducedMotion,h=A.useRef(null);r=r||o.renderer,!h.current&&r&&(h.current=r(n,{visualState:e,parent:s,props:t,presenceContext:a,blockInitialAnimation:a?a.initial===!1:!1,reducedMotionConfig:u}));const d=h.current,g=A.useContext(uB);d&&!d.projection&&i&&(d.type==="html"||d.type==="svg")&&rye(h.current,t,i,g);const y=A.useRef(!1);A.useInsertionEffect(()=>{d&&y.current&&d.update(t,a)});const v=t[cB],T=A.useRef(!!v&&!window.MotionHandoffIsComplete?.(v)&&window.MotionHasOptimisedAnimation?.(v));return aF(()=>{d&&(y.current=!0,window.MotionIsMounted=!0,d.updateFeatures(),d.scheduleRenderMicrotask(),T.current&&d.animationState&&d.animationState.animateChanges())}),A.useEffect(()=>{d&&(!T.current&&d.animationState&&d.animationState.animateChanges(),T.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(v)}),T.current=!1),d.enteringChildren=void 0)}),d}function rye(n,e,t,r){const{layoutId:i,layout:s,drag:o,dragConstraints:a,layoutScroll:u,layoutRoot:h,layoutCrossfade:d}=e;n.projection=new t(n.latestValues,e["data-framer-portal-id"]?void 0:hB(n.parent)),n.projection.setOptions({layoutId:i,layout:s,alwaysMeasureLayout:!!o||a&&Mu(a),visualElement:n,animationType:typeof s=="string"?s:"both",initialPromotionConfig:r,crossfade:d,layoutScroll:u,layoutRoot:h})}function hB(n){if(n)return n.options.allowProjection!==!1?n.projection:hB(n.parent)}function WT(n,{forwardMotionProps:e=!1}={},t,r){t&&Pme(t);const i=qA(n)?Qme:Zme;function s(a,u){let h;const d={...A.useContext(zA),...a,layoutId:iye(a)},{isStatic:g}=d,y=Dme(a),v=i(a,g);if(!g&&vA){sye();const T=oye(d);h=T.MeasureLayout,y.visualElement=nye(n,v,d,r,T.ProjectionNode)}return $.jsxs(mv.Provider,{value:y,children:[h&&y.visualElement?$.jsx(h,{visualElement:y.visualElement,...d}):null,Yme(n,a,eye(v,y.visualElement,u),v,g,e)]})}s.displayName=`motion.${typeof n=="string"?n:`create(${n.displayName??n.name??""})`}`;const o=A.forwardRef(s);return o[Jme]=n,o}function iye({layoutId:n}){const e=A.useContext(yA).id;return e&&n!==void 0?e+"-"+n:n}function sye(n,e){A.useContext(JF).strict}function oye(n){const{drag:e,layout:t}=dh;if(!e&&!t)return{};const r={...e,...t};return{MeasureLayout:e?.isEnabled(n)||t?.isEnabled(n)?r.MeasureLayout:void 0,ProjectionNode:r.ProjectionNode}}function aye(n,e){if(typeof Proxy>"u")return WT;const t=new Map,r=(s,o)=>WT(s,o,n,e),i=(s,o)=>r(s,o);return new Proxy(i,{get:(s,o)=>o==="create"?r:(t.has(o)||t.set(o,WT(o,void 0,n,e)),t.get(o))})}function fB({top:n,left:e,right:t,bottom:r}){return{x:{min:e,max:t},y:{min:n,max:r}}}function lye({x:n,y:e}){return{top:e.min,right:n.max,bottom:e.max,left:n.min}}function cye(n,e){if(!e)return n;const t=e({x:n.left,y:n.top}),r=e({x:n.right,y:n.bottom});return{top:t.y,left:t.x,bottom:r.y,right:r.x}}function qT(n){return n===void 0||n===1}function Vx({scale:n,scaleX:e,scaleY:t}){return!qT(n)||!qT(e)||!qT(t)}function Pl(n){return Vx(n)||dB(n)||n.z||n.rotate||n.rotateX||n.rotateY||n.skewX||n.skewY}function dB(n){return GO(n.x)||GO(n.y)}function GO(n){return n&&n!=="0%"}function A_(n,e,t){const r=n-t,i=e*r;return t+i}function ZO(n,e,t,r,i){return i!==void 0&&(n=A_(n,i,r)),A_(n,t,r)+e}function Fx(n,e=0,t=1,r,i){n.min=ZO(n.min,e,t,r,i),n.max=ZO(n.max,e,t,r,i)}function pB(n,{x:e,y:t}){Fx(n.x,e.translate,e.scale,e.originPoint),Fx(n.y,t.translate,t.scale,t.originPoint)}const QO=.999999999999,JO=1.0000000000001;function uye(n,e,t,r=!1){const i=t.length;if(!i)return;e.x=e.y=1;let s,o;for(let a=0;a<i;a++){s=t[a],o=s.projectionDelta;const{visualElement:u}=s.options;u&&u.props.style&&u.props.style.display==="contents"||(r&&s.options.layoutScroll&&s.scroll&&s!==s.root&&ku(n,{x:-s.scroll.offset.x,y:-s.scroll.offset.y}),o&&(e.x*=o.x.scale,e.y*=o.y.scale,pB(n,o)),r&&Pl(s.latestValues)&&ku(n,s.latestValues))}e.x<JO&&e.x>QO&&(e.x=1),e.y<JO&&e.y>QO&&(e.y=1)}function Ou(n,e){n.min=n.min+e,n.max=n.max+e}function ek(n,e,t,r,i=.5){const s=Bt(n.min,n.max,i);Fx(n,e,t,s,r)}function ku(n,e){ek(n.x,e.x,e.scaleX,e.scale,e.originX),ek(n.y,e.y,e.scaleY,e.scale,e.originY)}function gB(n,e){return fB(cye(n.getBoundingClientRect(),e))}function hye(n,e,t){const r=gB(n,t),{scroll:i}=e;return i&&(Ou(r.x,i.offset.x),Ou(r.y,i.offset.y)),r}const tk=()=>({translate:0,scale:1,origin:0,originPoint:0}),Nu=()=>({x:tk(),y:tk()}),nk=()=>({min:0,max:0}),tn=()=>({x:nk(),y:nk()}),Bx={current:null},mB={current:!1};function fye(){if(mB.current=!0,!!vA)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),e=()=>Bx.current=n.matches;n.addEventListener("change",e),e()}else Bx.current=!1}const dye=new WeakMap;function pye(n,e,t){for(const r in e){const i=e[r],s=t[r];if(nr(i))n.addValue(r,i);else if(nr(s))n.addValue(r,fh(i,{owner:n}));else if(s!==i)if(n.hasValue(r)){const o=n.getValue(r);o.liveStyle===!0?o.jump(i):o.hasAnimated||o.set(i)}else{const o=n.getStaticValue(r);n.addValue(r,fh(o!==void 0?o:i,{owner:n}))}}for(const r in t)e[r]===void 0&&n.removeValue(r);return e}const rk=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class gye{scrapeMotionValuesFromProps(e,t,r){return{}}constructor({parent:e,props:t,presenceContext:r,reducedMotionConfig:i,blockInitialAnimation:s,visualState:o},a={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=LA,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const y=br.now();this.renderScheduledAt<y&&(this.renderScheduledAt=y,Dt.render(this.render,!1,!0))};const{latestValues:u,renderState:h}=o;this.latestValues=u,this.baseTarget={...u},this.initialValues=t.initial?{...u}:{},this.renderState=h,this.parent=e,this.props=t,this.presenceContext=r,this.depth=e?e.depth+1:0,this.reducedMotionConfig=i,this.options=a,this.blockInitialAnimation=!!s,this.isControllingVariants=_v(t),this.isVariantNode=tB(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:d,...g}=this.scrapeMotionValuesFromProps(t,{},this);for(const y in g){const v=g[y];u[y]!==void 0&&nr(v)&&v.set(u[y])}}mount(e){this.current=e,dye.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((t,r)=>this.bindToMotionValue(r,t)),mB.current||fye(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Bx.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),Ua(this.notifyUpdate),Ua(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const t=this.features[e];t&&(t.unmount(),t.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,t){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const r=Lh.has(e);r&&this.onBindTransform&&this.onBindTransform();const i=t.on("change",o=>{this.latestValues[e]=o,this.props.onUpdate&&Dt.preRender(this.notifyUpdate),r&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let s;window.MotionCheckAppearSync&&(s=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,()=>{i(),s&&s(),t.owner&&t.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in dh){const t=dh[e];if(!t)continue;const{isEnabled:r,Feature:i}=t;if(!this.features[e]&&i&&r(this.props)&&(this.features[e]=new i(this)),this.features[e]){const s=this.features[e];s.isMounted?s.update():(s.mount(),s.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):tn()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let r=0;r<rk.length;r++){const i=rk[r];this.propEventSubscriptions[i]&&(this.propEventSubscriptions[i](),delete this.propEventSubscriptions[i]);const s="on"+i,o=e[s];o&&(this.propEventSubscriptions[i]=this.on(i,o))}this.prevMotionValues=pye(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const r=this.values.get(e);t!==r&&(r&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let r=this.values.get(e);return r===void 0&&t!==void 0&&(r=fh(t===null?void 0:t,{owner:this}),this.addValue(e,r)),r}readValue(e,t){let r=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return r!=null&&(typeof r=="string"&&(lF(r)||uF(r))?r=parseFloat(r):!wme(r)&&Va.test(t)&&(r=WF(e,t)),this.setBaseTarget(e,nr(r)?r.get():r)),nr(r)?r.get():r}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){const{initial:t}=this.props;let r;if(typeof t=="string"||typeof t=="object"){const s=XA(this.props,t,this.presenceContext?.custom);s&&(r=s[e])}if(t&&r!==void 0)return r;const i=this.getBaseTargetFromProps(this.props,e);return i!==void 0&&!nr(i)?i:this.initialValues[e]!==void 0&&r===void 0?void 0:this.baseTarget[e]}on(e,t){return this.events[e]||(this.events[e]=new EA),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}scheduleRenderMicrotask(){FA.render(this.render)}}class yB extends gye{constructor(){super(...arguments),this.KeyframeResolver=ume}sortInstanceNodePosition(e,t){return e.compareDocumentPosition(t)&2?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,{vars:t,style:r}){delete t[e],delete r[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;nr(e)&&(this.childSubscription=e.on("change",t=>{this.current&&(this.current.textContent=`${t}`)}))}}function _B(n,{style:e,vars:t},r,i){const s=n.style;let o;for(o in e)s[o]=e[o];i?.applyProjectionStyles(s,r);for(o in t)s.setProperty(o,t[o])}function mye(n){return window.getComputedStyle(n)}class yye extends yB{constructor(){super(...arguments),this.type="html",this.renderInstance=_B}readValueFromInstance(e,t){if(Lh.has(t))return this.projection?.isProjecting?Mx(t):Ige(e,t);{const r=mye(e),i=(RA(t)?r.getPropertyValue(t):r[t])||0;return typeof i=="string"?i.trim():i}}measureInstanceViewportBox(e,{transformPagePoint:t}){return gB(e,t)}build(e,t,r){$A(e,t,r.transformTemplate)}scrapeMotionValuesFromProps(e,t,r){return YA(e,t,r)}}const vB=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function _ye(n,e,t,r){_B(n,e,void 0,r);for(const i in e.attrs)n.setAttribute(vB.has(i)?i:KA(i),e.attrs[i])}class vye extends yB{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=tn}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(Lh.has(t)){const r=$F(t);return r&&r.default||0}return t=vB.has(t)?t:KA(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,r){return lB(e,t,r)}build(e,t,r){iB(e,t,this.isSVGTag,r.transformTemplate,r.style)}renderInstance(e,t,r,i){_ye(e,t,r,i)}mount(e){this.isSVGTag=oB(e.tagName),super.mount(e)}}const bye=(n,e)=>qA(n)?new vye(e):new yye(e,{allowProjection:n!==A.Fragment});function $u(n,e,t){const r=n.getProps();return XA(r,e,t!==void 0?t:r.custom,n)}const zx=n=>Array.isArray(n);function Tye(n,e,t){n.hasValue(e)?n.getValue(e).set(t):n.addValue(e,fh(t))}function wye(n){return zx(n)?n[n.length-1]||0:n}function xye(n,e){const t=$u(n,e);let{transitionEnd:r={},transition:i={},...s}=t||{};s={...s,...r};for(const o in s){const a=wye(s[o]);Tye(n,o,a)}}function Eye(n){return!!(nr(n)&&n.add)}function jx(n,e){const t=n.getValue("willChange");if(Eye(t))return t.add(e);if(!t&&ho.WillChange){const r=new ho.WillChange("auto");n.addValue("willChange",r),r.add(e)}}function bB(n){return n.props[cB]}const Aye=n=>n!==null;function Sye(n,{repeat:e,repeatType:t="loop"},r){const i=n.filter(Aye),s=e&&t!=="loop"&&e%2===1?0:i.length-1;return i[s]}const Rye={type:"spring",stiffness:500,damping:25,restSpeed:10},Cye=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),Iye={type:"keyframes",duration:.8},Pye={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Mye=(n,{keyframes:e})=>e.length>2?Iye:Lh.has(n)?n.startsWith("scale")?Cye(e[1]):Rye:Pye;function Oye({when:n,delay:e,delayChildren:t,staggerChildren:r,staggerDirection:i,repeat:s,repeatType:o,repeatDelay:a,from:u,elapsed:h,...d}){return!!Object.keys(d).length}const GA=(n,e,t,r={},i,s)=>o=>{const a=UA(r,n)||{},u=a.delay||r.delay||0;let{elapsed:h=0}=r;h=h-cs(u);const d={keyframes:Array.isArray(t)?t:[null,t],ease:"easeOut",velocity:e.getVelocity(),...a,delay:-h,onUpdate:y=>{e.set(y),a.onUpdate&&a.onUpdate(y)},onComplete:()=>{o(),a.onComplete&&a.onComplete()},name:n,motionValue:e,element:s?void 0:i};Oye(a)||Object.assign(d,Mye(n,d)),d.duration&&(d.duration=cs(d.duration)),d.repeatDelay&&(d.repeatDelay=cs(d.repeatDelay)),d.from!==void 0&&(d.keyframes[0]=d.from);let g=!1;if((d.type===!1||d.duration===0&&!d.repeatDelay)&&(Lx(d),d.delay===0&&(g=!0)),(ho.instantAnimations||ho.skipAnimations)&&(g=!0,Lx(d),d.delay=0),d.allowFlatten=!a.type&&!a.ease,g&&!s&&e.get()!==void 0){const y=Sye(d.keyframes,a);if(y!==void 0){Dt.update(()=>{d.onUpdate(y),d.onComplete()});return}}return a.isSync?new DA(d):new Qge(d)};function kye({protectedKeys:n,needsAnimating:e},t){const r=n.hasOwnProperty(t)&&e[t]!==!0;return e[t]=!1,r}function TB(n,e,{delay:t=0,transitionOverride:r,type:i}={}){let{transition:s=n.getDefaultTransition(),transitionEnd:o,...a}=e;r&&(s=r);const u=[],h=i&&n.animationState&&n.animationState.getState()[i];for(const d in a){const g=n.getValue(d,n.latestValues[d]??null),y=a[d];if(y===void 0||h&&kye(h,d))continue;const v={delay:t,...UA(s||{},d)},T=g.get();if(T!==void 0&&!g.isAnimating&&!Array.isArray(y)&&y===T&&!v.velocity)continue;let w=!1;if(window.MotionHandoffAnimation){const S=bB(n);if(S){const P=window.MotionHandoffAnimation(S,d,Dt);P!==null&&(v.startTime=P,w=!0)}}jx(n,d),g.start(GA(d,g,y,n.shouldReduceMotion&&zF.has(d)?{type:!1}:v,n,w));const E=g.animation;E&&u.push(E)}return o&&Promise.all(u).then(()=>{Dt.update(()=>{o&&xye(n,o)})}),u}function wB(n,e,t,r=0,i=1){const s=Array.from(n).sort((h,d)=>h.sortNodePosition(d)).indexOf(e),o=n.size,a=(o-1)*r;return typeof t=="function"?t(s,o):i===1?s*r:a-s*r}function Hx(n,e,t={}){const r=$u(n,e,t.type==="exit"?n.presenceContext?.custom:void 0);let{transition:i=n.getDefaultTransition()||{}}=r||{};t.transitionOverride&&(i=t.transitionOverride);const s=r?()=>Promise.all(TB(n,r,t)):()=>Promise.resolve(),o=n.variantChildren&&n.variantChildren.size?(u=0)=>{const{delayChildren:h=0,staggerChildren:d,staggerDirection:g}=i;return Nye(n,e,u,h,d,g,t)}:()=>Promise.resolve(),{when:a}=i;if(a){const[u,h]=a==="beforeChildren"?[s,o]:[o,s];return u().then(()=>h())}else return Promise.all([s(),o(t.delay)])}function Nye(n,e,t=0,r=0,i=0,s=1,o){const a=[];for(const u of n.variantChildren)u.notify("AnimationStart",e),a.push(Hx(u,e,{...o,delay:t+(typeof r=="function"?0:r)+wB(n.variantChildren,u,r,i,s)}).then(()=>u.notify("AnimationComplete",e)));return Promise.all(a)}function Dye(n,e,t={}){n.notify("AnimationStart",e);let r;if(Array.isArray(e)){const i=e.map(s=>Hx(n,s,t));r=Promise.all(i)}else if(typeof e=="string")r=Hx(n,e,t);else{const i=typeof e=="function"?$u(n,e,t.custom):e;r=Promise.all(TB(n,i,t))}return r.then(()=>{n.notify("AnimationComplete",e)})}function xB(n,e){if(!Array.isArray(e))return!1;const t=e.length;if(t!==n.length)return!1;for(let r=0;r<t;r++)if(e[r]!==n[r])return!1;return!0}const Lye=HA.length;function EB(n){if(!n)return;if(!n.isControllingVariants){const t=n.parent?EB(n.parent)||{}:{};return n.props.initial!==void 0&&(t.initial=n.props.initial),t}const e={};for(let t=0;t<Lye;t++){const r=HA[t],i=n.props[r];(op(i)||i===!1)&&(e[r]=i)}return e}const Uye=[...jA].reverse(),Vye=jA.length;function Fye(n){return e=>Promise.all(e.map(({animation:t,options:r})=>Dye(n,t,r)))}function Bye(n){let e=Fye(n),t=ik(),r=!0;const i=u=>(h,d)=>{const g=$u(n,d,u==="exit"?n.presenceContext?.custom:void 0);if(g){const{transition:y,transitionEnd:v,...T}=g;h={...h,...T,...v}}return h};function s(u){e=u(n)}function o(u){const{props:h}=n,d=EB(n.parent)||{},g=[],y=new Set;let v={},T=1/0;for(let E=0;E<Vye;E++){const S=Uye[E],P=t[S],I=h[S]!==void 0?h[S]:d[S],L=op(I),F=S===u?P.isActive:null;F===!1&&(T=E);let Y=I===d[S]&&I!==h[S]&&L;if(Y&&r&&n.manuallyAnimateOnMount&&(Y=!1),P.protectedKeys={...v},!P.isActive&&F===null||!I&&!P.prevProp||yv(I)||typeof I=="boolean")continue;const k=zye(P.prevProp,I);let M=k||S===u&&P.isActive&&!Y&&L||E>T&&L,N=!1;const H=Array.isArray(I)?I:[I];let q=H.reduce(i(S),{});F===!1&&(q={});const{prevResolvedValues:K={}}=P,j={...K,...q},de=W=>{M=!0,y.has(W)&&(N=!0,y.delete(W)),P.needsAnimating[W]=!0;const U=n.getValue(W);U&&(U.liveStyle=!1)};for(const W in j){const U=q[W],ie=K[W];if(v.hasOwnProperty(W))continue;let V=!1;zx(U)&&zx(ie)?V=!xB(U,ie):V=U!==ie,V?U!=null?de(W):y.add(W):U!==void 0&&y.has(W)?de(W):P.protectedKeys[W]=!0}P.prevProp=I,P.prevResolvedValues=q,P.isActive&&(v={...v,...q}),r&&n.blockInitialAnimation&&(M=!1);const Ee=Y&&k;M&&(!Ee||N)&&g.push(...H.map(W=>{const U={type:S};if(typeof W=="string"&&r&&!Ee&&n.manuallyAnimateOnMount&&n.parent){const{parent:ie}=n,V=$u(ie,W);if(ie.enteringChildren&&V){const{delayChildren:Z}=V.transition||{};U.delay=wB(ie.enteringChildren,n,Z)}}return{animation:W,options:U}}))}if(y.size){const E={};if(typeof h.initial!="boolean"){const S=$u(n,Array.isArray(h.initial)?h.initial[0]:h.initial);S&&S.transition&&(E.transition=S.transition)}y.forEach(S=>{const P=n.getBaseTarget(S),I=n.getValue(S);I&&(I.liveStyle=!0),E[S]=P??null}),g.push({animation:E})}let w=!!g.length;return r&&(h.initial===!1||h.initial===h.animate)&&!n.manuallyAnimateOnMount&&(w=!1),r=!1,w?e(g):Promise.resolve()}function a(u,h){if(t[u].isActive===h)return Promise.resolve();n.variantChildren?.forEach(g=>g.animationState?.setActive(u,h)),t[u].isActive=h;const d=o(u);for(const g in t)t[g].protectedKeys={};return d}return{animateChanges:o,setActive:a,setAnimateFunction:s,getState:()=>t,reset:()=>{t=ik(),r=!0}}}function zye(n,e){return typeof e=="string"?e!==n:Array.isArray(e)?!xB(e,n):!1}function Cl(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function ik(){return{animate:Cl(!0),whileInView:Cl(),whileHover:Cl(),whileTap:Cl(),whileDrag:Cl(),whileFocus:Cl(),exit:Cl()}}class ja{constructor(e){this.isMounted=!1,this.node=e}update(){}}class jye extends ja{constructor(e){super(e),e.animationState||(e.animationState=Bye(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();yv(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let Hye=0;class $ye extends ja{constructor(){super(...arguments),this.id=Hye++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:r}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===r)return;const i=this.node.animationState.setActive("exit",!e);t&&!e&&i.then(()=>{t(this.id)})}mount(){const{register:e,onExitComplete:t}=this.node.presenceContext||{};t&&t(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const Wye={animation:{Feature:jye},exit:{Feature:$ye}};function lp(n,e,t,r={passive:!0}){return n.addEventListener(e,t,r),()=>n.removeEventListener(e,t)}function Np(n){return{point:{x:n.pageX,y:n.pageY}}}const qye=n=>e=>BA(e)&&n(e,Np(e));function Md(n,e,t,r){return lp(n,e,qye(t),r)}const AB=1e-4,Xye=1-AB,Yye=1+AB,SB=.01,Kye=0-SB,Gye=0+SB;function dr(n){return n.max-n.min}function Zye(n,e,t){return Math.abs(n-e)<=t}function sk(n,e,t,r=.5){n.origin=r,n.originPoint=Bt(e.min,e.max,n.origin),n.scale=dr(t)/dr(e),n.translate=Bt(t.min,t.max,n.origin)-n.originPoint,(n.scale>=Xye&&n.scale<=Yye||isNaN(n.scale))&&(n.scale=1),(n.translate>=Kye&&n.translate<=Gye||isNaN(n.translate))&&(n.translate=0)}function Od(n,e,t,r){sk(n.x,e.x,t.x,r?r.originX:void 0),sk(n.y,e.y,t.y,r?r.originY:void 0)}function ok(n,e,t){n.min=t.min+e.min,n.max=n.min+dr(e)}function Qye(n,e,t){ok(n.x,e.x,t.x),ok(n.y,e.y,t.y)}function ak(n,e,t){n.min=e.min-t.min,n.max=n.min+dr(e)}function kd(n,e,t){ak(n.x,e.x,t.x),ak(n.y,e.y,t.y)}function Qr(n){return[n("x"),n("y")]}const RB=({current:n})=>n?n.ownerDocument.defaultView:null,lk=(n,e)=>Math.abs(n-e);function Jye(n,e){const t=lk(n.x,e.x),r=lk(n.y,e.y);return Math.sqrt(t**2+r**2)}class CB{constructor(e,t,{transformPagePoint:r,contextWindow:i=window,dragSnapToOrigin:s=!1,distanceThreshold:o=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const y=YT(this.lastMoveEventInfo,this.history),v=this.startEvent!==null,T=Jye(y.offset,{x:0,y:0})>=this.distanceThreshold;if(!v&&!T)return;const{point:w}=y,{timestamp:E}=Vn;this.history.push({...w,timestamp:E});const{onStart:S,onMove:P}=this.handlers;v||(S&&S(this.lastMoveEvent,y),this.startEvent=this.lastMoveEvent),P&&P(this.lastMoveEvent,y)},this.handlePointerMove=(y,v)=>{this.lastMoveEvent=y,this.lastMoveEventInfo=XT(v,this.transformPagePoint),Dt.update(this.updatePoint,!0)},this.handlePointerUp=(y,v)=>{this.end();const{onEnd:T,onSessionEnd:w,resumeAnimation:E}=this.handlers;if(this.dragSnapToOrigin&&E&&E(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const S=YT(y.type==="pointercancel"?this.lastMoveEventInfo:XT(v,this.transformPagePoint),this.history);this.startEvent&&T&&T(y,S),w&&w(y,S)},!BA(e))return;this.dragSnapToOrigin=s,this.handlers=t,this.transformPagePoint=r,this.distanceThreshold=o,this.contextWindow=i||window;const a=Np(e),u=XT(a,this.transformPagePoint),{point:h}=u,{timestamp:d}=Vn;this.history=[{...h,timestamp:d}];const{onSessionStart:g}=t;g&&g(e,YT(u,this.history)),this.removeListeners=Mp(Md(this.contextWindow,"pointermove",this.handlePointerMove),Md(this.contextWindow,"pointerup",this.handlePointerUp),Md(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Ua(this.updatePoint)}}function XT(n,e){return e?{point:e(n.point)}:n}function ck(n,e){return{x:n.x-e.x,y:n.y-e.y}}function YT({point:n},e){return{point:n,delta:ck(n,IB(e)),offset:ck(n,e_e(e)),velocity:t_e(e,.1)}}function e_e(n){return n[0]}function IB(n){return n[n.length-1]}function t_e(n,e){if(n.length<2)return{x:0,y:0};let t=n.length-1,r=null;const i=IB(n);for(;t>=0&&(r=n[t],!(i.timestamp-r.timestamp>cs(e)));)t--;if(!r)return{x:0,y:0};const s=ni(i.timestamp-r.timestamp);if(s===0)return{x:0,y:0};const o={x:(i.x-r.x)/s,y:(i.y-r.y)/s};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function n_e(n,{min:e,max:t},r){return e!==void 0&&n<e?n=r?Bt(e,n,r.min):Math.max(n,e):t!==void 0&&n>t&&(n=r?Bt(t,n,r.max):Math.min(n,t)),n}function uk(n,e,t){return{min:e!==void 0?n.min+e:void 0,max:t!==void 0?n.max+t-(n.max-n.min):void 0}}function r_e(n,{top:e,left:t,bottom:r,right:i}){return{x:uk(n.x,t,i),y:uk(n.y,e,r)}}function hk(n,e){let t=e.min-n.min,r=e.max-n.max;return e.max-e.min<n.max-n.min&&([t,r]=[r,t]),{min:t,max:r}}function i_e(n,e){return{x:hk(n.x,e.x),y:hk(n.y,e.y)}}function s_e(n,e){let t=.5;const r=dr(n),i=dr(e);return i>r?t=rp(e.min,e.max-r,n.min):r>i&&(t=rp(n.min,n.max-i,e.min)),uo(0,1,t)}function o_e(n,e){const t={};return e.min!==void 0&&(t.min=e.min-n.min),e.max!==void 0&&(t.max=e.max-n.min),t}const $x=.35;function a_e(n=$x){return n===!1?n=0:n===!0&&(n=$x),{x:fk(n,"left","right"),y:fk(n,"top","bottom")}}function fk(n,e,t){return{min:dk(n,e),max:dk(n,t)}}function dk(n,e){return typeof n=="number"?n:n[e]||0}const l_e=new WeakMap;class c_e{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=tn(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:t=!1,distanceThreshold:r}={}){const{presenceContext:i}=this.visualElement;if(i&&i.isPresent===!1)return;const s=g=>{const{dragSnapToOrigin:y}=this.getProps();y?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(Np(g).point)},o=(g,y)=>{const{drag:v,dragPropagation:T,onDragStart:w}=this.getProps();if(v&&!T&&(this.openDragLock&&this.openDragLock(),this.openDragLock=pme(v),!this.openDragLock))return;this.latestPointerEvent=g,this.latestPanInfo=y,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Qr(S=>{let P=this.getAxisMotionValue(S).get()||0;if(us.test(P)){const{projection:I}=this.visualElement;if(I&&I.layout){const L=I.layout.layoutBox[S];L&&(P=dr(L)*(parseFloat(P)/100))}}this.originPoint[S]=P}),w&&Dt.postRender(()=>w(g,y)),jx(this.visualElement,"transform");const{animationState:E}=this.visualElement;E&&E.setActive("whileDrag",!0)},a=(g,y)=>{this.latestPointerEvent=g,this.latestPanInfo=y;const{dragPropagation:v,dragDirectionLock:T,onDirectionLock:w,onDrag:E}=this.getProps();if(!v&&!this.openDragLock)return;const{offset:S}=y;if(T&&this.currentDirection===null){this.currentDirection=u_e(S),this.currentDirection!==null&&w&&w(this.currentDirection);return}this.updateAxis("x",y.point,S),this.updateAxis("y",y.point,S),this.visualElement.render(),E&&E(g,y)},u=(g,y)=>{this.latestPointerEvent=g,this.latestPanInfo=y,this.stop(g,y),this.latestPointerEvent=null,this.latestPanInfo=null},h=()=>Qr(g=>this.getAnimationState(g)==="paused"&&this.getAxisMotionValue(g).animation?.play()),{dragSnapToOrigin:d}=this.getProps();this.panSession=new CB(e,{onSessionStart:s,onStart:o,onMove:a,onSessionEnd:u,resumeAnimation:h},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:d,distanceThreshold:r,contextWindow:RB(this.visualElement)})}stop(e,t){const r=e||this.latestPointerEvent,i=t||this.latestPanInfo,s=this.isDragging;if(this.cancel(),!s||!i||!r)return;const{velocity:o}=i;this.startAnimation(o);const{onDragEnd:a}=this.getProps();a&&Dt.postRender(()=>a(r,i))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:r}=this.getProps();!r&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,r){const{drag:i}=this.getProps();if(!r||!$m(e,i,this.currentDirection))return;const s=this.getAxisMotionValue(e);let o=this.originPoint[e]+r[e];this.constraints&&this.constraints[e]&&(o=n_e(o,this.constraints[e],this.elastic[e])),s.set(o)}resolveConstraints(){const{dragConstraints:e,dragElastic:t}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,i=this.constraints;e&&Mu(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&r?this.constraints=r_e(r.layoutBox,e):this.constraints=!1,this.elastic=a_e(t),i!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&Qr(s=>{this.constraints!==!1&&this.getAxisMotionValue(s)&&(this.constraints[s]=o_e(r.layoutBox[s],this.constraints[s]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!Mu(e))return!1;const r=e.current,{projection:i}=this.visualElement;if(!i||!i.layout)return!1;const s=hye(r,i.root,this.visualElement.getTransformPagePoint());let o=i_e(i.layout.layoutBox,s);if(t){const a=t(lye(o));this.hasMutatedConstraints=!!a,a&&(o=fB(a))}return o}startAnimation(e){const{drag:t,dragMomentum:r,dragElastic:i,dragTransition:s,dragSnapToOrigin:o,onDragTransitionEnd:a}=this.getProps(),u=this.constraints||{},h=Qr(d=>{if(!$m(d,t,this.currentDirection))return;let g=u&&u[d]||{};o&&(g={min:0,max:0});const y=i?200:1e6,v=i?40:1e7,T={type:"inertia",velocity:r?e[d]:0,bounceStiffness:y,bounceDamping:v,timeConstant:750,restDelta:1,restSpeed:10,...s,...g};return this.startAxisValueAnimation(d,T)});return Promise.all(h).then(a)}startAxisValueAnimation(e,t){const r=this.getAxisMotionValue(e);return jx(this.visualElement,e),r.start(GA(e,r,0,t,this.visualElement,!1))}stopAnimation(){Qr(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Qr(e=>this.getAxisMotionValue(e).animation?.pause())}getAnimationState(e){return this.getAxisMotionValue(e).animation?.state}getAxisMotionValue(e){const t=`_drag${e.toUpperCase()}`,r=this.visualElement.getProps(),i=r[t];return i||this.visualElement.getValue(e,(r.initial?r.initial[e]:void 0)||0)}snapToCursor(e){Qr(t=>{const{drag:r}=this.getProps();if(!$m(t,r,this.currentDirection))return;const{projection:i}=this.visualElement,s=this.getAxisMotionValue(t);if(i&&i.layout){const{min:o,max:a}=i.layout.layoutBox[t];s.set(e[t]-Bt(o,a,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:r}=this.visualElement;if(!Mu(t)||!r||!this.constraints)return;this.stopAnimation();const i={x:0,y:0};Qr(o=>{const a=this.getAxisMotionValue(o);if(a&&this.constraints!==!1){const u=a.get();i[o]=s_e({min:u,max:u},this.constraints[o])}});const{transformTemplate:s}=this.visualElement.getProps();this.visualElement.current.style.transform=s?s({},""):"none",r.root&&r.root.updateScroll(),r.updateLayout(),this.resolveConstraints(),Qr(o=>{if(!$m(o,e,null))return;const a=this.getAxisMotionValue(o),{min:u,max:h}=this.constraints[o];a.set(Bt(u,h,i[o]))})}addListeners(){if(!this.visualElement.current)return;l_e.set(this.visualElement,this);const e=this.visualElement.current,t=Md(e,"pointerdown",u=>{const{drag:h,dragListener:d=!0}=this.getProps();h&&d&&this.start(u)}),r=()=>{const{dragConstraints:u}=this.getProps();Mu(u)&&u.current&&(this.constraints=this.resolveRefConstraints())},{projection:i}=this.visualElement,s=i.addEventListener("measure",r);i&&!i.layout&&(i.root&&i.root.updateScroll(),i.updateLayout()),Dt.read(r);const o=lp(window,"resize",()=>this.scalePositionWithinConstraints()),a=i.addEventListener("didUpdate",(({delta:u,hasLayoutChanged:h})=>{this.isDragging&&h&&(Qr(d=>{const g=this.getAxisMotionValue(d);g&&(this.originPoint[d]+=u[d].translate,g.set(g.get()+u[d].translate))}),this.visualElement.render())}));return()=>{o(),t(),s(),a&&a()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:r=!1,dragPropagation:i=!1,dragConstraints:s=!1,dragElastic:o=$x,dragMomentum:a=!0}=e;return{...e,drag:t,dragDirectionLock:r,dragPropagation:i,dragConstraints:s,dragElastic:o,dragMomentum:a}}}function $m(n,e,t){return(e===!0||e===n)&&(t===null||t===n)}function u_e(n,e=10){let t=null;return Math.abs(n.y)>e?t="y":Math.abs(n.x)>e&&(t="x"),t}class h_e extends ja{constructor(e){super(e),this.removeGroupControls=oi,this.removeListeners=oi,this.controls=new c_e(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||oi}unmount(){this.removeGroupControls(),this.removeListeners()}}const pk=n=>(e,t)=>{n&&Dt.postRender(()=>n(e,t))};class f_e extends ja{constructor(){super(...arguments),this.removePointerDownListener=oi}onPointerDown(e){this.session=new CB(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:RB(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:r,onPanEnd:i}=this.node.getProps();return{onSessionStart:pk(e),onStart:pk(t),onMove:r,onEnd:(s,o)=>{delete this.session,i&&Dt.postRender(()=>i(s,o))}}}mount(){this.removePointerDownListener=Md(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const Ey={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function gk(n,e){return e.max===e.min?0:n/(e.max-e.min)*100}const Qf={correct:(n,e)=>{if(!e.target)return n;if(typeof n=="string")if($e.test(n))n=parseFloat(n);else return n;const t=gk(n,e.target.x),r=gk(n,e.target.y);return`${t}% ${r}%`}},d_e={correct:(n,{treeScale:e,projectionDelta:t})=>{const r=n,i=Va.parse(n);if(i.length>5)return r;const s=Va.createTransformer(n),o=typeof i[0]!="number"?1:0,a=t.x.scale*e.x,u=t.y.scale*e.y;i[0+o]/=a,i[1+o]/=u;const h=Bt(a,u,.5);return typeof i[2+o]=="number"&&(i[2+o]/=h),typeof i[3+o]=="number"&&(i[3+o]/=h),s(i)}};let KT=!1;class p_e extends A.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:r,layoutId:i}=this.props,{projection:s}=e;Lme(g_e),s&&(t.group&&t.group.add(s),r&&r.register&&i&&r.register(s),KT&&s.root.didUpdate(),s.addEventListener("animationComplete",()=>{this.safeToRemove()}),s.setOptions({...s.options,onExitComplete:()=>this.safeToRemove()})),Ey.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:r,drag:i,isPresent:s}=this.props,{projection:o}=r;return o&&(o.isPresent=s,KT=!0,i||e.layoutDependency!==t||t===void 0||e.isPresent!==s?o.willUpdate():this.safeToRemove(),e.isPresent!==s&&(s?o.promote():o.relegate()||Dt.postRender(()=>{const a=o.getStack();(!a||!a.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),FA.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:r}=this.props,{projection:i}=e;KT=!0,i&&(i.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(i),r&&r.deregister&&r.deregister(i))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function PB(n){const[e,t]=QF(),r=A.useContext(yA);return $.jsx(p_e,{...n,layoutGroup:r,switchLayoutGroup:A.useContext(uB),isPresent:e,safeToRemove:t})}const g_e={borderRadius:{...Qf,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Qf,borderTopRightRadius:Qf,borderBottomLeftRadius:Qf,borderBottomRightRadius:Qf,boxShadow:d_e};function m_e(n,e,t){const r=nr(n)?n:fh(n);return r.start(GA("",r,e,t)),r.animation}const y_e=(n,e)=>n.depth-e.depth;class __e{constructor(){this.children=[],this.isDirty=!1}add(e){bA(this.children,e),this.isDirty=!0}remove(e){TA(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(y_e),this.isDirty=!1,this.children.forEach(e)}}function v_e(n,e){const t=br.now(),r=({timestamp:i})=>{const s=i-t;s>=e&&(Ua(r),n(s-e))};return Dt.setup(r,!0),()=>Ua(r)}const MB=["TopLeft","TopRight","BottomLeft","BottomRight"],b_e=MB.length,mk=n=>typeof n=="string"?parseFloat(n):n,yk=n=>typeof n=="number"||$e.test(n);function T_e(n,e,t,r,i,s){i?(n.opacity=Bt(0,t.opacity??1,w_e(r)),n.opacityExit=Bt(e.opacity??1,0,x_e(r))):s&&(n.opacity=Bt(e.opacity??1,t.opacity??1,r));for(let o=0;o<b_e;o++){const a=`border${MB[o]}Radius`;let u=_k(e,a),h=_k(t,a);if(u===void 0&&h===void 0)continue;u||(u=0),h||(h=0),u===0||h===0||yk(u)===yk(h)?(n[a]=Math.max(Bt(mk(u),mk(h),r),0),(us.test(h)||us.test(u))&&(n[a]+="%")):n[a]=h}(e.rotate||t.rotate)&&(n.rotate=Bt(e.rotate||0,t.rotate||0,r))}function _k(n,e){return n[e]!==void 0?n[e]:n.borderRadius}const w_e=OB(0,.5,_F),x_e=OB(.5,.95,oi);function OB(n,e,t){return r=>r<n?0:r>e?1:t(rp(n,e,r))}function vk(n,e){n.min=e.min,n.max=e.max}function Zr(n,e){vk(n.x,e.x),vk(n.y,e.y)}function bk(n,e){n.translate=e.translate,n.scale=e.scale,n.originPoint=e.originPoint,n.origin=e.origin}function Tk(n,e,t,r,i){return n-=e,n=A_(n,1/t,r),i!==void 0&&(n=A_(n,1/i,r)),n}function E_e(n,e=0,t=1,r=.5,i,s=n,o=n){if(us.test(e)&&(e=parseFloat(e),e=Bt(o.min,o.max,e/100)-o.min),typeof e!="number")return;let a=Bt(s.min,s.max,r);n===s&&(a-=e),n.min=Tk(n.min,e,t,a,i),n.max=Tk(n.max,e,t,a,i)}function wk(n,e,[t,r,i],s,o){E_e(n,e[t],e[r],e[i],e.scale,s,o)}const A_e=["x","scaleX","originX"],S_e=["y","scaleY","originY"];function xk(n,e,t,r){wk(n.x,e,A_e,t?t.x:void 0,r?r.x:void 0),wk(n.y,e,S_e,t?t.y:void 0,r?r.y:void 0)}function Ek(n){return n.translate===0&&n.scale===1}function kB(n){return Ek(n.x)&&Ek(n.y)}function Ak(n,e){return n.min===e.min&&n.max===e.max}function R_e(n,e){return Ak(n.x,e.x)&&Ak(n.y,e.y)}function Sk(n,e){return Math.round(n.min)===Math.round(e.min)&&Math.round(n.max)===Math.round(e.max)}function NB(n,e){return Sk(n.x,e.x)&&Sk(n.y,e.y)}function Rk(n){return dr(n.x)/dr(n.y)}function Ck(n,e){return n.translate===e.translate&&n.scale===e.scale&&n.originPoint===e.originPoint}class C_e{constructor(){this.members=[]}add(e){bA(this.members,e),e.scheduleRender()}remove(e){if(TA(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const t=this.members[this.members.length-1];t&&this.promote(t)}}relegate(e){const t=this.members.findIndex(i=>e===i);if(t===0)return!1;let r;for(let i=t;i>=0;i--){const s=this.members[i];if(s.isPresent!==!1){r=s;break}}return r?(this.promote(r),!0):!1}promote(e,t){const r=this.lead;if(e!==r&&(this.prevLead=r,this.lead=e,e.show(),r)){r.instance&&r.scheduleRender(),e.scheduleRender(),e.resumeFrom=r,t&&(e.resumeFrom.preserveOpacity=!0),r.snapshot&&(e.snapshot=r.snapshot,e.snapshot.latestValues=r.animationValues||r.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:i}=e.options;i===!1&&r.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:t,resumingFrom:r}=e;t.onExitComplete&&t.onExitComplete(),r&&r.options.onExitComplete&&r.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function I_e(n,e,t){let r="";const i=n.x.translate/e.x,s=n.y.translate/e.y,o=t?.z||0;if((i||s||o)&&(r=`translate3d(${i}px, ${s}px, ${o}px) `),(e.x!==1||e.y!==1)&&(r+=`scale(${1/e.x}, ${1/e.y}) `),t){const{transformPerspective:h,rotate:d,rotateX:g,rotateY:y,skewX:v,skewY:T}=t;h&&(r=`perspective(${h}px) ${r}`),d&&(r+=`rotate(${d}deg) `),g&&(r+=`rotateX(${g}deg) `),y&&(r+=`rotateY(${y}deg) `),v&&(r+=`skewX(${v}deg) `),T&&(r+=`skewY(${T}deg) `)}const a=n.x.scale*e.x,u=n.y.scale*e.y;return(a!==1||u!==1)&&(r+=`scale(${a}, ${u})`),r||"none"}const GT=["","X","Y","Z"],P_e=1e3;let M_e=0;function ZT(n,e,t,r){const{latestValues:i}=e;i[n]&&(t[n]=i[n],e.setStaticValue(n,0),r&&(r[n]=0))}function DB(n){if(n.hasCheckedOptimisedAppear=!0,n.root===n)return;const{visualElement:e}=n.options;if(!e)return;const t=bB(e);if(window.MotionHasOptimisedAnimation(t,"transform")){const{layout:i,layoutId:s}=n.options;window.MotionCancelOptimisedAnimation(t,"transform",Dt,!(i||s))}const{parent:r}=n;r&&!r.hasCheckedOptimisedAppear&&DB(r)}function LB({attachResizeListener:n,defaultParent:e,measureScroll:t,checkIsScrollRoot:r,resetTransform:i}){return class{constructor(o={},a=e?.()){this.id=M_e++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(N_e),this.nodes.forEach(V_e),this.nodes.forEach(F_e),this.nodes.forEach(D_e)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=o,this.root=a?a.root||a:this,this.path=a?[...a.path,a]:[],this.parent=a,this.depth=a?a.depth+1:0;for(let u=0;u<this.path.length;u++)this.path[u].shouldResetTransform=!0;this.root===this&&(this.nodes=new __e)}addEventListener(o,a){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new EA),this.eventHandlers.get(o).add(a)}notifyListeners(o,...a){const u=this.eventHandlers.get(o);u&&u.notify(...a)}hasListeners(o){return this.eventHandlers.has(o)}mount(o){if(this.instance)return;this.isSVG=ZF(o)&&!bme(o),this.instance=o;const{layoutId:a,layout:u,visualElement:h}=this.options;if(h&&!h.current&&h.mount(o),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(u||a)&&(this.isLayoutDirty=!0),n){let d,g=0;const y=()=>this.root.updateBlockedByResize=!1;Dt.read(()=>{g=window.innerWidth}),n(o,()=>{const v=window.innerWidth;v!==g&&(g=v,this.root.updateBlockedByResize=!0,d&&d(),d=v_e(y,250),Ey.hasAnimatedSinceResize&&(Ey.hasAnimatedSinceResize=!1,this.nodes.forEach(Mk)))})}a&&this.root.registerSharedNode(a,this),this.options.animate!==!1&&h&&(a||u)&&this.addEventListener("didUpdate",({delta:d,hasLayoutChanged:g,hasRelativeLayoutChanged:y,layout:v})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const T=this.options.transition||h.getDefaultTransition()||$_e,{onLayoutAnimationStart:w,onLayoutAnimationComplete:E}=h.getProps(),S=!this.targetLayout||!NB(this.targetLayout,v),P=!g&&y;if(this.options.layoutRoot||this.resumeFrom||P||g&&(S||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const I={...UA(T,"layout"),onPlay:w,onComplete:E};(h.shouldReduceMotion||this.options.layoutRoot)&&(I.delay=0,I.type=!1),this.startAnimation(I),this.setAnimationOrigin(d,P)}else g||Mk(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=v})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const o=this.getStack();o&&o.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Ua(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(B_e),this.animationId++)}getTransformTemplate(){const{visualElement:o}=this.options;return o&&o.getProps().transformTemplate}willUpdate(o=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&DB(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let d=0;d<this.path.length;d++){const g=this.path[d];g.shouldResetTransform=!0,g.updateScroll("snapshot"),g.options.layoutRoot&&g.willUpdate(!1)}const{layoutId:a,layout:u}=this.options;if(a===void 0&&!u)return;const h=this.getTransformTemplate();this.prevTransformTemplateValue=h?h(this.latestValues,""):void 0,this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(Ik);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(Pk);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(U_e),this.nodes.forEach(O_e),this.nodes.forEach(k_e)):this.nodes.forEach(Pk),this.clearAllSnapshots();const a=br.now();Vn.delta=uo(0,1e3/60,a-Vn.timestamp),Vn.timestamp=a,Vn.isProcessing=!0,FT.update.process(Vn),FT.preRender.process(Vn),FT.render.process(Vn),Vn.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,FA.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(L_e),this.sharedNodes.forEach(z_e)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Dt.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Dt.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!dr(this.snapshot.measuredBox.x)&&!dr(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let u=0;u<this.path.length;u++)this.path[u].updateScroll();const o=this.layout;this.layout=this.measure(!1),this.layoutCorrected=tn(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:a}=this.options;a&&a.notify("LayoutMeasure",this.layout.layoutBox,o?o.layoutBox:void 0)}updateScroll(o="measure"){let a=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===o&&(a=!1),a&&this.instance){const u=r(this.instance);this.scroll={animationId:this.root.animationId,phase:o,isRoot:u,offset:t(this.instance),wasRoot:this.scroll?this.scroll.isRoot:u}}}resetTransform(){if(!i)return;const o=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,a=this.projectionDelta&&!kB(this.projectionDelta),u=this.getTransformTemplate(),h=u?u(this.latestValues,""):void 0,d=h!==this.prevTransformTemplateValue;o&&this.instance&&(a||Pl(this.latestValues)||d)&&(i(this.instance,h),this.shouldResetTransform=!1,this.scheduleRender())}measure(o=!0){const a=this.measurePageBox();let u=this.removeElementScroll(a);return o&&(u=this.removeTransform(u)),W_e(u),{animationId:this.root.animationId,measuredBox:a,layoutBox:u,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:o}=this.options;if(!o)return tn();const a=o.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(q_e))){const{scroll:h}=this.root;h&&(Ou(a.x,h.offset.x),Ou(a.y,h.offset.y))}return a}removeElementScroll(o){const a=tn();if(Zr(a,o),this.scroll?.wasRoot)return a;for(let u=0;u<this.path.length;u++){const h=this.path[u],{scroll:d,options:g}=h;h!==this.root&&d&&g.layoutScroll&&(d.wasRoot&&Zr(a,o),Ou(a.x,d.offset.x),Ou(a.y,d.offset.y))}return a}applyTransform(o,a=!1){const u=tn();Zr(u,o);for(let h=0;h<this.path.length;h++){const d=this.path[h];!a&&d.options.layoutScroll&&d.scroll&&d!==d.root&&ku(u,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),Pl(d.latestValues)&&ku(u,d.latestValues)}return Pl(this.latestValues)&&ku(u,this.latestValues),u}removeTransform(o){const a=tn();Zr(a,o);for(let u=0;u<this.path.length;u++){const h=this.path[u];if(!h.instance||!Pl(h.latestValues))continue;Vx(h.latestValues)&&h.updateSnapshot();const d=tn(),g=h.measurePageBox();Zr(d,g),xk(a,h.latestValues,h.snapshot?h.snapshot.layoutBox:void 0,d)}return Pl(this.latestValues)&&xk(a,this.latestValues),a}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Vn.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(o=!1){const a=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=a.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=a.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=a.isSharedProjectionDirty);const u=!!this.resumingFrom||this!==a;if(!(o||u&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:d,layoutId:g}=this.options;if(!(!this.layout||!(d||g))){if(this.resolvedRelativeTargetAt=Vn.timestamp,!this.targetDelta&&!this.relativeTarget){const y=this.getClosestProjectingParent();y&&y.layout&&this.animationProgress!==1?(this.relativeParent=y,this.forceRelativeParentToResolveTarget(),this.relativeTarget=tn(),this.relativeTargetOrigin=tn(),kd(this.relativeTargetOrigin,this.layout.layoutBox,y.layout.layoutBox),Zr(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=tn(),this.targetWithTransforms=tn()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Qye(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Zr(this.target,this.layout.layoutBox),pB(this.target,this.targetDelta)):Zr(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const y=this.getClosestProjectingParent();y&&!!y.resumingFrom==!!this.resumingFrom&&!y.options.layoutScroll&&y.target&&this.animationProgress!==1?(this.relativeParent=y,this.forceRelativeParentToResolveTarget(),this.relativeTarget=tn(),this.relativeTargetOrigin=tn(),kd(this.relativeTargetOrigin,this.target,y.target),Zr(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||Vx(this.parent.latestValues)||dB(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){const o=this.getLead(),a=!!this.resumingFrom||this!==o;let u=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(u=!1),a&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(u=!1),this.resolvedRelativeTargetAt===Vn.timestamp&&(u=!1),u)return;const{layout:h,layoutId:d}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(h||d))return;Zr(this.layoutCorrected,this.layout.layoutBox);const g=this.treeScale.x,y=this.treeScale.y;uye(this.layoutCorrected,this.treeScale,this.path,a),o.layout&&!o.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(o.target=o.layout.layoutBox,o.targetWithTransforms=tn());const{target:v}=o;if(!v){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(bk(this.prevProjectionDelta.x,this.projectionDelta.x),bk(this.prevProjectionDelta.y,this.projectionDelta.y)),Od(this.projectionDelta,this.layoutCorrected,v,this.latestValues),(this.treeScale.x!==g||this.treeScale.y!==y||!Ck(this.projectionDelta.x,this.prevProjectionDelta.x)||!Ck(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",v))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){if(this.options.visualElement?.scheduleRender(),o){const a=this.getStack();a&&a.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Nu(),this.projectionDelta=Nu(),this.projectionDeltaWithTransform=Nu()}setAnimationOrigin(o,a=!1){const u=this.snapshot,h=u?u.latestValues:{},d={...this.latestValues},g=Nu();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!a;const y=tn(),v=u?u.source:void 0,T=this.layout?this.layout.source:void 0,w=v!==T,E=this.getStack(),S=!E||E.members.length<=1,P=!!(w&&!S&&this.options.crossfade===!0&&!this.path.some(H_e));this.animationProgress=0;let I;this.mixTargetDelta=L=>{const F=L/1e3;Ok(g.x,o.x,F),Ok(g.y,o.y,F),this.setTargetDelta(g),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(kd(y,this.layout.layoutBox,this.relativeParent.layout.layoutBox),j_e(this.relativeTarget,this.relativeTargetOrigin,y,F),I&&R_e(this.relativeTarget,I)&&(this.isProjectionDirty=!1),I||(I=tn()),Zr(I,this.relativeTarget)),w&&(this.animationValues=d,T_e(d,h,this.latestValues,F,P,S)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=F},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(o){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(Ua(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Dt.update(()=>{Ey.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=fh(0)),this.currentAnimation=m_e(this.motionValue,[0,1e3],{...o,velocity:0,isSync:!0,onUpdate:a=>{this.mixTargetDelta(a),o.onUpdate&&o.onUpdate(a)},onStop:()=>{},onComplete:()=>{o.onComplete&&o.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const o=this.getStack();o&&o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(P_e),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:a,target:u,layout:h,latestValues:d}=o;if(!(!a||!u||!h)){if(this!==o&&this.layout&&h&&UB(this.options.animationType,this.layout.layoutBox,h.layoutBox)){u=this.target||tn();const g=dr(this.layout.layoutBox.x);u.x.min=o.target.x.min,u.x.max=u.x.min+g;const y=dr(this.layout.layoutBox.y);u.y.min=o.target.y.min,u.y.max=u.y.min+y}Zr(a,u),ku(a,d),Od(this.projectionDeltaWithTransform,this.layoutCorrected,a,d)}}registerSharedNode(o,a){this.sharedNodes.has(o)||this.sharedNodes.set(o,new C_e),this.sharedNodes.get(o).add(a);const h=a.options.initialPromotionConfig;a.promote({transition:h?h.transition:void 0,preserveFollowOpacity:h&&h.shouldPreserveFollowOpacity?h.shouldPreserveFollowOpacity(a):void 0})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){const{layoutId:o}=this.options;return o?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:o}=this.options;return o?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:a,preserveFollowOpacity:u}={}){const h=this.getStack();h&&h.promote(this,u),o&&(this.projectionDelta=void 0,this.needsReset=!0),a&&this.setOptions({transition:a})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetSkewAndRotation(){const{visualElement:o}=this.options;if(!o)return;let a=!1;const{latestValues:u}=o;if((u.z||u.rotate||u.rotateX||u.rotateY||u.rotateZ||u.skewX||u.skewY)&&(a=!0),!a)return;const h={};u.z&&ZT("z",o,h,this.animationValues);for(let d=0;d<GT.length;d++)ZT(`rotate${GT[d]}`,o,h,this.animationValues),ZT(`skew${GT[d]}`,o,h,this.animationValues);o.render();for(const d in h)o.setStaticValue(d,h[d]),this.animationValues&&(this.animationValues[d]=h[d]);o.scheduleRender()}applyProjectionStyles(o,a){if(!this.instance||this.isSVG)return;if(!this.isVisible){o.visibility="hidden";return}const u=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,o.visibility="",o.opacity="",o.pointerEvents=xy(a?.pointerEvents)||"",o.transform=u?u(this.latestValues,""):"none";return}const h=this.getLead();if(!this.projectionDelta||!this.layout||!h.target){this.options.layoutId&&(o.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,o.pointerEvents=xy(a?.pointerEvents)||""),this.hasProjected&&!Pl(this.latestValues)&&(o.transform=u?u({},""):"none",this.hasProjected=!1);return}o.visibility="";const d=h.animationValues||h.latestValues;this.applyTransformsToTarget();let g=I_e(this.projectionDeltaWithTransform,this.treeScale,d);u&&(g=u(d,g)),o.transform=g;const{x:y,y:v}=this.projectionDelta;o.transformOrigin=`${y.origin*100}% ${v.origin*100}% 0`,h.animationValues?o.opacity=h===this?d.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:d.opacityExit:o.opacity=h===this?d.opacity!==void 0?d.opacity:"":d.opacityExit!==void 0?d.opacityExit:0;for(const T in ap){if(d[T]===void 0)continue;const{correct:w,applyTo:E,isCSSVariable:S}=ap[T],P=g==="none"?d[T]:w(d[T],h);if(E){const I=E.length;for(let L=0;L<I;L++)o[E[L]]=P}else S?this.options.visualElement.renderState.vars[T]=P:o[T]=P}this.options.layoutId&&(o.pointerEvents=h===this?xy(a?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>o.currentAnimation?.stop()),this.root.nodes.forEach(Ik),this.root.sharedNodes.clear()}}}function O_e(n){n.updateLayout()}function k_e(n){const e=n.resumeFrom?.snapshot||n.snapshot;if(n.isLead()&&n.layout&&e&&n.hasListeners("didUpdate")){const{layoutBox:t,measuredBox:r}=n.layout,{animationType:i}=n.options,s=e.source!==n.layout.source;i==="size"?Qr(d=>{const g=s?e.measuredBox[d]:e.layoutBox[d],y=dr(g);g.min=t[d].min,g.max=g.min+y}):UB(i,e.layoutBox,t)&&Qr(d=>{const g=s?e.measuredBox[d]:e.layoutBox[d],y=dr(t[d]);g.max=g.min+y,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[d].max=n.relativeTarget[d].min+y)});const o=Nu();Od(o,t,e.layoutBox);const a=Nu();s?Od(a,n.applyTransform(r,!0),e.measuredBox):Od(a,t,e.layoutBox);const u=!kB(o);let h=!1;if(!n.resumeFrom){const d=n.getClosestProjectingParent();if(d&&!d.resumeFrom){const{snapshot:g,layout:y}=d;if(g&&y){const v=tn();kd(v,e.layoutBox,g.layoutBox);const T=tn();kd(T,t,y.layoutBox),NB(v,T)||(h=!0),d.options.layoutRoot&&(n.relativeTarget=T,n.relativeTargetOrigin=v,n.relativeParent=d)}}}n.notifyListeners("didUpdate",{layout:t,snapshot:e,delta:a,layoutDelta:o,hasLayoutChanged:u,hasRelativeLayoutChanged:h})}else if(n.isLead()){const{onExitComplete:t}=n.options;t&&t()}n.options.transition=void 0}function N_e(n){n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function D_e(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function L_e(n){n.clearSnapshot()}function Ik(n){n.clearMeasurements()}function Pk(n){n.isLayoutDirty=!1}function U_e(n){const{visualElement:e}=n.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),n.resetTransform()}function Mk(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function V_e(n){n.resolveTargetDelta()}function F_e(n){n.calcProjection()}function B_e(n){n.resetSkewAndRotation()}function z_e(n){n.removeLeadSnapshot()}function Ok(n,e,t){n.translate=Bt(e.translate,0,t),n.scale=Bt(e.scale,1,t),n.origin=e.origin,n.originPoint=e.originPoint}function kk(n,e,t,r){n.min=Bt(e.min,t.min,r),n.max=Bt(e.max,t.max,r)}function j_e(n,e,t,r){kk(n.x,e.x,t.x,r),kk(n.y,e.y,t.y,r)}function H_e(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const $_e={duration:.45,ease:[.4,0,.1,1]},Nk=n=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(n),Dk=Nk("applewebkit/")&&!Nk("chrome/")?Math.round:oi;function Lk(n){n.min=Dk(n.min),n.max=Dk(n.max)}function W_e(n){Lk(n.x),Lk(n.y)}function UB(n,e,t){return n==="position"||n==="preserve-aspect"&&!Zye(Rk(e),Rk(t),.2)}function q_e(n){return n!==n.root&&n.scroll?.wasRoot}const X_e=LB({attachResizeListener:(n,e)=>lp(n,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),QT={current:void 0},VB=LB({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!QT.current){const n=new X_e({});n.mount(window),n.setOptions({layoutScroll:!0}),QT.current=n}return QT.current},resetTransform:(n,e)=>{n.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),Y_e={pan:{Feature:f_e},drag:{Feature:h_e,ProjectionNode:VB,MeasureLayout:PB}};function Uk(n,e,t){const{props:r}=n;n.animationState&&r.whileHover&&n.animationState.setActive("whileHover",t==="Start");const i="onHover"+t,s=r[i];s&&Dt.postRender(()=>s(e,Np(e)))}class K_e extends ja{mount(){const{current:e}=this.node;e&&(this.unmount=gme(e,(t,r)=>(Uk(this.node,r,"Start"),i=>Uk(this.node,i,"End"))))}unmount(){}}class G_e extends ja{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Mp(lp(this.node.current,"focus",()=>this.onFocus()),lp(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function Vk(n,e,t){const{props:r}=n;if(n.current instanceof HTMLButtonElement&&n.current.disabled)return;n.animationState&&r.whileTap&&n.animationState.setActive("whileTap",t==="Start");const i="onTap"+(t==="End"?"":t),s=r[i];s&&Dt.postRender(()=>s(e,Np(e)))}class Z_e extends ja{mount(){const{current:e}=this.node;e&&(this.unmount=vme(e,(t,r)=>(Vk(this.node,r,"Start"),(i,{success:s})=>Vk(this.node,i,s?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const Wx=new WeakMap,JT=new WeakMap,Q_e=n=>{const e=Wx.get(n.target);e&&e(n)},J_e=n=>{n.forEach(Q_e)};function eve({root:n,...e}){const t=n||document;JT.has(t)||JT.set(t,{});const r=JT.get(t),i=JSON.stringify(e);return r[i]||(r[i]=new IntersectionObserver(J_e,{root:n,...e})),r[i]}function tve(n,e,t){const r=eve(e);return Wx.set(n,t),r.observe(n),()=>{Wx.delete(n),r.unobserve(n)}}const nve={some:0,all:1};class rve extends ja{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:r,amount:i="some",once:s}=e,o={root:t?t.current:void 0,rootMargin:r,threshold:typeof i=="number"?i:nve[i]},a=u=>{const{isIntersecting:h}=u;if(this.isInView===h||(this.isInView=h,s&&!h&&this.hasEnteredView))return;h&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",h);const{onViewportEnter:d,onViewportLeave:g}=this.node.getProps(),y=h?d:g;y&&y(u)};return tve(this.node.current,o,a)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(ive(e,t))&&this.startObserver()}unmount(){}}function ive({viewport:n={}},{viewport:e={}}={}){return t=>n[t]!==e[t]}const sve={inView:{Feature:rve},tap:{Feature:Z_e},focus:{Feature:G_e},hover:{Feature:K_e}},ove={layout:{ProjectionNode:VB,MeasureLayout:PB}},ave={...Wye,...sve,...Y_e,...ove},ew=aye(ave,bye),lve=()=>{const{user:n}=Spe(),[e,t]=A.useState(null),r=$_(),[i,s]=A.useState(!1),o={initial:{y:8,opacity:0},animate:{y:0,opacity:1,transition:{duration:.22}},exit:{y:-8,opacity:0,transition:{duration:.18}}};return A.useEffect(()=>{let a=!0;if(!n){t(null);return}return(async()=>{try{const u=await xpe(n.uid);a&&t(u)}catch(u){console.error("Failed to load username:",u),a&&t(null)}})(),()=>{a=!1}},[n]),A.useEffect(()=>{if(typeof document>"u")return;const a=document.body.style.overflowY;return document.body.style.overflowY="hidden",()=>{document.body.style.overflowY=a||""}},[]),$.jsx("div",{className:`flex justify-center items-top min-h-screen ${r?"mt-15":"mt-5"}`,children:$.jsx("div",{className:`bg-gray-400/40 dark:bg-gray-900 h-fit min-h-190 ${r?"mt-0 mb-15 mr-8 ml-8":"mt-30 mb-10"} w-240 border-2 border-gray-300 p-5 rounded-lg shadow-lg backdrop-blur-md`,children:n?$.jsxs("div",{className:"mt-5 text-center",children:[$.jsx("div",{className:"absolute bottom-5 right-5",children:$.jsx(_r,{to:"/settings",className:"tooltip tooltip-top","data-tip":"Settings",children:$.jsx(M4,{className:"text-gray-600 hover:text-gray-800 text-4xl dark:text-white"})})}),"Welcome, ",e??n.email??"user",$.jsx("br",{}),$.jsx("button",{onClick:async()=>{try{await wpe()}catch(a){console.error("Logout failed:",a)}},className:`mt-5 bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded ${r?"w-full":"w-1/2"}`,children:"Logout"})]}):$.jsx($.Fragment,{children:$.jsx(ew.div,{layout:!0,className:"mt-5",children:$.jsx(Ime,{mode:"wait",children:i?$.jsxs(ew.div,{variants:o,initial:"initial",animate:"animate",exit:"exit",className:"",children:[$.jsx(Epe,{}),$.jsx("button",{onClick:()=>s(!1),className:"mt-3 w-full text-blue-500 hover:underline",children:"Already have an account? Login here."})]},"register"):$.jsxs(ew.div,{variants:o,initial:"initial",animate:"animate",exit:"exit",className:"",children:[$.jsx(Ape,{}),$.jsx("button",{onClick:()=>s(!0),className:"mt-3 w-full text-blue-500 hover:underline",children:"Don't have an account? Register here."})]},"login")})})})})})};var vv="Switch",[cve,Sve]=uc(vv),[uve,hve]=cve(vv),FB=A.forwardRef((n,e)=>{const{__scopeSwitch:t,name:r,checked:i,defaultChecked:s,required:o,disabled:a,value:u="on",onCheckedChange:h,form:d,...g}=n,[y,v]=A.useState(null),T=ir(e,I=>v(I)),w=A.useRef(!1),E=y?d||!!y.closest("form"):!0,[S,P]=Sh({prop:i,defaultProp:s??!1,onChange:h,caller:vv});return $.jsxs(uve,{scope:t,checked:S,disabled:a,children:[$.jsx(wn.button,{type:"button",role:"switch","aria-checked":S,"aria-required":o,"data-state":HB(S),"data-disabled":a?"":void 0,disabled:a,value:u,...g,ref:T,onClick:Ur(n.onClick,I=>{P(L=>!L),E&&(w.current=I.isPropagationStopped(),w.current||I.stopPropagation())})}),E&&$.jsx(jB,{control:y,bubbles:!w.current,name:r,value:u,checked:S,required:o,disabled:a,form:d,style:{transform:"translateX(-100%)"}})]})});FB.displayName=vv;var BB="SwitchThumb",zB=A.forwardRef((n,e)=>{const{__scopeSwitch:t,...r}=n,i=hve(BB,t);return $.jsx(wn.span,{"data-state":HB(i.checked),"data-disabled":i.disabled?"":void 0,...r,ref:e})});zB.displayName=BB;var fve="SwitchBubbleInput",jB=A.forwardRef(({__scopeSwitch:n,control:e,checked:t,bubbles:r=!0,...i},s)=>{const o=A.useRef(null),a=ir(o,s),u=VL(t),h=JE(e);return A.useEffect(()=>{const d=o.current;if(!d)return;const g=window.HTMLInputElement.prototype,v=Object.getOwnPropertyDescriptor(g,"checked").set;if(u!==t&&v){const T=new Event("click",{bubbles:r});v.call(d,t),d.dispatchEvent(T)}},[u,t,r]),$.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:t,...i,tabIndex:-1,ref:a,style:{...i.style,...h,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});jB.displayName=fve;function HB(n){return n?"checked":"unchecked"}var dve=FB,pve=zB;function gve({className:n,...e}){return $.jsx(dve,{"data-slot":"switch",className:Ql("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",n),...e,children:$.jsx(pve,{"data-slot":"switch-thumb",className:Ql("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}const mve=()=>{const{theme:n,setTheme:e}=_X(),t=$_();A.useEffect(()=>{if(typeof document>"u")return;const i=document.body.style.overflowY;return document.body.style.overflowY="hidden",()=>{document.body.style.overflowY=i||""}},[]);const r=A.useCallback(i=>{e(i?"dark":"light")},[e]);return $.jsx("div",{className:`flex justify-center items-top min-h-screen ${t?"mt-15":"mt-5"}`,children:$.jsx("div",{className:`bg-gray-400/40 dark:bg-gray-900 h-fit min-h-190 ${t?"mt-0 mb-15 mr-8 ml-8":"mt-30 mb-10"} w-240 border-2 border-gray-300 p-5 rounded-lg shadow-lg backdrop-blur-md`,children:$.jsxs("div",{className:"mt-5 text-center",children:[$.jsx("h1",{className:"font-bold text-3xl text-gray-700 dark:text-white",children:"Settings"}),$.jsx("div",{className:"mt-10 flex flex-col gap-10 ",children:$.jsx("div",{className:"flex justify-center w-full",children:$.jsx("div",{className:"flex items-center justify-between w-full max-w-[320px] px-4",children:$.jsxs("form",{className:"flex items-center justify-between w-full",children:[$.jsx("span",{className:"font-medium text-lg text-gray-700 dark:text-white truncate",children:"Dark Mode"}),$.jsx("div",{className:"ml-4",children:$.jsx(gve,{checked:n==="dark",onCheckedChange:r,"aria-label":"Toggle dark mode"})})]})})})})]})})})};function yve(){return $.jsx(vX,{children:$.jsx(bX,{children:$.jsxs(Bz,{children:[$.jsx(PX,{}),$.jsxs(yz,{children:[$.jsx(fu,{path:"/",element:$.jsx(ype,{})}),$.jsx(fu,{path:"/vessels",element:$.jsx("div",{className:"mt-30 text-center",children:"Vessels"})}),$.jsx(fu,{path:"/gallery",element:$.jsx("div",{className:"mt-30 text-center",children:"Vessel Gallery"})}),$.jsx(fu,{path:"/account",element:$.jsx(lve,{})}),$.jsx(fu,{path:"/settings",element:$.jsx(mve,{})})]})]})})})}S8.createRoot(document.getElementById("root")).render($.jsx(A.StrictMode,{children:$.jsx(yve,{})}));
